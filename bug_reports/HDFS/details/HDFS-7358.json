{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12752904","self":"https://issues.apache.org/jira/rest/api/2/issue/12752904","key":"HDFS-7358","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327584","id":"12327584","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-11-05T00:58:27.001+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Nov 14 15:25:12 UTC 2014","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_759102848_*|*_1_*:*_1_*:*_7699738_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-11-13T20:36:46.488+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7358/watchers","watchCount":5,"isWatching":false},"created":"2014-11-04T23:36:43.956+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12400618","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12400618","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12752473","key":"HDFS-7325","self":"https://issues.apache.org/jira/rest/api/2/issue/12752473","fields":{"summary":"Prevent thundering herd problem in ByteArrayManager by using notify not notifyAll","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12400539","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12400539","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"inwardIssue":{"id":"12749682","key":"HDFS-7276","self":"https://issues.apache.org/jira/rest/api/2/issue/12749682","fields":{"summary":"Limit the number of byte arrays used by DFSOutputStream","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-04-24T23:23:02.780+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312928","id":"12312928","name":"hdfs-client"}],"timeoriginalestimate":null,"description":"[~stack] reported that clients might get stuck waiting when using ByteArrayManager; see [his comments|https://issues.apache.org/jira/browse/HDFS-7276?focusedCommentId=14197036&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14197036].","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12679383","id":"12679383","filename":"h7358_20141104_wait_timeout.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T00:01:16.636+0000","size":673,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12679383/h7358_20141104_wait_timeout.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12679417","id":"12679417","filename":"h7358_20141104.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T01:44:48.425+0000","size":6717,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12679417/h7358_20141104.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12679673","id":"12679673","filename":"h7358_20141105.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T23:02:31.364+0000","size":7657,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12679673/h7358_20141105.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12680047","id":"12680047","filename":"h7358_20141106.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-07T01:46:39.160+0000","size":12265,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12680047/h7358_20141106.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12680257","id":"12680257","filename":"h7358_20141107.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-07T20:41:11.720+0000","size":11612,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12680257/h7358_20141107.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12680428","id":"12680428","filename":"h7358_20141108.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-08T21:36:33.847+0000","size":15552,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12680428/h7358_20141108.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Clients may get stuck waiting when using ByteArrayManager","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14197175","id":"14197175","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"[~stack], let's add a wait timeout to see if the clients still get stuck.  If no, the bug is in ByteArrayManager since there are released arrays but the allocate calls remain blocked.  If yes, it means that there is no one releasing arrays so that clients have to wait; the bug may be outside ByteArrayManager.  Could you try the patch below?\n\nh7358_20141104_wait_timeout.patch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T00:01:16.645+0000","updated":"2014-11-05T00:01:16.645+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14197254","id":"14197254","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"With the patch in place, it takes longer to hit the stall and then when I do, I get the loggings about wake up:\n\n{code}\n2014-11-04 16:55:57,202 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 9999/10000, free=0], freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,202 DEBUG [sync.0] util.ByteArrayManager: allocate(65565): count=60367, aboveThreshold, [131072: 9998/10000, free=1], recycled? true\n2014-11-04 16:55:57,202 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 9999/10000, free=0], freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,202 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 9998/10000, free=1], freeQueue.offer, freeQueueSize=2\n2014-11-04 16:55:57,202 DEBUG [sync.3] util.ByteArrayManager: allocate(65565): count=60368, aboveThreshold, [131072: 9997/10000, free=2], recycled? true\n2014-11-04 16:55:57,202 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 9998/10000, free=1], freeQueue.offer, freeQueueSize=2\n2014-11-04 16:55:57,202 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 9997/10000, free=2], freeQueue.offer, freeQueueSize=3\n2014-11-04 16:55:57,203 DEBUG [sync.2] util.ByteArrayManager: allocate(65565): count=60369, aboveThreshold, [131072: 9996/10000, free=3], recycled? true\n2014-11-04 16:55:57,203 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 9997/10000, free=2], freeQueue.offer, freeQueueSize=3\n2014-11-04 16:55:57,203 DEBUG [sync.1] util.ByteArrayManager: allocate(65565): count=60370, aboveThreshold, [131072: 9996/10000, free=3], recycled? true\n2014-11-04 16:55:57,203 DEBUG [sync.4] util.ByteArrayManager: allocate(65565): count=60371, aboveThreshold, [131072: 9997/10000, free=2], recycled? true\n2014-11-04 16:55:57,203 DEBUG [sync.0] util.ByteArrayManager: allocate(65565): count=60372, aboveThreshold, [131072: 9998/10000, free=1], recycled? true\n2014-11-04 16:55:57,203 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 9999/10000, free=0], freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,203 DEBUG [sync.2] util.ByteArrayManager: allocate(65565): count=60373, aboveThreshold, [131072: 9998/10000, free=1], recycled? true\n2014-11-04 16:55:57,203 DEBUG [sync.3] util.ByteArrayManager: allocate(65565): count=60374, aboveThreshold, [131072: 9999/10000, free=0], recycled? false\n2014-11-04 16:55:57,204 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 10000/10000, free=0], notifyAll, freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,204 DEBUG [sync.4] util.ByteArrayManager: allocate(65565): count=60375, aboveThreshold, [131072: 9999/10000, free=1], recycled? true\n2014-11-04 16:55:57,204 DEBUG [sync.1] util.ByteArrayManager: allocate(65565): count=60376, aboveThreshold, [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:55:57,204 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 10000/10000, free=0], notifyAll, freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,204 DEBUG [sync.1] util.ByteArrayManager: wake up: [131072: 9999/10000, free=1], recycled? true\n2014-11-04 16:55:57,204 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 10000/10000, free=0], notifyAll, freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,204 DEBUG [sync.0] util.ByteArrayManager: allocate(65565): count=60377, aboveThreshold, [131072: 9999/10000, free=1], recycled? true\n2014-11-04 16:55:57,204 DEBUG [sync.2] util.ByteArrayManager: allocate(65565): count=60378, aboveThreshold, [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:55:57,204 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 10000/10000, free=0], notifyAll, freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,205 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 9999/10000, free=1], recycled? true\n2014-11-04 16:55:57,205 DEBUG [sync.3] util.ByteArrayManager: allocate(65565): count=60379, aboveThreshold, [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:55:57,205 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 10000/10000, free=0], notifyAll, freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,205 DEBUG [sync.3] util.ByteArrayManager: wake up: [131072: 9999/10000, free=1], recycled? true\n2014-11-04 16:55:57,205 DEBUG [sync.1] util.ByteArrayManager: allocate(65565): count=60380, aboveThreshold, [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:55:57,205 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 10000/10000, free=0], notifyAll, freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,205 DEBUG [sync.1] util.ByteArrayManager: wake up: [131072: 9999/10000, free=1], recycled? true\n2014-11-04 16:55:57,205 DEBUG [sync.4] util.ByteArrayManager: allocate(65565): count=60381, aboveThreshold, [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:55:57,206 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 10000/10000, free=0], notifyAll, freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,206 DEBUG [sync.4] util.ByteArrayManager: wake up: [131072: 9999/10000, free=1], recycled? true\n2014-11-04 16:55:57,206 DEBUG [sync.0] util.ByteArrayManager: allocate(65565): count=60382, aboveThreshold, [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:55:57,206 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 10000/10000, free=0], notifyAll, freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,206 DEBUG [sync.0] util.ByteArrayManager: wake up: [131072: 9999/10000, free=1], recycled? true\n2014-11-04 16:55:57,206 DEBUG [sync.2] util.ByteArrayManager: allocate(65565): count=60383, aboveThreshold, [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:55:57,206 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 10000/10000, free=0], notifyAll, freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,206 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 9999/10000, free=1], recycled? true\n2014-11-04 16:55:57,206 DEBUG [sync.3] util.ByteArrayManager: allocate(65565): count=60384, aboveThreshold, [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:55:57,206 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 10000/10000, free=0], notifyAll, freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,207 DEBUG [sync.3] util.ByteArrayManager: wake up: [131072: 9999/10000, free=1], recycled? true\n2014-11-04 16:55:57,207 DEBUG [sync.1] util.ByteArrayManager: allocate(65565): count=60385, aboveThreshold, [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:55:57,207 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 10000/10000, free=0], notifyAll, freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,207 DEBUG [sync.1] util.ByteArrayManager: wake up: [131072: 9999/10000, free=1], recycled? true\n2014-11-04 16:55:57,207 DEBUG [sync.4] util.ByteArrayManager: allocate(65565): count=60386, aboveThreshold, [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:55:57,207 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 10000/10000, free=0], notifyAll, freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,207 DEBUG [sync.4] util.ByteArrayManager: wake up: [131072: 9999/10000, free=1], recycled? true\n2014-11-04 16:55:57,207 DEBUG [sync.1] util.ByteArrayManager: allocate(65565): count=60387, aboveThreshold, [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:55:57,208 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 10000/10000, free=0], notifyAll, freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,208 DEBUG [sync.1] util.ByteArrayManager: wake up: [131072: 9999/10000, free=1], recycled? true\n2014-11-04 16:55:57,208 DEBUG [sync.0] util.ByteArrayManager: allocate(65565): count=60388, aboveThreshold, [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:55:57,209 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488681_1099513376802] util.ByteArrayManager: recycle: array.length=131072, [131072: 10000/10000, free=0], notifyAll, freeQueue.offer, freeQueueSize=1\n2014-11-04 16:55:57,209 DEBUG [sync.0] util.ByteArrayManager: wake up: [131072: 9999/10000, free=1], recycled? true\n2014-11-04 16:55:57,209 DEBUG [sync.2] util.ByteArrayManager: allocate(65565): count=60389, aboveThreshold, [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:55:58,209 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:55:59,209 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:56:00,210 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:56:01,210 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:56:02,210 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:56:03,210 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:56:04,210 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:56:05,210 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:56:06,210 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:56:07,211 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:56:08,211 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:56:09,211 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:56:10,211 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:56:11,211 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:56:12,212 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n2014-11-04 16:56:13,212 DEBUG [sync.2] util.ByteArrayManager: wake up: [131072: 10000/10000, free=0]: wait ...\n....\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T00:58:27.001+0000","updated":"2014-11-05T00:58:27.001+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14197288","id":"14197288","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Since the clients still get stuck with wait-timeout, it seems that there is no one releasing arrays so that clients have to wait.  The \"wake up: [131072: 10000/10000, free=0]: wait ...\" messages just say that the allocate call wakes up, checks allocations# (but still full) and then sleep again.\n\n[~stack], do you know why the clients are not releasing arrays?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T01:16:03.858+0000","updated":"2014-11-05T01:16:03.858+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14197326","id":"14197326","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Tried to change TestByteArrayManager but not able to reproduce the bug.\n\nHowever, I did find a bug in the test -- it should not call Future.get() when holding a lock.\n\nh7358_20141104.patch: fixes TestByteArrayManager and changes notifyAll() to notify().","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T01:44:48.431+0000","updated":"2014-11-05T01:44:48.431+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14197613","id":"14197613","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12679417/h7358_20141104.patch\n  against trunk revision b2cd269.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.hdfs.server.balancer.TestBalancer\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/8652//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/8652//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-05T04:51:22.441+0000","updated":"2014-11-05T04:51:22.441+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199077","id":"14199077","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"See how we are 'Waiting for ack for: 42' twice in the below log snippet though we wrote out a seq no. 43.  At about same time the allocate/recycle numbering goes 'off' at this time because its waiting on an ack that doesn't ever arrive so there is an outstanding allocation with a corresponding recycle that will never come (Should + one.releaseBuffer(byteArrayManager); be inside a finally block?) If I run with one thread only, I don't see this issue. It is only with two or more. My little program has 5 threads writing and calling sync.\n\nI turned this feature off and see that we are skipping ack numbers from time to time so this is problem is not brought on by this feature but you can't use this feature till its fixed.  Looking...\n\n{code}\n...\n2014-11-05 11:16:47,293 DEBUG [sync.0] util.ByteArrayManager: allocate(65565): count=43, aboveThreshold, [131072: 1/10, free=1], recycled? true\n2014-11-05 11:16:47,293 DEBUG [sync.0] hdfs.DFSClient: DFSClient writeChunk allocating new packet seqno=41, src=/user/stack/test-data/2256ed2b-6cc1-4144-88a5-227baf11842c/HLogPerformanceEvaluation/wals/hlog.1415215004083, packetSize=65532, chunksPerPacket=127, bytesCurBlock=31232\n2014-11-05 11:16:47,293 DEBUG [sync.0] hdfs.DFSClient: DFSClient flush() : bytesCurBlock 32088 lastFlushOffset 31579\n2014-11-05 11:16:47,293 DEBUG [sync.0] hdfs.DFSClient: Queued packet 41\n2014-11-05 11:16:47,293 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 41\n2014-11-05 11:16:47,293 DEBUG [DataStreamer for file /user/stack/test-data/2256ed2b-6cc1-4144-88a5-227baf11842c/HLogPerformanceEvaluation/wals/hlog.1415215004083 block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940] hdfs.DFSClient: DataStreamer block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940 sending packet packet seqno:41 offsetInBlock:31232 lastPacketInBlock:false lastByteOffsetInBlock: 32088\n2014-11-05 11:16:47,294 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940] hdfs.DFSClient: DFSClient seqno: 40 status: SUCCESS status: SUCCESS status: SUCCESS downstreamAckTimeNanos: 487791\n2014-11-05 11:16:47,294 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940] util.ByteArrayManager: recycle: array.length=131072, [131072: 2/10, free=0], freeQueue.offer, freeQueueSize=1\n2014-11-05 11:16:47,294 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940] hdfs.DFSClient: DFSClient seqno: 41 status: SUCCESS status: SUCCESS status: SUCCESS downstreamAckTimeNanos: 465086\n2014-11-05 11:16:47,294 DEBUG [sync.1] util.ByteArrayManager: allocate(65565): count=44, aboveThreshold, [131072: 1/10, free=1], recycled? true\n2014-11-05 11:16:47,295 DEBUG [sync.1] hdfs.DFSClient: DFSClient writeChunk allocating new packet seqno=42, src=/user/stack/test-data/2256ed2b-6cc1-4144-88a5-227baf11842c/HLogPerformanceEvaluation/wals/hlog.1415215004083, packetSize=65532, chunksPerPacket=127, bytesCurBlock=31744\n2014-11-05 11:16:47,295 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940] util.ByteArrayManager: recycle: array.length=131072, [131072: 2/10, free=0], freeQueue.offer, freeQueueSize=1\n2014-11-05 11:16:47,295 DEBUG [sync.1] hdfs.DFSClient: DFSClient flush() : bytesCurBlock 32853 lastFlushOffset 32088\n2014-11-05 11:16:47,295 DEBUG [sync.1] hdfs.DFSClient: Queued packet 42\n2014-11-05 11:16:47,295 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 42\n2014-11-05 11:16:47,295 DEBUG [DataStreamer for file /user/stack/test-data/2256ed2b-6cc1-4144-88a5-227baf11842c/HLogPerformanceEvaluation/wals/hlog.1415215004083 block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940] hdfs.DFSClient: DataStreamer block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940 sending packet packet seqno:42 offsetInBlock:31744 lastPacketInBlock:false lastByteOffsetInBlock: 32853\n\n2014-11-05 11:16:47,295 DEBUG [sync.0] util.ByteArrayManager: allocate(65565): count=45, aboveThreshold, [131072: 1/10, free=1], recycled? true\n2014-11-05 11:16:47,295 DEBUG [sync.0] hdfs.DFSClient: DFSClient writeChunk allocating new packet seqno=43, src=/user/stack/test-data/2256ed2b-6cc1-4144-88a5-227baf11842c/HLogPerformanceEvaluation/wals/hlog.1415215004083, packetSize=65532, chunksPerPacket=127, bytesCurBlock=32768\n2014-11-05 11:16:47,295 DEBUG [sync.0] hdfs.DFSClient: DFSClient flush() : bytesCurBlock 32853 lastFlushOffset 32853\n2014-11-05 11:16:47,295 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 42\n2014-11-05 11:16:47,296 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940] hdfs.DFSClient: DFSClient seqno: 42 status: SUCCESS status: SUCCESS status: SUCCESS downstreamAckTimeNanos: 504509\n2014-11-05 11:16:47,296 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940] util.ByteArrayManager: recycle: array.length=131072, [131072: 2/10, free=0], freeQueue.offer, freeQueueSize=1\n\n2014-11-05 11:16:47,296 DEBUG [sync.0] util.ByteArrayManager: allocate(65565): count=46, aboveThreshold, [131072: 1/10, free=1], recycled? true\n2014-11-05 11:16:47,296 DEBUG [sync.0] hdfs.DFSClient: DFSClient writeChunk allocating new packet seqno=44, src=/user/stack/test-data/2256ed2b-6cc1-4144-88a5-227baf11842c/HLogPerformanceEvaluation/wals/hlog.1415215004083, packetSize=65532, chunksPerPacket=127, bytesCurBlock=32768\n2014-11-05 11:16:47,296 DEBUG [sync.0] hdfs.DFSClient: DFSClient flush() : bytesCurBlock 34208 lastFlushOffset 32853\n2014-11-05 11:16:47,296 DEBUG [sync.0] hdfs.DFSClient: Queued packet 44\n2014-11-05 11:16:47,297 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 44\n2014-11-05 11:16:47,297 DEBUG [DataStreamer for file /user/stack/test-data/2256ed2b-6cc1-4144-88a5-227baf11842c/HLogPerformanceEvaluation/wals/hlog.1415215004083 block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940] hdfs.DFSClient: DataStreamer block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940 sending packet packet seqno:44 offsetInBlock:32768 lastPacketInBlock:false lastByteOffsetInBlock: 34208\n\n2014-11-05 11:16:47,297 DEBUG [sync.1] util.ByteArrayManager: allocate(65565): count=47, aboveThreshold, [131072: 2/10, free=0], recycled? false\n2014-11-05 11:16:47,297 DEBUG [sync.1] hdfs.DFSClient: DFSClient writeChunk allocating new packet seqno=45, src=/user/stack/test-data/2256ed2b-6cc1-4144-88a5-227baf11842c/HLogPerformanceEvaluation/wals/hlog.1415215004083, packetSize=65532, chunksPerPacket=127, bytesCurBlock=33792\n2014-11-05 11:16:47,297 DEBUG [sync.1] hdfs.DFSClient: DFSClient flush() : bytesCurBlock 34383 lastFlushOffset 34208\n2014-11-05 11:16:47,297 DEBUG [sync.1] hdfs.DFSClient: Queued packet 45\n2014-11-05 11:16:47,297 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 45\n2014-11-05 11:16:47,297 DEBUG [DataStreamer for file /user/stack/test-data/2256ed2b-6cc1-4144-88a5-227baf11842c/HLogPerformanceEvaluation/wals/hlog.1415215004083 block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940] hdfs.DFSClient: DataStreamer block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940 sending packet packet seqno:45 offsetInBlock:33792 lastPacketInBlock:false lastByteOffsetInBlock: 34383\n2014-11-05 11:16:47,298 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940] hdfs.DFSClient: DFSClient seqno: 44 status: SUCCESS status: SUCCESS status: SUCCESS downstreamAckTimeNanos: 527654\n2014-11-05 11:16:47,298 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940] util.ByteArrayManager: recycle: array.length=131072, [131072: 3/10, free=0], freeQueue.offer, freeQueueSize=1\n\n2014-11-05 11:16:47,298 DEBUG [sync.0] util.ByteArrayManager: allocate(65565): count=48, aboveThreshold, [131072: 2/10, free=1], recycled? true\n2014-11-05 11:16:47,298 DEBUG [sync.0] hdfs.DFSClient: DFSClient writeChunk allocating new packet seqno=46, src=/user/stack/test-data/2256ed2b-6cc1-4144-88a5-227baf11842c/HLogPerformanceEvaluation/wals/hlog.1415215004083, packetSize=65532, chunksPerPacket=127, bytesCurBlock=34304\n2014-11-05 11:16:47,298 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940] hdfs.DFSClient: DFSClient seqno: 45 status: SUCCESS status: SUCCESS status: SUCCESS downstreamAckTimeNanos: 486422\n2014-11-05 11:16:47,298 DEBUG [sync.0] hdfs.DFSClient: DFSClient flush() : bytesCurBlock 35403 lastFlushOffset 34383\n2014-11-05 11:16:47,298 DEBUG [ResponseProcessor for block BP-410607956-10.20.84.26-1391491814882:blk_1075488801_1099513376940] util.ByteArrayManager: recycle: array.length=131072, [131072: 3/10, free=0], freeQueue.offer, freeQueueSize=1\n2014-11-05 11:16:47,298 DEBUG [sync.0] hdfs.DFSClient: Queued packet 46\n2014-11-05 11:16:47,298 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 46\n...\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T21:04:40.733+0000","updated":"2014-11-05T21:04:40.733+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199141","id":"14199141","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> ... (Should + one.releaseBuffer(byteArrayManager); be inside a finally block?) ...\n\nYou make a good point that the array may not be released when the pipeline eventually fails.  We cannot call releaseBuffer(..) in a finally block since, for the usual error cases, client will reconstruct the pipeline and retry sending the same packets.  I will think about how to fix it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T21:37:28.440+0000","updated":"2014-11-05T21:37:28.440+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199163","id":"14199163","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"Looking at packet sequence numbers, it seems like this just how it works -- that a later seqnumber acks outstanding ones (I don't know enough to call it otherwise -- maybe you know [~szetszwo]?) -- and if so, we will have outstanding allocations and our counts will be off.  Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T21:45:01.749+0000","updated":"2014-11-05T21:45:01.749+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199182","id":"14199182","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> ... that a later seqnumber acks outstanding ones ...\n\nThe pipeline expects an ack for every packets.  It won't have acks with skipped seq no.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T21:53:25.756+0000","updated":"2014-11-05T21:53:25.756+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199189","id":"14199189","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"Makes sense.  There is a bug in dfsoutputstream then? I can get skipping of seqno without this feature enabled.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T21:56:54.780+0000","updated":"2014-11-05T21:56:54.780+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199246","id":"14199246","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"Without ByteArrayManager enabled, using tip of 2.6 logging at DEBUG level grepping 'Waiting for ack' I see us skipping packet seqnos.  See below. See doubled '8', '22', and '26'.\n\n\n{code}\n2014-11-05 14:08:57,240 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 1\n2014-11-05 14:08:57,243 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 2\n2014-11-05 14:08:57,245 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 3\n2014-11-05 14:08:57,246 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 4\n2014-11-05 14:08:57,246 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 5\n2014-11-05 14:08:57,249 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 6\n2014-11-05 14:08:57,250 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 7\n2014-11-05 14:08:57,252 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 8\n2014-11-05 14:08:57,252 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 8\n2014-11-05 14:08:57,253 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 10\n2014-11-05 14:08:57,254 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 11\n2014-11-05 14:08:57,255 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 12\n2014-11-05 14:08:57,255 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 13\n2014-11-05 14:08:57,257 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 14\n2014-11-05 14:08:57,258 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 15\n2014-11-05 14:08:57,258 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 16\n2014-11-05 14:08:57,259 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 17\n2014-11-05 14:08:57,261 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 18\n2014-11-05 14:08:57,262 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 19\n2014-11-05 14:08:57,263 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 20\n2014-11-05 14:08:57,264 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 21\n2014-11-05 14:08:57,265 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 22\n2014-11-05 14:08:57,265 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 22\n2014-11-05 14:08:57,267 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 24\n2014-11-05 14:08:57,267 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 25\n2014-11-05 14:08:57,268 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 26\n2014-11-05 14:08:57,268 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 26\n2014-11-05 14:08:57,270 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 28\n2014-11-05 14:08:57,270 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 29\n2014-11-05 14:08:57,271 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 30\n...\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T22:28:55.765+0000","updated":"2014-11-05T22:28:55.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199265","id":"14199265","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> ... I can get skipping of seqno without this feature enabled.\n\nDo you mean missing seqno=43?  It is because of \"flush() : bytesCurBlock 32853 lastFlushOffset 32853\".  The seq 43 packet is described without being sent.  This is a leakage.  We need to release the array first.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T22:40:49.045+0000","updated":"2014-11-05T22:40:49.045+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199282","id":"14199282","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> ... grepping 'Waiting for ack' I see us skipping packet seqnos. See below. See doubled '8', '22', and '26'.\n\nFor all these case, the next seq numbers (i.e. 9, 23, 27) are missing.  I guess it the same as the seqno=43 case mentioned previously -- Client call flush().  At that time, bytesCurBlock==lastFlushOffset so that the packet is discarded without being queued/sent.  (I beg you won't see \"Queued packet\" for seq 9, 23 and 27.)  Client will wait for the previous seq no.  That why there are doubled seq no shown in \"Waiting for ack\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T22:50:04.602+0000","updated":"2014-11-05T22:50:04.602+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199285","id":"14199285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Again, a bug is: when a packet is discarded, it should release the array.\n\nAnother bug: when the pipeline fails, it should release the arrays in the data/ack queues.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T22:52:38.197+0000","updated":"2014-11-05T22:52:38.197+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199290","id":"14199290","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. I beg you won't see \"Queued packet\" for seq 9, 23 and 27.\n\nYes.... See below listing of corresponding 'Queued packet' with missing 9, etc.\n\n{code}\n2014-11-05 14:08:54,166 DEBUG [main] hdfs.DFSClient: Queued packet 0\n2014-11-05 14:08:54,796 DEBUG [main] hdfs.DFSClient: Queued packet 0\n2014-11-05 14:08:54,796 DEBUG [main] hdfs.DFSClient: Queued packet 1\n2014-11-05 14:08:57,240 DEBUG [sync.0] hdfs.DFSClient: Queued packet 1\n2014-11-05 14:08:57,243 DEBUG [sync.1] hdfs.DFSClient: Queued packet 2\n2014-11-05 14:08:57,245 DEBUG [sync.2] hdfs.DFSClient: Queued packet 3\n2014-11-05 14:08:57,246 DEBUG [sync.3] hdfs.DFSClient: Queued packet 4\n2014-11-05 14:08:57,246 DEBUG [sync.4] hdfs.DFSClient: Queued packet 5\n2014-11-05 14:08:57,249 DEBUG [sync.0] hdfs.DFSClient: Queued packet 6\n2014-11-05 14:08:57,250 DEBUG [sync.1] hdfs.DFSClient: Queued packet 7\n2014-11-05 14:08:57,252 DEBUG [sync.2] hdfs.DFSClient: Queued packet 8\n2014-11-05 14:08:57,253 DEBUG [sync.4] hdfs.DFSClient: Queued packet 10\n2014-11-05 14:08:57,254 DEBUG [sync.0] hdfs.DFSClient: Queued packet 11\n2014-11-05 14:08:57,255 DEBUG [sync.1] hdfs.DFSClient: Queued packet 12\n2014-11-05 14:08:57,255 DEBUG [sync.2] hdfs.DFSClient: Queued packet 13\n2014-11-05 14:08:57,256 DEBUG [sync.3] hdfs.DFSClient: Queued packet 14\n2014-11-05 14:08:57,258 DEBUG [sync.4] hdfs.DFSClient: Queued packet 15\n2014-11-05 14:08:57,258 DEBUG [sync.0] hdfs.DFSClient: Queued packet 16\n2014-11-05 14:08:57,259 DEBUG [sync.1] hdfs.DFSClient: Queued packet 17\n2014-11-05 14:08:57,261 DEBUG [sync.2] hdfs.DFSClient: Queued packet 18\n2014-11-05 14:08:57,262 DEBUG [sync.3] hdfs.DFSClient: Queued packet 19\n2014-11-05 14:08:57,263 DEBUG [sync.4] hdfs.DFSClient: Queued packet 20\n2014-11-05 14:08:57,264 DEBUG [sync.0] hdfs.DFSClient: Queued packet 21\n2014-11-05 14:08:57,265 DEBUG [sync.1] hdfs.DFSClient: Queued packet 22\n2014-11-05 14:08:57,267 DEBUG [sync.3] hdfs.DFSClient: Queued packet 24\n2014-11-05 14:08:57,267 DEBUG [sync.4] hdfs.DFSClient: Queued packet 25\n2014-11-05 14:08:57,268 DEBUG [sync.0] hdfs.DFSClient: Queued packet 26\n2014-11-05 14:08:57,269 DEBUG [sync.2] hdfs.DFSClient: Queued packet 28\n2014-11-05 14:08:57,270 DEBUG [sync.3] hdfs.DFSClient: Queued packet 29\n2014-11-05 14:08:57,271 DEBUG [sync.4] hdfs.DFSClient: Queued packet 30\n...\n{code}\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T22:56:20.430+0000","updated":"2014-11-05T22:56:20.430+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199291","id":"14199291","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"[~stack], could you try the following patch?\n\nh7358_20141105.patch: releases array when discarding a packet for flush().","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T22:56:33.922+0000","updated":"2014-11-05T22:56:33.922+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199302","id":"14199302","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"Weird. Your patch is not showing up in attachments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T23:02:44.812+0000","updated":"2014-11-05T23:02:44.812+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199305","id":"14199305","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Sorry, I was re-uploading the file.  You should see it now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T23:03:53.008+0000","updated":"2014-11-05T23:03:53.008+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199306","id":"14199306","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"There it is.  Let me try.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T23:04:06.717+0000","updated":"2014-11-05T23:04:06.717+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199334","id":"14199334","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"Better but still an odd skip: 28, 68...\n\n{code}\n2014-11-05 15:15:45,573 DEBUG [main] hdfs.DFSClient: Waiting for ack for: 0\n2014-11-05 15:15:46,263 DEBUG [main] hdfs.DFSClient: Waiting for ack for: 1\n2014-11-05 15:15:48,680 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 1\n2014-11-05 15:15:48,684 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 2\n2014-11-05 15:15:48,685 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 3\n2014-11-05 15:15:48,685 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 4\n2014-11-05 15:15:48,687 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 5\n2014-11-05 15:15:48,688 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 6\n2014-11-05 15:15:48,690 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 7\n2014-11-05 15:15:48,690 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 8\n2014-11-05 15:15:48,691 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 9\n2014-11-05 15:15:48,693 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 10\n2014-11-05 15:15:48,693 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 11\n2014-11-05 15:15:48,695 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 12\n2014-11-05 15:15:48,695 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 13\n2014-11-05 15:15:48,697 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 14\n2014-11-05 15:15:48,697 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 14\n2014-11-05 15:15:48,698 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 16\n2014-11-05 15:15:48,698 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 17\n2014-11-05 15:15:48,702 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 18\n2014-11-05 15:15:48,703 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 19\n2014-11-05 15:15:48,704 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 20\n2014-11-05 15:15:48,704 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 21\n2014-11-05 15:15:48,705 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 22\n2014-11-05 15:15:48,706 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 23\n2014-11-05 15:15:48,707 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 24\n2014-11-05 15:15:48,708 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 25\n2014-11-05 15:15:48,708 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 26\n2014-11-05 15:15:48,709 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 27\n2014-11-05 15:15:48,710 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 28\n2014-11-05 15:15:48,710 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 28\n2014-11-05 15:15:48,711 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 30\n2014-11-05 15:15:48,712 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 31\n2014-11-05 15:15:48,713 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 32\n2014-11-05 15:15:48,713 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 33\n2014-11-05 15:15:48,714 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 34\n2014-11-05 15:15:48,715 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 35\n2014-11-05 15:15:48,716 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 36\n2014-11-05 15:15:48,717 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 37\n2014-11-05 15:15:48,717 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 38\n2014-11-05 15:15:48,718 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 39\n2014-11-05 15:15:48,718 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 40\n2014-11-05 15:15:48,720 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 41\n2014-11-05 15:15:48,721 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 42\n2014-11-05 15:15:48,723 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 43\n2014-11-05 15:15:48,724 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 44\n2014-11-05 15:15:48,724 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 44\n2014-11-05 15:15:48,726 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 46\n2014-11-05 15:15:48,727 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 47\n2014-11-05 15:15:48,727 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 48\n2014-11-05 15:15:48,728 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 49\n2014-11-05 15:15:48,730 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 50\n2014-11-05 15:15:48,731 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 51\n2014-11-05 15:15:48,731 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 52\n2014-11-05 15:15:48,733 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 53\n2014-11-05 15:15:48,734 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 54\n2014-11-05 15:15:48,734 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 55\n2014-11-05 15:15:48,736 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 56\n2014-11-05 15:15:48,737 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 57\n2014-11-05 15:15:48,737 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 58\n2014-11-05 15:15:48,738 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 59\n2014-11-05 15:15:48,739 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 60\n2014-11-05 15:15:48,739 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 61\n2014-11-05 15:15:48,740 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 62\n2014-11-05 15:15:48,741 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 63\n2014-11-05 15:15:48,741 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 64\n2014-11-05 15:15:48,742 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 65\n2014-11-05 15:15:48,742 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 66\n2014-11-05 15:15:48,743 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 67\n2014-11-05 15:15:48,744 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 68\n2014-11-05 15:15:48,744 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 68\n2014-11-05 15:15:48,744 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 70\n2014-11-05 15:15:48,745 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 71\n2014-11-05 15:15:48,747 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 72\n2014-11-05 15:15:48,748 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 73\n2014-11-05 15:15:48,749 DEBUG [sync.3] hdfs.DFSClient: Waiting for ack for: 74\n2014-11-05 15:15:48,749 DEBUG [sync.4] hdfs.DFSClient: Waiting for ack for: 75\n2014-11-05 15:15:48,750 DEBUG [sync.0] hdfs.DFSClient: Waiting for ack for: 76\n2014-11-05 15:15:48,751 DEBUG [sync.1] hdfs.DFSClient: Waiting for ack for: 77\n2014-11-05 15:15:48,751 DEBUG [sync.2] hdfs.DFSClient: Waiting for ack for: 78\n...\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T23:19:39.530+0000","updated":"2014-11-05T23:19:39.530+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199354","id":"14199354","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Stack, the patch won't fix skipping seq no, which is not a bug.  The patch fixes releasing arrays when skipping happens.  So could you test it with ByteArrayManager enabled to see if the client still gets stuck?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T23:24:49.594+0000","updated":"2014-11-05T23:24:49.594+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199398","id":"14199398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch works for me. My little program with 5 writing/syncing threads runs to completion.\n\n+1 on patch.\n\nDo we still need to handle case where exception waiting on ack; we'll not clean up an allocation?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-05T23:46:52.837+0000","updated":"2014-11-05T23:46:52.837+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14199635","id":"14199635","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12679673/h7358_20141105.patch\n  against trunk revision bc80251.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:red}-1 javadoc{color}.  The javadoc tool appears to have generated 13 warning messages.\n        See https://builds.apache.org/job/PreCommit-HDFS-Build/8667//artifact/patchprocess/diffJavadocWarnings.txt for details.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.hdfs.qjournal.client.TestQuorumJournalManager\n                  org.apache.hadoop.hdfs.crypto.TestHdfsCryptoStreams\n                  org.apache.hadoop.hdfs.server.namenode.TestCheckpoint\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/8667//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/8667//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-06T02:11:39.947+0000","updated":"2014-11-06T02:11:39.947+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14201089","id":"14201089","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> Patch works for me. My little program with 5 writing/syncing threads runs to completion.\n\nHi [~stack], do you want to open source your test program?\n\n> Do we still need to handle case where exception waiting on ack; we'll not clean up an allocation?\n\nYes, I will check if there are other leakage for the error cases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-06T22:35:04.211+0000","updated":"2014-11-06T22:35:04.211+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14201317","id":"14201317","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Hi stack, do you want to open source your test program?\n\nIts a small tool in HBase code base used testing the writing of HBase WAL files. I ran it like this:\n\n{code}for i in 10 20 100; do for j in 1 2 3; do perf stat ${HOME}/hbase/bin/hbase --config $HOME/conf_hbase org.apache.hadoop.hbase.regionserver.wal.HLogPerformanceEvaluation -threads $i -iterations 100000 -key\nSize 50 -valueSize 100 &> \"/tmp/$1.${i}.${j}.txt\"; done; done{code}\n\nIt was writing small HDFS cluster.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-07T00:52:49.750+0000","updated":"2014-11-07T00:52:49.750+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14201408","id":"14201408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"h7358_20141106.patch: releases arrays during close.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-07T01:46:39.167+0000","updated":"2014-11-07T01:46:39.167+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14201585","id":"14201585","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12680047/h7358_20141106.patch\n  against trunk revision ae71a67.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.hdfs.TestHFlush\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/8685//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/8685//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-07T04:31:22.149+0000","updated":"2014-11-07T04:31:22.149+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14201643","id":"14201643","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"A few comments:\n\n+    private volatile boolean isClosed = false;\n\n'isClosed' is name of the method in javabeany-speak.  Rename 'closed'\n\nIs 'State' the right name for this inner class that carries state-of-stream-close and stuff to run on close?  CloseState?  Or CloseAndCleanup. Do you need this class?  It can't just be a method to call on close?\n\nOtherwise looks good. I can test the patch later...\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-07T05:45:24.937+0000","updated":"2014-11-07T05:45:24.937+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14202616","id":"14202616","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> Is 'State' the right name for this inner class that carries state-of-stream-close and stuff to run on close? ...  Do you need this class? It can't just be a method to call on close?\n \nDFSOutputStream is big and lack of organization.  It has 30+ fields in DFSOutputSteam alone, not counting inner classes such as DataStreamer. I think it is better separate to group the fields describing the state of the stream together.  Since I am not going to move the other fields for the moment, let's keep \"closed\" as a field.  Here is a new patch.\n\nh7358_20141107.patch\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-07T20:38:42.693+0000","updated":"2014-11-07T20:38:42.693+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14202635","id":"14202635","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"[~stack], have you changed dfs.bytes-per-checksum in your test?  What is version of Hadoop?\n{code}\n2014-11-04 16:55:57,202 DEBUG [sync.0] util.ByteArrayManager: allocate(65565): count=60367, aboveThreshold, [131072: 9998/10000, free=1], recycled? true\n{code}\nI wonder why it allocates a 65565 (> 64kB) array.  See also HDFS-7308.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-07T20:47:25.829+0000","updated":"2014-11-07T20:47:25.829+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14202890","id":"14202890","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12680257/h7358_20141107.patch\n  against trunk revision 06b7979.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.hdfs.server.balancer.TestBalancer\n\n                                      The following test timeouts occurred in hadoop-hdfs-project/hadoop-hdfs:\n\norg.apache.hadoop.hdfs.TestParallelShortCircuitReadUnCached\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/8693//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/8693//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-07T22:59:40.101+0000","updated":"2014-11-07T22:59:40.101+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14202953","id":"14202953","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12680257/h7358_20141107.patch\n  against trunk revision 06b7979.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.hdfs.TestHFlush\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/8692//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/8692//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-07T23:44:55.340+0000","updated":"2014-11-07T23:44:55.340+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14203603","id":"14203603","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"h7358_20141108.patch: fixes TestHFlush failure.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-08T21:36:33.853+0000","updated":"2014-11-08T21:36:33.853+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14203698","id":"14203698","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12680428/h7358_20141108.patch\n  against trunk revision 737d928.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:red}-1 findbugs{color}.  The patch appears to introduce 1 new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/8699//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-HDFS-Build/8699//artifact/patchprocess/newPatchFindbugsWarningshadoop-hdfs.html\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/8699//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-09T00:42:51.953+0000","updated":"2014-11-09T00:42:51.953+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14203719","id":"14203719","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Something wrong with test-patch?  This is no findbugs warning in the given newPatchFindbugsWarningshadoop-hdfs.html.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-09T01:28:26.921+0000","updated":"2014-11-09T01:28:26.921+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14204987","id":"14204987","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"In hbase we do 16k dfs.bytes-per-checksum Thanks for filing the 64k issue. I was going to ask. Instead let me dig and try and add findings to new issue.\n\nI tried the patch on my little rig and it works; no more getting stuck.\n\nWe need all this new synchronization on Packet? Any chance of instead tracing to figure where a Packet might be referenced (and we'd go writeData to the released internal buf) after its been closed? (Is this how you fixed TestHFlush?)\n\nnit: rename setClosed to close if you end up making a new patch.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-10T16:59:14.504+0000","updated":"2014-11-10T16:59:14.504+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14205685","id":"14205685","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> We need all this new synchronization on Packet? ...\n\nTestHFlush calls write(..), interrupts the thread and then calls close().  Write(..) simply puts data to the packet queue and DataStreamer, a separated thread, will get the packets from the queue and then write it to socket.  Now, we set buf to null during close.  DataStreamer may get NPE when accessing the data.  So the synchronization is required.\n\n> nit: rename setClosed to close if you end up making a new patch.\n\nWe already has close(), which is the public user API for closing the stream.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-11T00:42:51.664+0000","updated":"2014-11-11T00:42:51.664+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14206049","id":"14206049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. So the synchronization is required.\n\nWhat of Packet#writeTo did the buffer release?\n\nbq. We already has close(), which is the public user API for closing the stream.\n\nOk.\n\nHere's a few numbers:\n\nWith the feature turned off:\n\n||threads||seconds||ops/second||\n|10|133.662|7481.558|\n|10|133.599|7485.086|\n|10|134.046|7460.125|\n|20|140.972|14187.215|\n|20|141.949|14089.566|\n|20|140.861|14198.395|\n|100|153.941|64959.953|\n|100|153.751|65040.223|\n|100|153.372|65200.953|\n\nWith version of patch that does NOT synchronize Packet:\n\n||threads||seconds||ops/second||\n|10|126.219|7922.737|\n|10|127.792|7825.216|\n|10|124.829|8010.959|\n|20|138.132|14478.904|\n|20|137.051|14593.108|\n|20|139.604|14326.236|\n|100|149.311|66974.297|\n|100|149.849|66733.844|\n|100|149.537|66873.078|\n\nHere is latest patch numbers:\n\n||threads||seconds||ops/second||\n|10|127.079|7869.121|\n|10|128.357|7790.771|\n|10|129.122|7744.614|\n|20|135.525|14757.426|\n|20|139.531|14333.731|\n|20|135.595|14749.807|\n|100|149.802|66754.781|\n|100|149.262|66996.289|\n|100|149.925|66700.016|\n\nThreads in above are client threads. Actual number of writing and syncing threads stays constant at 1 and 5.  More threads just means more writing per second.\n\nComparing the last run of 100 threads with the feature off vs the last run of the latest patch I see more stalls, about same instructions per cycle but less cycles so it comes out a bit better.\n\nPerf summary on unpatched run:\n{code}\n Performance counter stats for '/home/stack/hbase/bin/hbase --config /home/stack/conf_hbase org.apache.hadoop.hbase.regionserver.wal.HLogPerformanceEvaluation -threads 100 -iterations 100000 -keySize 50 -valueSize 100':\n\n     587172.254075 task-clock                #    3.666 CPUs utilized\n        18,700,961 context-switches          #    0.032 M/sec\n         4,596,456 CPU-migrations            #    0.008 M/sec\n           650,547 page-faults               #    0.001 M/sec\n   891,035,644,874 cycles                    #    1.518 GHz                     [83.31%]\n   674,789,502,548 stalled-cycles-frontend   #   75.73% frontend cycles idle    [83.32%]\n   400,621,650,589 stalled-cycles-backend    #   44.96% backend  cycles idle    [66.74%]\n   422,912,592,386 instructions              #    0.47  insns per cycle\n                                             #    1.60  stalled cycles per insn [83.41%]\n    78,498,471,337 branches                  #  133.689 M/sec                   [83.37%]\n     2,768,724,048 branch-misses             #    3.53% of all branches         [83.26%]\n\n     160.168742742 seconds time elapsed\n{code}\n\nHere is patched version perf output.\n{code}\n Performance counter stats for '/home/stack/hbase/bin/hbase --config /home/stack/conf_hbase org.apache.hadoop.hbase.regionserver.wal.HLogPerformanceEvaluation -threads 100 -iterations 100000 -keySize 50 -valueSize 100':\n\n     556038.390042 task-clock                #    3.550 CPUs utilized\n        18,699,748 context-switches          #    0.034 M/sec\n         4,534,830 CPU-migrations            #    0.008 M/sec\n           636,724 page-faults               #    0.001 M/sec\n   843,860,285,154 cycles                    #    1.518 GHz                     [83.29%]\n   642,851,753,015 stalled-cycles-frontend   #   76.18% frontend cycles idle    [83.34%]\n   384,260,620,446 stalled-cycles-backend    #   45.54% backend  cycles idle    [66.66%]\n   392,462,867,299 instructions              #    0.47  insns per cycle\n                                             #    1.64  stalled cycles per insn [83.36%]\n    71,358,339,182 branches                  #  128.333 M/sec                   [83.43%]\n     2,712,426,902 branch-misses             #    3.80% of all branches         [83.29%]\n\n     156.646653202 seconds time elapsed\n{code}\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-11T06:57:21.003+0000","updated":"2014-11-11T06:57:21.003+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14207446","id":"14207446","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> What of Packet#writeTo did the buffer release?\n\nPacket#writeTo writes data from the buffer to the socket.\n\nThanks for testing the patch.  Do you think the patch is good to go?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-12T00:55:19.000+0000","updated":"2014-11-12T00:55:19.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14207490","id":"14207490","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Packet#writeTo writes data from the buffer to the socket.\n\nYes. Could it release the buffer when it is done writing? Then could undo the synchronizations on Packet?\n\nNo biggie though. The extra synchronization barely shows in my macro numbers posted above.\n\nbq. Do you think the patch is good to go?\n\nIt fixes the reported issue. +1.\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-12T01:32:48.537+0000","updated":"2014-11-12T01:32:48.537+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14207544","id":"14207544","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> ... Could it release the buffer when it is done writing? ...\n\nI did it in some early patches but it did not work.  The packet transfer might fail.  When it fails, we need to re-send the packet.  So that we cannot release buffer until we receive the ack.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-12T02:11:56.236+0000","updated":"2014-11-12T02:11:56.236+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14207621","id":"14207621","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. I did it in some early patches but it did not work. The\n\nOk. Thanks. +1 then.  According to the macro numbers above, the difference is little if anything between no-sync and sync on Packet (latest patch and the just previous):\n\n{code}\n Performance counter stats for '/home/stack/hbase/bin/hbase --config /home/stack/conf_hbase org.apache.hadoop.hbase.regionserver.wal.HLogPerformanceEvaluation -threads 100 -iterations 100000 -keySize 50 -valueSize 100':\n\n     560533.518789 task-clock                #    3.583 CPUs utilized\n        18,884,751 context-switches          #    0.034 M/sec\n         4,651,373 CPU-migrations            #    0.008 M/sec\n           649,422 page-faults               #    0.001 M/sec\n   849,474,024,940 cycles                    #    1.515 GHz                     [83.31%]\n   647,838,434,834 stalled-cycles-frontend   #   76.26% frontend cycles idle    [83.27%]\n   390,806,881,663 stalled-cycles-backend    #   46.01% backend  cycles idle    [66.68%]\n   395,809,837,047 instructions              #    0.47  insns per cycle\n                                             #    1.64  stalled cycles per insn [83.34%]\n    72,112,316,041 branches                  #  128.649 M/sec                   [83.35%]\n     2,658,785,438 branch-misses             #    3.69% of all branches         [83.40%]\n\n     156.430287629 seconds time elapsed\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-12T03:20:36.035+0000","updated":"2014-11-12T03:20:36.035+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14211260","id":"14211260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Stack for reporting, reviewing and testing this.\n\nI have committed this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-13T20:36:46.518+0000","updated":"2014-11-13T20:36:46.518+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14211264","id":"14211264","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-trunk-Commit #6538 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/6538/])\nHDFS-7358. Clients may get stuck waiting when using ByteArrayManager. (szetszwo: rev 394ba94c5d2801fbc5d95c7872eeeede28eed1eb)\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSOutputStream.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/util/ByteArrayManager.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/util/TestByteArrayManager.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestHFlush.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-13T20:41:05.153+0000","updated":"2014-11-13T20:41:05.153+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14212165","id":"14212165","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #5 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/5/])\nHDFS-7358. Clients may get stuck waiting when using ByteArrayManager. (szetszwo: rev 394ba94c5d2801fbc5d95c7872eeeede28eed1eb)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestHFlush.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/util/ByteArrayManager.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSOutputStream.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/util/TestByteArrayManager.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-14T11:32:59.156+0000","updated":"2014-11-14T11:32:59.156+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14212194","id":"14212194","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hadoop-Yarn-trunk #743 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/743/])\nHDFS-7358. Clients may get stuck waiting when using ByteArrayManager. (szetszwo: rev 394ba94c5d2801fbc5d95c7872eeeede28eed1eb)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/util/TestByteArrayManager.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/util/ByteArrayManager.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestHFlush.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSOutputStream.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-14T11:52:01.397+0000","updated":"2014-11-14T11:52:01.397+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14212286","id":"14212286","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hadoop-Hdfs-trunk #1933 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1933/])\nHDFS-7358. Clients may get stuck waiting when using ByteArrayManager. (szetszwo: rev 394ba94c5d2801fbc5d95c7872eeeede28eed1eb)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/util/TestByteArrayManager.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestHFlush.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSOutputStream.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/util/ByteArrayManager.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-14T14:18:16.233+0000","updated":"2014-11-14T14:18:16.233+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14212299","id":"14212299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hadoop-Hdfs-trunk-Java8 #5 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/5/])\nHDFS-7358. Clients may get stuck waiting when using ByteArrayManager. (szetszwo: rev 394ba94c5d2801fbc5d95c7872eeeede28eed1eb)\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/util/ByteArrayManager.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/util/TestByteArrayManager.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestHFlush.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSOutputStream.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-14T14:19:19.309+0000","updated":"2014-11-14T14:19:19.309+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14212363","id":"14212363","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Mapreduce-trunk #1957 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1957/])\nHDFS-7358. Clients may get stuck waiting when using ByteArrayManager. (szetszwo: rev 394ba94c5d2801fbc5d95c7872eeeede28eed1eb)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/util/TestByteArrayManager.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSOutputStream.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/util/ByteArrayManager.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestHFlush.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-14T15:17:01.378+0000","updated":"2014-11-14T15:17:01.378+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12752904/comment/14212388","id":"14212388","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hadoop-Mapreduce-trunk-Java8 #5 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/5/])\nHDFS-7358. Clients may get stuck waiting when using ByteArrayManager. (szetszwo: rev 394ba94c5d2801fbc5d95c7872eeeede28eed1eb)\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/util/ByteArrayManager.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestHFlush.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/util/TestByteArrayManager.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSOutputStream.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-11-14T15:25:12.739+0000","updated":"2014-11-14T15:25:12.739+0000"}],"maxResults":50,"total":50,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7358/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i21z3r:"}}