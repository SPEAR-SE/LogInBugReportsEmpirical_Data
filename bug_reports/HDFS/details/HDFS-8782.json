{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12845299","self":"https://issues.apache.org/jira/rest/api/2/issue/12845299","key":"HDFS-8782","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2015-09-11T03:58:52.610+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Mar 31 10:05:35 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_22440124546_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2016-03-31T10:05:34.990+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-8782/watchers","watchCount":19,"isWatching":false},"created":"2015-07-15T16:43:30.590+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12462373","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12462373","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12837110","key":"HDFS-8578","self":"https://issues.apache.org/jira/rest/api/2/issue/12837110","fields":{"summary":"On upgrade, Datanode should process all storage/data dirs in parallel","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}},{"id":"12431137","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12431137","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12845740","key":"HDFS-8791","self":"https://issues.apache.org/jira/rest/api/2/issue/12845740","fields":{"summary":"block ID-based DN storage layout can be very slow for datanode on ext4","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12447774","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12447774","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12837110","key":"HDFS-8578","self":"https://issues.apache.org/jira/rest/api/2/issue/12837110","fields":{"summary":"On upgrade, Datanode should process all storage/data dirs in parallel","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}},{"id":"12430917","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12430917","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"inwardIssue":{"id":"12718250","key":"HDFS-6482","self":"https://issues.apache.org/jira/rest/api/2/issue/12718250","fields":{"summary":"Use block ID-based block layout on datanodes","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-03-31T10:05:35.066+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"We have seen multiple incidents at production sites that there are long delays for DNs to register to the NN when upgrading to post 2.6 release.\n\nFurther investigation shows that the DN is blocked when upgrading the storage layout introduced in HDFS-6482. The new storage layout requires making up to 64k directories in the underlying file system. Unfortunately the current implementation calls {{mkdirs()}} sequentially and upgrades each volume in sequential order.\n\nAs a result, upgrading a DN with a lot of disks or with blocks that have random block ID takes a long time (usually in hours), and the DN won't register to the NN unless it finishes upgrading all the storage directory. The excessive delays confuse operations and break the assumption of rolling upgrades.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Upgrade to block ID-based DN storage layout delays DN registration","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wheat9","name":"wheat9","key":"wheat9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haohui Mai","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wheat9","name":"wheat9","key":"wheat9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Haohui Mai","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845299/comment/14740128","id":"14740128","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Apache9","name":"Apache9","key":"apache9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=apache9&avatarId=21678","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=apache9&avatarId=21678","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=apache9&avatarId=21678","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=apache9&avatarId=21678"},"displayName":"Duo Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"I think at least we could upgrade each volume parallel?\n\nI tried upgrading from 2.5.0 to 2.7.1. It spent more than 20 minutes on a 3T * 11 datanode... If parallel, the halt time could reduce to 2 minutes I think?\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Apache9","name":"Apache9","key":"apache9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=apache9&avatarId=21678","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=apache9&avatarId=21678","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=apache9&avatarId=21678","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=apache9&avatarId=21678"},"displayName":"Duo Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-09-11T03:58:52.610+0000","updated":"2015-09-11T03:58:52.610+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845299/comment/14989130","id":"14989130","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Apache9","name":"Apache9","key":"apache9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=apache9&avatarId=21678","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=apache9&avatarId=21678","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=apache9&avatarId=21678","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=apache9&avatarId=21678"},"displayName":"Duo Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"I tried to make {{DataStorage.addStorageLocations}} run parallelly but I found it is difficult.\n\nThere are some properties in {{DataStorage}}(inherit from {{StorageInfo}}) which will be updated when loading {{StorageDirectory}}, such as {{layoutVersion}}, so it may have side effect when changing the code from sequential to parallel even if I use lock everywhere to protect these properties.\n\nI do not get the point why we need a {{layoutVersion}} in {{DataStorage}}? As far as I know, {{DataStorage}} is only a container of {{StorageDirectory}} or {{BlockPoolSliceStorage}} if federation is enabled. So what does the {{layoutVersion}} in {{DataStorage}} mean? Is there any history reason for keeping it?\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Apache9","name":"Apache9","key":"apache9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=apache9&avatarId=21678","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=apache9&avatarId=21678","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=apache9&avatarId=21678","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=apache9&avatarId=21678"},"displayName":"Duo Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-11-04T08:43:27.409+0000","updated":"2015-11-04T08:43:27.409+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845299/comment/14989160","id":"14989160","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"body":"HDFS-8578, is also related to upgrade in parallel.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-11-04T09:03:25.076+0000","updated":"2015-11-04T09:03:25.076+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845299/comment/15219536","id":"15219536","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"body":"Since HDFS-8578 is resolved now, can we close this as duplicate?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-03-31T07:53:52.903+0000","updated":"2016-03-31T07:53:52.903+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845299/comment/15219664","id":"15219664","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Apache9","name":"Apache9","key":"apache9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=apache9&avatarId=21678","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=apache9&avatarId=21678","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=apache9&avatarId=21678","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=apache9&avatarId=21678"},"displayName":"Duo Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Apache9","name":"Apache9","key":"apache9","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=apache9&avatarId=21678","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=apache9&avatarId=21678","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=apache9&avatarId=21678","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=apache9&avatarId=21678"},"displayName":"Duo Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-03-31T09:38:30.037+0000","updated":"2016-03-31T09:38:30.037+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12845299/comment/15219697","id":"15219697","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"body":"Resolved as dup of HDFS-8578.\nFeel free to re-open if it doesnt serve the purpose.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-03-31T10:05:35.052+0000","updated":"2016-03-31T10:05:35.052+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-8782/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2hag7:"}}