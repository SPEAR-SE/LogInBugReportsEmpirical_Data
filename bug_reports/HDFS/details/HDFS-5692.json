{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12685885","self":"https://issues.apache.org/jira/rest/api/2/issue/12685885","key":"HDFS-5692","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2016-11-09T02:09:48.449+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Nov 16 02:51:58 UTC 2016","customfield_12310420":"364906","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_91085934696_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2016-11-09T02:18:34.498+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-5692/watchers","watchCount":3,"isWatching":false},"created":"2013-12-20T20:39:39.988+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325049","id":"12325049","description":"2.2.0 release","name":"2.2.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-11-16T02:51:58.473+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312928","id":"12312928","name":"hdfs-client"}],"timeoriginalestimate":null,"description":"With the following config, if I call fs.listStatus(\"/nn1/a/b\") when {{/nn1/a/b}} does not exist then ...\n\n{noformat}\n<configuration>\n  <property>\n    <name>fs.default.name</name>\n    <value>viewfs:///</value>\n  </property>\n  <property>\n    <name>fs.viewfs.mounttable.default.link./nn1</name>\n    <value>hdfs://host1:9000</value>\n  </property>\n  <property>\n    <name>fs.viewfs.mounttable.default.link./nn2</name>\n    <value>hdfs://host2:9000</value>\n  </property>\n</configuration>\n{noformat}\n\nI will see an error message like the following.  \n\n{noformat}\njava.io.FileNotFoundException: File /a/b does not exist.\n        at org.apache.hadoop.hdfs.DistributedFileSystem.listStatusInternal(DistributedFileSystem.java:644)\n        at org.apache.hadoop.hdfs.DistributedFileSystem.access$600(DistributedFileSystem.java:92)\n        at org.apache.hadoop.hdfs.DistributedFileSystem$14.doCall(DistributedFileSystem.java:702)\n        at org.apache.hadoop.hdfs.DistributedFileSystem$14.doCall(DistributedFileSystem.java:698)\n        at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)\n        at org.apache.hadoop.hdfs.DistributedFileSystem.listStatus(DistributedFileSystem.java:698)\n        at org.apache.hadoop.fs.FilterFileSystem.listStatus(FilterFileSystem.java:222)\n        at org.apache.hadoop.fs.viewfs.ChRootedFileSystem.listStatus(ChRootedFileSystem.java:228)\n        at org.apache.hadoop.fs.viewfs.ViewFileSystem.listStatus(ViewFileSystem.java:366)\n{noformat}\n\nI think it would be useful for ViewFS to wrap the FileNotFoundException from the inner filesystem, giving an error message like the following.  The following error message has the resolved and unresolved paths which is very useful for debugging.\n\n{noformat}\njava.io.FileNotFoundException: File /nn1/a/b does not exist.\n        at org.apache.hadoop.fs.viewfs.ViewFileSystem.listStatus(ViewFileSystem.java:366)\nCaused by: java.io.FileNotFoundException: File /a/b does not exist.\n        at org.apache.hadoop.hdfs.DistributedFileSystem.listStatusInternal(DistributedFileSystem.java:644)\n        at org.apache.hadoop.hdfs.DistributedFileSystem.access$600(DistributedFileSystem.java:92)\n        at org.apache.hadoop.hdfs.DistributedFileSystem$14.doCall(DistributedFileSystem.java:702)\n        at org.apache.hadoop.hdfs.DistributedFileSystem$14.doCall(DistributedFileSystem.java:698)\n        at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)\n        at org.apache.hadoop.hdfs.DistributedFileSystem.listStatus(DistributedFileSystem.java:698)\n        at org.apache.hadoop.fs.FilterFileSystem.listStatus(FilterFileSystem.java:222)\n        at org.apache.hadoop.fs.viewfs.ChRootedFileSystem.listStatus(ChRootedFileSystem.java:228)\n        at org.apache.hadoop.fs.viewfs.ViewFileSystem.listStatus(ViewFileSystem.java:366)\n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"365206","customfield_12312823":null,"summary":"viewfs shows resolved path in FileNotFoundException","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kturner","name":"kturner","key":"kturner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keith Turner","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kturner","name":"kturner","key":"kturner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Keith Turner","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685885/comment/15649552","id":"15649552","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"body":"[~kturner],\n\nThis sounds useful. Apps invoking vfs.listStatus() will get to see the VFS paths in the exception and not the internal paths. It is also very important to throw FileNotFoundException() whenever paths being accessed are not found. \n\nBut, FileNotFoundException unfortunately doesn't accept a throwable. So, throwing a nested FileNotFoundException as you suggested is not possible. If you a way of throwing this nested FileNotFoundException, please let me know.\n\nWe can throw an IOException carrying VFS path details and nested with FileNotFoundException carrying internal path details. But that will violate the contract of listStatus() API.  Unlike APIs, shell commands throw errors with VFS paths and not internal paths. \n\n{noformat}\njava.io.IOException: File /nn1/a/b does not exist.\n        at org.apache.hadoop.fs.viewfs.ViewFileSystem.listStatus(ViewFileSystem.java:366)\nCaused by: java.io.FileNotFoundException: File /a/b does not exist.\n        at org.apache.hadoop.hdfs.DistributedFileSystem.listStatusInternal(DistributedFileSystem.java:644)\n        at org.apache.hadoop.hdfs.DistributedFileSystem.access$600(DistributedFileSystem.java:92)\n        at org.apache.hadoop.hdfs.DistributedFileSystem$14.doCall(DistributedFileSystem.java:702)\n{noformat}\n\nIn order to retain the right contract of throwing FileNotFoundException for listStatus() API, I am inclined to close this bug as wont fix. Please let me know if you think otherwise. Would love to hear if there are ways to nest FileNotFoundException. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-11-09T02:09:48.449+0000","updated":"2016-11-09T02:17:37.445+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685885/comment/15658103","id":"15658103","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpallas","name":"jpallas","key":"jpallas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joe Pallas","active":true,"timeZone":"America/Los_Angeles"},"body":"Make a subclass of FileNotFoundException that calls initCause with the wrapped FileNotFoundException?  Seems like that would work and still satisfy the contract.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpallas","name":"jpallas","key":"jpallas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joe Pallas","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-11-11T20:32:16.708+0000","updated":"2016-11-11T20:32:16.708+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685885/comment/15659241","id":"15659241","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for the comment. Yes, it is possible to create a new exception by extending FileNotFoundException and later doing initCause(). The only problem here is the top level exception will again be the custom one and not the FileNotFoundException. try/catch would still work though. The reluctance to go this route is that the new custom exception is not a well known one and would end up more specific to {{listStatus}} API. Would be preferable to throw either the well known Exceptions or the other FileSystem/ViewFileSystem publicly exposed ones. There is {{NotInMointPointException}} which is already available under {{ViewFileSystem}} and closest match for the errors relating to {{Path}}. The current definition of {{NotInMountPointException}} doesn't accept a throwable, but it should be doable. The real question here is would any other Exception match the correctness as in FileNotFoundException. Any further thoughts on this please ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-11-12T07:50:01.265+0000","updated":"2016-11-12T07:50:01.265+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685885/comment/15662827","id":"15662827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpallas","name":"jpallas","key":"jpallas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joe Pallas","active":true,"timeZone":"America/Los_Angeles"},"body":"As you say, try/catch (and {{instanceOf}}) would work as expected if the implementation threw a subclass of {{FileNotFoundException}}.  Unless someone was calling {{getClass()}} on a caught exception to check for the actual implementation class, it seems the only visible effect would be the name that appears in log messages.  I personally wouldn't hesitate to use this approach in my own code, but that's just my view.\n\nI may be biased, but I think {{NotInMountPointException}} would be a misleading choice in this case, since its description says \"used in cases where the given path is not mounted through viewfs\".  That doesn't seem to be the case in the example, but I don't feel strongly about it.  (As a side note, it seems odd that {{NotInMountPointException}} extends {{UnsupportedOperationException}}; the reason for that is not discussed in HADOOP-8014.)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpallas","name":"jpallas","key":"jpallas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joe Pallas","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-11-14T05:33:43.846+0000","updated":"2016-11-14T05:35:49.511+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685885/comment/15669181","id":"15669181","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for the views. Yes, {{NotInMountPointException}} will be misleading as you explained.  On peer discussions I heard views against option 1. So, shall we wait a bit more to hear other alternatives before moving with Option 1 ?\n\nAnother option is, we can make {{ViewFileSystem#listStatus}} catch the FileNotFoundException and throw the same with a its version of Path which is not fully resolved. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-11-16T02:51:58.473+0000","updated":"2016-11-16T02:51:58.473+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-5692/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qwan:"}}