{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13138100","self":"https://issues.apache.org/jira/rest/api/2/issue/13138100","key":"HDFS-13139","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/10005","id":"10005","description":"Workaround","name":"Workaround"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Feb 19 05:34:00 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_509115325_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-02-19T05:34:00.575+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-13139/watchers","watchCount":0,"isWatching":false},"created":"2018-02-13T08:08:45.311+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["azureblob","cloudbreak","datanode","decommission","hdfs"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12333995","id":"12333995","description":"2.7.3 release","name":"2.7.3","archived":false,"released":true,"releaseDate":"2016-08-25"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-02-19T05:34:10.945+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312927","id":"12312927","name":"datanode"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12331106","id":"12331106","name":"fs/azure"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12329603","id":"12329603","name":"hdfs"}],"timeoriginalestimate":null,"description":"Configuring Azure WASB storage as a default HDFS location which means that Hadoop HDFS capacity will be 0. I have default replication as 1 but now when I am trying to decommission a node, datanode tries to rebalance some 28KB of data to another available datanode. However, our HDFS has 0 capacity and therefore, decommissioning fails with below given error:\r\n{code:java}\r\nNew node(s) could not be removed from the cluster. Reason Trying to move '28672' bytes worth of data to nodes with '0' bytes of capacity is not allowed{code}\r\nGetting the information on cluster shows that default local HDFS is still used for some KB space which is getting rebalanced whereas available capacity is 0:\r\n{code:java}\r\n\"CapacityRemaining\" : 0,\r\n \"CapacityTotal\" : 0,\r\n \"CapacityUsed\" : 131072,\r\n \"DeadNodes\" : \"{}\",\r\n \"DecomNodes\" : \"{}\",\r\n \"HeapMemoryMax\" : 1060372480,\r\n \"HeapMemoryUsed\" : 147668152,\r\n \"NonDfsUsedSpace\" : 0,\r\n \"NonHeapMemoryMax\" : -1,\r\n \"NonHeapMemoryUsed\" : 75319744,\r\n \"PercentRemaining\" : 0.0,\r\n \"PercentUsed\" : 100.0,\r\n \"Safemode\" : \"\",\r\n \"StartTime\" : 1518241019502,\r\n \"TotalFiles\" : 1,\r\n \"UpgradeFinalized\" : true,{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Default HDFS as Azure WASB tries rebalancing datanode data to HDFS (0% capacity) and fails","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhi.sakhuja","name":"abhi.sakhuja","key":"abhi.sakhuja","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=abhi.sakhuja&avatarId=34575","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=abhi.sakhuja&avatarId=34575","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=abhi.sakhuja&avatarId=34575","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=abhi.sakhuja&avatarId=34575"},"displayName":"Abhishek Sakhuja","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhi.sakhuja","name":"abhi.sakhuja","key":"abhi.sakhuja","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=abhi.sakhuja&avatarId=34575","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=abhi.sakhuja&avatarId=34575","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=abhi.sakhuja&avatarId=34575","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=abhi.sakhuja&avatarId=34575"},"displayName":"Abhishek Sakhuja","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13138100/comment/16368800","id":"16368800","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhi.sakhuja","name":"abhi.sakhuja","key":"abhi.sakhuja","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=abhi.sakhuja&avatarId=34575","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=abhi.sakhuja&avatarId=34575","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=abhi.sakhuja&avatarId=34575","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=abhi.sakhuja&avatarId=34575"},"displayName":"Abhishek Sakhuja","active":true,"timeZone":"Etc/UTC"},"body":"HDP default configuration had calculated non-HDFS reserved storage \"dfs.du.datanode.reserved\" (approx 3.5 %) on total disk for the lowest storage configured for a datanode (among the compute config groups) which had three drives and one drive was in TBs. Our default configuration to store data on datanode \"dfs.datanode.data.dir\" was pointing to a drive with lowest capacity (around 3 % of overall DN storage). This 3 % < 3.5 % had made HDFS capacity as 0% and our existing datanode storage had some supporting directories and files in KBs which had resulted in marking negative KB capacity of the datanode. To fix the downscaling issue, either, we need to lower down non hdfs reserved capacity (lower than 3 %) or point our datanode to higher disk capacity (greater than 3.5 %).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhi.sakhuja","name":"abhi.sakhuja","key":"abhi.sakhuja","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=abhi.sakhuja&avatarId=34575","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=abhi.sakhuja&avatarId=34575","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=abhi.sakhuja&avatarId=34575","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=abhi.sakhuja&avatarId=34575"},"displayName":"Abhishek Sakhuja","active":true,"timeZone":"Etc/UTC"},"created":"2018-02-19T05:34:00.622+0000","updated":"2018-02-19T05:34:00.622+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-13139/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3q41r:"}}