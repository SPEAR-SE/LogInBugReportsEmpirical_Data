{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12715210","self":"https://issues.apache.org/jira/rest/api/2/issue/12715210","key":"HDFS-6431","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2014-05-19 16:24:49.01","customfield_12310420":"393496","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-6431/watchers","watchCount":6,"isWatching":false},"created":"2014-05-19T16:24:49.010+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325049","id":"12325049","description":"2.2.0 release","name":"2.2.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-05-19T16:24:49.010+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12320700","id":"12320700","name":"snapshots","description":"HDFS snapshots"}],"timeoriginalestimate":null,"description":"Steps:\n1. Took a snapshot of HDFS directory:\n/orion/dogfood/\n\n2. Snapshot was successful.\n/orion/dogfood/.snapshot/20140517/\n\n3. Initiated copy of the snapshotted directory\nhadoop-2.2.0/bin/hdfs dfs -fs 192.168.2.239 -get /orion/dogfood/.snapshot/20140517 ~/tmp/copy\n\n4. Normally, this succeeds.  We have copied numerous (other) snapshots of this directory in the past.  But copying this particular snapshot gives the following error:\n\nget: Cannot open filename /orion/dogfood/.snapshot/20140517/cache/log-dogfood-20140513.111409-466b34cd-a488-4bd9-b1f2-a9f280e647c2\n\nAbove \"hdfs -get\" command fails with exit status 1.  Interestingly, this file was skipped and all other good files were copied.\n\n5. The file has zero length --\n$ hadoop-2.2.0/bin/hdfs 192.168.2.239 -ls /orion/dogfood/.snapshot/20140517/cache/log-dogfood-20140514.133924-132c3165-55c3-4908-ac19-31c61922205f \n\n-rw-r--r--   3 admin admin          0 2014-05-14 13:39 /orion/dogfood/.snapshot/20140517/cache/log-dogfood-20140514.133924-132c3165-55c3-4908-ac19-31c61922205f\n\n6. Trying to copy this file individually also gives same error --\n$ hadoop-2.2.0/bin/hdfs 192.168.2.239 -get /orion/dogfood/.snapshot/20140517/cache/log-dogfood-20140514.133924-132c3165-55c3-4908-ac19-31c61922205f /tmp/file\n\nget: Cannot open filename /orion/dogfood/.snapshot/20140517/cache/log-dogfood-20140514.133924-132c3165-55c3-4908-ac19-31c61922205f\n\n\nThis seems like a bug to me.  From looking at HDFS code, I made the following observations:\n\no DFSInputStream is receiving null \"LocatedBlocks\" for the source file:\nfinal LocatedBlocks newInfo = dfsClient.getLocatedBlocks(src, 0);\n\no This would happen when server returns GetLocatedBlocksResponse with \"locations\" not set, which can happen only if INodeFile.blocks is null for the file being opened.\n\nSo, it appears that for this file, blocks is null in this snapshot.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"393660","customfield_12312823":null,"summary":"File in snapshot tree is not readable due to null blocks","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhishekrai","name":"abhishekrai","key":"abhishekrai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhishek Rai","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abhishekrai","name":"abhishekrai","key":"abhishekrai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhishek Rai","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"2-node HDFS setup with hadoop-2.2.0.\nNamenode on node A and datanode on both nodes, A and B.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-6431/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1vrc7:"}}