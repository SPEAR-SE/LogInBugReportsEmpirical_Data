{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12653643","self":"https://issues.apache.org/jira/rest/api/2/issue/12653643","key":"HDFS-4918","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2013-06-19T05:03:06.891+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jun 19 19:59:28 UTC 2013","customfield_12310420":"333920","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_27949726_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-06-19T12:43:04.373+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-4918/watchers","watchCount":7,"isWatching":false},"created":"2013-06-19T04:57:14.668+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320353","id":"12320353","description":"hadoop-2.0.0-alpha release","name":"2.0.0-alpha","archived":false,"released":true,"releaseDate":"2012-05-23"}],"issuelinks":[{"id":"12370853","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12370853","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12653792","key":"HDFS-4919","self":"https://issues.apache.org/jira/rest/api/2/issue/12653792","fields":{"summary":"Improve documentation of dfs.permissions.enabled flag.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-06-19T19:59:28.174+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312928","id":"12312928","name":"hdfs-client"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"HDFS permisson check is incorrect, even if dfs.permissions is set false. it does look like this was caused by snap shot.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"334246","customfield_12312823":null,"summary":"HDFS permission check is incorrect","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687616","id":"13687616","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. it does look like this was caused by snap shot.\nAffects Version/s is set to 2.0.4-alpha. Snapshot feature is not in that release. Which release did you see this problem in?\n\nAlso can you add more details what you mean by permission check is incorrect.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-19T05:03:06.891+0000","updated":"2013-06-19T05:03:06.891+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687619","id":"13687619","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"body":"The issue (I don't think its snapshot related either) is that the NN RPC call of setPermission does not check the state of isPermissionsEnabled. The user thread for this report is http://search-hadoop.com/m/r91Yo1soPIp. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-06-19T05:14:39.900+0000","updated":"2013-06-19T05:14:39.900+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687620","id":"13687620","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"body":"I see this problem from trunk.\n\nHDFS operation works well, but when submit MR, I always get the following:\n{code}\nERROR security.UserGroupInformation: PriviledgedActionException as:root (auth:SIMPLE) cause:java.io.IOException: The ownership/permissions on the staging directory hdfs://webdm-cluster/data/hadoop/data/mapred/staging/root/.staging is not as expected. It is owned by root and permissions are rwxr-xr-x. The directory must be owned by the submitter root or by root and permissions must be rwx------\n\n{code}\n\nchown and chmod cannot solve the problem.\n\nso I read the code again. and get the following:\nFSPermissionChecker.java:\n\n{code}\n void checkPermission(String path, INodeDirectory root, boolean doCheckOwner,\n      FsAction ancestorAccess, FsAction parentAccess, FsAction access,\n      FsAction subAccess, boolean resolveLink)\n   final Snapshot snapshot = inodesInPath.getPathSnapshot();\n{code}\n\nthen:\n{code}\n  /** Guarded by {@link FSNamesystem#readLock()} */\n  private void check(INode inode, Snapshot snapshot, FsAction access\n      ) throws AccessControlException {\n    if (inode == null) {\n      return;\n    }\n    FsPermission mode = inode.getFsPermission(snapshot);\n\n    if (user.equals(inode.getUserName(snapshot))) { //user class\n      if (mode.getUserAction().implies(access)) { return; }\n    }\n    else if (groups.contains(inode.getGroupName(snapshot))) { //group class\n      if (mode.getGroupAction().implies(access)) { return; }\n    }\n    else { //other class\n      if (mode.getOtherAction().implies(access)) { return; }\n    }\n    throw new AccessControlException(\"Permission denied: user=\" + user\n        + \", access=\" + access + \", inode=\" + toAccessControlString(inode));\n  }\n{code}\n\n\nso , If snapshot is null, all permission check are all did by \"other class\".\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"created":"2013-06-19T05:16:54.046+0000","updated":"2013-06-19T05:16:54.046+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687622","id":"13687622","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"body":"If I am right, I can work on it for a patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"created":"2013-06-19T05:18:09.973+0000","updated":"2013-06-19T05:18:09.973+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687637","id":"13687637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> so, If snapshot is null, all permission check are all did by \"other class\".\n\nWhy?  When snapshot is null, inode.getUserName(snapshot) returns the current owner of the inode.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-19T05:50:02.297+0000","updated":"2013-06-19T05:50:02.297+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687641","id":"13687641","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"body":"bq.The issue (I don't think its snapshot related either) is that the NN RPC call of setPermission does not check the state of isPermissionsEnabled. The user thread for this report is http://search-hadoop.com/m/r91Yo1soPIp. \n\nI enabled permission in my test cluster. because \"dfs.permissions.enabled\" is true by default. then I cannot submit MR,\nso I don't think NN RPC call doesn't check \"dfs.permissions.enabled\". and I checked code again. It does check.\n\nafter submit MR, found on the job tracker.\n{code}\nFailure Info: Job initialization failed: org.apache.hadoop.security.AccessControlException: Permission denied: user=hadoop, access=EXECUTE, inode=\"/data/hadoop/data/mapred/system\":hadoop:supergroup:drwx------ at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.check(FSPermissionChecker.java:238) at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkTraverse(FSPermissionChecker.java:191) at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:154) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.checkPermission(FSNamesystem.java:4848) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.checkPermission(FSNamesystem.java:4830) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.checkAncestorAccess(FSNamesystem.java:4804) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFileInternal(FSNamesystem.java:1927) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFileInt(FSNamesystem.java:1870) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFile(FSNamesystem.java:1827) at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.create(NameNodeRpcServer.java:459) at \n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"created":"2013-06-19T05:53:16.751+0000","updated":"2013-06-19T05:53:16.751+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687644","id":"13687644","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prkommireddi","name":"prkommireddi","key":"prkommireddi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Kommireddi","active":true,"timeZone":"America/Los_Angeles"},"body":"Agree with Harsh, setPermissions needs to honor isPermissionsEnabled. This explanation might provide some more context to how it affects MR jobs (not really related to snapshots) http://search-hadoop.com/m/bKzZK1soPIp","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prkommireddi","name":"prkommireddi","key":"prkommireddi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Kommireddi","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-19T06:01:28.662+0000","updated":"2013-06-19T06:01:28.662+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687648","id":"13687648","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> The issue (I don't think its snapshot related either) is that the NN RPC call of setPermission does not check the state of isPermissionsEnabled. ...\n\nIf permission is disabled, user should not call setPermission/setOwner since setting them does not have the desired effect.  Perhaps we should throw some other exceptions such as IllegalStateException.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-19T06:03:21.854+0000","updated":"2013-06-19T06:03:21.854+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687652","id":"13687652","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prkommireddi","name":"prkommireddi","key":"prkommireddi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Kommireddi","active":true,"timeZone":"America/Los_Angeles"},"body":"> user should not call setPermission/setOwner since setting them does not have the desired effect.\n\nJust wanted to highlight, I think it's the framework that is actually making a call on setPermission when a MR job starts and not the user explicitly. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prkommireddi","name":"prkommireddi","key":"prkommireddi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Kommireddi","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-19T06:09:16.737+0000","updated":"2013-06-19T06:09:16.737+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687656","id":"13687656","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> ... This explanation might provide some more context to how it affects MR jobs ...\n\nOut of my curiosity, why disable permission in your cluster?  I beg most existing libraries such as the MR code assume permission is enabled and do not handle the case that permission is disabled.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-19T06:15:00.916+0000","updated":"2013-06-19T06:15:00.916+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687661","id":"13687661","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prkommireddi","name":"prkommireddi","key":"prkommireddi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Kommireddi","active":true,"timeZone":"America/Los_Angeles"},"body":"We don't have very tight security requirements on our cluster at this point, and it felt easier to disable the perms for now (that is how we also operated 0.20.2). In this case specifically, I don't think enabling perms would make a difference as there would be an issue with another user (other than the one that started the server) from writing to some directories? \n\nI guess the question is more about backward-compatibility and also if the feature (dfs.permissions.enabled) is actually expected to behave as its documented. We can turn on perms if required, but the issue still remains.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prkommireddi","name":"prkommireddi","key":"prkommireddi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Kommireddi","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-19T06:24:01.473+0000","updated":"2013-06-19T06:24:01.473+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687673","id":"13687673","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> I guess the question is more about backward-compatibility and also if the feature (dfs.permissions.enabled) is actually expected to behave as its documented. We can turn on perms if required, but the issue still remains.\n\nJust checked the branch-1 code, it is the same as trunk: setPermission(..)/setOwner(..) does not check isPermissionsEnabled; see http://svn.apache.org/viewvc/hadoop/common/branches/branch-1/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java?view=annotate\n\nThat part of HDFS code has not been changed for a long time.  So there is no compatibility issue in HDFS.  You may want to file a MR jira.\n\nAlso checked the documentation, it says that the current behavior is correct, i.e. setPermission(..)/setOwner(..) should always check permission.  Below is quoted from http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HdfsPermissionsGuide.html#Configuration_Parameters\n{quote}\n... Regardless of whether permissions are on or off, chmod, chgrp and chown always check permissions. These functions are only useful in the permissions context, and so there is no backwards compatibility issue. Furthermore, this allows administrators to reliably set owners and permissions in advance of turning on regular permissions checking.\n{quote}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-19T06:44:45.267+0000","updated":"2013-06-19T06:44:45.267+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687680","id":"13687680","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"body":"for exactly, My question is similar to this issue:\nhttps://issues.apache.org/jira/browse/MAPREDUCE-5112\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"created":"2013-06-19T06:56:30.842+0000","updated":"2013-06-19T06:56:30.842+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687694","id":"13687694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"body":"This was caused by fair-scheduler, not HDFS. Thanks.\n\nhttps://issues.apache.org/jira/browse/MAPREDUCE-4451\n\nThis was fixed in hadoop-1.2.0, then, should we close this issue?\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"created":"2013-06-19T07:05:17.486+0000","updated":"2013-06-19T07:05:17.486+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13687935","id":"13687935","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Fengdong, thanks for checking it.  Closing this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-19T12:43:04.390+0000","updated":"2013-06-19T12:43:04.390+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13688032","id":"13688032","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"body":"Add some addtional to avoid confusing, My testing cluster using HDFSv2,Commonv2 from trunk and Mapreducev1 from 1.1.2, so I can confirm this issue is fair scheduler caused.\n\nbut if MR is also from the trunk, then I am not sure the root cause is fair scheduler.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=azuryy","name":"azuryy","key":"azuryy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fengdong Yu","active":true,"timeZone":"Etc/UTC"},"created":"2013-06-19T14:24:30.598+0000","updated":"2013-06-19T14:24:30.598+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13688216","id":"13688216","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prkommireddi","name":"prkommireddi","key":"prkommireddi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Kommireddi","active":true,"timeZone":"America/Los_Angeles"},"body":"I am not using the FairScheduler, so the root cause must not be that. [~szetszwo] [~qwertymaniac] you guys feel this should be a MR issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prkommireddi","name":"prkommireddi","key":"prkommireddi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Kommireddi","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-19T17:54:30.793+0000","updated":"2013-06-19T17:54:30.793+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653643/comment/13688369","id":"13688369","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"{quote}\nAlso checked the documentation, it says that the current behavior is correct\n{quote}\n\nSince this caused confusion for a few of us, I filed HDFS-4919 to improve the documentation.  The first place I look for an explanation of a configuration property is hdfs-default.xml, and the description of dfs.permissions.enabled in there doesn't mention that permissions are still checked for some operations regardless of this setting.\n\nAlso, the HDFS permissions guide doc still mentions the deprecated dfs.permissions property instead of the newer dfs.permissions.enabled.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-19T19:59:28.174+0000","updated":"2013-06-19T19:59:28.174+0000"}],"maxResults":18,"total":18,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-4918/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1llpb:"}}