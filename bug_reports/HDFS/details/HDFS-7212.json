{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12746763","self":"https://issues.apache.org/jira/rest/api/2/issue/12746763","key":"HDFS-7212","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-10-30T08:03:45.996+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon May 09 16:58:13 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7212/watchers","watchCount":19,"isWatching":false},"created":"2014-10-08T17:12:05.388+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326143","id":"12326143","description":"2.4.0 release","name":"2.4.0","archived":false,"released":true,"releaseDate":"2014-04-07"}],"issuelinks":[{"id":"12403339","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12403339","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12700885","key":"HADOOP-10404","self":"https://issues.apache.org/jira/rest/api/2/issue/12700885","fields":{"summary":"Some accesses to DomainSocketWatcher#closed are not protected by lock","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12412089","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12412089","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12786165","key":"HDFS-7999","self":"https://issues.apache.org/jira/rest/api/2/issue/12786165","fields":{"summary":"FsDatasetImpl#createTemporary sometimes holds the FSDatasetImpl lock for a very long time","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12403453","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12403453","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12757325","key":"HADOOP-11333","self":"https://issues.apache.org/jira/rest/api/2/issue/12757325","fields":{"summary":"Fix deadlock in DomainSocketWatcher when the notification pipe is full","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-05-09T16:58:13.410+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/4","description":"This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/reopened.png","name":"Reopened","id":"4","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312927","id":"12312927","name":"datanode"}],"timeoriginalestimate":null,"description":"There are 3000 - 8000 threads in each datanode JVM, blocking the entire VM and rendering the service unusable, missing heartbeats and stopping data access. The threads look like this:\n\n{code}\n3415 (state = BLOCKED)\n\n- sun.misc.Unsafe.park(boolean, long) @bci=0 (Compiled frame; information may be imprecise)\n- java.util.concurrent.locks.LockSupport.park(java.lang.Object) @bci=14, line=186 (Compiled frame)\n- java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt() @bci=1, line=834 (Interpreted frame)\n- java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(java.util.concurrent.locks.AbstractQueuedSynchronizer$Node, int) @bci=67, line=867 (Interpreted frame)\n- java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(int) @bci=17, line=1197 (Interpreted frame)\n- java.util.concurrent.locks.ReentrantLock$NonfairSync.lock() @bci=21, line=214 (Compiled frame)\n- java.util.concurrent.locks.ReentrantLock.lock() @bci=4, line=290 (Compiled frame)\n- org.apache.hadoop.net.unix.DomainSocketWatcher.add(org.apache.hadoop.net.unix.DomainSocket, org.apache.hadoop.net.unix.DomainSocketWatcher$Handler) @bci=4, line=286 (Interpreted frame)\n- org.apache.hadoop.hdfs.server.datanode.ShortCircuitRegistry.createNewMemorySegment(java.lang.String, org.apache.hadoop.net.unix.DomainSocket) @bci=169, line=283 (Interpreted frame)\n- org.apache.hadoop.hdfs.server.datanode.DataXceiver.requestShortCircuitShm(java.lang.String) @bci=212, line=413 (Interpreted frame)\n- org.apache.hadoop.hdfs.protocol.datatransfer.Receiver.opRequestShortCircuitShm(java.io.DataInputStream) @bci=13, line=172 (Interpreted frame)\n- org.apache.hadoop.hdfs.protocol.datatransfer.Receiver.processOp(org.apache.hadoop.hdfs.protocol.datatransfer.Op) @bci=149, line=92 (Compiled frame)\n- org.apache.hadoop.hdfs.server.datanode.DataXceiver.run() @bci=510, line=232 (Compiled frame)\n- java.lang.Thread.run() @bci=11, line=744 (Interpreted frame)\n{code}\n\nHas anybody seen this before?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"FsDatasetImpl#createTemporary sometimes holds the FSDatasetImpl lock for a very long time","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=leccine","name":"leccine","key":"leccine","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Istvan Szukacs","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=leccine","name":"leccine","key":"leccine","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Istvan Szukacs","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"PROD","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/14189775","id":"14189775","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aderen","name":"aderen","key":"aderen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"ade","active":true,"timeZone":"Asia/Shanghai"},"body":"I met. Maybe duplicate of https://issues.apache.org/jira/browse/HDFS-7187 and https://issues.apache.org/jira/browse/HADOOP-10404","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aderen","name":"aderen","key":"aderen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"ade","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-10-30T08:03:45.996+0000","updated":"2014-10-30T08:03:45.996+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/14243178","id":"14243178","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm resolving this as a duplicate of HADOOP-10404, fixed in Apache Hadoop 2.6.0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-12-11T21:32:59.687+0000","updated":"2014-12-11T21:32:59.687+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/14244818","id":"14244818","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"This may also be HADOOP-11333.  In either case, I would say try with a later release with both fixes and verify that that fixes it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-12-12T21:38:46.185+0000","updated":"2014-12-12T21:38:46.185+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/14371275","id":"14371275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frha","name":"frha","key":"frha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frode Halvorsen","active":true,"timeZone":"Europe/Oslo"},"body":"Still a problem in 2.6.0.\n\nI have 6 datanodes in two racks. Periodically one or two nodes is 'suspended' with anything from 500 to 3000 blocked threads like this:\nDataXceiver for client  at /62.148.41.209:39602 [Receiving block BP-874555352-10.34.17.40-1403595404176:blk_1133797477_60059942]\nThe datanode is marked as dead and the namenode starts to replicate the bloks. After some time, the datanode suddenly comes back, and the namenode has to delete a lot of blocks again. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frha","name":"frha","key":"frha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frode Halvorsen","active":true,"timeZone":"Europe/Oslo"},"created":"2015-03-20T13:28:48.811+0000","updated":"2015-03-20T13:28:48.811+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/14371277","id":"14371277","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frha","name":"frha","key":"frha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frode Halvorsen","active":true,"timeZone":"Europe/Oslo"},"body":"Sometimes the datanoe dosen't come back by itself, and I have to restart it. Then even more blocks has too many replicas...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frha","name":"frha","key":"frha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frode Halvorsen","active":true,"timeZone":"Europe/Oslo"},"created":"2015-03-20T13:30:33.943+0000","updated":"2015-03-20T13:30:33.943+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/14371285","id":"14371285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Wondering if you were seeing the same thing as HADOOP-11333 which is fixed in 2.7.0.  Does the stacktrace in HADOOP-11333 match what you were seeing?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2015-03-20T13:41:53.788+0000","updated":"2015-03-20T13:41:53.788+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/14371926","id":"14371926","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frha","name":"frha","key":"frha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frode Halvorsen","active":true,"timeZone":"Europe/Oslo"},"body":"No. This is not the same. When I earlier experienced that the number of connections exceeded the maximum, I increased the maximum.\nMy issue is the same as in this bug-entry.\n\nMy datanodes runs fine with 70-80 threads, the suddenly one node with a lot of blocks just stops writing the recieved blocks , and the thread keeps hanging on the reciever. Then the threads just accumulate until I have at least 600 bloked threads. \nI get one more line like this for each thread :\n2015-03-20 20:15:56,102 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Receiving BP-874555352-10.34.17.40-1403595404176:blk_1120355987_46618200 src: /62.148.41.204:38037 dest: /62.148.41.209:50010\nBut it never reports the block recieved as it normally does. \nThen I can go in via MissionControl, and look at the thread.graph, ans find it rising massivly. after 650 secs, the name-node states that the datanode is dead, but it actually is not. I can stop/start metrics (via mbeans), and sometimes the datanode just flushes (kills) all blocked threads, and reconnects to the namenode. many times, however, I have to restart the datanode. It uses a good half hour on the step where it adds the blocks to the pool, and when it reconnets to the namenode, they first of all cleans up the over-replicated blocks. The namenode, of course, stosp all other processing when the datanode 'arrives', so any process adding files to the cluster is put 'on hold' by the namenode.\nVery often during the cleanup with one datanode, another starts the same process with just starting the recieve-thread, and piles up a few hundred of them i blocked state.\n\nMy stacktrace (on the blocked thred) is like this:\nDataXceiver for client  at /62.148.41.204:38919 [Receiving block BP-874555352-10.34.17.40-1403595404176:blk_1128803518_55065733] [51396] (BLOCKED)\n   org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsDatasetImpl.createTemporary line: 1226 \n   org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsDatasetImpl.createTemporary line: 114 \n   org.apache.hadoop.hdfs.server.datanode.BlockReceiver.<init> line: 179 \n   org.apache.hadoop.hdfs.server.datanode.DataXceiver.writeBlock line: 615 \n   org.apache.hadoop.hdfs.protocol.datatransfer.Receiver.opWriteBlock line: 137 \n   org.apache.hadoop.hdfs.protocol.datatransfer.Receiver.processOp line: 74 \n   org.apache.hadoop.hdfs.server.datanode.DataXceiver.run line: 235 \n   java.lang.Thread.run line: 745 \n\nAnd just now, my datanode has appx 700 of those threads. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=frha","name":"frha","key":"frha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frode Halvorsen","active":true,"timeZone":"Europe/Oslo"},"created":"2015-03-20T19:28:51.346+0000","updated":"2015-03-20T19:28:51.346+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/14382462","id":"14382462","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~Frode Halvorsen],\n\nThe thread is trying to take the {{FsDatasetImpl}} lock here:\n{code}\norg.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsDatasetImpl.createTemporary line: 1226 \n{code}\n\nAs you can see.  This is a synchronized method of {{FsDatasetImpl}}.\n\nCan you find the thread which is currently holding the {{FsDatasetImpl}} lock in your stack trace?  This will tell you which thread is the problem.\n\nAlso +1 for the suggestion of trying 2.7-SNAPSHOT to see if the issue is fixed there.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-26T19:06:07.914+0000","updated":"2015-03-26T19:06:07.914+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/14383378","id":"14383378","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sinago","name":"sinago","key":"sinago","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhouyingchao","active":true,"timeZone":"Etc/UTC"},"body":"I'm using 2.6 and also noticed that sometime DN's heartbeat were delayed for very long time, say more than 100 seconds.  I get the jstack twice and looks like they are all blocked by dataset lock, and which is held by a thread that is calling createTemporary, which is blocked to wait earlier incarnation writer to exit.  \n\n\"DataXceiver for client  at XXXXX\" daemon prio=10 tid=0x00007f14041e6480 nid=0x52bc in Object.wait() [0x00007f11d78f7000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n        at java.lang.Object.wait(Native Method)\n        at java.lang.Thread.join(Thread.java:1194)\n        - locked <0x00000007a33b85d8> (a org.apache.hadoop.util.Daemon)\n        at org.apache.hadoop.hdfs.server.datanode.ReplicaInPipeline.stopWriter(ReplicaInPipeline.java:183)\n        at org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsDatasetImpl.createTemporary(FsDatasetImpl.java:1231)\n        - locked <0x00000007b01428c0> (a org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsDatasetImpl)\n        at org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsDatasetImpl.createTemporary(FsDatasetImpl.java:114)\n        at org.apache.hadoop.hdfs.server.datanode.BlockReceiver.<init>(BlockReceiver.java:179)\n        at org.apache.hadoop.hdfs.server.datanode.DataXceiver.writeBlock(DataXceiver.java:615)\n        at org.apache.hadoop.hdfs.protocol.datatransfer.Receiver.opWriteBlock(Receiver.java:137)\n        at org.apache.hadoop.hdfs.protocol.datatransfer.Receiver.processOp(Receiver.java:74)\n        at org.apache.hadoop.hdfs.server.datanode.DataXceiver.run(DataXceiver.java:235)\n        at java.lang.Thread.run(Thread.java:662)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sinago","name":"sinago","key":"sinago","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhouyingchao","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-27T05:52:43.897+0000","updated":"2015-03-27T05:52:43.897+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/14383653","id":"14383653","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sinago","name":"sinago","key":"sinago","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhouyingchao","active":true,"timeZone":"Etc/UTC"},"body":"I'll create a JIRA for the issue I met and submit a patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sinago","name":"sinago","key":"sinago","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhouyingchao","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-27T10:53:52.165+0000","updated":"2015-03-27T10:53:52.165+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/14383654","id":"14383654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sinago","name":"sinago","key":"sinago","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhouyingchao","active":true,"timeZone":"Etc/UTC"},"body":"I'll create a JIRA for the issue I met and submit a patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sinago","name":"sinago","key":"sinago","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhouyingchao","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-27T10:53:54.610+0000","updated":"2015-03-27T10:53:54.610+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/14383655","id":"14383655","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sinago","name":"sinago","key":"sinago","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhouyingchao","active":true,"timeZone":"Etc/UTC"},"body":"I'll create a JIRA for the issue I met and submit a patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sinago","name":"sinago","key":"sinago","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhouyingchao","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-27T10:54:02.225+0000","updated":"2015-03-27T10:54:02.225+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/14383656","id":"14383656","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sinago","name":"sinago","key":"sinago","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhouyingchao","active":true,"timeZone":"Etc/UTC"},"body":"I'll create a JIRA for the issue I met and submit a patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sinago","name":"sinago","key":"sinago","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhouyingchao","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-27T10:54:10.377+0000","updated":"2015-03-27T10:54:10.377+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/15276037","id":"15276037","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajeshhadoop","name":"rajeshhadoop","key":"rajeshhadoop","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Chandramohan","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi ,\n\n We have this similar issue , where DN sockets getting stuck. ( Hadoop version 2.4.0)\n===\n# lsof /var/run/hadoop-hdfs/dn | wc -l \n6876 \n\njstack shows ==\nThread 5295: (state = BLOCKED) \n- sun.misc.Unsafe.park(boolean, long) @bci=0 (Compiled frame; information may be imprecise) \n- java.util.concurrent.locks.LockSupport.park(java.lang.Object) @bci=14, line=186 (Compiled frame) \n- java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await() @bci=42, line=2043 (Compiled frame) \n- org.apache.hadoop.net.unix.DomainSocketWatcher.add(org.apache.hadoop.net.unix.DomainSocket, org.apache.hadoop.net.unix.DomainSocketWatcher$Handler) @bci=99, line=316 (Interpreted frame) \n- org.apache.hadoop.hdfs.server.datanode.ShortCircuitRegistry.createNewMemorySegment(java.lang.String, org.apache.hadoop.net.unix.DomainSocket) @bci=169, line=283 (Interpreted frame) \n- org.apache.hadoop.hdfs.server.datanode.DataXceiver.requestShortCircuitShm(java.lang.String) @bci=212, line=413 (Interpreted frame) \n- org.apache.hadoop.hdfs.protocol.datatransfer.Receiver.opRequestShortCircuitShm(java.io.DataInputStream) @bci=13, line=172 (Interpreted frame) \n- org.apache.hadoop.hdfs.protocol.datatransfer.Receiver.processOp(org.apache.hadoop.hdfs.protocol.datatransfer.Op) @bci=149, line=92 (Compiled frame) \n- org.apache.hadoop.hdfs.server.datanode.DataXceiver.run() @bci=510, line=232 (Compiled frame) \n- java.lang.Thread.run() @bci=11, line=745 (Interpreted frame)\n\n All most 6k threads in this state, after a while DN gets hung. Do we have details regarding this issue. Any patch available for it. Looks like similar kind of issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajeshhadoop","name":"rajeshhadoop","key":"rajeshhadoop","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Chandramohan","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-09T07:07:51.888+0000","updated":"2016-05-09T07:07:51.888+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746763/comment/15276614","id":"15276614","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Hello [~rajeshhadoop].  Based on these symptoms, you'll probably be interested in multiple bug fixes in short-circuit read that went in after Apache Hadoop 2.4.0: HADOOP-11333, HADOOP-11604, HADOOP-11648, HADOOP-11802 and HDFS-8429.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-09T16:58:13.410+0000","updated":"2016-05-09T16:58:13.410+0000"}],"maxResults":15,"total":15,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7212/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i20xyv:"}}