{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12835354","self":"https://issues.apache.org/jira/rest/api/2/issue/12835354","key":"HDFS-8533","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-04-06T22:01:12.469+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 18 22:02:51 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-8533/watchers","watchCount":14,"isWatching":false},"created":"2015-06-04T10:26:13.327+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327584","id":"12327584","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"}],"issuelinks":[{"id":"12462960","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12462960","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12953483","key":"HDFS-10213","self":"https://issues.apache.org/jira/rest/api/2/issue/12953483","fields":{"summary":"there is a corrupt/missing block report, but fsck result is HEALTHY","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreina","name":"andreina","key":"andreina","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"J.Andreina","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-07-18T22:02:51.677+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"Number of DN = 2\nStep 1: Write a file with replication factor - 3 .\nStep 2: Corrupt a replica in DN1\nStep 3: DN2 is down. \n\nMissing Block count in  report is as follows\nFsck report                                    : *0*\nJmx, \"dfsadmin -report\" , UI, logs : *1*\n\nIn fsck , only block whose replicas are all missed and not been corrupted are counted \n{code}\nif (totalReplicasPerBlock == 0 && !isCorrupt) {\n        // If the block is corrupted, it means all its available replicas are\n        // corrupted. We don't mark it as missing given these available replicas\n        // might still be accessible as the block might be incorrectly marked as\n        // corrupted by client machines.\n{code}\n\nWhile in other reports even if all the replicas are corrupted , block is been considered as missed.\n\nPlease provide your thoughts : can we make missing block count consistent across all the reports same as implemented for fsck?\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Mismatch in displaying the \"MissingBlock\" count in fsck and in other metric reports","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreina","name":"andreina","key":"andreina","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"J.Andreina","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreina","name":"andreina","key":"andreina","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"J.Andreina","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12835354/comment/15229221","id":"15229221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jjmaestro","name":"jjmaestro","key":"jjmaestro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jjmaestro&avatarId=24805","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jjmaestro&avatarId=24805","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jjmaestro&avatarId=24805","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jjmaestro&avatarId=24805"},"displayName":"Javier Maestro","active":true,"timeZone":"America/Los_Angeles"},"body":"I've seen this issue as well, I'm running with a replication factor of 3 and I\nget alerts because the metrics in JMX report missing blocks but fsck doesn't\nsee any. Here's some relevant output from {{fsck}} and {{JMX}} (redacted for\nprivacy reasons):\n\n{code:title=hdfs fsck /}\n(...)\n................................................................Status: HEALTHY\n Minimally replicated blocks:   XXXX (99.99999 %)\n Over-replicated blocks:        0 (0.0 %)\n Under-replicated blocks:       XXXX (0.57755035 %)\n Mis-replicated blocks:         XXXX (0.1345275 %)\n Default replication factor:    3\n Average block replication:     2.9942245\n Corrupt blocks:                0\n Missing replicas:              XXXX (0.19251679 %)\n Number of data-nodes:          XXXX\n Number of racks:               X\n(...)\n{code}\n\n\n{code:title=JMX for Hadoop:service=NameNode,name=FSNamesystem}\n(...)\n\"name\": \"Hadoop:service=NameNode,name=FSNamesystem\",\n\"CorruptBlocks\": 9,\n\"MissingBlocks\": 9,\n(...)\n{code}\n\n{code:title=JMX for Hadoop:service=NameNode,name=NameNodeInfo}\n(...)\n\"name\": \"Hadoop:service=NameNode,name=NameNodeInfo\"\n\"NumberOfMissingBlocks\": 9,\n(...)\n{code}\n\n\nh2. TL;DR;\n\nh3. FSCK\n- {{fsck}}: goes over all of the blocks, one by one and:\n    - counts blocks as {{corrupt}} by querying {{LocatedBlock}}'s {{isCorrupt()}}\n    - count blocks as {{missing}} if {{totalReplicasPerBlock == 0 && !isCorrupt}}\n\n- {{fsck}} reports HEALTHY if there are no missing or corrupt blocks ({{L1078}})\n\n\nh3. JMX\n\nh4. CorruptBlocks\nThe internal metrics use {{CorruptReplicasMap}} which is ultimately updated via\n{{FSNamesystem}}'s {{reportBadBlocks()}}. This means that the client is\nreporting some bad block locations.\n\n\nThus, the mismatch is between what triggers the client to call\n{{reportBadBlocks()}} and {{LocatedBlock}}'s {{isCorrupt()}} for those blocks.\n\n\nLooking at who calls {{FSNamesystem}}'s {{reportBadBlocks()}}:\n\n{code:title=NameNodeRpcServer.java}\n 895   /**\n 896    * The client has detected an error on the specified located blocks.\n 897    * and is reporting them to the server.  For now, the namenode will.\n 898    * mark the block as corrupt.  In the future we might.\n 899    * check the blocks are actually corrupt..\n 900    */\n 901   @Override // ClientProtocol, DatanodeProtocol\n 902   public void reportBadBlocks(LocatedBlock[] blocks) throws IOException {\n 903     checkNNStartup();\n 904     namesystem.reportBadBlocks(blocks);\n 905   }\n{code}\n\nSo, unlike {{fsck}}, there is no check in there to filter blocks that are\nreported as being bad by the datanodes but that are actually not corrupt if you\ncheck {{LocatedBlock}}'s {{isCorrupt()}} after they've been received.\n\n\nh4. MissingBlocks\nThe outcome here is the same as {{CorruptBlocks}}, because the update to\n{{neededReconstruction}} ({{LowRedundancyBlocks}})also happens within\n{{markBlockAsCorrupt}}, by checking {{isPopulatingReplQueues()}}.\n\nThe internal metrics use this.neededReconstruction.getCorruptBnlockSize();\n\nThis is pretty broken if we compare it to the approach in {{fsck}} because we\nare counting corrupt blocks as missing while in {{fsck}}, only those with no\nreplicas are accounted.\n\nThis also helps understand why the {{CorruptBlocks}} always matches\n{{MissingBlocks}} in JMX.\n\n\nh3. Conclusion\n\nWhat I'd do is:\n\n- filter the bad blocks on reception, within {{NameNodeRpcServer.java}}'s\n  {{reportBadBlocks}} and only mark as bad those that pass {{LocatedBlock}}'s\n  {{isCorrupt()}}, like {{fsck}} already does.\n\n- Wishlist: keep track of the number of mis-reported blocks in the cell and/or\n  which datanodes mis-report blocks as being bad, since this will probably help\n  find out bugs and/or bad datanodes / hardware, etc.\n\n- make sure {{MissingBlocks}} are accounted in a similar fashion between\n  {{BlockManager}} (JMX) and {{NamenodeFsck}} ({{fsck}}). For the record, I\n  think {{fsck}} does The Right Thing (TM): count as {{missing}} only the\n  blocks that are completely unavailable *and* that are *not* corrupt.\n\n\nFinally, it'll be interesting to find out what triggers the Datanode to report\nbad blocks that are actually not bad. I'll dig deeper and see if there's\nsomething broken somewhere in my cluster :D","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jjmaestro","name":"jjmaestro","key":"jjmaestro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jjmaestro&avatarId=24805","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jjmaestro&avatarId=24805","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jjmaestro&avatarId=24805","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jjmaestro&avatarId=24805"},"displayName":"Javier Maestro","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-04-06T22:01:12.469+0000","updated":"2016-04-06T22:01:12.469+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12835354/comment/16029387","id":"16029387","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mdeguzis","name":"mdeguzis","key":"mdeguzis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mdeguzis&avatarId=31511","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mdeguzis&avatarId=31511","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mdeguzis&avatarId=31511","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mdeguzis&avatarId=31511"},"displayName":"Michael DeGuzis","active":true,"timeZone":"America/New_York"},"body":"Any update on this? I see the same behavior.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mdeguzis","name":"mdeguzis","key":"mdeguzis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mdeguzis&avatarId=31511","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mdeguzis&avatarId=31511","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mdeguzis&avatarId=31511","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mdeguzis&avatarId=31511"},"displayName":"Michael DeGuzis","active":true,"timeZone":"America/New_York"},"created":"2017-05-30T12:58:13.004+0000","updated":"2017-05-30T12:58:13.004+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12835354/comment/16264215","id":"16264215","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=easyoups","name":"easyoups","key":"easyoups","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"regis le bretonnic","active":true,"timeZone":"Europe/Paris"},"body":"I think, I'm concerned too on 2.7.3 using HDP 2.6\r\nAmbari reports a missing block (get from JMX) that I can't find with fsck.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=easyoups","name":"easyoups","key":"easyoups","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"regis le bretonnic","active":true,"timeZone":"Europe/Paris"},"created":"2017-11-23T11:34:34.355+0000","updated":"2017-11-23T11:34:34.355+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12835354/comment/16265015","id":"16265015","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=easyoups","name":"easyoups","key":"easyoups","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"regis le bretonnic","active":true,"timeZone":"Europe/Paris"},"body":"Hi\r\nAs fsck is ok, is there a way to identify the file or block raised as failed by JMX for trying to fix it manually ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=easyoups","name":"easyoups","key":"easyoups","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"regis le bretonnic","active":true,"timeZone":"Europe/Paris"},"created":"2017-11-24T07:44:14.790+0000","updated":"2017-11-24T07:44:14.790+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12835354/comment/16548459","id":"16548459","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jojochuang","name":"jojochuang","key":"jojochuang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jojochuang&avatarId=25508","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jojochuang&avatarId=25508","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jojochuang&avatarId=25508","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jojochuang&avatarId=25508"},"displayName":"Wei-Chiu Chuang","active":true,"timeZone":"America/Los_Angeles"},"body":"I've been trying to reproduce this bug following the description in this jira, without success.\r\n\r\nHere's my test code for future reference:\r\n{code:java}\r\n/** check if nn.getCorruptFiles() returns a file that has corrupted blocks */\r\n  @Test (timeout=300000)\r\n  public void testListCorruptFilesCorruptedBlock2() throws Exception {\r\n    MiniDFSCluster cluster = null;\r\n    Random random = new Random();\r\n\r\n    try {\r\n      Configuration conf = new HdfsConfiguration();\r\n      conf.setInt(DFSConfigKeys.DFS_DATANODE_DIRECTORYSCAN_INTERVAL_KEY, 1); // datanode scans directories\r\n      conf.setInt(DFSConfigKeys.DFS_BLOCKREPORT_INTERVAL_MSEC_KEY, 3 * 1000); // datanode sends block reports\r\n      // Set short retry timeouts so this test runs faster\r\n      conf.setInt(DFSConfigKeys.DFS_CLIENT_RETRY_WINDOW_BASE, 10);\r\n      // start 2 DNs\r\n      cluster = new MiniDFSCluster.Builder(conf).numDataNodes(2).build();\r\n      FileSystem fs = cluster.getFileSystem();\r\n\r\n      // create two files with one block each\r\n      DFSTestUtil util = new DFSTestUtil.Builder().\r\n          setName(\"testCorruptFilesCorruptedBlock\").setNumFiles(2).\r\n          setMaxLevels(1).setMaxSize(512).build();\r\n      util.createFiles(fs, \"/srcdat10\");\r\n\r\n      // Now deliberately corrupt one block\r\n      String bpid = cluster.getNamesystem().getBlockPoolId();\r\n      File storageDir = cluster.getInstanceStorageDir(0, 1);\r\n      File data_dir = MiniDFSCluster.getFinalizedDir(storageDir, bpid);\r\n      assertTrue(\"data directory does not exist\", data_dir.exists());\r\n      List<File> metaFiles = MiniDFSCluster.getAllBlockFiles(data_dir);\r\n      assertTrue(\"Data directory does not contain any blocks or there was an \"\r\n          + \"IO error\", metaFiles != null && !metaFiles.isEmpty());\r\n      File metaFile = metaFiles.get(0);\r\n      RandomAccessFile file = new RandomAccessFile(metaFile, \"rw\");\r\n      FileChannel channel = file.getChannel();\r\n      long position = channel.size() - 2;\r\n      int length = 2;\r\n      byte[] buffer = new byte[length];\r\n      random.nextBytes(buffer);\r\n      channel.write(ByteBuffer.wrap(buffer), position);\r\n      file.close();\r\n      LOG.info(\"Deliberately corrupting file \" + metaFile.getName() +\r\n          \" at offset \" + position + \" length \" + length);\r\n\r\n\r\n      // read all files to trigger detection of corrupted replica\r\n      try {\r\n        util.checkFiles(fs, \"/srcdat10\");\r\n      } catch (BlockMissingException e) {\r\n        System.out.println(\"Received BlockMissingException as expected.\");\r\n      } catch (IOException e) {\r\n        assertTrue(\"Corrupted replicas not handled properly. Expecting BlockMissingException \" +\r\n            \" but received IOException \" + e, false);\r\n      }\r\n\r\n      LOG.info(\"Restarting Datanode to trigger BlockPoolSliceScanner\");\r\n      cluster.restartDataNodes();\r\n      cluster.waitActive();\r\n\r\n      cluster.stopDataNode(1);\r\n\r\n      // fetch bad file list from namenode. There should be one file.\r\n      final NameNode namenode = cluster.getNameNode();\r\n      while (cluster.getNamesystem().getBlockManager().getMissingBlocksCount() == 0) {\r\n        Thread.sleep(1000);\r\n        LOG.info(\"Still waiting for missing block\");\r\n      }\r\n      assertEquals(1, cluster.getNamesystem().getBlockManager().getMissingBlocksCount());\r\n      Collection<FSNamesystem.CorruptFileBlockInfo> badFiles =\r\n          namenode.getNamesystem().listCorruptFileBlocks(\"/\", null);\r\n      LOG.info(\"Namenode has bad files. \" + badFiles.size());\r\n      assertTrue(\"Namenode has \" + badFiles.size() + \" bad files. Expecting 1.\",\r\n          badFiles.size() == 1);\r\n      util.cleanup(fs, \"/srcdat10\");\r\n    } finally {\r\n      if (cluster != null) { cluster.shutdown(); }\r\n    }\r\n  }\r\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jojochuang","name":"jojochuang","key":"jojochuang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jojochuang&avatarId=25508","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jojochuang&avatarId=25508","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jojochuang&avatarId=25508","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jojochuang&avatarId=25508"},"displayName":"Wei-Chiu Chuang","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-07-18T22:02:51.677+0000","updated":"2018-07-18T22:02:51.677+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-8533/votes","votes":6,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2fmjr:"}}