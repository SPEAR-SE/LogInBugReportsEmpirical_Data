{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12406886","self":"https://issues.apache.org/jira/rest/api/2/issue/12406886","key":"HDFS-11","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2008-10-21T10:59:18.151+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Oct 12 01:12:27 UTC 2014","customfield_12310420":"16919","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_188524173056_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-10-12T01:12:27.806+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-11/watchers","watchCount":2,"isWatching":false},"created":"2008-10-21T01:22:54.817+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12323076","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12323076","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12413069","key":"HADOOP-5114","self":"https://issues.apache.org/jira/rest/api/2/issue/12413069","fields":{"summary":"A bunch of mapred unit tests are failing on Windows","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/6","id":"6","description":"A new unit, integration or system test.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/requirement.png","name":"Test","subtask":false}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-10-12T01:12:27.867+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"On Windows a series of tests fail starting from {{TestAbandonBlock}}.\nThe reason is that name-nodes or data-nodes cannot start because of the \"BindException: Address already in use: connect\".\nSeems like some of the tests that run before {{TestAbandonBlock}} are not releasing resources or not closing sockets.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"108114","customfield_12312823":null,"summary":"Tests fail on windows due to BindException.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows, cygwin.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406886/comment/12641246","id":"12641246","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"I narrowed down the number of test preceding TestAbandonBlock that lead to massive failures to 2 tests:\n- {{TestFTPFileSystem}} and\n- {{TestLoadGenerator}}\n\nRemoving any of the two stops failures. Here is the log when both tests present:\n{code}\ntest-core:\n    [mkdir] Created dir: c:\\Work\\Projects\\Hadoop\\build\\test\\data\n    [mkdir] Created dir: c:\\Work\\Projects\\Hadoop\\build\\test\\logs\n    [junit] Running org.apache.hadoop.fs.ftp.TestFTPFileSystem\n    [junit] Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 10.594 sec\n    [junit] Running org.apache.hadoop.fs.loadGenerator.TestLoadGenerator\n    [junit] Tests run: 2, Failures: 0, Errors: 0, Time elapsed: 37.643 sec\n    [junit] Running org.apache.hadoop.hdfs.TestAbandonBlock\n    [junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 1.718 sec\n    [junit] Test org.apache.hadoop.hdfs.TestAbandonBlock FAILED\n    [junit] Running org.apache.hadoop.hdfs.TestBlocksScheduledCounter\n    [junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 0.89 sec\n    [junit] Test org.apache.hadoop.hdfs.TestBlocksScheduledCounter FAILED\n    [junit] Running org.apache.hadoop.hdfs.TestCrcCorruption\n    [junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 3.36 sec\n    [junit] Test org.apache.hadoop.hdfs.TestCrcCorruption FAILED\n    [junit] Running org.apache.hadoop.hdfs.TestDFSClientRetries\n    [junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 1.016 sec\n    [junit] Test org.apache.hadoop.hdfs.TestDFSClientRetries FAILED\n    [junit] Running org.apache.hadoop.hdfs.TestDFSFinalize\n    [junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 0.766 sec\n    [junit] Test org.apache.hadoop.hdfs.TestDFSFinalize FAILED\n    [junit] Running org.apache.hadoop.hdfs.TestDFSMkdirs\n    [junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 0.922 sec\n    [junit] Test org.apache.hadoop.hdfs.TestDFSMkdirs FAILED\n    [junit] Running org.apache.hadoop.hdfs.TestDFSPermission\n    [junit] Tests run: 3, Failures: 0, Errors: 3, Time elapsed: 3.328 sec\n    [junit] Test org.apache.hadoop.hdfs.TestDFSPermission FAILED\n    [junit] Running org.apache.hadoop.hdfs.TestDFSRename\n    [junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 3.188 sec\n    [junit] Test org.apache.hadoop.hdfs.TestDFSRename FAILED\n    [junit] Running org.apache.hadoop.hdfs.TestDFSRollback\n    [junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 0.75 sec\n    [junit] Test org.apache.hadoop.hdfs.TestDFSRollback FAILED\n    [junit] Running org.apache.hadoop.hdfs.TestDFSShell\n    [junit] Tests run: 13, Failures: 0, Errors: 13, Time elapsed: 9.141 sec\n    [junit] Test org.apache.hadoop.hdfs.TestDFSShell FAILED\n{code}\n\nThe tests fail with on of the following exceptions\n{code}\nTestcase: testAbandonBlock took 4.736 sec\n\tCaused an ERROR\nUnable to establish loopback connection\njava.io.IOException: Unable to establish loopback connection\n\tat sun.nio.ch.PipeImpl$Initializer.run(PipeImpl.java:106)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat sun.nio.ch.PipeImpl.<init>(PipeImpl.java:122)\n\tat sun.nio.ch.SelectorProviderImpl.openPipe(SelectorProviderImpl.java:27)\n\tat java.nio.channels.Pipe.open(Pipe.java:133)\n\tat sun.nio.ch.WindowsSelectorImpl.<init>(WindowsSelectorImpl.java:105)\n\tat sun.nio.ch.WindowsSelectorProvider.openSelector(WindowsSelectorProvider.java:26)\n\tat java.nio.channels.Selector.open(Selector.java:209)\n\tat org.apache.hadoop.ipc.Server$Responder.<init>(Server.java:442)\n\tat org.apache.hadoop.ipc.Server.<init>(Server.java:961)\n\tat org.apache.hadoop.ipc.RPC$Server.<init>(RPC.java:436)\n\tat org.apache.hadoop.ipc.RPC.getServer(RPC.java:398)\n\tat org.apache.hadoop.hdfs.server.datanode.DataNode.startDataNode(DataNode.java:373)\n\tat org.apache.hadoop.hdfs.server.datanode.DataNode.<init>(DataNode.java:205)\n\tat org.apache.hadoop.hdfs.server.datanode.DataNode.makeInstance(DataNode.java:1199)\n\tat org.apache.hadoop.hdfs.server.datanode.DataNode.instantiateDataNode(DataNode.java:1154)\n\tat org.apache.hadoop.hdfs.MiniDFSCluster.startDataNodes(MiniDFSCluster.java:414)\n\tat org.apache.hadoop.hdfs.MiniDFSCluster.<init>(MiniDFSCluster.java:278)\n\tat org.apache.hadoop.hdfs.MiniDFSCluster.<init>(MiniDFSCluster.java:119)\n\tat org.apache.hadoop.hdfs.TestAbandonBlock.testAbandonBlock(TestAbandonBlock.java:38)\nCaused by: java.net.BindException: Address already in use: connect\n\tat sun.nio.ch.Net.connect(Native Method)\n\tat sun.nio.ch.SocketChannelImpl.connect(SocketChannelImpl.java:507)\n\tat java.nio.channels.SocketChannel.open(SocketChannel.java:146)\n\tat sun.nio.ch.PipeImpl$Initializer.run(PipeImpl.java:78)\n{code}\nor\n{code}\nTestcase: testBlocksScheduledCounter took 0.906 sec\n\tCaused an ERROR\nUnable to establish loopback connection\njava.io.IOException: Unable to establish loopback connection\n\tat sun.nio.ch.PipeImpl$Initializer.run(PipeImpl.java:106)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat sun.nio.ch.PipeImpl.<init>(PipeImpl.java:122)\n\tat sun.nio.ch.SelectorProviderImpl.openPipe(SelectorProviderImpl.java:27)\n\tat java.nio.channels.Pipe.open(Pipe.java:133)\n\tat sun.nio.ch.WindowsSelectorImpl.<init>(WindowsSelectorImpl.java:105)\n\tat sun.nio.ch.WindowsSelectorProvider.openSelector(WindowsSelectorProvider.java:26)\n\tat java.nio.channels.Selector.open(Selector.java:209)\n\tat org.apache.hadoop.ipc.Server$Responder.<init>(Server.java:442)\n\tat org.apache.hadoop.ipc.Server.<init>(Server.java:961)\n\tat org.apache.hadoop.ipc.RPC$Server.<init>(RPC.java:436)\n\tat org.apache.hadoop.ipc.RPC.getServer(RPC.java:398)\n\tat org.apache.hadoop.hdfs.server.namenode.NameNode.initialize(NameNode.java:153)\n\tat org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:208)\n\tat org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:194)\n\tat org.apache.hadoop.hdfs.server.namenode.NameNode.createNameNode(NameNode.java:859)\n\tat org.apache.hadoop.hdfs.MiniDFSCluster.<init>(MiniDFSCluster.java:275)\n\tat org.apache.hadoop.hdfs.MiniDFSCluster.<init>(MiniDFSCluster.java:119)\n\tat org.apache.hadoop.hdfs.TestBlocksScheduledCounter.testBlocksScheduledCounter(TestBlocksScheduledCounter.java:41)\nCaused by: java.net.BindException: Address already in use: connect\n\tat sun.nio.ch.Net.connect(Native Method)\n\tat sun.nio.ch.SocketChannelImpl.connect(SocketChannelImpl.java:507)\n\tat java.nio.channels.SocketChannel.open(SocketChannel.java:146)\n\tat sun.nio.ch.PipeImpl$Initializer.run(PipeImpl.java:78)\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-21T01:30:01.617+0000","updated":"2008-10-21T01:30:01.617+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406886/comment/12641349","id":"12641349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"That's interesting. Certainly I can create similar scenarios in my tests, but that's because I'm doing my test runs all in the same process, so until I have shutdown working properly across all services (and their wrapper classes) I can see similar events. But in the Hadoop core junit classes, every test class is running in its own process. If the port is staying open, it means that the test case isn't stopping.\n\n1. You can use netstat -a -p to list the processes that have open ports; link that using jps -v to the java process at fault.\n\n2. do you have test.junit.fork.mode set to something other than perTest ? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-21T10:59:18.151+0000","updated":"2008-10-21T10:59:18.151+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406886/comment/12641532","id":"12641532","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nidaley","name":"nidaley","key":"nidaley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Daley","active":true,"timeZone":"Etc/UTC"},"body":"Not a blocker for 0.19.0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nidaley","name":"nidaley","key":"nidaley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Daley","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-21T19:10:28.240+0000","updated":"2008-10-21T19:10:28.240+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406886/comment/14168446","id":"14168446","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"closing as cannot reproduce: windows integration and the build process has changed too much","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2014-10-12T01:12:27.859+0000","updated":"2014-10-12T01:12:27.859+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-11/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0iuzj:"}}