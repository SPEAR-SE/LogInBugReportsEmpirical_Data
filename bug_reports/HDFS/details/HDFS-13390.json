{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13149743","self":"https://issues.apache.org/jira/rest/api/2/issue/13149743","key":"HDFS-13390","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-04-03T14:52:52.003+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Apr 03 14:52:52 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-13390/watchers","watchCount":2,"isWatching":false},"created":"2018-04-03T13:44:41.626+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334218","id":"12334218","description":"2.9.0 release","name":"2.9.0","archived":false,"released":true,"releaseDate":"2017-11-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-04-03T14:58:41.269+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12329603","id":"12329603","name":"hdfs"}],"timeoriginalestimate":null,"description":" \r\n\r\n*Problem:*\r\nI have a file (F-1) saved in HDFS with permissions set to \"-rw-r--r--\" with user \"cnali\". User \"nndugudi\" cannot overwrite F-1 (vice versa). hdfs.write will generate following exception:\r\n\r\norg.apache.hadoop.security.AccessControlException: Permission denied: user=nndugudi, access=WRITE, inode=\"/cerebralcortex/data/00000000-f81c-44d2-9db8-fea69f468d58/00000000-5087-3d56-ad0e-0b27c3c83182/20171105.gz\":cnali:supergroup:-rw-r--r--\r\n\r\nHowever, user \"nndugudi\" can delete the file without any problem. So why overwriting file will produce AccessControlException and not the delete method?\r\n\r\n*Sample Code*:\r\nFile: [https://github.com/MD2Korg/CerebralCortex/blob/master/cerebralcortex/core/data_manager/raw/stream_handler.py]\r\n\r\nLOC: 659-705 (write_hdfs_day_file)\r\n\r\n \r\n\r\n*HDFS Configurations*:\r\n\r\nAll configurations are set to default. Security is also disabled as of now.\r\n\r\n ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"AccessControlException for overwrite but not for delete","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nasirali","name":"nasirali","key":"nasirali","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nasir Ali","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nasirali","name":"nasirali","key":"nasirali","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nasir Ali","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"*Environment:*\r\nOS: Centos\r\nPyArrow Version: 0.8.0\r\nPython version: 3.6\r\nHDFS: 2.9","customfield_12313520":null,"customfield_12311020":"https://github.com/apache/arrow/issues/1805#issuecomment-378177406","duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13149743/comment/16424130","id":"16424130","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shahrs87","name":"shahrs87","key":"shahrs87","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rushabh S Shah","active":true,"timeZone":"Etc/UTC"},"body":"{quote}. So why overwriting file will produce AccessControlException and not the delete method?\r\n{quote}\r\n[https://github.com/apache/hadoop/blob/branch-2.9/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSPermissionChecker.java#L162]\r\n For {{startFileInt witgh overWrite flage}}, it resolves to all these arguments:\r\n{noformat}\r\n  checkPermission(iip, false, null, null, FsAction.WRITE, null, false)\r\n{noformat}\r\nFor {{delete}} path, it resolves to all these arguments:\r\n{noformat}\r\nfsd.checkPermission(iip, false, null, FsAction.WRITE, null, FsAction.ALL, true);\r\n{noformat}\r\nHere are all the {{checkPermission}} parameters.\r\n{noformat}\r\ncheckPermission(INodesInPath inodesInPath, boolean doCheckOwner,\r\n      FsAction ancestorAccess, FsAction parentAccess, FsAction access,\r\n      FsAction subAccess, boolean ignoreEmptyDir)\r\n{noformat}\r\nIf you notice {{access}} parameter, it is null for {{delete}} and it is {{FsAction.WRITE}} for {{startFileInt}}.\r\n That means it will skip the checking whether file is writable for {{delete}} and will check whether file is writable by {{currentUser}}.\r\n I don't have much context why the behavior is different.\r\n IMO it should be same (i.e you should be able to overwrite the file if you are able to delete it) but you can provide a patch and will let others review the patch.\r\nJust FYI, this patch will bring an incompatible change in the way that some jobs will not fail when they expect it to fail.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shahrs87","name":"shahrs87","key":"shahrs87","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rushabh S Shah","active":true,"timeZone":"Etc/UTC"},"created":"2018-04-03T14:52:52.003+0000","updated":"2018-04-03T14:58:41.263+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-13390/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3s3av:"}}