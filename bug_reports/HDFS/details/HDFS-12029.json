{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13082240","self":"https://issues.apache.org/jira/rest/api/2/issue/13082240","key":"HDFS-12029","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/10004","id":"10004","description":"Not A Bug","name":"Not A Bug"},"customfield_12312322":null,"customfield_12310220":"2017-06-24T16:53:03.170+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 05 21:22:14 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2367159421_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2017-07-21T07:25:34.111+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-12029/watchers","watchCount":14,"isWatching":false},"created":"2017-06-23T21:52:54.797+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12507488","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12507488","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13081557","key":"DAEMON-364","self":"https://issues.apache.org/jira/rest/api/2/issue/13081557","fields":{"summary":"Latest RHEL kernel update crashes jsvc","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nandakumar131","name":"nandakumar131","key":"nandakumar131","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nanda kumar","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-07-21T07:25:34.212+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312927","id":"12312927","name":"datanode"}],"timeoriginalestimate":null,"description":" We have seen that when Linux kernel is upgraded to address a specific CVE \n ( https://access.redhat.com/security/vulnerabilities/stackguard ) it might cause a datanode crash.\n\nWe have observed this issue while upgrading from 3.10.0-514.6.2 to 3.10.0-514.21.2 versions of the kernel.\n\nOriginal kernel fix is here -- https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=1be7107fbe18eed3e319a6c3e83c78254b693acb\n\nDatanode fails with the following stack trace, \n\n{noformat}\n\n# \n# A fatal error has been detected by the Java Runtime Environment: \n# \n# SIGBUS (0x7) at pc=0x00007f458d078b7c, pid=13214, tid=139936990349120 \n# \n# JRE version: (8.0_40-b25) (build ) \n# Java VM: Java HotSpot(TM) 64-Bit Server VM (25.40-b25 mixed mode linux-amd64 compressed oops) \n# Problematic frame: \n# j java.lang.Object.<clinit>()V+0 \n# \n# Failed to write core dump. Core dumps have been disabled. To enable core dumping, try \"ulimit -c unlimited\" before starting Java again \n# \n# An error report file with more information is saved as: \n# /tmp/hs_err_pid13214.log \n# \n# If you would like to submit a bug report, please visit: \n# http://bugreport.java.com/bugreport/crash.jsp \n# \n{noformat}\n\nThe root cause is a failure in jsvc. If we pass a greater than 1MB value as the stack size argument, this can be mitigated.  Something like:\n\n{code}\nexec \"$JSVC\" \\\n-Xss2m\norg.apache.hadoop.hdfs.server.datanode.SecureDataNodeStarter \"$@\"\n{code}\n\nThis JIRA tracks potential fixes for this problem. We don't have data on how this impacts other applications that run on datanode as this might impact datanodes memory usage.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":" Data node process crashes after kernel upgrade","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anu","name":"anu","key":"anu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anu Engineer","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anu","name":"anu","key":"anu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anu Engineer","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13082240/comment/16062060","id":"16062060","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"body":"bq. how this impacts other applications \n\nAll signs point to that it's a big enough problem that it's being treated as a kernel bug.  See, e.g., https://bugs.launchpad.net/ubuntu/+source/commons-daemon/+bug/1699772 \n\nWe probably shouldn't get too worried about this for Hadoop until we see what everyone else in doing. Plus Hadoop 3.x already provides a way to do a temporary work around: just replace the hadoop_start_secure_daemon function in hadoop-user-functions.sh.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"created":"2017-06-24T16:53:03.170+0000","updated":"2017-06-24T16:53:03.170+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13082240/comment/16062105","id":"16062105","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nandakumar131","name":"nandakumar131","key":"nandakumar131","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nanda kumar","active":true,"timeZone":"Asia/Kolkata"},"body":"We can also use {{-Xss1280k}} as workaround as suggested [here | https://issues.apache.org/jira/browse/DAEMON-363?focusedCommentId=16060779&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16060779], this value will be a safer option as it's closer to the default value 1024k.\nThis has to be set for jsvc process.\nAfter setting this value, tested the stack size allocated for Threads in java process launched by jsvc\n\n{quote}\n7f962acb2000-7f962adf0000 rw-p 00000000 00:00 0   stack:19767    Size: 1272 kB\n--\n7f962adf3000-7f962af31000 rw-p 00000000 00:00 0    stack:19766    Size: 1272 kB\n--\n7f962af34000-7f962b072000 rw-p 00000000 00:00 0   stack:19765    Size: 1272 kB\n--\n7f962b075000-7f962b1b3000 rw-p 00000000 00:00 0   stack:19764   Size: 1272 kB\n--\n7f962b1b6000-7f962b2f4000 rw-p 00000000 00:00 0    stack:19763   Size: 1272 kB\n{quote}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nandakumar131","name":"nandakumar131","key":"nandakumar131","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nanda kumar","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-06-24T19:37:35.956+0000","updated":"2017-06-24T19:37:35.956+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13082240/comment/16062213","id":"16062213","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"body":"I've written up a blog post on how to get around this in Hadoop 3.x: https://effectivemachines.com/2017/06/24/workaround-secure-datanode-crashes/ .","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"created":"2017-06-25T05:00:38.024+0000","updated":"2017-06-25T05:00:38.024+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13082240/comment/16062395","id":"16062395","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anu","name":"anu","key":"anu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anu Engineer","active":true,"timeZone":"America/Los_Angeles"},"body":"[~aw] Thanks for the comments and the links to the blog and ubunutu. As you suggested let us hold off on any fix in Hadoop, until we get a better picture. \nFrom the ubuntu link we can see that this is a major regression causing failures across java stack.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anu","name":"anu","key":"anu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anu Engineer","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-25T18:02:52.570+0000","updated":"2017-06-25T18:42:44.704+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13082240/comment/16075448","id":"16075448","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vrathor-hw","name":"vrathor-hw","key":"vrathor-hw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vrathor-hw&avatarId=29150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vrathor-hw&avatarId=29150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vrathor-hw&avatarId=29150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vrathor-hw&avatarId=29150"},"displayName":"Vipin Rathor","active":true,"timeZone":"America/Los_Angeles"},"body":"As per this RedHat Errata ([https://access.redhat.com/errata/RHBA-2017:1674]), upgrade to newer Kernel 3.10.0-514.26.2.el7.x86_64 fixes the issue. FYI.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vrathor-hw","name":"vrathor-hw","key":"vrathor-hw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vrathor-hw&avatarId=29150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vrathor-hw&avatarId=29150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vrathor-hw&avatarId=29150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vrathor-hw&avatarId=29150"},"displayName":"Vipin Rathor","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-07-05T21:22:14.741+0000","updated":"2017-07-05T21:22:14.741+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-12029/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3goqf:"}}