{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13180394","self":"https://issues.apache.org/jira/rest/api/2/issue/13180394","key":"HDFS-13844","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-08-23T16:24:06.084+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Aug 27 03:27:16 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-13844/watchers","watchCount":3,"isWatching":false},"created":"2018-08-22T07:01:16.070+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321657","id":"12321657","description":"1.2.0 release","name":"1.2.0","archived":false,"released":true,"releaseDate":"2013-05-13"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12325049","id":"12325049","description":"2.2.0 release","name":"2.2.0","archived":false,"released":true,"releaseDate":"2013-10-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12332790","id":"12332790","description":"2.7.2 release","name":"2.7.2","archived":false,"released":true,"releaseDate":"2016-01-25"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341433","id":"12341433","description":"3.0.0 GA release","name":"3.0.0","archived":false,"released":true,"releaseDate":"2017-12-13"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12341434","id":"12341434","description":"3.1.0 release","name":"3.1.0","archived":false,"released":true,"releaseDate":"2018-04-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-08-27T03:33:20.182+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12329603","id":"12329603","name":"hdfs"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12329815","id":"12329815","name":"ui"}],"timeoriginalestimate":null,"description":"The namenode WebUI cannot display the capacity with correct units. I have found that the function fmt_bytes in the dfs-dust.js missed the EB unit. This will lead to undefined unit in the ui.\r\n\r\nAnd although the unit ZB is very large, we should take the unit overflow into consideration. Supposing the last unit is GB, we should get the 8192 GB with the total capacity 8T rather than 8 undefined.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12936591","id":"12936591","filename":"HDFS-13844.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-08-22T07:21:48.046+0000","size":792,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12936591/HDFS-13844.001.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12936627","id":"12936627","filename":"overflow_undefined_unit.jpg","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-08-22T10:16:34.246+0000","size":449509,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12936627/overflow_undefined_unit.jpg"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12936628","id":"12936628","filename":"overflow_unit.jpg","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-08-22T10:17:11.150+0000","size":409883,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12936628/overflow_unit.jpg"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12936626","id":"12936626","filename":"undefined_unit.jpg","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-08-22T10:16:29.442+0000","size":428360,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12936626/undefined_unit.jpg"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Refactor the fmt_bytes function in the dfs-dust.js.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":"2018-08-22","customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13180394/comment/16589641","id":"16589641","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"body":"Could you review the code? [~elgoiri] ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-08-23T03:18:04.891+0000","updated":"2018-08-23T03:18:04.891+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13180394/comment/16590460","id":"16590460","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"body":"I get the error because EB is missing, I don't quite follow the change for not checking the i being smaller than the UNITS.length.\r\nThe screenshots you posted, show overflow and so on, can you post the fixed one.\r\nIn general, I would love to have a unit test but I don't think we have unit test infra for javascript.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"created":"2018-08-23T16:24:06.084+0000","updated":"2018-08-23T16:24:06.084+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13180394/comment/16591108","id":"16591108","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"body":"This patch has repaired two bugs.One bug is missing the EB. And another bug is unit overflow. For example, if you have the units ['B', 'KB', 'MB', 'GB'] with the 8192 GB capacity, you will get the \"8 undefined\" not better \"8192 GB\". \r\nBecause according to the code,  when v equals 8192, the i equals units.length and UNITS[i]  will be undefined. \r\n\r\n{code:java}\r\nwhile (Math.floor(v) > 0 && i < UNITS.length) { //when v = 8 and prev=8192, i = units.length\r\n        prev = v;\r\n        v /= 1024;\r\n        i += 1;\r\n      }\r\n      if (i > 0 && i < UNITS.length) { //skip the step, because i = units.length\r\n        v = prev;\r\n        i -= 1;\r\n      }\r\n  return Math.round(v * 100) / 100 + ' ' + UNITS[i]; // units[i] will be undefined.\r\n{code}\r\n\r\nthe overflow_unit.jpg is the fixed one, or the capacity will display undefined unit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-08-24T03:23:25.607+0000","updated":"2018-08-24T11:31:40.415+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13180394/comment/16591912","id":"16591912","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"body":"bq. the overflow_unit.jpg is the fixed one, or the capacity will display undefined unit.\r\n\r\nShouldn't  !overflow_unit.jpg! show TB?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"created":"2018-08-24T16:54:48.672+0000","updated":"2018-08-24T16:54:48.672+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13180394/comment/16592600","id":"16592600","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"body":"It is just an example because it is difficult to get the capacity in our environment with last unit ZB. We can decrease the units and simulate one situation overflowing the unit to explain this problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-08-25T14:15:06.365+0000","updated":"2018-08-25T14:15:06.365+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13180394/comment/16592954","id":"16592954","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"body":"As I said, I would really like to have unit tests for this code.\r\nI'm even tempted to code the same in Java and unit test there.\r\nAnyway, give it a thought and see if we could put a couple cases to test somehow.\r\nOtherwise, +1.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"created":"2018-08-26T16:54:27.373+0000","updated":"2018-08-26T16:54:27.373+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13180394/comment/16593160","id":"16593160","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"body":"I don't know how to test the js easily. As [~elgoiri] said, it is better to provide some unit tests. So could you review the patch and give some comments? [~jingzhao] [~andrew.wang][~wheat9]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hfyang20071","name":"hfyang20071","key":"hfyang20071","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"yanghuafeng","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-08-27T03:27:16.864+0000","updated":"2018-08-27T03:33:20.178+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-13844/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3xal3:"}}