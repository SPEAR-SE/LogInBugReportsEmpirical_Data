{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12704060","self":"https://issues.apache.org/jira/rest/api/2/issue/12704060","key":"HDFS-6165","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-03-27T19:32:10.226+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat May 02 04:40:52 UTC 2015","customfield_12310420":"382394","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-6165/watchers","watchCount":7,"isWatching":false},"created":"2014-03-27T18:56:03.903+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":["BB2015-05-TBR"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"8.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325255","id":"12325255","description":"2.3.0 release","name":"2.3.0","archived":false,"released":true,"releaseDate":"2014-02-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-05-06T03:32:47.973+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312928","id":"12312928","name":"hdfs-client"}],"timeoriginalestimate":null,"description":"Given a directory owned by user A with WRITE permission containing an empty directory owned by user B, it is not possible to delete user B's empty directory with either \"hdfs dfs -rm -r\" or \"hdfs dfs -rmdir\". Because the current implementation requires FULL permission of the empty directory, and throws exception. \n\nOn the other hand, on linux, \"rm -r\" and \"rmdir\" command can remove empty directory as long as the parent directory has WRITE permission (and prefix component of the path have EXECUTE permission), For the tested OSes, some prompt user asking for confirmation, some don't.\n\nHere's a reproduction:\n\n{code}\n[root@vm01 ~]# hdfs dfs -ls /user/\nFound 4 items\ndrwxr-xr-x   - userabc users               0 2013-05-03 01:55 /user/userabc\ndrwxr-xr-x   - hdfs    supergroup          0 2013-05-03 00:28 /user/hdfs\ndrwxrwxrwx   - mapred  hadoop              0 2013-05-03 00:13 /user/history\ndrwxr-xr-x   - hdfs    supergroup          0 2013-04-14 16:46 /user/hive\n[root@vm01 ~]# hdfs dfs -ls /user/userabc\nFound 8 items\ndrwx------   - userabc users          0 2013-05-02 17:00 /user/userabc/.Trash\ndrwxr-xr-x   - userabc users          0 2013-05-03 01:34 /user/userabc/.cm\ndrwx------   - userabc users          0 2013-05-03 01:06 /user/userabc/.staging\ndrwxr-xr-x   - userabc users          0 2013-04-14 18:31 /user/userabc/apps\ndrwxr-xr-x   - userabc users          0 2013-04-30 18:05 /user/userabc/ds\ndrwxr-xr-x   - hdfs    users          0 2013-05-03 01:54 /user/userabc/foo\ndrwxr-xr-x   - userabc users          0 2013-04-30 16:18 /user/userabc/maven_source\ndrwxr-xr-x   - hdfs    users          0 2013-05-03 01:40 /user/userabc/test-restore\n[root@vm01 ~]# hdfs dfs -ls /user/userabc/foo/\n[root@vm01 ~]# sudo -u userabc hdfs dfs -rm -r -skipTrash /user/userabc/foo\nrm: Permission denied: user=userabc, access=ALL, inode=\"/user/userabc/foo\":hdfs:users:drwxr-xr-x\n{code}\n\nThe super user can delete the directory.\n\n{code}\n[root@vm01 ~]# sudo -u hdfs hdfs dfs -rm -r -skipTrash /user/userabc/foo\nDeleted /user/userabc/foo\n{code}\n\nThe same is not true for files, however. They have the correct behavior.\n\n{code}\n[root@vm01 ~]# sudo -u hdfs hdfs dfs -touchz /user/userabc/foo-file\n[root@vm01 ~]# hdfs dfs -ls /user/userabc/\nFound 8 items\ndrwx------   - userabc users          0 2013-05-02 17:00 /user/userabc/.Trash\ndrwxr-xr-x   - userabc users          0 2013-05-03 01:34 /user/userabc/.cm\ndrwx------   - userabc users          0 2013-05-03 01:06 /user/userabc/.staging\ndrwxr-xr-x   - userabc users          0 2013-04-14 18:31 /user/userabc/apps\ndrwxr-xr-x   - userabc users          0 2013-04-30 18:05 /user/userabc/ds\n-rw-r--r--   1 hdfs    users          0 2013-05-03 02:11 /user/userabc/foo-file\ndrwxr-xr-x   - userabc users          0 2013-04-30 16:18 /user/userabc/maven_source\ndrwxr-xr-x   - hdfs    users          0 2013-05-03 01:40 /user/userabc/test-restore\n[root@vm01 ~]# sudo -u userabc hdfs dfs -rm -skipTrash /user/userabc/foo-file\nDeleted /user/userabc/foo-file\n{code}\n\nUsing \"hdfs dfs -rmdir\" command:\n{code}\nbash-4.1$ hadoop fs -lsr /\nlsr: DEPRECATED: Please use 'ls -R' instead.\ndrwxr-xr-x   - hdfs supergroup          0 2014-03-25 16:29 /user\ndrwxr-xr-x   - hdfs   supergroup          0 2014-03-25 16:28 /user/hdfs\ndrwxr-xr-x   - usrabc users               0 2014-03-28 23:39 /user/usrabc\ndrwxr-xr-x   - abc    abc                 0 2014-03-28 23:39 /user/usrabc/foo-empty1\n[root@vm01 usrabc]# su usrabc\n[usrabc@vm01 ~]$ hdfs dfs -rmdir /user/usrabc/foo-empty1\nrmdir: Permission denied: user=usrabc, access=ALL, inode=\"/user/usrabc/foo-empty1\":abc:abc:drwxr-xr-x\n{code}\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12637255","id":"12637255","filename":"HDFS-6165.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T21:55:56.047+0000","size":9949,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12637255/HDFS-6165.001.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12637658","id":"12637658","filename":"HDFS-6165.002.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-29T17:46:10.431+0000","size":31761,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12637658/HDFS-6165.002.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12637675","id":"12637675","filename":"HDFS-6165.003.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-29T23:49:53.788+0000","size":36691,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12637675/HDFS-6165.003.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12638556","id":"12638556","filename":"HDFS-6165.004.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-03T20:44:45.979+0000","size":21628,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12638556/HDFS-6165.004.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12638514","id":"12638514","filename":"HDFS-6165.004.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-03T16:42:53.894+0000","size":21628,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12638514/HDFS-6165.004.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12642397","id":"12642397","filename":"HDFS-6165.005.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-29T04:15:08.674+0000","size":24266,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12642397/HDFS-6165.005.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12642655","id":"12642655","filename":"HDFS-6165.006.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-30T15:11:54.973+0000","size":25706,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12642655/HDFS-6165.006.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12642526","id":"12642526","filename":"HDFS-6165.006.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-29T20:14:32.069+0000","size":25706,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12642526/HDFS-6165.006.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"382664","customfield_12312823":null,"summary":"\"hdfs dfs -rm -r\" and \"hdfs dfs -rmdir\" commands can't remove empty directory ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[{"id":"12712906","key":"HDFS-6351","self":"https://issues.apache.org/jira/rest/api/2/issue/12712906","fields":{"summary":"Command \"hdfs dfs -rm -r\" can't remove empty directory","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}},{"id":"12712907","key":"HDFS-6352","self":"https://issues.apache.org/jira/rest/api/2/issue/12712907","fields":{"summary":"Command \"hdfs dfs -rmdir\" can't remove empty directory","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13949832","id":"13949832","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"The behavior is correct since r is required for listing the children of /user/userabc/foo.  The command \"-rm -r\" means \"remove recursively\".  It doesn't know whether foo is empty or not beforehand.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T19:32:10.226+0000","updated":"2014-03-27T19:32:10.226+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13949994","id":"13949994","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"The submitted patch tries to address the reported problem.\nThanks for reviewing.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T21:56:53.630+0000","updated":"2014-03-27T21:56:53.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950003","id":"13950003","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~szetszwo]. The problem is, when the sub-dir is empty, we should be able to delete it but we can't now.\nIt's tried on linux and linux can delete empty dir with similar ownership/permission setting.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T21:59:20.941+0000","updated":"2014-03-27T21:59:20.941+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950038","id":"13950038","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> ... It's tried on linux and linux can delete empty dir with similar ownership/permission setting.\n\nJust tried with mac.  It prompts for overriding the permission.\n{noformat}\nszetszwo tmp$ls -l\ntotal 0\ndr-xr-xr-x  2 szetszwo  staff   68 Mar 27 15:27 empty\ndr-xr-xr-x  3 szetszwo  staff  102 Mar 27 15:27 nonempty\nszetszwo tmp$ls -l empty/\nszetszwo tmp$ls -l nonempty/\ntotal 8\n-rw-r--r--  1 szetszwo  staff  9 Mar 27 15:27 a.txt\nszetszwo tmp$rm -r empty/\noverride r-xr-xr-x  szetszwo/staff for empty/? n\nszetszwo tmp$rm -r nonempty/\nrm: nonempty//a.txt: Permission denied\noverride r-xr-xr-x  szetszwo/staff for nonempty/? n\n{noformat}\nWhich version of Linux you tried?  Could you post similar CLI output?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T22:32:41.335+0000","updated":"2014-03-27T22:32:41.335+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950060","id":"13950060","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~szetszwo], \n\nMy test OS: CentOS release 6.4 (Final)\n2.6.32-358.2.1.el6.x86_64\n\nI actually used \"rm -rf\". I'm not aware of \"-f\" in HDFS FsShell. If I don't use -f, I can see same behaviour as you observed. I wonder whether we should introduce the -f switch. Below is my log:\n\n[root@vm001 usrxyz]# ls -lrt\ntotal 12\ndrwxr-xr-x 2 hdfs users 4096 Mar 25 19:56 hdfs\ndrwxr-xr-x 3 abc  users 4096 Mar 26 11:57 abc\ndrwxr-xr-x 2 abc  users 4096 Mar 26 12:28 abc-empty\n[root@vm001 usrxyz]# ls abc-empty/\n[root@vm001 usrxyz]# su usrxyz\n[usrxyz@vm001 ~]$ rm -rf abc-empty\n[usrxyz@vm001 ~]$ ls abc\nabcsub\n[usrxyz@vm001 ~]$ ls -lrt abc\ntotal 4\ndrwxr-xr-x 2 abc users 4096 Mar 26 11:57 abcsub\n[usrxyz@vm001 ~]$ rm -rf abc\nrm: cannot remove `abc/abcsub': Permission denied\n[usrxyz@vm001 ~]$ \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T22:47:44.689+0000","updated":"2014-03-27T22:47:44.689+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950063","id":"13950063","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hey Nic, here's some output from my Ubuntu 12.04 laptop:\n\n{noformat}\n-> % whoami\nandrew\n-> % ls -l\ntotal 4\ndrwx------ 2 root root 4096 Mar 27 15:43 empty\n-> % rmdir empty  \n{noformat}\n\nI think your install is defaulting to {{rm -i}}, I get similar output if I do that instead:\n\n{noformat}\n-> % rm -ri empty\nrm: descend into write-protected directory `empty'? y\nrm: remove write-protected directory `empty'? n\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T22:48:44.914+0000","updated":"2014-03-27T22:48:44.914+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950072","id":"13950072","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> [usrxyz@vm001 ~]$ rm -rf abc-empty\n\n[~yzhangal], could you try without -f?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T22:57:52.851+0000","updated":"2014-03-27T22:57:52.851+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950073","id":"13950073","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> -> % rmdir empty  \n\n[~andrew.wang], Could you try \"rm -r\"?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T22:58:54.895+0000","updated":"2014-03-27T22:58:54.895+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950085","id":"13950085","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~andrew.wang].\n\nHi [~szetszwo], as I stated in my last update, I did try without -f, and got the same behaviour as you observed.\n\nIn my centos system, if I use \"rmdir abc-empty\" , I can remove abc-copy without problem. Without \"\\rm -r\" (added slash to use the default behavior of rm), I have the same behaviour as yours (prompted to answer yes/no). BTW, I saw dfs does have -f, I didn't try this switch that before, will try.\n\n[yzhang@yjzsn ~]$ ls -lrt\ntotal 12\ndrwxr-xr-x 2 hdfs users 4096 Mar 25 19:56 hdfs\ndrwxr-xr-x 3 abc  users 4096 Mar 26 11:57 abc\ndrwxr-xr-x 2 abc  users 4096 Mar 27 15:54 abc-empty\n[yzhang@yjzsn ~]$ \\rm abc-empty\nrm: cannot remove `abc-empty': Is a directory\n[yzhang@yjzsn ~]$ \\rm -r abc-empty\nrm: remove write-protected directory `abc-empty'? n\n[yzhang@yjzsn ~]$ \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T23:05:16.696+0000","updated":"2014-03-27T23:05:16.696+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950087","id":"13950087","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~szetszwo] My \"rm -r\" is the same as the \"rm -ri\" output I posted earlier.\n\nWe could add -f or -i modes to FsShell to mimic the GNU/BSD if you like, but do we all agree that we should be able to delete these empty directories?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T23:05:32.208+0000","updated":"2014-03-27T23:05:32.208+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950098","id":"13950098","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"The hadoop command here is \"dfs -rm -r\".  So let's only compare it with \"rm -r\" in Unix/Linux.  \"rmdir\" is irrelevant.\n\nSince \"rm -r\" in Unix/Linux does ask for overriding permission, throwing an exception for \"dfs -rm -r\" seems more correct.  No?\n\n[~daryn], any comment here?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T23:11:12.388+0000","updated":"2014-03-27T23:11:12.388+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950109","id":"13950109","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hey Yongjun, overall the patch looks good, I just have some small review comments:\n\n- Isn't it simpler to use the Java APIs for the test cases rather than FsShell? If so, we could just add new tests to TestPermission.\n- If you really do want shell tests, there's TestFsShell (you add new tests to the xml file in src/test/resources).\n- Seems unnecessary to have both \"isEmpty\" and \"isNonEmpty\" methods where one is just the complement of the other. Let's just use the existing method.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T23:15:50.366+0000","updated":"2014-03-27T23:15:50.366+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950129","id":"13950129","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thank you all!\n\nI will address Andrew's comments in a another update.\n\nThere seem to be two types of behaviour on different linux:\n1. \"rm -r\" remove empty dir without problem on Andrew's system Ubuntu 12.04\n2. \"rm -r\" prompts question to user to answer yes/no on my CentOs6 and Tsz Wo's Mac\n\nFor CentOs, using \"rm -r -f\" deletes with no prompt to user.\n\nI did try -f switch with hdfs, and see it has the same problem as reported (see blow). With linux, using -f will remove the file without prompting to ask user. I wonder whether we should fix HDFS's -f switch. \n\n{code}\n[usrxyz@vm001 ~]$ hadoop fs -lsr /\nlsr: DEPRECATED: Please use 'ls -R' instead.\ndrwxr-xr-x   - hdfs supergroup          0 2014-03-25 16:29 /user\ndrwxr-xr-x   - hdfs   supergroup          0 2014-03-25 16:28 /user/hdfs\ndrwxr-xr-x   - usrxyz users               0 2014-03-27 16:10 /user/usrxyz\ndrwxr-xr-x   - hdfs   users               0 2014-03-25 16:32 /user/usrxyz/foo\n-rw-r--r--   1 hdfs   users               5 2014-03-25 16:32 /user/usrxyz/foo/test.txt\ndrwxr-xr-x   - abc    abc                 0 2014-03-27 16:10 /user/usrxyz/foo-empty\n[usrxyz@vm001 ~]$ whoami\nusrxyz\n[usrxyz@vm001 ~]$ hadoop fs -rm -r -f /user/usrxyz/foo-empty\n14/03/27 16:18:53 INFO fs.TrashPolicyDefault: Namenode trash configuration: Deletion interval = 0 minutes, Emptier interval = 0 minutes.\nrm: Permission denied: user=usrxyz, access=ALL, inode=\"/user/usrxyz/foo-empty\":abc:abc:drwxr-xr-x\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T23:29:48.739+0000","updated":"2014-03-27T23:29:48.739+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950140","id":"13950140","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Please don't commit the patch.  You may want to defer the work after we agree what to do.\n\nIMO, \"dfs -rm -r\" should be the same as \"rm -r\".  So the current patch allows delete without prompting the user is not correct.  Possible improvement could be adding prompt to \"dfs -rm -r\".\n\nBTW, we do have \"dfs -rmdir\".  Have you checked it?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T23:38:37.430+0000","updated":"2014-03-27T23:38:37.430+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950145","id":"13950145","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. 1. \"rm -r\" remove empty dir without problem on Andrew's system Ubuntu 12.04\n\nActually, it prompts like your systems, so we're all in agreement.\n\nIt'd be nice to mimic GNU rm as much as possible. It actually explains the interactive and force modes pretty well in the man page: http://man7.org/linux/man-pages/man1/rm.1.html\n\nThe key bit is this:\n\n{noformat}\nOtherwise, if a file is unwritable, standard input is a terminal, and\n       the -f or --force option is not given, or the -i or\n       --interactive=always option is given, rm prompts the user for whether\n       to remove the file.  If the response is not affirmative, the file is\n       skipped.\n{noformat}\n\nThis might be incompatible though, if we start prompting where we didn't before.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T23:40:34.685+0000","updated":"2014-03-27T23:40:34.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950172","id":"13950172","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"What about this: \n\nfix the code that deals with \"-f\" switch, if \"-f\" is passed, then delete empty dir without prompting to user. If not, then prompt user or throw exception.\n\nPrompting user would involving feedback from NN to FsShell, FsShell prompt user, and FsShell talk to NN again, a bit complex. \n\nWhat do you think?\n\nThanks.\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-27T23:56:13.573+0000","updated":"2014-03-27T23:56:13.573+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950182","id":"13950182","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"For Andrew's review comments\n\n{quote}\nSeems unnecessary to have both \"isEmpty\" and \"isNonEmpty\" methods where one is just the complement of the other. Let's just use the existing method.\n{quote}\n\nThe method are IsEmptyDirecotory, isNonEmptyDirectory, they are not exactly opposite, because for file, both return false.\n\nI will look into other review comments later.\n\nAs I posted in my last update, I'd like to look into fixing \"-f\" first.  Please comment on whether we prompt to user or to throw exception. Throw exception is simpler solution but not compliant with linux.\n\nThanks.\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-28T00:06:58.045+0000","updated":"2014-03-28T00:06:58.045+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950214","id":"13950214","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12637255/HDFS-6165.001.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs hadoop-tools/hadoop-extras:\n\n                  org.apache.hadoop.hdfs.TestDFSPermission\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/6533//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/6533//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-03-28T00:43:12.574+0000","updated":"2014-03-28T00:43:12.574+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13950295","id":"13950295","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"By a chat with Andrew, he suggested that after we fix \"-f\", we might change the exception message to suggest to user to use \"-f\" when there is this kind of exception. I think it's a good idea. Even though this is not exactly the same semantics as Linux, it's better that what we have today. Thanks Andrew.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-28T02:35:54.538+0000","updated":"2014-03-28T02:35:54.538+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13951205","id":"13951205","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> ... we might change the exception message to suggest to user to use \"-f\" when there is this kind of exception. ...\n\nSounds good.\n\nHow about \"dfs -mkdir\"?  Does it work as expected?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-28T18:42:52.450+0000","updated":"2014-03-28T18:42:52.450+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13951208","id":"13951208","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Oops, I mean \"dfs -rmdir\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-28T18:43:44.636+0000","updated":"2014-03-28T18:43:44.636+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13951224","id":"13951224","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Revised Summary and changed Priority to minor.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-28T18:48:52.232+0000","updated":"2014-03-28T18:48:52.232+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13951233","id":"13951233","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"[~yzhangal], you may want clean up the Description.  In particular, you may want to clean up the example, e.g. remove the unrelated items in the directory listings.  Since the Description is sent out to the mailing list for every email, we should make it precise and easy to read.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-28T18:53:58.326+0000","updated":"2014-03-28T18:53:58.326+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13951260","id":"13951260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks a lot [~szetszwo], \n\nThe summary you changed to is one part of the picture. The other one I found during our discussion is that, \"hdfs dfs -rm -r -f\" doesn't work as expected. I'm working on fixing the \"-f\" switch which is more of a problem. \n\nFor the \"hdfs dfs -rm -r\", I will change the exception message since both Andrew and you agreed.\n\nI will address your other comments a bit later. \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-28T19:15:04.777+0000","updated":"2014-03-28T19:15:04.777+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13951277","id":"13951277","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"I saw my name mentioned for comment.  I'll try to grok the entire discussion and patch later today.  We need to be extremely careful how we alter the permission handling.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2014-03-28T19:27:03.437+0000","updated":"2014-03-28T19:27:03.437+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13951601","id":"13951601","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"It may be informative to refer to POSIX as a standard and GNU coreutils as a sample implementation.  Here is the documentation on rm:\n\nhttp://pubs.opengroup.org/onlinepubs/9699919799/utilities/rm.html\n\nbq. If the current file is a directory, rm shall perform actions equivalent to the rmdir() ...\n\nHere is rmdir:\n\nhttp://pubs.opengroup.org/onlinepubs/9699919799/functions/rmdir.html\n\n{quote}\nThe rmdir() function shall fail if:\n\n[EACCES]\nSearch permission is denied on a component of the path prefix, or write permission is denied on the parent directory of the directory to be removed.\n{quote}\n\nI see no mention of any permission requirements directly on the directory to be removed.  Looking at the GNU coreutils implementation, it appears that the \"remove write-protected\" prompt some of you reported seeing is not part of core file system permission enforcement.  Instead, it's just a nicety of the shell utility.\n\nhttp://git.savannah.gnu.org/gitweb/?p=coreutils.git;a=blob;f=src/remove.c;h=b98f3ecb286bd79c203abca709dcfec63c55db8f;hb=HEAD#l284\n\nI'd appreciate someone else double-checking this too.  As Daryn said, it's a sensitive area.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-28T23:47:16.839+0000","updated":"2014-03-28T23:47:16.839+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13951611","id":"13951611","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~daryn], I'm working on making \"-f\" to work. I will post new patch when I'm done. Certainly it would be helpful if you can review.  There are three issues observed now:\n\nRunning the following command as parent directory owner with WRITE permission:\n\n1. \"hdfs dfs -rm -r\" behaves different than unix/linux \"rm -r\" when trying to delete empty directory\n     hdfs throws exception; unix/linux prompt to user to ask for \"yes/no\"\n\n2. \"hdfs dfs -rm -r -f\" doesn't delete empty directory, it also throws exception, the \"-f\" switch essentially appears to be ignored; however unix/linux \"rm -rf\" does delete.\n\n3. \"hdfs -rmdir\" throws exception (thanks [~szetszwo] for suggesting to try), unix/linux \"rmdir\" deletes empty directory as I reported earlier\n\n{code}\n[usrxyz@vm001 root]$ hadoop fs -lsr /\nlsr: DEPRECATED: Please use 'ls -R' instead.\ndrwxr-xr-x   - hdfs supergroup          0 2014-03-25 16:29 /user\ndrwxr-xr-x   - hdfs   supergroup          0 2014-03-25 16:28 /user/hdfs\ndrwxr-xr-x   - usrxyz users               0 2014-03-27 16:10 /user/usrxyz\ndrwxr-xr-x   - hdfs   users               0 2014-03-25 16:32 /user/usrxyz/foo\n-rw-r--r--   1 hdfs   users               5 2014-03-25 16:32 /user/usrxyz/foo/test.txt\ndrwxr-xr-x   - abc    abc                 0 2014-03-27 16:10 /user/usrxyz/foo-empty\n[usrxyz@vm001 root]$ su usrxyz\n[usrxyz@vm001 root]$ whoami\nusrxyz\n[usrxyz@vm001 root]$ hdfs dfs -rm -r /user/usrxyz/foo-empty\n14/03/28 16:45:22 INFO fs.TrashPolicyDefault: Namenode trash configuration: Deletion interval = 0 minutes, Emptier interval = 0 minutes.\nrm: Permission denied: user=usrxyz, access=ALL, inode=\"/user/usrxyz/foo-empty\":abc:abc:drwxr-xr-x\n[usrxyz@vm001 root]$ hdfs dfs -rmdir /user/usrxyz/foo-empty\nrmdir: Permission denied: user=usrxyz, access=ALL, inode=\"/user/usrxyz/foo-empty\":abc:abc:drwxr-xr-x\n[usrxyz@vm001 root]$ hdfs dfs -rm -r -f /user/usrxyz/foo-empty\n14/03/28 16:51:31 INFO fs.TrashPolicyDefault: Namenode trash configuration: Deletion interval = 0 minutes, Emptier interval = 0 minutes.\nrm: Permission denied: user=usrxyz, access=ALL, inode=\"/user/usrxyz/foo-empty\":abc:abc:drwxr-xr-x\n[usrxyz@vm001 root]$ \n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-28T23:56:04.133+0000","updated":"2014-03-28T23:56:04.133+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13951640","id":"13951640","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~cnauroth], just saw your comments, thanks for the info. \n\nSecion 2.b in http://pubs.opengroup.org/onlinepubs/9699919799/utilities/rm.html says:\n\n{code}\nIf the -f option is not specified, and either the permissions of file do not permit writing and the standard input is a terminal or the -i option is specified, rm shall write a prompt to standard error and read a line from the standard input. If the response is not affirmative, rm shall do nothing more with the current file and go on to any remaining files.\n{code}\n\nI found another link http://wiki.dreamhost.com/Unix_File_Permissions that talks about deleting empty subdirectory:\n\n{code}\nFor a directory, read (\"r\") means that the grantee has permission to see what files and directories have been placed inside of that directory. Write (\"w\") means that the grantee has permission to create new files within that directory and to delete the directory (when empty). Execute (\"x\") means that the grantee can \"cd\" or change into the directory. (Without \"x\", the user can't actually read or write either.)\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-29T00:20:15.210+0000","updated":"2014-03-29T00:20:15.210+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13954361","id":"13954361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thank you all for the comments and discussions and reviews.\n\nUploaded version 002 to fix all three issues summarized in my last update.\n\nThere are a few questions to ask you experienced folks:\n\n1. This fix involves changing ClientNamenodeProtocol.proto by adding an optional bit to message DeleteRequestProto to indicate whether \"-f\" is specified. Is there any implication of API compatibility here?\n\n2. This change involves both files in hadoop-common-project and hadoop-hdfs-project, is it fine to be covered by this single JIRA?\n\n3. To address Andrew's comments on how the test is written, I discussed with him, and we had an agreement that it would be beneficial to have this new testing infrastructure for FsShelll operations (TestFsShellPrivilege.java introduced with this fix). It has the advantage of manipulating file structure, ownership, permission, and calling FsShell with command line arguments, and easy debugging with eclipse.\n\nMy test result with the fix:\n{code}\n[usrxyz@vm001 hadoop]$ hadoop fs -lsr /\nlsr: DEPRECATED: Please use 'ls -R' instead.\ndrwxr-xr-x   - hdfs supergroup          0 2014-03-25 16:29 /user\ndrwxr-xr-x   - hdfs   supergroup          0 2014-03-25 16:28 /user/hdfs\ndrwxr-xr-x   - usrxyz users               0 2014-03-29 10:19 /user/usrxyz\ndrwxr-xr-x   - abc    users               0 2014-03-25 16:32 /user/usrxyz/foo\n-rw-r--r--   1 abc    users               5 2014-03-25 16:32 /user/usrxyz/foo/test.txt\ndrwxr-xr-x   - abc    users               0 2014-03-29 10:18 /user/usrxyz/foo-empty\ndrwxr-xr-x   - abc    users               0 2014-03-29 10:18 /user/usrxyz/foo-empty1\ndrwxr-xr-x   - abc    users               0 2014-03-29 10:19 /user/usrxyz/foo-empty2\n[usrxyz@vm001 hadoop]$ whoami\nusrxyz\n[usrxyz@vm001 hadoop]$ hdfs dfs -rm -r /user/usrxyz/foo\n14/03/29 10:20:42 INFO fs.TrashPolicyDefault: Namenode trash configuration: Deletion interval = 0 minutes, Emptier interval = 0 minutes.\nrm: Permission denied: user=usrxyz, access=ALL, inode=\"/user/usrxyz/foo\":abc:users:drwxr-xr-x\n[usrxyz@vm001 hadoop]$ hdfs dfs -rm -r /user/usrxyz/foo-empty\n14/03/29 10:20:54 INFO fs.TrashPolicyDefault: Namenode trash configuration: Deletion interval = 0 minutes, Emptier interval = 0 minutes.\nrm: Permission denied: user=usrxyz, access=ALL, inode=\"/user/usrxyz/foo-empty\":abc:users:drwxr-xr-x. Consider trying again with -f switch.\n[usrxyz@vm001 hadoop]$ hdfs dfs -rm -r -f /user/usrxyz/foo-empty\n14/03/29 10:21:06 INFO fs.TrashPolicyDefault: Namenode trash configuration: Deletion interval = 0 minutes, Emptier interval = 0 minutes.\nDeleted /user/usrxyz/foo-empty\n[usrxyz@vm001 hadoop]$ hdfs dfs -rmdir /user/usrxyz/foo-empty1\n\n[usrxyz@vm001 hadoop]$ hdfs dfs -rmdir /user/usrxyz/foo\nrmdir: `/user/usrxyz/foo is non empty\n[usrxyz@vm001 hadoop]$ whoami\nusrxyz\n[usrxyz@vm001 hadoop]$ su abc\nPassword: \n[abc@vm001 hadoop]$ whoami\nabc\n[abc@vm001 hadoop]$ hdfs dfs -rmdir /user/usrxyz/foo-empty2\nrmdir: Permission denied: user=abc, access=WRITE, inode=\"/user/usrxyz\":usrxyz:users:drwxr-xr-x\n{code}\n\nThanks a lot for reviewing the fix.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-29T17:46:10.436+0000","updated":"2014-03-29T17:46:10.436+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13954372","id":"13954372","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12637658/HDFS-6165.002.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.\n\n    {color:red}-1 javac{color:red}.  The patch appears to cause the build to fail.\n\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/6553//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-03-29T18:06:39.284+0000","updated":"2014-03-29T18:06:39.284+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13954405","id":"13954405","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"Here's what I get on my mac (BSD based 10.9) which seems similar to the previously posted results.  It's a full recap to spare others reading this whole discussion.\n\nFails because no perms at all to see dir contents.\n{noformat}\n$ mkdir -p test/bar; sudo chown root test/bar; sudo chmod a= test/bar\n$ rm -rf test\nrm: test/bar: Permission denied\nrm: test: Directory not empty\n{noformat}\n\nFails because execute but no read perms to see dir contents.\n{noformat}\n$ mkdir -p test/bar; sudo chown root test/bar; sudo chmod a=x test/bar\n$ rm -rf test\nrm: test/bar: Permission denied\nrm: test: Directory not empty\n{noformat}\n\nWorks because of read perms and -f flag.\n{noformat}\n$ mkdir -p test/bar; sudo chown root test/bar; sudo chmod a=r test/bar\n$ rm -rf test\n{noformat}\n\nRead perms sans -f require a prompt??\n{noformat}\n$ mkdir -p test/bar; sudo chown root test/bar; sudo chmod a=r test/bar\n$ rm -r test\noverride r--r--r--  root/wheel for test/bar?\n{noformat}\n\nWorks because can't prompt with no STDIN.\n{noformat}\n$ mkdir -p test/bar; sudo chown root test/bar; sudo chmod a=r test/bar\n$ perl -e 'close(STDIN); system(\"rm -r test\")'\n{noformat}\n\n---\n\nQuick summary:\n# the kernel will delete a non-owned directory if and only if the user has read perms which allow it to determine the directory is empty\n# it's the userland rm that decides if it should prompt to delete a non-owned directory\n\nI don't agree with any incompatible changes to the NN protocol.  Years ago I made FsShell as POSIX like as possible and have always argued for POSIX behavior since.  However, I find the prompting silly and incompatible.  It's a userland check so adding this support to the NN doesn't make sense to me.\n\nMy opinion is the only change should be the NN allows empty dirs be deleted if the user has read perms.  No changes to -f.  Let -f continue to mean \"If the file does not exist, do not display a diagnostic message or modify the exit status to reflect an error\".\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2014-03-29T19:26:56.255+0000","updated":"2014-03-29T19:26:56.255+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13954431","id":"13954431","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"HI [~daryn],\n\nThanks a lot for your experiments and comments. The read permission thing is indeed what's not noticed earlier. It definitely need to be addressed. Several follow-up  questions here:\n\n1. My understanding of your point is, if the empty sub-dir has read permission, then \"-rm <subdir>\"  and \"-rmdir\" would simply go ahead remove the dir, even though all linux systems we tested so far prompt user (when possible), right? If the answer is yes, then the userland won't have a choice whether it should prompt to user (as in your summary point #2). I think this solution works fine for me, but would you please confirm? The folks who commented earlier may comment on this too.\n\n2. Not to say that we have to do this, for my better understanding, does adding -f support to the NN protocol as an optional field break compatibility? (my bad in version 002, I did miss some places to change, the scope seems to be wide because it's an additional API that I'm adding).\n\n3. Just to clarify, I actually tried to avoid prompting with the patch. At occasions when linux prompts, the patch I did throws exception like before, however, with improved message to suggestion user to try -f switch.\n\nBTW, your second to last experiment \"Read perms sans -f require a prompt??\" didn't really use \"-f\" switch,  but sounds like you intended to use \"-f\" in this test, if so,  would you please retry this one with \"-f\"? \n\nThanks again.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-29T20:36:36.471+0000","updated":"2014-03-29T20:36:36.471+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13954512","id":"13954512","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"While we are still discussing about the solution, I'm uploading a new revision 003 to resolve the missed stuff from previous one.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-29T23:49:53.792+0000","updated":"2014-03-29T23:49:53.792+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13954555","id":"13954555","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12637675/HDFS-6165.003.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs hadoop-tools/hadoop-extras:\n\n                  org.apache.hadoop.fs.TestFilterFileSystem\n                  org.apache.hadoop.fs.TestFilterFs\n                  org.apache.hadoop.fs.TestHarFileSystem\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/6555//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/6555//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-03-30T02:45:01.964+0000","updated":"2014-03-30T02:45:01.964+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13954803","id":"13954803","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hello [~daryn],\n\nI did the same set of experiments on my OS and saw different results than yours. It indicates different OS implements it differently.\n\nPlatform, user and command info\n{code}\n[usrxyz@yjzsn ~]$ whoami\nusrxyz\n[usrxyz@yjzsn ~]$ groups usrxyz\nusrxyz : usrxyz\n[usrxyz@yjzsn ~]$ which rm\n/bin/rm\n[usrxyz@yjzsn ~]$ alias | grep rm\n[usrxyz@yjzsn ~]$ uname -a\nLinux yjzsn 2.6.32-358.2.1.el6.x86_64 #1 SMP Wed Mar 13 00:26:49 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux\n[usrxyz@yjzsn ~]$ cat /etc/*release*\nCentOS release 6.4 (Final)\nLSB_VERSION=base-4.0-amd64:base-4.0-noarch:core-4.0-amd64:core-4.0-noarch:graphics-4.0-amd64:graphics-4.0-noarch:printing-4.0-amd64:printing-4.0-noarch\ncat: /etc/lsb-release.d: Is a directory\nCentOS release 6.4 (Final)\nCentOS release 6.4 (Final)\ncpe:/o:centos:linux:6:GA\n{code}\n\nTest 1 (no permissions)\n{code}\n[usrxyz@yjzsn ~]$ \n[usrxyz@yjzsn ~]$ mkdir -p test/bar; sudo chown root test/bar; sudo chmod a= test/bar\n[usrxyz@yjzsn ~]$ ls -lrt -R test\ntest:\ntotal 4\nd--------- 2 root usrxyz 4096 Mar 30 11:56 bar\nls: cannot open directory test/bar: Permission denied\n[usrxyz@yjzsn ~]$ rm -rf test\n{code}\n\nTest 2 (no read perm)\n{code}\n[usrxyz@yjzsn ~]$ mkdir -p test/bar; sudo chown root test/bar; sudo chmod a=x test/bar\n[usrxyz@yjzsn ~]$ rm -rf test\n[usrxyz@yjzsn ~]$ \n{code}\n\nTest 3 (has read perm and -f)\n{code}\n[usrxyz@yjzsn ~]$ mkdir -p test/bar; sudo chown root test/bar; sudo chmod a=r test/bar\n[usrxyz@yjzsn ~]$ rm -rf test\n[usrxyz@yjzsn ~]$ \n{code}\n\nTest 4 (has read perm and no -f, prompt)\n{code}\n[usrxyz@yjzsn ~]$ mkdir -p test/bar; sudo chown root test/bar; sudo chmod a=r test/bar\n[usrxyz@yjzsn ~]$ rm -r test\nrm: remove write-protected directory `test/bar'? n\n[usrxyz@yjzsn ~]$ \n{code}\n\nTest 5 (has read perm, no STDIN):\n{code}\n[usrxyz@yjzsn ~]$ mkdir -p test/bar; sudo chown root test/bar; sudo chmod a=r test/bar\n[usrxyz@yjzsn ~]$ perl -e 'close(STDIN); system(\"rm -r test\")'\n[usrxyz@yjzsn ~]$ \n{code}\n\nQuick summary:  on CentOs, both \"rmdir\" and \"rm -r -f \" removes empty subdir, even if the empty subdir \ndoesn't have read permission. It even delete when there is no permission at all.\n\nThese experiments are just for info collection purpose. I think we should probably comply with the most stringent system \nrather than the most relaxing system.\n\nBTW, Please ignore my earlier comment about \"BTW, your second to last experiment...\"), I interpreted it incorrectly.\n\nThanks.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-30T19:11:13.748+0000","updated":"2014-03-30T19:11:13.748+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13954846","id":"13954846","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~cnauroth], \n\nI revisited your comments at -28/Mar/14 16:47 and studied the POSIX spec,  and understood your points better.\n\n{quote}\nrm: If the current file is a directory, rm shall perform actions equivalent to the rmdir() ...\n\nThe rmdir() function shall fail if:\n[EACCES]\n Search permission is denied on a component of the path prefix, or write permission is denied on the parent directory of the directory to be removed.\n{quote}\n\nAs you pointed out, there is mention of permission on the component of the path prefix, but there is no mention of permission on the directory to be removed.  What it meant seems to be \"empty dir's permission can be ignored\" when other permissions described in the above quote are satisfied. \nAnd my experiments show that the CentOs implementation does that. \n\nMaybe  the test results [~daryn] got on his Mac is also a \"nicety of the shell utility\" on mac: it checks the read permission of dir even though it's empty.\n\nI looked at \"Advanced Programming in the UNIX Environment\" textbook written by W. Richard Stevens, it says:\n{quote}\nTo delete an existing file, we need write permission and execute permission in the directory containing the file, We do not need read permission or write permission for the file itself.\n{quote}\nHe talks about delete existing file, but not existing directory.\n\nThe link I found http://wiki.dreamhost.com/Unix_File_Permissions says\n{quote}\nFor a directory, ..., Write (\"w\") means that the grantee has permission to create new files within that directory and to delete the directory (when empty).\n{quote}\n\nI wonder whether we should also ignore the empty dir's permissions in this case in HDFS.\n\nThanks you all again.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-30T21:59:53.914+0000","updated":"2014-03-30T21:59:53.914+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13955993","id":"13955993","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hello Guys,\n\nNot to change the current meaning of -f switch, there are two options here:\n\n1. \"rmdir\" and \"rm -r\" will remove empty directory, as long as the permissions described in POSIX spec is satisfied:\n  {quote}\nThe rmdir() function shall fail if:\n[EACCES]\nSearch permission is denied on a component of the path prefix, or write permission is denied on the parent directory of the directory to be removed.\n{quote}\n\n2. same as 1, except  in addition, the read permission of the empty directory is required.\n\nI favor #1 based on the info collected and my understanding so far.  Would you guys please review the info posted earlier and comment again to see if we can agree on one of them? \n\nThanks a lot.\n\n--Yongjun\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-01T01:32:19.630+0000","updated":"2014-04-01T01:32:19.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13958952","id":"13958952","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Revision 004 to address Daryn's comments.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-03T16:42:53.897+0000","updated":"2014-04-03T16:42:53.897+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13958981","id":"13958981","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~daryn],\n\nThanks for your earlier comment at 29/Mar/14 12:26. I've uploaded patch revision 004 to address them. Would you please help reviewing this version? Thanks a lot.\n\nSome notable changes and comments:\n\n1. No -f is introduced as in previous patch revisions.\n\n2. When deleting empty directory, in addition to the other permissions, READ permission is required for the empty directory.\n\n3. Prior to my change, Rmdir command uses listStatus method to check whether it's empty. Curently the listStatus method requires both READ and EXECUTE permission. My patch changed the way how to check whether a directory is empty by using PathIsNotEmptyDirectoryException.\n\n4. As stated in 3, listStatus method requires READ and EXECUTE permission. For the purpose of checking whether a dir is empty, we probably can have another lightweight API that only requires READ permission. I did not introduce this API, but I can do it if we can agree upon.\n\nMy understanding is, listStatus is similar to command \"ls -l\".  I think the new API would be similar to \"ls\". Basically the new API should be able to tell how many entries in a directory without the need of EXECUTE permission, below is how centOs system works, when the target directory has no EXECUTE permission:\n{code}\n[root@yjzsn usrxyz]# ls -lrt\ntotal 24\ndrwx------ 2 abc abc 4096 Apr  2 17:39 abc-notempty\ndrwxr--r-- 2 abc abc 4096 Apr  2 17:39 abc-notempty1\ndrwx------ 2 abc abc 4096 Apr  2 17:39 abc-empty\ndrwxr----- 2 abc abc 4096 Apr  2 17:39 abc-empty1\ndrwx---r-- 2 abc abc 4096 Apr  2 17:39 abc-empty2\ndrwxr--r-- 2 abc abc 4096 Apr  2 17:39 abc-empty3\n[root@yjzsn usrxyz]# su usrxyz\n[usrxyz@yjzsn ~]$ ls abc-notempty\nls: cannot open directory abc-notempty: Permission denied\n\n[usrxyz@yjzsn ~]$ ls abc-notempty1   <== with READ perm, this one lists the file name in it (xyz.txt), prints \"Permission denied\" because of xyz.txt's permission\nls: cannot access abc-notempty1/xyz.txt: Permission denied\nxyz.txt\n\n[usrxyz@yjzsn ~]$ \n[usrxyz@yjzsn ~]$ ls abc-empty1\nls: cannot open directory abc-empty1: Permission denied\n[usrxyz@yjzsn ~]$ ls abc-empty2\n[usrxyz@yjzsn ~]$ ls abc-empty3\n[usrxyz@yjzsn ~]$ \n{code}\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-03T17:09:11.787+0000","updated":"2014-04-03T17:09:11.787+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13959128","id":"13959128","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12638514/HDFS-6165.004.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 3 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs hadoop-tools/hadoop-extras:\n\n                  org.apache.hadoop.hdfs.server.datanode.TestBlockRecovery\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/6578//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/6578//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-03T19:45:42.922+0000","updated":"2014-04-03T19:45:42.922+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13959191","id":"13959191","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"The test failure appears to be irrelevant to this change, local test showed this test passed too. Upload the same patch to trigger another test run.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-03T20:44:45.983+0000","updated":"2014-04-03T20:44:45.983+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13959437","id":"13959437","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:green}+1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12638556/HDFS-6165.004.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 3 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs hadoop-tools/hadoop-extras.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/6579//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/6579//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-03T23:46:19.179+0000","updated":"2014-04-03T23:46:19.179+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13969133","id":"13969133","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Yongjun, sorry about the delay in reviewing this. Thanks for the work thus far.\n\nI think the semantics for a recursive delete via DistributedFileSystem#delete are still not quite right. The change you made will work for the shell since it does its own recursion, but we need to do the same \"remove if empty dir with read\" when recursing via {{recursive = true}} too. You might be able to do this by modifying {{FSPermissionChecker#checkSubAccess}} appropriately, but a new flag or new code would be safer.\n\nMore comments:\n* isDirectory, can we add per-parameter javadoc rather than stacking on the {{@return}}? I think renaming {{empty}} to {{isEmpty}} would also help.\n* Nit, also need a space in the ternary {{empty?}} and {{dir.isEmptyDirectory(src)?}}.\n* In Delete, I think it's a bit cleaner to do an {{instanceof PathIsNotEmptyDirectoryException.class}} check instead.\n* Some lines longer than 80 chars\n\nTestFsShellPrivilege:\n\nI gave this a quick pass, but overall it may be better to rewrite these to use the DFS API instead of the shell. We need to test recursive delete, which the shell doesn't do, and we don't really have any shell changes in the latest rev, which lessens the importance of having new shell tests.\n\n* execCmd needs to do some try/finally to close and restore the streams if there's an exception. Also an extra commented line there.\n* Could we rename this file to \"TestFsShellPermission\"? Permission is a more standard term.\n* This file also should not be in hadoop-tools, but rather hadoop-common.\n* This does a lot of starting and stopping of a MiniCluster for running single-line tests. Can we combine these into a single test? We also don't need any DNs for this cluster, since we're just testing perms.\n* We have FileSystemTestHelper#createFile for creating files, can save some code\n* Use of @Before and @After blocks might also clarify what's going on.\n* This also should be a JUnit4 test with @Test annotations, not JUnit3.\n* USER_UGI should not be all caps, it's not static final\n* It's a bit ugly how we pass UNEXPECTED_RESULT in for a lot of tests. Can we just pass a boolean for {{expectSuccess}} or {{expectFailure}}, or maybe a String that we can call {{assertExceptionContains}} on?\n* FileEntry looks basically like a FileStatus, can we just use that instead?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-15T01:57:24.050+0000","updated":"2014-04-15T01:57:24.050+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13969735","id":"13969735","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Andrew, Thanks a lot for your detailed review, I will try to address them as soon as possible.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-15T16:55:54.757+0000","updated":"2014-04-15T16:55:54.757+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13969739","id":"13969739","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"I lost track of this jira.  I'll catch up today.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2014-04-15T16:59:52.137+0000","updated":"2014-04-15T16:59:52.137+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13969806","id":"13969806","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"Two-part comment to avoid overly lengthy response.\n\nThe FsShell logic isn't correctly.  You can't simply ignore non-empty dirs.  Removal of the parent dir will fail too.  I think the shell rm will then return 0 (success) even though it miserably failed.  Checking for RemoteException is making assumptions about hdfs semantics, and searching for a substring is very fragile.\n\nI guess I should step back and explain how posix deletes work, although maybe everyone already knows this.  There is no recursive delete.  A userland tool has to recurse the directory structure and remove all children.  Rm prompts when it cannot traverse a directory (lack of perms).  However, the kernel will treat an empty directory just like a file - no permissions are required to delete.  Rm is prompting because it doesn't know if the remove will work.\n\n(Sidenote: I tested on my mac and it will allow rmdir of a non-perm empty dir, so it's rm just being fussy and not trying to delete when -f is given even though it could)\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2014-04-15T17:46:51.799+0000","updated":"2014-04-15T17:46:51.799+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13970052","id":"13970052","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"After looking over the FsShell code, I'll revise my stance.  I think the only change, for now, is the NN should only check permissions of the parent directory for deletes.  The permissions of the file/dir shouldn't matter.  FsShell isn't recursively descending like I thought...  (Explains why deletion of a dir with millions of files took down a NN)\n\nWhile it's technically wrong and violates posix to allow deleting a non-empty directory to which the user has no permissions, it doesn't make anything worse.  The NN's recursive delete is already terribly broken in that it ignores permissions deeper in the tree.\n\nI bet for the described problem, you could delete the no-perms dir if you created a new directory, moved the no-perms dir into it, and then recursively deleted the new directory.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2014-04-15T20:56:39.788+0000","updated":"2014-04-15T20:56:39.788+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13970062","id":"13970062","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. I think the only change, for now, is the NN should only check permissions of the parent directory for deletes.\n\n+1 to this proposal.  I think it's the simplest approach to fixing the current bug.  Enhancements beyond that could be addressed in separate patches if needed.\n\n[~yzhangal], thank you for sticking with this tricky issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-15T21:13:51.746+0000","updated":"2014-04-15T21:13:51.746+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13975064","id":"13975064","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hello [~daryn] and [~cnauroth],\n\nThanks a lot for the comments you guys made above! I'm sorry for being late, I have been working on some more priority issues and putting aside this jira, I didn't even see your comments until now.\n\nWill address all your comments next week.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-20T05:50:04.415+0000","updated":"2014-04-20T05:50:04.415+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13981505","id":"13981505","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"HI Guys, \n\nThanks a lot for the review/comments you did, and sorry again for getting back late. \n\nInstead of posting another patch to address all comments, I'd like to summary the solution here first.  Sorry for a long posting again. Would you please help review the proposed solution below and see if you agree? I will address other comments when putting together a new revision of patch. Many thanks.\n\nThere are two commands that have problem here\n\n1. hdfs dfs -rmdir (refer to as rmdir in later discussion)\n2. hdfs dfs -rm -r (refer to as rmr in later discussion)\n\nBoth commands eventually will call FSnamesystem#deleteInternal method\n{code}\n  private boolean deleteInternal(String src, boolean recursive,\n      boolean enforcePermission, boolean logRetryCache)\n      throws AccessControlException, SafeModeException, UnresolvedLinkException,\n             IOException {\n{code}\n\nThe deleteInternal methods throws exception if recursive is not true and the src to be deleted is not empty; otherwise, it will check \"necessary\" permissions and collect all blocks/inodes to be deleted and delete them recursively. The deletion process excludes snapshottable dirs that has at least one snapshot.\n\nRight now it requires FULL permission of the subdirs or files under the target dir to be deleted. This permission checking is also recursive, it requires all child has FULL permission), This is the place we try to fix for different scenarios.\n\nrmr calls with the \"recursive\" parameter passed as true,  and rmdir calls with the \"recursive\" parameter with false.\n\nSolution summary:\n\n1. rmdir\n\nThe recursion issue in the comments you guys made is only relevant to rmr.  So the solution for rmdir is a simple:\n\n- for nonempty directory, deleteInternal simply throws nonemptydir exception if it's nonempty, and the FsShell side catch the exception\n- for empty directory, only check parent/prefix permission, ignore the target dir's permission (posix compliant), delete if the permission is satisfied, throw exception otherwise.\n\n2. rmr\n\nThe last patch (version 004) I posted only checks whether the target dir to be deleted has READ permission (the earlier versions ignore the target dir's permission when it's empty), and I didn't change the behaviour to check subdir for non-empty target dir. For non-empty target dir, the current implementation  requires FULL permission of subdir in order to delete a subdir even if the subdir is empty. This is not quite right as [~andrew.wang] pointed out.\n\nI'd like to try to implement what Andrew suggested with an additional/different parameter than subAccess of FSPermissionChecker#checkSubAccess\nE.g. add emptyDirSubAccess\n{code}\nvoid checkPermission(String path, INodeDirectory root, boolean doCheckOwner,\n      FsAction ancestorAccess, FsAction parentAccess, FsAction access,\n      FsAction subAccess, FsAction emptyDirSubAccess, boolean resolveLink)\n{code}\nThe subAccess will passed FsAction.ALL (as is currently) and emptyDirSubAccess will be passed FsAction.NONE.\n\nAnd if a subdir is not empty, check against subAccess, if it's empty, check against emptyDirSubAccess.\n\nAbout using FsAction.ALL for subAccess parameter, it's a bit over stringent for intemediate path, say, if we want to delete <targetDir>/a/b/c, we don't have to have WRITE permission of <targetDir>/a, but we need to have WRITE permission of <targetDir>/a/b. We might address this issue in a separate JIRA if you agree.\n\nHi [~daryn], the following is actually not true to me\n{quote}\nI bet for the described problem, you could delete the no-perms dir if you created a new directory, moved the no-perms dir into it, and then recursively deleted the new directory.\n{quote}\nBecause the current implementation recursively requires FULL permission of subdirs/files to delete them.\nIf we suddenly change the implementation to allow deleting non-empty dir without checking the subdir/file permission, I'm worried about bad user impact. \n\nThanks again for your time.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-25T19:47:24.975+0000","updated":"2014-04-25T19:47:24.975+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13982001","id":"13982001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"I need to amend the rmr section in my last update. \n\nCommand: \"hdfs dfs -rm -r <targetDir>\"\n\nExpected result: recursively delete all components under <targetDir> and <targetDir> itself.\n\nFrom POSIX quote from our earlier discussion,  for any component to be deleted,\n\nif the component is a file or empty-dir, permissions required are:\n\n  - Search permission of all components of the path prefix, \n  - WRITE permission of the parent directory of the directory to be removed.\n\nif the component to delete is a non-empty-dir, recursively apply the above permissions to its child components.\n\nThe PROBLEM we are solving here is, that currently FsActions.ALL is passed to subAccess parameter:\n{code}\nvoid checkPermission(String path, INodeDirectory root, boolean doCheckOwner,\n      FsAction ancestorAccess, FsAction parentAccess, FsAction access,\n      FsAction subAccess, boolean resolveLink)\n{code}\n\nwhich disallows removal of file and empty-dir component under the <targetDir> (got exception asking for ALL permission), if the component doesn't have ALL permissions..\n\nGiven an example how to solve this, \"hdfs dfs -rm -r <targetDir>\", assume the <targetDir> contains:\n{code}\na\na/emptyDir\na/nonEmptyDir\na/nonEmptyDir/filex\n{code}\n\nto delete <targetDir>, we need the following permissions (ALL means RWX):\n{code}\nPrefix components of <targetDir>: search permission (READ and EXECUTE)\nParent componet of <targetDir>:   ALL\n<targetDir>:                                   ALL\na:                                                   ALL\na/emptyDir:                                    NONE\na/nonEmptyDir:                              ALL\na/nonEmptyDir/filex:                       NONE\n{code}\n\nSo what we can do is to modify checkPermission. Since checkPermission used by multiple operations, the safe change for delete operation is to \n\n1. add a parameter leafAccess:\n{code}\nvoid checkPermission(String path, INodeDirectory root, boolean doCheckOwner,\n      FsAction ancestorAccess, FsAction parentAccess, FsAction access,\n      FsAction subAccess, FsAction leafAccess, boolean resolveLink)\n{code}\nNotice that I changed \"emptyDirSubAccess\" of my earlier version to \"leafAccess\" to cover both file and dir which are leaf (To be a leaf, the component has to be either a file or an empty dir). And we pass null to \"leafAccess\" parameter in deleteInternal function.\n\n2. modify checkPermission to apply subAccess on non-leaf component, and leafAccess to leaf component.\n\nThis change is only applicable to \"delete\" operation (by deleteInternal method), since checkPermission function is shared across the board, need to examine how to make this change not to impact other operations.\n\nThanks.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-26T14:36:47.120+0000","updated":"2014-04-26T14:36:47.120+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13983980","id":"13983980","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi,\n\nThanks a lot for your earlier comments, and thanks Andrew a lot for the detailed review!\n\n I just updated patch version 005 to address all.\n\nFor rmdir, it's the solution I described in above;\nFor rmr solution, I actually did\n{code}\nvoid checkPermission(String path, INodeDirectory root, boolean doCheckOwner,\n      FsAction ancestorAccess, FsAction parentAccess, FsAction access,\n      FsAction subAccess, boolean ignoreEmptyDir, boolean resolveLink)\n{code}\nThe two parameters \"subAccess\" and \"ignoreEmptyDir\" work together, \n- if subAccess is not NULL, access permission of subDirs are checked, \n- when subAccess is checked, if ignoreEmptyDir is true, ignore\n  empty directories.\n\nTo address Andrew's comments\n{quote}\nI think the semantics for a recursive delete via DistributedFileSystem#delete are still not quite right. The change you made will work for the shell since it does its own recursion, but we need to do the same \"remove if empty dir with read\" when recursing via recursive = true too. You might be able to do this by modifying FSPermissionChecker#checkSubAccess appropriately, but a new flag or new code would be safer.\n{quote}\nThanks a lot for pointing this out, indeed it's a problem there. See above described solution, except we agreed that we don't need to check permission for empty dir.\n\n{quote}\n    isDirectory, can we add per-parameter javadoc rather than stacking on the @return? I think renaming empty to isEmpty would also help.\n    Nit, also need a space in the ternary empty? and dir.isEmptyDirectory(src)?.\n{quote}\nThese are now gone with new solution.\n\n{code}\n    In Delete, I think it's a bit cleaner to do an instanceof PathIsNotEmptyDirectoryException.class check instead.\n{code}\nThis is handled in a better way now. I discovered a bug HADOOP-10543 (and posted a patch) when looking at this. With HADOOP-10543 committed, I would be able to do exactly what Andrew suggested. But I think what I have in this new revision should fine too.\n{quote}\n    Some lines longer than 80 chars\n{quote}\nHopefully all addressed:-)\n\n{quote}\nTestFsShellPrivilege:\nI gave this a quick pass, but overall it may be better to rewrite these to use the DFS API instead of the shell. We need to test recursive delete, which the shell doesn't do, and we don't really have any shell changes in the latest rev, which lessens the importance of having new shell tests.\n{quote}\nI think adding a test infra like what I added give another  option here, hopefully the new revision looks better:-)\n\n{quote}\n    execCmd needs to do some try/finally to close and restore the streams if there's an exception. Also an extra commented line there.\n{quote}\nThis FsShell actually took care of catching exception, so the stream will not get lost. Extra comment line removed.\n\n{quote}\n    Could we rename this file to \"TestFsShellPermission\"? Permission is a more standard term.\n{quote}\nDone.\n\n{quote}\n    This file also should not be in hadoop-tools, but rather hadoop-common.\n{quote}\nBecause it uses MiniDFSCluster, it can not be in hadoop-common. But I moved to hdfs test area now.\n\n{quote}\n    This does a lot of starting and stopping of a MiniCluster for running single-line tests. Can we combine these into a single test? We also don't need any DNs for this cluster, since we're just testing perms.\n{quote}\nI refactored the code to take care of this. Since we create file, I still keep DNs.\n\n{quote}\n    We have FileSystemTestHelper#createFile for creating files, can save some code\n    Use of @Before and @After blocks might also clarify what's going on.\n    This also should be a JUnit4 test with @Test annotations, not JUnit3.\n    USER_UGI should not be all caps, it's not static final\n    It's a bit ugly how we pass UNEXPECTED_RESULT in for a lot of tests. Can we just pass a boolean for expectSuccess or expectFailure, or maybe a String that we can call assertExceptionContains on?\n{quote} \nAll are taken care of, except I forgot @before and @After, but hoopefully it looks much better now.\n\n{quote}\n    FileEntry looks basically like a FileStatus, can we just use that instead?\n{quote}\nFileEntry only have the fields needed for this test, and it's easier to manage in test area. I'm worried using FileStatus would be not easy to control. So I didn't do this. Hope it's acceptable.\n\nThanks in advance for a further review.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-29T04:35:02.993+0000","updated":"2014-04-29T04:35:02.993+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13984008","id":"13984008","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12642397/HDFS-6165.005.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.\n\n    {color:red}-1 javac{color:red}.  The patch appears to cause the build to fail.\n\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/6763//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-29T04:59:32.500+0000","updated":"2014-04-29T04:59:32.500+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13984729","id":"13984729","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Updated new version 006 to add a test area change missed in last one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-29T20:14:32.073+0000","updated":"2014-04-29T20:14:32.073+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13985606","id":"13985606","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Somehow test was not triggered by previous upload, uploaded the same version again to trigger test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-30T15:12:58.536+0000","updated":"2014-04-30T15:12:58.536+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13985954","id":"13985954","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12642655/HDFS-6165.006.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 3 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.metrics2.impl.TestMetricsSystemImpl\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/6777//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/6777//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-30T19:25:59.877+0000","updated":"2014-04-30T19:25:59.877+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13985972","id":"13985972","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"The failed test appears to be https://issues.apache.org/jira/browse/HADOOP-10062.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-30T19:40:46.031+0000","updated":"2014-04-30T19:40:46.031+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13987766","id":"13987766","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"I'm struggling to catch up on jiras so could you post a short summary of why changing the behavior of subaccess is insufficient?  It appears to maybe only be used by delete so adding another parameter to permission checking might be overkill.\n\nAlso, as previously mentioned you can't catch RemoteException since it's specific to hdfs and thus FsShell won't work correctly with other filesystems.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2014-05-02T15:07:45.057+0000","updated":"2014-05-02T15:07:45.057+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13987870","id":"13987870","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~daryn],\n\nThanks a lot for your comments. Adding the additional parameter is to avoid changing the behavior of any other callers to checkPermission. If subAccess is only used by deleteInternal method, then we can actually remove the additional parameter and change the behavior when we check subAccess.\n\nAbout catching RemoteException, thanks for pointing that out, I will do some further study how to address that.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-02T16:27:43.309+0000","updated":"2014-05-02T16:27:43.309+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13989946","id":"13989946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"HI [~daryn], \n\nI looked into callers of checkPermission, there are two other places in additional to delete operation:\n- FSNamesystem.getContentSummary method calls checkPermission with FsAction.READ_EXECUTE passed to subAccess.\n- FSNamesystem.checkSubtreeReadPermission method calls checkPermission with FsAction.READ passed to subAccess.\n so it looks like that we do need the additional parameter.\n\nAbout the RemoteException,  thanks for pointing out that FsShell won't work correctly with other filesystems with the patch. Since there are so many filesystems, the scope of change to address mkdir issue will be much more wide. I'm thinking about handling this in a separate JIRA. What do you guys think? With rmr fixed, it can serve as a workaround for rmdir issue.\n\nThanks.\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-05T20:43:12.787+0000","updated":"2014-05-05T20:43:12.787+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/13992080","id":"13992080","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Guys, \n\nThanks for your earlier review and comments.\n\nI created subtask HDFS-6351 for rmr and HDFS-6352 for rmdir.  I submitted a patch to HDFS-6351 by taking out the rmdir part from the patch for HDFS-6165 submitted here. Your further help in reviewing it is greatly appreciated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-07T18:31:18.413+0000","updated":"2014-05-07T18:31:18.413+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/14524780","id":"14524780","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"\\\\\n\\\\\n| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Patch URL | http://issues.apache.org/jira/secure/attachment/12642655/HDFS-6165.006.patch |\n| Optional Tests | javadoc javac unit findbugs checkstyle |\n| git revision | trunk / f1a152c |\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/10602/console |\n\n\nThis message was automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-02T04:38:44.265+0000","updated":"2015-05-02T04:38:44.265+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704060/comment/14524804","id":"14524804","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"\\\\\n\\\\\n| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Patch URL | http://issues.apache.org/jira/secure/attachment/12642655/HDFS-6165.006.patch |\n| Optional Tests | javadoc javac unit findbugs checkstyle |\n| git revision | trunk / f1a152c |\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/10612/console |\n\n\nThis message was automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-02T04:40:52.036+0000","updated":"2015-05-02T04:40:52.036+0000"}],"maxResults":63,"total":63,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-6165/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1tvpj:"}}