{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12779661","self":"https://issues.apache.org/jira/rest/api/2/issue/12779661","key":"HDFS-7886","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327584","id":"12327584","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2015-03-05T19:30:53.866+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Mar 17 15:34:11 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_930576993_*|*_1_*:*_2_*:*_85274735_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-03-16T20:01:14.678+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7886/watchers","watchCount":4,"isWatching":false},"created":"2015-03-05T01:50:22.987+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327584","id":"12327584","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"}],"issuelinks":[{"id":"12410076","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12410076","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"inwardIssue":{"id":"12780582","key":"HDFS-7906","self":"https://issues.apache.org/jira/rest/api/2/issue/12780582","fields":{"summary":"BlockReport of a RUR can have a FINALIZED original replica from Truncate","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12410603","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12410603","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12781904","key":"HDFS-7930","self":"https://issues.apache.org/jira/rest/api/2/issue/12781904","fields":{"summary":"commitBlockSynchronization() does not remove locations","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12409811","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12409811","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12772834","key":"HDFS-7740","self":"https://issues.apache.org/jira/rest/api/2/issue/12772834","fields":{"summary":"Test truncate with DataNodes restarting","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zero45","name":"zero45","key":"zero45","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zero45&avatarId=35141","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zero45&avatarId=35141","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zero45&avatarId=35141","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zero45&avatarId=35141"},"displayName":"Plamen Jeliazkov","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-04-10T20:30:29.156+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312916","id":"12312916","name":"test"}],"timeoriginalestimate":null,"description":"https://builds.apache.org/job/PreCommit-HDFS-Build/9730//testReport/","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327584","id":"12327584","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12702934","id":"12702934","filename":"HDFS-7886.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zero45","name":"zero45","key":"zero45","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zero45&avatarId=35141","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zero45&avatarId=35141","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zero45&avatarId=35141","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zero45&avatarId=35141"},"displayName":"Plamen Jeliazkov","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-06T00:14:00.975+0000","size":1285,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12702934/HDFS-7886.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12704297","id":"12704297","filename":"HDFS-7886-01.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-13T00:17:32.659+0000","size":8063,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12704297/HDFS-7886-01.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12704844","id":"12704844","filename":"HDFS-7886-02.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-16T18:46:02.439+0000","size":7265,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12704844/HDFS-7886-02.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12704851","id":"12704851","filename":"HDFS-7886-branch2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-16T19:01:19.323+0000","size":6870,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12704851/HDFS-7886-branch2.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"TestFileTruncate#testTruncateWithDataNodesRestart runs timeout sometimes","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14349330","id":"14349330","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"Some previous comments on this [see here|https://issues.apache.org/jira/browse/HDFS-7740?focusedCommentId=14337715&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14337715]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-05T19:30:53.866+0000","updated":"2015-03-05T19:30:53.866+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14349571","id":"14349571","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"I wouldn't rule out  HDFS-7695 though yet. Both are boiling down to a problem with block reports. TestFileTruncate directly triggers the report, while TestOpenFilesWithSnapshot causes the report by restarting.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-05T22:54:39.168+0000","updated":"2015-03-05T22:54:39.168+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14349661","id":"14349661","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zero45","name":"zero45","key":"zero45","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zero45&avatarId=35141","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zero45&avatarId=35141","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zero45&avatarId=35141","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zero45&avatarId=35141"},"displayName":"Plamen Jeliazkov","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~hitliuyi],\n\nI think I have found the problem.\nTwo things:\n\n# You trigger block recovery after you already fetch the \"newBlock\" variable. However, you actually need to wait for block recovery BEFORE the GenerationStamp will change on that block.\n# Also, you trigger block reports before block recovery, this was causing your BlockPool service thread to die because the block was being moved from FINALIZED to RUR state and hit an assertion.\n\nAttaching a small patch that appears to work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zero45","name":"zero45","key":"zero45","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zero45&avatarId=35141","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zero45&avatarId=35141","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zero45&avatarId=35141","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zero45&avatarId=35141"},"displayName":"Plamen Jeliazkov","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-06T00:13:36.629+0000","updated":"2015-03-06T00:13:36.629+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14349662","id":"14349662","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zero45","name":"zero45","key":"zero45","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zero45&avatarId=35141","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zero45&avatarId=35141","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zero45&avatarId=35141","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zero45&avatarId=35141"},"displayName":"Plamen Jeliazkov","active":true,"timeZone":"America/Los_Angeles"},"body":"Assigning to myself.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zero45","name":"zero45","key":"zero45","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zero45&avatarId=35141","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zero45&avatarId=35141","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zero45&avatarId=35141","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zero45&avatarId=35141"},"displayName":"Plamen Jeliazkov","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-06T00:14:42.780+0000","updated":"2015-03-06T00:14:42.780+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14349669","id":"14349669","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12702934/HDFS-7886.patch\n  against trunk revision 952640f.\n\n    {color:red}-1 patch{color}.  Trunk compilation may be broken.\n\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/9757//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-06T00:21:15.370+0000","updated":"2015-03-06T00:21:15.370+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14349925","id":"14349925","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12702934/HDFS-7886.patch\n  against trunk revision 952640f.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.hdfs.server.namenode.TestFileTruncate\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/9758//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/9758//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-06T04:07:20.784+0000","updated":"2015-03-06T04:07:20.784+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14350040","id":"14350040","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"I don't think this fixed it. Jenkins build failed and I see the same on some local runs. It starts with the assertion:\n{code}\n2015-03-06 02:01:49,248 WARN  datanode.DataNode (BPServiceActor.java:run(864)) - Unexpected exception in block pool Block pool BP-204559054-67.195.81.144-1425607203396 (Datanode Uuid 4fed10a8-2abc-47e3-abf4-aa9566f2df11) service to localhost/127.0.0.1:8020\njava.lang.AssertionError: Must be under-construction replica.\n\tat org.apache.hadoop.hdfs.protocol.BlockListAsLongs.setBlock(BlockListAsLongs.java:318)\n\tat org.apache.hadoop.hdfs.protocol.BlockListAsLongs.<init>(BlockListAsLongs.java:112)\n\tat org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsDatasetImpl.getBlockReports(FsDatasetImpl.java:1599)\n\tat org.apache.hadoop.hdfs.server.datanode.BPServiceActor.blockReport(BPServiceActor.java:458)\n\tat org.apache.hadoop.hdfs.server.datanode.BPServiceActor.offerService(BPServiceActor.java:722)\n\tat org.apache.hadoop.hdfs.server.datanode.BPServiceActor.run(BPServiceActor.java:856)\n\tat java.lang.Thread.run(Thread.java:745)\n2015-03-06 02:01:49,249 WARN  datanode.DataNode (BPServiceActor.java:run(867)) - Ending block pool service for: Block pool BP-204559054-67.195.81.144-1425607203396 (Datanode Uuid 4fed10a8-2abc-47e3-abf4-aa9566f2df11) service to localhost/127.0.0.1:8020\n2015-03-06 02:01:49,249 INFO  datanode.DataNode (BlockPoolManager.java:remove(103)) - Removed Block pool BP-204559054-67.195.81.144-1425607203396 (Datanode Uuid 4fed10a8-2abc-47e3-abf4-aa9566f2df11)\n2015-03-06 02:01:49,249 INFO  impl.FsDatasetImpl (FsDatasetImpl.java:shutdownBlockPool(2485)) - Removing block pool BP-204559054-67.195.81.144-1425607203396\n{code}\nThen the block pool is removed and the test times out since the replica is never reported as it is in the removed pool.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-06T06:56:14.350+0000","updated":"2015-03-06T06:56:14.350+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14350064","id":"14350064","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks Plamen for working on it.\nWe should trigger block reports immediately after datanode restart. \nAs Konst said, it's not the reason of timeout. Let's get some time to look at it and find the reason.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-06T07:26:50.767+0000","updated":"2015-03-06T07:26:50.767+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14350686","id":"14350686","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"I traced the latest failure with Plamen's fix. It actually points to the next test case {{testTruncateWithDataNodesShutdownImmediately()}}.\n\n1. I think we need to add {{checkBlockRecovery()}} after restarting the DataNodes, and check the file length before deleting. Otherwise {{testTruncateWithDataNodesShutdownImmediately()}} seems incomplete without checking anything.\n\nI did that, but then {{testCopyOnTruncateWithDataNodesRestart()}} fails. The symptom is the same - the assert error, but I think there may be a race condition between block recovery, which starts after the first block report and the second block report, which is explicitly triggered in the test.\nYi, I don't think we need to trigger block reports as restarting node will send one immediately after restarting. Triggering causes the second block report.\n\n2. I think we can fix the test by removing {{triggerBlockReports()}} after restarting DNs.\n\nBut we still need to investigate the potential race between block recovery and block reporting. In a different jira probably.\nSo I think Plamen's fix is right it just didn't cover all test cases.\nI know it is time consuming, because you need to run it several times before it fails - the nature of randomized tests. By adding waits on expected conditions we make it more deterministic.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-06T18:40:46.548+0000","updated":"2015-03-06T18:40:46.548+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14350718","id":"14350718","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"Forgot to mention\n\n3. We should keep SEED = 100\n4. Add replica printout to the assert in {{BlockListAsLongs}}, which helps debugging and does not effect runtime\n{{\"Must be under-construction replica: \" + r;}}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-06T18:58:18.058+0000","updated":"2015-03-06T18:58:18.058+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14351313","id":"14351313","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"More things that we've been looking at with Plamen. \n5. The race condition is in {{FsDatasetImpl.getBlockReports()}}, which collects the references to replicas under {{synchronizes}} section, but then constructs {{BlockListAsLongs}} outside of it. So if the recovery is triggered between them, then a replica can change its state. Here it changes from RUR to FINALIZED.\n6. {{testTruncateWithDataNodesRestartImmediately()}} occasionally fails because block is recovered only on two DNs. This happens because NN does not know that two DNs were restarted and can schedule block recovery with a mixture of old (before the restart) and new (after the restart) locations. If the old location is used then recovery fails, because the DN have been restarted under a new address. {{waitActive()}} doesn't help here. We should somehow check that all new DNs have been registered and sent block reports.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-07T01:53:52.796+0000","updated":"2015-03-07T01:53:52.796+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14352946","id":"14352946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks Konst for the detailed analyzing, also thanks Plamen.\n\n{quote}\nI think we can fix the test by removing {{triggerBlockReports()}} after restarting DNs.\n{quote}\nI use {{testTruncateWithDataNodesRestart}} as example to explain my concern.\nFor non copy-on-truncate, we should make sure the old block replica on restarted dn (for example dn0) is replaced with the truncated one, right?  The new truncated block id is the same as old one, but the GS(generationStamp) increases, we trigger block report for dn0 after it restarts, since the GS of replica for the last block is old on dn0, then the reported last block from dn0 will be marked corrupt on nn and replicas of last block should decrease 1 on nn, then the truncated block will be replicated to dn0.\n\nIf we remove {{triggerBlockReports()}}, not sure {{testTruncateWithDataNodesRestart}} will occasionally fail? Since {{checkBlockRecovery}} can success without block report or even without dn0 restarted, then following assertions may fail since the old block replica on dn0 is still not replaced with truncated one (block reports have not happened yet)ï¼Ÿ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-09T13:02:49.731+0000","updated":"2015-03-09T13:05:04.631+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14353400","id":"14353400","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zero45","name":"zero45","key":"zero45","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zero45&avatarId=35141","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zero45&avatarId=35141","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zero45&avatarId=35141","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zero45&avatarId=35141"},"displayName":"Plamen Jeliazkov","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Yi,\n\nI understand the problem a little better now.\n \nRemoving triggerBlockReports() doesn't fix the tests entirely; it causes the AssertionError to happen less frequently but does not otherwise fix the tests.\n\nThe problem comes down to this assert error.\n\nPrior to truncate, a replica, under normal operations, never changed state from FINALIZED to RUR. I understand that it COULD happen, but as far as test cases go I could not find one that tested such a case nor could I find a specification of such a case in the design doc in HDFS-265, which Konstantin referred me to.\n\nWhat is happening is that in the following code from FsDataSetImpl, the RUR's original replica points to a FINALIZED replica, because it is a truncate recovery operation:\n{code}\ncase RUR:\n            ReplicaUnderRecovery rur = (ReplicaUnderRecovery)b;\n            uc.get(rur.getVolume().getStorageID()).add(rur.getOriginalReplica());\n            break;\n{code}\n\nWe should open up a new issue to discuss the change, but in short, due to truncate, this assertion is no longer valid because a RUR can now point to a FINALIZED original replica.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zero45","name":"zero45","key":"zero45","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zero45&avatarId=35141","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zero45&avatarId=35141","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zero45&avatarId=35141","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zero45&avatarId=35141"},"displayName":"Plamen Jeliazkov","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-09T19:01:36.895+0000","updated":"2015-03-09T19:01:36.895+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14354411","id":"14354411","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"Yi, when DN restarts it sends a block report. Right after registering. If you call {{triggerBlockReports()}}, it will send the block report again, but this is not necessary, because block report already happened. Or I didn't understand why second block report is needed.\nPlamen, I agree we should investigate the race in HDFS-7906.\nFor this jira can we fix the test. We need something different from {{waitActive()}} to ensure that DNs have indeed restarted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-10T06:41:58.116+0000","updated":"2015-03-10T06:41:58.116+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14355028","id":"14355028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks Konst and Plamen for the comments. Following is reply to Konst, and I will reply to Plamen later.\n{quote}\nwhen DN restarts it sends a block report. Right after registering. If you call triggerBlockReports(), it will send the block report again, but this is not necessary, because block report already happened. Or I didn't understand why second block report is needed\n{quote}\nWe don't need two block reports, and we only want to ensure block report does happen after datanode restart and before we verify the old replica on dn0 is replaced with truncated one.\n\n{code}\ncluster.triggerBlockReports()\n{code}\nAbove test code will wait until block report is sent.  \nYes, DN restarts it sends a block report, but {{restartDataNode}} will return and will not wait for block report finishes, so in this situation we can't ensure block report does happen before we check replica on dn0.\n\n\n{{waitActive}} only check datanode is registered and sent heartbeat to NN. \nMaybe we can wait block report is sent after {{restartDataNode}} instead of trigger a new block report and wait it?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-10T15:04:45.954+0000","updated":"2015-03-10T15:04:45.954+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14356032","id":"14356032","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for clarifying Yi, I see it now: even though {{triggerBlockReports()}} causes second block report it also waits until it actually happens.\n\nLooking through other tests I think we should do the following:\n# {{stopDataNode()}}\n# On the NameNode mark the DN as dead, by calling {{DatanodeDescriptor.setLastUpdate(0)}} directly or using {{BlockManagerTestUtil.noticeDeadDatanode()}}\n# {{startDataNode()}}\n# Verify that DN reported via {{DatanodeDescriptor.getLastUpdate() > 0}}\n\nThis will ensure the DN actually restarted and reported the blocks, before the recovery is triggered. Also NN will know that DN is dead and will not schedule the recovery on it while it is down. Will that work?\nPotentially we can incorporate those checks into {{MiniDFSCluster.restartDataNode()}}.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-11T00:44:36.427+0000","updated":"2015-03-11T00:44:36.427+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14357877","id":"14357877","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Yes Konst, I agree with you, thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-12T00:35:32.215+0000","updated":"2015-03-12T00:35:32.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14359674","id":"14359674","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"Here is the patch with changes as described.\nI think it fixes the test. Ran 12 times without failures locally.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-13T00:17:32.665+0000","updated":"2015-03-13T00:17:32.665+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14359746","id":"14359746","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks Konst for the patch, let me take a look at it now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-13T01:30:15.917+0000","updated":"2015-03-13T01:30:15.917+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14359810","id":"14359810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Konst, the patch looks good to me, just one nit:\nIn {{testTruncateWithDataNodesRestartImmediately}}, we can also remove the {{cluster.triggerBlockReports()}}, +1 after addressing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-13T02:24:11.063+0000","updated":"2015-03-13T02:24:11.063+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14359911","id":"14359911","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12704297/HDFS-7886-01.patch\n  against trunk revision 8212877.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The following test timeouts occurred in hadoop-hdfs-project/hadoop-hdfs:\n\norg.apache.hadoop.hdfs.server.namenode.ha.TestHAAppend\norg.apache.hadoop.hdfs.server.blockmanagement.TestDatanodeManager\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/9866//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/9866//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-13T04:14:26.169+0000","updated":"2015-03-13T04:14:26.169+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14359944","id":"14359944","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zero45","name":"zero45","key":"zero45","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zero45&avatarId=35141","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zero45&avatarId=35141","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zero45&avatarId=35141","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zero45&avatarId=35141"},"displayName":"Plamen Jeliazkov","active":true,"timeZone":"America/Los_Angeles"},"body":"Konstantin I ran your patch locally multiple times, with the triggerBlockReports() commented out, as Yi had asked for, and everything passed.\n\n+1 pending Yi's suggestion addressed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zero45","name":"zero45","key":"zero45","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zero45&avatarId=35141","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zero45&avatarId=35141","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zero45&avatarId=35141","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zero45&avatarId=35141"},"displayName":"Plamen Jeliazkov","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-13T05:02:53.309+0000","updated":"2015-03-13T05:02:53.309+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14360903","id":"14360903","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"Hey guys, thanks for the reviews.\nCannot remove {{triggerBlockReports()}}, though. Just reran on my laptop without triggering and it failed. This is actually where I spent most of the time. The problem is in {{commitBlockSync()}}, which I was about to file a jira for, but will explain here first.\nIn short {{commitBlockSync()}} does not remove locations from the block, which were not confirmed, that is not reducing them to {{newTargets}}.\nIn the test truncate recovery is happening _while_ DNs are restarting.  If recovery is handled _after_ the initial block reports from restarting DNs, the recovery will have only one new target, the node that was not restarted, but {{commitBlockSync()}} will not remove the other two. So {{waitReplication()}} will incorrectly show 3 replicas, but {{cluster.getBlockFile().length}} on the restarted node will show the old length 4, while it should be 3. So I had to trigger block reports after the recovery, which  removes the two invalid replicas from NN, then replication is triggered, and the test passes.\nNow, if truncate recovery happens _before_ the initial block reports from restarting nodes, then everything is fine and {{triggerBlockReports()}} is redundant.  When you see TestFileTruncate succeeds, look for block {{blk_1073742100}}, you should see that {{initReplicaRecovery}} for it is happening before {{processReport}} and succeeds on all three nodes. While in the failure case {{initReplicaRecovery}} throws exceptions on two DNs out of three.\nWe should remove {{triggerBlockReports()}} when we fix the {{commitBlockSync()}} problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-13T18:44:10.368+0000","updated":"2015-03-13T18:47:51.182+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14362931","id":"14362931","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks Konst for the explanation, you are right. We still need to use {{triggerBlockReports}} here, {{replicas}} could not be updated and it's similar reason as we discussed before. \nI have made a fix for HDFS-7930, please take a look.\n\n+1 for the latest patch (Seems you need to rebase again). You can commit it, or wait for HDFS-7930 in, it's up to you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-03-16T08:33:36.122+0000","updated":"2015-03-16T08:33:36.122+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14363692","id":"14363692","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"Rebased the patch. Removed the assertion change, because HDFS-7435 eliminated the assert along with the {{setBlock()}} method.\nWill commit without waiting for Jenkins, as the diff with previous patch is trivial.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-16T18:46:02.446+0000","updated":"2015-03-16T18:46:02.446+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14363716","id":"14363716","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"branch-2 patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-16T19:01:19.333+0000","updated":"2015-03-16T19:01:19.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14363796","id":"14363796","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"I just committed this. Thanks everybody.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-16T20:01:14.707+0000","updated":"2015-03-16T20:01:14.707+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14363800","id":"14363800","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-trunk-Commit #7335 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/7335/])\nHDFS-7886. Fix TestFileTruncate falures. Contributed by Plamen Jeliazkov and Konstantin Shvachko. (shv: rev ce5de93a5837e115e1f0b7d3c5a67ace25385a63)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFileTruncate.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/MiniDFSCluster.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-16T20:02:44.844+0000","updated":"2015-03-16T20:02:44.844+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14364908","id":"14364908","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Yarn-trunk #869 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/869/])\nHDFS-7886. Fix TestFileTruncate falures. Contributed by Plamen Jeliazkov and Konstantin Shvachko. (shv: rev ce5de93a5837e115e1f0b7d3c5a67ace25385a63)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFileTruncate.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/MiniDFSCluster.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-17T10:44:08.952+0000","updated":"2015-03-17T10:44:08.952+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14364990","id":"14364990","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #135 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/135/])\nHDFS-7886. Fix TestFileTruncate falures. Contributed by Plamen Jeliazkov and Konstantin Shvachko. (shv: rev ce5de93a5837e115e1f0b7d3c5a67ace25385a63)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/MiniDFSCluster.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFileTruncate.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-17T11:32:37.427+0000","updated":"2015-03-17T11:32:37.427+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14365181","id":"14365181","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #126 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/126/])\nHDFS-7886. Fix TestFileTruncate falures. Contributed by Plamen Jeliazkov and Konstantin Shvachko. (shv: rev ce5de93a5837e115e1f0b7d3c5a67ace25385a63)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFileTruncate.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/MiniDFSCluster.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-17T14:32:27.195+0000","updated":"2015-03-17T14:32:27.195+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14365220","id":"14365220","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Hdfs-trunk #2067 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2067/])\nHDFS-7886. Fix TestFileTruncate falures. Contributed by Plamen Jeliazkov and Konstantin Shvachko. (shv: rev ce5de93a5837e115e1f0b7d3c5a67ace25385a63)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/MiniDFSCluster.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFileTruncate.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-17T14:44:36.680+0000","updated":"2015-03-17T14:44:36.680+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14365276","id":"14365276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #135 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/135/])\nHDFS-7886. Fix TestFileTruncate falures. Contributed by Plamen Jeliazkov and Konstantin Shvachko. (shv: rev ce5de93a5837e115e1f0b7d3c5a67ace25385a63)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/MiniDFSCluster.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFileTruncate.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-17T15:11:32.439+0000","updated":"2015-03-17T15:11:32.439+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12779661/comment/14365327","id":"14365327","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Mapreduce-trunk #2085 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2085/])\nHDFS-7886. Fix TestFileTruncate falures. Contributed by Plamen Jeliazkov and Konstantin Shvachko. (shv: rev ce5de93a5837e115e1f0b7d3c5a67ace25385a63)\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/MiniDFSCluster.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestFileTruncate.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-17T15:34:11.610+0000","updated":"2015-03-17T15:34:11.610+0000"}],"maxResults":34,"total":34,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7886/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i26dov:"}}