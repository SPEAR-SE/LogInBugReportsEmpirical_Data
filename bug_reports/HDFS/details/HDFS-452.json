{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12429130","self":"https://issues.apache.org/jira/rest/api/2/issue/12429130","key":"HDFS-452","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2009-06-29T22:13:36.493+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 23 18:30:00 UTC 2014","customfield_12310420":"17030","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-452/watchers","watchCount":6,"isWatching":false},"created":"2009-06-29T22:04:26.465+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["newbie"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314048","id":"12314048","description":"","name":"0.20.1","archived":false,"released":true,"releaseDate":"2009-09-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-08-05T23:40:40.723+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/4","description":"This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/reopened.png","name":"Reopened","id":"4","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"If there are any directories  with restricted access to user are present  in users directory then fs -count  operation on users directory throws  Access control exception .\n\ne.g \n\n{code}\n[rphulari@some-host ~]$ hadoop fs -ls /user/ | grep rphulari\ndrwxr--r--   - rphulari    users            0 2009-06-09 22:05 /user/rphulari\n\n[rphulari@some-host ~]$ hadoop fs -ls\nFound 3 items\ndrwx------   - hdfs     users          0 2009-04-17 01:11 /user/rphulari/temp\ndrwxr--r--   - rphulari users          0 2009-05-06 22:02 /user/rphulari/temp2\n-rw-r--r--   3 rphulari users          0 2009-05-06 22:11 /user/rphulari/test\n\n[rphulari@some-host ~]$ hadoop fs -count /user/rphulari\ncount: org.apache.hadoop.security.AccessControlException: Permission denied: user=rphulari, access=READ_EXECUTE, inode=\"temp\":hdfs:users:rwx------\n{code}\n\nIdeal out put  should be quota information about user owned dir/files and  error notification about files/dir which are not owned by user.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"74403","customfield_12312823":null,"summary":"Fs -count throws Access Control Exception when restricted acess directories are present in the user's directory  . ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviphulari","name":"raviphulari","key":"raviphulari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Phulari","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviphulari","name":"raviphulari","key":"raviphulari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Phulari","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12429130/comment/12725370","id":"12725370","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"\\-count current requires rx permission for directories.  It is nothing to do with who is the owner.  If the permission of /user/rphulari/temp is rwxr-x---, then user rphulari will have permission to do -count.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-06-29T22:13:36.493+0000","updated":"2009-06-29T22:13:36.493+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12429130/comment/12725374","id":"12725374","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cutting","name":"cutting","key":"cutting","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Cutting","active":true,"timeZone":"America/Los_Angeles"},"body":"This should probably behave like unix's du command, where unreadable directories cause an error message to be printed to standard error, but the command continues to run and compute the sum excluding unreadable things.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cutting","name":"cutting","key":"cutting","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Cutting","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-06-29T22:18:52.336+0000","updated":"2009-06-29T22:18:52.336+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12429130/comment/12725380","id":"12725380","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"body":"\nThe root cause of the problem is fundamental to how permissions are seperated from actual access in HDFS. In this case, HDFS first verifies that user has read permissions for the entire tree _before_ actually starting the counting. This is just one of issues of separating permissions checking (apart from iterating multiple times).\n\nIdeally command should do what what du does. To do that, the simplest I can think of is to  move the recursive counting from FSDirectory into FSNamesystem (where it has correct permissions). \n\nFor 0.20.1, permission checking could be fixed at least for directories where quota is set : i.e. if /user/xxx has a quota set, HDFS does not iterate over the tree.. inode for /user/xxx already has this info. So NameNode should check read permissions just for this directory.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-06-29T22:43:24.255+0000","updated":"2009-06-29T22:43:24.255+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12429130/comment/12725384","id":"12725384","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> This should probably behave like unix's du command, ...\n\"fs -count\" originally was implemented for counting files and directories, which was different from any unix command (please correct me if I was wrong).  The closest unix command is \"ls -r\" because both of them traverse namespace sub-trees, and so we require rx permission for the directory and all its sub-directories.  Later on, we added space counting and quota features to -count.  These features made it looks like unix du.  Note that we indeed have a \"fs -du\" command.  We should minimize the similarity between -count and -du.\n\nRaghu has suggested the following:  When quota is set in the directory, quota and count information are stored in an INode subclass, called INodeDirectoryWithQuota.  So the tree traversal may not be necessary.  \"fs -count\" may just return the stored information in the INodeDirectoryWithQuota.  Then, -count only needs the required permission on the directory but not its sub-directories since there is no traversal.\n\nBoth ideas sound good to me.  It seems that both of them are incompatible to the current implementation.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-06-29T23:04:33.074+0000","updated":"2009-06-29T23:04:33.074+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12429130/comment/12725389","id":"12725389","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviphulari","name":"raviphulari","key":"raviphulari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Phulari","active":true,"timeZone":"America/Los_Angeles"},"body":"Additional information -- \nfs -du  also  throws similar exception in such scenario .\n\n{code}\n\n[rphulari@some-host ~]$ hadoop fs -ls\nFound 3 items\nd------rwx   - rphulari users          0 2009-06-29 22:37 /user/rphulari/tdir\ndrwxr--r--   - rphulari users          0 2009-05-06 22:02 /user/rphulari/temp2\ndrwxr--r--   - rphulari users          0 2009-04-21 00:56 /user/rphulari/validation\n\n[rphulari@some-host ~]$ hadoop fs -du \nFound 3 items\ndu: org.apache.hadoop.security.AccessControlException: Permission denied: user=rphulari, access=READ_EXECUTE, inode=\"tdir\":rphulari:users:------rwx\n\n{code}  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviphulari","name":"raviphulari","key":"raviphulari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravi Phulari","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-06-29T23:17:13.612+0000","updated":"2009-06-29T23:21:37.649+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12429130/comment/13053089","id":"13053089","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=atm","name":"atm","key":"atm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=atm&avatarId=14136","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=atm&avatarId=14136","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=atm&avatarId=14136","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=atm&avatarId=14136"},"displayName":"Aaron T. Myers","active":true,"timeZone":"America/Los_Angeles"},"body":"I suspect this is no longer an issue on trunk and can be closed.\n\nRavi or Raghu, can you confirm?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=atm","name":"atm","key":"atm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=atm&avatarId=14136","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=atm&avatarId=14136","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=atm&avatarId=14136","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=atm&avatarId=14136"},"displayName":"Aaron T. Myers","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-22T07:15:22.227+0000","updated":"2011-06-22T07:15:22.227+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12429130/comment/14072095","id":"14072095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"body":"From trunk as of 8a795812e79033cb5b91389cc0e7e110deacbe0e\n\n{code}\nhdfs dfs -count /\ncount: Permission denied: user=root, access=READ_EXECUTE, inode=\"/user\":aw:hdfs:drwx------\n\n\nhdfs dfs -du /\ndu: Permission denied: user=root, access=READ_EXECUTE, inode=\"/copy\":aw:hdfs:drwxr-x---\ndu: Permission denied: user=root, access=READ_EXECUTE, inode=\"/system\":aw:hdfs:drwxr-x---\ndu: Permission denied: user=root, access=READ_EXECUTE, inode=\"/user\":aw:hdfs:drwx------\n0  /benchmarks\n\n{code}\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"created":"2014-07-23T18:30:00.250+0000","updated":"2014-07-23T18:30:00.250+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-452/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0d3vb:"}}