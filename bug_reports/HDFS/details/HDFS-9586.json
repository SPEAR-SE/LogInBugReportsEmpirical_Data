{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12923424","self":"https://issues.apache.org/jira/rest/api/2/issue/12923424","key":"HDFS-9586","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-12-21T21:53:29.039+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jan 06 22:39:49 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-9586/watchers","watchCount":5,"isWatching":false},"created":"2015-12-21T13:33:40.505+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12452813","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12452813","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12924254","key":"HDFS-9600","self":"https://issues.apache.org/jira/rest/api/2/issue/12924254","fields":{"summary":"do not check replication if the block is under construction","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangzhe1991","name":"yangzhe1991","key":"yangzhe1991","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yangzhe1991&avatarId=22883","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yangzhe1991&avatarId=22883","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yangzhe1991&avatarId=22883","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yangzhe1991&avatarId=22883"},"displayName":"Phil Yang","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-01-06T22:39:49.607+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[],"timeoriginalestimate":null,"description":"As HDFS-7933 said, we should count decommissioning and decommissioned nodes respectively and regard decommissioning nodes as special live nodes whose file is not corrupt or missing.\n\nSo in listCorruptFileBlocks which is used by fsck and HDFS namenode website, we should collect a corrupt file only if liveReplicas and decommissioning are both 0.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12778829","id":"12778829","filename":"9586-v1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangzhe1991","name":"yangzhe1991","key":"yangzhe1991","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yangzhe1991&avatarId=22883","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yangzhe1991&avatarId=22883","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yangzhe1991&avatarId=22883","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yangzhe1991&avatarId=22883"},"displayName":"Phil Yang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-12-21T13:36:32.892+0000","size":2092,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12778829/9586-v1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"listCorruptFileBlocks should not output files that all replications are decommissioning","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangzhe1991","name":"yangzhe1991","key":"yangzhe1991","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yangzhe1991&avatarId=22883","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yangzhe1991&avatarId=22883","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yangzhe1991&avatarId=22883","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yangzhe1991&avatarId=22883"},"displayName":"Phil Yang","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangzhe1991","name":"yangzhe1991","key":"yangzhe1991","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yangzhe1991&avatarId=22883","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yangzhe1991&avatarId=22883","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yangzhe1991&avatarId=22883","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yangzhe1991&avatarId=22883"},"displayName":"Phil Yang","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12923424/comment/15067124","id":"15067124","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shahrs87","name":"shahrs87","key":"shahrs87","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rushabh S Shah","active":true,"timeZone":"Etc/UTC"},"body":"FSNameSystem#listCorruptFileBlocks gets the list of corrupt blocks from UnderReplicatedBlocks.QUEUE_WITH_CORRUPT_BLOCKS queue.\nAccording to below code, the block will be added into QUEUE_WITH_CORRUPT_BLOCKS queue only if there are zero decommissionedReplicas (This name is little confusing since this is the sum of decommissioning and decommissioned replicas).\n\n{noformat}\nif (curReplicas == 0) {\n      // If there are zero non-decommissioned replicas but there are\n      // some decommissioned replicas, then assign them highest priority\n      if (decommissionedReplicas > 0) {\n        return QUEUE_HIGHEST_PRIORITY;\n      }\n      if (readOnlyReplicas > 0) {\n        // only has read-only replicas, highest risk\n        // since the read-only replicas may go down all together.\n        return QUEUE_HIGHEST_PRIORITY;\n      }\n      //all we have are corrupt blocks\n      return QUEUE_WITH_CORRUPT_BLOCKS;\n{noformat}\nSo all the blocks that go into QUEUE_WITH_CORRUPT_BLOCKS already has zero decommissioning replicas.\n\nPlease correct me if my understanding is wrong.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shahrs87","name":"shahrs87","key":"shahrs87","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rushabh S Shah","active":true,"timeZone":"Etc/UTC"},"created":"2015-12-21T21:53:29.039+0000","updated":"2015-12-21T21:53:29.039+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12923424/comment/15067495","id":"15067495","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangzhe1991","name":"yangzhe1991","key":"yangzhe1991","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yangzhe1991&avatarId=22883","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yangzhe1991&avatarId=22883","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yangzhe1991&avatarId=22883","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yangzhe1991&avatarId=22883"},"displayName":"Phil Yang","active":true,"timeZone":"Asia/Shanghai"},"body":"{quote}\nSo all the blocks that go into QUEUE_WITH_CORRUPT_BLOCKS already has zero decommissioning replicas.\n{quote}\nIn theory, I think it is right. However when decommissioning nodes there may be false positives of block-missing error. It is another bug that I'm digging out.\n\nI'm not sure why we need \n{code}\nif (inode != null && blockManager.countNodes(blk).liveReplicas() == 0) \n{code}\nin FSNamesystem.listCorruptFileBlocks, in theory the second condition should be always true. But because of the bug, we need this condition indeed, so I think we need another condition about decommissioning replicas.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangzhe1991","name":"yangzhe1991","key":"yangzhe1991","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yangzhe1991&avatarId=22883","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yangzhe1991&avatarId=22883","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yangzhe1991&avatarId=22883","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yangzhe1991&avatarId=22883"},"displayName":"Phil Yang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-12-22T03:36:38.204+0000","updated":"2015-12-22T03:36:38.204+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12923424/comment/15806017","id":"15806017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m  0s{color} | {color:blue} Docker mode activated. {color} |\n| {color:red}-1{color} | {color:red} patch {color} | {color:red}  0m  4s{color} | {color:red} HDFS-9586 does not apply to trunk. Rebase required? Wrong Branch? See https://wiki.apache.org/hadoop/HowToContribute for help. {color} |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| JIRA Issue | HDFS-9586 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12778829/9586-v1.patch |\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/18083/console |\n| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-06T22:39:49.607+0000","updated":"2017-01-06T22:39:49.607+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-9586/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2q5q7:"}}