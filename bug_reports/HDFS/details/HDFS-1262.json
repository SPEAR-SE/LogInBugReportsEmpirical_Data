{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12467671","self":"https://issues.apache.org/jira/rest/api/2/issue/12467671","key":"HDFS-1262","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2010-06-23T16:56:48.048+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Sep 06 19:59:47 UTC 2011","customfield_12310420":"15851","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_148677331821_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-03-10T03:01:55.568+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-1262/watchers","watchCount":11,"isWatching":false},"created":"2010-06-23T07:46:23.812+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315103","id":"12315103","description":"Append/sync support for Hadoop 0.20","name":"0.20-append","archived":true,"released":false}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-03-10T03:01:55.629+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312928","id":"12312928","name":"hdfs-client"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"Ryan Rawson came upon this nasty bug in HBase cluster testing. What happened was the following:\n1) File's original writer died\n2) Recovery client tried to open file for append - looped for a minute or so until soft lease expired, then append call initiated recovery\n3) Recovery completed successfully\n4) Recovery client calls append again, which succeeds on the NN\n5) For some reason, the block recovery that happens at the start of append pipeline creation failed on all datanodes 6 times, causing the append() call to throw an exception back to HBase master. HBase assumed the file wasn't open and put it back on a queue to try later\n6) Some time later, it tried append again, but the lease was still assigned to the same DFS client, so it wasn't able to recover.\n\nThe recovery failure in step 5 is a separate issue, but the problem for this JIRA is that the NN can think it failed to open a file for append when the NN thinks the writer holds a lease. Since the writer keeps renewing its lease, recovery never happens, and no one can open or recover the file until the DFS client shuts down.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12448267","id":"12448267","filename":"hdfs-1262-1.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-29T02:06:36.083+0000","size":21474,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12448267/hdfs-1262-1.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12448384","id":"12448384","filename":"hdfs-1262-2.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-30T09:33:48.684+0000","size":20892,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12448384/hdfs-1262-2.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12450207","id":"12450207","filename":"hdfs-1262-3.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-07-22T20:05:10.179+0000","size":20590,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12450207/hdfs-1262-3.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12450237","id":"12450237","filename":"hdfs-1262-4.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-07-22T23:37:22.640+0000","size":21602,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12450237/hdfs-1262-4.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12452747","id":"12452747","filename":"hdfs-1262-5.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-22T16:59:52.508+0000","size":22538,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12452747/hdfs-1262-5.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"113422","customfield_12312823":null,"summary":"Failed pipeline creation during append leaves lease hanging on NN","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12881605","id":"12881605","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"Solving this is a bit tricky... brainstorming a couple options, not sure what's best, or if I'm missing a simpler one:\n\nOption 1) change renewLease function to pass a list of all open files. In LeaseManager maintain each lease with a separate timestamp. Thus if we end up with an inconsistency like this, it will get resolved since the lease on just that file will get expired. This is somewhat complicated, breaks RPC compatibility, etc. Not so great...\n\nOption 2) add a finally clause to the pipeline setup in DFSClient.append() such that if the pipeline can't get set up, we re-close the file before throwing an exception. I don't think we can use completeFile() to do this, since the blocks aren't in blocksMap right after append() - so completeFile would loop forever. We could overload abandonBlock() for this purpose, perhaps. Alternatively maybe it's not right that appendFile() removes from blocks map, but rather the initial commitBlockSynchronization should be the thing that does it?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-06-23T07:59:32.719+0000","updated":"2010-06-23T07:59:32.719+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12881748","id":"12881748","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"i think something along the lines of option 2 sounds cleaner imo.\n\nbut i have another question, does the error you see have\n\"because current leaseholder is trying to recreate file\"\n\nit sounds like this code is executing:\n\n{code}\n        //\n        // We found the lease for this file. And surprisingly the original\n        // holder is trying to recreate this file. This should never occur.\n        //\n        if (lease != null) {\n          Lease leaseFile = leaseManager.getLeaseByPath(src);\n          if (leaseFile != null && leaseFile.equals(lease)) { \n            throw new AlreadyBeingCreatedException(\n                                                 \"failed to create file \" + src + \" for \" + holder +\n                                                 \" on client \" + clientMachine + \n                                                 \" because current leaseholder is trying to recreate file.\");\n          }\n        }\n{code}\n\nand anytime I see a comment \"this should never happen\" it sounds to me like the handling of that might be suboptimal.  is there any reason that a client shouldn't be able to open a file in the same mode it already has it open?  NN-side, it's a basically a no-op, or a explicit lease renewal.\n\nany reason we can't make the above code do that?  (log something and return)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-23T16:56:48.048+0000","updated":"2010-06-23T16:56:48.048+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12881755","id":"12881755","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"in looking at client code, my suggestion above probably isn't a good idea.  it would allow concurrent writes.\n\ni think the simplest solution is this:\n\nadd a finally block that removes the path from the LeaseChecker in DFSClient.  Then the lease will expire in 60s.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-23T17:04:07.061+0000","updated":"2010-06-23T17:04:07.061+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12881757","id":"12881757","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"provided there is agreement on the last suggestion, i'm happy to take care of it btw\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-23T17:07:10.424+0000","updated":"2010-06-23T17:07:10.424+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12881759","id":"12881759","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"oop, nevermind--forgot that lease renewal is by client name *only* (hence your option 1)\n\nstill pondering this a bit, but ~option 2 sounds most appealing.  a client should have a way to release the lease it has on a file without necessarily doing a normal close (and hence completeFile)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-23T17:11:29.623+0000","updated":"2010-06-23T17:11:29.623+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12881783","id":"12881783","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"actually, here's another idea:\n\n3) the NN thinks the client has a lease.  it's right.  the client just didn't save enough information to handle the failure.\nnamenode.append() just returns the last block.  The code in DFSClient:\n\n{code}\n    OutputStream result = new DFSOutputStream(src, buffersize, progress,\n        lastBlock, stat, conf.getInt(\"io.bytes.per.checksum\", 512));\n    leasechecker.put(src, result);\n    return result;\n{code}\n\nif in leasechecker we stored a pair, lastBlock and result (and did so in a finally block):\n\n{code}\n    OutputStream result = null;\n    try {\n      result = new DFSOutputStream(src, buffersize, progress,\n        lastBlock, stat, conf.getInt(\"io.bytes.per.checksum\", 512));\n    } finally {\n      Pair<LocatedBlock, OutputStream> pair = new Pair(lastBlock, result);\n      leasechecker.put(src, pair);\n      return result;\n    }\n{code}\n\nand above, we only call namenode.append() if we don't have a lease already.\n\nagain, if we do find a solution, i'm happy to help out on this one\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-23T17:42:17.335+0000","updated":"2010-06-23T17:42:17.335+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12881786","id":"12881786","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"I don't think that solution #3 works - it's only in HBase's case that we stubbornly keep trying to call append() forever. The assumption should be that if we get an IOException out of append() then we don't hold the lease on the file.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-06-23T17:46:28.528+0000","updated":"2010-06-23T17:46:28.528+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12881795","id":"12881795","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"i see, it only solves the re-open by the same client problem, but not the blocking of other clients.\n\nthe fact is the client does have the lease and currently the only way to release it is via close.  \n\nin looking at DFSClient.create(), the same problem can occur there.  we make a NN rpc call to get a block and acquire a lease.  we then create the DFSOutputStream (which could fail)\n\ni think that comes back to the need to be able to release a lease without calling namenode.completeFile().\n\ni guess there's not a clever way to do this with existing namenode RPC and/or client initiated lease recovery?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-23T18:00:33.648+0000","updated":"2010-06-23T18:00:33.648+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12882092","id":"12882092","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"body":"I am still thinking about this one and I agree that we should try to solve the general case too, but how about a workaround for HBase\n\n4) change org.apache.hadoop.hbase.util.FSUtils.recoverFileLease() to create a new FileSystem object via FileSystem.newInstance() every time in the while loop. Use this newly created FileSystem object to issue the appendFile() call. The downside is that this API is available only in 0.21 and above (but we could backport it)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"created":"2010-06-24T08:48:46.773+0000","updated":"2010-06-24T08:48:46.773+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12882160","id":"12882160","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"Oof, what a hack that would be :) Not to say we shouldn't do that over in HBase in the short term, but I agree let's treat this as a serious bug in 0.20-append and try to fix it on the HDFS side unless we really can't think of any implementable solutions.\n\nCan you think of a problem with the abandonBlock() solution? My thinking is that we'd check if the block is the last block of a file under construction by the abandoning client, and if so, reassign lease to NN_Recovery and initiate block synchronization from the NN as if the lease were lost. It may not be necessary to go through the whole recovery process, but it will be safer in case the client half set up a pipeline before failing, or somesuch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-06-24T13:59:20.663+0000","updated":"2010-06-24T13:59:20.663+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12882175","id":"12882175","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"we actually use a new FileSystem instance per file in scribe.  see\nhttp://hadoopblog.blogspot.com/2009/06/hdfs-scribe-integration.html\n\nthere are some downsides to this (creating a new FileSystem instance can be expensive, issuing fork & exec calls for 'whoami' and 'groups', but we have patches to minimize this)\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-24T15:03:14.182+0000","updated":"2010-06-24T15:03:14.182+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12882176","id":"12882176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"i am also wondering why this hasn't shown up in regular create calls sometime.  both DFSClient.append() and DFSClient.create() are susceptible to the same problem (client has lease, then throws exception setting up pipeline)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-24T15:04:52.996+0000","updated":"2010-06-24T15:04:52.996+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12882178","id":"12882178","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"It probably has shown up before :) I think most people just don't care, since for things like MR tasks that are short-lived, they'll die and retry on their own. Most people probably bail on IOE instead of retrying is my guess.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-06-24T15:07:31.361+0000","updated":"2010-06-24T15:07:31.361+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12882263","id":"12882263","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"todd: can you confirm if the exception was from the namenode.append() call or creating the output stream?  (sounds like the latter, in the lease recovery it initiates)\n\n{code}\n  OutputStream append(String src, int buffersize, Progressable progress\n      ) throws IOException {\n    checkOpen();\n    FileStatus stat = null;\n    LocatedBlock lastBlock = null;\n    try {\n      stat = getFileInfo(src);\n      lastBlock = namenode.append(src, clientName);\n    } catch(RemoteException re) {\n      throw re.unwrapRemoteException(FileNotFoundException.class,\n                                     AccessControlException.class,\n                                     NSQuotaExceededException.class,\n                                     DSQuotaExceededException.class);\n    }\n    OutputStream result = new DFSOutputStream(src, buffersize, progress,\n        lastBlock, stat, conf.getInt(\"io.bytes.per.checksum\", 512));\n    leasechecker.put(src, result);\n    return result;\n  }\n{code}\n\n\neither way, i think the right way to do this is add back an abandonFile RPC call in the NN.   Even if we don't change function call signatures for abandonBlock, we will break client/server compatibility.\n\nthoughts?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-24T18:16:54.346+0000","updated":"2010-06-24T18:16:54.346+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12882273","id":"12882273","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"Yea, the exception in this case was during the \"new DFSOutputStream\" - specifically the block recovery part as you mentioned. I think the actual cause of that failure was HDFS-1260 but we should still address this issue too.\n\nYou're right, we should add a new RPC rather than overloading abandonBlock. abandonFile makes sense, or abandonAppendBlock, or something like that. Do you want to take a crack at implementing it or should I?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-06-24T18:36:04.373+0000","updated":"2010-06-24T18:36:04.373+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12882283","id":"12882283","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"i'd appreciate the chance to implement it, actually.  Thanks\n\nre: the name, according to Dhruba, there used to be one called \"abandonFile\" which had the semantics we need.  Also, a similar error can occur on non-append creates, so probably having append in the name doesn't make sense.  abandonFile or another idea?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-24T18:52:43.283+0000","updated":"2010-06-24T18:52:43.283+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12882290","id":"12882290","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"Ah, the abandonFile RPC must have been before my time. Looks like it got deleted in 0.18. Go for it! :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-06-24T19:21:19.449+0000","updated":"2010-06-24T19:21:19.449+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12882609","id":"12882609","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"hey, so what should the precise semantics of abandonFile(String src, String holder) be?  I have a quick impl now (+ test case) that does this:\n\n1. check that holder owns the lease for src\n2. call internalReleaseLeaseOne\n\nso it really is a glorified 'cleanup and close' which has the same behavior as if the lease expired--nice and tidy imo.  It does have the slight delay of lease recovery, though.\n\n\nan alternative option:\n\nfor the specific case we are fixing here, we could do something simpler such as just putting the targets in the blockMap and call completeFile (basically what commitBlockSynchronization would do).  However, this doesn't handle the general case if we expose abandonFile at any other time and a client has actually written data to last block.  \n\nI think the first option is safer, but maybe I'm too cautious\n\n\nif the way I've implemented it seems ok, I can post he patch for review asap","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-25T15:26:46.482+0000","updated":"2010-06-25T15:26:46.482+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12882979","id":"12882979","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"also, in writing up the test case, i realized DFSClient.create() is not susceptible to the same scenario.  While in theory it could happen on the NN side, right now, the namenode RPC for create happens and then all we do is start the streamer (hence i don't have a test case for it yet).\n\nI still think having a finally block that calls abandonFile() for create is prudent--if we get any exception in the process client side, abandon the file to be safe\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-27T19:10:41.613+0000","updated":"2010-06-27T19:10:41.613+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12883296","id":"12883296","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"bq. so it really is a glorified 'cleanup and close' which has the same behavior as if the lease expired--nice and tidy imo. It does have the slight delay of lease recovery, though.\n\nI think that makes sense - best to do recovery since we might have gotten halfway through creating the pipeline, for example, and this will move the blocks back to finalized state on the DNs. Performance shouldn't be a concern, since this is such a rare case.\n\nbq. While in theory it could happen on the NN side, right now, the namenode RPC for create happens and then all we do is start the streamer (hence i don't have a test case for it yet).\n\nWhat happens if we have a transient network error? For example, let's say the client is on the same machine as the NN, but it got partitioned from the network for a bit. When we call create(), it succeeds, but then when we actually try to write the blocks, it fails temporarily. This currently leaves a 0-length file, but does it also orphan the lease for that file?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-06-28T21:08:09.498+0000","updated":"2010-06-28T21:08:09.498+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12883319","id":"12883319","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"in the 2nd case, can't the client still call close?  or will it hang forever waiting for blocks?\n\neither way, i've got test cases for create() + append() and the fix.  took a little longer to clean up today, but will post the patch by end of day\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-28T21:45:56.450+0000","updated":"2010-06-28T21:45:56.450+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12883385","id":"12883385","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"-test case for append and create failures.\n-tried to get it so both cases fail fast, but create will hit the test timeout (default for create that gets AlreadyBeingCreatedException is 5 retries with 60s sleep)\n-append case fails in 30s w/o the fix worst case\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-29T02:06:36.521+0000","updated":"2010-06-29T02:06:36.521+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12883828","id":"12883828","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"one note:\n\n{code}\n public void updateRegInfo(DatanodeID nodeReg) {\n   name = nodeReg.getName();\n   infoPort = nodeReg.getInfoPort();\n   // update any more fields added in future.\n }\n{code}\n\nshould be:\n{code}\npublic void updateRegInfo(DatanodeID nodeReg) {\n   name = nodeReg.getName();\n   infoPort = nodeReg.getInfoPort();\n   ipcPort = nodeReg.getIpcPort();\n   // update any more fields added in future.\n }\n{code}\n\nit wasn't copying the ipcPort for some reason.\n\nMy patch includes this fix\n\ntrunk doesn't have this bug","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-30T07:52:52.703+0000","updated":"2010-06-30T07:52:52.703+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12883830","id":"12883830","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"above is from DatanodeId.java","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-30T07:56:20.286+0000","updated":"2010-06-30T07:56:20.286+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12883849","id":"12883849","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"The bug mentioned above is HDFS-894 - we just didn't commit it to 20 branch. Maybe best to commit that one under the aegis of that issue rather than here?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-06-30T09:03:29.804+0000","updated":"2010-06-30T09:03:29.804+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12883855","id":"12883855","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"that's probably better.  this was dependent on it as i was killing the datanodes to simulate the pipeline failure.  i ended up tuning the test case to use mockito to throw exceptions at the end of a NN rpc call for both append() and create(), so I think that dependency is gone. \n\ncan we mark this as dependent on that if it turns out to be needed?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-30T09:20:51.485+0000","updated":"2010-06-30T09:20:51.485+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12883857","id":"12883857","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"verified test case passes w/o that patch.  we should commit hdfs-894 to 20-append for sure, though.  that seems like a potentially gnarly bug in tests to track down (took me a short spell)\n\ni can upload the patch w/o the DatanodeID","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-30T09:24:45.971+0000","updated":"2010-06-30T09:24:45.971+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12883861","id":"12883861","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"removed hdfs-894 change from patch (commit this to 0.20-append separately)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-30T09:33:48.759+0000","updated":"2010-06-30T09:33:48.759+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12891309","id":"12891309","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"removed empty file MockitoUtil","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-07-22T20:05:10.263+0000","updated":"2010-07-22T20:05:10.263+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12891396","id":"12891396","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"fixed bug where calling append() to trigger lease recovery resulted in a client-side exception (trying to abandon a file that you don't own lease on).\n\nDFSClient now catches this exception and logs it","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-07-22T23:37:22.724+0000","updated":"2010-07-22T23:37:22.724+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12893345","id":"12893345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"Hey Sam, finally got a chance to look at this. A few notes:\n\n- why does abandonFile return boolean? looks like right now it can only return true or throw, may as well make it void, no?\n- in the log message in FSN.abandonFile it looks like there's a missing '+ src +' in the second log message\n- in the log messages, also log the \"holder\" argument perhaps\n- in previous append-branch patches we've been trying to keep RPC compatibility with unpatched 0.20 - ie you can run an updated client against an old NN, with the provision that it might not fix all the bugs. Given that, maybe we should catch the exception we get if we call abandonFile() and get back an exception indicating the method doesn't exist? Check out what we did for HDFS-630 backport for example.\n- looks like there are some other patches that got conflated into this one - eg testSimultaneousRecoveries is part of another patch on the append branch.\n- missing Apache license on new test file\n- typo: Excection instead of Exception\n- \"(PermissionStatus) anyObject(),\" might generated an unchecked cast warning - I think you can do Matchers.<PermissionStatus>anyObject() or some such to avoid the unchecked cast\n- given the complexity of the unit test, would be good to add some comments for the general flow of what all the mocks/spys are achieving. I found myself a bit lost in the abstractions","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-07-28T20:11:06.238+0000","updated":"2010-07-28T20:11:06.238+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12901130","id":"12901130","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"my apologies for the delay.  I've been caught up in some hi-pri bits at work.\n\nthanks for the comments.  inlined responses\n\n#why does abandonFile return boolean? looks like right now it can only return true or throw, may as well make it void, no?\ngood question: I stole abandonBlock() which has the same behavior.  It returns true or throws an exception.  I was trying to keep it consistent (rather than logical per se).\nI do prefer the void option as it makes the method more clear.\n\n#in the log message in FSN.abandonFile it looks like there's a missing '+ src +' in the second log message\n#in the log messages, also log the \"holder\" argument perhaps\nwill fix\n\n#in previous append-branch patches we've been trying to keep RPC compatibility with unpatched 0.20 - ie you can run an updated client against an old NN, with the provision #that it might not fix all the bugs. Given that, maybe we should catch the exception we get if we call abandonFile() and get back an exception indicating the method doesn't #exist? Check out what we did for HDFS-630 backport for example.\nnice idea, I will check this out\n\n#looks like there are some other patches that got conflated into this one - eg testSimultaneousRecoveries is part of another patch on the append branch.\nhmm, yea, not sure what happened here...weird, I think I applied one of your patches.  Which patch is that test from?\n\n#missing Apache license on new test file\nwill fix\n#typo: Excection instead of Exception\nwill fix\n#\"(PermissionStatus) anyObject(),\" might generated an unchecked cast warning - I think you can do Matchers.<PermissionStatus>anyObject() or some such to avoid the unchecked #cast\nah, nice catch, will fix also\n\n#given the complexity of the unit test, would be good to add some comments for the general flow of what all the mocks/spys are achieving. I found myself a bit lost in the #abstractions\n\nyea, sry, was in a rush b4 vacation to get some test + patch up.  It was a bit tricky to get this case going for both create + append;  I'll document the case better (at all)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-22T04:07:09.419+0000","updated":"2010-08-22T04:07:09.419+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12901134","id":"12901134","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"re: RPC compatibility.  I'm not 100% sure this is a good idea.  If we start to enumerate the cases of how a client can interact with the server, bugs seem more likely.  It makes sense with a single method, but if RPC changes become interdependent...\n\nwhat's the case that mandates using a new client against an old namenode?  is it not possible to use the appropriately versioned client?  or is it the case of heterogeneous sets of clusters and simplicity of management with a single client code base?\n\nany other thoughts on this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-22T04:58:33.273+0000","updated":"2010-08-22T04:58:33.273+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12901135","id":"12901135","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"body":"I agree with sam that we we can safely introduce a new RPC without worrying about back compatibility with 0.20 or 0.21. As of now, new versions of hadoop are not compatible with older versions.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"created":"2010-08-22T05:25:33.225+0000","updated":"2010-08-22T05:25:33.225+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12901188","id":"12901188","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"body":"address todd's comments (except for RPC compatibility--pending discussion)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rash37","name":"rash37","key":"rash37","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam rash","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-22T16:59:52.579+0000","updated":"2010-08-22T16:59:52.579+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/12901268","id":"12901268","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"re RPC compatibility - I agree it's not a requirement on trunk, but so far we've kept branch-20-append compatible with a \"your mileage may vary since we haven't tested the compatibility matrix\". If it's too complicated to do a fallback code path that maintains the current buggy behavior, that's OK.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-08-23T05:26:49.749+0000","updated":"2010-08-23T05:26:49.749+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467671/comment/13098304","id":"13098304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sanjay.radia","name":"sanjay.radia","key":"sanjay.radia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sanjay Radia","active":true,"timeZone":"America/Los_Angeles"},"body":"Note this patch is not necessary for HBase since HBase does not use append() any longer on restart or failover of region server. Instead it revokes the lease and starts a new journal file rather than appending to the old one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sanjay.radia","name":"sanjay.radia","key":"sanjay.radia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sanjay Radia","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-06T19:59:47.466+0000","updated":"2011-09-06T19:59:47.466+0000"}],"maxResults":37,"total":37,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-1262/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0jrq7:"}}