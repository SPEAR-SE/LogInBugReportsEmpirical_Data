{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12764191","self":"https://issues.apache.org/jira/rest/api/2/issue/12764191","key":"HDFS-7575","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327584","id":"12327584","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12329018","id":"12329018","description":"2.6.1 release","name":"2.6.1","archived":false,"released":true,"releaseDate":"2015-09-23"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335732","id":"12335732","description":"3.0.0-alpha1 release","name":"3.0.0-alpha1","archived":false,"released":true,"releaseDate":"2016-09-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-12-30T21:14:11.700+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Aug 31 22:13:10 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_1204816258_*|*_1_*:*_1_*:*_818438091_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-01-22T22:16:24.964+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7575/watchers","watchCount":23,"isWatching":false},"created":"2014-12-30T12:15:30.697+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":["2.6.1-candidate"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"11.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326143","id":"12326143","description":"2.4.0 release","name":"2.4.0","archived":false,"released":true,"releaseDate":"2014-04-07"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326264","id":"12326264","description":"2.5.0 release","name":"2.5.0","archived":false,"released":true,"releaseDate":"2014-08-11"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12327181","id":"12327181","description":"2.6.0 release","name":"2.6.0","archived":false,"released":true,"releaseDate":"2014-11-18"}],"issuelinks":[{"id":"12404901","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12404901","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12765891","key":"HDFS-7596","self":"https://issues.apache.org/jira/rest/api/2/issue/12765891","fields":{"summary":"NameNode should prune dead storages from storageMap","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-08-30T01:40:08.087+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Before HDFS-2832 each DataNode would have a unique storageId which included its IP address. Since HDFS-2832 the DataNodes have a unique storageId per storage directory which is just a random UUID.\n\nThey send reports per storage directory in their heartbeats. This heartbeat is processed on the NameNode in the {{DatanodeDescriptor#updateHeartbeatState}} method. Pre HDFS-2832 this would just store the information per Datanode. After the patch though each DataNode can have multiple different storages so it's stored in a map keyed by the storage Id.\n\nThis works fine for all clusters that have been installed post HDFS-2832 as they get a UUID for their storage Id. So a DN with 8 drives has a map with 8 different keys. On each Heartbeat the Map is searched and updated ({{DatanodeStorageInfo storage = storageMap.get(s.getStorageID());}}):\n\n{code:title=DatanodeStorageInfo}\n  void updateState(StorageReport r) {\n    capacity = r.getCapacity();\n    dfsUsed = r.getDfsUsed();\n    remaining = r.getRemaining();\n    blockPoolUsed = r.getBlockPoolUsed();\n  }\n{code}\n\nOn clusters that were upgraded from a pre HDFS-2832 version though the storage Id has not been rewritten (at least not on the four clusters I checked) so each directory will have the exact same storageId. That means there'll be only a single entry in the {{storageMap}} and it'll be overwritten by a random {{StorageReport}} from the DataNode. This can be seen in the {{updateState}} method above. This just assigns the capacity from the received report, instead it should probably sum it up per received heartbeat.\n\nThe Balancer seems to be one of the only things that actually uses this information so it now considers the utilization of a random drive per DataNode for balancing purposes.\n\nThings get even worse when a drive has been added or replaced as this will now get a new storage Id so there'll be two entries in the storageMap. As new drives are usually empty it skewes the balancers decision in a way that this node will never be considered over-utilized.\n\nAnother problem is that old StorageReports are never removed from the storageMap. So if I replace a drive and it gets a new storage Id the old one will still be in place and used for all calculations by the Balancer until a restart of the NameNode.\n\nI can try providing a patch that does the following:\n\n* Instead of using a Map I could just store the array we receive or instead of storing an array sum up the values for reports with the same Id\n* On each heartbeat clear the map (so we know we have up to date information)\n\nDoes that sound sensible?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12690971","id":"12690971","filename":"HDFS-7575.01.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-08T23:34:51.518+0000","size":1773038,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12690971/HDFS-7575.01.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12690991","id":"12690991","filename":"HDFS-7575.02.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-09T01:00:38.078+0000","size":29174,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12690991/HDFS-7575.02.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12691362","id":"12691362","filename":"HDFS-7575.03.binary.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-09T19:04:58.605+0000","size":62834,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12691362/HDFS-7575.03.binary.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12691363","id":"12691363","filename":"HDFS-7575.03.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-09T19:06:14.101+0000","size":27261,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12691363/HDFS-7575.03.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12691740","id":"12691740","filename":"HDFS-7575.04.binary.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-12T20:59:12.759+0000","size":62009,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12691740/HDFS-7575.04.binary.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12691741","id":"12691741","filename":"HDFS-7575.04.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-12T20:59:12.766+0000","size":26436,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12691741/HDFS-7575.04.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12692336","id":"12692336","filename":"HDFS-7575.05.binary.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-14T21:35:33.849+0000","size":32740,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12692336/HDFS-7575.05.binary.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12692337","id":"12692337","filename":"HDFS-7575.05.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-14T21:35:33.856+0000","size":21687,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12692337/HDFS-7575.05.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12691411","id":"12691411","filename":"testUpgrade22via24GeneratesStorageIDs.tgz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-09T22:31:17.810+0000","size":7582,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12691411/testUpgrade22via24GeneratesStorageIDs.tgz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12691412","id":"12691412","filename":"testUpgradeFrom22GeneratesStorageIDs.tgz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-09T22:31:17.816+0000","size":13246,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12691412/testUpgradeFrom22GeneratesStorageIDs.tgz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12691413","id":"12691413","filename":"testUpgradeFrom24PreservesStorageId.tgz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-09T22:31:17.822+0000","size":14060,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12691413/testUpgradeFrom24PreservesStorageId.tgz"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Upgrade should generate a unique storage ID for each volume","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lars_francke","name":"lars_francke","key":"lars_francke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lars_francke&avatarId=24833","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lars_francke&avatarId=24833","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lars_francke&avatarId=24833","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lars_francke&avatarId=24833"},"displayName":"Lars Francke","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lars_francke","name":"lars_francke","key":"lars_francke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lars_francke&avatarId=24833","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lars_francke&avatarId=24833","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lars_francke&avatarId=24833","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lars_francke&avatarId=24833"},"displayName":"Lars Francke","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14261055","id":"14261055","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lars_francke","name":"lars_francke","key":"lars_francke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lars_francke&avatarId=24833","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lars_francke&avatarId=24833","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lars_francke&avatarId=24833","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lars_francke&avatarId=24833"},"displayName":"Lars Francke","active":true,"timeZone":"Europe/Berlin"},"body":"I worked around this by doing the following for each DataNode:\n* Stop the DataNode\n* Change the storageId in each storage directory (it's in the VERSION file, e.g. {{/mnt/disk1/dfs/dn/current/VERSION}}) to a unique value\n* Start the DataNode\n\nThen afterwards I restarted the Standby NN (NN2), failed over manually, restarted the new Standby NN (NN1).\n\nThe Balancer seems to run fine since then.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lars_francke","name":"lars_francke","key":"lars_francke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lars_francke&avatarId=24833","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lars_francke&avatarId=24833","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lars_francke&avatarId=24833","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lars_francke&avatarId=24833"},"displayName":"Lars Francke","active":true,"timeZone":"Europe/Berlin"},"created":"2014-12-30T12:19:38.304+0000","updated":"2014-12-30T12:19:38.304+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14261504","id":"14261504","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"This seems like an upgrade problem.  Each directory should have its own storage id.  It seems like we should fix the upgrade code to make sure that this is the case.  If necessary, that means we should generate new codes for some directories.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-12-30T21:14:11.700+0000","updated":"2014-12-30T21:14:11.700+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14263528","id":"14263528","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lars_francke","name":"lars_francke","key":"lars_francke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lars_francke&avatarId=24833","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lars_francke&avatarId=24833","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lars_francke&avatarId=24833","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lars_francke&avatarId=24833"},"displayName":"Lars Francke","active":true,"timeZone":"Europe/Berlin"},"body":"Agreed, could also be seen as an upgrade problem.\n\nI could probably prepare a patch that fixes the NameNode handling in the way I described. It would make the Balancer work again. I don't think I feel comfortable enough with the upgrade code though.\n\nWhat do you think?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lars_francke","name":"lars_francke","key":"lars_francke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lars_francke&avatarId=24833","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lars_francke&avatarId=24833","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lars_francke&avatarId=24833","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lars_francke&avatarId=24833"},"displayName":"Lars Francke","active":true,"timeZone":"Europe/Berlin"},"created":"2015-01-03T13:16:23.933+0000","updated":"2015-01-03T13:16:23.933+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14264840","id":"14264840","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm concerned that if storage ids are not unique, a lot of other bad things could happen.  I don't think we should hack around this.\n\nI know the upgrade code path isn't fun but the alternatives are worse.  Anywhere where someone is using a storage id, it could fail in mysterious ways on those older, improperly upgraded clusters.  Our unit tests would not catch this since for newly installed clusters, the problem does not occur.  And people are going to keep assuming that storage IDs are unique, because they're supposed to be.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-05T18:13:11.342+0000","updated":"2015-01-05T18:13:11.342+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14264861","id":"14264861","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"I completely agree with Colin regarding an upgrade path.  Kihwal and I have had concerns about the shared storage id for quite awhile now, have discussed how to auto-upgrade old storage dirs, but have not had the cycles to do it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2015-01-05T18:28:24.483+0000","updated":"2015-01-05T18:28:24.483+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14264896","id":"14264896","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lars_francke","name":"lars_francke","key":"lars_francke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lars_francke&avatarId=24833","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lars_francke&avatarId=24833","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lars_francke&avatarId=24833","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lars_francke&avatarId=24833"},"displayName":"Lars Francke","active":true,"timeZone":"Europe/Berlin"},"body":"Okay, agreed. Thanks for the input. I'm afraid that I won't have time to learn this code and provide a fix. If anyone else could step up that'd be much appreciated.\n\nThe second part of the described problem will still happen though and needs to be fixed in the NN Heartbeat code: Old storageIds will never be pruned at the moment. I suggest not updating the {{storageMap}} in {{DatanodeDescriptor}} but overwriting it with what the latest Heartbeat gave us. Does that sound sensible or am I missing something?\n\nI'll open a separate issue for the upgrade changes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lars_francke","name":"lars_francke","key":"lars_francke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lars_francke&avatarId=24833","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lars_francke&avatarId=24833","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lars_francke&avatarId=24833","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lars_francke&avatarId=24833"},"displayName":"Lars Francke","active":true,"timeZone":"Europe/Berlin"},"created":"2015-01-05T18:50:12.188+0000","updated":"2015-01-05T18:50:12.188+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14264982","id":"14264982","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lars_francke], thanks for reporting this bug and the thorough investigation. The correct fix is to generate storage IDs as part of the upgrade as Colin said. I thought I had handled this case in HDFS-2832. Assigned it to myself since I broke it. Let me know if you object.\n\nbq. Another problem is that old StorageReports are never removed from the storageMap. So if I replace a drive and it gets a new storage Id the old one will still be in place and used for all calculations by the Balancer until a restart of the NameNode.\nWe can fix it in a separate Jira. I don't think just overwriting storageMap is correct though.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-05T19:43:19.786+0000","updated":"2015-01-05T19:43:19.786+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14265558","id":"14265558","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm testing a fix and expect to post a patch by tomorrow. It will also fix the storageMap issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-06T02:11:16.092+0000","updated":"2015-01-06T02:11:26.074+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14265903","id":"14265903","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lars_francke","name":"lars_francke","key":"lars_francke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lars_francke&avatarId=24833","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lars_francke&avatarId=24833","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lars_francke&avatarId=24833","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lars_francke&avatarId=24833"},"displayName":"Lars Francke","active":true,"timeZone":"Europe/Berlin"},"body":"I don't object at all, quite the opposite. Thanks for taking care of this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lars_francke","name":"lars_francke","key":"lars_francke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lars_francke&avatarId=24833","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lars_francke&avatarId=24833","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lars_francke&avatarId=24833","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lars_francke&avatarId=24833"},"displayName":"Lars Francke","active":true,"timeZone":"Europe/Berlin"},"created":"2015-01-06T09:40:04.397+0000","updated":"2015-01-06T09:40:04.397+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14270218","id":"14270218","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch to generate GUID-based storage IDs during upgrade if not already present.\n\nAdded test cases for the following:\n# Upgrade from 2.2 to current -> check new storage ID is generated.\n# Upgrade from 2.2 to 2.4 to current -> check new storage ID is generated.\n# Upgrade from 2.4 to current -> check new storage ID is NOT generated.\n\nI split the NN change (GC stale entries in storageMap) into HDFS-7596.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-08T23:34:51.531+0000","updated":"2015-01-08T23:34:51.531+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14270221","id":"14270221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"The patch size looks large due to a directory structure change to a binary image for an existing test case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-08T23:35:50.871+0000","updated":"2015-01-08T23:35:50.871+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14270229","id":"14270229","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12690971/HDFS-7575.01.patch\n  against trunk revision 7e2d9a3.\n\n    {color:red}-1 patch{color}.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/9157//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-08T23:40:32.062+0000","updated":"2015-01-08T23:40:32.062+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14270322","id":"14270322","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch without binary files.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-09T01:00:38.083+0000","updated":"2015-01-09T01:00:38.083+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14270423","id":"14270423","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Arpit,\n\nThanks for taking this one on.  Is there any chance that you could do the patch without adding or moving binary files?  It seems like the main thing we're testing here is just that when we start up, we're going to modify the VERSION files as expected.  We shouldn't even need any block files to test that, right?  Just a few mkdirs in a unit test.\n\nIf we check in the existing code, this 1.7 MB commit becomes part of the repo's history forever which slows down downloads and git pulls.  I also think that untarring things during a test is kind of sluggish as well.\n\nIt seems like we never needed these tar files to begin with.  We could just have the test open up the txt files and generate a temporary directory based on them.  If you want the blocks to have contents, we could just generate them with a fixed random seed using java.util.Random, and always get the same contents.\n\n{code}\n     if (this.layoutVersion > HdfsConstants.DATANODE_LAYOUT_VERSION) {\n+\n+      // Clusters previously upgraded from layout versions earlier than\n+      // ADD_DATANODE_AND_STORAGE_UUIDS failed to correctly generate a\n+      // new storage ID. We fix that now.\n+\n+      boolean haveValidStorageId =\n+          DataNodeLayoutVersion.supports(\n+              LayoutVersion.Feature.ADD_DATANODE_AND_STORAGE_UUIDS, layoutVersion) &&\n+              DatanodeStorage.isValidStorageId(sd.getStorageUuid());\n+\n       doUpgrade(datanode, sd, nsInfo);  // upgrade\n-      createStorageID(sd);\n+      if (createStorageID(sd, !haveValidStorageId)) {\n+        LOG.info(\"Generated new storageID \" + sd.getStorageUuid() +\n+                     \" for directory \" + sd.getRoot());\n+      }\n{code}\n\nIt would be good to add some logging for the various cases here.  If we are generating a new storage ID because the previous one was invalid, we should log that the previous one was invalid somewhere.\n\n{code}\n     if (this.layoutVersion > HdfsConstants.DATANODE_LAYOUT_VERSION) {\n{code}\n\nIs this \"if\" statement really valid?  It seems like right now, there are clusters out there that are on the latest layout version, but which don't have \"valid\" storage IDs.  We should either bump the DN layout version, or unconditionally check that the storage ID is valid, right?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-09T02:18:21.957+0000","updated":"2015-01-09T02:18:37.878+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14270527","id":"14270527","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for the review Colin.\n\nThe three tar files for the newly added tests are less than each less than 15KB, one is less than 10KB. The reason the diff is large is because an existing tar file for the HDFS-6482 unit test is being modified. That tar file was about 600KB. I think I can rewrite the test case to not require the modification, so the diff size would be reasonable.\n\n{code}\n     if (this.layoutVersion > HdfsConstants.DATANODE_LAYOUT_VERSION) {\n{code}\nDuring upgrade {{this.layoutVersion}} is the pre-upgrade LV and {{HdfsConstants.DATANODE_LAYOUT_VERSION}} is the post-upgrade LV. Hence this check will always trigger when upgrading to from 2.6 or earlier to 2.7+, which is what we want.\n\nI'll add the logging in the next patch revision.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-09T04:13:22.574+0000","updated":"2015-01-09T04:13:22.574+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14270532","id":"14270532","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12690991/HDFS-7575.02.patch\n  against trunk revision ae91b13.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 9 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.hdfs.TestDatanodeLayoutUpgrade\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/9158//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/9158//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-09T04:23:06.234+0000","updated":"2015-01-09T04:23:06.234+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14271723","id":"14271723","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch that does not modify the existing test case to reduce binary diff.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-09T19:06:57.651+0000","updated":"2015-01-09T19:06:57.651+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14271746","id":"14271746","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"This is a general question, I don't have specific instances: Is there any lingering data that might also need to be cleaned up or removed after the upgrade to storage ids?\n\nAlso, will the NN correctly adapt to the new storage ids?  I think it will when the DN reregisters and sends full block reports.  Need to be certain this is rolling upgrade safe.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2015-01-09T19:23:57.841+0000","updated":"2015-01-09T19:23:57.841+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14271756","id":"14271756","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"Also, is the layout version for UPGRADE_GENERATES_STORAGE_IDS necessary?  The prior layout versions already \"work\" for single/multi storage ids and the new layout id doesn't seem to be referenced anywhere.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2015-01-09T19:31:28.119+0000","updated":"2015-01-09T19:31:28.119+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14271782","id":"14271782","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. This is a general question, I don't have specific instances: Is there any lingering data that might also need to be cleaned up or removed after the upgrade to storage ids?\nThe stale storages need to be cleaned up on the NN. This will be fixed by HDFS-7596.\n\nbq. Also, will the NN correctly adapt to the new storage ids? I think it will when the DN reregisters and sends full block reports. Need to be certain this is rolling upgrade safe.\nFrom my unit testing, the NN does handle the new storage ids and migrates blocks from the old storage to the new storage id as the block reports come in. \n\nbq. Also, is the layout version for UPGRADE_GENERATES_STORAGE_IDS necessary? The prior layout versions already \"work\" for single/multi storage ids and the new layout id doesn't seem to be referenced anywhere.\nGood question. For clusters previously upgraded from 2.2, we are technically changing the content of the VERSION files so a layout version change seemed warranted. Do you see any downside to doing so?\n\nThanks for taking a look at the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-09T19:50:53.998+0000","updated":"2015-01-09T19:50:53.998+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14271963","id":"14271963","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12691363/HDFS-7575.03.patch\n  against trunk revision ae91b13.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 9 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.hdfs.TestDatanodeLayoutUpgradeGeneratesStorageID\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/9166//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/9166//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-09T22:24:15.620+0000","updated":"2015-01-09T22:24:15.620+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14271980","id":"14271980","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"The test failure is due to the missing binary files. It can be resolved by copying the attached .tgz files under _hadoop-hdfs-project/hadoop-hdfs/src/test/resources/_","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-09T22:31:17.829+0000","updated":"2015-01-09T22:31:17.829+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14271997","id":"14271997","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12691413/testUpgradeFrom24PreservesStorageId.tgz\n  against trunk revision ae91b13.\n\n    {color:red}-1 patch{color}.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/9172//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-09T22:40:24.107+0000","updated":"2015-01-09T22:40:24.107+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14273948","id":"14273948","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"[~cmccabe], [~daryn],\n\nAre you okay with proceeding with the patch or are there any open questions you'd like to see addressed?\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-12T18:54:36.866+0000","updated":"2015-01-12T18:54:36.866+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14274124","id":"14274124","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"[~daryn]: I think a new layout version makes sense here.  Basically we are going from a layout where the storageID might not have been unique, to one where it is.  This is a change in the VERSION file.  It's nice to have the same guarantees that we usually do (that if the ugprade fails, you can roll back via the {{previous}} directory, and so forth.)  We could probably be more \"clever\" here and optimize this so we didn't have to hardlink the block files, but the upgrade path is already a little too \"clever\" and I think this is fine.\n\nRather than calling the new layout version UPGRADE_GENERATES_STORAGE_IDS, how about calling it something like UNIQUE_STORAGE_IDS or GUARANTEED_UNIQUE_STORAGE_IDS?  That describes what the new layout is, rather than what the process of upgrading is, consistent with our other layout version descriptions.\n\n{code}\n110    ... = new ClusterVerifier() {\n111\t      @Override\n112\t      public void verifyClusterPostUpgrade(MiniDFSCluster cluster) throws IOException {\n113\t        // Verify that a GUID-based storage ID was generated.\n114\t        final String bpid = cluster.getNamesystem().getBlockPoolId();\n115\t        StorageReport[] reports =\n116\t            cluster.getDataNodes().get(0).getFSDataset().getStorageReports(bpid);\n117\t        assertThat(reports.length, is(1));\n118\t        final String storageID = reports[0].getStorage().getStorageID();\n119\t        assertTrue(DatanodeStorage.isValidStorageId(storageID));\n120\t      }\n{code}\nIt seems like this exact code appears in 3 different tests.  We should just make this Verifier a static object that's created once in the test or something?\n\n+1 once these are addressed.  [~daryn], please take a look if you can... we'd really like to fix this one.  Thanks, guys","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-12T20:32:31.150+0000","updated":"2015-01-12T20:32:31.150+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14274166","id":"14274166","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for reviewing. v04 patch addresses latest the feedback from Colin. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-12T21:00:25.937+0000","updated":"2015-01-12T21:00:25.937+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14274518","id":"14274518","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12691741/HDFS-7575.04.patch\n  against trunk revision b78b4a1.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 9 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.hdfs.TestDatanodeLayoutUpgradeGeneratesStorageID\n                  org.apache.hadoop.hdfs.server.balancer.TestBalancer\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/9189//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/9189//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-13T00:52:13.772+0000","updated":"2015-01-13T00:52:13.772+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14276114","id":"14276114","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"Any comments on the v04 patch? Be good to get this change in. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-13T22:44:33.426+0000","updated":"2015-01-13T22:44:33.426+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14277222","id":"14277222","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"I'm not an expert in this area, but I still question bumping the layout version.  The layout isn't changing, just an existing value in the VERSION file.\n\nSince we know duplicate storage ids are bad, I think the correct logic is to always sanity check the storage ids at startup.  If there are collisions, then the storage should be updated.  Rollback should not restore a bug by reverting the storage id to a dup.\n\nBTW, {{UUID.randomUUID}} isn't guaranteed to return a unique id.  It's _highly_ improbable, but possible, although more likely due to older storages, user copying a storage, etc.  Although the storage ids are unique after the \"upgrade\", if a disk is moved from one node to another, then a collision is possible.  Hence another reason why I feel explicitly checking for collisions at startup should always be done.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2015-01-14T16:57:38.508+0000","updated":"2015-01-14T16:57:38.508+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14277294","id":"14277294","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"I agree with [~daryn] that there isno need to change the layout here. Layout change is only necessary if the two layouts are not compatible and the downgrade does not work from newer release to older. Is that the case here?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-14T17:43:25.344+0000","updated":"2015-01-14T17:43:25.344+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14277721","id":"14277721","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"Ok latest patch does not require a layout version upgrade.\n\nbq. BTW, UUID.randomUUID isn't guaranteed to return a unique id. It's highly improbable, but possible, although more likely due to older storages, user copying a storage, etc. Although the storage ids are unique after the \"upgrade\", if a disk is moved from one node to another, then a collision is possible. Hence another reason why I feel explicitly checking for collisions at startup should always be done.\nUUIDs are designed to be globally unique with a high probability when generated by trusted processes. Even when the volume of generated UUIDs is very high, which is certainly not the case for storage IDs. The probability of a storageID collision in normal operation is vanishingly small.\nhttps://en.wikipedia.org/wiki/Universally_unique_identifier#Random_UUID_probability_of_duplicates\nIf you are still concerned about UUID collision we can handle it in a separate Jira. This fix is specific to clusters previously upgraded from Hadoop 2.2 so they behave like clusters freshly installed from 2.4 or later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-14T21:35:33.864+0000","updated":"2015-01-14T21:35:33.864+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14277749","id":"14277749","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Suresh wrote: I agree with Daryn Sharp that there isno need to change the layout here. Layout change is only necessary if the two layouts are not compatible and the downgrade does not work from newer release to older. Is that the case here?\n\nThe new layout used in HDFS-6482 is backwards compatible, in the sense that older versions of hadoop can run with it.  HDFS-6482 just added the invariant that block ID uniquely determines which subdir a block is in, but subdirs already existed.  Does that mean we shouldn't have changed the layout version for HDFS-6482?  I think the answer is clear.\n\nbq. Daryn wrote: Since we know duplicate storage ids are bad, I think the correct logic is to always sanity check the storage ids at startup. If there are collisions, then the storage should be updated. Rollback should not restore a bug by reverting the storage id to a dup.\n\nI'm surprised to hear you say that rollback should not be an option.  It seems like the conservative thing to do here is to allow the user to restore to the VERSION file.  Obviously we believe there will be no problems.  But we always believe that, or else we wouldn't have made the change.  Sometimes there are problems.\n\nbq. BTW, UUID.randomUUID isn't guaranteed to return a unique id. It's highly improbable, but possible, although more likely due to older storages, user copying a storage, etc.\n\nThis is really not a good argument.  Collisions in 128-bit space are extremely unlikely.  You will never see one in your lifetime.  Up until HDFS-4645, HDFS used randomly generated block IDs drawn from a far smaller space-- 2^64 -- and we never had a problem.  Phrases like \"billions and billions\" and \"total number of grains of sand in the world\" don't begin to approach the size of 2^128.\n\nI think it's frustrating for storage IDs to change without warning just because HDFS was restarted.  It will make diagnosing problems by reading log files harder because storageIDs might morph at any time.  It also sets a bad precedent of not allowing downgrade and modifying VERSION files \"on the fly\" during startup.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-14T21:46:19.589+0000","updated":"2015-01-14T21:46:19.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14277794","id":"14277794","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"I prefer a layout version bump per my original patch, if for no other reason than the fact that the DataNode upgrade path is complicated enough without having to think about OOB metadata changes. In this case the metadata change is limited so I'd be okay with making the exception.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-14T22:24:43.317+0000","updated":"2015-01-14T22:24:43.317+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14277795","id":"14277795","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"{quote}\n>    BTW, UUID.randomUUID isn't guaranteed to return a unique id. It's highly improbable, but possible, although more likely due to older storages, user copying a storage, etc. Although the storage ids are unique after the \"upgrade\", if a disk is moved from one node to another, then a collision is possible. Hence another reason why I feel explicitly checking for collisions at startup should always be done.\n\nUUIDs are designed to be globally unique with a high probability when generated by trusted processes. Even when the volume of generated UUIDs is very high, which is certainly not the case for storage IDs. The probability of a storageID collision in normal operation is vanishingly small.\nhttps://en.wikipedia.org/wiki/Universally_unique_identifier#Random_UUID_probability_of_duplicates\n{quote}\nWe usually compare the probability of collision with hardware failure probability, or using the famous cosmic ray argument (http://stackoverflow.com/questions/2580933/cosmic-rays-what-is-the-probability-they-will-affect-a-program), since we can never do better than that.\n\n{quote}\n... Up until HDFS-4645, HDFS used randomly generated block IDs drawn from a far smaller space-- 2^64  and we never had a problem. ...\n{quote}\nWe did have collision check for random block IDs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-14T22:25:06.423+0000","updated":"2015-01-14T22:25:06.423+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14277895","id":"14277895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"bq. I think it's frustrating for storage IDs to change without warning just because HDFS was restarted.  It will make diagnosing problems by reading log files harder because storageIDs might morph at any time. It also sets a bad precedent of not allowing downgrade and modifying VERSION files \"on the fly\" during startup.\n\nI'm confused.  StorageIDs aren't going to repeatedly morph - unless there's a UUID collision that you argue can't happen.  The important part is you always want unique storage ids.  It's an internal default of hdfs that is not up to the user to assign.  Succinctly stated, what I'd like is for storage ids to be generated if missing, re-generated if incorrectly formatted, or if there are dups.  I think the latest patch actually does the first two, just not the dup check.\n\nbq.  I'm surprised to hear you say that rollback should not be an option. It seems like the conservative thing to do here is to allow the user to restore to the VERSION file. Obviously we believe there will be no problems. But we always believe that, or else we wouldn't have made the change. Sometimes there are problems.\n\nI didn't say that.  Rollback is for reverting an incompatible change.  Changing the storage id is not incompatible.  Unique ids are the default for newly formatted nodes.  If you think unique storage ids may have subtle bugs (different than shared storage ids), then new clusters or newly formatted nodes are buggy.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2015-01-14T23:39:33.673+0000","updated":"2015-01-14T23:39:33.673+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14278041","id":"14278041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12692337/HDFS-7575.05.patch\n  against trunk revision 7fe0f25.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 8 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-nfs:\n\n                  org.apache.hadoop.ha.TestZKFailoverControllerStress\n                  org.apache.hadoop.hdfs.server.namenode.TestFileTruncate\n                  org.apache.hadoop.hdfs.tools.offlineEditsViewer.TestOfflineEditsViewer\n\n                                      The following test timeouts occurred in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-nfs:\n\norg.apache.hadoop.ha.TestZKFailoverControllerStress\norg.apache.hadoop.hdfs.server.mover.TestStorageMover\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/9213//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/9213//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-15T01:17:09.511+0000","updated":"2015-01-15T01:17:09.511+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14279309","id":"14279309","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12692337/HDFS-7575.05.patch\n  against trunk revision ce29074.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 9 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.hdfs.server.balancer.TestBalancerWithMultipleNameNodes\n                  org.apache.hadoop.hdfs.TestDatanodeStartupFixesLegacyStorageIDs\n\n                                      The following test timeouts occurred in hadoop-hdfs-project/hadoop-hdfs:\n\norg.apache.hadoop.hdfs.server.namenode.ha.TestRetryCacheWithHA\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/9223//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/9223//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-15T21:28:18.113+0000","updated":"2015-01-15T21:28:18.113+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14280522","id":"14280522","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"It would be good to get this bug fixed instead of letting it fall off the radar on the layout change technicality. IMO either approach is better than leaving the bug unfixed. Please vote either +1 or -1 on either approach so we have more clarity.\n\nThanks, Arpit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-16T17:20:41.014+0000","updated":"2015-01-16T17:20:41.014+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14284681","id":"14284681","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"So there are two approaches here:\n1. silently (i.e., without user intervention), dedupe duplicate storage IDs when starting up the DataNode\n2. create a new DataNode layout version and dedupe duplicate storage IDs during the upgrade.\n\nArguments in favor of approach #1:\n* Collisions might happen that we need to dedupe repeatly.  This argument seems specious since the probability is effectively less than the change of cosmic rays causing errors (as Nicholas pointed out).  I think the probabilities outlined here make this argument a non-starter: https://en.wikipedia.org/wiki/Universally_unique_identifier#Random_UUID_probability_of_duplicates.  Also, approach #1 only dedupes on a single datanode, but there can be many datanodes in the cluster.\n\n* As Suresh pointed out, the old software can easily handle cases where the Storage IDs are unique.  So using a new layout version is not required to flip back and forth between old and new software.  While this is true, we have bumped the layout version in the past even when the old software could handle the new layout.  For example, HDFS-6482 added a new DN layout version even though the old software could use the new blockid-based layout.  So this argument is basically just saying \"approach #1 is viable.\"  But it doesn't tell us whether approach #1 is a good idea.\n\n* Nobody has made this argument yet, but you could argue that the upgrade process will be faster with approach #1 than approach #2.  However, we've done datanode layout version upgrades on production clusters in the past and time hasn't been an issue.  The JNI hardlink code (and soon, the Java7 hardlink code) eliminated the long delays that resulted from spawning shell commands.  So I don't think this argument is persuasive.\n\nArguments in favor of approach #2:\n* Changing the storage ID during startup basically changes storage ID from being a permanent identifier to a temporary one.  This seems like a small change, but I would argue that it's really a big one, architecturally.  For example, suppose we wanted to persist this information at some point.  We couldn't really do that if it's changing all the time.\n\n* With approach #1, we have to carry the burden of the dedupe code forever.  We can't ever stop deduping, even in Hadoop 3.0, because for all we know, the user has just upgraded, and was previously running 2.6 (a version with the bug) that we will have to correct.  The extra run time isn't an issue, but the complexity is.  What if our write to VERSION fails on one of the volume directories?  What do we do then?  And then if volume failures are tolerated, this directory could later come back and be an issue.  The purpose of layout versions is so that we don't have to think about these kind of \"mix and match\" issues.\n\n* Approach #1 leaves us open to some weird scenarios.  For example, what if I have /storage1 -> /foo and /storage2 -> /foo.  In other words, you have what appears to be two volume root directories, but it's really the same directory.  Approach #2 will complain, but approach #1 will happily rename the storageID of the /foo directory and continue with the corrupt configuration.  This is what happens when you fudge error checking.\n\nSo in conclusion I would argue for approach #2.  Thoughts?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-21T00:01:42.598+0000","updated":"2015-01-21T00:01:42.598+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14284937","id":"14284937","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Layout version defines layout format but not the software (don't confuse it with the software version).  The question here is whether there is a layout format change here.  Are we changing from a layout, where some storage IDs could be the same, to a new layout, where all storage IDs have to be distinct?  I think the answer is no since the same storage ID does not work even using the old software.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-21T00:55:27.058+0000","updated":"2015-01-21T00:55:27.058+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14284973","id":"14284973","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"We should log the old (invalid) storage id.\n\n+1 on HDFS-7575.05.patch other than that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-21T01:27:57.743+0000","updated":"2015-01-21T01:27:57.743+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14285048","id":"14285048","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Layout version defines layout format but not the software (don't confuse it with the software version). The question here is whether there is a layout format change here. Are we changing from a layout, where some storage IDs could be the same, to a new layout, where all storage IDs have to be distinct? I think the answer is no since the same storage ID does not work even using the old software.\n\nNicholas, I already addressed that in my comment.  I wrote \"using a new layout version is not required to flip back and forth between old and new software.... While this is true, we have bumped the layout version in the past even when the old software could handle the new layout.\"  Do you have any thoughts about the other points I mentioned?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-21T02:33:46.269+0000","updated":"2015-01-21T02:33:46.269+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14285135","id":"14285135","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"Just to be clear, I'd like to see some discussion of the points above before we commit this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-21T04:09:48.469+0000","updated":"2015-01-21T04:09:48.469+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14286051","id":"14286051","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> ... we have bumped the layout version in the past even when the old software could handle the new layout. ...\n\nFor HDFS-6482, it does change layout format.  So bumping layout version makes sense.  However, the patch here does not change layout format.  Disagree?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-21T18:54:13.811+0000","updated":"2015-01-21T18:54:13.811+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14286169","id":"14286169","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"This patch does change the layout format.  It changes it from one where storage ID may or may not be unique to one where it definitely is.\n\nCan you response to the practical points I made above?  I made a few points that nobody has responded to yet.\n* Changing the storage ID during startup basically changes storage ID from being a permanent identifier to a temporary one... makes persisting this later impossible.  It commits us to an architecture where block locations can't be persisted.\n* With approach #1, we have to carry the burden of the dedupe code forever.\n* Approach #1 degrades error handling.  If you somehow end up with two volumes that map to the same directory, the code silently does the wrong thing.\n\nI would appreciate a response to these.  thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-21T19:58:55.619+0000","updated":"2015-01-21T19:58:55.619+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14286217","id":"14286217","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> This patch does change the layout format. It changes it from one where storage ID may or may not be unique to one where it definitely is.\n\nSo, you claim that the current format is a layout, where some storage IDs could be the same?\n{code}\n    ADD_DATANODE_AND_STORAGE_UUIDS(-49, \"Replace StorageID with DatanodeUuid.\"\n        + \" Use distinct StorageUuid per storage directory.\"),\n{code}\nIt is clearly specified in the LV -49 that the IDs must be distinct.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-21T20:36:19.724+0000","updated":"2015-01-21T20:36:19.724+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14286230","id":"14286230","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> Can you response to the practical points I made above?\n\nIf there is not layout format change, the practical points seem irrelevant.  Anyway, let me comment on them.\n\n> Changing the storage ID during startup basically changes storage ID from being a permanent identifier to a temporary one... \n\nWe only change a storage ID when it is invalid but not changing the storage ID arbitrarily.  Valid storage IDs are permanent.\n\n> With approach #1, we have to carry the burden of the dedupe code forever.\n\nThe code is for validating storage IDs (but not for de-duplication) and is very simple.  It is good to keep.\n\n> ... If you somehow end up with two volumes that map to the same directory, the code silently does the wrong thing.\n\nIs this a practical error?  Have you seen it in practice?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-21T20:46:30.851+0000","updated":"2015-01-21T20:46:30.851+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14286527","id":"14286527","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. So, you claim that the current format is a layout, where some storage IDs could be the same?... It is clearly specified in the LV -49 that the IDs must be distinct.\n\nWhat's important is what was implemented, not what was written in the comment about the layout version.  And what was implemented does allow duplicate storage IDs.\n\nbq. Is \\[two volumes that map to the same directory\\] a practical error? Have you seen it in practice?\n\nYes.  Recently we had a cluster with two datanodes connected to the same shared storage accidentally.  I guess you could argue that lock files should prevent problems here.  However, I do not like the idea of datanodes modifying VERSION on startup at all.  If one of the DNs had terminated before the other one tried to lock the directory, it would have succeeded.  And with the \"retry failed volume\" stuff, we probably have a wide window for this to happen.\n\nbq. We only change a storage ID when it is invalid but not changing the storage ID arbitrarily. Valid storage IDs are permanent.\n\nAgain, if I accidentally duplicate a directory on a datanode, then the storage ID morph for one of the directories.  That doesn't sound permanent to me.\n\nbq. The code is for validating storage IDs (but not for de-duplication) and is very simple. It is good to keep.\n\nI agree that it is good to validate the storage IDs are unique.  But this is the same as when we validate that the cluster ID is correct, or the layout version is correct.  We don't change incorrect values to \"fix\" them.  If they're wrong then we need to find out why, not sweep the problem under the rug.\n\nAre there any practical arguments in favor of not doing a layout version change?  The main argument in favor of not changing the layout here I see is basically that this isn't a \"big enough\" change to merit a new LV.  But that seems irrelevant to me-- the question is which approach is better for error handling and more maintainable.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-21T23:21:30.722+0000","updated":"2015-01-21T23:21:30.722+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14286574","id":"14286574","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> What's important is what was implemented, not what was written in the comment about the layout version. And what was implemented does allow duplicate storage IDs.\n\nI disagree.  The implementation is a bug -- it supposes to change the old ids (in old id format) to use the new uuid format.  The entire heterogeneous storage design requires storage ID to be unique.  Which implementation works correctly with the duplicate storage IDs?  \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-21T23:49:45.927+0000","updated":"2015-01-21T23:49:45.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14286583","id":"14286583","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"For the so called practical points you made (say, \"Again, if I accidentally duplicate a directory on a datanode, ...\") , how could updating layout version help?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-21T23:53:24.756+0000","updated":"2015-01-21T23:53:24.756+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14286637","id":"14286637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. I disagree. The implementation is a bug  it supposes to change the old ids (in old id format) to use the new uuid format. The entire heterogeneous storage design requires storage ID to be unique. Which implementation works correctly with the duplicate storage IDs?\n\nI don't think it's productive to argue about whether this represents a \"true\" layout version change.... whether it is \"layout version changey\" enough.  Clearly we both agree that doing an LV change here would work and solve the problem.  At the end of the day, we have to make the decision based on which way is more maintainable.\n\nThis does bring up a practical point, though.  It will be easier to backport the \"silently modify the VERSION file\" patch to 2.6.1 than the LV change.  In view of this, I think it's fine to backport the \"silently change VERSION\" fix to 2.6.1.  I just don't want to have to support it forever in 3.0 and onward.\n\nbq. For the so called practical points you made (say, \"Again, if I accidentally duplicate a directory on a datanode, ...\") , how could updating layout version help?\n\nIf we check for directories with duplicate storage IDs and exclude them, then the system administrator becomes aware that there is a problem.  It \"helps\" by not \"harming\"-- by not changing the VERSION file when we don't know for sure the reasons why the VERSION file is wrong.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-22T00:30:42.563+0000","updated":"2015-01-22T00:30:42.563+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14287999","id":"14287999","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> I don't think it's productive to argue about whether this represents a \"true\" layout version change.... whether it is \"layout version changey\" enough. Clearly we both agree that doing an LV change here would work and solve the problem. At the end of the day, we have to make the decision based on which way is more maintainable.\n\nYou seem suggesting that even there is no layout format change, it is good to update the layout version because of the bug.  Is it correct?\n\n> ...  It \"helps\" by not \"harming\" ...\n\nI guess you mean it actually does not help at all.  It only shows that the cause of duplication problem is not from this bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-22T19:05:34.514+0000","updated":"2015-01-22T19:05:34.514+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14288071","id":"14288071","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"I looked at patch 005 more carefully, and now I can see that it only ever modifies storage IDs when the ID can't be parsed as a UUID.  So this should really only have an effect with storageIDs generated by pre-upgraded clusters.  The other nice thing about patch 005 is that it can easily be backported to 2.6.1, and it will be quicker to upgrade because it doesn't involve a LV change.\n\nSo on reconsideration, I am +1 for patch 005 (the latest version).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-22T19:32:28.756+0000","updated":"2015-01-22T19:32:28.756+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14288260","id":"14288260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Colin.\n\nbq. We should log the old (invalid) storage id.\nHi [~szetszwo], we are already doing so in the v05 patch.\n\nIn {{createStorageID}}:\n{code}\n      LOG.info(\"Generated new storageID \" + sd.getStorageUuid() +\n          \" for directory \" + sd.getRoot() +\n          (oldStorageID == null ? \"\" : (\" to replace \" + oldStorageID)));\n{code}\n\nIs this what you were looking for?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-22T21:33:38.449+0000","updated":"2015-01-22T21:34:00.893+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14288285","id":"14288285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Yes.  It is great that we already have the log.\n\n+1 on HDFS-7575.05.patch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-22T21:57:15.536+0000","updated":"2015-01-22T21:57:15.536+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14288321","id":"14288321","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to trunk and branch-2.\n\nThanks for the reviews [~szetszwo] and [~cmccabe], and thanks for all the discussion.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitagarwal","name":"arpitagarwal","key":"arpitagarwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Agarwal","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-22T22:16:25.008+0000","updated":"2015-01-22T22:16:25.008+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14288700","id":"14288700","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-trunk-Commit #6915 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/6915/])\nHDFS-7575. Upgrade should generate a unique storage ID for each volume. (Contributed by Arpit Agarwal) (arp: rev d34074e237ee10b83aeb02294f595714d43e39e4)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom26PreservesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDatanodeLayoutUpgrade.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDatanodeStartupFixesLegacyStorageIDs.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/TestFsDatasetImpl.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom26PreservesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22FixesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22via26FixesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeStorage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22FixesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/UpgradeUtilities.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/SimulatedFSDataset.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/DataStorage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSUpgradeFromImage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22via26FixesStorageIDs.txt\nHDFS-7575. Fix CHANGES.txt (arp: rev 792b7d337a0edbc3da74099709c197e85ce38097)\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-23T03:55:38.970+0000","updated":"2015-01-23T03:55:38.970+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14289070","id":"14289070","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #82 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/82/])\nHDFS-7575. Upgrade should generate a unique storage ID for each volume. (Contributed by Arpit Agarwal) (arp: rev d34074e237ee10b83aeb02294f595714d43e39e4)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDatanodeStartupFixesLegacyStorageIDs.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22FixesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22via26FixesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/DataStorage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeStorage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22via26FixesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDatanodeLayoutUpgrade.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSUpgradeFromImage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom26PreservesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/UpgradeUtilities.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom26PreservesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/TestFsDatasetImpl.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22FixesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/SimulatedFSDataset.java\nHDFS-7575. Fix CHANGES.txt (arp: rev 792b7d337a0edbc3da74099709c197e85ce38097)\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-23T10:41:38.606+0000","updated":"2015-01-23T10:41:38.606+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14289106","id":"14289106","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Yarn-trunk #816 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/816/])\nHDFS-7575. Upgrade should generate a unique storage ID for each volume. (Contributed by Arpit Agarwal) (arp: rev d34074e237ee10b83aeb02294f595714d43e39e4)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom26PreservesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSUpgradeFromImage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/SimulatedFSDataset.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/TestFsDatasetImpl.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22via26FixesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22FixesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22via26FixesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/UpgradeUtilities.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/DataStorage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22FixesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom26PreservesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDatanodeLayoutUpgrade.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeStorage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDatanodeStartupFixesLegacyStorageIDs.java\nHDFS-7575. Fix CHANGES.txt (arp: rev 792b7d337a0edbc3da74099709c197e85ce38097)\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-23T11:32:21.023+0000","updated":"2015-01-23T11:32:21.023+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14289184","id":"14289184","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Hdfs-trunk #2014 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2014/])\nHDFS-7575. Upgrade should generate a unique storage ID for each volume. (Contributed by Arpit Agarwal) (arp: rev d34074e237ee10b83aeb02294f595714d43e39e4)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/TestFsDatasetImpl.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22FixesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSUpgradeFromImage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22via26FixesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDatanodeStartupFixesLegacyStorageIDs.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/DataStorage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22FixesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDatanodeLayoutUpgrade.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom26PreservesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/SimulatedFSDataset.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/UpgradeUtilities.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom26PreservesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22via26FixesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeStorage.java\nHDFS-7575. Fix CHANGES.txt (arp: rev 792b7d337a0edbc3da74099709c197e85ce38097)\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-23T12:35:33.795+0000","updated":"2015-01-23T12:35:33.795+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14289278","id":"14289278","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #79 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/79/])\nHDFS-7575. Upgrade should generate a unique storage ID for each volume. (Contributed by Arpit Agarwal) (arp: rev d34074e237ee10b83aeb02294f595714d43e39e4)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22FixesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom26PreservesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSUpgradeFromImage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDatanodeLayoutUpgrade.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/DataStorage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/SimulatedFSDataset.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22via26FixesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22via26FixesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/TestFsDatasetImpl.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/UpgradeUtilities.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22FixesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom26PreservesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeStorage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDatanodeStartupFixesLegacyStorageIDs.java\nHDFS-7575. Fix CHANGES.txt (arp: rev 792b7d337a0edbc3da74099709c197e85ce38097)\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-23T14:17:29.219+0000","updated":"2015-01-23T14:17:29.219+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14289341","id":"14289341","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #83 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/83/])\nHDFS-7575. Upgrade should generate a unique storage ID for each volume. (Contributed by Arpit Agarwal) (arp: rev d34074e237ee10b83aeb02294f595714d43e39e4)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/TestFsDatasetImpl.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/DataStorage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22FixesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22via26FixesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom26PreservesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom26PreservesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22FixesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDatanodeStartupFixesLegacyStorageIDs.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22via26FixesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeStorage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDatanodeLayoutUpgrade.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSUpgradeFromImage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/UpgradeUtilities.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/SimulatedFSDataset.java\nHDFS-7575. Fix CHANGES.txt (arp: rev 792b7d337a0edbc3da74099709c197e85ce38097)\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-23T15:05:12.936+0000","updated":"2015-01-23T15:05:12.936+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14289376","id":"14289376","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Mapreduce-trunk #2033 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2033/])\nHDFS-7575. Upgrade should generate a unique storage ID for each volume. (Contributed by Arpit Agarwal) (arp: rev d34074e237ee10b83aeb02294f595714d43e39e4)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDFSUpgradeFromImage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22via26FixesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDatanodeStartupFixesLegacyStorageIDs.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom26PreservesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestDatanodeLayoutUpgrade.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22via26FixesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom26PreservesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22FixesStorageIDs.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/UpgradeUtilities.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/protocol/DatanodeStorage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/resources/testUpgradeFrom22FixesStorageIDs.tgz\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/DataStorage.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/TestFsDatasetImpl.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/datanode/SimulatedFSDataset.java\nHDFS-7575. Fix CHANGES.txt (arp: rev 792b7d337a0edbc3da74099709c197e85ce38097)\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-01-23T15:23:54.741+0000","updated":"2015-01-23T15:23:54.741+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764191/comment/14724131","id":"14724131","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"[~sjlee0] backported this to 2.6.1. I just pushed the commit to 2.6.1 after running compilation and TestDFSUpgradeFromImage, TestDatanodeLayoutUpgrade, TestDatanodeStartupFixesLegacyStorageIDs, TestFsDatasetImpl which changed in the patch.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-08-31T22:13:10.839+0000","updated":"2015-08-31T22:13:10.839+0000"}],"maxResults":64,"total":64,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7575/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i23uin:"}}