{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12873175","self":"https://issues.apache.org/jira/rest/api/2/issue/12873175","key":"HDFS-9096","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-09-09T04:36:58.024+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Oct 20 11:43:52 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-9096/watchers","watchCount":11,"isWatching":false},"created":"2015-09-17T04:22:45.297+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326143","id":"12326143","description":"2.4.0 release","name":"2.4.0","archived":false,"released":true,"releaseDate":"2014-04-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-10-20T11:43:52.595+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12324715","id":"12324715","name":"rolling upgrades"}],"timeoriginalestimate":null,"description":"I tried to do rolling upgrade from hadoop 2.4.0 to hadoop 2.7.1. As per http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HdfsRollingUpgrade.html#dfsadmin_-rollingUpgrade one can rollback to previous release provided the finalise step is not done. I upgraded the setup but didnot finalise the upgrade and tried to rollback HDFS to 2.4.0\n\nI tried the following steps\n\n  1.  Shutdown all NNs and DNs.\n  2.  Restore the pre-upgrade release in all machines.\n  3.  Start NN1 as Active with the \"-rollingUpgrade rollback<http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HdfsRollingUpgrade.html#namenode_-rollingUpgrade>\" option.\n\n\n\nI am getting the following error after 3rd step\n\n15/09/01 17:53:35 INFO namenode.AclConfigFlag: ACLs enabled? false\n\n15/09/01 17:53:35 INFO common.Storage: Lock on <<NameNode dir>>/in_use.lock acquired by nodename 12152@VM-2\n\n15/09/01 17:53:35 WARN namenode.FSNamesystem: Encountered exception loading fsimage\n\norg.apache.hadoop.hdfs.server.common.IncorrectVersionException: Unexpected version of storage directory /data/yarn/namenode. Reported: -63. Expecting = -56.\n\nat org.apache.hadoop.hdfs.server.common.StorageInfo.setLayoutVersion(StorageInfo.java:178)\n\nat org.apache.hadoop.hdfs.server.common.StorageInfo.setFieldsFromProperties(StorageInfo.java:131)\n\nat org.apache.hadoop.hdfs.server.namenode.NNStorage.setFieldsFromProperties(NNStorage.java:608)\n\nat org.apache.hadoop.hdfs.server.common.StorageInfo.readProperties(StorageInfo.java:228)\n\nat org.apache.hadoop.hdfs.server.namenode.FSImage.recoverStorageDirs(FSImage.java:309)\n\nat org.apache.hadoop.hdfs.server.namenode.FSImage.recoverTransitionRead(FSImage.java:202)\n\nat org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFSImage(FSNamesystem.java:882)\n\nat org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFromDisk(FSNamesystem.java:639)\n\nat org.apache.hadoop.hdfs.server.namenode.NameNode.loadNamesystem(NameNode.java:455)\n\nat org.apache.hadoop.hdfs.server.namenode.NameNode.initialize(NameNode.java:511)\n\nat org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:670)\n\nat org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:655)\n\nat org.apache.hadoop.hdfs.server.namenode.NameNode.createNameNode(NameNode.java:1304)\n\nat org.apache.hadoop.hdfs.server.namenode.NameNode.main(NameNode.java:1370)\n\n15/09/01 17:53:35 INFO mortbay.log: Stopped SelectChannelConnector@0.0.0.0:50070\n\n15/09/01 17:53:35 INFO impl.MetricsSystemImpl: Stopping NameNode metrics system...\n\n15/09/01 17:53:35 INFO impl.MetricsSystemImpl: NameNode metrics system stopped.\n\n15/09/01 17:53:35 INFO impl.MetricsSystemImpl: NameNode metrics system shutdown complete.\n\n15/09/01 17:53:35 FATAL namenode.NameNode: Exception in namenode join\n\n\nFrom rolling upgrade documentation it can be inferred that rolling upgrade is supported Hadoop 2.4.0 onwards but rollingUpgrade rollback to Hadoop 2.4.0 seems to be broken in Hadoop 2.4.0. It throws above mentioned error.\n\n\nAre there any other steps to perform rollback (from rolling upgrade) or is it not supported to rollback to Hadoop 2.4.0.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Issue in Rollback (after rolling upgrade) from hadoop 2.7.1 to 2.4.0","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harpreet.kaur","name":"harpreet.kaur","key":"harpreet.kaur","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harpreet Kaur","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harpreet.kaur","name":"harpreet.kaur","key":"harpreet.kaur","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harpreet Kaur","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10431","value":"Important","id":"10431"}],"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12873175/comment/15475894","id":"15475894","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=DineshKumarP","name":"DineshKumarP","key":"dineshkumarp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dinesh","active":true,"timeZone":"Asia/Kolkata"},"body":"Facing same issue when I Rollback (after rolling upgrade) from Hadoop 2.7.2 to 2.5.2; Could any one please tell, is this a known bug?\n\nBased on below logs, please suggest can we consider this issue as a new bug,\n\nMy Name node log details:\n\n|C:\\SDK\\Hadoop\\bin>hdfs namenode -rollingUpgrade rollback\n16/10/18 18:58:25 INFO namenode.NameNode: STARTUP_MSG:\n/************************************************************\nSTARTUP_MSG: Starting NameNode\nSTARTUP_MSG:   host = myserver/192.168.10.1\nSTARTUP_MSG:   args = [-rollingUpgrade, rollback]\nSTARTUP_MSG:   version = 2.5.2\nSTARTUP_MSG:   classpath = ...\nSTARTUP_MSG:   build = Unknown -r Unknown; compiled by 'Dinesh' on 2016-01-14T11:05Z\nSTARTUP_MSG:   java = 1.7.0_51\n************************************************************/\n16/10/18 18:58:25 INFO namenode.NameNode: createNameNode [-rollingUpgrade, rollback]\n16/10/18 18:58:25 INFO impl.MetricsConfig: loaded properties from hadoop-metrics2.properties\n16/10/18 18:58:25 INFO impl.MetricsSystemImpl: Scheduled snapshot period at 10 second(s).\n16/10/18 18:58:25 INFO impl.MetricsSystemImpl: NameNode metrics system started\n16/10/18 18:58:25 INFO namenode.NameNode: fs.defaultFS is hdfs://hacluster\n16/10/18 18:58:25 INFO namenode.NameNode: Clients are to use hacluster to access this namenode/service.\n16/10/18 18:58:26 INFO hdfs.DFSUtil: Starting web server as: ${dfs.web.authentication.kerberos.principal}\n16/10/18 18:58:26 INFO hdfs.DFSUtil: Starting Web-server for hdfs at: http://myserver.root.Dinesh.lan:50070\n16/10/18 18:58:26 INFO mortbay.log: Logging to org.slf4j.impl.Log4jLoggerAdapter(org.mortbay.log) via org.mortbay.log.Slf4jLog\n16/10/18 18:58:26 INFO http.HttpRequestLog: Http request log for http.requests.namenode is not defined\n16/10/18 18:58:26 INFO http.HttpServer2: Added global filter 'safety' (class=org.apache.hadoop.http.HttpServer2$QuotingInputFilter)\n16/10/18 18:58:26 INFO http.HttpServer2: Added filter static_user_filter (class=org.apache.hadoop.http.lib.StaticUserWebFilter$StaticUserFilter) to context hdfs\n16/10/18 18:58:26 INFO http.HttpServer2: Added filter static_user_filter (class=org.apache.hadoop.http.lib.StaticUserWebFilter$StaticUserFilter) to context static\n16/10/18 18:58:26 INFO http.HttpServer2: Added filter static_user_filter (class=org.apache.hadoop.http.lib.StaticUserWebFilter$StaticUserFilter) to context logs\n16/10/18 18:58:26 INFO http.HttpServer2: Added filter 'org.apache.hadoop.hdfs.web.AuthFilter' (class=org.apache.hadoop.hdfs.web.AuthFilter)\n16/10/18 18:58:26 INFO http.HttpServer2: addJerseyResourcePackage: packageName=org.apache.hadoop.hdfs.server.namenode.web.resources;org.apache.hadoop.hdfs.web.resources, pathSpec=/webhdfs/v1/*\n16/10/18 18:58:26 INFO http.HttpServer2: Jetty bound to port 50070\n16/10/18 18:58:26 INFO mortbay.log: jetty-6.1.26\n16/10/18 18:58:26 WARN server.AuthenticationFilter: 'signature.secret' configuration not set, using a random value as secret\n16/10/18 18:58:26 INFO mortbay.log: Started HttpServer2$SelectChannelConnectorWithSafeStartup@myserver.root.Dinesh.lan:50070\n16/10/18 18:58:26 WARN namenode.FSNamesystem: Only one image storage directory (dfs.namenode.name.dir) configured. Beware of data loss due to lack of redundant storage directories!\n16/10/18 18:58:26 INFO namenode.FSNamesystem: fsLock is fair:true\n16/10/18 18:58:26 INFO blockmanagement.DatanodeManager: dfs.block.invalidate.limit=1000\n16/10/18 18:58:26 INFO blockmanagement.DatanodeManager: dfs.namenode.datanode.registration.ip-hostname-check=true\n16/10/18 18:58:26 INFO blockmanagement.BlockManager: dfs.namenode.startup.delay.block.deletion.sec is set to 000:00:00:00.000\n16/10/18 18:58:26 INFO blockmanagement.BlockManager: The block deletion will start around 2016 Oct 18 18:58:26\n16/10/18 18:58:26 INFO util.GSet: Computing capacity for map BlocksMap\n16/10/18 18:58:26 INFO util.GSet: VM type       = 64-bit\n16/10/18 18:58:26 INFO util.GSet: 2.0% max memory 910.5 MB = 18.2 MB\n16/10/18 18:58:26 INFO util.GSet: capacity      = 2^21 = 2097152 entries\n16/10/18 18:58:26 INFO blockmanagement.BlockManager: dfs.block.access.token.enable=false\n16/10/18 18:58:26 INFO blockmanagement.BlockManager: defaultReplication         = 3\n16/10/18 18:58:26 INFO blockmanagement.BlockManager: maxReplication             = 512\n16/10/18 18:58:26 INFO blockmanagement.BlockManager: minReplication             = 1\n16/10/18 18:58:26 INFO blockmanagement.BlockManager: maxReplicationStreams      = 2\n16/10/18 18:58:26 INFO blockmanagement.BlockManager: shouldCheckForEnoughRacks  = false\n16/10/18 18:58:26 INFO blockmanagement.BlockManager: replicationRecheckInterval = 3000\n16/10/18 18:58:26 INFO blockmanagement.BlockManager: encryptDataTransfer        = false\n16/10/18 18:58:26 INFO blockmanagement.BlockManager: maxNumBlocksToLog          = 1000\n16/10/18 18:58:26 INFO namenode.FSNamesystem: fsOwner             = SYSTEM (auth:SIMPLE)\n16/10/18 18:58:26 INFO namenode.FSNamesystem: supergroup          = Users\n16/10/18 18:58:26 INFO namenode.FSNamesystem: isPermissionEnabled = false\n16/10/18 18:58:26 INFO namenode.FSNamesystem: Determined nameservice ID: hacluster\n16/10/18 18:58:26 INFO namenode.FSNamesystem: HA Enabled: true\n16/10/18 18:58:26 INFO namenode.FSNamesystem: Append Enabled: true\n16/10/18 18:58:26 INFO util.GSet: Computing capacity for map INodeMap\n16/10/18 18:58:26 INFO util.GSet: VM type       = 64-bit\n16/10/18 18:58:26 INFO util.GSet: 1.0% max memory 910.5 MB = 9.1 MB\n16/10/18 18:58:26 INFO util.GSet: capacity      = 2^20 = 1048576 entries\n16/10/18 18:58:26 INFO namenode.NameNode: Caching file names occuring more than 10 times\n16/10/18 18:58:26 INFO util.GSet: Computing capacity for map cachedBlocks\n16/10/18 18:58:26 INFO util.GSet: VM type       = 64-bit\n16/10/18 18:58:26 INFO util.GSet: 0.25% max memory 910.5 MB = 2.3 MB\n16/10/18 18:58:26 INFO util.GSet: capacity      = 2^18 = 262144 entries\n16/10/18 18:58:26 INFO namenode.FSNamesystem: dfs.namenode.safemode.threshold-pct = 0.9990000128746033\n16/10/18 18:58:26 INFO namenode.FSNamesystem: dfs.namenode.safemode.min.datanodes = 0\n16/10/18 18:58:26 INFO namenode.FSNamesystem: dfs.namenode.safemode.extension     = 30000\n16/10/18 18:58:26 INFO namenode.FSNamesystem: Retry cache on namenode is enabled\n16/10/18 18:58:26 INFO namenode.FSNamesystem: Retry cache will use 0.03 of total heap and retry cache entry expiry time is 600000 millis\n16/10/18 18:58:26 INFO util.GSet: Computing capacity for map NameNodeRetryCache\n16/10/18 18:58:26 INFO util.GSet: VM type       = 64-bit\n16/10/18 18:58:26 INFO util.GSet: 0.029999999329447746% max memory 910.5 MB = 279.7 KB\n16/10/18 18:58:26 INFO util.GSet: capacity      = 2^15 = 32768 entries\n16/10/18 18:58:26 INFO namenode.NNConf: ACLs enabled? false\n16/10/18 18:58:26 INFO namenode.NNConf: XAttrs enabled? true\n16/10/18 18:58:26 INFO namenode.NNConf: Maximum size of an xattr: 16384\n16/10/18 18:58:26 INFO common.Storage: Lock on \\Metadata\\data\\dfs\\namenode\\in_use.lock acquired by nodename 8804@myserver\n16/10/18 18:58:26 WARN namenode.FSNamesystem: Encountered exception loading fsimage\norg.apache.hadoop.hdfs.server.common.IncorrectVersionException: Unexpected version of storage directory C:\\Metadata\\data\\dfs\\namenode. Reported: -63. Expecting = -57.\n        at org.apache.hadoop.hdfs.server.common.StorageInfo.setLayoutVersion(StorageInfo.java:178)\n        at org.apache.hadoop.hdfs.server.common.StorageInfo.setFieldsFromProperties(StorageInfo.java:131)\n        at org.apache.hadoop.hdfs.server.namenode.NNStorage.setFieldsFromProperties(NNStorage.java:608)\n        at org.apache.hadoop.hdfs.server.common.StorageInfo.readProperties(StorageInfo.java:228)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.recoverStorageDirs(FSImage.java:323)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.recoverTransitionRead(FSImage.java:202)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFSImage(FSNamesystem.java:955)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFromDisk(FSNamesystem.java:700)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.loadNamesystem(NameNode.java:529)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.initialize(NameNode.java:585)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:751)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:735)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.createNameNode(NameNode.java:1407)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.main(NameNode.java:1473)\n16/10/18 18:58:26 INFO mortbay.log: Stopped HttpServer2$SelectChannelConnectorWithSafeStartup@myserver.root.Dinesh.lan:50070\n16/10/18 18:58:26 INFO impl.MetricsSystemImpl: Stopping NameNode metrics system...\n16/10/18 18:58:26 INFO impl.MetricsSystemImpl: NameNode metrics system stopped.\n16/10/18 18:58:26 INFO impl.MetricsSystemImpl: NameNode metrics system shutdown complete.\n16/10/18 18:58:26 FATAL namenode.NameNode: Exception in namenode join\norg.apache.hadoop.hdfs.server.common.IncorrectVersionException: Unexpected version of storage directory C:\\Metadata\\data\\dfs\\namenode. Reported: -63. Expecting = -57.\n        at org.apache.hadoop.hdfs.server.common.StorageInfo.setLayoutVersion(StorageInfo.java:178)\n        at org.apache.hadoop.hdfs.server.common.StorageInfo.setFieldsFromProperties(StorageInfo.java:131)\n        at org.apache.hadoop.hdfs.server.namenode.NNStorage.setFieldsFromProperties(NNStorage.java:608)\n        at org.apache.hadoop.hdfs.server.common.StorageInfo.readProperties(StorageInfo.java:228)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.recoverStorageDirs(FSImage.java:323)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.recoverTransitionRead(FSImage.java:202)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFSImage(FSNamesystem.java:955)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFromDisk(FSNamesystem.java:700)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.loadNamesystem(NameNode.java:529)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.initialize(NameNode.java:585)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:751)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:735)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.createNameNode(NameNode.java:1407)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.main(NameNode.java:1473)\n16/10/18 18:58:26 INFO util.ExitUtil: Exiting with status 1\n16/10/18 18:58:26 INFO namenode.NameNode: SHUTDOWN_MSG:\n/************************************************************\nSHUTDOWN_MSG: Shutting down NameNode at myserver/192.168.10.1\n*************************************************************|","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=DineshKumarP","name":"DineshKumarP","key":"dineshkumarp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dinesh","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-09-09T04:36:58.024+0000","updated":"2016-10-18T13:35:06.093+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12873175/comment/15576095","id":"15576095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"[~andreina], have you seen this kind of issue in rollback?\n\nFrom the trace, it looks like it is having problem after reading in the VERSION file in NN storage directory. The VERSION file must contain the new layout version and somehow the rollback is not being able to deal with it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2016-10-14T18:24:08.970+0000","updated":"2016-10-14T18:24:08.970+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12873175/comment/15585675","id":"15585675","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"body":"I think this was fixed automatically by HDFS-7185. which is present in 2.6.0\n\nAfter the rollingUpgrade to version with layoutVersion change, upgraded VERSION file will contain new version.\nWithout HDFS-7185, setting of layout version will fail as VERSION file contains new layout version.\n\nAfter HDFS-7185, while loading the rollback image, \"layoutVersion\" will be ignored from VERSION file and set same as Software's VERSION, but it will be checked strictly from image file.\n\nFollowing changes in NNStorage.java will do the this.\n{code}  void readProperties(StorageDirectory sd, StartupOption startupOption)\n      throws IOException {\n    Properties props = readPropertiesFile(sd.getVersionFile());\n    if (HdfsServerConstants.RollingUpgradeStartupOption.ROLLBACK.matches\n        (startupOption)) {\n      int lv = Integer.parseInt(getProperty(props, sd, \"layoutVersion\"));\n      if (lv > getServiceLayoutVersion()) {\n        // we should not use a newer version for rollingUpgrade rollback\n        throw new IncorrectVersionException(getServiceLayoutVersion(), lv,\n            \"storage directory \" + sd.getRoot().getAbsolutePath());\n      }\n      props.setProperty(\"layoutVersion\",\n          Integer.toString(HdfsServerConstants.NAMENODE_LAYOUT_VERSION));\n    }\n    setFieldsFromProperties(props, sd);\n  }{code}\n\n\nBut in 2.8.0 in HDFS-8432, updating the VERSION file on rolling upgrade is avoided.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-10-18T14:58:24.221+0000","updated":"2016-10-18T15:02:18.340+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12873175/comment/15586242","id":"15586242","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"If it is indeed the VERSION file issue, you can workaround it by manually editing the VERSION file to put the old layout version, after making backups, of course.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2016-10-18T18:24:29.542+0000","updated":"2016-10-18T18:24:29.542+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12873175/comment/15588098","id":"15588098","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=DineshKumarP","name":"DineshKumarP","key":"dineshkumarp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dinesh","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi [~kihwal],\n\n*With journal nodes and zookeeper instances running, changed value from -63 to -57. Rollback failed with the following exception*\n|16/10/19 13:43:19 WARN namenode.FSNamesystem: Encountered exception loading fsimage\norg.apache.hadoop.hdfs.server.common.IncorrectVersionException: Unexpected version of storage directory \\Metadata\\data\\dfs\\namenode. Reported: -57. Expecting = -63.\n        at org.apache.hadoop.hdfs.server.namenode.NNStorage.readProperties(NNStorage.java:633)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.recoverStorageDirs(FSImage.java:339)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.recoverTransitionRead(FSImage.java:215)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFSImage(FSNamesystem.java:975)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFromDisk(FSNamesystem.java:681)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.loadNamesystem(NameNode.java:584)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.initialize(NameNode.java:644)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:811)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:795)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.createNameNode(NameNode.java:1488)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.main(NameNode.java:1554)|\n\n*Changed version back to -63 and executed -rollingUpgrade rollback command. Now faced the following exception*\n|16/10/19 13:43:43 ERROR namenode.FSImage: Failed to load image from FSImageFile(file=\\Metadata\\data\\dfs\\namenode\\current\\fsimage_rollback_0000000000000004951, cpktTxId=0000000000000004951)\njava.io.IOException: Image version -57 is not equal to the software version -63\n        at org.apache.hadoop.hdfs.server.namenode.FSImageFormatProtobuf$Loader.loadInternal\n(FSImageFormatProtobuf.java:196)\n        at org.apache.hadoop.hdfs.server.namenode.FSImageFormatProtobuf$Loader.load(FSImageFormatProtobuf.java:179)\n        at org.apache.hadoop.hdfs.server.namenode.FSImageFormat$LoaderDelegator.load(FSImageFormat.java:226)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImage(FSImage.java:957)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImage(FSImage.java:941)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImageFile(FSImage.java:740)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImage(FSImage.java:676)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.recoverTransitionRead(FSImage.java:294)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFSImage(FSNamesystem.java:975)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFromDisk(FSNamesystem.java:681)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.loadNamesystem(NameNode.java:584)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.initialize(NameNode.java:644)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:811)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:795)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.createNameNode(NameNode.java:1488)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.main(NameNode.java:1554)\n16/10/19 13:43:43 WARN namenode.FSNamesystem: Encountered exception loading fsimage\njava.io.IOException: Failed to load an FSImage file!\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImage(FSImage.java:687)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.recoverTransitionRead(FSImage.java:294)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFSImage(FSNamesystem.java:975)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFromDisk(FSNamesystem.java:681)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.loadNamesystem(NameNode.java:584)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.initialize(NameNode.java:644)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:811)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:795)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.createNameNode(NameNode.java:1488)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.main(NameNode.java:1554)\n16/10/19 13:43:43 INFO mortbay.log: Stopped|","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=DineshKumarP","name":"DineshKumarP","key":"dineshkumarp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dinesh","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-10-19T08:53:59.471+0000","updated":"2016-10-19T08:53:59.471+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12873175/comment/15588854","id":"15588854","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"Were you issuing rollback with 2.7.2?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2016-10-19T14:01:41.005+0000","updated":"2016-10-19T14:05:09.478+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12873175/comment/15591592","id":"15591592","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=DineshKumarP","name":"DineshKumarP","key":"dineshkumarp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dinesh","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi [~kihwal],\n\nYes. Did by mistake. Let me change version in both name nodes and do rollback with older version 2.5.2 and get back to you.\n\nThanks,\nDinesh Kumar P","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=DineshKumarP","name":"DineshKumarP","key":"dineshkumarp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dinesh","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-10-20T11:43:52.595+0000","updated":"2016-10-20T11:43:52.595+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-9096/votes","votes":5,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2ka7j:"}}