{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12473464","self":"https://issues.apache.org/jira/rest/api/2/issue/12473464","key":"HDFS-1379","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2010-09-07T15:40:48.886+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 01 01:52:52 UTC 2014","customfield_12310420":"15586","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_120308195684_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-07-01T01:52:52.700+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-1379/watchers","watchCount":10,"isWatching":false},"created":"2010-09-07T14:56:17.111+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314048","id":"12314048","description":"","name":"0.20.1","archived":false,"released":true,"releaseDate":"2009-09-01"}],"issuelinks":[{"id":"12349586","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12349586","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12547551","key":"HADOOP-8198","self":"https://issues.apache.org/jira/rest/api/2/issue/12547551","fields":{"summary":"Support multiple network interfaces","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}},{"id":"12333756","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12333756","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12433989","key":"HADOOP-6210","self":"https://issues.apache.org/jira/rest/api/2/issue/12433989","fields":{"summary":"Bind Hadoop RPC outgoing to a specific nic","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}},{"id":"12333754","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12333754","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12439957","key":"HADOOP-6364","self":"https://issues.apache.org/jira/rest/api/2/issue/12439957","fields":{"summary":"add a 'hostname' or 'identity' parameter","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-07-01T01:52:52.789+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312928","id":"12312928","name":"hdfs-client"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"We have a setup where - because we only have a very few machines (4 x 16 core) we're looking at co-locating namenodes and datanodes. We also have front-end and back-end networks. Set-up is something like:\n\n* machine1\n** front-end 10.18.80.80\n** back-end 192.168.24.40\n* machine2\n** front-end 10.18.80.82\n** back-end 192.168.24.41\n* machine3\n** front-end 10.18.80.84\n** back-end 192.168.24.42\n* machine4\n** front-end 10.18.80.86\n** back-end 192.168.24.43\n\nOn each, the property *slave.host.name* is configured with the 192. address, (the *.dns.interface settings don't actually seem to help, but that's a separate problem), and the *dfs.datanode.address* is bound to the 192.168.24.x address on :50010, similarly the *dfs.datanode.ipc.address* is bound there.\n\nIn order to get efficient use of our machines, we bring up a namenode on one of them (this then rsyncs the latest namenode fsimage etc) by bringing up a VIP on each side (we use the 10.18.80.x side for monitoring, rather than actual hadoop comms), and binding the namenode to that - on the inside this is 192.168.24.19.\n\nThe namenode now knows about 4 datanodes - 192.168.24.40/1/2/3. These datanodes know how they're bound. However, when the datanode is telling an external hdfs client where to store the blocks, it gives out 192.168.24.19:50010 as one of the addresses (despite the datanode not being bound there) - because that's where the datanode->namenode RPC comes from.\n\nThis is wrong because if you've bound the datanode explicitly (using *dfs.datanode.address*) then that's should be the only address the namenode can give out (it's reasonable, given your comms model not to support NAT between clients and data slaves). If you bind it to * then your normal rules for slave.host.name, dfs.datanode.dns.interface etc should take precedence.\n\nThis may already be fixed in later releases than 0.20.1 - but if it isn't it should probably be - you explicitly allow binding of the datanode addresses - it's unreasonable to expect that comms to the datanode will always come from those addresses - especially in multi-homed environments (and separating traffic out by network - especially when dealing with large volumes of data) is useful.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"113500","customfield_12312823":null,"summary":"Multihoming brokenness in HDFS","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mbm","name":"mbm","key":"mbm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew Byng-Maddick","active":true,"timeZone":"Europe/London"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mbm","name":"mbm","key":"mbm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew Byng-Maddick","active":true,"timeZone":"Europe/London"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Multi-homed namenode and datanodes. hadoop-0.20.1 (cloudera distribution on linux)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473464/comment/12906841","id":"12906841","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"body":"Some of the issues here are also covered in HADOOP-6364 .\n\nBut yes, multi-homing is a known brokenness.\n\nIt is probably worth pointing out that \n\na) the bang-for-buck by having a separate network for IPC/RPC communications isn't very good, so pretty much no one does it\n\nb) monitoring a private interface instead of the public one leaves you exposed to failures on the network side ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"created":"2010-09-07T15:40:48.886+0000","updated":"2010-09-07T15:40:48.886+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473464/comment/12906880","id":"12906880","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mbm","name":"mbm","key":"mbm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew Byng-Maddick","active":true,"timeZone":"Europe/London"},"body":"Hi Allen,\n\nThanks for your comments - I looked for other things first, and I didn't notice HADOOP-6364 - thanks for linking it!\n\nI'm aware that multi-homing is known not to work, but it seems to me that being able to define the bind address and then having the namenode give out something that it has constructed using incomplete information to hdfs clients is more than just a simple \"multi-homing is broken\" bug.\n\nIn response to the points:\na) I'm well aware of that - segregating the traffic with our other network is important as a lot of people have access to that network, but keeping a cluster network which is separate is sensible - it means it can be provisioned differently with potentially different QoS at switches etc. - We're not just doing IPC/RPC on that - but the entire datanode<->datanode and client<->datanode comms too - as our clients run within that network - ideally I'd have the jobtracker bind to INADDR_ANY (IN6ADDR_ANY) so you could submit a job from anywhere, but all the datanode comms work - but that isn't possible because of the dual use of mapred.job.tracker.\nb) correct, though what's also exposed on the (more) public side is bits of JMX, rather than just trivial availability monitoring, and that does help to point out what hadoop is seeing. At some stage I'd like to have availability monitoring on both sides, but that's not possible right now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mbm","name":"mbm","key":"mbm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew Byng-Maddick","active":true,"timeZone":"Europe/London"},"created":"2010-09-07T17:09:53.176+0000","updated":"2010-09-07T17:09:53.176+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473464/comment/14048419","id":"14048419","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"I believe this is not a problem anymore after other JIRAs such as HDFS-4963.  Please feel free to reopen this if it is not the case.  Resolving ...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-01T01:52:52.764+0000","updated":"2014-07-01T01:52:52.764+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-1379/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0js7j:"}}