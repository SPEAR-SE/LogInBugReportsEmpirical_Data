{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12915734","self":"https://issues.apache.org/jira/rest/api/2/issue/12915734","key":"HDFS-9455","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-12-24T06:00:37.110+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jan 18 01:56:50 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-9455/watchers","watchCount":11,"isWatching":false},"created":"2015-11-24T09:14:04.252+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisuke.kobayashi","name":"daisuke.kobayashi","key":"daisuke.kobayashi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daisuke Kobayashi","active":true,"timeZone":"Asia/Tokyo"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-01-18T01:56:50.347+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12324603","id":"12324603","name":"distcp"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313400","id":"12313400","name":"security"}],"timeoriginalestimate":null,"description":"When Filesystem Operation failure happens during discp, \nWrong exception : Invalid Argument thrown along with distcp command Usage.\n\n{color:red} \nhadoop distcp webhdfs://IP:25003/test/testfile webhdfs://IP:25003/myp\nInvalid arguments: Unexpected end of file from server\nusage: distcp OPTIONS [source_path...] <target_path>\n              OPTIONS\n -append                       Reuse existing data in target files and\n                               append new data to them if possible\n -async                        Should distcp execution be blocking\n -atomic                       Commit all changes or none\n -bandwidth <arg>              Specify bandwidth per map in MB\n -delete                       Delete from target, files missing in source\n -diff <arg>                   Use snapshot diff report to identify the\n                               difference between source and target\n -f <arg>                      List of files that need to be copied\n -filelimit <arg>              (Deprecated!) Limit number of files copied\n                               to <= n\n -i                            Ignore failures during copy\n.....\n{color} \n\nInstead Proper Exception has to be thrown.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12781176","id":"12781176","filename":"HDFS-9455.01.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisuke.kobayashi","name":"daisuke.kobayashi","key":"daisuke.kobayashi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daisuke Kobayashi","active":true,"timeZone":"Asia/Tokyo"},"created":"2016-01-08T09:52:09.367+0000","size":1035,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12781176/HDFS-9455.01.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"In distcp, Invalid Argument Error thrown in case of filesystem operation failure","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=archanat","name":"archanat","key":"archanat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Archana T","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=archanat","name":"archanat","key":"archanat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Archana T","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915734/comment/15070613","id":"15070613","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisuke.kobayashi","name":"daisuke.kobayashi","key":"daisuke.kobayashi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daisuke Kobayashi","active":true,"timeZone":"Asia/Tokyo"},"body":"[~archanat], what do you actually mean by 'Filesystem Operation failure'? I'd like to know what sort of issue leads the improper message.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisuke.kobayashi","name":"daisuke.kobayashi","key":"daisuke.kobayashi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daisuke Kobayashi","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-12-24T06:00:37.110+0000","updated":"2015-12-24T06:00:37.110+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915734/comment/15070801","id":"15070801","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=surendrasingh","name":"surendrasingh","key":"surendrasingh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=surendrasingh&avatarId=30759","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=surendrasingh&avatarId=30759","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=surendrasingh&avatarId=30759","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=surendrasingh&avatarId=30759"},"displayName":"Surendra Singh Lilhore","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~archanat] for reporting this issue..\n\n[~daisuke.kobayashi] this improper message is coming because of code exist in DistCp.run() \n{code}\n    try {\n      inputOptions = (OptionsParser.parse(argv));\n      setTargetPathExists();\n      LOG.info(\"Input Options: \" + inputOptions);\n    } catch (Throwable e) {\n      LOG.error(\"Invalid arguments: \", e);\n      System.err.println(\"Invalid arguments: \" + e.getMessage());\n      OptionsParser.usage();      \n      return DistCpConstants.INVALID_ARGUMENT;\n    }\n{code}\n\nHere distcp will parse the argument and \"setTargetPathExists()\" will check the existence of target path. If distcp is not able to connect with target filesystem then it will throw the exception , but that exception will log with wrong message.\n\n{{LOG.error(\"Invalid arguments: \", e);}}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=surendrasingh","name":"surendrasingh","key":"surendrasingh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=surendrasingh&avatarId=30759","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=surendrasingh&avatarId=30759","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=surendrasingh&avatarId=30759","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=surendrasingh&avatarId=30759"},"displayName":"Surendra Singh Lilhore","active":true,"timeZone":"Etc/UTC"},"created":"2015-12-24T09:23:15.000+0000","updated":"2015-12-24T09:23:15.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915734/comment/15082528","id":"15082528","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisuke.kobayashi","name":"daisuke.kobayashi","key":"daisuke.kobayashi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daisuke Kobayashi","active":true,"timeZone":"Asia/Tokyo"},"body":"Thanks. Hmm, with which scenario does it occur? I've just tried to reproduce the issue with the scenarios, but couldn't...\n{noformat}\n- target NameNode to be down\n- target NameNode to be safemode\n- wrong hostname to target NameNode\n- wrong path to target \n{noformat}\n\nIn which version of Hadoop are you using, [~archanat]? Mine is as follows:\n\n{noformat}\n# hadoop version\nHadoop 2.6.0-cdh5.5.1\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisuke.kobayashi","name":"daisuke.kobayashi","key":"daisuke.kobayashi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daisuke Kobayashi","active":true,"timeZone":"Asia/Tokyo"},"created":"2016-01-05T06:55:39.876+0000","updated":"2016-01-05T06:55:39.876+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915734/comment/15082670","id":"15082670","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=archanat","name":"archanat","key":"archanat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Archana T","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi [~daisuke.kobayashi]\nI got the issue in OpenSource 2.7.1 \n\nScenario --\nIn a secured cluster with ssl enabled, I was using \"webhdfs\" instead of \"swebhdfs\" in below cmd --\nhadoop distcp webhdfs://IP:25003/test/testfile webhdfs://IP:25003/myp\n\nReference-\nHDFS-9483","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=archanat","name":"archanat","key":"archanat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Archana T","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-01-05T09:04:06.940+0000","updated":"2016-01-05T09:04:06.940+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915734/comment/15082774","id":"15082774","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisuke.kobayashi","name":"daisuke.kobayashi","key":"daisuke.kobayashi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daisuke Kobayashi","active":true,"timeZone":"Asia/Tokyo"},"body":"I see, [~archanat]. When using normal webhdfs protocol over SSL/TLS enabled cluster, it should catch {{SocketException}} and print a stack trace. Here's a result of my quick test, for instance:\n\n{noformat}\n[daisuke@test1 ~]$ hadoop distcp /user/daisuke/hosts webhdfs://target:50470/\n16/01/05 19:11:34 WARN security.UserGroupInformation: PriviledgedActionException as:daisuke@HADOOP (auth:KERBEROS) cause:java.net.SocketException: Unexpected end of file from server\n16/01/05 19:11:34 WARN security.UserGroupInformation: PriviledgedActionException as:daisuke@HADOOP (auth:KERBEROS) cause:java.net.SocketException: Unexpected end of file from server\n16/01/05 19:11:34 ERROR tools.DistCp: Log.error:\njava.net.SocketException: Unexpected end of file from server\n\tat sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:772)\n\tat sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:633)\n\tat sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:769)\n\tat sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:633)\n\tat sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1323)\n\tat java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:468)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.validateResponse(WebHdfsFileSystem.java:336)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.access$200(WebHdfsFileSystem.java:91)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.runWithRetry(WebHdfsFileSystem.java:614)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.access$100(WebHdfsFileSystem.java:464)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner$1.run(WebHdfsFileSystem.java:493)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1671)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.run(WebHdfsFileSystem.java:489)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getDelegationToken(WebHdfsFileSystem.java:1307)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getDelegationToken(WebHdfsFileSystem.java:239)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getAuthParameters(WebHdfsFileSystem.java:429)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.toUrl(WebHdfsFileSystem.java:450)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractFsPathRunner.getUrl(WebHdfsFileSystem.java:697)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.runWithRetry(WebHdfsFileSystem.java:609)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.access$100(WebHdfsFileSystem.java:464)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner$1.run(WebHdfsFileSystem.java:493)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1671)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.run(WebHdfsFileSystem.java:489)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getHdfsFileStatus(WebHdfsFileSystem.java:844)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getFileStatus(WebHdfsFileSystem.java:859)\n\tat org.apache.hadoop.fs.FileSystem.exists(FileSystem.java:1409)\n\tat org.apache.hadoop.tools.DistCp.setTargetPathExists(DistCp.java:206)\n\tat org.apache.hadoop.tools.DistCp.run(DistCp.java:113)\n\tat org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:70)\n\tat org.apache.hadoop.tools.DistCp.main(DistCp.java:435)\nLOG.error: Unexpected end of file from server\n{noformat}\n\nDoes this make sense?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisuke.kobayashi","name":"daisuke.kobayashi","key":"daisuke.kobayashi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daisuke Kobayashi","active":true,"timeZone":"Asia/Tokyo"},"created":"2016-01-05T10:17:16.825+0000","updated":"2016-01-05T10:17:16.825+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915734/comment/15082781","id":"15082781","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisuke.kobayashi","name":"daisuke.kobayashi","key":"daisuke.kobayashi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daisuke Kobayashi","active":true,"timeZone":"Asia/Tokyo"},"body":"[~yzhangal], can you double check this proposal?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisuke.kobayashi","name":"daisuke.kobayashi","key":"daisuke.kobayashi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daisuke Kobayashi","active":true,"timeZone":"Asia/Tokyo"},"created":"2016-01-05T10:18:57.199+0000","updated":"2016-01-05T10:18:57.199+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915734/comment/15083400","id":"15083400","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Guys,\n\nThanks for reporting the issue and the work here. [~daisuke.kobayashi], Per Archana's description at\nhttps://issues.apache.org/jira/browse/HDFS-9455?focusedCommentId=15082670&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15082670\nThe command line is \"hadoop distcp webhdfs://IP:25003/test/testfile webhdfs://IP:25003/myp\" in a secured cluster with ssl enabled (both src and tgt are the same cluster).\nWould you please try it out in your env?\n\nThe \"Invalid argument\" msg is not very clear, when ssl is enabled, if we are using webhdfs instead of swebhdfs, possibly we can improve the message to indicate that.\n\nThanks.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-05T17:24:11.517+0000","updated":"2016-01-05T17:24:11.517+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915734/comment/15088906","id":"15088906","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisuke.kobayashi","name":"daisuke.kobayashi","key":"daisuke.kobayashi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daisuke Kobayashi","active":true,"timeZone":"Asia/Tokyo"},"body":"Thanks Yongjun for correcting me! Indeed, distcp runs within a single cluster per the description and I could reproduce the issue as follows. [~archanat], is this what you're also hitting, correct?\n\n{noformat}\n[daisuke@test1 jars]$ hadoop distcp webhdfs://test1:50470/user/daisuke/hosts webhdfs://test1:50470/user/daisuke/dir/\n16/01/08 17:40:22 WARN security.UserGroupInformation: PriviledgedActionException as:daisuke@HADOOP (auth:KERBEROS) cause:java.net.SocketException: Unexpected end of file from server\n16/01/08 17:40:22 WARN security.UserGroupInformation: PriviledgedActionException as:daisuke@HADOOP (auth:KERBEROS) cause:java.net.SocketException: Unexpected end of file from server\n16/01/08 17:40:22 ERROR tools.DistCp: Invalid arguments:\njava.net.SocketException: Unexpected end of file from server\n\tat sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:772)\n\tat sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:633)\n\tat sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:769)\n\tat sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:633)\n\tat sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1323)\n\tat java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:468)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.validateResponse(WebHdfsFileSystem.java:336)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.access$200(WebHdfsFileSystem.java:91)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.runWithRetry(WebHdfsFileSystem.java:614)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.access$100(WebHdfsFileSystem.java:464)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner$1.run(WebHdfsFileSystem.java:493)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1671)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.run(WebHdfsFileSystem.java:489)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getDelegationToken(WebHdfsFileSystem.java:1307)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getDelegationToken(WebHdfsFileSystem.java:239)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getAuthParameters(WebHdfsFileSystem.java:429)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.toUrl(WebHdfsFileSystem.java:450)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractFsPathRunner.getUrl(WebHdfsFileSystem.java:697)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.runWithRetry(WebHdfsFileSystem.java:609)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.access$100(WebHdfsFileSystem.java:464)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner$1.run(WebHdfsFileSystem.java:493)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1671)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.run(WebHdfsFileSystem.java:489)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getHdfsFileStatus(WebHdfsFileSystem.java:844)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getFileStatus(WebHdfsFileSystem.java:859)\n\tat org.apache.hadoop.fs.FileSystem.exists(FileSystem.java:1409)\n\tat org.apache.hadoop.tools.DistCp.setTargetPathExists(DistCp.java:200)\n\tat org.apache.hadoop.tools.DistCp.run(DistCp.java:112)\n\tat org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:70)\n\tat org.apache.hadoop.tools.DistCp.main(DistCp.java:429)\nInvalid arguments: Unexpected end of file from server\nusage: distcp OPTIONS [source_path...] <target_path>\n              OPTIONS\n -append                       Reuse existing data in target files and\n                               append new data to them if possible\n<...snip...>\n{noformat}\n\nSo my proposal is catching SocketException and print more meaningful message like {{An error occurs while getting target path}}\n\nIf this is agreeable, do you allow me to create a patch to fix this, [~archanat]?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisuke.kobayashi","name":"daisuke.kobayashi","key":"daisuke.kobayashi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daisuke Kobayashi","active":true,"timeZone":"Asia/Tokyo"},"created":"2016-01-08T08:51:42.832+0000","updated":"2016-01-08T08:51:42.832+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915734/comment/15088929","id":"15088929","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=archanat","name":"archanat","key":"archanat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Archana T","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi [~daisuke.kobayashi]\nI agee with the above proposal.\n\nAssigning this Jira to you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=archanat","name":"archanat","key":"archanat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Archana T","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-01-08T09:06:20.172+0000","updated":"2016-01-08T09:06:20.172+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915734/comment/15088982","id":"15088982","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisuke.kobayashi","name":"daisuke.kobayashi","key":"daisuke.kobayashi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daisuke Kobayashi","active":true,"timeZone":"Asia/Tokyo"},"body":"Thanks! Uploaded a patch as HDFS-9455.01.patch. This catches SocketException explicitly and log the following message when it fails to determine the target path. I've confirmed this does work with upstream too.\n\n{noformat}\n[daisuke@test2 ~]$ hadoop distcp webhdfs://test2:50470/user/daisuke/hosts webhdfs://test2:50470/user/daisuke/dir\n16/01/08 18:42:09 WARN security.UserGroupInformation: PriviledgedActionException as:daisuke@HADOOP (auth:KERBEROS) cause:java.net.SocketException: Unexpected end of file from server\n16/01/08 18:42:09 WARN security.UserGroupInformation: PriviledgedActionException as:daisuke@HADOOP (auth:KERBEROS) cause:java.net.SocketException: Unexpected end of file from server\n16/01/08 18:42:09 ERROR tools.DistCp: An error occurs while getting target path:\njava.net.SocketException: Unexpected end of file from server\n\tat sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:772)\n\tat sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:633)\n\tat sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:769)\n\tat sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:633)\n\tat sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1323)\n\tat java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:468)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.validateResponse(WebHdfsFileSystem.java:336)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.access$200(WebHdfsFileSystem.java:91)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.runWithRetry(WebHdfsFileSystem.java:614)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.access$100(WebHdfsFileSystem.java:464)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner$1.run(WebHdfsFileSystem.java:493)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1671)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.run(WebHdfsFileSystem.java:489)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getDelegationToken(WebHdfsFileSystem.java:1307)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getDelegationToken(WebHdfsFileSystem.java:239)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getAuthParameters(WebHdfsFileSystem.java:429)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.toUrl(WebHdfsFileSystem.java:450)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractFsPathRunner.getUrl(WebHdfsFileSystem.java:697)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.runWithRetry(WebHdfsFileSystem.java:609)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.access$100(WebHdfsFileSystem.java:464)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner$1.run(WebHdfsFileSystem.java:493)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1671)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem$AbstractRunner.run(WebHdfsFileSystem.java:489)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getHdfsFileStatus(WebHdfsFileSystem.java:844)\n\tat org.apache.hadoop.hdfs.web.WebHdfsFileSystem.getFileStatus(WebHdfsFileSystem.java:859)\n\tat org.apache.hadoop.fs.FileSystem.exists(FileSystem.java:1409)\n\tat org.apache.hadoop.tools.DistCp.setTargetPathExists(DistCp.java:229)\n\tat org.apache.hadoop.tools.DistCp.run(DistCp.java:118)\n\tat org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:70)\n\tat org.apache.hadoop.tools.DistCp.main(DistCp.java:458)\n[daisuke@test2 ~]$\n{noformat}\n\nI am still unsure if returning {{DistCpConstants.UNKNOWN_ERROR}} is appropriate though. Can you advice me, [~yzhangal]?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisuke.kobayashi","name":"daisuke.kobayashi","key":"daisuke.kobayashi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daisuke Kobayashi","active":true,"timeZone":"Asia/Tokyo"},"created":"2016-01-08T09:52:09.371+0000","updated":"2016-01-08T09:52:09.371+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915734/comment/15602374","id":"15602374","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"* Anything raising an IOE should be interpreted as \"something went wrong over the wire\", or at least in the FS client (auth, etc). \n* the existing catching of Throwable is too broad...that can include things like OOM other things which are very serious runtimes. Very much not \"invalid argument\"\n\nI think the handlers could go more like\n\n# IOE -> rethrow\n# Exception -> say \"error\"\n# Throwable -> report as serious failure","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2016-10-24T15:46:40.842+0000","updated":"2016-10-24T15:46:40.842+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915734/comment/15825977","id":"15825977","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jakubzeman%40gmail.com","name":"jakubzeman@gmail.com","key":"jakubzeman@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jakub Zeman","active":true,"timeZone":"Etc/UTC"},"body":"Hi all,\n\nwould it be possible to increase prioriy of this issue. I have the same problem accessing HDFS using WebHDFS on secure (https enabled) cluster:\n{code}hadoop fs -ls webhdfs://bda01:50470/jakubzeman/\n17/01/17 12:24:29 WARN security.UserGroupInformation: PriviledgedActionException as:jakubzeman@TEST.REALM.COM (auth:KERBEROS) cause:java.net.SocketException: bda01:50470: Unexpected end of file from server\n17/01/17 12:24:29 WARN security.UserGroupInformation: PriviledgedActionException as:jakubzeman@TEST.REALM.COM (auth:KERBEROS) cause:java.net.SocketException: bda01:50470: Unexpected end of file from server\nls: bda01:50470: Unexpected end of file from serve{code}\n\nThis command works well on non-secure cluster.\n\nIs there any way how to bypass https?\n\nJakub","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jakubzeman%40gmail.com","name":"jakubzeman@gmail.com","key":"jakubzeman@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jakub Zeman","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-17T12:37:20.406+0000","updated":"2017-01-17T12:37:20.406+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12915734/comment/15827272","id":"15827272","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Lu+Tao","name":"Lu Tao","key":"lu tao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lu Tao","active":true,"timeZone":"Asia/Shanghai"},"body":"@Jakub Zeman, you have to use swebhdfs schema, eg. hadoop fs -ls swebhdfs://bda01:50470/jakubzeman/, that may works for you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Lu+Tao","name":"Lu Tao","key":"lu tao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lu Tao","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-01-18T01:56:50.347+0000","updated":"2017-01-18T01:56:50.347+0000"}],"maxResults":13,"total":13,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-9455/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2ouu7:"}}