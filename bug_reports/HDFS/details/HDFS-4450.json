{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12629660","self":"https://issues.apache.org/jira/rest/api/2/issue/12629660","key":"HDFS-4450","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-01-29T23:28:32.877+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Aug 13 13:12:03 UTC 2013","customfield_12310420":"310156","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-4450/watchers","watchCount":8,"isWatching":false},"created":"2013-01-29T09:21:36.695+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":604800,"aggregatetimeoriginalestimate":604800,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12322472","id":"12322472","description":"2.0.2-alpha release","name":"2.0.2-alpha","archived":false,"released":true,"releaseDate":"2012-10-09"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-08-13T13:12:03.834+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":604800,"description":"Duplicate data node on the name node after formatting data node。\nWhen we registered data node，use nodeReg.getXferPort() to find DatanodeDescriptor.\n{code}\n DatanodeDescriptor nodeN = host2DatanodeMap.getDatanodeByXferAddr(\n        nodeReg.getIpAddr(), nodeReg.getXferPort());\n{code}\n\nbut add data node use node.getIpAddr().\n{code}\n    /** add node to the map \n   * return true if the node is added; false otherwise.\n   */\n  boolean add(DatanodeDescriptor node) {\n    hostmapLock.writeLock().lock();\n    try {\n      if (node==null || contains(node)) {\n        return false;\n      }\n      \n      String ipAddr = node.getIpAddr();\n      DatanodeDescriptor[] nodes = map.get(ipAddr);\n      DatanodeDescriptor[] newNodes;\n      if (nodes==null) {\n        newNodes = new DatanodeDescriptor[1];\n        newNodes[0]=node;\n      } else { // rare case: more than one datanode on the host\n        newNodes = new DatanodeDescriptor[nodes.length+1];\n        System.arraycopy(nodes, 0, newNodes, 0, nodes.length);\n        newNodes[nodes.length] = node;\n      }\n      map.put(ipAddr, newNodes);\n      return true;\n    } finally {\n      hostmapLock.writeLock().unlock();\n    }\n  }\n{code}","customfield_10010":null,"timetracking":{"originalEstimate":"168h","remainingEstimate":"168h","originalEstimateSeconds":604800,"remainingEstimateSeconds":604800},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12322472","id":"12322472","description":"2.0.2-alpha release","name":"2.0.2-alpha","archived":false,"released":true,"releaseDate":"2012-10-09"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12567495","id":"12567495","filename":"exception.bmp","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-02-01T02:28:19.801+0000","size":3148854,"mimeType":"image/bmp","content":"https://issues.apache.org/jira/secure/attachment/12567495/exception.bmp"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12567494","id":"12567494","filename":"normal.bmp","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-02-01T02:28:19.797+0000","size":3148854,"mimeType":"image/bmp","content":"https://issues.apache.org/jira/secure/attachment/12567494/normal.bmp"}],"aggregatetimeestimate":604800,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"310501","customfield_12312823":null,"summary":"Duplicate data node on the name node after formatting data node","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":604800,"percent":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":604800,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629660/comment/13565963","id":"13565963","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"This is working as expected. The two instances of datanodes are different. On restart of the namenode the previous instance of datanode will no longer be tracked/show on web UI by the namenode.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-29T23:28:32.877+0000","updated":"2013-01-29T23:28:32.877+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629660/comment/13566042","id":"13566042","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"body":"I view the other versions of the code will not have this problem, In addition practical use impossible to restart namenode when maintenance datanode。","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-30T01:21:55.797+0000","updated":"2013-01-30T01:21:55.797+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629660/comment/13566050","id":"13566050","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"body":"Now the code, the removal of the a redundant node's code is there, but it will never be called to.\n{code}\n    DatanodeDescriptor nodeN = getDatanodeByHost(nodeReg.getXferAddr());\n      //nodeN is always null.\n    if (nodeN != null && nodeN != nodeS) {\n      NameNode.LOG.info(\"BLOCK* NameSystem.registerDatanode: \"\n                        + \"node from name: \" + nodeN);\n      // nodeN previously served a different data storage, \n      // which is not served by anybody anymore.\n      removeDatanode(nodeN);\n      // physically remove node from datanodeMap\n      wipeDatanode(nodeN);\n      nodeN = null;\n    }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-30T01:34:31.457+0000","updated":"2013-01-30T01:34:31.457+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629660/comment/13566164","id":"13566164","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. I view the other versions of the code will not have this problem, In addition practical use impossible to restart namenode when maintenance datanode\n\nYou are right about the behavior. I had forgotten the previous discussion related to this from the comment I had posted:\nhttps://issues.apache.org/jira/browse/HDFS-3224?focusedCommentId=13472817&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13472817\n\nLooking at the description of this jira, the Host2NodesMap always has {{key = ipAddress}} and {{value = DatanodeDescriptor}}. So add() method is doing the correct thing. If you look at {{host2DatanodeMap.getDatanodeByXferAddr()}}, it does look up the host by the ipAddress. It then compares the xferAddress to that of the transfer address of the DatanodeDescriptor stored as value.\n\nCan you post the logs for this issue?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-30T04:58:18.368+0000","updated":"2013-01-30T04:58:18.368+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629660/comment/13566332","id":"13566332","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"body":"Looks like this issue HDFS-3224 is the same problem.Patch HDFS-3224.PATH still does not solve the Host2NodesMap.getDatanodeByHost (String ipAddr) and Host2NodesMap.add() inconsistent.This seems to be a hidden danger.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-30T09:49:07.675+0000","updated":"2013-01-30T09:49:07.675+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629660/comment/13566525","id":"13566525","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. PATH still does not solve the Host2NodesMap.getDatanodeByHost (String ipAddr) and Host2NodesMap.add() inconsistent.This seems to be a hidden danger.\nI do not quite follow. Where getDatanodeByHost() is used, it might be okay for the purpose it is used.\n\nIt would be good if you can you respond back to my previous comments? For convenience here they are:\n\nThe description of this jira might not be pointing to an issue. Methods add() and getDatanodeByXferAddr() are doing the correct thing. See for details my above comment.\n\nWhat is the branch corresponding to the comment https://issues.apache.org/jira/browse/HDFS-4450?focusedCommentId=13566050&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13566050\n\nAre you seeing duplicate datanode issue? If so, please post the logs. Per HDFS-3224, as long as the ipaddr + xfer port remains the same, even if the storage ID changes, duplicate datanode entry should not occur.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-30T15:05:06.953+0000","updated":"2013-01-30T15:06:15.492+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629660/comment/13568403","id":"13568403","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"body":"{quote}\nAre you seeing duplicate datanode issue? If so, please post the logs. Per HDFS-3224, as long as the ipaddr + xfer port remains the same, even if the storage ID changes, duplicate datanode entry should not occur.\n{quote}\n\n1.I deploy a test cluster，have 2 namenodes(active/standby), 3 datanodes.\n  Under normal circumstances datanodes such as normal.bmp\n\n2.Fomart datanode dn0 and restart it. hdfs web UI such as exception.bmp.  \n\n3.Namenode not found opteration for remove old datanode. \n2013-02-01 10:11:10,522 INFO org.apache.hadoop.hdfs.StateChange: BLOCK* NameSystem.registerDatanode: node registration from DatanodeRegistration(10.28.176.234, storageID=DS-685519412-10.28.176.234-50010-1359684666375, infoPort=50075, ipcPort=50020, storageInfo=lv=-40;cid=CID-fe3b5079-a34a-4912-b8a8-50443d038749;nsid=1321646662;c=0) storage DS-685519412-10.28.176.234-50010-1359684666375\n2013-02-01 10:11:10,555 INFO org.apache.hadoop.hdfs.server.blockmanagement.BlockManager: BLOCK* processReport: Received first block report from 10.28.176.234:50010 after becoming active. Its block contents are no longer considered stale.\n2013-02-01 10:11:10,555 INFO org.apache.hadoop.hdfs.StateChange: BLOCK* processReport: from DatanodeRegistration(10.28.176.234, storageID=DS-685519412-10.28.176.234-50010-1359684666375, infoPort=50075, ipcPort=50020, storageInfo=lv=-40;cid=CID-fe3b5079-a34a-4912-b8a8-50443d038749;nsid=1321646662;c=0), blocks: 0, processing time: 0 msecs\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-02-01T02:39:02.225+0000","updated":"2013-02-01T02:39:02.225+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629660/comment/13568411","id":"13568411","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"Thank you for more details. Can you post the lines from the logs that corresponds to datanode dn0 registration corresponding to before format and after format?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-01T02:46:57.660+0000","updated":"2013-02-01T02:46:57.660+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629660/comment/13568417","id":"13568417","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"body":"{quote}\nThank you for more details. Can you post the lines from the logs that corresponds to datanode dn0 registration corresponding to before format and after format?\n{quote}\n\n1.shutdown dataonode dn0\n2013-02-01 10:56:49,667 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: SHUTDOWN_MSG:\n/************************************************************\nSHUTDOWN_MSG: Shutting down DataNode at dn0/10.28.176.234\n************************************************************/\n\n2.remove data files of datanode.\n\n3.restart datganode\n\n2013-02-01 10:59:46,123 INFO org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsDatasetImpl: Added volume - /home/data/geminifs_datanode/current\n2013-02-01 10:59:46,131 INFO org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsDatasetImpl: Registered FSDatasetState MBean\n2013-02-01 10:59:46,135 INFO org.apache.hadoop.hdfs.server.datanode.DirectoryScanner: Periodic Directory Tree Verification scan starting at 1359687909135 with interval 21600000\n2013-02-01 10:59:46,137 INFO org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsDatasetImpl: Adding block pool BP-1769818311-192.168.0.2-1359357823687\n2013-02-01 10:59:46,144 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Block pool BP-1769818311-192.168.0.2-1359357823687 (storage id DS-685519412-10.28.176.234-50010-1359684666375) service to nnmaster/192.168.0.1:9000 beginning handshake with NN\n2013-02-01 10:59:46,151 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Block pool Block pool BP-1769818311-192.168.0.2-1359357823687 (storage id DS-685519412-10.28.176.234-50010-1359684666375) service to nnmaster/192.168.0.1:9000 successfully registered with NN\n2013-02-01 10:59:46,151 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: For namenode nnmaster/192.168.0.1:9000 using DELETEREPORT_INTERVAL of 300000 msec  BLOCKREPORT_INTERVAL of 21600000msec Initial delay: 0msec; heartBeatInterval=3000\n2013-02-01 10:59:46,176 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Namenode Block pool BP-1769818311-192.168.0.2-1359357823687 (storage id DS-685519412-10.28.176.234-50010-1359684666375) service to nnmaster/192.168.0.1:9000 trying to claim ACTIVE state with txid=3142\n2013-02-01 10:59:46,176 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Acknowledging ACTIVE Namenode Block pool BP-1769818311-192.168.0.2-1359357823687 (storage id DS-685519412-10.28.176.234-50010-1359684666375) service to nnmaster/192.168.0.1:9000","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-02-01T03:04:57.014+0000","updated":"2013-02-01T03:04:57.014+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629660/comment/13568924","id":"13568924","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Can you post the lines from the logs that corresponds to datanode dn0 registration corresponding to before format and after format?\n\nI should have been more clear. What I asked for is, from the namenode logs, please get the two registration requests from dn0, one before you shut it down and one after you restart. The log lines should look like:\n\n{noformat}\n2013-02-01 10:11:10,522 INFO org.apache.hadoop.hdfs.StateChange: BLOCK* NameSystem.registerDatanode: node registration from DatanodeRegistration(10.28.176.234, storageID=DS-685519412-10.28.176.234-50010-1359684666375, infoPort=50075, ipcPort=50020, storageInfo=lv=-40;cid=CID-fe3b5079-a34a-4912-b8a8-50443d038749;nsid=1321646662;c=0) storage DS-685519412-10.28.176.234-50010-1359684666375\n{noformat}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-01T18:09:24.748+0000","updated":"2013-02-01T18:09:24.748+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629660/comment/13568973","id":"13568973","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"Also please provide from your configuration, what you have set to the parameter \"dfs.datanode.address\" to?s","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-01T18:59:41.625+0000","updated":"2013-02-01T18:59:41.625+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629660/comment/13578041","id":"13578041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"WenJin, any updates on this. Can you provide the information I asked for?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-13T23:45:39.687+0000","updated":"2013-02-13T23:45:39.687+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629660/comment/13580501","id":"13580501","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"body":"{quote}\nAlso please provide from your configuration, what you have set to the parameter \"dfs.datanode.address\" to?s\n{quote}\n\nI do not have to configure it.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mawenjin","name":"mawenjin","key":"mawenjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"WenJin Ma","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-02-18T09:02:17.759+0000","updated":"2013-02-18T09:02:17.759+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629660/comment/13738173","id":"13738173","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"body":"I have verified as mentioned \n1. HA cluster with 3 Datanodes\n2. Remove the data directories of one datanode and restart datanode.\n3. After restart, NameNode was displaying only one datanode for that host.\n\nI didn't find any duplicate datanodes.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-08-13T13:12:03.834+0000","updated":"2013-08-13T13:12:03.834+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-4450/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1hizj:"}}