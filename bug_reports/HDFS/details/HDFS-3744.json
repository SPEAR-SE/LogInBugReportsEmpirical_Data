{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12600782","self":"https://issues.apache.org/jira/rest/api/2/issue/12600782","key":"HDFS-3744","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2012-07-31T21:42:05.816+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 16 08:01:54 UTC 2014","customfield_12310420":"256839","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_27125817573_*|*_1_*:*_1_*:*_34658911572_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-07-16T08:01:54.879+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-3744/watchers","watchCount":11,"isWatching":false},"created":"2012-07-31T05:36:25.854+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320353","id":"12320353","description":"hadoop-2.0.0-alpha release","name":"2.0.0-alpha","archived":false,"released":true,"releaseDate":"2012-05-23"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12322465","id":"12322465","description":"2.0.1-alpha release","name":"2.0.1-alpha","archived":false,"released":true,"releaseDate":"2012-07-25"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324031","id":"12324031","description":"2.1.0-beta release","name":"2.1.0-beta","archived":false,"released":true,"releaseDate":"2013-08-22"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335732","id":"12335732","description":"3.0.0-alpha1 release","name":"3.0.0-alpha1","archived":false,"released":true,"releaseDate":"2016-09-03"}],"issuelinks":[{"id":"12391570","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12391570","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"inwardIssue":{"id":"12720290","key":"HDFS-6507","self":"https://issues.apache.org/jira/rest/api/2/issue/12720290","fields":{"summary":"Improve DFSAdmin to support HA cluster better","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-05-12T18:16:27.634+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12316609","id":"12316609","name":"ha","description":"High Availability"}],"timeoriginalestimate":null,"description":"Scenario:\n=========\n\nStart ANN and SNN with three DN's\n\nExclude DN1 from cluster by using decommission feature \n\n(./hdfs dfsadmin -fs hdfs://ANNIP:8020 -refreshNodes)\n\nAfter decommission successful,do switch such that SNN will become Active.\n\nHere exclude node(DN1) is included in cluster.Able to write files to excluded node since it's not excluded.\n\nChecked SNN(Which Active before switch) UI decommissioned=1 and ANN UI \ndecommissioned=0\n\nOne more Observation:\n====================\n\nAll dfsadmin commands will create proxy only on nn1 irrespective of Active or standby.I think this also we need to re-look once..\n\n\nI am not getting , why we are not given HA for dfsadmin commands..?\n\nPlease correct me,,If I am wrong.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12601581","id":"12601581","filename":"HDFS-3744.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-09-05T09:00:38.324+0000","size":4809,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12601581/HDFS-3744.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"108614","customfield_12312823":null,"summary":"Decommissioned nodes are included in cluster after switch which is not expected","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12600782/comment/13426154","id":"13426154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=atm","name":"atm","key":"atm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=atm&avatarId=14136","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=atm&avatarId=14136","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=atm&avatarId=14136","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=atm&avatarId=14136"},"displayName":"Aaron T. Myers","active":true,"timeZone":"America/Los_Angeles"},"body":"Brahma, in the above description, I assume that you excluded DN1 by adding it to the excludes file? Did you add it to that file on both of the NN machines?\n\nThe issue is that some dsfadmin commands need to perform client-side failover and talk to the appropriate NN, while others should actually be run against both NNs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=atm","name":"atm","key":"atm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=atm&avatarId=14136","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=atm&avatarId=14136","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=atm&avatarId=14136","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=atm&avatarId=14136"},"displayName":"Aaron T. Myers","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-07-31T21:42:05.816+0000","updated":"2012-07-31T21:42:05.816+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12600782/comment/13426287","id":"13426287","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"HI Aaron T.Myers,\nthanks for taking look.\n{quote}\nBrahma, in the above description, I assume that you excluded DN1 by adding it to the excludes file? Did you add it to that file on both of the NN machines?\n{quote}\n\nYes,I excluded DN1 by adding it to the exclude file and I added in both of the NN machines.\n\n{quote}\nThe issue is that some dsfadmin commands need to perform client-side failover and talk to the appropriate NN, while others should actually be run against both NNs.\n{quote}\n\nyes,issue with dfsadmin commands which need to perform client-side failover..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-08-01T02:32:09.847+0000","updated":"2012-08-01T02:32:09.847+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12600782/comment/13426336","id":"13426336","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"{quote}\nThe issue is that some dsfadmin commands need to perform client-side failover and talk to the appropriate NN, while others should actually be run against both NNs.\n{quote}\n\nBut if we do client-side failover also,I think BNN will not come know.\nWe need to execute command on both NN's.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-08-01T05:23:45.844+0000","updated":"2012-08-01T05:23:45.844+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12600782/comment/13426337","id":"13426337","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"body":"From the issue What I understud is,\n\nWe have to execute this particular command on both the nodes. \nOtherwise, even though we make it failover work here, still SNN will not know about the excluded nodes as it did not get any refresh nodes command.\n\nDo we need to handle from DFSAdmin separate for this kind of commands separately?\nex: we can iterate all the nns which are available in list and send the refreshnodes commands.\n\nother option might be like we have to perform refresh nodes on switch.\nWe have to think about the impacts on that.\n\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-08-01T05:24:19.424+0000","updated":"2012-08-01T05:24:19.424+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12600782/comment/13426339","id":"13426339","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"body":"{quote}other option might be like we have to perform refresh nodes on switch.{quote}\none problem here is, if we just configure excludes and not executed refreshNodes command yet and just switch happend then this may perform refereshNodes simply. So, This may not be the preferable way to go.\n\nWe can think about the other option in the above comment.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-08-01T05:31:49.555+0000","updated":"2012-08-01T05:31:49.555+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12600782/comment/13426775","id":"13426775","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajuvishnu","name":"rajuvishnu","key":"rajuvishnu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Raju","active":true,"timeZone":"Etc/UTC"},"body":"{quote}We have to execute this particular command on both the nodes.\nOtherwise, even though we make it failover work here, still SNN will not know about the excluded nodes as it did not get any refresh nodes command.\n{quote}\nUntil SNN gets refreshnodes command SNN will not be aware of decommission of DN. But if we send the command to SNN as well which will cause the REPLICATION triggered in the SNN as well. Even though DN will not accept any requests from SNN, but SNN will be trying to replicate the blocks which will increase the load on SNN + N/W load + DN load as well.\n\nThis is my initial opinion, Please let me know if my opinion is wrong. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajuvishnu","name":"rajuvishnu","key":"rajuvishnu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Raju","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-01T17:48:38.286+0000","updated":"2012-08-01T17:48:38.286+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12600782/comment/13427404","id":"13427404","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajuvishnu","name":"rajuvishnu","key":"rajuvishnu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Raju","active":true,"timeZone":"Etc/UTC"},"body":"I have 2 suggestions to handle the same issue\n\n1. Persist the NODE_DECOMMISSIONED by active so SNN will get node DECOMMISSIONED.\n\n2. I would like to with your first opinion with SAFEMODE check in replication(or move replication to Active service).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajuvishnu","name":"rajuvishnu","key":"rajuvishnu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Raju","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-02T15:59:23.162+0000","updated":"2012-08-02T15:59:23.162+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12600782/comment/13427431","id":"13427431","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=atm","name":"atm","key":"atm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=atm&avatarId=14136","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=atm&avatarId=14136","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=atm&avatarId=14136","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=atm&avatarId=14136"},"displayName":"Aaron T. Myers","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Persist the NODE_DECOMMISSIONED by active so SNN will get node DECOMMISSIONED.\n\nI'm hesitant to go with this suggestion. How would differences be rectified between what's persisted in the edit log and what's present in the excluded hosts file?\n\nbq. I would like to with your first opinion with SAFEMODE check in replication(or move replication to Active service).\n\nI'm afraid I don't follow this. What do safemode or replication have to do with this issue?\n\nI think my preference here is to require the admin to keep the excluded hosts files in sync across the machines (most deployments already have some way of keeping config files in sync), and then just make dfsadmin iterate over all configured NNs when the refreshNodes command is run. There may be other commands that should have similar support. For example, if an administrator runs `hdfs dfsadmin -safemode enter' and provides a logical HA URI, should only the active NN be put in SM? Or should both?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=atm","name":"atm","key":"atm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=atm&avatarId=14136","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=atm&avatarId=14136","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=atm&avatarId=14136","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=atm&avatarId=14136"},"displayName":"Aaron T. Myers","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-08-02T16:36:43.638+0000","updated":"2012-08-02T16:36:43.638+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12600782/comment/13428200","id":"13428200","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajuvishnu","name":"rajuvishnu","key":"rajuvishnu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Raju","active":true,"timeZone":"Etc/UTC"},"body":"Oh Yesterday was my bad day @work :(\n\nLet me correct my second opinion first \n\n{quote}2. I would like to with your first opinion with STANDBY check in replication(or move replication to Active service).\n{quote}\n\nHere first opinion I meant here is Uma Maheshwara Rao's opinion.\nI accept that DFSAdmin command need to be sent for both NN. This can solve the problem here.\n\nThat's u also meant Arron.\nAnd I would like to add Standby check at replication monitor to avoid load in cluster.\n\nMy First opinion\n\nBefore to support my opinion of persisting the node decommisioned consider the scenarios where \n{quote}\n Decommission command is given by admin but Standby NN is down ...etc  Scenarios where Standby NN is not available when issuing command.\n{quote}\n\nDFSAdmin will just create a DFS client and calls refreshNodes()(Client will retry for NN 10 times by default not forever if I am not wrong), in this case Standby NN will not get to know the Decommission request and when Standby is up and switches to active???\n\nI guess It will consider the decommissioned node as well.\n\n{quote}\nI'm hesitant to go with this suggestion. How would differences be rectified between what's persisted in the edit log and what's present in the excluded hosts file?\n{quote}\n\nInitially I also thought of same thing. Since we are persisting the message in different forms, but consider \n\n{quote}\nAdmin could have just configured the exclude nodes in the file, but he wouldn't have issued refreshnode command. \n{quote}\n\nBy persisting into edit logs we can be sure of which DN is decommissioned? Not only by Standby NN but also when Standalone NN restarts. \n\nOr is there any way NN can identify Decommissioned node without persisting?\n\nHere I mean to persist all the stages of recommission and decommission too.\n\nPlease correct me If I am not correct.\nI will be very glad to hear more about my opinion of persisting.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajuvishnu","name":"rajuvishnu","key":"rajuvishnu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Raju","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T15:56:07.799+0000","updated":"2012-08-03T15:56:07.799+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12600782/comment/13428228","id":"13428228","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajuvishnu","name":"rajuvishnu","key":"rajuvishnu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Raju","active":true,"timeZone":"Etc/UTC"},"body":"I would like to add some scenarios which can be handled by persisting\n\n1. If N/W is unreachable from DFSClient issuing refreshNodes and Standby.\n2. If N/W is unreachable from DFSClient issuing refreshNodes and active, refreshnodes command reached Standby NN and it marks DECOMMISSION in progress and NN N/W is reachable.\n\nand other N/W down scenarios as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajuvishnu","name":"rajuvishnu","key":"rajuvishnu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Raju","active":true,"timeZone":"Etc/UTC"},"created":"2012-08-03T16:54:12.965+0000","updated":"2012-08-03T16:54:12.965+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12600782/comment/13429144","id":"13429144","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=atm","name":"atm","key":"atm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=atm&avatarId=14136","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=atm&avatarId=14136","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=atm&avatarId=14136","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=atm&avatarId=14136"},"displayName":"Aaron T. Myers","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. And I would like to add Standby check at replication monitor to avoid load in cluster.\n\nGot it. This seems like a separate issue from what's being discussed here, though, and so should probably be done as a separate JIRA. Do you agree?\n\nbq. By persisting into edit logs we can be sure of which DN is decommissioned? Not only by Standby NN but also when Standalone NN restarts.\n\nThe question that I have is still \"How would differences be rectified between what's persisted in the edit log and what's present in the excluded hosts file?\" Imagine that some host is not present in the excluded hosts file, but a decommission action for that host is present in the edit log. Given that edit logs are occasionally merged into an fsimage and the edit logs discarded, this would imply that we'd need to introduce a new section into the fsimage for per-host DN status. This means that we'd end up with two potentially out of sync lists of DN decommission status: one in the excludes file, the other in this new section of the fsimage file.\n\nMy point is that I think persisting DN decommission status to the edit log / fsimage is not an unreasonable idea, but it does seem like an idea that's incompatible with the excluded hosts config file. Given that, I'm still in favor of just requiring the admin keep the excluded hosts files in sync, and call refreshNodes on both NNs from DFSAdmin. I think this argument is further supported by the fact that the active/standby NN having an out of sync view of DN decommission status isn't actually that big of a problem. Yes, it might result in some unnecessary replication traffic, but it shouldn't result in data loss or unavailability, since DNs already ignore replication commands from anything but the active NN.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=atm","name":"atm","key":"atm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=atm&avatarId=14136","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=atm&avatarId=14136","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=atm&avatarId=14136","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=atm&avatarId=14136"},"displayName":"Aaron T. Myers","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-08-06T13:40:48.351+0000","updated":"2012-08-06T13:40:48.351+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12600782/comment/13758909","id":"13758909","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"body":"{quote}I think my preference here is to require the admin to keep the excluded hosts files in sync across the machines (most deployments already have some way of keeping config files in sync), and then just make dfsadmin iterate over all configured NNs when the refreshNodes command is run.{quote}\nAttaching a patch which this change. Please review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-09-05T09:00:38.326+0000","updated":"2013-09-05T09:00:38.326+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12600782/comment/13758992","id":"13758992","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:green}+1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12601581/HDFS-3744.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/4928//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/4928//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-09-05T11:15:28.261+0000","updated":"2013-09-05T11:15:28.261+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12600782/comment/14063266","id":"14063266","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"body":"HDFS-6507 improved all DFSAdmin commands for the HA cluster.\n resolving as duplicate","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2014-07-16T08:01:54.923+0000","updated":"2014-07-16T08:01:54.923+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-3744/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0iy2n:"}}