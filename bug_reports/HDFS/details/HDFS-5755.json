{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12688216","self":"https://issues.apache.org/jira/rest/api/2/issue/12688216","key":"HDFS-5755","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jan 10 11:14:56 UTC 2014","customfield_12310420":"367235","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-5755/watchers","watchCount":3,"isWatching":false},"created":"2014-01-10T10:53:44.943+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325049","id":"12325049","description":"2.2.0 release","name":"2.2.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"issuelinks":[{"id":"12445001","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12445001","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12903000","key":"HADOOP-12464","self":"https://issues.apache.org/jira/rest/api/2/issue/12903000","fields":{"summary":"Interrupted client may try to fail-over and retry","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12380921","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12380921","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"inwardIssue":{"id":"12688260","key":"HADOOP-10219","self":"https://issues.apache.org/jira/rest/api/2/issue/12688260","fields":{"summary":"ipc.Client.setupIOstreams() needs to check for ClientCache.stopClient requested shutdowns ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-08T12:45:07.705+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"If a DFS client instance is spinning in a connection refused cycle, and you try to stop the process via System.exit(), the exit call does not complete until the client has actually given up. \n\nThat is: you can't exit a process with a standard kill while a DFS client operation is blocking. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"367544","customfield_12312823":null,"summary":"Filesystem close blocks SystemExit if a DFS client is trying to talk to a nonexistent NN","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688216/comment/13867699","id":"13867699","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"Scenario\n# client app tries to talk to a namenode\n# namenode service (entire VM is not running)\n# RPC client starts spinng, sleeping, retrying\n# control-C issued by hand to exit program\n# system halting messages printed\n# RPC client keeps spinning\n# control-C issued again -no obvious effect\n# kill -QUIT issued to show trace\n# eventually, when the retry count is completed, the process exits\n\n{code}\n\n2014-01-10 10:34:49.549 java[2540:1903] Unable to load realm info from SCDynamicStore\n14/01/10 10:34:49 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\n14/01/10 10:34:50 WARN hdfs.BlockReaderLocal: The short-circuit local reads feature cannot be used because libhadoop cannot be loaded.\n14/01/10 10:34:50 INFO client.RMProxy: Connecting to ResourceManager at sandbox.hortonworks.com/192.168.1.134:8050\n14/01/10 10:35:10 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 0 time(s); maxRetries=45\n14/01/10 10:35:11 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:35:12 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 1 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:35:13 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 2 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:35:14 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 3 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:35:15 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 4 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:35:35 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 1 time(s); maxRetries=45\n14/01/10 10:35:36 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 5 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:35:37 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 6 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:35:38 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 7 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:35:39 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 8 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:35:40 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 9 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:35:41 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 10 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:01 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 2 time(s); maxRetries=45\n14/01/10 10:36:02 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 11 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:03 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 12 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:04 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 13 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:05 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 14 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:06 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 15 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:07 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 16 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:08 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 17 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:09 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 18 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:10 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 19 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:11 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 20 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:12 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 21 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:13 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 22 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:33 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 3 time(s); maxRetries=45\n14/01/10 10:36:34 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 23 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:35 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 24 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:36 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 25 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:37 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 26 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:38 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 27 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:36:58 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 4 time(s); maxRetries=45\n14/01/10 10:36:59 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 28 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:37:00 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 29 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:37:01 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 30 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:37:02 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 31 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:37:03 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 32 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n^C14/01/10 10:37:06 INFO launcher.ServiceLauncher: Halting service\n14/01/10 10:37:06 INFO util.ExitUtil: Exiting with status 0\n^C14/01/10 10:37:07 INFO launcher.ServiceLauncher: Halting service\n14/01/10 10:37:07 INFO util.ExitUtil: Exiting with status 0\n14/01/10 10:37:23 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 5 time(s); maxRetries=45\n14/01/10 10:37:24 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 33 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:37:25 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 34 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:37:26 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 35 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:37:27 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 36 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:37:28 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 37 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n2014-01-10 10:37:47\nFull thread dump Java HotSpot(TM) 64-Bit Server VM (24.45-b08 mixed mode):\n\n\"SIGINT handler\" daemon prio=5 tid=0x00007feed2404000 nid=0x3b13 waiting for monitor entry [0x00000001189df000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n\tat java.lang.Shutdown.exit(Shutdown.java:212)\n\t- waiting to lock <0x00000007fed4a298> (a java.lang.Class for java.lang.Shutdown)\n\tat java.lang.Runtime.exit(Runtime.java:109)\n\tat java.lang.System.exit(System.java:962)\n\tat org.apache.hadoop.util.ExitUtil.terminate(ExitUtil.java:133)\n\tat org.apache.hadoop.util.ExitUtil.terminate(ExitUtil.java:192)\n\tat org.apache.hadoop.yarn.service.launcher.ServiceLauncher.exit(ServiceLauncher.java:270)\n\tat org.apache.hadoop.yarn.service.launcher.ServiceLauncher.interrupted(ServiceLauncher.java:257)\n\tat org.apache.hadoop.yarn.service.launcher.IrqHandler.handle(IrqHandler.java:70)\n\tat sun.misc.Signal$1.run(Signal.java:212)\n\tat java.lang.Thread.run(Thread.java:744)\n\n\"Thread-0\" prio=5 tid=0x00007feed32ed800 nid=0x5707 waiting on condition [0x000000011a45d000]\n   java.lang.Thread.State: TIMED_WAITING (sleeping)\n\tat java.lang.Thread.sleep(Native Method)\n\tat org.apache.hadoop.ipc.Client.stop(Client.java:1173)\n\tat org.apache.hadoop.ipc.ClientCache.stopClient(ClientCache.java:100)\n\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.close(ProtobufRpcEngine.java:251)\n\tat org.apache.hadoop.ipc.RPC.stopProxy(RPC.java:626)\n\tat org.apache.hadoop.io.retry.DefaultFailoverProxyProvider.close(DefaultFailoverProxyProvider.java:57)\n\tat org.apache.hadoop.io.retry.RetryInvocationHandler.close(RetryInvocationHandler.java:206)\n\tat org.apache.hadoop.ipc.RPC.stopProxy(RPC.java:626)\n\tat org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolTranslatorPB.close(ClientNamenodeProtocolTranslatorPB.java:174)\n\tat org.apache.hadoop.ipc.RPC.stopProxy(RPC.java:621)\n\tat org.apache.hadoop.hdfs.DFSClient.closeConnectionToNamenode(DFSClient.java:738)\n\tat org.apache.hadoop.hdfs.DFSClient.close(DFSClient.java:794)\n\t- locked <0x00000007fec26860> (a org.apache.hadoop.hdfs.DFSClient)\n\tat org.apache.hadoop.hdfs.DistributedFileSystem.close(DistributedFileSystem.java:847)\n\tat org.apache.hadoop.fs.FileSystem$Cache.closeAll(FileSystem.java:2524)\n\t- locked <0x00000007fec254e0> (a org.apache.hadoop.fs.FileSystem$Cache)\n\tat org.apache.hadoop.fs.FileSystem$Cache$ClientFinalizer.run(FileSystem.java:2541)\n\t- locked <0x00000007fec254f8> (a org.apache.hadoop.fs.FileSystem$Cache$ClientFinalizer)\n\tat org.apache.hadoop.util.ShutdownHookManager$1.run(ShutdownHookManager.java:54)\n\n\"SIGINT handler\" daemon prio=5 tid=0x00007feed2403800 nid=0x3d13 in Object.wait() [0x0000000117a14000]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\t- waiting on <0x00000007fed58110> (a org.apache.hadoop.util.ShutdownHookManager$1)\n\tat java.lang.Thread.join(Thread.java:1280)\n\t- locked <0x00000007fed58110> (a org.apache.hadoop.util.ShutdownHookManager$1)\n\tat java.lang.Thread.join(Thread.java:1354)\n\tat java.lang.ApplicationShutdownHooks.runHooks(ApplicationShutdownHooks.java:106)\n\tat java.lang.ApplicationShutdownHooks$1.run(ApplicationShutdownHooks.java:46)\n\tat java.lang.Shutdown.runHooks(Shutdown.java:123)\n\tat java.lang.Shutdown.sequence(Shutdown.java:167)\n\tat java.lang.Shutdown.exit(Shutdown.java:212)\n\t- locked <0x00000007fed4a298> (a java.lang.Class for java.lang.Shutdown)\n\tat java.lang.Runtime.exit(Runtime.java:109)\n\tat java.lang.System.exit(System.java:962)\n\tat org.apache.hadoop.util.ExitUtil.terminate(ExitUtil.java:133)\n\tat org.apache.hadoop.util.ExitUtil.terminate(ExitUtil.java:192)\n\tat org.apache.hadoop.yarn.service.launcher.ServiceLauncher.exit(ServiceLauncher.java:270)\n\tat org.apache.hadoop.yarn.service.launcher.ServiceLauncher.interrupted(ServiceLauncher.java:257)\n\tat org.apache.hadoop.yarn.service.launcher.IrqHandler.handle(IrqHandler.java:70)\n\tat sun.misc.Signal$1.run(Signal.java:212)\n\tat java.lang.Thread.run(Thread.java:744)\n\n\"Service Thread\" daemon prio=5 tid=0x00007feed3807000 nid=0x5303 runnable [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"C2 CompilerThread1\" daemon prio=5 tid=0x00007feed2804800 nid=0x5103 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"C2 CompilerThread0\" daemon prio=5 tid=0x00007feed2801000 nid=0x4f03 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"Signal Dispatcher\" daemon prio=5 tid=0x00007feed3017000 nid=0x4d03 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"Finalizer\" daemon prio=5 tid=0x00007feed3802800 nid=0x3903 in Object.wait() [0x00000001178cb000]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\t- waiting on <0x00000007feb006c0> (a java.lang.ref.ReferenceQueue$Lock)\n\tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:135)\n\t- locked <0x00000007feb006c0> (a java.lang.ref.ReferenceQueue$Lock)\n\tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:151)\n\tat java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:189)\n\n\"Reference Handler\" daemon prio=5 tid=0x00007feed3001000 nid=0x3703 in Object.wait() [0x00000001177c8000]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\t- waiting on <0x00000007feb08d40> (a java.lang.ref.Reference$Lock)\n\tat java.lang.Object.wait(Object.java:503)\n\tat java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)\n\t- locked <0x00000007feb08d40> (a java.lang.ref.Reference$Lock)\n\n\"main\" prio=5 tid=0x00007feed2019800 nid=0x1903 runnable [0x0000000111152000]\n   java.lang.Thread.State: RUNNABLE\n\tat sun.nio.ch.KQueueArrayWrapper.kevent0(Native Method)\n\tat sun.nio.ch.KQueueArrayWrapper.poll(KQueueArrayWrapper.java:200)\n\tat sun.nio.ch.KQueueSelectorImpl.doSelect(KQueueSelectorImpl.java:103)\n\tat sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:87)\n\t- locked <0x00000007fb6aeee8> (a sun.nio.ch.Util$2)\n\t- locked <0x00000007fb6aee68> (a java.util.Collections$UnmodifiableSet)\n\t- locked <0x00000007fb6aece0> (a sun.nio.ch.KQueueSelectorImpl)\n\tat sun.nio.ch.SelectorImpl.select(SelectorImpl.java:98)\n\tat org.apache.hadoop.net.SocketIOWithTimeout$SelectorPool.select(SocketIOWithTimeout.java:335)\n\tat org.apache.hadoop.net.SocketIOWithTimeout.connect(SocketIOWithTimeout.java:203)\n\tat org.apache.hadoop.net.NetUtils.connect(NetUtils.java:529)\n\tat org.apache.hadoop.net.NetUtils.connect(NetUtils.java:493)\n\tat org.apache.hadoop.ipc.Client$Connection.setupConnection(Client.java:547)\n\t- locked <0x00000007fb5ceea8> (a org.apache.hadoop.ipc.Client$Connection)\n\tat org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:642)\n\t- locked <0x00000007fb5ceea8> (a org.apache.hadoop.ipc.Client$Connection)\n\tat org.apache.hadoop.ipc.Client$Connection.access$2600(Client.java:314)\n\tat org.apache.hadoop.ipc.Client.getConnection(Client.java:1399)\n\tat org.apache.hadoop.ipc.Client.call(Client.java:1318)\n\tat org.apache.hadoop.ipc.Client.call(Client.java:1300)\n\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:206)\n\tat com.sun.proxy.$Proxy13.getApplications(Unknown Source)\n\tat org.apache.hadoop.yarn.api.impl.pb.client.ApplicationClientProtocolPBClientImpl.getApplications(ApplicationClientProtocolPBClientImpl.java:197)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:186)\n\tat org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:102)\n\tat com.sun.proxy.$Proxy14.getApplications(Unknown Source)\n\tat org.apache.hadoop.yarn.client.api.impl.YarnClientImpl.getApplications(YarnClientImpl.java:237)\n\tat org.apache.hadoop.yarn.client.api.impl.YarnClientImpl.getApplications(YarnClientImpl.java:221)\n\tat org.apache.hadoop.hoya.yarn.client.HoyaYarnClientImpl.listHoyaInstances(HoyaYarnClientImpl.java:75)\n\tat org.apache.hadoop.hoya.yarn.client.HoyaClient.listHoyaInstances(HoyaClient.java:1167)\n\tat org.apache.hadoop.hoya.yarn.client.HoyaClient.findInstance(HoyaClient.java:1291)\n\tat org.apache.hadoop.hoya.yarn.client.HoyaClient.findInstance(HoyaClient.java:1276)\n\tat org.apache.hadoop.hoya.yarn.client.HoyaClient.bondToCluster(HoyaClient.java:1770)\n\tat org.apache.hadoop.hoya.yarn.client.HoyaClient.createClusterOperations(HoyaClient.java:1787)\n\tat org.apache.hadoop.hoya.yarn.client.HoyaClient.getClusterDescription(HoyaClient.java:1681)\n\tat org.apache.hadoop.hoya.yarn.client.HoyaClient.actionStatus(HoyaClient.java:1358)\n\tat org.apache.hadoop.hoya.yarn.client.HoyaClient.runService(HoyaClient.java:237)\n\tat org.apache.hadoop.yarn.service.launcher.ServiceLauncher.launchService(ServiceLauncher.java:176)\n\tat org.apache.hadoop.yarn.service.launcher.ServiceLauncher.launchServiceRobustly(ServiceLauncher.java:385)\n\tat org.apache.hadoop.yarn.service.launcher.ServiceLauncher.launchServiceAndExit(ServiceLauncher.java:314)\n\tat org.apache.hadoop.yarn.service.launcher.ServiceLauncher.serviceMain(ServiceLauncher.java:530)\n\tat org.apache.hadoop.hoya.Hoya.main(Hoya.java:49)\n\n\"VM Thread\" prio=5 tid=0x00007feed2066800 nid=0x3503 runnable \n\n\"GC task thread#0 (ParallelGC)\" prio=5 tid=0x00007feed2014000 nid=0x2503 runnable \n\n\"GC task thread#1 (ParallelGC)\" prio=5 tid=0x00007feed2027000 nid=0x2703 runnable \n\n\"GC task thread#2 (ParallelGC)\" prio=5 tid=0x00007feed2027800 nid=0x2903 runnable \n\n\"GC task thread#3 (ParallelGC)\" prio=5 tid=0x00007feed2028800 nid=0x2b03 runnable \n\n\"GC task thread#4 (ParallelGC)\" prio=5 tid=0x00007feed2029000 nid=0x2d03 runnable \n\n\"GC task thread#5 (ParallelGC)\" prio=5 tid=0x00007feed2029800 nid=0x2f03 runnable \n\n\"GC task thread#6 (ParallelGC)\" prio=5 tid=0x00007feed202a000 nid=0x3103 runnable \n\n\"GC task thread#7 (ParallelGC)\" prio=5 tid=0x00007feed202b000 nid=0x3303 runnable \n\n\"VM Periodic Task Thread\" prio=5 tid=0x00007feed280d000 nid=0x5503 waiting on condition \n\nJNI global references: 161\n\nHeap\n PSYoungGen      total 76800K, used 27515K [0x00000007faa80000, 0x0000000800000000, 0x0000000800000000)\n  eden space 66048K, 26% used [0x00000007faa80000,0x00000007fbbd1420,0x00000007feb00000)\n  from space 10752K, 90% used [0x00000007feb00000,0x00000007ff48dbb8,0x00000007ff580000)\n  to   space 10752K, 0% used [0x00000007ff580000,0x00000007ff580000,0x0000000800000000)\n ParOldGen       total 174592K, used 72K [0x00000007f0000000, 0x00000007faa80000, 0x00000007faa80000)\n  object space 174592K, 0% used [0x00000007f0000000,0x00000007f0012010,0x00000007faa80000)\n PSPermGen       total 21504K, used 15641K [0x00000007eae00000, 0x00000007ec300000, 0x00000007f0000000)\n  object space 21504K, 72% used [0x00000007eae00000,0x00000007ebd464b8,0x00000007ec300000)\n\n14/01/10 10:37:48 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 6 time(s); maxRetries=45\n14/01/10 10:37:49 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 38 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:37:50 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 39 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:37:51 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 40 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:37:52 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 41 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:37:53 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 42 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:38:13 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 7 time(s); maxRetries=45\n14/01/10 10:38:14 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 43 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:38:15 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 44 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:38:16 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 45 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:38:17 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 46 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:38:18 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 47 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:38:38 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 8 time(s); maxRetries=45\n14/01/10 10:38:39 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 48 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n14/01/10 10:38:40 INFO ipc.Client: Retrying connect to server: sandbox.hortonworks.com/192.168.1.134:8050. Already tried 49 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=50, sleepTime=1 SECONDS)\n (git:feature/BUG-12091:4fe977c △ ) hoya-0.10.0-SNAPSHOT $ \n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2014-01-10T10:57:14.612+0000","updated":"2014-01-10T10:57:14.612+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688216/comment/13867716","id":"13867716","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"h1. Analysis\n\nMain thread is blocked while DFS client is trying to connect\n{code}\n\"main\" prio=5 tid=0x00007feed2019800 nid=0x1903 runnable [0x0000000111152000]\n   java.lang.Thread.State: RUNNABLE\n\tat sun.nio.ch.KQueueArrayWrapper.kevent0(Native Method)\n\tat sun.nio.ch.KQueueArrayWrapper.poll(KQueueArrayWrapper.java:200)\n\tat sun.nio.ch.KQueueSelectorImpl.doSelect(KQueueSelectorImpl.java:103)\n\tat sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:87)\n\t- locked <0x00000007fb6aeee8> (a sun.nio.ch.Util$2)\n\t- locked <0x00000007fb6aee68> (a java.util.Collections$UnmodifiableSet)\n\t- locked <0x00000007fb6aece0> (a sun.nio.ch.KQueueSelectorImpl)\n\tat sun.nio.ch.SelectorImpl.select(SelectorImpl.java:98)\n\tat org.apache.hadoop.net.SocketIOWithTimeout$SelectorPool.select(SocketIOWithTimeout.java:335)\n\tat org.apache.hadoop.net.SocketIOWithTimeout.connect(SocketIOWithTimeout.java:203)\n\tat org.apache.hadoop.net.NetUtils.connect(NetUtils.java:529)\n\tat org.apache.hadoop.net.NetUtils.connect(NetUtils.java:493)\n\tat org.apache.hadoop.ipc.Client$Connection.setupConnection(Client.java:547)\n\t- locked <0x00000007fb5ceea8> (a org.apache.hadoop.ipc.Client$Connection)\n\tat org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:642)\n\t- locked <0x00000007fb5ceea8> (a org.apache.hadoop.ipc.Client$Connection)\n\tat org.apache.hadoop.ipc.Client$Connection.access$2600(Client.java:314)\n\tat org.apache.hadoop.ipc.Client.getConnection(Client.java:1399)\n\tat org.apache.hadoop.ipc.Client.call(Client.java:1318)\n\tat org.apache.hadoop.ipc.Client.call(Client.java:1300)\n\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:206)\n\tat com.sun.proxy.$Proxy13.getApplications(Unknown Source)\n{code}\n\nSIGINT handler has called System.exit, which is running shutdown hooks\n\n{code}\n\"SIGINT handler\" daemon prio=5 tid=0x00007feed2403800 nid=0x3d13 in Object.wait() [0x0000000117a14000]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\t- waiting on <0x00000007fed58110> (a org.apache.hadoop.util.ShutdownHookManager$1)\n\tat java.lang.Thread.join(Thread.java:1280)\n\t- locked <0x00000007fed58110> (a org.apache.hadoop.util.ShutdownHookManager$1)\n\tat java.lang.Thread.join(Thread.java:1354)\n\tat java.lang.ApplicationShutdownHooks.runHooks(ApplicationShutdownHooks.java:106)\n\tat java.lang.ApplicationShutdownHooks$1.run(ApplicationShutdownHooks.java:46)\n\tat java.lang.Shutdown.runHooks(Shutdown.java:123)\n\tat java.lang.Shutdown.sequence(Shutdown.java:167)\n\tat java.lang.Shutdown.exit(Shutdown.java:212)\n\t- locked <0x00000007fed4a298> (a java.lang.Class for java.lang.Shutdown)\n\tat java.lang.Runtime.exit(Runtime.java:109)\n\tat java.lang.System.exit(System.java:962)\n\tat org.apache.hadoop.util.ExitUtil.terminate(ExitUtil.java:133)\n\tat org.apache.hadoop.util.ExitUtil.terminate(ExitUtil.java:192)\n\tat org.apache.hadoop.yarn.service.launcher.ServiceLauncher.exit(ServiceLauncher.java:270)\n\tat org.apache.hadoop.yarn.service.launcher.ServiceLauncher.interrupted(ServiceLauncher.java:257)\n\tat org.apache.hadoop.yarn.service.launcher.IrqHandler.handle(IrqHandler.java:70)\n\tat sun.misc.Signal$1.run(Signal.java:212)\n\tat java.lang.Thread.run(Thread.java:744)\n{code}\n\n\nAnd the shutdown hook blocks\n{code}\n\n\n{code}\n\"Thread-0\" prio=5 tid=0x00007feed32ed800 nid=0x5707 waiting on condition [0x000000011a45d000]\n   java.lang.Thread.State: TIMED_WAITING (sleeping)\n\tat java.lang.Thread.sleep(Native Method)\n\tat org.apache.hadoop.ipc.Client.stop(Client.java:1173)\n\tat org.apache.hadoop.ipc.ClientCache.stopClient(ClientCache.java:100)\n\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.close(ProtobufRpcEngine.java:251)\n\tat org.apache.hadoop.ipc.RPC.stopProxy(RPC.java:626)\n\tat org.apache.hadoop.io.retry.DefaultFailoverProxyProvider.close(DefaultFailoverProxyProvider.java:57)\n\tat org.apache.hadoop.io.retry.RetryInvocationHandler.close(RetryInvocationHandler.java:206)\n\tat org.apache.hadoop.ipc.RPC.stopProxy(RPC.java:626)\n\tat org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolTranslatorPB.close(ClientNamenodeProtocolTranslatorPB.java:174)\n\tat org.apache.hadoop.ipc.RPC.stopProxy(RPC.java:621)\n\tat org.apache.hadoop.hdfs.DFSClient.closeConnectionToNamenode(DFSClient.java:738)\n\tat org.apache.hadoop.hdfs.DFSClient.close(DFSClient.java:794)\n\t- locked <0x00000007fec26860> (a org.apache.hadoop.hdfs.DFSClient)\n\tat org.apache.hadoop.hdfs.DistributedFileSystem.close(DistributedFileSystem.java:847)\n\tat org.apache.hadoop.fs.FileSystem$Cache.closeAll(FileSystem.java:2524)\n\t- locked <0x00000007fec254e0> (a org.apache.hadoop.fs.FileSystem$Cache)\n\tat org.apache.hadoop.fs.FileSystem$Cache$ClientFinalizer.run(FileSystem.java:2541)\n\t- locked <0x00000007fec254f8> (a org.apache.hadoop.fs.FileSystem$Cache$ClientFinalizer)\n\tat org.apache.hadoop.util.ShutdownHookManager$1.run(ShutdownHookManager.java:54)\n\n{code}\n\nh3. shutdown hook sequence:\n# Hadoop shutdown hook triggers {{FileSystem.cache.closeAll()}}\n# which invokes {{DFSClient.closeConnectionToNamenode()}}\n# which tries to stop the RPC proxy\n# which trickles all the way through to the IPC {{ClientCache.stopClient()}}\n# which waits until all the client connections are closed\n{code}\n    // wait until all connections are closed\n    while (!connections.isEmpty()) {\n      try {\n        Thread.sleep(100);\n      } catch (InterruptedException e) {\n      }\n    }\n{code}\n\nAs a result: no shutdown until all client connections are closed -hence no shutdown until all spinning/retrying client connections have succeeded.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2014-01-10T11:07:12.909+0000","updated":"2014-01-10T11:07:12.909+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688216/comment/13867717","id":"13867717","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"fixing formatting of last sequence\n\n{code}\n\"Thread-0\" prio=5 tid=0x00007feed32ed800 nid=0x5707 waiting on condition [0x000000011a45d000]\njava.lang.Thread.State: TIMED_WAITING (sleeping)\nat java.lang.Thread.sleep(Native Method)\nat org.apache.hadoop.ipc.Client.stop(Client.java:1173)\nat org.apache.hadoop.ipc.ClientCache.stopClient(ClientCache.java:100)\nat org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.close(ProtobufRpcEngine.java:251)\nat org.apache.hadoop.ipc.RPC.stopProxy(RPC.java:626)\nat org.apache.hadoop.io.retry.DefaultFailoverProxyProvider.close(DefaultFailoverProxyProvider.java:57)\nat org.apache.hadoop.io.retry.RetryInvocationHandler.close(RetryInvocationHandler.java:206)\nat org.apache.hadoop.ipc.RPC.stopProxy(RPC.java:626)\nat org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolTranslatorPB.close(ClientNamenodeProtocolTranslatorPB.java:174)\nat org.apache.hadoop.ipc.RPC.stopProxy(RPC.java:621)\nat org.apache.hadoop.hdfs.DFSClient.closeConnectionToNamenode(DFSClient.java:738)\nat org.apache.hadoop.hdfs.DFSClient.close(DFSClient.java:794)\nlocked <0x00000007fec26860> (a org.apache.hadoop.hdfs.DFSClient)\nat org.apache.hadoop.hdfs.DistributedFileSystem.close(DistributedFileSystem.java:847)\nat org.apache.hadoop.fs.FileSystem$Cache.closeAll(FileSystem.java:2524)\nlocked <0x00000007fec254e0> (a org.apache.hadoop.fs.FileSystem$Cache)\nat org.apache.hadoop.fs.FileSystem$Cache$ClientFinalizer.run(FileSystem.java:2541)\nlocked <0x00000007fec254f8> (a org.apache.hadoop.fs.FileSystem$Cache$ClientFinalizer)\nat org.apache.hadoop.util.ShutdownHookManager$1.run(ShutdownHookManager.java:54)\n{code}\nh3. shutdown hook sequence:\n# Hadoop shutdown hook triggers {{FileSystem.cache.closeAll()}}\n# which invokes {{DFSClient.closeConnectionToNamenode()}}\n# which tries to stop the RPC proxy\n# which trickles all the way through to the IPC {{ClientCache.stopClient()}}\n# which waits until all the client connections are closed\n\n{code}\n// wait until all connections are closed\nwhile (!connections.isEmpty()) {\ntry\n{ Thread.sleep(100); }\ncatch (InterruptedException e) {\n}\n}\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2014-01-10T11:08:35.934+0000","updated":"2014-01-10T11:08:35.934+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688216/comment/13867724","id":"13867724","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"Regarding fixes, the obvious one is to have all the{{RetryInvocationHandler}} to move from a {{while(true)} to a {{while(clientOpen.get()}}, and with {{AtomicBoolean clientOpen}} be something {{DfsClient.close()}} sets to true before it starts waiting for its threads.\n\nOf course, it may be better to put this into the IPC {{RPC.stopProxy}} class, as it is more at the RPC level -it just surfaces in HDFS as a side effect of the shutdown hooks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2014-01-10T11:14:56.470+0000","updated":"2014-01-10T11:14:56.470+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-5755/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1ratz:"}}