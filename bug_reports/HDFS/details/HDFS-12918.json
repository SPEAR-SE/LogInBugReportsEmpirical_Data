{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13124451","self":"https://issues.apache.org/jira/rest/api/2/issue/13124451","key":"HDFS-12918","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2017-12-12T19:30:43.440+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Dec 13 01:40:22 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_22929841_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2017-12-13T01:40:22.083+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-12918/watchers","watchCount":5,"isWatching":false},"created":"2017-12-12T19:18:12.310+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335737","id":"12335737","description":"3.0.0-beta1 release","name":"3.0.0-beta1","archived":false,"released":true,"releaseDate":"2017-10-03"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-12-13T06:58:46.715+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12329603","id":"12329603","name":"hdfs"}],"timeoriginalestimate":null,"description":"According to documentation and code comments, the default setting for erasure coding policy is disabled:\r\n\r\n/** Policy is disabled. It's policy default state. */\r\n DISABLED(1),\r\n\r\nHowever, HDFS-12258 appears to have incorrectly set the policy state in the protobuf to enabled:\r\n\r\n{code:java}\r\n message ErasureCodingPolicyProto {\r\n    ooptional string name = 1;\r\n    optional ECSchemaProto schema = 2;\r\n    optional uint32 cellSize = 3;\r\n    required uint32 id = 4; // Actually a byte - only 8 bits used\r\n + optional ErasureCodingPolicyState state = 5 [default = ENABLED];\r\n  }\r\n{code}\r\n\r\nThis means the parameter can't actually be optional, it must always be included, and existing serialized data without this optional field will be incorrectly interpreted as having erasure coding enabled.\r\n\r\nThis unnecessarily breaks compatibility and will require existing HDFS installations that store metadata in protobufs to require reformatting.\r\n\r\nIt looks like a simple mistake that was overlooked in code review.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"NameNode fails to start after upgrade - Missing state in ECPolicy Proto ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zamsden","name":"zamsden","key":"zamsden","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zamsden&avatarId=31238","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zamsden&avatarId=31238","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zamsden&avatarId=31238","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zamsden&avatarId=31238"},"displayName":"Zach Amsden","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zamsden","name":"zamsden","key":"zamsden","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zamsden&avatarId=31238","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zamsden&avatarId=31238","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zamsden&avatarId=31238","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zamsden&avatarId=31238"},"displayName":"Zach Amsden","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124451/comment/16288141","id":"16288141","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"body":"I can take a look at this if you haven't already started to work on the patch. Please let me know.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-12-12T19:30:43.440+0000","updated":"2017-12-12T19:30:43.440+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124451/comment/16288158","id":"16288158","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zamsden","name":"zamsden","key":"zamsden","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zamsden&avatarId=31238","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zamsden&avatarId=31238","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zamsden&avatarId=31238","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zamsden&avatarId=31238"},"displayName":"Zach Amsden","active":true,"timeZone":"America/Los_Angeles"},"body":"[~manojg] thanks, we encountered this during testing.  I wasn't planning on creating a patch as we're not blocked but it looks like a simple enough fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zamsden","name":"zamsden","key":"zamsden","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zamsden&avatarId=31238","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zamsden&avatarId=31238","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zamsden&avatarId=31238","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zamsden&avatarId=31238"},"displayName":"Zach Amsden","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-12-12T19:42:37.115+0000","updated":"2017-12-12T19:42:37.115+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124451/comment/16288378","id":"16288378","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"body":"[~zamsden],\r\n  There is an addendum patch HDFS-12682 after HDFS-12258 to make the policy immutable by pulling the EC state to {{ErasureCodingPolicyInfo}}. As you pointed out {{hdfs.proto}} default value looks wrong to me as well. But, in the PBHelperClient code there is an explicit handling for this, both while saving the ECPolicy and while retrieving.  So, ECPI saved and retrieved from FSImages should be right. \r\n\r\n{{PBHelperClient}}\r\n{noformat}\r\n  /**\r\n   * Convert the protobuf to a {@link ErasureCodingPolicyInfo}. This should only\r\n   * be needed when the caller is interested in the state of the policy.\r\n   */\r\n  public static ErasureCodingPolicyInfo convertErasureCodingPolicyInfo(\r\n      ErasureCodingPolicyProto proto) {\r\n    ErasureCodingPolicy policy = convertErasureCodingPolicy(proto);\r\n    ErasureCodingPolicyInfo info = new ErasureCodingPolicyInfo(policy);\r\n    Preconditions.checkArgument(proto.hasState(),\r\n        \"Missing state field in ErasureCodingPolicy proto\");\r\n    info.setState(convertECState(proto.getState()));  <====\r\n    return info;\r\n  }\r\n\r\n  /**\r\n   * Convert a {@link ErasureCodingPolicyInfo} to protobuf.\r\n   * The protobuf will have the policy, and state. State is relevant when:\r\n   * 1. Persisting a policy to fsimage\r\n   * 2. Returning the policy to the RPC call\r\n   * {@link DistributedFileSystem#getAllErasureCodingPolicies()}\r\n   */\r\n  public static ErasureCodingPolicyProto convertErasureCodingPolicy(\r\n      ErasureCodingPolicyInfo info) {\r\n    final ErasureCodingPolicyProto.Builder builder =\r\n        createECPolicyProtoBuilder(info.getPolicy());\r\n    builder.setState(convertECState(info.getState()));  <===\r\n    return builder.build();\r\n  }\r\n\r\n{noformat}\r\n\r\nListing Policies:\r\n{noformat}\r\n$ hdfs ec -listPolicies\r\nErasure Coding Policies:\r\nErasureCodingPolicy=[Name=RS-10-4-1024k, Schema=[ECSchema=[Codec=rs, numDataUnits=10, numParityUnits=4]], CellSize=1048576, Id=5], State=DISABLED\r\nErasureCodingPolicy=[Name=RS-3-2-1024k, Schema=[ECSchema=[Codec=rs, numDataUnits=3, numParityUnits=2]], CellSize=1048576, Id=2], State=ENABLED\r\nErasureCodingPolicy=[Name=RS-6-3-1024k, Schema=[ECSchema=[Codec=rs, numDataUnits=6, numParityUnits=3]], CellSize=1048576, Id=1], State=ENABLED\r\nErasureCodingPolicy=[Name=RS-LEGACY-6-3-1024k, Schema=[ECSchema=[Codec=rs-legacy, numDataUnits=6, numParityUnits=3]], CellSize=1048576, Id=3], State=DISABLED\r\nErasureCodingPolicy=[Name=XOR-2-1-1024k, Schema=[ECSchema=[Codec=xor, numDataUnits=2, numParityUnits=1]], CellSize=1048576, Id=4], State=DISABLED\r\n{noformat}\r\n\r\nBut, there is another version of {{convertErasureCodingPolicy}} which takes in only {{ErasureCodingPolicy}} where the state is missing and the default  state from {{ErasureCodingPolicyProto}} will be used.\r\n\r\n{noformat}\r\n  /**\r\n   * Convert a {@link ErasureCodingPolicy} to protobuf.\r\n   * This means no state of the policy will be set on the protobuf.\r\n   */\r\n  public static ErasureCodingPolicyProto convertErasureCodingPolicy(\r\n      ErasureCodingPolicy policy) {\r\n    return createECPolicyProtoBuilder(policy).build();\r\n  }\r\n{noformat}\r\n\r\nProbably you are seeing the default value of the EC state from the callers (like ListStatus, BlockRecovery, BlockGroupChecksum etc.,) of the above convert util. Can you please confirm where you are seeing the inconsistent EC state? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-12-12T22:21:19.420+0000","updated":"2017-12-12T22:21:19.420+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124451/comment/16288485","id":"16288485","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaochen","name":"xiaochen","key":"xiaochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xiaochen&avatarId=24893","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xiaochen&avatarId=24893","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xiaochen&avatarId=24893","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xiaochen&avatarId=24893"},"displayName":"Xiao Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Zach for reporting this and Manoj for investigating.\r\n\r\nAs Manoj pointed out, I found this too while fixing HDFS-12682. Although it is a mistake there, it was not changed due to the fear of incompatible behavior, when discussing whether that should be set to 'DISABLED'. \r\n\r\nAccording to [protobuf doc|https://developers.google.com/protocol-buffers/docs/proto#optional]: {{If the default value is not specified for an optional element, a type-specific default value is used instead...For enums, the default value is the first value listed in the enum's type definition}}.\r\n\r\nI think we check whether a state is set in the protobuf by {{proto.hasState()}}, so this wrong default shouldn't be visible downstream - so also echoing Manoj: where is this observed?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaochen","name":"xiaochen","key":"xiaochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xiaochen&avatarId=24893","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xiaochen&avatarId=24893","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xiaochen&avatarId=24893","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xiaochen&avatarId=24893"},"displayName":"Xiao Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-12-12T23:50:16.556+0000","updated":"2017-12-12T23:50:16.556+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124451/comment/16288521","id":"16288521","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"body":"\r\nA new check added in the convert seems to be not backward compatible. It is going to break the upgrade from previous image format where the ErasureCodingPolicyProto didn't have state field. It is suppose to be an optional field and the below check need to be relaxed as well. [~xiaochen] your thoughts please?\r\n\r\n{noformat}\r\n  /**\r\n   * Convert the protobuf to a {@link ErasureCodingPolicyInfo}. This should only\r\n   * be needed when the caller is interested in the state of the policy.\r\n   */\r\n  public static ErasureCodingPolicyInfo convertErasureCodingPolicyInfo(\r\n      ErasureCodingPolicyProto proto) {\r\n    ErasureCodingPolicy policy = convertErasureCodingPolicy(proto);\r\n    ErasureCodingPolicyInfo info = new ErasureCodingPolicyInfo(policy);\r\n    Preconditions.checkArgument(proto.hasState(),    <======\r\n        \"Missing state field in ErasureCodingPolicy proto\");\r\n    info.setState(convertECState(proto.getState()));\r\n    return info;\r\n  }\r\n{noformat}\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-12-13T00:20:57.588+0000","updated":"2017-12-13T00:20:57.588+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124451/comment/16288537","id":"16288537","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zamsden","name":"zamsden","key":"zamsden","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zamsden&avatarId=31238","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zamsden&avatarId=31238","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zamsden&avatarId=31238","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zamsden&avatarId=31238"},"displayName":"Zach Amsden","active":true,"timeZone":"America/Los_Angeles"},"body":"Maybe that is the real bug then.  I got this exception when upgrading an existing HDFS cluster - reformatting was required:\r\n\r\n\r\n{noformat}\r\nFailed to load image from FSImageFile(file=/data/2/dfs/nn/current/fsimage_0000000000008728887, cpktTxId=0000000000008728887)\r\njava.lang.IllegalArgumentException: Missing state field in ErasureCodingPolicy proto\r\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:88)\r\n\tat org.apache.hadoop.hdfs.protocolPB.PBHelperClient.convertErasureCodingPolicyInfo(PBHelperClient.java:2973)\r\n\tat org.apache.hadoop.hdfs.server.namenode.FSImageFormatProtobuf$Loader.loadErasureCodingSection(FSImageFormatProtobuf.java:386)\r\n\tat org.apache.hadoop.hdfs.server.namenode.FSImageFormatProtobuf$Loader.loadInternal(FSImageFormatProtobuf.java:298)\r\n\tat org.apache.hadoop.hdfs.server.namenode.FSImageFormatProtobuf$Loader.load(FSImageFormatProtobuf.java:188)\r\n\tat org.apache.hadoop.hdfs.server.namenode.FSImageFormat$LoaderDelegator.load(FSImageFormat.java:227)\r\n\tat org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImage(FSImage.java:928)\r\n\tat org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImage(FSImage.java:912)\r\n\tat org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImageFile(FSImage.java:785)\r\n\tat org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImage(FSImage.java:719)\r\n\tat org.apache.hadoop.hdfs.server.namenode.FSImage.recoverTransitionRead(FSImage.java:317)\r\n\tat org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFSImage(FSNamesystem.java:1072)\r\n\tat org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFromDisk(FSNamesystem.java:704)\r\n\tat org.apache.hadoop.hdfs.server.namenode.NameNode.loadNamesystem(NameNode.java:665)\r\n\tat org.apache.hadoop.hdfs.server.namenode.NameNode.initialize(NameNode.java:727)\r\n\tat org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:950)\r\n\tat org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:929)\r\n\tat org.apache.hadoop.hdfs.server.namenode.NameNode.createNameNode(NameNode.java:1653)\r\n\tat org.apache.hadoop.hdfs.server.namenode.NameNode.main(NameNode.java:1720)\r\n{noformat}\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zamsden","name":"zamsden","key":"zamsden","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zamsden&avatarId=31238","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zamsden&avatarId=31238","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zamsden&avatarId=31238","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zamsden&avatarId=31238"},"displayName":"Zach Amsden","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-12-13T00:44:08.705+0000","updated":"2017-12-13T00:44:08.705+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124451/comment/16288591","id":"16288591","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manojg","name":"manojg","key":"manojg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Govindassamy","active":true,"timeZone":"America/Los_Angeles"},"body":"We have an upgrade incompatible fix landed in 3.0 at e565b5277d5b890dad107fe85e295a3907e4bfc1. The fix is necessary and it verifies the EC Policy state when loading FSImage. This issue is nothing to do with the default value for the ECPolicyState field in the ErasureCodingPolicyProto. While the ECPolicyState field is optional in ECPolocyProto message for over the wire communications, but its mandatory in FSImage for the EC files. I hope the upgrade incompatible changes before the 3.0 GA are ok. Please let me know if you have other thoughts. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaochen","name":"xiaochen","key":"xiaochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xiaochen&avatarId=24893","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xiaochen&avatarId=24893","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xiaochen&avatarId=24893","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xiaochen&avatarId=24893"},"displayName":"Xiao Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-12-13T01:40:22.142+0000","updated":"2017-12-13T06:58:46.705+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-12918/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3nthz:"}}