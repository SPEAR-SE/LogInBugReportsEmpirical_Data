{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12907185","self":"https://issues.apache.org/jira/rest/api/2/issue/12907185","key":"HDFS-9289","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329057","id":"12329057","description":"2.8.0 release","name":"2.8.0","archived":false,"released":true,"releaseDate":"2017-03-22"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12332790","id":"12332790","description":"2.7.2 release","name":"2.7.2","archived":false,"released":true,"releaseDate":"2016-01-25"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12334002","id":"12334002","description":"2.6.3 release","name":"2.6.3","archived":false,"released":true,"releaseDate":"2015-12-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335732","id":"12335732","description":"3.0.0-alpha1 release","name":"3.0.0-alpha1","archived":false,"released":true,"releaseDate":"2016-09-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2015-10-22T21:05:03.265+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jan 13 22:41:26 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_149863_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_1045494487","customfield_12312321":null,"resolutiondate":"2015-11-03T21:40:59.634+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-9289/watchers","watchCount":17,"isWatching":false},"created":"2015-10-22T19:13:35.358+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"10.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12331979","id":"12331979","description":"2.7.1 release","name":"2.7.1","archived":false,"released":true,"releaseDate":"2015-07-06"}],"issuelinks":[{"id":"12447323","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12447323","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12833818","key":"HDFS-8498","self":"https://issues.apache.org/jira/rest/api/2/issue/12833818","fields":{"summary":"Blocks can be committed with wrong size","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12446913","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12446913","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12907512","key":"HDFS-9298","self":"https://issues.apache.org/jira/rest/api/2/issue/12907512","fields":{"summary":"remove replica and not add replica with wrong genStamp","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-01-06T00:53:46.330+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"we have seen a case of corrupt block which is caused by file complete after a pipelineUpdate, but the file complete with the old block genStamp. This caused the replicas of two datanodes in updated pipeline to be viewed as corrupte. Propose to check genstamp when commit block","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12333995","id":"12333995","description":"2.7.3 release","name":"2.7.3","archived":false,"released":true,"releaseDate":"2016-08-25"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12768113","id":"12768113","filename":"HDFS-9289.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-22T19:15:58.752+0000","size":2794,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12768113/HDFS-9289.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12768331","id":"12768331","filename":"HDFS-9289.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-23T16:27:34.907+0000","size":10355,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12768331/HDFS-9289.2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12769100","id":"12769100","filename":"HDFS-9289.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-27T20:46:44.790+0000","size":11224,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12769100/HDFS-9289.3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12769413","id":"12769413","filename":"HDFS-9289.4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-28T21:47:30.250+0000","size":1891,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12769413/HDFS-9289.4.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12769649","id":"12769649","filename":"HDFS-9289.5.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-29T22:24:58.115+0000","size":12193,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12769649/HDFS-9289.5.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12769654","id":"12769654","filename":"HDFS-9289.6.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-29T22:40:18.460+0000","size":9950,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12769654/HDFS-9289.6.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12770342","id":"12770342","filename":"HDFS-9289.7.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-03T16:31:56.875+0000","size":11829,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12770342/HDFS-9289.7.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12770635","id":"12770635","filename":"HDFS-9289.branch-2.7.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-04T17:30:16.877+0000","size":12232,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12770635/HDFS-9289.branch-2.7.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12770419","id":"12770419","filename":"HDFS-9289.branch-2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-03T22:18:25.864+0000","size":11299,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12770419/HDFS-9289.branch-2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12773643","id":"12773643","filename":"HDFS-9289-branch-2.6.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-21T07:55:50.626+0000","size":12040,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12773643/HDFS-9289-branch-2.6.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Make DataStreamer#block thread safe and verify genStamp in commitBlock","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14969890","id":"14969890","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eclark","name":"eclark","key":"eclark","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eclark&avatarId=15878","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eclark&avatarId=15878","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eclark&avatarId=15878","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eclark&avatarId=15878"},"displayName":"Elliott Clark","active":true,"timeZone":"America/Los_Angeles"},"body":"We just had this something very similar happen on a prod cluster. Then the datanode holding the only complete block was shut off for repair.\n\n{code}\n15/10/22 06:29:32 INFO hdfs.StateChange: BLOCK* allocateBlock: /TESTCLUSTER-HBASE/WALs/hbase4544.test.com,16020,1444266312515/hbase4544.test.com%2C16020%2C1444266312515.default.1445520572440. BP-1735829752-10.210.49.21-1437433901380 blk_1190230043_116735085{blockUCState=UNDER_CONSTRUCTION, primaryNodeIndex=-1, replicas=[ReplicaUnderConstruction[[DISK]DS-8d0a91de-8a69-4f39-816e-de3a0fa8a3aa:NORMAL:10.210.81.33:50010|RBW], ReplicaUnderConstruction[[DISK]DS-52d9a122-a46a-4129-ab3d-d9041de109f8:NORMAL:10.210.31.48:50010|RBW], ReplicaUnderConstruction[[DISK]DS-c734b72e-27de-4dd4-a46c-7ae59f6ef792:NORMAL:10.210.31.38:50010|RBW]]}\n15/10/22 06:32:48 INFO namenode.FSNamesystem: updatePipeline(block=BP-1735829752-10.210.49.21-1437433901380:blk_1190230043_116735085, newGenerationStamp=116737586, newLength=201675125, newNodes=[10.210.81.33:50010, 10.210.81.45:50010, 10.210.64.29:50010], clientName=DFSClient_NONMAPREDUCE_1976436475_1)\n15/10/22 06:32:48 INFO namenode.FSNamesystem: updatePipeline(BP-1735829752-10.210.49.21-1437433901380:blk_1190230043_116735085) successfully to BP-1735829752-10.210.49.21-1437433901380:blk_1190230043_116737586\n15/10/22 06:32:50 INFO BlockStateChange: BLOCK* addStoredBlock: blockMap updated: 10.210.64.29:50010 is added to blk_1190230043_116737586{blockUCState=UNDER_CONSTRUCTION, primaryNodeIndex=-1, replicas=[ReplicaUnderConstruction[[DISK]DS-8d0a91de-8a69-4f39-816e-de3a0fa8a3aa:NORMAL:10.210.81.33:50010|RBW], ReplicaUnderConstruction[[DISK]DS-d5f7fff9-005d-4804-a223-b6e6624d3af2:NORMAL:10.210.81.45:50010|RBW], ReplicaUnderConstruction[[DISK]DS-0620aef7-b6b2-4a23-950c-09373f68a815:NORMAL:10.210.64.29:50010|FINALIZED]]} size 201681322\n15/10/22 06:32:50 INFO BlockStateChange: BLOCK* addStoredBlock: blockMap updated: 10.210.81.45:50010 is added to blk_1190230043_116737586{blockUCState=UNDER_CONSTRUCTION, primaryNodeIndex=-1, replicas=[ReplicaUnderConstruction[[DISK]DS-8d0a91de-8a69-4f39-816e-de3a0fa8a3aa:NORMAL:10.210.81.33:50010|RBW], ReplicaUnderConstruction[[DISK]DS-0620aef7-b6b2-4a23-950c-09373f68a815:NORMAL:10.210.64.29:50010|FINALIZED], ReplicaUnderConstruction[[DISK]DS-52a0a4ba-cf64-4763-99a8-6c9bb5946879:NORMAL:10.210.81.45:50010|FINALIZED]]} size 201681322\n15/10/22 06:32:50 INFO BlockStateChange: BLOCK* addStoredBlock: blockMap updated: 10.210.81.33:50010 is added to blk_1190230043_116737586{blockUCState=UNDER_CONSTRUCTION, primaryNodeIndex=-1, replicas=[ReplicaUnderConstruction[[DISK]DS-0620aef7-b6b2-4a23-950c-09373f68a815:NORMAL:10.210.64.29:50010|FINALIZED], ReplicaUnderConstruction[[DISK]DS-52a0a4ba-cf64-4763-99a8-6c9bb5946879:NORMAL:10.210.81.45:50010|FINALIZED], ReplicaUnderConstruction[[DISK]DS-4d937567-7184-40b7-a822-c7e3b5d588d4:NORMAL:10.210.81.33:50010|FINALIZED]]} size 201681322\n15/10/22 09:37:36 INFO BlockStateChange: BLOCK NameSystem.addToCorruptReplicasMap: blk_1190230043 added as corrupt on 10.210.31.38:50010 by hbase4678.test.com/10.210.31.38 because reported RBW replica with genstamp 116735085 does not match COMPLETE block's genstamp in block map 116737586\n15/10/22 09:37:36 INFO BlockStateChange: BLOCK* invalidateBlock: blk_1190230043_116735085(stored=blk_1190230043_116737586) on 10.210.31.38:50010\n15/10/22 09:37:36 INFO BlockStateChange: BLOCK* InvalidateBlocks: add blk_1190230043_116735085 to 10.210.31.38:50010\n15/10/22 09:37:39 INFO BlockStateChange: BLOCK* BlockManager: ask 10.210.31.38:50010 to delete [blk_1190230043_116735085]\n15/10/22 12:45:03 INFO BlockStateChange: BLOCK* ask 10.210.64.29:50010 to replicate blk_1190230043_116737586 to datanode(s) 10.210.64.56:50010\n15/10/22 12:45:07 INFO BlockStateChange: BLOCK NameSystem.addToCorruptReplicasMap: blk_1190230043 added as corrupt on 10.210.64.29:50010 by hbase4496.test.com/10.210.64.56 because client machine reported it\n15/10/22 12:50:49 INFO BlockStateChange: BLOCK* ask 10.210.81.45:50010 to replicate blk_1190230043_116737586 to datanode(s) 10.210.49.49:50010\n15/10/22 12:50:55 INFO BlockStateChange: BLOCK NameSystem.addToCorruptReplicasMap: blk_1190230043 added as corrupt on 10.210.81.45:50010 by hbase4478.test.com/10.210.49.49 because client machine reported it\n15/10/22 12:56:01 WARN blockmanagement.BlockManager: PendingReplicationMonitor timed out blk_1190230043_116737586\n{code}\n\nThe patch will help but the issue will still be there. Is there some way to keep the genstamps from getting out of sync?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eclark","name":"eclark","key":"eclark","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eclark&avatarId=15878","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eclark&avatarId=15878","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eclark&avatarId=15878","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eclark&avatarId=15878"},"displayName":"Elliott Clark","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-22T21:05:03.265+0000","updated":"2015-10-22T21:05:03.265+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14969933","id":"14969933","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eclark","name":"eclark","key":"eclark","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eclark&avatarId=15878","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eclark&avatarId=15878","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eclark&avatarId=15878","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eclark&avatarId=15878"},"displayName":"Elliott Clark","active":true,"timeZone":"America/Los_Angeles"},"body":"Also can we add the expected and encountered genstamps to the exception message","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eclark","name":"eclark","key":"eclark","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eclark&avatarId=15878","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eclark&avatarId=15878","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eclark&avatarId=15878","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eclark&avatarId=15878"},"displayName":"Elliott Clark","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-22T21:28:11.739+0000","updated":"2015-10-22T21:28:11.739+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14969946","id":"14969946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"\\\\\n\\\\\n| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:red}-1{color} | pre-patch |  18m 50s | Findbugs (version ) appears to be broken on trunk. |\n| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |\n| {color:red}-1{color} | tests included |   0m  0s | The patch doesn't appear to include any new or modified tests.  Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. |\n| {color:green}+1{color} | javac |   8m 59s | There were no new javac warning messages. |\n| {color:green}+1{color} | javadoc |  11m 27s | There were no new javadoc warning messages. |\n| {color:green}+1{color} | release audit |   0m 32s | The applied patch does not increase the total number of release audit warnings. |\n| {color:green}+1{color} | checkstyle |   0m 46s | There were no new checkstyle issues. |\n| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |\n| {color:green}+1{color} | install |   2m  9s | mvn install still works. |\n| {color:green}+1{color} | eclipse:eclipse |   0m 36s | The patch built with eclipse:eclipse. |\n| {color:red}-1{color} | findbugs |   0m 30s | Post-patch findbugs hadoop-hdfs-project/hadoop-hdfs compilation is broken. |\n| {color:green}+1{color} | findbugs |   0m 30s | The patch does not introduce any new Findbugs (version ) warnings. |\n| {color:green}+1{color} | native |   0m 13s | Pre-build of native portion |\n| {color:red}-1{color} | hdfs tests |   0m 25s | Tests failed in hadoop-hdfs. |\n| | |  44m 31s | |\n\\\\\n\\\\\n|| Reason || Tests ||\n| Failed build | hadoop-hdfs |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Patch URL | http://issues.apache.org/jira/secure/attachment/12768113/HDFS-9289.1.patch |\n| Optional Tests | javadoc javac unit findbugs checkstyle |\n| git revision | trunk / 0fce5f9 |\n| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HDFS-Build/13136/artifact/patchprocess/testrun_hadoop-hdfs.txt |\n| Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/13136/testReport/ |\n| Java | 1.7.0_55 |\n| uname | Linux asf905.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/13136/console |\n\n\nThis message was automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-22T21:34:38.937+0000","updated":"2015-10-22T21:34:38.937+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14969979","id":"14969979","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~eclark], I think the case you gave is not the same and the corrupt block doesn't seem to be caused by gen stamp reverse mismatch. So your initial pipeline has node 33, 48, 38. Then after pipeline update it has node 33, 45, 29. Then node 38 is marked corrupt due to gen stamp mismatch, which is what it should be. Then node 29(with correct gen stamp) were told to replicate to some other node, and then client report block node 29 as corrupt. This case of corruption doesn't seem like to be caused by gen stamp mismatch on namenode side but a report from client (\"because client machine reported it\")","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-22T21:55:04.013+0000","updated":"2015-10-22T21:55:04.013+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14969984","id":"14969984","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"will update patch with info of expected and encountered gen stamp and unit test soon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-22T21:56:14.368+0000","updated":"2015-10-22T21:56:14.368+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14970213","id":"14970213","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eclark","name":"eclark","key":"eclark","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eclark&avatarId=15878","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eclark&avatarId=15878","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eclark&avatarId=15878","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eclark&avatarId=15878"},"displayName":"Elliott Clark","active":true,"timeZone":"America/Los_Angeles"},"body":"{code}\n15/10/22 09:37:36 INFO BlockStateChange: BLOCK NameSystem.addToCorruptReplicasMap: blk_1190230043 added as corrupt on 10.210.31.38:50010 by hbase4678.test.com/10.210.31.38 because reported RBW replica with genstamp 116735085 does not match COMPLETE block's genstamp in block map 116737586\n{code}\n\nBlock lengths on \"corrupt\" replicas is the same as on the non-corrupt. The only difference is the genstamp.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eclark","name":"eclark","key":"eclark","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eclark&avatarId=15878","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eclark&avatarId=15878","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eclark&avatarId=15878","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eclark&avatarId=15878"},"displayName":"Elliott Clark","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-23T00:50:01.753+0000","updated":"2015-10-23T00:50:01.753+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14971300","id":"14971300","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":".2 patch include test. also include info of encountered genStamp and expected genStamp in exception","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-23T16:27:34.910+0000","updated":"2015-10-23T16:27:34.910+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14971302","id":"14971302","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"[~eclark], block on 10.210.31.38 should be marked as corrupt because it's from old pipeline right?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-23T16:29:21.426+0000","updated":"2015-10-23T16:29:21.426+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14971590","id":"14971590","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eclark","name":"eclark","key":"eclark","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eclark&avatarId=15878","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eclark&avatarId=15878","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eclark&avatarId=15878","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eclark&avatarId=15878"},"displayName":"Elliott Clark","active":true,"timeZone":"America/Los_Angeles"},"body":"It had all of the data and the same md5sums when I checked. So the only thing different was genstamps. Not really sure about why that happened. But I didn't mean to side track this jira.\n\nTest looks nice.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eclark","name":"eclark","key":"eclark","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eclark&avatarId=15878","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eclark&avatarId=15878","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eclark&avatarId=15878","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eclark&avatarId=15878"},"displayName":"Elliott Clark","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-23T18:44:51.368+0000","updated":"2015-10-23T18:44:51.368+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14972209","id":"14972209","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lichangleo] Thanks for reporting the issue. \n\nbq. but the file complete with the old block genStamp.\nHow did that happen? So the client somehow had an old GS? IIUC the {{updatePipeline}} protocol is below (using {{client_GS}}, {{DN_GS}}, and {{NN_GS}} to denote the 3 copies of GS):\n# Client asks for new GS from NN through {{updateBlockForPipeline}}. After this, {{client_GS}} is new, both {{DN_GS}} and {{NN_GS}} are old\n# Client calls {{createBlockOutputStream}} to update DN's GS. After this, both {{client_GS}} and {{DN_GS}} are new, {{NN_GS}} is old\n# Client calls {{updatePipeline}}. After this, all 3 GSes should be new\n\nMaybe step 3 failed, and then client tried to complete the file? It'd be ideal if you could extend the unit test to reproduce the error without the fix (or paste the error log). Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-24T00:42:01.791+0000","updated":"2015-10-24T00:42:01.791+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14972655","id":"14972655","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~zhz], here is the log,\n{code}\nINFO hdfs.StateChange: BLOCK* allocateBlock: /projects/FETLDEV/Benzene/benzene_stg_transient/primer/201510201900/_temporary/1/_temporary/attempt_1444859775697_31140_m_001028_0/part-m-01028. BP-1052427332-98.138.108.146-1350583571998 blk_3773617405_1106111498065{blockUCState=UNDER_CONSTRUCTION, primaryNodeIndex=-1, replicas=[ReplicaUnderConstruction[[DISK]DS-0a28b82a-e3fb-4e42-b925-e76ebd98afb4:NORMAL:10.216.32.61:1004|RBW], ReplicaUnderConstruction[[DISK]DS-236c19ee-0a39-4e53-9520-c32941ca1828:NORMAL:10.216.70.49:1004|RBW], ReplicaUnderConstruction[[DISK]DS-fc7c2dab-9309-46be-b5c0-52be8e698591:NORMAL:10.216.70.43:1004|RBW]]}\n2015-10-20 19:49:20,392 [IPC Server handler 63 on 8020] INFO namenode.FSNamesystem: updatePipeline(block=BP-1052427332-98.138.108.146-1350583571998:blk_3773617405_1106111498065, newGenerationStamp=1106111511603, newLength=107761275, newNodes=[10.216.70.49:1004, 10.216.70.43:1004], clientName=DFSClient_attempt_1444859775697_31140_m_001028_0_1424303982_1)\n2015-10-20 19:49:20,392 [IPC Server handler 63 on 8020] INFO namenode.FSNamesystem: updatePipeline(BP-1052427332-98.138.108.146-1350583571998:blk_3773617405_1106111498065) successfully to BP-1052427332-98.138.108.146-1350583571998:blk_3773617405_1106111511603\n2015-10-20 19:49:20,400 [IPC Server handler 96 on 8020] INFO hdfs.StateChange: DIR* completeFile: /projects/FETLDEV/Benzene/benzene_stg_transient/primer/201510201900/_temporary/1/_temporary/attempt_1444859775697_31140_m_001028_0/part-m-01028 is closed by DFSClient_attempt_1444859775697_31140_m_001028_0_1424303982_1\n{code}\nYou can see the file complete after a pipeline update. The block changed its genStamp from blk_3773617405_1106111498065 to blk_3773617405_1106111511603. But then the two nodes in the updated pipeline are marked as corrupted. When I do fsck, it shows \n{code} \nhdfs fsck /projects/FETLDEV/Benzene/benzene_stg_transient/primer/201510201900/part-m-01028\nConnecting to namenode via http://uraniumtan-nn1.tan.ygrid.yahoo.com:50070\nFSCK started by hdfs (auth:KERBEROS_SSL) from /98.138.131.190 for path /projects/FETLDEV/Benzene/benzene_stg_transient/primer/201510201900/part-m-01028 at Wed Oct 21 15:04:56 UTC 2015\n.\n/projects/FETLDEV/Benzene/benzene_stg_transient/primer/201510201900/part-m-01028: CORRUPT blockpool BP-1052427332-98.138.108.146-1350583571998 block blk_3773617405\n\n/projects/FETLDEV/Benzene/benzene_stg_transient/primer/201510201900/part-m-01028:  Replica placement policy is violated for BP-1052427332-98.138.108.146-1350583571998:blk_3773617405_1106111498065. Block should be additionally replicated on 1 more rack(s).\n{code}\nit shows the blk with old gen stamp blk_3773617405_1106111498065.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-24T15:38:58.959+0000","updated":"2015-10-24T15:38:58.959+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14974490","id":"14974490","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"have met another case in our cluster\n{code}\n2015-10-23 04:38:08,544 [IPC Server handler 11 on 8020] INFO hdfs.StateChange: BLOCK* allocateBlock: /projects/wcc/wcc1/data/2015/10/22/05/Content-9892.temp.\ngz.temp._COPYING_. BP-1161836467-98.137.240.59-1438814573258 blk_1427767166_354062734{blockUCState=UNDER_CONSTRUCTION, primaryNodeIndex=-1, replicas=[Replica\nUnderConstruction[[DISK]DS-a04f60ed-6700-4e93-8a52-555301e07d3b:NORMAL:10.213.43.41:1004|RBW], ReplicaUnderConstruction[[DISK]DS-7e0de56b-17ba-4164-8b19-67a9\nf9f84c2c:NORMAL:10.213.46.123:1004|RBW], ReplicaUnderConstruction[[DISK]DS-14a850d1-deb9-496b-b5ed-bb57010a8b56:NORMAL:10.213.46.96:1004|RBW]]}\n2015-10-23 04:39:35,588 [IPC Server handler 5 on 8020] INFO namenode.FSNamesystem: updatePipeline(block=BP-1161836467-98.137.240.59-1438814573258:blk_1427767\n166_354062734, newGenerationStamp=354080525, newLength=24505255, newNodes=[10.213.46.123:1004, 10.213.46.96:1004], clientName=DFSClient_NONMAPREDUCE_12621589\n81_1)\n2015-10-23 04:39:35,588 [IPC Server handler 5 on 8020] INFO namenode.FSNamesystem: updatePipeline(BP-1161836467-98.137.240.59-1438814573258:blk_1427767166_35\n4062734) successfully to BP-1161836467-98.137.240.59-1438814573258:blk_1427767166_354080525\n2015-10-23 04:39:35,595 [IPC Server handler 50 on 8020] INFO hdfs.StateChange: DIR* completeFile: /projects/wcc/wcc1/data/2015/10/22/05/Content-9892.temp.gz.temp._COPYING_ is closed by DFSClient_NONMAPREDUCE_1262158981_1\n{code}\nThis is also a complete file before a pipelineupdate.\njsp page shows three nodes which currently holds the replica of blk_1427767166. One of the node is 10.213.43.41, which is the first node in old pipeline and dropped out in the updated pipeline and the replica currently in that node has old gen stamp. The other two nodes are later replicated after the first node in old pipeline sent in its block report. The two nodes in the updated pipeline were marked as corrupted until the node 10.213.43.41 sent in its block report.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-26T16:21:49.588+0000","updated":"2015-10-26T16:21:49.588+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14974497","id":"14974497","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"[~zhz], before we figure out the root cause of this strange case, should let this jira to be a temporary fix?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-26T16:25:23.980+0000","updated":"2015-10-26T16:25:23.980+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14974525","id":"14974525","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lichangleo] Thanks for sharing the logs! I'll look at the patch and logs and post a review today.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-26T16:50:41.651+0000","updated":"2015-10-26T16:50:41.651+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14974679","id":"14974679","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~lichangleo], what is the current conf setting of the replace-datanode-on-failure policy in your cluster? From the log looks like you disabled it?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-26T18:01:55.409+0000","updated":"2015-10-26T18:01:55.409+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14974704","id":"14974704","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~jingzhao], we are currently taking the default one, and the default is true.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-26T18:12:49.784+0000","updated":"2015-10-26T18:12:49.784+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14975348","id":"14975348","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lichangleo] I think the below log shows that the client does have new GS {{1106111511603}} because the parameter {{newBlock}} is passed in from the client. So IIUC even if we check GS when completing file, as the patch does, it won't stop the client from completing / closing the file. Or could you describe how you think the patch can avoid this error? Thanks..\n\n{code}\n2015-10-20 19:49:20,392 [IPC Server handler 63 on 8020] INFO namenode.FSNamesystem: updatePipeline(BP-1052427332-98.138.108.146-1350583571998:blk_3773617405_1106111498065) successfully to BP-1052427332-98.138.108.146-1350583571998:blk_3773617405_1106111511603\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-26T23:35:34.405+0000","updated":"2015-10-26T23:35:34.405+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14975381","id":"14975381","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"[~zhz], you are the right, the client had the new genstamp, but the problem I am trying to point out is that the client after updatepipeline with the new gen stamp it later completed file with the old gen stamp. So my patch is trying to prevent client from complete file with old genstamp after it updated pipeline with new genstamp","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-26T23:55:07.738+0000","updated":"2015-10-26T23:55:07.738+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14975837","id":"14975837","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"body":"The patch hides a potential bigger bug. We should find it out and address it.\nHi, [~lichangleo]. I'll very appreciate if you could enable debug level of {{NameNode.blockStateChangeLog}} and attach more logs? Or instructions about how to reproduce it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-10-27T06:53:15.316+0000","updated":"2015-10-27T06:53:15.316+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14976471","id":"14976471","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi, [~walter.k.su], I don't know in which cluster this strange case will happen again and I can't enable the debug message of NameNode.blockStateChangeLog across all clusters. I will look into the root cause of how this strange problem happen.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-27T14:28:30.325+0000","updated":"2015-10-27T14:28:30.325+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14976735","id":"14976735","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. the client after updatepipeline with the new gen stamp it later completed file with the old gen stamp\nThis looks very strange. But why do you think this happened? Did you see logs that the file was completed with an old GS?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-27T17:04:01.442+0000","updated":"2015-10-27T17:04:01.442+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14976815","id":"14976815","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"[~zhz], I don't have the log show the file was completed with an old GS. But by look up the block from jsp page right now, I can see that the block blk_3773617405 currently has replica on host ***657n26.***.com, ***656n04.***.com, and ***656n38.***.com,\nby going to those datanode, I see the replica on those datanodes have replica with old genstamp.\n{code}\nbash-4.1$ hostname\n***657n26.***.com\nbash-4.1$ ls -l /grid/2/hadoop/var/hdfs/data/current/BP-1052427332-98.138.108.146-1350583571998/current/finalized/subdir236/subdir212/blk_3773617405*\n-rw-r--r-- 1 hdfs users 107761275 Oct 23 18:00 /grid/2/hadoop/var/hdfs/data/current/BP-1052427332-98.138.108.146-1350583571998/current/finalized/subdir236/subdir212/blk_3773617405\n-rw-r--r-- 1 hdfs users    841895 Oct 23 18:00 /grid/2/hadoop/var/hdfs/data/current/BP-1052427332-98.138.108.146-1350583571998/current/finalized/subdir236/subdir212/blk_3773617405_1106111498065.meta\n\nbash-4.1$ hostname\n***656n04.***.com\nbash-4.1$ ls -l /grid/1/hadoop/var/hdfs/data/current/BP-1052427332-98.138.108.146-1350583571998/current/finalized/subdir236/subdir212/blk_3773617405*\n-rw-r--r-- 1 hdfs users 107761275 Oct 21 19:14 /grid/1/hadoop/var/hdfs/data/current/BP-1052427332-98.138.108.146-1350583571998/current/finalized/subdir236/subdir212/blk_3773617405\n-rw-r--r-- 1 hdfs users    841895 Oct 21 19:14 /grid/1/hadoop/var/hdfs/data/current/BP-1052427332-98.138.108.146-1350583571998/current/finalized/subdir236/subdir212/blk_3773617405_1106111498065.meta\n\nbash-4.1$ hostname\n***656n38.***.com\nbash-4.1$ ls -l /grid/3/hadoop/var/hdfs/data/current/BP-1052427332-98.138.108.146-1350583571998/current/finalized/subdir236/subdir212/blk_3773617405*\n-rw-r--r-- 1 hdfs users 107761275 Oct 23 09:14 /grid/3/hadoop/var/hdfs/data/current/BP-1052427332-98.138.108.146-1350583571998/current/finalized/subdir236/subdir212/blk_3773617405\n-rw-r--r-- 1 hdfs users    841895 Oct 23 09:14 /grid/3/hadoop/var/hdfs/data/current/BP-1052427332-98.138.108.146-1350583571998/current/finalized/subdir236/subdir212/blk_3773617405_1106111498065.meta\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-27T17:40:37.366+0000","updated":"2015-10-27T17:40:37.366+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14976925","id":"14976925","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"The fact that all 3 DNs have old GS doesn't mean the client also has an old GS. Is the above log from the same cluster as previous [logs | https://issues.apache.org/jira/browse/HDFS-9289?focusedCommentId=14972655&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14972655]?\n\nIn these cases, is there any replica with the correct (new) GS? If so it doesn't look a bug. If all replicas of a block have old GS, then it's more suspicious.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-27T18:36:22.350+0000","updated":"2015-10-27T18:36:22.350+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14977126","id":"14977126","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":".3 patch set block in DataStreamer to volatile","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-27T20:46:44.794+0000","updated":"2015-10-27T20:46:44.794+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14977156","id":"14977156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"[~zhz], yes, the above log is from the same cluster as the first log I post.\n\nThe two replicas in two datanodes from updated pipeline had new GS but they were marked as corrupt because the block commit with old genstamp. \nThe complete story happened in that cluster is:  there were initially 3 datanodes in pipeline d1, d2, d3. Then pipelineupdate happen with only d2 and d3 with new GS. Then file complete with old GS and d2 and d3 were marked corrupt. Then after 1 day, full block report from d1 came in, and NN found out d1 has the the right block with \"correct\" old GS but d1 is under replicated, so NN told d1 to replicate its replica with old GS to the other two nodes, d4, d5. So the all 3DNs I showed above were d1, d4, and d5 having old GS.\nI think there probabaly exist some cache coherence issue since \n{code}protected ExtendedBlock block;{code}\nlack volatile. That could also explain why this issue didn't happen frequently.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-27T20:58:09.898+0000","updated":"2015-10-27T20:58:09.898+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14977260","id":"14977260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. I think there probabaly exist some cache coherence issue\nThis sounds possible. Maybe the {{DFSOutputStream}} thread uses a stale copy of {{block}} in {{completeFile}}, after {{block}} is updated by the {{DataStreamer}} thread.\n\nbq. Then pipelineupdate happen with only d2 and d3 with new GS. Then file complete with old GS and d2 and d3 were marked corrupt.\nDo you have any log showing that \"replica marked as corrupt because its GS is newer than the block GS on NN\"?\n\nRegardless, making {{DataStreamer#block}} volatile is a good change. Ideally we should add a test to emulate the cache coherency problem but it doesn't look easy.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-27T22:08:26.926+0000","updated":"2015-10-27T22:08:26.926+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14977679","id":"14977679","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"\\\\\n\\\\\n| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:red}-1{color} | pre-patch |  30m 31s | Pre-patch trunk has 1 extant Findbugs (version 3.0.0) warnings. |\n| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |\n| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 2 new or modified test files. |\n| {color:green}+1{color} | javac |  11m  6s | There were no new javac warning messages. |\n| {color:green}+1{color} | javadoc |  16m  4s | There were no new javadoc warning messages. |\n| {color:green}+1{color} | release audit |   0m 39s | The applied patch does not increase the total number of release audit warnings. |\n| {color:red}-1{color} | checkstyle |   3m 30s | The applied patch generated  1 new checkstyle issues (total was 161, now 161). |\n| {color:green}+1{color} | whitespace |   0m  1s | The patch has no lines that end in whitespace. |\n| {color:green}+1{color} | install |   2m 33s | mvn install still works. |\n| {color:green}+1{color} | eclipse:eclipse |   1m  5s | The patch built with eclipse:eclipse. |\n| {color:green}+1{color} | findbugs |   8m  5s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |\n| {color:green}+1{color} | native |   5m 22s | Pre-build of native portion |\n| {color:red}-1{color} | hdfs tests |  78m  6s | Tests failed in hadoop-hdfs. |\n| {color:green}+1{color} | hdfs tests |   0m 59s | Tests passed in hadoop-hdfs-client. |\n| | | 159m 31s | |\n\\\\\n\\\\\n|| Reason || Tests ||\n| Failed unit tests | hadoop.hdfs.server.datanode.TestDataNodeHotSwapVolumes |\n|   | hadoop.hdfs.server.datanode.TestDirectoryScanner |\n|   | hadoop.hdfs.TestRecoverStripedFile |\n|   | hadoop.hdfs.server.namenode.ha.TestEditLogTailer |\n|   | hadoop.hdfs.server.blockmanagement.TestPendingInvalidateBlock |\n|   | hadoop.hdfs.TestEncryptionZones |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Patch URL | http://issues.apache.org/jira/secure/attachment/12769100/HDFS-9289.3.patch |\n| Optional Tests | javadoc javac unit findbugs checkstyle |\n| git revision | trunk / 68ce93c |\n| Pre-patch Findbugs warnings | https://builds.apache.org/job/PreCommit-HDFS-Build/13238/artifact/patchprocess/trunkFindbugsWarningshadoop-hdfs.html |\n| checkstyle |  https://builds.apache.org/job/PreCommit-HDFS-Build/13238/artifact/patchprocess/diffcheckstylehadoop-hdfs.txt |\n| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HDFS-Build/13238/artifact/patchprocess/testrun_hadoop-hdfs.txt |\n| hadoop-hdfs-client test log | https://builds.apache.org/job/PreCommit-HDFS-Build/13238/artifact/patchprocess/testrun_hadoop-hdfs-client.txt |\n| Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/13238/testReport/ |\n| Java | 1.7.0_55 |\n| uname | Linux asf907.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/13238/console |\n\n\nThis message was automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-28T04:00:54.111+0000","updated":"2015-10-28T04:00:54.111+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14978617","id":"14978617","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"[~zhz], no we don't have this log because we didn't enable the blockStateChangeLog. How do you propose we should proceed with this jira?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-28T15:45:52.636+0000","updated":"2015-10-28T15:45:52.636+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14978896","id":"14978896","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"body":"Making DataStreamer#block volatile is a good change, the GS validation on the NN side also looks good to me. Maybe we do not need a new type of {{InvalidGenStampException}} though. And to log the detailed information of the block with mismatching GS on the NN side will also be useful.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-28T17:55:45.101+0000","updated":"2015-10-28T17:55:45.101+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14979304","id":"14979304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~jingzhao] for proposal! I have updated .4 patch which log mismatched GS block info on NN and change DataStreamer#block to volatile","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-28T21:47:30.253+0000","updated":"2015-10-28T21:47:30.253+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14979367","id":"14979367","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Jing for sharing the thoughts.\n\nI think the GS validation in {{BlockManager#commitBlock}} is a little tricky. What if the {{updatePipeline}} RPC call has successfully finished NN side changes but failed in sending response to client? Should we allow the client to commit the block?\n\nGS is used to determine whether a replica is stale, but the client doesn't have a replica. Among the 3 attributes of a block (ID, size, GS), client should always have the same ID as NN, and should always have fresher size than NN. So maybe the right thing to do is to discard the client reported GS in {{commitBlock}}, but I'm not so sure.\n\nHow about we use this JIRA to commit the {{volatile}} change (which should fix the reported issue) and dedicate a follow-on JIRA to the {{commitBlock}} GS validation change?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-28T22:20:28.811+0000","updated":"2015-10-28T22:20:28.811+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14979400","id":"14979400","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. What if the updatePipeline RPC call has successfully finished NN side changes but failed in sending response to client? Should we allow the client to commit the block?\n\nThe RPC call will fail on the client side and the client will not use the old GS to commit the block.\n\nbq. How about we use this JIRA to commit the volatile change (which should fix the reported issue) and dedicate a follow-on JIRA to the commitBlock GS validation change?\n\nI agree with this proposal. Let's only log a warning msg on the NN side but not throw exception in this jira.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-28T22:40:28.257+0000","updated":"2015-10-28T22:40:28.257+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14980535","id":"14980535","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"I worked with Chang on this issue and can't think of a scenario in which it's legitimate for the client to misreport the genstamp - whether the pipeline was updated or not.\n\nConsider a more extreme case: The client wrote more data after the pipeline recovered and misreports the older genstamp.  That's silent data corruption!\n\nI'd like to see an exception here rather than later.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2015-10-29T14:41:04.231+0000","updated":"2015-10-29T14:41:04.231+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14981222","id":"14981222","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~jingzhao], [~zhz] and [~daryn] for reivew and valuable discussions! \nSome additional info about several cases of mismatched GS we encountered is that they all happened after pipelineupdate for datanode close recovery, so no mismatched size of commit happen only mismatched GS. \nCould we reach a consensus of whether we should log warn of mismatched GS block info or throw exception?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-29T20:37:32.289+0000","updated":"2015-10-29T20:37:32.289+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14981262","id":"14981262","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. That's silent data corruption!\n[~daryn] I agree it's a silent data corruption in the current logic because we update the NN's copy of the GS with the reported GS from the client:\n{code}\n// BlockInfo#commitBlock\nthis.set(getBlockId(), block.getNumBytes(), block.getGenerationStamp());\n{code}\n\nThrowing an exception (and therefore denying the commitBlock) turns this into an explicit failure, which is better. But it's still a data loss because the data written by the client after {{updatePipeline}} becomes invisible. \n\nSo I think at least for this particular bug (lacking {{volatile}}), the right thing to do is to avoid changing NN's copy of GS when committing block (so we should avoid changing blockID as well). The only thing we should commit is {{numBytes}}. Of course we should still print a {{WARN}} or {{ERROR}} when GSes mismatch. As a safer first step we should at least avoid decrementing NN's copy of block GS.\n\nIn general, if a client misreports GS, does it indicate a likelihood of misreported {{numBytes}} -- and therefore we should deny the {{commitBlock}}? It's hard to say; the {{volatile}} bug here is only for GS. But since we have already ensured the NN's copy of block {{numBytes}} never decrements, the harm of a misreported {{numBytes}} is not severe.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-29T20:57:40.754+0000","updated":"2015-10-29T20:57:40.754+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14981291","id":"14981291","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. In general, if a client misreports GS, does it indicate a likelihood of misreported numBytes – and therefore we should deny the commitBlock?\n\nCurrently NN only depends on the reported length from the client to determine the block length (not considering lease recovery scenario). So the only check we can do about the length is the existing one: {{assert block.getNumBytes() <= commitBlock.getNumBytes()}}.\n\nbq. But it's still a data loss because the data written by the client after updatePipeline becomes invisible.\n\nThrowing an exception here may not necessarily mean that the data written after updatePipeline will get lost. In most cases the data can still get recovered during the lease recovery, considering the replicas have already get persisted in DataNodes before client sends out the commit/complete request to NN (since the client has received the last response from the pipeline at that time).\n\nSo throwing exception here should be the correct behavior and may not be that risky.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-29T21:13:54.107+0000","updated":"2015-10-29T21:13:54.107+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14981313","id":"14981313","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Jing for the explanation. I agree it's reasonable to throw an exception in {{commitBlock}} and rely on lease recovery to bring the block back to full strength in this case. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-29T21:26:12.943+0000","updated":"2015-10-29T21:26:12.943+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14981321","id":"14981321","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"A small ask for the next rev:\n{code}\n// BlockInfo#commitBlock\n- this.set(getBlockId(), block.getNumBytes(), block.getGenerationStamp());\n+ this.setNumBytes(block.getNumBytes());\n{code}\n\nWe also need to add a test in the 04 patch. Otherwise LGTM.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-29T21:29:38.160+0000","updated":"2015-10-29T21:29:38.160+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14981441","id":"14981441","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~jingzhao] and [~zhz] for further review!\nUploaded .5 patch which not only log detailed error message but also throw exception. Also commit does not modify NN's copy of the block GS as Zhang suggested. Test is included.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-29T22:24:58.119+0000","updated":"2015-10-29T22:24:58.119+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14981478","id":"14981478","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"decide to not add new exception, update .6 patch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-29T22:40:18.465+0000","updated":"2015-10-29T22:40:18.465+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14981798","id":"14981798","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 0m 14s {color} | {color:blue} docker + precommit patch detected. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green} 0m 0s {color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:green}+1{color} | {color:green} test4tests {color} | {color:green} 0m 0s {color} | {color:green} The patch appears to include 2 new or modified test files. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 3m 8s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 1m 4s {color} | {color:green} trunk passed with JDK v1.8.0_66 {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 1m 4s {color} | {color:green} trunk passed with JDK v1.7.0_79 {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 22s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 29s {color} | {color:green} trunk passed {color} |\n| {color:red}-1{color} | {color:red} findbugs {color} | {color:red} 2m 3s {color} | {color:red} hadoop-hdfs-project/hadoop-hdfs in trunk cannot run convertXmlToText from findbugs {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 39s {color} | {color:green} trunk passed with JDK v1.8.0_66 {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 2m 18s {color} | {color:green} trunk passed with JDK v1.7.0_79 {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 1m 12s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 1m 2s {color} | {color:green} the patch passed with JDK v1.8.0_66 {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 1m 2s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 1m 1s {color} | {color:green} the patch passed with JDK v1.7.0_79 {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 1m 1s {color} | {color:green} the patch passed {color} |\n| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red} 0m 21s {color} | {color:red} Patch generated 1 new checkstyle issues in hadoop-hdfs-project (total was 247, now 247). {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 29s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green} 0m 0s {color} | {color:green} Patch has no whitespace issues. {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 4m 14s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 30s {color} | {color:green} the patch passed with JDK v1.8.0_66 {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 2m 19s {color} | {color:green} the patch passed with JDK v1.7.0_79 {color} |\n| {color:red}-1{color} | {color:red} unit {color} | {color:red} 69m 1s {color} | {color:red} hadoop-hdfs in the patch failed with JDK v1.8.0_66. {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green} 0m 55s {color} | {color:green} hadoop-hdfs-client in the patch passed with JDK v1.8.0_66. {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green} 67m 54s {color} | {color:green} hadoop-hdfs in the patch passed with JDK v1.7.0_79. {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green} 0m 57s {color} | {color:green} hadoop-hdfs-client in the patch passed with JDK v1.7.0_79. {color} |\n| {color:red}-1{color} | {color:red} asflicense {color} | {color:red} 0m 20s {color} | {color:red} Patch generated 56 ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 168m 34s {color} | {color:black} {color} |\n\\\\\n\\\\\n|| Reason || Tests ||\n| JDK v1.8.0_66 Failed junit tests | hadoop.hdfs.server.datanode.TestBlockScanner |\n|   | hadoop.hdfs.server.namenode.TestFSImage |\n|   | hadoop.hdfs.server.namenode.ha.TestDFSUpgradeWithHA |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker | Client=1.7.0 Server=1.7.0 Image:test-patch-base-hadoop-date2015-10-30 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12769654/HDFS-9289.6.patch |\n| JIRA Issue | HDFS-9289 |\n| Optional Tests |  asflicense  javac  javadoc  mvninstall  unit  findbugs  checkstyle  compile  |\n| uname | Linux 480999ad7ea6 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /home/jenkins/jenkins-slave/workspace/PreCommit-HDFS-Build/patchprocess/apache-yetus-e77b1ce/precommit/personality/hadoop.sh |\n| git revision | trunk / e5b1733 |\n| Default Java | 1.7.0_79 |\n| Multi-JDK versions |  /usr/lib/jvm/java-8-oracle:1.8.0_66 /usr/lib/jvm/java-7-openjdk-amd64:1.7.0_79 |\n| findbugs | v3.0.0 |\n| findbugs | https://builds.apache.org/job/PreCommit-HDFS-Build/13286/artifact/patchprocess/branch-findbugs-hadoop-hdfs-project_hadoop-hdfs.html |\n| checkstyle | https://builds.apache.org/job/PreCommit-HDFS-Build/13286/artifact/patchprocess/diff-checkstyle-hadoop-hdfs-project.txt |\n| unit | https://builds.apache.org/job/PreCommit-HDFS-Build/13286/artifact/patchprocess/patch-unit-hadoop-hdfs-project_hadoop-hdfs-jdk1.8.0_66.txt |\n| unit test logs |  https://builds.apache.org/job/PreCommit-HDFS-Build/13286/artifact/patchprocess/patch-unit-hadoop-hdfs-project_hadoop-hdfs-jdk1.8.0_66.txt |\n| JDK v1.7.0_79  Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/13286/testReport/ |\n| asflicense | https://builds.apache.org/job/PreCommit-HDFS-Build/13286/artifact/patchprocess/patch-asflicense-problems.txt |\n| modules | C: hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-client U: hadoop-hdfs-project |\n| Max memory used | 224MB |\n| Powered by | Apache Yetus   http://yetus.apache.org |\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/13286/console |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-30T03:05:34.822+0000","updated":"2015-10-30T03:05:34.822+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14981971","id":"14981971","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Chang for the update. The main code change looks good. I'll take a closer look at the test tomorrow. I just updated the JIRA title. Please see if it looks OK.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-30T06:12:37.710+0000","updated":"2015-10-30T06:12:37.710+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14982617","id":"14982617","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~zhz], the jira title looks good to me. Looking forward to your further review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-30T14:21:07.833+0000","updated":"2015-10-30T14:21:07.833+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14985415","id":"14985415","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"I'd rather see the InvalidGenStampException instead of a generic IOE.  Else it's hard for client code to intelligently deal with exceptions and for tests to verify that the correct/expected IOE was thrown.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2015-11-02T15:48:51.277+0000","updated":"2015-11-02T15:49:27.822+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14986303","id":"14986303","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"The test looks reasonable. I can see 2 minor issues:\n# {{DFSTestUtil#addBlockToFile}} is very similar as {{addStripedBlockToFile}}. At the minimum we should change the comment (not adding a \"block group\"). Ideally we should consolidate the two methods with a switch for striped or not.\n# The {{TestCommitBlock}} class only has 1 test and should be named more specifically, something like {{TestCommitBlockWithInvalidGenStamp}}\n\nIf we create a new {{InvalidGenStampException}} class, I guess we should apply it to all GS-related NN exceptions? E.g. {{BlockManager#checkReplicaCorrupt}}. How about we do it under a separate JIRA?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-02T23:49:45.723+0000","updated":"2015-11-02T23:49:45.723+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14987564","id":"14987564","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~daryn] and [~zhz] for review and comment! \nI have talked to Daryn and he agrees to relegate the new exception work to a new jira.\nthe updated .7 address [~zhz]'s suggestion of consolidate two methods of {{addBlockToFile}} and {{addStripedBlockToFile}} and rename {{TestCommitBlock}} class to {{TestCommitBlockWithInvalidGenStamp}}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-03T16:31:56.882+0000","updated":"2015-11-03T16:31:56.882+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14987673","id":"14987673","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Chang. +1 on the latest patch pending Jenkins.\n\nI'll file a follow-on JIRA to cleanup {{addBlockToFile}} a bit. Maybe we can consolidate {{numStripes}} and {{len}}.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-03T17:25:09.874+0000","updated":"2015-11-03T17:25:09.874+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14987944","id":"14987944","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 0m 8s {color} | {color:blue} docker + precommit patch detected. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green} 0m 0s {color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:green}+1{color} | {color:green} test4tests {color} | {color:green} 0m 0s {color} | {color:green} The patch appears to include 3 new or modified test files. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 3m 22s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 1m 7s {color} | {color:green} trunk passed with JDK v1.8.0_66 {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 1m 1s {color} | {color:green} trunk passed with JDK v1.7.0_79 {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 22s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 28s {color} | {color:green} trunk passed {color} |\n| {color:red}-1{color} | {color:red} findbugs {color} | {color:red} 2m 5s {color} | {color:red} hadoop-hdfs-project/hadoop-hdfs in trunk cannot run convertXmlToText from findbugs {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 39s {color} | {color:green} trunk passed with JDK v1.8.0_66 {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 2m 19s {color} | {color:green} trunk passed with JDK v1.7.0_79 {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 1m 14s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 1m 4s {color} | {color:green} the patch passed with JDK v1.8.0_66 {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 1m 4s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 1m 13s {color} | {color:green} the patch passed with JDK v1.7.0_79 {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 1m 13s {color} | {color:green} the patch passed {color} |\n| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red} 0m 24s {color} | {color:red} Patch generated 1 new checkstyle issues in hadoop-hdfs-project (total was 247, now 247). {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 33s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green} 0m 0s {color} | {color:green} Patch has no whitespace issues. {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 4m 14s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 33s {color} | {color:green} the patch passed with JDK v1.8.0_66 {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 2m 22s {color} | {color:green} the patch passed with JDK v1.7.0_79 {color} |\n| {color:red}-1{color} | {color:red} unit {color} | {color:red} 73m 29s {color} | {color:red} hadoop-hdfs in the patch failed with JDK v1.8.0_66. {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green} 1m 2s {color} | {color:green} hadoop-hdfs-client in the patch passed with JDK v1.8.0_66. {color} |\n| {color:red}-1{color} | {color:red} unit {color} | {color:red} 72m 38s {color} | {color:red} hadoop-hdfs in the patch failed with JDK v1.7.0_79. {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green} 1m 1s {color} | {color:green} hadoop-hdfs-client in the patch passed with JDK v1.7.0_79. {color} |\n| {color:red}-1{color} | {color:red} asflicense {color} | {color:red} 0m 22s {color} | {color:red} Patch generated 56 ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 178m 46s {color} | {color:black} {color} |\n\\\\\n\\\\\n|| Reason || Tests ||\n| JDK v1.8.0_66 Failed junit tests | hadoop.hdfs.server.namenode.ha.TestFailureToReadEdits |\n|   | hadoop.hdfs.server.blockmanagement.TestNodeCount |\n| JDK v1.7.0_79 Failed junit tests | hadoop.hdfs.server.blockmanagement.TestPendingInvalidateBlock |\n|   | hadoop.hdfs.server.namenode.ha.TestDNFencing |\n|   | hadoop.hdfs.TestRollingUpgrade |\n|   | hadoop.hdfs.TestFileCreationDelete |\n|   | hadoop.hdfs.server.blockmanagement.TestUnderReplicatedBlocks |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker | Client=1.7.0 Server=1.7.0 Image:test-patch-base-hadoop-date2015-11-03 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12770342/HDFS-9289.7.patch |\n| JIRA Issue | HDFS-9289 |\n| Optional Tests |  asflicense  javac  javadoc  mvninstall  unit  findbugs  checkstyle  compile  |\n| uname | Linux e3e78233b1ef 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /home/jenkins/jenkins-slave/workspace/PreCommit-HDFS-Build/patchprocess/apache-yetus-1a9afee/precommit/personality/hadoop.sh |\n| git revision | trunk / 957f031 |\n| Default Java | 1.7.0_79 |\n| Multi-JDK versions |  /usr/lib/jvm/java-8-oracle:1.8.0_66 /usr/lib/jvm/java-7-openjdk-amd64:1.7.0_79 |\n| findbugs | v3.0.0 |\n| findbugs | https://builds.apache.org/job/PreCommit-HDFS-Build/13360/artifact/patchprocess/branch-findbugs-hadoop-hdfs-project_hadoop-hdfs.html |\n| checkstyle | https://builds.apache.org/job/PreCommit-HDFS-Build/13360/artifact/patchprocess/diff-checkstyle-hadoop-hdfs-project.txt |\n| unit | https://builds.apache.org/job/PreCommit-HDFS-Build/13360/artifact/patchprocess/patch-unit-hadoop-hdfs-project_hadoop-hdfs-jdk1.8.0_66.txt |\n| unit | https://builds.apache.org/job/PreCommit-HDFS-Build/13360/artifact/patchprocess/patch-unit-hadoop-hdfs-project_hadoop-hdfs-jdk1.7.0_79.txt |\n| unit test logs |  https://builds.apache.org/job/PreCommit-HDFS-Build/13360/artifact/patchprocess/patch-unit-hadoop-hdfs-project_hadoop-hdfs-jdk1.8.0_66.txt https://builds.apache.org/job/PreCommit-HDFS-Build/13360/artifact/patchprocess/patch-unit-hadoop-hdfs-project_hadoop-hdfs-jdk1.7.0_79.txt |\n| JDK v1.7.0_79  Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/13360/testReport/ |\n| asflicense | https://builds.apache.org/job/PreCommit-HDFS-Build/13360/artifact/patchprocess/patch-asflicense-problems.txt |\n| modules | C: hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-client U: hadoop-hdfs-project |\n| Max memory used | 226MB |\n| Powered by | Apache Yetus   http://yetus.apache.org |\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/13360/console |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-03T19:37:37.385+0000","updated":"2015-11-03T19:37:37.385+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14987991","id":"14987991","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 0m 5s {color} | {color:blue} docker + precommit patch detected. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green} 0m 0s {color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:green}+1{color} | {color:green} test4tests {color} | {color:green} 0m 0s {color} | {color:green} The patch appears to include 3 new or modified test files. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 3m 13s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 55s {color} | {color:green} trunk passed with JDK v1.8.0_60 {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 53s {color} | {color:green} trunk passed with JDK v1.7.0_79 {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 19s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 27s {color} | {color:green} trunk passed {color} |\n| {color:red}-1{color} | {color:red} findbugs {color} | {color:red} 1m 51s {color} | {color:red} hadoop-hdfs-project/hadoop-hdfs in trunk cannot run convertXmlToText from findbugs {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 25s {color} | {color:green} trunk passed with JDK v1.8.0_60 {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 2m 12s {color} | {color:green} trunk passed with JDK v1.7.0_79 {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 1m 6s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 54s {color} | {color:green} the patch passed with JDK v1.8.0_60 {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 0m 54s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 0m 54s {color} | {color:green} the patch passed with JDK v1.7.0_79 {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 0m 54s {color} | {color:green} the patch passed {color} |\n| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red} 0m 19s {color} | {color:red} Patch generated 1 new checkstyle issues in hadoop-hdfs-project (total was 247, now 247). {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 26s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green} 0m 0s {color} | {color:green} Patch has no whitespace issues. {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 3m 53s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 28s {color} | {color:green} the patch passed with JDK v1.8.0_60 {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 2m 11s {color} | {color:green} the patch passed with JDK v1.7.0_79 {color} |\n| {color:red}-1{color} | {color:red} unit {color} | {color:red} 61m 48s {color} | {color:red} hadoop-hdfs in the patch failed with JDK v1.8.0_60. {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green} 0m 48s {color} | {color:green} hadoop-hdfs-client in the patch passed with JDK v1.8.0_60. {color} |\n| {color:red}-1{color} | {color:red} unit {color} | {color:red} 64m 57s {color} | {color:red} hadoop-hdfs in the patch failed with JDK v1.7.0_79. {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green} 0m 55s {color} | {color:green} hadoop-hdfs-client in the patch passed with JDK v1.7.0_79. {color} |\n| {color:red}-1{color} | {color:red} asflicense {color} | {color:red} 0m 19s {color} | {color:red} Patch generated 58 ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 155m 57s {color} | {color:black} {color} |\n\\\\\n\\\\\n|| Reason || Tests ||\n| JDK v1.8.0_60 Failed junit tests | hadoop.hdfs.server.blockmanagement.TestNodeCount |\n|   | hadoop.hdfs.server.balancer.TestBalancerWithMultipleNameNodes |\n| JDK v1.7.0_79 Failed junit tests | hadoop.fs.shell.TestHdfsTextCommand |\n|   | hadoop.hdfs.TestRollingUpgrade |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker | Client=1.7.1 Server=1.7.1 Image:test-patch-base-hadoop-date2015-11-03 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12770342/HDFS-9289.7.patch |\n| JIRA Issue | HDFS-9289 |\n| Optional Tests |  asflicense  javac  javadoc  mvninstall  unit  findbugs  checkstyle  compile  |\n| uname | Linux 2117bffd150f 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /home/jenkins/jenkins-slave/workspace/PreCommit-HDFS-Build/patchprocess/apache-yetus-1a9afee/precommit/personality/hadoop.sh |\n| git revision | trunk / 957f031 |\n| Default Java | 1.7.0_79 |\n| Multi-JDK versions |  /usr/lib/jvm/java-8-oracle:1.8.0_60 /usr/lib/jvm/java-7-openjdk-amd64:1.7.0_79 |\n| findbugs | v3.0.0 |\n| findbugs | https://builds.apache.org/job/PreCommit-HDFS-Build/13362/artifact/patchprocess/branch-findbugs-hadoop-hdfs-project_hadoop-hdfs.html |\n| checkstyle | https://builds.apache.org/job/PreCommit-HDFS-Build/13362/artifact/patchprocess/diff-checkstyle-hadoop-hdfs-project.txt |\n| unit | https://builds.apache.org/job/PreCommit-HDFS-Build/13362/artifact/patchprocess/patch-unit-hadoop-hdfs-project_hadoop-hdfs-jdk1.8.0_60.txt |\n| unit | https://builds.apache.org/job/PreCommit-HDFS-Build/13362/artifact/patchprocess/patch-unit-hadoop-hdfs-project_hadoop-hdfs-jdk1.7.0_79.txt |\n| unit test logs |  https://builds.apache.org/job/PreCommit-HDFS-Build/13362/artifact/patchprocess/patch-unit-hadoop-hdfs-project_hadoop-hdfs-jdk1.8.0_60.txt https://builds.apache.org/job/PreCommit-HDFS-Build/13362/artifact/patchprocess/patch-unit-hadoop-hdfs-project_hadoop-hdfs-jdk1.7.0_79.txt |\n| JDK v1.7.0_79  Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/13362/testReport/ |\n| asflicense | https://builds.apache.org/job/PreCommit-HDFS-Build/13362/artifact/patchprocess/patch-asflicense-problems.txt |\n| modules | C: hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-client U: hadoop-hdfs-project |\n| Max memory used | 225MB |\n| Powered by | Apache Yetus   http://yetus.apache.org |\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/13362/console |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-03T19:56:31.670+0000","updated":"2015-11-03T19:56:31.670+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14988093","id":"14988093","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~zhz] for further review! I have test those above failed unit tests above on my own machine with my patch on, and those test passed. They are not related to the changes of my patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-03T20:48:43.534+0000","updated":"2015-11-03T20:48:43.534+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14988185","id":"14988185","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Change. I just committed the patch to trunk. Do you mind creating a patch for branch-2? The main conflict is on the test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-03T21:40:09.719+0000","updated":"2015-11-03T21:40:09.719+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14988186","id":"14988186","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Fixing the JIRA for 3.0 for now. Will reopen and update fix version once branch-2 patch is done.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-03T21:40:59.663+0000","updated":"2015-11-03T21:40:59.663+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14988272","id":"14988272","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~zhz] for commit!\nhave created and uploaded a branch-2 patch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-03T22:18:25.868+0000","updated":"2015-11-03T22:18:25.868+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14988292","id":"14988292","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Chang. I just committed to branch-2 as well. Changed fix version to 2.8.0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-03T22:24:25.951+0000","updated":"2015-11-03T22:24:25.951+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14988304","id":"14988304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-trunk-Commit #8750 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/8750/])\nHDFS-9289. Make DataStreamer#block thread safe and verify genStamp in (zhz: rev dac0463a4e20dfb3a802355919fc22b8e017a4e1)\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/DFSTestUtil.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestCommitBlockWithInvalidGenStamp.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockInfo.java\n* hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DataStreamer.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestQuotaWithStripedBlocks.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-03T22:30:05.871+0000","updated":"2015-11-03T22:30:05.871+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14988600","id":"14988600","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Mapreduce-trunk #2564 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2564/])\nHDFS-9289. Make DataStreamer#block thread safe and verify genStamp in (zhz: rev dac0463a4e20dfb3a802355919fc22b8e017a4e1)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestQuotaWithStripedBlocks.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/DFSTestUtil.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DataStreamer.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestCommitBlockWithInvalidGenStamp.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockInfo.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-04T00:32:43.101+0000","updated":"2015-11-04T00:32:43.101+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14988619","id":"14988619","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hadoop-Yarn-trunk #1357 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/1357/])\nHDFS-9289. Make DataStreamer#block thread safe and verify genStamp in (zhz: rev dac0463a4e20dfb3a802355919fc22b8e017a4e1)\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockInfo.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestCommitBlockWithInvalidGenStamp.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/DFSTestUtil.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestQuotaWithStripedBlocks.java\n* hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DataStreamer.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-04T00:48:07.804+0000","updated":"2015-11-04T00:48:07.804+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14988639","id":"14988639","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hadoop-Yarn-trunk-Java8 #634 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/634/])\nHDFS-9289. Make DataStreamer#block thread safe and verify genStamp in (zhz: rev dac0463a4e20dfb3a802355919fc22b8e017a4e1)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestQuotaWithStripedBlocks.java\n* hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DataStreamer.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockInfo.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/DFSTestUtil.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestCommitBlockWithInvalidGenStamp.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-04T01:01:16.759+0000","updated":"2015-11-04T01:01:16.759+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14988801","id":"14988801","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #623 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/623/])\nHDFS-9289. Make DataStreamer#block thread safe and verify genStamp in (zhz: rev dac0463a4e20dfb3a802355919fc22b8e017a4e1)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/DFSTestUtil.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockInfo.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestCommitBlockWithInvalidGenStamp.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DataStreamer.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestQuotaWithStripedBlocks.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-04T03:11:24.365+0000","updated":"2015-11-04T03:11:24.365+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14988888","id":"14988888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #568 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/568/])\nHDFS-9289. Make DataStreamer#block thread safe and verify genStamp in (zhz: rev dac0463a4e20dfb3a802355919fc22b8e017a4e1)\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockInfo.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestCommitBlockWithInvalidGenStamp.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/DFSTestUtil.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java\n* hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DataStreamer.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestQuotaWithStripedBlocks.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-04T05:00:11.851+0000","updated":"2015-11-04T05:00:11.851+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14988900","id":"14988900","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Hdfs-trunk #2505 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2505/])\nHDFS-9289. Make DataStreamer#block thread safe and verify genStamp in (zhz: rev dac0463a4e20dfb3a802355919fc22b8e017a4e1)\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestQuotaWithStripedBlocks.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/TestCommitBlockWithInvalidGenStamp.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManager.java\n* hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DataStreamer.java\n* hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/DFSTestUtil.java\n* hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockInfo.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-04T05:17:06.982+0000","updated":"2015-11-04T05:17:06.982+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14989831","id":"14989831","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shahrs87","name":"shahrs87","key":"shahrs87","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rushabh S Shah","active":true,"timeZone":"Etc/UTC"},"body":"[~zhz]: Given that we are going to release 2.7.2 shortly , do we need to cherry pick it to 2.7.2 ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shahrs87","name":"shahrs87","key":"shahrs87","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rushabh S Shah","active":true,"timeZone":"Etc/UTC"},"created":"2015-11-04T16:25:52.635+0000","updated":"2015-11-04T16:25:52.635+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14989903","id":"14989903","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"2.7.2 is already cut. I will target it to 2.7.3 and cherry-pick to branch-2.7.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2015-11-04T16:58:04.601+0000","updated":"2015-11-04T16:58:04.601+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14989919","id":"14989919","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"bq. I will target it to 2.7.3 and cherry-pick to branch-2.7.\nWe can't cherry-pick since the files/components have been split and moved around.\n[~lichangleo], can you post 2.7 version of the patch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2015-11-04T17:05:27.029+0000","updated":"2015-11-04T17:05:27.029+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14989983","id":"14989983","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~kihwal], have uploaded branch 2.7 patch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lichangleo","name":"lichangleo","key":"lichangleo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Chang Li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-04T17:30:16.881+0000","updated":"2015-11-04T17:30:16.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14989994","id":"14989994","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for the discussions above, 2.7.3 sounds a good target version for this change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-04T17:35:17.448+0000","updated":"2015-11-04T17:35:17.448+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/14990065","id":"14990065","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"Looks like a correct port of the patch. The new test succeeds.\nCommitted to branch-2.7.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2015-11-04T18:12:53.584+0000","updated":"2015-11-04T18:12:53.584+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/15019084","id":"15019084","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"body":"Does this issue exist in 2.6.x? Should this be backported to branch-2.6?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-20T23:46:52.612+0000","updated":"2015-11-20T23:46:52.612+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/15019220","id":"15019220","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"I think this is a good addition to branch-2.6. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-21T00:57:36.662+0000","updated":"2015-11-21T00:57:36.662+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/15019222","id":"15019222","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~sjlee0] Yes this is a valid bug even for 2.6.x.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-21T00:58:08.415+0000","updated":"2015-11-21T00:58:08.415+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/15019228","id":"15019228","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~zhz]! Could you please cherry-pick the commit to branch-2.6?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-21T01:02:17.925+0000","updated":"2015-11-21T01:02:17.925+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/15020315","id":"15020315","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~sjlee0]. I'm attaching a branch-2.6 patch. Am I updating CHANGES.TXT correctly? If looks good to you I'll push to branch-2.6.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-21T07:55:50.629+0000","updated":"2015-11-21T07:55:50.629+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/15023221","id":"15023221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~zhz], the only differences I see between the 2.7 commit and the 2.6 patch are a couple of type changes (e.g. BlockInfoContiguous), right? If so, I think it might be good to follow a cherry-pick route, rather than creating a separate patch and commit.\n\nIf you're not familiar with it already, you can do\n{noformat}\ngit cherry-pick -x <commit id of the commit on branch-2.7>\n{noformat}\n\nNaturally CHANGES.txt will come up as a conflict, and you can just make it like what's proposed in the proposed patch. You'll also want to touch up the other files just like what you did in the patch. You then stage those files that were further modified. Finally you can finalize the cherry-pick via\n{noformat}\ngit cherry-pick --continue\n{noformat}\n\nIf you're not comfortable with that, I'd be OK with a new separate commit too this time. Let me know if you have a question either way.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjlee0","name":"sjlee0","key":"sjlee0","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjlee0&avatarId=16831","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjlee0&avatarId=16831","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjlee0&avatarId=16831","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjlee0&avatarId=16831"},"displayName":"Sangjin Lee","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-23T22:24:05.403+0000","updated":"2015-11-23T22:24:05.403+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/15024945","id":"15024945","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Sangjin. Yes the conflicts were mostly trivial. I was just not sure if I did the right update to CHANGES.TXT. I just committed the change to branch-2.6.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhz","name":"zhz","key":"zhz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhz&avatarId=20493","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhz&avatarId=20493","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhz&avatarId=20493","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhz&avatarId=20493"},"displayName":"Zhe Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-24T17:46:57.474+0000","updated":"2015-11-24T17:46:57.474+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907185/comment/15097181","id":"15097181","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"Pulled this into 2.7.2 to keep the release up-to-date with 2.6.3. Changing fix-versions to reflect the same.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-13T22:41:26.384+0000","updated":"2016-01-13T22:41:26.384+0000"}],"maxResults":75,"total":75,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-9289/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2nec7:"}}