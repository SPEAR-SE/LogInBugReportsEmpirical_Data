{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12656962","self":"https://issues.apache.org/jira/rest/api/2/issue/12656962","key":"HDFS-4975","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320362","id":"12320362","description":"Hadoop Windows branch","name":"1-win","archived":true,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-07-11T20:03:16.685+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jul 11 20:03:16 UTC 2013","customfield_12310420":"337185","customfield_12312320":null,"customfield_12310222":"3_*:*_1_*:*_163306988_*|*_1_*:*_1_*:*_224124_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-07-11T20:03:16.663+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-4975/watchers","watchCount":2,"isWatching":false},"created":"2013-07-09T22:37:45.580+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320362","id":"12320362","description":"Hadoop Windows branch","name":"1-win","archived":true,"released":false}],"issuelinks":[{"id":"12372156","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12372156","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12658132","key":"HDFS-5001","self":"https://issues.apache.org/jira/rest/api/2/issue/12658132","fields":{"summary":"Branch-1-Win TestAzureBlockPlacementPolicy and TestReplicationPolicyWithNodeGroup failed caused by 1) old APIs and 2) incorrect value of depthOfAllLeaves","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xifang","name":"xifang","key":"xifang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xifang&avatarId=17273","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xifang&avatarId=17273","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xifang&avatarId=17273","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xifang&avatarId=17273"},"displayName":"Xi Fang","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-07-16T22:38:02.958+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"TestReplicationPolicy failed on \n* testChooseTargetWithMoreThanAvailableNodes()\n* testChooseTargetWithStaleNodes()\n* testChooseTargetWithHalfStaleNodes()\n\nThe root of cause of testChooseTargetWithMoreThanAvailableNodes failing is the following:\nIn BlockPlacementPolicyDefault#chooseTarget()\n{code}\n  chooseRandom(numOfReplicas, NodeBase.ROOT, excludedNodes, \n        blocksize, maxNodesPerRack, results);\n    } catch (NotEnoughReplicasException e) {\n      FSNamesystem.LOG.warn(\"Not able to place enough replicas, still in need of \" + numOfReplicas);\n{code}\nHowever, numOfReplicas is passed into chooseRandom() as int (primitive type in java) by value. The updating operation for numOfReplicas in chooseRandom() will not change the value in chooseTarget(). \n\nThe root cause for testChooseTargetWithStaleNodes() and testChooseTargetWithHalfStaleNodes() is the current BlockPlacementPolicyDefault#chooseTarget() doesn't check if a node is stale.  ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320362","id":"12320362","description":"Hadoop Windows branch","name":"1-win","archived":true,"released":false}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12591538","id":"12591538","filename":"HADOOP-9714.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xifang","name":"xifang","key":"xifang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xifang&avatarId=17273","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xifang&avatarId=17273","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xifang&avatarId=17273","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xifang&avatarId=17273"},"displayName":"Xi Fang","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-09T22:41:04.080+0000","size":15669,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12591538/HADOOP-9714.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12591745","id":"12591745","filename":"HDFS-4975.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xifang","name":"xifang","key":"xifang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xifang&avatarId=17273","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xifang&avatarId=17273","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xifang&avatarId=17273","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xifang&avatarId=17273"},"displayName":"Xi Fang","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-10T22:44:28.987+0000","size":22799,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12591745/HDFS-4975.2.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"337508","customfield_12312823":null,"summary":"Branch-1-win TestReplicationPolicy failed caused by stale data node handling","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xifang","name":"xifang","key":"xifang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xifang&avatarId=17273","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xifang&avatarId=17273","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xifang&avatarId=17273","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xifang&avatarId=17273"},"displayName":"Xi Fang","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xifang","name":"xifang","key":"xifang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xifang&avatarId=17273","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xifang&avatarId=17273","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xifang&avatarId=17273","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xifang&avatarId=17273"},"displayName":"Xi Fang","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656962/comment/13703912","id":"13703912","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xifang","name":"xifang","key":"xifang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xifang&avatarId=17273","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xifang&avatarId=17273","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xifang&avatarId=17273","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xifang&avatarId=17273"},"displayName":"Xi Fang","active":true,"timeZone":"America/Los_Angeles"},"body":"It looks like https://issues.apache.org/jira/secure/attachment/12563083/hdfs-4351-branch-1-1.patch and the changes for BlockPlacementPolicyDefault in https://issues.apache.org/jira/secure/attachment/12549392/HDFS-3912-branch-1.patch are missing. A patch was made based on these two patches","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xifang","name":"xifang","key":"xifang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xifang&avatarId=17273","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xifang&avatarId=17273","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xifang&avatarId=17273","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xifang&avatarId=17273"},"displayName":"Xi Fang","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-09T22:39:54.413+0000","updated":"2013-07-09T22:39:54.413+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656962/comment/13705186","id":"13705186","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xifang","name":"xifang","key":"xifang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xifang&avatarId=17273","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xifang&avatarId=17273","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xifang&avatarId=17273","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xifang&avatarId=17273"},"displayName":"Xi Fang","active":true,"timeZone":"America/Los_Angeles"},"body":"The subclasses weren't updated in my first patch. Because the old methods are called so many times, I added them back to BlockPlacementPolicyDefault.java. They call the new APIs (i.e. the methods with parameter \"boolean avoidStaleNodes\") and pass \"avoidStaleNodes = false\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xifang","name":"xifang","key":"xifang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xifang&avatarId=17273","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xifang&avatarId=17273","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xifang&avatarId=17273","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xifang&avatarId=17273"},"displayName":"Xi Fang","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-10T22:46:50.107+0000","updated":"2013-07-10T22:46:50.107+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12656962/comment/13706163","id":"13706163","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 for the patch.  I tested successfully on Mac and Windows.  I committed this to branch-1-win.  Thank you for the patch, Xi.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-11T20:03:16.685+0000","updated":"2013-07-11T20:03:16.685+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-4975/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1m5rz:"}}