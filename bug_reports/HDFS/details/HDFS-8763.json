{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12844560","self":"https://issues.apache.org/jira/rest/api/2/issue/12844560","key":"HDFS-8763","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2015-07-13T07:01:48.229+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Sep 06 23:36:24 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_2_*:*_4325743932_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_493131230","customfield_12312321":null,"resolutiondate":"2015-09-07T00:54:17.541+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-8763/watchers","watchCount":16,"isWatching":false},"created":"2015-07-13T06:19:42.433+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326143","id":"12326143","description":"2.4.0 release","name":"2.4.0","archived":false,"released":true,"releaseDate":"2014-04-07"}],"issuelinks":[{"id":"12436662","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12436662","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12465184","key":"HDFS-1172","self":"https://issues.apache.org/jira/rest/api/2/issue/12465184","fields":{"summary":"Blocks in newly completed files are considered under-replicated too quickly","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-02-16T19:13:44.555+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"- For our cluster, the NameNode is always very busy, so for every incremental block report , the contention of lock is heavy.\n- The logic of incremental block report is as follow, client send block to dn1 and dn1 mirror to dn2, dn2 mirror to dn3. After finish this block, all datanode will report the newly received block to namenode. In NameNode side, all will go to the method processIncrementalBlockReport in BlockManager class. But the status of the block reported from dn2,dn3 is RECEIVING_BLOCK, for dn1 is RECEIED_BLOCK. It is okay if dn2, dn3 report before dn1(that is common), but in some busy environment, it is easy to find dn1 report before dn2 or dn3, let’s assume dn2 report first, dn1 report second, and dn3 report third.\n- So dn1 will addStoredBlock and find the replica of this block is not reach the the original number(which is 3), and the block will add to neededReplications construction and soon ask some node in pipeline (dn1 or dn2)to replica it dn4 . After sometime, dn4 and dn3 all report this block, then choose one node to invalidate.\nHere is one log i found in our cluster:\n{noformat}\n2015-07-08 01:05:34,675 INFO org.apache.hadoop.hdfs.StateChange: BLOCK* allocateBlock: /logs/***_bigdata_spam/logs/application_1435099124107_470749/xx.xx.4.62_45454.tmp. BP-1386326728-xx.xx.2.131-1382089338395 blk_3194502674_2121080184{blockUCState=UNDER_CONSTRUCTION, primaryNodeIndex=-1, replicas=[ReplicaUnderConstruction[[DISK]DS-a7c0f8f6-2399-4980-9479-efa08487b7b3:NORMAL|RBW], ReplicaUnderConstruction[[DISK]DS-c75145a0-ed63-4180-87ee-d48ccaa647c5:NORMAL|RBW], ReplicaUnderConstruction[[DISK]DS-15a4dc8e-5b7d-449f-a941-6dced45e6f07:NORMAL|RBW]]}\n2015-07-08 01:05:34,689 INFO BlockStateChange: BLOCK* addStoredBlock: blockMap updated: xx.xx.7.75:50010 is added to blk_3194502674_2121080184{blockUCState=UNDER_CONSTRUCTION, primaryNodeIndex=-1, replicas=[ReplicaUnderConstruction[[DISK]DS-15a4dc8e-5b7d-449f-a941-6dced45e6f07:NORMAL|RBW], ReplicaUnderConstruction[[DISK]DS-74ed264f-da43-4cc3-9fa9-164ba99f752a:NORMAL|RBW], ReplicaUnderConstruction[[DISK]DS-56121ce1-8991-45b3-95bc-2a5357991512:NORMAL|RBW]]} size 0\n2015-07-08 01:05:34,689 INFO BlockStateChange: BLOCK* addStoredBlock: blockMap updated: xx.xx.4.62:50010 is added to blk_3194502674_2121080184{blockUCState=UNDER_CONSTRUCTION, primaryNodeIndex=-1, replicas=[ReplicaUnderConstruction[[DISK]DS-15a4dc8e-5b7d-449f-a941-6dced45e6f07:NORMAL|RBW], ReplicaUnderConstruction[[DISK]DS-74ed264f-da43-4cc3-9fa9-164ba99f752a:NORMAL|RBW], ReplicaUnderConstruction[[DISK]DS-56121ce1-8991-45b3-95bc-2a5357991512:NORMAL|RBW]]} size 0\n2015-07-08 01:05:35,003 INFO BlockStateChange: BLOCK* ask xx.xx.4.62:50010 to replicate blk_3194502674_2121080184 to datanode(s) xx.xx.4.65:50010\n2015-07-08 01:05:35,403 INFO BlockStateChange: BLOCK* addStoredBlock: blockMap updated: xx.xx.7.73:50010 is added to blk_3194502674_2121080184 size 67750\n2015-07-08 01:05:35,833 INFO BlockStateChange: BLOCK* addStoredBlock: blockMap updated: xx.xx.4.65:50010 is added to blk_3194502674_2121080184 size 67750\n2015-07-08 01:05:35,833 INFO BlockStateChange: BLOCK* InvalidateBlocks: add blk_3194502674_2121080184 to xx.xx.7.75:50010\n2015-07-08 01:05:35,833 INFO BlockStateChange: BLOCK* chooseExcessReplicates: (xx.xx.7.75:50010, blk_3194502674_2121080184) is added to invalidated blocks set\n2015-07-08 01:05:35,852 INFO org.apache.hadoop.hdfs.StateChange: BLOCK* InvalidateBlocks: ask xx.xx.7.75:50010 to delete [blk_3194502674_2121080184, blk_3194497594_2121075104]\n{noformat}\nSome day, the number of this situation can be 400000, that is not good for the performance and waste network band.\nOur base version is hadoop 2.4 and i have checked hadoop 2.7.1 didn’t find any difference.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12752681","id":"12752681","filename":"HDFS-8763.01.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-08-27T07:21:56.379+0000","size":7776,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12752681/HDFS-8763.01.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12753638","id":"12753638","filename":"HDFS-8763.02.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-09-02T00:36:53.280+0000","size":15481,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12753638/HDFS-8763.02.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"After file closed, a race condition between IBR of 3rd replica of lastBlock and ReplicationMonitor","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiangyu1211","name":"jiangyu1211","key":"jiangyu1211","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiangyu","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiangyu1211","name":"jiangyu1211","key":"jiangyu1211","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiangyu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14624285","id":"14624285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi, [~jiangyu1211]! Are most of the files/blocks very small?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-07-13T07:01:48.229+0000","updated":"2015-07-13T07:01:48.229+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14624303","id":"14624303","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiangyu1211","name":"jiangyu1211","key":"jiangyu1211","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiangyu","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi, [~walter.k.su] , that is true, most of the blocks are very small, but i also found some blocks can be MB  in this situation. That is very dangerous when you make fail over of namenode , which excess block can not delete until  namenode think the datanodes are not stale.  I found this when i investigation this jira https://issues.apache.org/jira/browse/HDFS-6425.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiangyu1211","name":"jiangyu1211","key":"jiangyu1211","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiangyu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-07-13T07:15:01.685+0000","updated":"2015-07-13T07:15:01.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14626839","id":"14626839","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"Blocks should not be scheduled for replication, while they are UNDER_CONSTRUCTION. Could you check if that is the case. If so it is a bug.\nIf not then your DNs seem to be quite busy because of too many of small blocks.\n- You can try to increase {{dfs.namenode.replication.min}} to 2 (the default is 1). That way NN should wait for 2 replicas reported by DNs before scheduling replication.\n- Also as you know HDFS does not \"like\" small files. Where small means < 128MB. You may try to encourage your users to combine data into larger blobs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-07-14T18:41:39.915+0000","updated":"2015-07-14T18:41:39.915+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14627438","id":"14627438","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiangyu1211","name":"jiangyu1211","key":"jiangyu1211","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiangyu","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi,[~shv] ,  the situation is reporting RBW after FINALIZE. It is rare when the cluster is not big enough, but for larger cluster,  it is easy to find. I don't know the impact if we change dfs.namenode.replication.min,  i will investigate it from code and test. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiangyu1211","name":"jiangyu1211","key":"jiangyu1211","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiangyu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-07-15T02:37:24.019+0000","updated":"2015-07-15T02:37:24.019+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14627439","id":"14627439","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiangyu1211","name":"jiangyu1211","key":"jiangyu1211","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiangyu","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi,[~shv] ,  the situation is reporting RBW after FINALIZE. It is rare when the cluster is not big enough, but for larger cluster,  it is easy to find. I don't know the impact if we change dfs.namenode.replication.min,  i will investigate it from code and test. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiangyu1211","name":"jiangyu1211","key":"jiangyu1211","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiangyu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-07-15T02:37:30.457+0000","updated":"2015-07-15T02:37:30.457+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14708252","id":"14708252","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mbukowski","name":"mbukowski","key":"mbukowski","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Markus Bukowski","active":true,"timeZone":"Europe/Berlin"},"body":"Hi [~jiangyu1211] did the change of {{dfs.namenode.replication.min}} to 2 solve that for you?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mbukowski","name":"mbukowski","key":"mbukowski","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Markus Bukowski","active":true,"timeZone":"Europe/Berlin"},"created":"2015-08-23T01:24:28.329+0000","updated":"2015-08-23T01:24:28.329+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14708726","id":"14708726","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"body":"The description gives good logs but not a good reason. It's a race condition when you close the small file too early. After file closed, a race between IBR of 3rd replica and replication scheduler.\n\nYou have closed the file before x.x.7.73 node reports the 3rd finalized replica of lastBlock. So the lastBlock is scheduled to replicate. After x.x.7.73 reported the 3rd replica. The lastBlock should be removed from {{needReplications}}. But if the replication command is sent to a new DN(x.x.4.65 node). There is no way to cancel the command from x.x.4.65 node.\n\nThe solution is to postpone scheduling replication, and wait x.x.7.73 to report the 3rd replica.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-08-24T03:26:46.631+0000","updated":"2015-08-24T03:26:46.631+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14708732","id":"14708732","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"body":"Another solution is to increase {{dfs.namenode.replication.interval}} to slow down checker/scheduler.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-08-24T03:37:03.046+0000","updated":"2015-08-24T03:37:03.046+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14711052","id":"14711052","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"Change of {{dfs.namenode.replication.min}} to 3 (not 2) might solve this scenario.\n\nChanging the min replication can lead to new problems. Like safemode on restart, write failures if not enough datanodes, etc.\n\nSo better to increase the replication check interval. Thats enough,I feel.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-08-25T10:25:14.087+0000","updated":"2015-08-25T10:25:14.087+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14712355","id":"14712355","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajithshetty","name":"ajithshetty","key":"ajithshetty","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Ajith S","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi all,\n\nagree with changing {{dfs.namenode.replication.interval}}. But i somehow think this just reduces the window of such problem to happen rather than eliminate it. Because at some point of time it might happen that the replication monitor thread overlaps on close and same issue reoccurs. Please correct me if i am wrong :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajithshetty","name":"ajithshetty","key":"ajithshetty","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Ajith S","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-08-26T01:57:32.085+0000","updated":"2015-08-26T01:57:32.085+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14716216","id":"14716216","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"body":"I think so too. And [~jiangyu1211], please let me know if you think so too.\n\nUploaded a patch. Make every block in {{needReplications}} wait at least one round before it can be processed. One round costs {{dfs.namenode.replication.interval}} time ( 3s by default)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-08-27T07:37:03.330+0000","updated":"2015-08-27T07:37:03.330+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14716339","id":"14716339","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"\\\\\n\\\\\n| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:red}-1{color} | pre-patch |  15m 51s | Findbugs (version ) appears to be broken on trunk. |\n| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |\n| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 4 new or modified test files. |\n| {color:green}+1{color} | javac |   7m 51s | There were no new javac warning messages. |\n| {color:green}+1{color} | javadoc |  10m  9s | There were no new javadoc warning messages. |\n| {color:green}+1{color} | release audit |   0m 23s | The applied patch does not increase the total number of release audit warnings. |\n| {color:green}+1{color} | checkstyle |   0m 33s | There were no new checkstyle issues. |\n| {color:red}-1{color} | whitespace |   0m  0s | The patch has 1  line(s) that end in whitespace. Use git apply --whitespace=fix. |\n| {color:green}+1{color} | install |   1m 37s | mvn install still works. |\n| {color:green}+1{color} | eclipse:eclipse |   0m 33s | The patch built with eclipse:eclipse. |\n| {color:red}-1{color} | findbugs |   2m 40s | The patch appears to introduce 4 new Findbugs (version 3.0.0) warnings. |\n| {color:green}+1{color} | native |   3m 16s | Pre-build of native portion |\n| {color:red}-1{color} | hdfs tests |  67m 21s | Tests failed in hadoop-hdfs. |\n| | | 110m 17s | |\n\\\\\n\\\\\n|| Reason || Tests ||\n| FindBugs | module:hadoop-hdfs |\n| Failed unit tests | hadoop.hdfs.TestLeaseRecovery |\n| Timed out tests | org.apache.hadoop.hdfs.TestInjectionForSimulatedStorage |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Patch URL | http://issues.apache.org/jira/secure/attachment/12752681/HDFS-8763.01.patch |\n| Optional Tests | javadoc javac unit findbugs checkstyle |\n| git revision | trunk / 4cbbfa2 |\n| whitespace | https://builds.apache.org/job/PreCommit-HDFS-Build/12158/artifact/patchprocess/whitespace.txt |\n| Findbugs warnings | https://builds.apache.org/job/PreCommit-HDFS-Build/12158/artifact/patchprocess/newPatchFindbugsWarningshadoop-hdfs.html |\n| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HDFS-Build/12158/artifact/patchprocess/testrun_hadoop-hdfs.txt |\n| Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/12158/testReport/ |\n| Java | 1.7.0_55 |\n| uname | Linux asf904.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/12158/console |\n\n\nThis message was automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-08-27T09:19:47.306+0000","updated":"2015-08-27T09:19:47.306+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14724432","id":"14724432","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"Hey guys, it looks to me that this works as expected.\n- Slowing down {{needReplications}} does not solve the problem when DNs get even slower.\n- Slowing down {{needReplications}} will slow replication in regular case, when it is actually needed.\n- It was a good discussion with a few suggestions on how the condition can be remedied. But I don't see anything should be fixed here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-08-31T23:59:02.544+0000","updated":"2015-08-31T23:59:02.544+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14724484","id":"14724484","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"body":"So one question I always have is whether we need to let NameNode wait for all the block_received msgs to announce the replica is safe. Looking into the code, now we have\n# NameNode knows the DataNodes involved when initially setting up the writing pipeline\n# If any DataNode fails during the writing, client bumps the GS and finally reports all the DataNodes included in the new pipeline to NameNode through the {{updatePipeline}} RPC.\n# When the client received the ack for the last packet of the block (and before the client tries to close the file on NameNode), the replica has been finalized in all the DataNodes.\n\nThen in this case, when NameNode receives the close request from the client, the NameNode already knows the latest replicas for the block. Currently the {{checkReplication}} call only counts in all the replicas that NN has already received the block_received msg, but based on the above #2 and #3, it may be safe to also count in all the replicas in the {{BlockUnderConstructionFeature#replicas}}?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-01T00:39:58.031+0000","updated":"2015-09-01T00:40:34.749+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14725224","id":"14725224","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernhtls","name":"fernhtls","key":"fernhtls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Souza","active":true,"timeZone":"Etc/UTC"},"body":"Hi jiangyu,\n\nDid you apply the patch? What was the effect of the patch? Is the parameter for dfs.namenode.replication.min still set to a higher value like 2 or 3.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernhtls","name":"fernhtls","key":"fernhtls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Souza","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-01T11:29:02.444+0000","updated":"2015-09-01T11:29:02.444+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14725709","id":"14725709","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jnp","name":"jnp","key":"jnp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jitendra Nath Pandey","active":true,"timeZone":"Etc/UTC"},"body":"[~jingzhao] raised a very valid point that when the client closes a file it has already received acks from the datanodes for the last block, which has been finalized at the datanodes. Namenode is also aware of the datanodes in the pipeline, therefore namenode does not really need to wait for {{blockReceived}} messages and can complete the file. I think that would be a very useful optimization. Additional advantage is that datanodes can lazily send blockReceived message for newly finalized blocks and thus reduce load on datanode-namenode traffic. I think we should take this discussion to a separate jira.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jnp","name":"jnp","key":"jnp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jitendra Nath Pandey","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-01T17:13:10.531+0000","updated":"2015-09-01T17:13:10.531+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14725725","id":"14725725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jnp","name":"jnp","key":"jnp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jitendra Nath Pandey","active":true,"timeZone":"Etc/UTC"},"body":"Created HDFS-8999 to discuss the points raised by [~jingzhao].","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jnp","name":"jnp","key":"jnp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jitendra Nath Pandey","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-01T17:25:18.933+0000","updated":"2015-09-01T17:25:18.933+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14726196","id":"14726196","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"We occasionally see the same issue, but not frequent enough to be a problem (unlike other BM repl bugs).  Overall, I'm not sure artificially slowing everything down is the right solution...\n\nAt any rate, big thumbs down on linearly scanning an array of arrays when removing a block.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2015-09-01T21:11:54.359+0000","updated":"2015-09-01T21:11:54.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14726308","id":"14726308","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"A different jira for a different topic makes sense.\nShould this one be resolved then?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-01T22:17:10.007+0000","updated":"2015-09-01T22:17:10.007+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14726488","id":"14726488","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"body":"bq. We occasionally see the same issue, but not frequent enough to be a problem (unlike other BM repl bugs).\nThanks for the information. I think in a heavy-load writing situation, a tiny extra-cost saving is acceptable.\n\nbq. Overall, I'm not sure artificially slowing everything down is the right solution...\nYou're right. Sorry I mispoke. It's not a solution. I just suggest to slower ReplicationMonitor since in a heavy-load writing situation, IBR is more likely delayed, and num of replication changes quickly. 01 patch didn't mean to do that...\n\nbq. At any rate, big thumbs down on linearly scanning an array of arrays when removing a block.\nUpload 02 patch to address that.\n\nbq. A different jira for a different topic makes sense. Should this one be resolved then?\nHDFS-8999 is in discussion. I'd like to keep this open to track different issue.\n\nI'm ok to close this now or later. I'll be so glad if you could take a look at 02 patch again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=walter.k.su","name":"walter.k.su","key":"walter.k.su","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walter Su","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-09-02T00:36:53.284+0000","updated":"2015-09-02T00:36:53.284+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14726653","id":"14726653","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiangyu1211","name":"jiangyu1211","key":"jiangyu1211","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiangyu","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi [~fernhtls] I don't think it is good idea to change the parameter for dfs.namenode.replication.min to  2, it is dangerous for big cluster.\nHi [~walter.k.su] I will apply the patch to our test cluster , but there is one big question for test  that only big enough cluster with very heavy load can make these happen, i will try to simulate it asap and thank you for the explaination of the reason. \nI agree with  [~shv] that slowing down needReplications will slow replication in regular case, when it is actually needed. \nI think HDFS-8999 is good way to resolve this problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiangyu1211","name":"jiangyu1211","key":"jiangyu1211","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiangyu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-09-02T02:52:56.455+0000","updated":"2015-09-02T02:52:56.455+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14726674","id":"14726674","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiangyu1211","name":"jiangyu1211","key":"jiangyu1211","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiangyu","active":true,"timeZone":"Asia/Shanghai"},"body":"Reading HDFS-8999, I think currently, slow down needReplications maybe the solution of this problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiangyu1211","name":"jiangyu1211","key":"jiangyu1211","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiangyu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-09-02T03:19:32.915+0000","updated":"2015-09-02T03:19:32.915+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14729430","id":"14729430","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"I don't think the timing is the root cause, if correct, an artificial delay would only mask a bug.  I'm wracking my brain now to remember - I was about to fix a bug with the same symptoms early this year but higher prio items came up.  I think this is improper bookkeeping of UC blocks.  I'll see if I can find my notes or partial patch...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2015-09-03T17:27:06.770+0000","updated":"2015-09-03T17:27:06.770+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12844560/comment/14733173","id":"14733173","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"I think we can close this as a duplicate of HDFS-1172. See the overview [in this comment|https://issues.apache.org/jira/browse/HDFS-8999?focusedCommentId=14733172&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14733172]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-06T23:36:24.844+0000","updated":"2015-09-06T23:36:24.844+0000"}],"maxResults":24,"total":24,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-8763/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2h5xz:"}}