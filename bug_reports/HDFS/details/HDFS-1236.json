{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12467182","self":"https://issues.apache.org/jira/rest/api/2/issue/12467182","key":"HDFS-1236","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2010-06-17T17:40:35.369+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jun 17 17:40:35 UTC 2010","customfield_12310420":"15899","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_43007256_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-06-17T17:40:35.442+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-1236/watchers","watchCount":1,"isWatching":false},"created":"2010-06-17T05:43:48.186+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314048","id":"12314048","description":"","name":"0.20.1","archived":false,"released":true,"releaseDate":"2009-09-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-06-17T17:40:35.422+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312928","id":"12312928","name":"hdfs-client"}],"timeoriginalestimate":null,"description":"Summary:\nClient uselessly retries recoverBlock 5 times\nThe same behavior is also seen in append protocol (HDFS-1229)\n\nThe setup:\n+ # available datanodes = 4\n+ Replication factor = 2 (hence there are 2 datanodes in the pipeline)\n+ Failure type = Bad disk at datanode (not crashes)\n+ # failures = 2\n+ # disks / datanode = 1\n+ Where/when the failures happen: This is a scenario where each disk of the two datanodes in the pipeline go bad at the same time during the 2nd phase of the pipeline (the data transfer phase).\n \nDetails:\n \nIn this case, the client will call processDatanodeError\nwhich will call datanode.recoverBlock to those two datanodes.\nBut since these two datanodes have bad disks (although they're still alive),\nthen recoverBlock() will fail.\nFor this one, the client's retry logic ends when streamer is closed (close == true).\nBut before this happen, the client will retry 5 times\n(maxRecoveryErrorCount) and will fail all the time, until\nit finishes.  What is interesting is that\nduring each retry, there is a wait of 1 second in\nDataStreamer.run (i.e. dataQueue.wait(1000)).\nSo it will be a 5-second total wait before declaring it fails.\n \nThis is a different bug than HDFS-1235, where the client retries\n3 times for 6 seconds (resulting in 25 seconds wait time).\nIn this experiment, what we get for the total wait time is only\n12 seconds (not sure why it is 12). So the DFSClient quits without\ncontacting the namenode again (say to ask for a new set of\ntwo datanodes).\nSo interestingly we find another\nbug that shows client retry logic is complex and not deterministic\ndepending on where and when failures happen.\n\nThis bug was found by our Failure Testing Service framework:\nhttp://www.eecs.berkeley.edu/Pubs/TechRpts/2010/EECS-2010-98.html\nFor questions, please email us: Thanh Do (thanhdo@cs.wisc.edu) and\nHaryadi Gunawi (haryadi@eecs.berkeley.edu)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"113411","customfield_12312823":null,"summary":"Client uselessly retries recoverBlock 5 times","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thanhdo","name":"thanhdo","key":"thanhdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thanhdo&avatarId=22565","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thanhdo&avatarId=22565","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thanhdo&avatarId=22565","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thanhdo&avatarId=22565"},"displayName":"Thanh Do","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thanhdo","name":"thanhdo","key":"thanhdo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thanhdo&avatarId=22565","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thanhdo&avatarId=22565","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thanhdo&avatarId=22565","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thanhdo&avatarId=22565"},"displayName":"Thanh Do","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467182/comment/12879860","id":"12879860","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"I don't consider the retry useless - there may be transient errors preventing recovery (eg network errors). The 6 second sleep is addressed by HDFS-1054","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-06-17T17:40:35.369+0000","updated":"2010-06-17T17:40:35.369+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-1236/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0jrnr:"}}