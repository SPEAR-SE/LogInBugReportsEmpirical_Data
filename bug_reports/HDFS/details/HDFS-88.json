{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12426205","self":"https://issues.apache.org/jira/rest/api/2/issue/12426205","key":"HDFS-88","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/4","id":"4","description":"The problem is not completely described.","name":"Incomplete"},"customfield_12312322":null,"customfield_12310220":"2009-05-23T21:34:25.505+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jul 21 21:42:34 UTC 2014","customfield_12310420":"17132","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_162869131906_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-07-21T21:42:34.819+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-88/watchers","watchCount":7,"isWatching":false},"created":"2009-05-23T20:17:02.944+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12324927","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12324927","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12425640","key":"HADOOP-5859","self":"https://issues.apache.org/jira/rest/api/2/issue/12425640","fields":{"summary":"FindBugs : fix \"wait() or sleep() with locks held\" warnings in hdfs","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-07-21T21:42:34.846+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"We've seen this hang rare enough but when it happens it locks up the application.  We've seen it at least in 0.18.x and 0.19.x (we don't have much experience with 0.20.x hdfs yet).\n\nHere we're doing a sequencefile#append\n\n{code}\n\"IPC Server handler 9 on 60020\" daemon prio=10 tid=0x00007fef1c3f0400 nid=0x7470 waiting for monitor entry [0x0000000042d18000..0x0000000042d189f0]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n\tat org.apache.hadoop.dfs.DFSClient$DFSOutputStream.writeChunk(DFSClient.java:2486)\n\t- waiting to lock <0x00007fef38ecc138> (a java.util.LinkedList)\n\t- locked <0x00007fef38ecbdb8> (a org.apache.hadoop.dfs.DFSClient$DFSOutputStream)\n\tat org.apache.hadoop.fs.FSOutputSummer.writeChecksumChunk(FSOutputSummer.java:155)\n\tat org.apache.hadoop.fs.FSOutputSummer.flushBuffer(FSOutputSummer.java:132)\n\t- locked <0x00007fef38ecbdb8> (a org.apache.hadoop.dfs.DFSClient$DFSOutputStream)\n\tat org.apache.hadoop.fs.FSOutputSummer.flushBuffer(FSOutputSummer.java:121)\n\t- locked <0x00007fef38ecbdb8> (a org.apache.hadoop.dfs.DFSClient$DFSOutputStream)\n\tat org.apache.hadoop.fs.FSOutputSummer.write1(FSOutputSummer.java:112)\n\tat org.apache.hadoop.fs.FSOutputSummer.write(FSOutputSummer.java:86)\n\t- locked <0x00007fef38ecbdb8> (a org.apache.hadoop.dfs.DFSClient$DFSOutputStream)\n\tat org.apache.hadoop.fs.FSDataOutputStream$PositionCache.write(FSDataOutputStream.java:47)\n\tat java.io.DataOutputStream.write(DataOutputStream.java:107)\n\t- locked <0x00007fef38e09fc0> (a org.apache.hadoop.fs.FSDataOutputStream)\n\tat org.apache.hadoop.io.SequenceFile$Writer.append(SequenceFile.java:1016)\n\t- locked <0x00007fef38e09f30> (a org.apache.hadoop.io.SequenceFile$Writer)\n\tat org.apache.hadoop.io.SequenceFile$Writer.append(SequenceFile.java:980)\n\t- locked <0x00007fef38e09f30> (a org.apache.hadoop.io.SequenceFile$Writer)\n\tat org.apache.hadoop.hbase.regionserver.HLog.doWrite(HLog.java:461)\n\tat org.apache.hadoop.hbase.regionserver.HLog.append(HLog.java:421)\n\t- locked <0x00007fef29ad9588> (a java.lang.Integer)\n\tat org.apache.hadoop.hbase.regionserver.HRegion.update(HRegion.java:1676)\n\tat org.apache.hadoop.hbase.regionserver.HRegion.batchUpdate(HRegion.java:1439)\n\tat org.apache.hadoop.hbase.regionserver.HRegion.batchUpdate(HRegion.java:1378)\n\tat org.apache.hadoop.hbase.regionserver.HRegionServer.batchUpdates(HRegionServer.java:1184)\n\tat sun.reflect.GeneratedMethodAccessor27.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:616)\n\tat org.apache.hadoop.hbase.ipc.HbaseRPC$Server.call(HbaseRPC.java:622)\n\tat org.apache.hadoop.ipc.Server$Handler.run(Server.java:888)\n{code}\n\nThe DataStreamer that is supposed to servicing the above writeChunk is stuck here:\n\n{code}\n\"DataStreamer for file /hbase/log_72.34.249.212_1225407466779_60020/hlog.dat.1227075571390 block blk_-7436808403424765554_553837\" daemon prio=10 tid=0x0000000001c84c00 nid=0x7125 in Object.wait() [0x00000000409b3000..0x00000000409b3d70]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\tat java.lang.Object.wait(Object.java:502)\n\tat org.apache.hadoop.ipc.Client.call(Client.java:709)\n\t- locked <0x00007fef39520bb8> (a org.apache.hadoop.ipc.Client$Call)\n\tat org.apache.hadoop.ipc.RPC$Invoker.invoke(RPC.java:216)\n\tat org.apache.hadoop.dfs.$Proxy4.getProtocolVersion(Unknown Source)\n\tat org.apache.hadoop.ipc.RPC.getProxy(RPC.java:319)\n\tat org.apache.hadoop.ipc.RPC.getProxy(RPC.java:306)\n\tat org.apache.hadoop.ipc.RPC.getProxy(RPC.java:343)\n\tat org.apache.hadoop.ipc.RPC.waitForProxy(RPC.java:288)\n\tat org.apache.hadoop.dfs.DFSClient.createClientDatanodeProtocolProxy(DFSClient.java:139)\n\tat org.apache.hadoop.dfs.DFSClient$DFSOutputStream.processDatanodeError(DFSClient.java:2185)\n\tat org.apache.hadoop.dfs.DFSClient$DFSOutputStream.access$1400(DFSClient.java:1735)\n\tat org.apache.hadoop.dfs.DFSClient$DFSOutputStream$DataStreamer.run(DFSClient.java:1889)\n\t- locked <0x00007fef38ecc138> (a java.util.LinkedList)\n{code}\n\nThe writeChunk is trying to synchronize on dataQueue.\n\nDataQueue is held by DataStreamer#run which is down in processDatanodeError trying to recover a problem with a block.\n\nAnother example of the hang and some more detail can be found over in HBASE-667.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"108467","customfield_12312823":null,"summary":"Hung on hdfs: writeChunk, DFSClient.java:2126, DataStreamer socketWrite","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426205/comment/12712462","id":"12712462","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"this issue will be fixed in the trunk as part of HADOOP-5859.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-05-23T21:34:25.505+0000","updated":"2009-05-23T21:34:25.505+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426205/comment/12712590","id":"12712590","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"> this issue will be fixed in the trunk as part of HADOOP-5859.\nI meant only the locking part (processDatanodeError will not hold the dataQueue lock). However, if DataStreamer#run is \nstuck in processDatanodeError forever, eventually dataQueue will be full and writeChunk will hang.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-05-24T19:20:43.792+0000","updated":"2009-05-24T19:20:43.792+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426205/comment/14069347","id":"14069347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"body":"I'm going to close this as stale. I suspect this issue has gone away with the two fixes referenced.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"created":"2014-07-21T21:42:34.842+0000","updated":"2014-07-21T21:42:34.842+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-88/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ix5z:"}}