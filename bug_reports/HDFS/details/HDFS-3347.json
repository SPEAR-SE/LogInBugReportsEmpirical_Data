{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12553619","self":"https://issues.apache.org/jira/rest/api/2/issue/12553619","key":"HDFS-3347","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2012-05-02T13:27:16.489+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Sep 25 09:26:45 UTC 2012","customfield_12310420":"237807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_12602524539_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-09-25T09:26:45.132+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-3347/watchers","watchCount":13,"isWatching":false},"created":"2012-05-02T12:44:40.605+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12358174","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12358174","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12544475","key":"HDFS-3026","self":"https://issues.apache.org/jira/rest/api/2/issue/12544475","fields":{"summary":"HA: Handle failure during HA state transition","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-09-25T09:26:45.143+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"When i try to create a file i got a exception \n{code}\n2012-05-02 17:42:55,768 DEBUG hdfs.StateChange (NameNodeRpcServer.java:create(402)) - *DIR* NameNode.create: file /a._COPYING_ for DFSClient_NONMAPREDUCE_1515782500_1 at 10.18.40.95\n2012-05-02 17:42:55,770 DEBUG hdfs.StateChange (FSNamesystem.java:startFileInternal(1547)) - DIR* NameSystem.startFile: src=/a._COPYING_, holder=DFSClient_NONMAPREDUCE_1515782500_1, clientMachine=10.18.40.95, createParent=true, replication=1, createFlag=[CREATE, OVERWRITE]\n2012-05-02 17:42:55,778 WARN  ipc.Server (Server.java:run(1701)) - IPC Server handler 1 on 8020, call org.apache.hadoop.hdfs.protocol.ClientProtocol.create from 10.18.40.95:37973: error: java.lang.NullPointerException\njava.lang.NullPointerException\n\tat org.apache.hadoop.hdfs.server.namenode.FSEditLog.logEdit(FSEditLog.java:348)\n\tat org.apache.hadoop.hdfs.server.namenode.FSEditLog.logGenerationStamp(FSEditLog.java:755)\n\tat org.apache.hadoop.hdfs.server.namenode.FSNamesystem.nextGenerationStamp(FSNamesystem.java:4357)\n\tat org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFileInternal(FSNamesystem.java:1621)\n\tat org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFile(FSNamesystem.java:1509)\n\tat org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.create(NameNodeRpcServer.java:409)\n\tat org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.create(ClientNamenodeProtocolServerSideTranslatorPB.java:200)\n\tat org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java:42590)\n\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:428)\n\tat org.apache.hadoop.ipc.RPC$Server.call(RPC.java:905)\n\tat org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:1688)\n\tat org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:1684)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:396)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1205)\n\tat org.apache.hadoop.ipc.Server$Handler.run(Server.java:1682)\n{code}\n\nanalysing the same, will provide the details soon.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"46484","customfield_12312823":null,"summary":"NullPointerException When trying to log to editstreams","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"HDFS","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13266520","id":"13266520","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"body":"All the operation are failing after this ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-05-02T12:45:21.926+0000","updated":"2012-05-02T12:45:21.926+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13266556","id":"13266556","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"What version of Hadoop are you using?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2012-05-02T13:27:16.489+0000","updated":"2012-05-02T13:27:16.489+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13266573","id":"13266573","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"body":"I got in 3.0 trunk","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-05-02T13:58:51.948+0000","updated":"2012-05-02T13:58:51.948+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13266586","id":"13266586","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"What is dfs.namenode.name.dir or dfs.namenode.edits.dir set to? Did it exist before running namenode?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2012-05-02T14:22:38.414+0000","updated":"2012-05-02T14:22:38.414+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13266627","id":"13266627","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"More questions.\n\nDid it work for a while then exhibit this symptom?\nDo you see \"Rolling edit logs\" log message around the time the issue occurs?\nAny other exceptions or errors occurring?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2012-05-02T15:17:20.292+0000","updated":"2012-05-02T15:17:20.292+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13267248","id":"13267248","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi \n\nProblem is with transitionToActive for namenode.\n\nAnalysis:\n\nhere \n{code}\ntry {\n        editLogStream.write(op);\n      } catch (IOException ex) {\n        // All journals failed, it is handled in logSync.\n      }\n{code}\neditLogStream is found to be null !!!\n\nI got the problem is in transitionToActive of NN \n\nin\n{code}\nvoid startActiveServices() throws IOException {\n    LOG.info(\"Starting services required for active state\");\n    writeLock();\n    try {\n      FSEditLog editLog = dir.fsImage.getEditLog();\n\n      if (!editLog.isOpenForWrite()) {\n        // During startup, we're already open for write during initialization.\n        editLog.initJournalsForWrite();<-- Here IAE thrown caused the transition failure\n        .\n\t.\n\t.\n        dir.fsImage.editLog.openForWrite();<-- Here editLogStream var is initialised this is not done due to IAE \n      }\n      .\n      .\n      .\n  }\n{code}\nFSEditLog#startLogSegment() will populate the 'editLogStream' variable which will be done when NN is starting as active itself.\n\nHere editLog.initJournalsForWrite() can fail throwing \n\n{code}\njava.lang.IllegalArgumentException: No class configured for bkpr\n\tat org.apache.hadoop.hdfs.server.namenode.FSEditLog.getJournalClass(FSEditLog.java:1204)\n\tat org.apache.hadoop.hdfs.server.namenode.FSEditLog.createJournal(FSEditLog.java:1218)\n\tat org.apache.hadoop.hdfs.server.namenode.FSEditLog.initJournals(FSEditLog.java:242)\n\tat org.apache.hadoop.hdfs.server.namenode.FSEditLog.initJournalsForWrite(FSEditLog.java:210)\n\tat org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startActiveServices(FSNamesystem.java:596)\n\tat org.apache.hadoop.hdfs.server.namenode.NameNode$NameNodeHAContext.startActiveServices(NameNode.java:1246)\n\tat org.apache.hadoop.hdfs.server.namenode.ha.ActiveState.enterState(ActiveState.java:61)\n\tat org.apache.hadoop.hdfs.server.namenode.ha.HAState.setStateInternal(HAState.java:63)\n\tat org.apache.hadoop.hdfs.server.namenode.ha.StandbyState.setState(StandbyState.java:49)\n\tat org.apache.hadoop.hdfs.server.namenode.NameNode.transitionToActive(NameNode.java:1178)\n\tat org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.transitionToActive(NameNodeRpcServer.java:981)\n\tat org.apache.hadoop.ha.protocolPB.HAServiceProtocolServerSideTranslatorPB.transitionToActive(HAServiceProtocolServerSideTranslatorPB.java:80)\n\tat org.apache.hadoop.ha.proto.HAServiceProtocolProtos$HAServiceProtocolService$2.callBlockingMethod(HAServiceProtocolProtos.java:2827)\n\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:428)\n\tat org.apache.hadoop.ipc.RPC$Server.call(RPC.java:905)\n\tat org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:1688)\n\tat org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:1684)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:396)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1205)\n\tat org.apache.hadoop.ipc.Server$Handler.run(Server.java:1682)\n{code}\n\nwhich caused the init to fail ! \n\nIf I check the status of NN using the command\n./hdfs haadmin -getServiceState nn1 \nactive\n\nI got the reply as active !!!\n\n\nNow perform any write operation which will log to edits cause the NPE.\n\n\nI feel that if any transition fails due to exception it should remain in its old state (here standby)  :)\n\nPlease correct me if I am wrong\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-05-03T06:38:28.446+0000","updated":"2012-05-03T06:38:28.446+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13267266","id":"13267266","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"body":"Or is it good to remove stream when createJournal() fails for any non 'file' scheme.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-05-03T07:08:37.481+0000","updated":"2012-05-03T07:08:37.481+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13267489","id":"13267489","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"body":"Can we silently ignore from adding this stream into journal set by catching the exception so that NN can become fully active so that fix can be simple instead of reverting the state of NN back to standby.\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-05-03T15:09:35.500+0000","updated":"2012-05-03T15:09:35.500+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13267745","id":"13267745","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"The simplest thing you can do is to change HAState.setStateInternal() so that it catches Exception and revert the state before re-throwing.  Runtime exceptions such as IAE will be logged on the server-side at WARN level by RPC Server.\n\nIf we start thinking about handling exceptions and dropping streams in FSEditLog.initJournals(), the problem becomes more complex. In many places, it is assumed that FSEditLog.journalSet contains all configured edit streams, working or non-working. This can change in the future if the journal stream recovery becomes more dynamic based on something like zk-backed active journal set state storage.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2012-05-03T19:51:46.570+0000","updated":"2012-05-03T19:51:46.570+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13267755","id":"13267755","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"I agree with Kihwal. There's already another JIRA open about handling errors during state transition. IMO we should completely bail out, rather than trying to revert state -- it's too likely we're in a bizarre corner case that we haven't tested for, if we fail in the midst of a state transition.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2012-05-03T20:00:39.811+0000","updated":"2012-05-03T20:00:39.811+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13267772","id":"13267772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"bq. IMO we should completely bail out, rather than trying to revert state\n\nDo you think following is reasonable?\n\nIn HAState.setStateInternal(),\n- ServiceFailedException : revert the state while still holding the context.writelock\n- All other Throwables : bail out. \n- When bailing out, do something similar to what's done in JournalSet.mapJournalsAndReportErrors().","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2012-05-03T20:21:21.821+0000","updated":"2012-05-03T20:21:21.821+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13267844","id":"13267844","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"bq. ServiceFailedException : revert the state while still holding the context.writelock\n\nI'm worried this is easier said than done :) But in principle I like the idea.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2012-05-03T21:49:29.975+0000","updated":"2012-05-03T21:49:29.975+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13269227","id":"13269227","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi,\nI agree with kihwal lee and todd.\n\nFor any ServiceFailedException we can revert the state, and for other exception(include throwable) we can revert the state.\n\nSome doubts,\n\n1. Is there any possibility of adding this logic to failover controllers rather than including the logic in NN and increase the complexity. \n\nlike\n{code}\ntry {\n      HAServiceProtocolHelper.transitionToActive(\n          toSvc.getProxy(conf, rpcTimeoutToNewActive));\n    } catch (ServiceFailedException sfe) {\n      LOG.error(\"Unable to make \" + toSvc + \" active (\" +\n          sfe.getMessage() + \"). Failing back.\");\n      failed = true;\n      cause = sfe;\n    } catch (IOException ioe) {\n      LOG.error(\"Unable to make \" + toSvc +\n          \" active (unable to connect). Failing back.\", ioe);\n      failed = true;\n      cause = ioe;\n+    } catch (Throwable th) {\n+      LOG.error(\"Unexpected error\" + toSvc +\n+          \" Failing back.\", th);\n+      failed = true;\n+      cause = ioe;\n+    }\n\n{code}\n\n2. Can we mark the NN state as Active only when it successfully do a transition to Active similarly for Standby. \n\nThis can solve any issues since for any operation we have a state check ?\n\nThanks in advance :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amithdk","name":"amithdk","key":"amithdk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"amith","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-05-06T14:45:09.309+0000","updated":"2012-05-06T14:45:09.309+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13462489","id":"13462489","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"body":"IMO, I have following options with less code changes.\n1. Shutdown the NameNode for error during state transition.\n2. Validate all mandatory configurations before startup of the process.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-09-25T06:42:23.781+0000","updated":"2012-09-25T06:42:23.781+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13462595","id":"13462595","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"body":"Oops, Just now I saw the fix done by Aaron in HDFS-3026, So this issue will not occur again.\nClosing this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-09-25T09:25:25.546+0000","updated":"2012-09-25T09:25:25.546+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553619/comment/13462597","id":"13462597","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"body":"Already fixed in HDFS-3026,","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-09-25T09:26:45.142+0000","updated":"2012-09-25T09:26:45.142+0000"}],"maxResults":16,"total":16,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-3347/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i08bmv:"}}