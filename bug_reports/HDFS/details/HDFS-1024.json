{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12458299","self":"https://issues.apache.org/jira/rest/api/2/issue/12458299","key":"HDFS-1024","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314046","id":"12314046","description":"","name":"0.21.0","archived":false,"released":true,"releaseDate":"2010-08-23"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-03-05T22:03:15.942+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Apr 06 13:45:54 UTC 2010","customfield_12310420":"16523","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_1659685684_*|*_1_*:*_1_*:*_531867845_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-03-31T06:37:25.288+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-1024/watchers","watchCount":9,"isWatching":false},"created":"2010-03-05T21:51:31.759+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10342","value":"Incompatible change","id":"10342"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314048","id":"12314048","description":"","name":"0.20.1","archived":false,"released":true,"releaseDate":"2009-09-01"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314204","id":"12314204","description":"","name":"0.20.2","archived":false,"released":true,"releaseDate":"2010-02-16"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314814","id":"12314814","description":"","name":"0.20.3","archived":true,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314046","id":"12314046","description":"","name":"0.21.0","archived":false,"released":true,"releaseDate":"2010-08-23"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314241","id":"12314241","description":"","name":"0.22.0","archived":false,"released":true,"releaseDate":"2011-12-10"}],"issuelinks":[{"id":"12332400","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12332400","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"inwardIssue":{"id":"12466510","key":"HDFS-1194","self":"https://issues.apache.org/jira/rest/api/2/issue/12466510","fields":{"summary":"Secondary namenode fails to fetch the image from the primary","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12331344","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12331344","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12461316","key":"HDFS-1085","self":"https://issues.apache.org/jira/rest/api/2/issue/12461316","fields":{"summary":"hftp read  failing silently","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-08-24T20:52:04.462+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"The secondary namenode fails to retrieve the entire fsimage from the Namenode. It fetches a part of the fsimage but believes that it has fetched the entire fsimage file and proceeds ahead with the checkpointing. Stack traces will be attached below.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12438472","id":"12438472","filename":"HDFS-1024.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-11T03:27:58.239+0000","size":5937,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12438472/HDFS-1024.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12438567","id":"12438567","filename":"HDFS-1024.patch.1","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-12T01:26:35.094+0000","size":6547,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12438567/HDFS-1024.patch.1"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12440310","id":"12440310","filename":"HDFS-1024.patch.1-0.20.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-31T06:54:11.165+0000","size":6532,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12440310/HDFS-1024.patch.1-0.20.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"14263","customfield_12312823":null,"summary":"SecondaryNamenode fails to checkpoint because namenode fails with CancelledKeyException","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12842036","id":"12842036","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"body":"The namenode logs show the following:\n\n{code}\nWARN org.mortbay.log: Committed before 410 GetImage failed. java.nio.channels.CancelledKeyException\nat sun.nio.ch.SelectionKeyImpl.ensureValid(SelectionKeyImpl.java:55)\nat sun.nio.ch.SelectionKeyImpl.interestOps(SelectionKeyImpl.java:59)\nat org.mortbay.io.nio.SelectChannelEndPoint.updateKey(SelectChannelEndPoint.java:324)\nat org.mortbay.io.nio.SelectChannelEndPoint.blockWritable(SelectChannelEndPoint.java:278)\nat org.mortbay.jetty.AbstractGenerator$Output.blockForOutput(AbstractGenerator.java:542)\nat org.mortbay.jetty.AbstractGenerator$Output.flush(AbstractGenerator.java:569)\nat org.mortbay.jetty.HttpConnection$Output.flush(HttpConnection.java:946)\nat org.mortbay.jetty.AbstractGenerator$Output.write(AbstractGenerator.java:646)\nat org.mortbay.jetty.AbstractGenerator$Output.write(AbstractGenerator.java:577)\nat org.apache.hadoop.hdfs.server.namenode.TransferFsImage.getFileServer(TransferFsImage.java:127)\nat org.apache.hadoop.hdfs.server.namenode.GetImageServlet.doGet(GetImageServlet.java:49)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:707)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:820)\nat org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:502)\nat org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:363)\nat org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)\nat org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)\nat org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:766)\nat org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:417)\nat org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:230)\nat org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\nat org.mortbay.jetty.Server.handle(Server.java:324)\nat org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:534)\nat org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:864)\nat org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:533)\nat org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:207)\nat org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:403)\nat org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409)\nat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:522)\n{code}\n\nThe secondary namenode logs show that it believes that the fsimage is only about 2 GB. It does not detect the case that the transfer of the fsimage file was incomplete.\n\n{code}\n2010-03-03 23:33:05,598 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Downloaded file fsimage size 2337800192 bytes.\n2010-03-03 23:38:50,550 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Downloaded file edits size 254702213 bytes.\n{code}\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"created":"2010-03-05T21:53:38.571+0000","updated":"2010-03-05T21:53:38.571+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12842037","id":"12842037","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"body":"In the above case, the size of the actual fsimage was more than 8 GB. The secondary pulled in only 2.33 GB of that file. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"created":"2010-03-05T21:54:51.442+0000","updated":"2010-03-05T21:54:51.442+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12842041","id":"12842041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"body":"One proposal to fix this issue is that the CheckpointSignature returned by rollEditLogs() method should include the size of the fsimage. Then the secondaryNN can validate that the size of the fsimage file that it downloaded from the NN matches the value stored in the CheckpointSignature.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"created":"2010-03-05T21:56:09.568+0000","updated":"2010-03-05T21:56:09.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12842047","id":"12842047","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"Does the servlet not set a Content-length HTTP header? Since we're using HTTP we might as well include it there. Then the HTTP client can easily verify it without having to modify CheckpointSignature","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-03-05T22:03:15.942+0000","updated":"2010-03-05T22:03:15.942+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12843890","id":"12843890","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"body":"Since the image file can bee too long sometimes Content-Length is not set, instead it sets Transfer-Encoding: chunked\nI am setting Content-Length manually in the servlet now.\nOne thing to note here, there is a response.setContentLength(int) method, but taking int as a parameter it will not work, since many images are over 2Gb in size. So I am setting it as a general HTTP header.\n\nOn the client side once the read is over we check if the number of bytes we read is equal to advertised in the Content-Length and throw if it is not.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-11T03:27:58.298+0000","updated":"2010-03-11T03:27:58.298+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12843891","id":"12843891","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"body":"Note though, that this patch doesn't fix the underlying issue (that might as well be a jetty but of sending huge images) and only protects HDFS from corrupting the image in the case when the partial image read will be valid and will substitute the current image after secondary name node processes it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-11T03:30:51.333+0000","updated":"2010-03-11T03:30:51.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12844240","id":"12844240","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"body":"Todd, can you have a look at this patch using the approach of Content-Length header? Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-11T21:19:52.771+0000","updated":"2010-03-11T21:19:52.771+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12844274","id":"12844274","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"Hi Dmytro,\n\nA few comments:\n- in the test, rather than assertTrue(false) can you use fail(\"Did not get expected exception\")?\n- perhaps add a String constant for \"Content-Length'\n- Do we care about getFileClient() working against a server that may not provide the Content-Length header? We may want to at least fail with a better error message (instead of NPE or NFE) if the header is not present. Alternatively, we could issue a WARN and just disable this check if the header is not present.\n- The error message and the variable name \"imageName\" imply that it's always the fsImage being transferred. The same code path is used to download the edits. Perhaps best to include the URL in the exception message?\n\nThanks\n-Todd","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-03-11T23:46:20.392+0000","updated":"2010-03-11T23:46:20.392+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12844324","id":"12844324","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"body":"Please see the new patch with your comments addressed.\nIt seems like throwing an exception with a meaningful text is the way to go for a couple of reasons: you would not really run SecondaryNameNode and the NameNode of different versions (or at least you shouldn't).\nAnd with the check disabled there is a room for image corruption, which should never be the case.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-12T01:26:35.113+0000","updated":"2010-03-12T01:26:35.113+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12844327","id":"12844327","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"lgtm, thanks for those changes. should of course run this through Hudson as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-03-12T01:33:13.624+0000","updated":"2010-03-12T01:33:13.624+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12844355","id":"12844355","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12438567/HDFS-1024.patch.1\n  against trunk revision 921697.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    -1 contrib tests.  The patch failed contrib unit tests.\n\nTest results: http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/267/testReport/\nFindbugs warnings: http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/267/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nCheckstyle results: http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/267/artifact/trunk/build/test/checkstyle-errors.html\nConsole output: http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/267/console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-12T04:37:34.431+0000","updated":"2010-03-12T04:37:34.431+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12844356","id":"12844356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"body":"It seems like the failure is \nFailed to download [http://apache.osuosl.org/tomcat/tomcat-6/v6.0.18/bin/apache-tomcat-6.0.18.zip]\n\nShould I resubmit the patch so the tests can run again?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-12T04:44:49.214+0000","updated":"2010-03-12T04:44:49.214+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12844373","id":"12844373","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jghoman","name":"jghoman","key":"jghoman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jghoman&avatarId=10318","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jghoman&avatarId=10318","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jghoman&avatarId=10318","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jghoman&avatarId=10318"},"displayName":"Jakob Homan","active":true,"timeZone":"America/Los_Angeles"},"body":"Dmytro- \n No need to resubmit, this is a known issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jghoman","name":"jghoman","key":"jghoman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jghoman&avatarId=10318","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jghoman&avatarId=10318","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jghoman&avatarId=10318","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jghoman&avatarId=10318"},"displayName":"Jakob Homan","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-12T05:35:50.115+0000","updated":"2010-03-12T05:35:50.115+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12844607","id":"12844607","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"body":"+1 code looks good.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"created":"2010-03-12T18:43:34.738+0000","updated":"2010-03-12T18:43:34.738+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12846202","id":"12846202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"body":"Can anyone commit this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dms","name":"dms","key":"dms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmytro Molkov","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-16T23:30:09.277+0000","updated":"2010-03-16T23:30:09.277+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12851164","id":"12851164","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"I will commit this issue in next day or so unless objection or unless someone else beats me to it.  IMO, this issue is a blocker as it can corrupt fsimage.\n\nWe just ran into this issue except the faliure was in the transfer from 2NN to NN.  Only a partial copy was done because we ran into a CancelledKeyException.  Thereafter our fsimage is corrupt.   Subsequent 2NN copies of image all fail because they fail to read the mangled image.\n\nHere's the evidence.\n\nThis is the 2NN log from just before the CancelledKeyException.\n\n{code}\n2010-03-28 00:43:28,173 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Downloaded file fsimage size 9220979 bytes.\n2010-03-28 00:43:28,202 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Downloaded file edits size 3190207 bytes.\n2010-03-28 00:43:28,288 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: fsOwner=hadoop,hadoop\n2010-03-28 00:43:28,288 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: supergroup=supergroup\n2010-03-28 00:43:28,288 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: isPermissionEnabled=true\n2010-03-28 00:43:28,291 INFO org.apache.hadoop.hdfs.server.common.Storage: Number of files = 64126\n2010-03-28 00:43:29,016 INFO org.apache.hadoop.hdfs.server.common.Storage: Number of files under construction = 15\n2010-03-28 00:43:29,510 INFO org.apache.hadoop.hdfs.server.common.Storage: Edits file /export/hadoop/dfs/namesecondary/current/edits of size 3190207 edits # 30862 loaded in 0 seconds.\n2010-03-28 00:43:29,754 INFO org.apache.hadoop.hdfs.server.common.Storage: Image file of size 9244565 saved in 0 seconds.\n2010-03-28 00:43:29,922 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: Number of transactions: 0 Total time for transactions(ms): 0Number of transactions batched in Syncs: 0 Number of syncs: 0 SyncTimes(ms): 0\n2010-03-28 00:43:30,058 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Posted URL 10.10.20.221:50070putimage=1&port=50090&machine=10.10.20.222&token=-18:996348214:1231385509605:1269762207000:1269758607364\n2010-03-28 00:43:37,514 WARN org.mortbay.log: Committed before 410 GetImage failed. java.nio.channels.CancelledKeyException\n        at sun.nio.ch.SelectionKeyImpl.ensureValid(SelectionKeyImpl.java:55)\n        at sun.nio.ch.SelectionKeyImpl.interestOps(SelectionKeyImpl.java:59)\n        at org.mortbay.io.nio.SelectChannelEndPoint.updateKey(SelectChannelEndPoint.java:324)\n        at org.mortbay.io.nio.SelectChannelEndPoint.blockWritable(SelectChannelEndPoint.java:278)\n        at org.mortbay.jetty.AbstractGenerator$Output.blockForOutput(AbstractGenerator.java:542)\n        at org.mortbay.jetty.AbstractGenerator$Output.flush(AbstractGenerator.java:569)\n        at org.mortbay.jetty.HttpConnection$Output.flush(HttpConnection.java:946)\n        at org.mortbay.jetty.AbstractGenerator$Output.write(AbstractGenerator.java:646)\n        at org.mortbay.jetty.AbstractGenerator$Output.write(AbstractGenerator.java:577)\n        at org.apache.hadoop.hdfs.server.namenode.TransferFsImage.getFileServer(TransferFsImage.java:127)\n        at org.apache.hadoop.hdfs.server.namenode.GetImageServlet.doGet(GetImageServlet.java:49)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:707)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:820)\n        at org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:502)\n        at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:363)\n        at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)\n        at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)\n        at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:766)\n        at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:417)\n        at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:230)\n        at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\n        at org.mortbay.jetty.Server.handle(Server.java:324)\n        at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:534)\n        at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:864)\n        at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:533)\n        at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:207)\n        at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:403)\n        at org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409)\n        at org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:522)\n\n2010-03-28 00:43:37,516 ERROR org.mortbay.log: /getimage\njava.lang.IllegalStateException: Committed\n        at org.mortbay.jetty.Response.resetBuffer(Response.java:994)\n        at org.mortbay.jetty.Response.sendError(Response.java:240)\n        at org.apache.hadoop.hdfs.server.namenode.GetImageServlet.doGet(GetImageServlet.java:64)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:707)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:820)\n        at org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:502)\n        at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:363)\n        at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)\n        at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)\n        at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:766)\n        at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:417)\n        at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:230)\n        at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\n        at org.mortbay.jetty.Server.handle(Server.java:324)\n        at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:534)\n        at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:864)\n        at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:533)\n        at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:207)\n        at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:403)\n        at org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409)\n        at org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:522)\n2010-03-28 00:43:37,724 WARN org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Checkpoint done. New Image Size: 9244565\n2010-03-28 01:43:37,747 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: Number of transactions: 0 Total time for transactions(ms): 0Number of transactions batched in Syncs: 0 Number of syncs: 0 SyncTimes(ms): 0 \n2010-03-28 01:43:38,159 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Downloaded file fsimage size 4521984 bytes.\n2010-03-28 01:43:38,184 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Downloaded file edits size 2745394 bytes.\n2010-03-28 01:43:38,262 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: fsOwner=hadoop,hadoop\n2010-03-28 01:43:38,262 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: supergroup=supergroup\n2010-03-28 01:43:38,262 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: isPermissionEnabled=true\n2010-03-28 01:43:38,264 INFO org.apache.hadoop.hdfs.server.common.Storage: Number of files = 64295\n2010-03-28 01:43:38,613 ERROR org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Exception in doCheckpoint: \n2010-03-28 01:43:38,613 ERROR org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: java.io.EOFException\n        at java.io.DataInputStream.readFully(DataInputStream.java:180)\n        at java.io.DataInputStream.readLong(DataInputStream.java:399)\n        at org.apache.hadoop.hdfs.protocol.Block.readFields(Block.java:136)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImage(FSImage.java:904)\n        at org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode$CheckpointStorage.doMerge(SecondaryNameNode.java:589)\n        at org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode$CheckpointStorage.access$000(SecondaryNameNode.java:473)\n        at org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode.doMerge(SecondaryNameNode.java:350)\n        at org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode.doCheckpoint(SecondaryNameNode.java:314)\n        at org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode.run(SecondaryNameNode.java:225)\n        at java.lang.Thread.run(Thread.java:619)\n\n2010-03-28 01:48:38,622 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: Number of transactions: 0 Total time for transactions(ms): 0Number of transactions batched in Syncs: 0 Number of syncs: 0 SyncTimes(ms): 0 \n2010-03-28 01:48:38,651 INFO org.apache.hadoop.hdfs.server.common.Storage: Recovering storage directory /export/hadoop/dfs/namesecondary from failed checkpoint.\n2010-03-28 01:48:38,696 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Downloaded file fsimage size 4521984 bytes.\n2010-03-28 01:48:38,721 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Downloaded file edits size 2745394 bytes.\n2010-03-28 01:48:38,804 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: fsOwner=hadoop,hadoop\n2010-03-28 01:48:38,805 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: supergroup=supergroup\n2010-03-28 01:48:38,805 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: isPermissionEnabled=true\n2010-03-28 01:48:38,806 INFO org.apache.hadoop.hdfs.server.common.Storage: Number of files = 64295\n2010-03-28 01:48:39,173 ERROR org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Exception in doCheckpoint: \n2010-03-28 01:48:39,174 ERROR org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: java.io.EOFException\n        at java.io.DataInputStream.readFully(DataInputStream.java:180)\n        at java.io.DataInputStream.readLong(DataInputStream.java:399)\n        at org.apache.hadoop.hdfs.protocol.Block.readFields(Block.java:136)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImage(FSImage.java:904)\n        at org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode$CheckpointStorage.doMerge(SecondaryNameNode.java:589)\n        at org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode$CheckpointStorage.access$000(SecondaryNameNode.java:473)\n        at org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode.doMerge(SecondaryNameNode.java:350)\n        at org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode.doCheckpoint(SecondaryNameNode.java:314)\n        at org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode.run(SecondaryNameNode.java:225)\n        at java.lang.Thread.run(Thread.java:619)\n....\n{code}\n\nAnd so on.\n\nI don't see log of NN-side of things.  We were not running with DEBUG enabled.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-29T23:49:20.202+0000","updated":"2010-03-29T23:49:20.202+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12851477","id":"12851477","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"Marking this as a blocker since we would have lost half our hdfs only for our having a backup.  Also making this as fix for 0.20.3 hadoop.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-30T17:39:27.004+0000","updated":"2010-03-30T17:39:27.004+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12851536","id":"12851536","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clehene","name":"clehene","key":"clehene","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=clehene&avatarId=33348","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=clehene&avatarId=33348","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=clehene&avatarId=33348","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=clehene&avatarId=33348"},"displayName":"Cosmin Lehene","active":true,"timeZone":"America/Los_Angeles"},"body":"Adding effected versions","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clehene","name":"clehene","key":"clehene","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=clehene&avatarId=33348","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=clehene&avatarId=33348","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=clehene&avatarId=33348","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=clehene&avatarId=33348"},"displayName":"Cosmin Lehene","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-30T19:46:30.149+0000","updated":"2010-03-30T19:46:30.149+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12851619","id":"12851619","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"body":"+1 code looks good.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"created":"2010-03-30T21:38:54.886+0000","updated":"2010-03-30T21:38:54.886+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12851744","id":"12851744","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"body":"I committed this for trunk. Thanks Dmytro!\n\nIf we need this for 0.20 branch, can somebody pl upload a patch for the 0.20 branch as well?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"created":"2010-03-31T06:37:25.244+0000","updated":"2010-03-31T06:37:25.244+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12851747","id":"12851747","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"A patch for 0.20.\n\nThere doesn't seem to be any reason why 0.20 doesn't have the same issue (and so in 0.20 the 2NN could hand back half an fsimage).\n\nTesting the patch now.  Will reporrt if all passes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-31T06:54:11.241+0000","updated":"2010-03-31T06:54:11.241+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12852238","id":"12852238","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"All tests pass but the expected (?) fail of: \"org.apache.hadoop.streaming.TestStreamingExitStatus\"\n\nI'd like to commit to 0.20 branch.  Do we have to run a vote or is evidence of corruption of fsimage enough of a reason?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-04-01T03:50:57.738+0000","updated":"2010-04-01T03:50:57.738+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12852245","id":"12852245","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"Not sure if we need a vote, but I do think we should put it in the branch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-04-01T04:33:48.416+0000","updated":"2010-04-01T04:33:48.416+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12852246","id":"12852246","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"body":"I am going to commit it to 0.20 branch now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"created":"2010-04-01T04:47:28.443+0000","updated":"2010-04-01T04:47:28.443+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12852292","id":"12852292","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"body":"This is actually an incompatible change. So, I have not yet checked it in. If you run a SecondaryNameNode with this patch against a NameNode that does not have this patch, then checkpointing will fail.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"created":"2010-04-01T08:53:24.507+0000","updated":"2010-04-01T08:53:24.507+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12852371","id":"12852371","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"Well spotted Dhruba.\n\nSo, the scenario is an updated 2NN but NN has not been updated (or vice-versa)?  My guess would be that the incidence of NNs not being updated in tandem is low to zero.  If this is true, would a release note to the effect that both NNs must be updated together be patch enough to cover the low incidence of encounters of this incompatible change?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-04-01T13:13:26.281+0000","updated":"2010-04-01T13:13:26.281+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12852712","id":"12852712","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"body":"Stack, I agree with your observation. Can you pl run a vote in the hdfs-dev@ list, just for the records?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"created":"2010-04-02T05:12:11.753+0000","updated":"2010-04-02T05:12:11.753+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12853582","id":"12853582","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Hdfs-trunk-Commit #229 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk-Commit/229/])\n    ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-05T22:50:05.503+0000","updated":"2010-04-05T22:50:05.503+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12853670","id":"12853670","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hdfs-Patch-h2.grid.sp2.yahoo.net #146 (See [http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/146/])\n    ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-06T01:19:21.821+0000","updated":"2010-04-06T01:19:21.821+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12853772","id":"12853772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"I ran vote up on hdfs-dev as per Dhruba suggestion: http://www.mail-archive.com/hdfs-dev@hadoop.apache.org/msg00930.html.  Vote passed with +7 votes.  I just committed HDFS-1024.patch.1-0.20.txt to branch-0.20.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-04-06T06:15:58.294+0000","updated":"2010-04-06T06:15:58.294+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12853877","id":"12853877","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hdfs-Patch-h5.grid.sp2.yahoo.net #302 (See [http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/302/])\n    ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-06T10:48:16.912+0000","updated":"2010-04-06T10:48:16.912+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458299/comment/12853970","id":"12853970","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Hdfs-trunk #275 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk/275/])\n    ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-06T13:45:54.763+0000","updated":"2010-04-06T13:45:54.763+0000"}],"maxResults":32,"total":32,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-1024/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i02srz:"}}