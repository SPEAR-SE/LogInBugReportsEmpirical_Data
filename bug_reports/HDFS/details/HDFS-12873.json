{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13121797","self":"https://issues.apache.org/jira/rest/api/2/issue/13121797","key":"HDFS-12873","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-11-30T15:42:49.829+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Nov 30 21:22:16 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-12873/watchers","watchCount":4,"isWatching":false},"created":"2017-11-30T01:12:34.893+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329057","id":"12329057","description":"2.8.0 release","name":"2.8.0","archived":false,"released":true,"releaseDate":"2017-03-22"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-11-30T22:53:30.571+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12329603","id":"12329603","name":"hdfs"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"Start with a fresh deployment of HDFS.\r\n\r\n1. Mkdirs '/x/y/z'\r\n2. use GetFileInfo to get y's inode number\r\n3. Mkdirs '/.reserved/.inodes/<y's inode number>/z/../foo'\r\n\r\nExpectation: The path in step 3 is rejected as invalid (exception thrown) OR foo would be created under y.\r\nObservation: This created a directory called '..' under z and 'foo' under that '..' directory instead of consolidating the path to '/x/y/foo' or throwing an exception. GetListing on '/.reserved/.inodes/<z's inode number>' shows '..', while GetListing on '/x/y' does not.\r\n\r\nMkdirs INotify events were reported with the following paths, in order:\r\n/x\r\n/x/y\r\n/x/y/z\r\n/x/y/z/..\r\n/x/y/z/../foo\r\n\r\nI can also chain these dotdot directories and make them as deep as I want. Mkdirs works with the following paths appended to the inode path for directory y: '/z/../../../foo', '/z/../../../../../', '/z/../../../foo/bar/../..' etc, and it constructs all the '..' directories as if they weren't special names.\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Creating a '..' directory is possible using inode paths","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raemarks","name":"raemarks","key":"raemarks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rae Marks","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raemarks","name":"raemarks","key":"raemarks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rae Marks","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Apache NameNode running in a Docker container on a Fedora 25 workstation.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13121797/comment/16272829","id":"16272829","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shahrs87","name":"shahrs87","key":"shahrs87","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rushabh S Shah","active":true,"timeZone":"Etc/UTC"},"body":"I wrote a samp\r\n{noformat}\r\n    Configuration conf = new Configuration();\r\n    FileSystem fileSystem = FileSystem.get(conf);\r\n    DistributedFileSystem dfsFileSystem = (DistributedFileSystem)fileSystem;\r\n    DFSClient client = dfsFileSystem.getClient();\r\n    String fileName = \"/user/rushabhs/benchmarks/\";\r\n    HdfsFileStatus status = client.getFileInfo(fileName);\r\n    Path mkdirPath = new Path(\"/.reserved/.inodes/\"+ status.getFileId() + \"/TestDFSIO/../test2\");\r\n    dfsFileSystem.mkdirs(mkdirPath, new FsPermission(\"777\"));\r\n{noformat}\r\nIt did create {{test2}} directory underneath {{/user/rushabhs/benchmarks/}}.\r\nI ran the same test via fsshell also. It worked as expected.\r\n[~raemarks]: I am running some version of 2.8.2 release which shouldn't be that different from 2.8.0\r\nCan you confirm that you are seeing this in {{2.8.0}} and if possible can you share your program/script.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shahrs87","name":"shahrs87","key":"shahrs87","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rushabh S Shah","active":true,"timeZone":"Etc/UTC"},"created":"2017-11-30T15:42:49.829+0000","updated":"2017-11-30T15:42:49.829+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13121797/comment/16273122","id":"16273122","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raemarks","name":"raemarks","key":"raemarks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rae Marks","active":true,"timeZone":"Etc/UTC"},"body":"[~shahrs87] By it worked as expected, do you mean it compressed the path to {{/user/rushabhs/benchmarks/test2}}, or threw an exception? I can confirm I'm seeing this in {{2.8.0}}:\r\n\r\n{code}\r\n# hadoop version\r\nHadoop 2.8.0\r\n{code}\r\n\r\nI am using a snakebite-like hadoop client. It does not perform any client-side path manipulation/validation - it relies on the NameNode to properly handle/report unsupported path formats. Here is my script:\r\n\r\n{code}\r\n >> client = pydoofus.namenode.v9.Client('172.18.0.2', 8020, auth={'effective_user': 'hdfs'})\r\n>> print client.mkdirs('/x/y/z', 0777, create_parent=True)\r\nTrue\r\n>> file_status = client.get_file_info('/x/y')\r\n>> print file_status\r\nFileStatus {\r\n    file_type: DIRECTORY\r\n    path: \r\n    length: 0\r\n    permission: \r\n    Permission {\r\n        mode: 0777\r\n    }\r\n    owner: hdfs\r\n    group: supergroup\r\n    modification_time: 1512066397076\r\n    access_time: 0\r\n    symlink: \r\n    replication: 0\r\n    block_size: 0\r\n    locations: None\r\n    file_id: 16580\r\n    num_children: 1\r\n}\r\n>> bad_path = '/.reserved/.inodes/' + str(file_status.file_id) + '/z/../foo'\r\n>> print client.mkdirs(bad_path, 0777, create_parent=True)\r\nTrue\r\n>> print client.get_listing('/x/y/z')\r\nDirectoryListing {\r\n    entries: [FileStatus(file_type='DIRECTORY', path=u'..', length=0L, permission=Permission(mode=0777), owner=u'hdfs', group=u'supergroup', modification_time=1512066397083, access_time=0, symlink='', replication=0, block_size=0L, locations=None, file_id=16582L, num_children=1)]\r\n    remaining: 0\r\n}\r\n>> print client.get_listing('/x/y/z/..')\r\nDirectoryListing {\r\n    entries: [FileStatus(file_type='DIRECTORY', path=u'foo', length=0L, permission=Permission(mode=0777), owner=u'hdfs', group=u'supergroup', modification_time=1512066397083, access_time=0, symlink='', replication=0, block_size=0L, locations=None, file_id=16583L, num_children=0)]\r\n    remaining: 0\r\n}\r\n{code}\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raemarks","name":"raemarks","key":"raemarks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rae Marks","active":true,"timeZone":"Etc/UTC"},"created":"2017-11-30T18:29:36.412+0000","updated":"2017-11-30T18:33:08.690+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13121797/comment/16273353","id":"16273353","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raemarks","name":"raemarks","key":"raemarks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rae Marks","active":true,"timeZone":"Etc/UTC"},"body":"Interestingly, this is not reproducible with WebHDFS if WebHDFS is used to make that bad path:\r\n\r\n{code}\r\nrmarks@rmarks-wkstn ~> curl -sS -L -w '%{http_code}' -X PUT 'http://172.18.0.2:50070/webhdfs/v1/x/y/z?op=MKDIRS&user.name=hdfs'\r\n{\"boolean\":true}200⏎                                                                                                                                                                                                                                                                     \r\n \r\nrmarks@rmarks-wkstn ~> curl -sS -L -w '%{http_code}' 'http://172.18.0.2:50070/webhdfs/v1/x/y?op=GETFILESTATUS'\r\n{\"FileStatus\":{\"accessTime\":0,\"blockSize\":0,\"childrenNum\":1,\"fileId\":16587,\"group\":\"supergroup\",\"length\":0,\"modificationTime\":1512068214198,\"owner\":\"hdfs\",\"pathSuffix\":\"\",\"permission\":\"755\",\"replication\":0,\"storagePolicy\":0,\"type\":\"DIRECTORY\"}}200⏎                                  \r\n\r\nrmarks@rmarks-wkstn ~> curl -sS -L -w '%{http_code}' -X PUT 'http://172.18.0.2:50070/webhdfs/v1/.reserved/.inodes/16587/z/../foo?op=MKDIRS&user.name=hdfs'\r\n{\"boolean\":true}200⏎\r\n                                                                                                                                                                                                                                                                      \r\nrmarks@rmarks-wkstn ~> curl -sS -L -w '%{http_code}' 'http://172.18.0.2:50070/webhdfs/v1/x/y/z?op=LISTSTATUS'\r\n{\"FileStatuses\":{\"FileStatus\":[]}}200⏎                                                                                                                                                                                                                                                                                      \r\n\r\nrmarks@rmarks-wkstn ~> curl -sS -L -w '%{http_code}' 'http://172.18.0.2:50070/webhdfs/v1/x/y?op=LISTSTATUS'\r\n{\"FileStatuses\":{\"FileStatus\":[\r\n{\"accessTime\":0,\"blockSize\":0,\"childrenNum\":0,\"fileId\":16589,\"group\":\"supergroup\",\"length\":0,\"modificationTime\":1512068246054,\"owner\":\"hdfs\",\"pathSuffix\":\"foo\",\"permission\":\"755\",\"replication\":0,\"storagePolicy\":0,\"type\":\"DIRECTORY\"},\r\n{\"accessTime\":0,\"blockSize\":0,\"childrenNum\":0,\"fileId\":16588,\"group\":\"supergroup\",\"length\":0,\"modificationTime\":1512068214198,\"owner\":\"hdfs\",\"pathSuffix\":\"z\",\"permission\":\"755\",\"replication\":0,\"storagePolicy\":0,\"type\":\"DIRECTORY\"}\r\n]}}200⏎    \r\n{code}\r\n\r\nHowever, if I run the problematic {{Mkdirs}} with our snakebite-like client then try to list with WebHDFS, the problem is once again exposed:\r\n{code}\r\nrmarks@rmarks-wkstn ~> curl -sS -L -w '%{http_code}' 'http://172.18.0.2:50070/webhdfs/v1/x/y?op=LISTSTATUS'\r\n{\"FileStatuses\":{\"FileStatus\":[\r\n{\"accessTime\":0,\"blockSize\":0,\"childrenNum\":1,\"fileId\":16592,\"group\":\"supergroup\",\"length\":0,\"modificationTime\":1512073040206,\"owner\":\"hdfs\",\"pathSuffix\":\"z\",\"permission\":\"777\",\"replication\":0,\"storagePolicy\":0,\"type\":\"DIRECTORY\"}\r\n]}}200⏎ \r\n\r\nrmarks@rmarks-wkstn ~> curl -sS -L -w '%{http_code}' 'http://172.18.0.2:50070/webhdfs/v1/x/y/z?op=LISTSTATUS'\r\n{\"FileStatuses\":{\"FileStatus\":[\r\n{\"accessTime\":0,\"blockSize\":0,\"childrenNum\":1,\"fileId\":16593,\"group\":\"supergroup\",\"length\":0,\"modificationTime\":1512073040207,\"owner\":\"hdfs\",\"pathSuffix\":\"..\",\"permission\":\"777\",\"replication\":0,\"storagePolicy\":0,\"type\":\"DIRECTORY\"}\r\n]}}200⏎    \r\n\r\nrmarks@rmarks-wkstn ~> curl -sS -L -w '%{http_code}' 'http://172.18.0.2:50070/webhdfs/v1/x/y/z/..?op=LISTSTATUS'\r\n{\"FileStatuses\":{\"FileStatus\":[\r\n{\"accessTime\":0,\"blockSize\":0,\"childrenNum\":1,\"fileId\":16592,\"group\":\"supergroup\",\"length\":0,\"modificationTime\":1512073040206,\"owner\":\"hdfs\",\"pathSuffix\":\"z\",\"permission\":\"777\",\"replication\":0,\"storagePolicy\":0,\"type\":\"DIRECTORY\"}\r\n]}}200⏎       \r\n\r\nrmarks@rmarks-wkstn ~> curl -sS -L -w '%{http_code}' 'http://172.18.0.2:50070/webhdfs/v1/x/y/z/../foo?op=GETFILESTATUS'\r\n{\"RemoteException\":{\"exception\":\"FileNotFoundException\",\"javaClassName\":\"java.io.FileNotFoundException\",\"message\":\"File does not exist: /x/y/foo\"}}404⏎   \r\n\r\nrmarks@rmarks-wkstn ~> curl -sS -L -w '%{http_code}' 'http://172.18.0.2:50070/webhdfs/v1/.reserved/.inodes/16593?op=LISTSTATUS'\r\n{\"FileStatuses\":{\"FileStatus\":[\r\n{\"accessTime\":0,\"blockSize\":0,\"childrenNum\":0,\"fileId\":16594,\"group\":\"supergroup\",\"length\":0,\"modificationTime\":1512073040207,\"owner\":\"hdfs\",\"pathSuffix\":\"foo\",\"permission\":\"777\",\"replication\":0,\"storagePolicy\":0,\"type\":\"DIRECTORY\"}\r\n]}}200⏎   \r\n{code}\r\n\r\nThis shows there is no {{foo}} under {{y}}, {{..}} is visible under {{z}}, and {{foo}} is inaccessible except by using an inode path to access {{/x/y/z/..}}.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raemarks","name":"raemarks","key":"raemarks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rae Marks","active":true,"timeZone":"Etc/UTC"},"created":"2017-11-30T20:24:44.340+0000","updated":"2017-11-30T20:24:44.340+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13121797/comment/16273384","id":"16273384","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shahrs87","name":"shahrs87","key":"shahrs87","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rushabh S Shah","active":true,"timeZone":"Etc/UTC"},"body":"bq. By it worked as expected, do you mean it compressed the path to /user/rushabhs/benchmarks/test2, or threw an exception?\r\nBy worked as expected, I meant it created {{/user/rushabhs/benchmarks/test2}} directory.\r\nBut the normalization of {{..}} was done on the dfs client side.\r\nSince you are not doing any client validation, namenode is handling the raw path.\r\nHDFS-5104 added the support to handle {{..}} in the path but exactly at 4th index {{/.reserved/.inodes/<inodeid>/../}} (split by /)\r\nPre HDFS-5104, if the path contains {{..}} when it reaches namenode, it threw {{InvalidPathException}}\r\nBut this patch introduced a bug where {{..}} can slip through.\r\n\r\n{code:title=FsDirectory.java|borderStyle=solid}\r\n\r\nbyte[][] org.apache.hadoop.hdfs.server.namenode.FSDirectory.resolveDotInodesPath(byte[][] pathComponents, FSDirectory fsd) throws FileNotFoundException\r\n...\r\n...\r\n    // Handle single \"..\" for NFS lookup support.\r\n    if ((pathComponents.length > 4)\r\n        && Arrays.equals(pathComponents[4], DOT_DOT)) {\r\n      INode parent = inode.getParent();\r\n      if (parent == null || parent.getId() == INodeId.ROOT_INODE_ID) {\r\n        // inode is root, or its parent is root.\r\n        return new byte[][]{INodeDirectory.ROOT_NAME};\r\n      }\r\n      return parent.getPathComponents();\r\n    }\r\n{code}\r\n\r\nAccording to above code snippet from HDFS-5104, it looks like that jira just expected to have {{..}}  at the 4th index of the path.\r\nSo the fix should be in {{DFSUtilClient#isValidName}} to throw {{InvalidPathException}} if {{..}} is present and not at the 4th index.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shahrs87","name":"shahrs87","key":"shahrs87","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rushabh S Shah","active":true,"timeZone":"Etc/UTC"},"created":"2017-11-30T20:41:35.187+0000","updated":"2017-11-30T20:41:35.187+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13121797/comment/16273394","id":"16273394","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shahrs87","name":"shahrs87","key":"shahrs87","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rushabh S Shah","active":true,"timeZone":"Etc/UTC"},"body":"[~brandonli], [~sureshms]: is the patch from {{HDFS-5104}} just expected to handle {{..}} _only_ at 4th index  if we split the path name by {{/}} ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shahrs87","name":"shahrs87","key":"shahrs87","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rushabh S Shah","active":true,"timeZone":"Etc/UTC"},"created":"2017-11-30T20:49:51.459+0000","updated":"2017-11-30T20:49:51.459+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13121797/comment/16273406","id":"16273406","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raemarks","name":"raemarks","key":"raemarks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rae Marks","active":true,"timeZone":"Etc/UTC"},"body":"I've been poking this code a lot lately and it seems to only support the {{..}} if it's directly after the inode number, so yes only at the 4th index. If there is {{..}} after the 4th index and the 4th index is not {{..}}, it fails. Also, the NameNode appears to silently throw away any path components following {{/.reserved/.inodes/<inode number>/..}} instead of failing, which could be misleading. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raemarks","name":"raemarks","key":"raemarks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rae Marks","active":true,"timeZone":"Etc/UTC"},"created":"2017-11-30T20:58:42.773+0000","updated":"2017-11-30T20:58:42.773+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13121797/comment/16273412","id":"16273412","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shahrs87","name":"shahrs87","key":"shahrs87","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rushabh S Shah","active":true,"timeZone":"Etc/UTC"},"body":"bq.  If there is .. after the 4th index and the 4th index is not .., it fails. \r\nI don't understand what do you mean by it fails ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shahrs87","name":"shahrs87","key":"shahrs87","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rushabh S Shah","active":true,"timeZone":"Etc/UTC"},"created":"2017-11-30T21:02:36.087+0000","updated":"2017-11-30T21:02:36.087+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13121797/comment/16273470","id":"16273470","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raemarks","name":"raemarks","key":"raemarks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rae Marks","active":true,"timeZone":"Etc/UTC"},"body":"Oops, not very descriptive of me. I meant if you try to get the file status of a file using a path containing {{..}} after the 4th index, but I was recalling something different and was incorrect. Please disregard that comment. \r\n\r\nWhat I mentioned about ignoring anything after the {{..}} in the 4th index is true though. For example, getFileStatus on {{'/.reserved/.inodes/<y's inode number>/../I/don't/exist}} would return y's parent's info ({{x}}) - it just throws away {{I/don't/exist}}.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raemarks","name":"raemarks","key":"raemarks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rae Marks","active":true,"timeZone":"Etc/UTC"},"created":"2017-11-30T21:22:16.714+0000","updated":"2017-11-30T22:53:30.561+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-12873/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3nd87:"}}