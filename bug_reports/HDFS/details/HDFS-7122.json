{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12743278","self":"https://issues.apache.org/jira/rest/api/2/issue/12743278","key":"HDFS-7122","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327181","id":"12327181","description":"2.6.0 release","name":"2.6.0","archived":false,"released":true,"releaseDate":"2014-11-18"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-09-22T19:41:28.500+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Oct 01 19:50:36 UTC 2014","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_12825903_*|*_1_*:*_1_*:*_604492848_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-09-29T21:54:19.994+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7122/watchers","watchCount":16,"isWatching":false},"created":"2014-09-22T18:25:41.300+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":["performance"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325255","id":"12325255","description":"2.3.0 release","name":"2.3.0","archived":false,"released":true,"releaseDate":"2014-02-20"}],"issuelinks":[{"id":"12397947","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12397947","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12744749","key":"HADOOP-11152","self":"https://issues.apache.org/jira/rest/api/2/issue/12744749","fields":{"summary":"Better random number generator","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-02-02T23:55:22.629+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"Summary:\nSince HDFS-6268, the distribution of replica block copies across the DataNodes (replicas 2,3,... as distinguished from the first \"primary\" replica) is extremely poor, to the point that TeraGen slows down by as much as 3X for certain configurations.  This is almost certainly due to the introduction of Thread Local Random in HDFS-6268.  The mechanism appears to be that this change causes all the random numbers in the threads to be correlated, thus preventing a truly random choice of DN for each replica copy.\n\nTesting details:\n1 TB TeraGen on 638 slave nodes (virtual machines on 32 physical hosts), 256MB block size.  This results in 6 \"primary\" blocks on each DN.  With replication=3, there will be on average 12 more copies on each DN that are copies of blocks from other DNs.  Because of the random selection of DNs, exactly 12 copies are not expected, but I found that about 160 DNs (1/4 of all DNs!) received absolutely no copies, while one DN received over 100 copies, and the elapsed time increased by about 3X from a pre-HDFS-6268 distro.  There was no pattern to which DNs didn't receive copies, nor was the set of such DNs repeatable run-to-run. In addition to the performance problem, there could be capacity problems due to one or a few DNs running out of space. Testing was done on CDH 5.0.0 (before) and CDH 5.1.2 (after), but I don't see a significant difference from the Apache Hadoop source in this regard. The workaround to recover the previous behavior is to set dfs.namenode.handler.count=1 but of course this has scaling implications for large clusters.\n\nI recommend that the ThreadLocal Random part of HDFS-6268 be reverted until a better algorithm can be implemented and tested.  Testing should include a case with many DNs and a small number of blocks on each.\n\nIt should also be noted that even pre-HDFS-6268, the random choice of DN algorithm produces a rather non-uniform distribution of copies.  This is not due to any bug, but purely a case of random distributions being much less uniform than one might intuitively expect. In the above case, pre-HDFS-6268 yields something like a range of 3 to 25 block copies on each DN. Surprisingly, the performance penalty of this non-uniformity is not as big as might be expected (maybe only 10-20%), but HDFS should do better, and in any case the capacity issue remains.  Round-robin choice of DN?  Better awareness of which DNs currently store fewer blocks? It's not sufficient that the total number of blocks is similar on each DN at the end, but that at each point in time no individual DN receives a disproportionate number of blocks at once (which could be a danger of a RR algorithm).\n\nProbably should limit this jira to tracking the ThreadLocal issue, and track the random choice issue in another one.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327181","id":"12327181","description":"2.6.0 release","name":"2.6.0","archived":false,"released":true,"releaseDate":"2014-11-18"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12671532","id":"12671532","filename":"copies_per_slave.jpg","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcb","name":"jcb","key":"jcb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Buell","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-26T20:25:12.427+0000","size":75247,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12671532/copies_per_slave.jpg"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12671824","id":"12671824","filename":"hdfs-7122.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-29T17:15:05.051+0000","size":2040,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12671824/hdfs-7122.001.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12671567","id":"12671567","filename":"hdfs-7122-cdh5.1.2-testing.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-26T22:12:47.680+0000","size":4702,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12671567/hdfs-7122-cdh5.1.2-testing.001.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Use of ThreadLocal<Random> results in poor block placement","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcb","name":"jcb","key":"jcb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Buell","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcb","name":"jcb","key":"jcb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Buell","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"medium-large environments with 100's to 1000's of DNs will be most affected, but potentially all environments.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14143682","id":"14143682","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hey Jeff, thanks for reporting this. I agree that the skew you're seeing here is definitely abnormal even for random load balancing. I'm surprised the thread local Randoms are colliding like this since they're supposed to be initialized with unique seeds, but I'll look into this further and get back to you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-22T19:41:28.500+0000","updated":"2014-09-22T19:41:28.500+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14144103","id":"14144103","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"I poked around with a unit test and was unable to reproduce skew that was quite this extreme. I'll admit that the workaround of only using one handler definitely does point at the thread-local Random being the issue, but since I'm unable to repro, it's going to be hard to test a fix.\n\nJeff, a couple questions for you in the meantime:\n\n- Were you using the default block placement policy, or WithNodeGroup? I noticed you said you were using VMs.\n- What JDK version were you using? I looked in JDK7u40's source, and it looks like the bare Random() constructor generates a unique seed in a thread-safe manner.\n- What was your handler count before you changed it to 1?\n- Is it possible you can test WIP work on your setup if I'm still unable to repro?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-23T00:25:08.386+0000","updated":"2014-09-23T00:25:08.386+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14144123","id":"14144123","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"Another q, how was your rack topology set up? I'd like to mirror as much as possible in my unit test to try for that repro.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-23T00:46:32.548+0000","updated":"2014-09-23T00:46:32.548+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14144141","id":"14144141","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcb","name":"jcb","key":"jcb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Buell","active":true,"timeZone":"America/Los_Angeles"},"body":"I mainly use WithNodeGroup, but I did one test without it for the same reason you're thinking of, by setting the topology to host=rack (places the 2nd and 3rd replicas in different VMs on one host).  This didn't make any difference.  What does make a difference is the number of slave nodes.  It might be hard to see the skew if you have only a small number of DNs. Virtualization makes scale-out tests much easier! (Containers could also be used.)\n7u55\nhandler count was 20.\nIf you can build me a tarball with the MR1 stuff in it, I'll test it.  I should have mentioned I'm using MR1, could that make a difference?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcb","name":"jcb","key":"jcb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Buell","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-23T01:00:41.577+0000","updated":"2014-09-23T01:00:41.577+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14144149","id":"14144149","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcb","name":"jcb","key":"jcb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Buell","active":true,"timeZone":"America/Los_Angeles"},"body":"One physical rack, but I'm using HVE to create multiple \"virtual racks\", that is arbitrarily assigning groups of hosts to different racks.  I've tried splitting the 32 hosts into 2 racks and 16 racks.  I'm using the latter now since it gave me a more uniform distribution, but for testing we should use the minimum number of racks to enhance the non-uniformity.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcb","name":"jcb","key":"jcb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Buell","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-23T01:05:19.793+0000","updated":"2014-09-23T01:05:19.793+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14145800","id":"14145800","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"This is definitely a blocker of 2.6.  How about reverting HDFS-6268, given its bad design?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-24T02:48:40.115+0000","updated":"2014-09-24T02:48:40.115+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14145808","id":"14145808","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"I agree this is something we should fix for 2.6. I'm working actively with Jeff on this one, so I think we can get it done in time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-24T02:58:37.891+0000","updated":"2014-09-24T02:58:37.891+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14145858","id":"14145858","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Nicholas, I think we don't need to revert HDFS-6268 immediately :) Agree with Andrew that we have time to prove and fix this.\n\nMost of code in HDFS-6268 is to improve the sorting by distance, and the only related modification about this issue is changing _static random_ to _ThreadLocal random_ which improves performance a bit. But I don't see it will affect the randomness, and it's self-seed as Andrew seed. But of course the {{java.util.Random}} is not good enough for randomness (poor entropy), we can use better random generation approach (i.e. SecureRandom) if we can prove it's the root cause.\n\n[~jcb], could you help to reproduce it couple of times? Want to know whether the blocks distributions are always so bad. If so, then we can retry using a non _ThreadLocal random_ and {{SecureRandom}} and see the result. If the blocks distributions are not always so bad, I suspect the issue existed even before HDFS-6268, so we should use better random generation approach or find a new way to solve the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-09-24T04:20:23.858+0000","updated":"2014-09-24T04:20:23.858+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14145982","id":"14145982","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcb","name":"jcb","key":"jcb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Buell","active":true,"timeZone":"America/Los_Angeles"},"body":" Yi, yes I ran it many times tweaking various things to try to get a good distribution.  Although there was some variation, it was always much worse than before.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcb","name":"jcb","key":"jcb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Buell","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-24T06:36:59.870+0000","updated":"2014-09-24T06:36:59.870+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14146009","id":"14146009","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~hitliuyi], one problem is that we are not yet sure how to fix the bug. Why not reverting HDFS-6268 and redo it in a right way?  Reverting a patch is not a big deal.  It is a quick and effective way to fix a newly introduced bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-24T07:27:32.192+0000","updated":"2014-09-24T07:27:32.192+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14146064","id":"14146064","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Agree with your point for reverting it, thanks [~szetszwo]. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-09-24T08:37:56.782+0000","updated":"2014-09-24T08:37:56.782+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14146079","id":"14146079","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Actually before [~jcb] confirms the blocks distributions are always bad, I have concern if the issue existed and was random even before HDFS-6268 since {{java.util.Random}} is not good enough. \nNow agree to revert it since it seems an issue after HDFS-6268 and we fix it later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-09-24T08:50:26.608+0000","updated":"2014-09-24T08:50:26.608+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14146596","id":"14146596","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"Can we hold off on the revert for now? There are a couple other JIRAs layered on top of HDFS-6268 right now, and as I said above, I'm working on this pretty actively and I think we can get it done by 2.6.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-24T17:47:33.054+0000","updated":"2014-09-24T17:47:33.054+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14146615","id":"14146615","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"[~andrew.wang], my preference is to revert the patch and commit the patch back with all the required fixes. But I will leave it up to you (reluctantly), if you think this can be fixed in a couple of days.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-24T17:59:19.791+0000","updated":"2014-09-24T17:59:19.791+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14148590","id":"14148590","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"It does not seem to have much activity on fixing this bug.  How about we set a deadline, say by the end of Friday 9/26, so that  we will revert  HDFS-6268 if this remains unfixed?  Even if HDFS-6268 is reverted, we could keep fixing the bug.  It still has a chance to get in again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-26T01:21:51.219+0000","updated":"2014-09-26T01:21:51.219+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14148620","id":"14148620","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"Not all of the progress has been reported to this JIRA. I've brainstormed some with ATM and Todd, and I have a few ideas for patches that Jeff can try out. I'm going to coordinate with him one-on-one since I think he probably wants a patched CDH jar for easier testing, but I'll post any meaningful updates here too.\n\nTomorrow is a rather quick deadline. I think Arun said he was pushing back cutting the branch until next week, could we wait until then? I'm okay with reverting this stuff since the original fix isn't that a big deal, but it's easier for the code to move forwards, and the important date really seems to be resolving this before we release 2.6.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-26T02:07:36.622+0000","updated":"2014-09-26T02:07:36.622+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14148701","id":"14148701","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"[~andrew.wang], the HDFS-6268 patch committed was not carefully designed.  It changed something seemingly minor but had a big adverse impact.  That's a reason to revert such bad patch.\n\nAlso, we does not seem to have a clear way to fix the bug up to now.  Why not reverting it for fixing Apache trunk?\n\nI understand that you are probably much care about fixing CDH than Apache trunk.  You probably work with your colleagues in Cloudera more closely than Apache open source.  However, Apache trunk is very important for many people.  There are other contributors following the JIRA.  We should respect them.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-26T03:54:20.023+0000","updated":"2014-09-26T03:54:20.023+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14148796","id":"14148796","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"Nicholas, if this patch is so obviously not carefully designed, could you please point out the issue? It'd save me debugging time and we could get this resolved very quickly then. Much appreciated.\n\nAlso, Jeff found this while testing with CDH, he reported it upstream, and the fix is going to be posted to this JIRA as soon as we figure it out. What exactly is the issue here? I see no lack of respect on my part. If anyone else in the community is interested in helping fix this bug, they are more than welcome.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-26T05:25:22.183+0000","updated":"2014-09-26T05:25:22.183+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14149926","id":"14149926","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcb","name":"jcb","key":"jcb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Buell","active":true,"timeZone":"America/Los_Angeles"},"body":"I reproduced the issue on a 31-slave physical cluster, without HVE/Nodegroups.  300 GB data set, 256 MB block size, which yields 1364 primary blocks and 2728 replica copies.  So there should be 44 primary blocks and 88 copies per slave.  See the attached file copies_per_slave.jpg for the actual distribution of copies.  Effect of dfs.namenode.handler.count=20 is not as severe as with 638 slaves, but still very significant.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcb","name":"jcb","key":"jcb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Buell","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-26T20:23:14.398+0000","updated":"2014-09-26T20:23:14.398+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14150089","id":"14150089","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"So the community is kept in the loop, I just gave Jeff a patched version of CDH5.1.2 with two new options to play with. A patch for CDH5.1.2 is attached. It's not intended for commit.\n\nOption 1 tries using a ThreadLocalRandom rather than a ThreadLocal<Random>.\n\nOption 2 uses a single Random.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-26T22:12:47.686+0000","updated":"2014-09-26T22:12:47.686+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14151058","id":"14151058","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"> Nicholas, if this patch is so obviously not carefully designed, could you please point out the issue? It'd save me debugging time and we could get this resolved very quickly then. Much appreciated.\n\n[~andrew.wang], I did not say that the bug introduced by HDFS-6268 was easy to fix.  I might be wrong -- It did seem that the author of the patch might not have the domain knowledge on the problem he tried to fix so that the bug got committed unconsciously.\n\nIndeed, the bug seems hard to fix.  We still do not have a clear direction on fixing it.  It is also going to take some time on testing the potential fixes. These are the reasons we should first revert the HDFS-6268 patch and then redo it.\n\n> ... What exactly is the issue here? I see no lack of respect on my part. If anyone else in the community is interested in helping fix this bug, they are more than welcome.\n\nThis is a blocker bug.  There are other people watching on the bug.  You claimed that you would fix it but you seemed not care about posting a patch or discussing the solution here previously.  How could the others to help fixing the bug if they want to?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-28T09:36:14.544+0000","updated":"2014-09-28T09:36:14.544+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14151912","id":"14151912","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks to Jeff's testing with the prelim patch, we were able to identify the ThreadLocal<Random> as the source of the issue. Using JDK7's ThreadLocalRandom (as in the prelim patch) still had the same issue.\n\nThis patch for trunk changes us back to a single static Random instance. This is how it was pre-HDFS-6268, so there shouldn't be a Random perf regression compared to that.\n\nReviews appreciated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-29T17:15:05.058+0000","updated":"2014-09-29T17:15:05.058+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14151998","id":"14151998","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"body":"Looks like a straight-forward revert of the ThreadLocal random portion of HDFS-6268. +1 pending jenkins.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-29T18:20:13.155+0000","updated":"2014-09-29T18:20:13.155+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14152052","id":"14152052","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"body":"Created HADOOP-11152 to track the investigation of a better RNG.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-29T18:49:57.746+0000","updated":"2014-09-29T18:49:57.746+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14152333","id":"14152333","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12671824/hdfs-7122.001.patch\n  against trunk revision 9e985e6.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:red}-1 javadoc{color}.  The javadoc tool appears to have generated 12 warning messages.\n        See https://builds.apache.org/job/PreCommit-HDFS-Build/8253//artifact/patchprocess/diffJavadocWarnings.txt for details.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:red}-1 findbugs{color}.  The patch appears to introduce 1 new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.crypto.random.TestOsSecureRandom\n                  org.apache.hadoop.hdfs.TestEncryptionZonesWithKMS\n                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover\n\n                                      The following test timeouts occurred in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:\n\norg.apache.hadoop.hdfs.server.namenode.TestCheckpoint\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/8253//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-HDFS-Build/8253//artifact/patchprocess/newPatchFindbugsWarningshadoop-hdfs.html\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/8253//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-29T21:35:50.248+0000","updated":"2014-09-29T21:35:50.248+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14152353","id":"14152353","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"The javadoc warnings look unrelated. The patchprocess file is empty. Findbugs also look unrelated. The tests are also long-standing flakies due to the open FD issue on the build slaves. No new tests, as the existing tests cover this functionality.\n\nThanks for reviewing Luke, I'll commit this shortly based on your +1.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-29T21:47:17.539+0000","updated":"2014-09-29T21:47:17.539+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14152359","id":"14152359","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"I've committed the fix to trunk and branch-2. Thanks again Luke for reviewing, I think the discussion on HADOOP-11152 is also going in interesting directions.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-29T21:54:20.033+0000","updated":"2014-09-29T21:54:20.033+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14152374","id":"14152374","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-trunk-Commit #6147 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/6147/])\nHDFS-7122. Use of ThreadLocal<Random> results in poor block placement. (wang) (wang: rev c6c3247dc0dcb8c72ea00f3fb14a0879fcf49c56)\n* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/net/NetworkTopology.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-29T22:03:34.695+0000","updated":"2014-09-29T22:03:34.695+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14153089","id":"14153089","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Yarn-trunk #696 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/696/])\nHDFS-7122. Use of ThreadLocal<Random> results in poor block placement. (wang) (wang: rev c6c3247dc0dcb8c72ea00f3fb14a0879fcf49c56)\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/net/NetworkTopology.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-30T11:37:40.934+0000","updated":"2014-09-30T11:37:40.934+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14153203","id":"14153203","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hadoop-Hdfs-trunk #1887 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1887/])\nHDFS-7122. Use of ThreadLocal<Random> results in poor block placement. (wang) (wang: rev c6c3247dc0dcb8c72ea00f3fb14a0879fcf49c56)\n* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/net/NetworkTopology.java\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-30T14:16:22.141+0000","updated":"2014-09-30T14:16:22.141+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14153260","id":"14153260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Mapreduce-trunk #1912 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1912/])\nHDFS-7122. Use of ThreadLocal<Random> results in poor block placement. (wang) (wang: rev c6c3247dc0dcb8c72ea00f3fb14a0879fcf49c56)\n* hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/net/NetworkTopology.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-30T15:10:52.566+0000","updated":"2014-09-30T15:10:52.566+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14153684","id":"14153684","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"bq. I might be wrong – It did seem that the author of the patch might not have the domain knowledge on the problem he tried to fix so that the bug got committed unconsciously.\n\nThe original patch was also reviewed for several weeks and given a +1 by Aaron, who has been working full time on HDFS for several years. I also discussed the design with Andrew offline (though I apologize for not commenting on the JIRA). So, we had around 10 man-years of experience looking at the patch or its design and we still missed the bug. I wouldn't say that \"domain expertise\" was the issue there. Rather, it was a simple mistake which was quickly addressed after being discovered.\n\nbq. I understand that you are probably much care about fixing CDH than Apache trunk. You probably work with your colleagues in Cloudera more closely than Apache open source. However, Apache trunk is very important for many people. There are other contributors following the JIRA. We should respect them.\n\nNicholas -- speaking of respect, could you please refrain from ad hominem attacks like this in the JIRA?\n\nThe data seems to show that Andrew works quite a bit with open source. In fact, he is the number one most prolific committer to Hadoop in the last 6 months, and the number two most prolific in the past year (#1 if you only count HDFS). I don't think dragging unsubstantiated attacks on the open source commitment level of different vendors is productive in the context of a bug fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2014-09-30T20:11:48.531+0000","updated":"2014-09-30T20:11:48.531+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14155248","id":"14155248","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"{quote}\nThe original patch was also reviewed for several weeks and given a +1 by Aaron, who has been working full time on HDFS for several years. I also discussed the design with Andrew offline (though I apologize for not commenting on the JIRA). So, we had around 10 man-years of experience looking at the patch or its design and we still missed the bug. I wouldn't say that \"domain expertise\" was the issue there. Rather, it was a simple mistake which was quickly addressed after being discovered.\n{quote}\nI am surprise that you are measuring the HDFS man-years and adding them up!  Do you think if it makes sense for 3 four-grade students to claim that they all together is equivalent to a twelve-grade student?\n\nI agree that it is a simple mistake (i.e. not a complicated one).  However, I do not understand why we did not revert the original patch but committed another patch for reverting the code.\n\nPlease do post on JIRA if you have comments.  Otherwise, it is hard for other people to work with you.  Thanks.\n\n{quote}\nNicholas – speaking of respect, could you please refrain from ad hominem attacks like this in the JIRA?\n{quote}\nI was responding to Andrew's earlier comments about he working on CDH with people in Cloudera but not working on Apache trunk with Apache open source community.  I am not sure why you have such interpretation.\n\n{quote}\nThe data seems to show that Andrew works quite a bit with open source. In fact, he is the number one most prolific committer to Hadoop in the last 6 months, and the number two most prolific in the past year (#1 if you only count HDFS). I don't think dragging unsubstantiated attacks on the open source commitment level of different vendors is productive in the context of a bug fix.\n{quote}\n\nThe man-years of experience counted earlier includes Andrew, Aaron and Todd.  The so called \"most prolific in last 6 months\" measurement includes only Andrew.  Is it suggesting that, for Andrew alone, the number of man-years is very small and, for Andrew, Aaron and Todd, the \"most prolific in last 6 months\" measurement is not quite good?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-01T18:25:18.054+0000","updated":"2014-10-01T18:32:33.628+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12743278/comment/14155371","id":"14155371","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"I think the fact that the problem has been identified and we have solved it is all that matters. Only suggestion I would make is to make the discussion public on the jira so that others who are not privy to it have the background.\n\nI think [~andrew.wang], [~szetszwo], and [~tlipcon], if there are anything that need to be sorted out, please take it up in an email. We have all collaborated on HDFS for a long time. Continuing this conversation in the jira does not add much to the issue we are discussing. If you guys want to meet for a beer, it is on me :)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-01T19:50:36.979+0000","updated":"2014-10-01T19:58:09.091+0000"}],"maxResults":34,"total":34,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7122/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i20cn3:"}}