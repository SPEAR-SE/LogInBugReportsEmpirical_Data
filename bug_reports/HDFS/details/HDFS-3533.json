{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12560456","self":"https://issues.apache.org/jira/rest/api/2/issue/12560456","key":"HDFS-3533","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2012-06-16T03:22:58.053+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jan 18 14:20:15 UTC 2013","customfield_12310420":"257173","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-3533/watchers","watchCount":11,"isWatching":false},"created":"2012-06-13T08:05:34.401+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316150","id":"12316150","description":"","name":"0.20.203.0","archived":false,"released":true,"releaseDate":"2011-05-11"}],"issuelinks":[{"id":"12363240","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12363240","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12626881","key":"HDFS-4380","self":"https://issues.apache.org/jira/rest/api/2/issue/12626881","fields":{"summary":"Opening a file for read before writer writes a block causes NPE","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-01-18T14:20:15.869+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312928","id":"12312928","name":"hdfs-client"}],"timeoriginalestimate":null,"description":"I'm seeing the following NPE:\n\njava.lang.NullPointerException\n        at\norg.apache.hadoop.hdfs.DFSClient$DFSInputStream.openInfo(DFSClient.java:1633)\n        at\norg.apache.hadoop.hdfs.DFSClient$DFSInputStream.<init>(DFSClient.java:1593)\n        at org.apache.hadoop.hdfs.DFSClient.open(DFSClient.java:428)\n        at\norg.apache.hadoop.hdfs.DistributedFileSystem.open(DistributedFileSystem.java:187)\n        at org.apache.hadoop.fs.FileSystem.open(FileSystem.java:456)\n\n\nHere, the file gets opened while it's being written.   ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12532834","id":"12532834","filename":"cannot-seek-after-eof-dn-logs.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-06-21T06:24:40.448+0000","size":3714,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12532834/cannot-seek-after-eof-dn-logs.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12532833","id":"12532833","filename":"cannot-seek-after-eof-nn-logs.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-06-21T06:24:40.438+0000","size":3055,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12532833/cannot-seek-after-eof-nn-logs.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12532829","id":"12532829","filename":"nn-logs-npe.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-06-21T05:56:53.886+0000","size":4454,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12532829/nn-logs-npe.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12532830","id":"12532830","filename":"npe-dn-logs.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-06-21T05:56:53.917+0000","size":5163,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12532830/npe-dn-logs.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"114237","customfield_12312823":null,"summary":"NPE in DFSClient$DFSInputStream.openInfo","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12560456/comment/13296083","id":"13296083","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awesomenix","name":"awesomenix","key":"awesomenix","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nishchay","active":true,"timeZone":"America/Los_Angeles"},"body":"The stack trace doesn't seem to match with the source http://svn.apache.org/viewvc/hadoop/common/tags/release-0.20.203.0/src/hdfs/org/apache/hadoop/hdfs/DFSClient.java?view=markup, is the hadoop version correct?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awesomenix","name":"awesomenix","key":"awesomenix","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nishchay","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-06-16T03:22:58.053+0000","updated":"2012-06-16T03:22:58.053+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12560456/comment/13393669","id":"13393669","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"Seems the code is in branch-20-append branch - http://svn.apache.org/repos/asf/hadoop/common/branches/branch-0.20-append/src/hdfs/org/apache/hadoop/hdfs/DFSClient.java .  Can somebody confirm whether it is fixed in later branches?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-06-18T05:27:14.832+0000","updated":"2012-06-18T05:27:14.832+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12560456/comment/13396191","id":"13396191","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"I think this still persists in 1.x -- it looks like it could happen with the following race:\n\n- client gets block locations for an over-replicated block, where the NN has enqueued a command to one DN to delete its extra replica\n- the command reaches the DN and it deletes the block\n- the client issues primary.getBlockInfo(...) but the block doesn't exist, so it returns null\n- client gets NPE\n\nThis might also happen if the block's genstamp is changing (perhaps when reading a file under construction where the pipeline has just been recovered?)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2012-06-18T19:52:10.226+0000","updated":"2012-06-18T19:52:10.226+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12560456/comment/13398187","id":"13398187","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks Todd for the inputs. Will look into DN logs and update the issue.\n\nElaborating more on the usecase : The file is getting flushed every second on the producer. There is consumer tailing the file every 5 seconds. Below is the code snippet of the consumer:\n{noformat}\n\n{ \n  FSDataInputStream inStream;\n  BufferedReader reader;\n  long currentOffset = 0;\n\n  while (true) {\n    if (reader != null) reader.close();\n    if (inStream != null) inStream.close();\n\n    inStream = fs.open(mypath);\n    reader = new BufferedReader(new InputStreamReader(in));\n    inStream.seek(currentOffset);\n\n\n    while (true) {\n      line = reader.readLine();\n\n      if (line == null) {\n        Thread.sleep(5000);\n        break;\n      } else {\n        currentOffset = inStream.getPos();\n        .....\n      }\n    }\n  }\n}\n{noformat}\n\nWe are hitting NPE in our production cluster atmost once every one hour, where the file produced is of size 100-150MB per minute. File could be opened properly after retry.\n\nWe are also hitting the following Exception more often than NPE (5 times in one hour):\n{noformat}\njava.io.IOException: Cannot seek after EOF\n        at\norg.apache.hadoop.hdfs.DFSClient$DFSInputStream.seek(DFSClient.java:2149)\n        at\norg.apache.hadoop.fs.FSDataInputStream.seek(FSDataInputStream.java:37)\n{noformat}\n\nSeeking also works properly after retry. \n\nThe second exception looks like another race. If they are not related, I can raise another issue for the second exception.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-06-21T04:49:43.680+0000","updated":"2012-06-21T04:49:43.680+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12560456/comment/13398218","id":"13398218","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"I see that there is a delete block command for one the blocks.\nAttaching the logs of Namenode and datanode","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-06-21T05:56:53.983+0000","updated":"2012-06-21T05:56:53.983+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12560456/comment/13398224","id":"13398224","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"I see new generationtimestamp for the block, which got Cannot seek after EOF exception.\n\nAttaching both nn and dn logs for the same.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-06-21T06:24:40.503+0000","updated":"2012-06-21T06:24:40.503+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12560456/comment/13398227","id":"13398227","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"For all the above cases dfs.block.size is 64MB.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-06-21T06:29:52.472+0000","updated":"2012-06-21T06:29:52.472+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12560456/comment/13402171","id":"13402171","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awesomenix","name":"awesomenix","key":"awesomenix","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nishchay","active":true,"timeZone":"America/Los_Angeles"},"body":"Todd is right, looks like the DFSClient gets the first node from the list of available locations\n\n DatanodeInfo primaryNode = last.getLocations()[0];\n\nthen it would work on the primaryNode, but there is a chance that the block might have been deleted from the node due to over replication as already mentioned by Todd and also confirmed due to logs. This can happen only when the file is still under construction not for already present files. One way to fix would be to loop through all the nodes to get the correct block. This code seems to be changed in 3.0, Please give your inputs on how to proceed to fix this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awesomenix","name":"awesomenix","key":"awesomenix","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nishchay","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-06-27T12:13:29.001+0000","updated":"2012-06-27T12:13:29.001+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12560456/comment/13556016","id":"13556016","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cruppstahl","name":"cruppstahl","key":"cruppstahl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Rupp","active":true,"timeZone":"Europe/Berlin"},"body":"I am running into the same issue. My current workaround is to retry opening the file, after a retry it usually works. Sometimes i have to retry multiple times (up to 4 was the maximum so far.)\n\n{code:title=Pseudocode.java|borderStyle=solid}\nvoid Open(Path path) {\n  DFSDataInputStream in;\n  try {\n     in = (DFSClient.DFSDataInputStream)mFilesystem.open(path);\n  }\n  catch (NullPointerException e) {\n    // wait for a while\n    Thread.sleep(1000);\n    // call recursively\n    Open(path);\n    return;\n  }\n  // ...\n}\n{code}\n\nMy application is very similar to the one described by Amareshwari; i have a producer and a consumer, both are usually on different datanodes. Every 5 seconds the consumer tries to continue reading the new data.\n\nMy question: is this a viable workaround? Do i need the sleep()? Is there a better/faster way to refresh the node list?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cruppstahl","name":"cruppstahl","key":"cruppstahl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Rupp","active":true,"timeZone":"Europe/Berlin"},"created":"2013-01-17T09:43:05.009+0000","updated":"2013-01-17T09:43:05.009+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12560456/comment/13557236","id":"13557236","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cruppstahl","name":"cruppstahl","key":"cruppstahl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Rupp","active":true,"timeZone":"Europe/Berlin"},"body":"A note for everyone else who runs into this issue: the Thread.sleep(1000) is necessary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cruppstahl","name":"cruppstahl","key":"cruppstahl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Rupp","active":true,"timeZone":"Europe/Berlin"},"created":"2013-01-18T14:20:15.869+0000","updated":"2013-01-18T14:20:15.869+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-3533/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0jwrb:"}}