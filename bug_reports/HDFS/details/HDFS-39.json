{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12401447","self":"https://issues.apache.org/jira/rest/api/2/issue/12401447","key":"HDFS-39","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2008-12-17T23:42:24.243+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 19 22:49:33 UTC 2014","customfield_12310420":"16889","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_177725168331_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-03-19T22:49:33.870+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-39/watchers","watchCount":3,"isWatching":false},"created":"2008-07-31T22:43:25.586+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-03-19T22:49:33.910+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Here are related logs.  dn_10_251_107_213 deleted the block immediately after it received it (because of over-replication).  However, the information is not reported to namenode and name node ask this DN to invalidate the block again, causing the error \"Unexpected error trying to delete block blk_-1201258788540100829. BlockInfo not found in volumeMap.\". \n\n\ndn_10_251_107_213 | 080722 145554 2497 INFO dfs.DataNode$DataXceiver: Receiving block blk_-1201258788540100829 src: /10.251.67.214:54770 dest: /10.251.67.214:50010\ndn_10_251_193_205 | 080722 145554 2468 INFO dfs.DataNode$DataXceiver: Receiving block blk_-1201258788540100829 src: /10.251.107.213:36718 dest: /10.251.107.213:50010\ndn_10_251_67_214 | 080722 145554 2306 INFO dfs.DataNode$DataXceiver: Receiving block blk_-1201258788540100829 src: /10.251.67.214:60599 dest: /10.251.67.214:50010\nnn_10_251_210_161 | 080722 145554 30 INFO dfs.FSNamesystem: BLOCK* NameSystem.allocateBlock: /user/root/rand/_temporary/_task_200807221347_0001_m_000092_1/part-00092. blk_-1201258788540100829\ndn_10_251_107_213 | 080722 145656 2498 INFO dfs.DataNode$PacketResponder: Received block blk_-1201258788540100829 of size 29767698 from /10.251.67.214\ndn_10_251_193_205 | 080722 145656 2469 INFO dfs.DataNode$PacketResponder: Received block blk_-1201258788540100829 of size 29767698 from /10.251.107.213\ndn_10_251_67_214 | 080722 145656 2307 INFO dfs.DataNode$PacketResponder: Received block blk_-1201258788540100829 of size 29767698 from /10.251.67.214\ndn_10_251_107_213 | 080722 145656 2498 INFO dfs.DataNode$PacketResponder: PacketResponder 1 for block blk_-1201258788540100829 terminating\ndn_10_251_193_205 | 080722 145656 2469 INFO dfs.DataNode$PacketResponder: PacketResponder 0 for block blk_-1201258788540100829 terminating\ndn_10_251_67_214 | 080722 145656 2307 INFO dfs.DataNode$PacketResponder: PacketResponder 2 for block blk_-1201258788540100829 terminating\nnn_10_251_210_161 | 080722 145656 19 INFO dfs.FSNamesystem: BLOCK* ask 10.251.67.214:50010 to replicate blk_-1201258788540100829 to datanode(s) 10.251.107.49:50010\nnn_10_251_210_161 | 080722 145656 31 INFO dfs.FSNamesystem: BLOCK* NameSystem.addStoredBlock: blockMap updated: 10.251.67.214:50010 is added to blk_-1201258788540100829 size 29767698\nnn_10_251_210_161 | 080722 145656 31 INFO dfs.FSNamesystem: BLOCK* NameSystem.addStoredBlock: blockMap updated: 10.251.107.213:50010 is added to blk_-1201258788540100829 size 29767698\nnn_10_251_210_161 | 080722 145656 26 INFO dfs.FSNamesystem: BLOCK* NameSystem.addStoredBlock: blockMap updated: 10.251.193.205:50010 is added to blk_-1201258788540100829 size 29767698\ndn_10_251_107_49 | 080722 145658 2484 INFO dfs.DataNode$DataXceiver: Receiving block blk_-1201258788540100829 src: /10.251.67.214:42237 dest: /10.251.67.214:50010\ndn_10_251_67_214 | 080722 145658 18 INFO dfs.DataNode: 10.251.67.214:50010 Starting thread to transfer block blk_-1201258788540100829 to 10.251.107.49:50010\ndn_10_251_107_49 | 080722 145705 2484 INFO dfs.DataNode$DataXceiver: Received block blk_-1201258788540100829 src: /10.251.67.214:42237 dest: /10.251.67.214:50010 of size 29767698\ndn_10_251_67_214 | 080722 145705 2342 INFO dfs.DataNode$DataTransfer: 10.251.67.214:50010:Transmitted block blk_-1201258788540100829 to /10.251.107.49:50010\nnn_10_251_210_161 | 080722 145705 34 INFO dfs.FSNamesystem: BLOCK* NameSystem.addStoredBlock: blockMap updated: 10.251.107.49:50010 is added to blk_-1201258788540100829 size 29767698\ndn_10_251_107_213 | 080722 145710 19 INFO dfs.FSDataset: Deleting block blk_-1201258788540100829 file /mnt/hadoop/dfs/data/current/subdir11/blk_-1201258788540100829\nnn_10_251_210_161 | 080722 150220 34 INFO dfs.FSNamesystem: BLOCK* NameSystem.delete: blk_-1201258788540100829 is added to invalidSet of 10.251.67.214:50010\nnn_10_251_210_161 | 080722 150220 34 INFO dfs.FSNamesystem: BLOCK* NameSystem.delete: blk_-1201258788540100829 is added to invalidSet of 10.251.107.213:50010\nnn_10_251_210_161 | 080722 150220 34 INFO dfs.FSNamesystem: BLOCK* NameSystem.delete: blk_-1201258788540100829 is added to invalidSet of 10.251.193.205:50010\nnn_10_251_210_161 | 080722 150220 34 INFO dfs.FSNamesystem: BLOCK* NameSystem.delete: blk_-1201258788540100829 is added to invalidSet of 10.251.107.49:50010\ndn_10_251_193_205 | 080722 150224 19 INFO dfs.FSDataset: Deleting block blk_-1201258788540100829 file /mnt/hadoop/dfs/data/current/subdir51/blk_-1201258788540100829\ndn_10_251_107_49 | 080722 150226 19 INFO dfs.FSDataset: Deleting block blk_-1201258788540100829 file /mnt/hadoop/dfs/data/current/subdir24/blk_-1201258788540100829\ndn_10_251_107_213 | 080722 150228 19 WARN dfs.FSDataset: Unexpected error trying to delete block blk_-1201258788540100829. BlockInfo not found in volumeMap.\ndn_10_251_67_214 | 080722 150253 18 INFO dfs.FSDataset: Deleting block blk_-1201258788540100829 file /mnt/hadoop/dfs/data/current/subdir43/blk_-1201258788540100829","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"107987","customfield_12312823":null,"summary":"Namenode blockMap not updated when datanode invalidates a block on heart beat","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dradra","name":"dradra","key":"dradra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wei Xu","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dradra","name":"dradra","key":"dradra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Wei Xu","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401447/comment/12657617","id":"12657617","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"The first deletion at 251_107_213 is recorded at ExcessReplicateMap. So it does not count as a valid replica. NN still keeps it in blocksMap since NN has not received confirmation from the datanode yet.\n\nWere the following four deletions caused by the deletion of the file? When deleting a file, NN deletes all replicas belonged to this file no matter if they are already scheduled to delete or not. I think this is a safe solution since NN has not heard any confirmation yet so NN is not sure if the replicas are indeed deleted or not.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-17T23:42:24.243+0000","updated":"2008-12-17T23:42:24.243+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401447/comment/12657622","id":"12657622","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"All I meant to say is that what's described in this jira is the expected behavior of dfs. It does not cause any data lose except for some harmless deletion warnings at datanodes. One improvement we could do is to make the deletion confirmation back to NN sooner. Currently it waits for the next block report to send the confirmation back. But in between a block deletion is scheduled to remove and the deletion confirmation comes back, the reported issue is likely to happen.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-17T23:53:06.605+0000","updated":"2008-12-17T23:53:06.605+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401447/comment/12657637","id":"12657637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"One more note: excluding excessive replicas when counting live replicas are fixed at HADOOP-4643. If nobody against it, I will mark this issue as \"not fixed\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-18T00:37:58.444+0000","updated":"2008-12-18T00:37:58.444+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401447/comment/13033815","id":"13033815","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"body":"Hairong,\n\nIf this is fixed by HADOOP-4643, can it be marked closed, or is it still a possible issue for those logs?\n\nI'm not sure what the last message of yours meant by \"not fixed\". Perhaps it was \"now fixed\"?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"created":"2011-05-15T20:49:30.841+0000","updated":"2011-05-15T20:49:30.841+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401447/comment/13941107","id":"13941107","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Anyway, this issue is \"Not A Problem\" anymore.  Resolving ...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-19T22:49:33.900+0000","updated":"2014-03-19T22:49:33.900+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-39/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0iu7b:"}}