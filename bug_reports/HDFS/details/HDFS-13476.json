{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13153429","self":"https://issues.apache.org/jira/rest/api/2/issue/13153429","key":"HDFS-13476","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-04-18T18:26:54.615+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Apr 18 20:36:21 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-13476/watchers","watchCount":2,"isWatching":false},"created":"2018-04-18T18:13:32.533+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334863","id":"12334863","description":"2.7.4 release","name":"2.7.4","archived":false,"released":true,"releaseDate":"2017-08-04"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-04-18T20:38:31.399+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312927","id":"12312927","name":"datanode"}],"timeoriginalestimate":null,"description":"We have a security software runs on local file system(ext4), and the security software denies some particular users to access some {color:#333333}particular {color}HDFS folders based on security policy. For example, the security policy always gives the user hdfs full permission, and denies the user yarn to access /dir1.  If the user yarn tries to access a file under HDFS folder {color:#333333}/dir1{color}, the security software denies the access and returns EACCES from file system call through errno. This used to work because the data corruption was determined by block scanner([https://blog.cloudera.com/blog/2016/12/hdfs-datanode-scanners-and-disk-checker-explained/).]\r\n\r\nOn HDP 2.7.3.2.6.4.0-91, HDFS reports a lot data corruptions because of the security policy to deny file access in HDFS from local file system. We debugged HDFS and found out BlockSender() directly calls the following statements and may cause the problem:\r\n\r\ndatanode.notifyNamenodeDeletedBlock(block, replica.getStorageUuid());\r\n datanode.data.invalidate(block.getBlockPoolId(), new Block[]\\{block.getLocalBlock()});\r\n\r\nIn the mean time, the block scanner is not triggered because of the undocumented property {color:#333333}dfs.datanode.disk.check.min.gap. However the problem is still there if we disable dfs.datanode.disk.check.min.gap{color} by setting it to 0. . ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"HDFS (Hadoop/HDP 2.7.3.2.6.4.0-91) reports CORRUPT files","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fxu_36%40hotmail.com","name":"fxu_36@hotmail.com","key":"fxu_36@hotmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"feng xu","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fxu_36%40hotmail.com","name":"fxu_36@hotmail.com","key":"fxu_36@hotmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"feng xu","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13153429/comment/16442998","id":"16442998","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"Looks issue similar to HDFS-11711.\r\n\r\nso you are getting the FileNotFoundException..?\r\n\r\nCan you please attach the trace also..? hope HDP-2.7.3 will be same as hadoop-2.7.3.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2018-04-18T18:26:54.615+0000","updated":"2018-04-18T18:26:54.615+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13153429/comment/16443023","id":"16443023","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fxu_36%40hotmail.com","name":"fxu_36@hotmail.com","key":"fxu_36@hotmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"feng xu","active":true,"timeZone":"Etc/UTC"},"body":"2018-04-18 12:40:48,466 ERROR datanode.DataNode (DataXceiver.java:run(278)) - 4381-fxu-centos7:50010:DataXceiver error processing READ_BLOCK operation src: /10.3.43.81:51424 dst: /10.3.43.81:50010\r\njava.io.FileNotFoundException: BlockId 1073741896 is not valid.\r\n at org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsDatasetImpl.getBlockFile(FsDatasetImpl.java:739)\r\n at org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsDatasetImpl.getBlockFile(FsDatasetImpl.java:730)\r\n at org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.FsDatasetImpl.getMetaDataInputStream(FsDatasetImpl.java:232)\r\n at org.apache.hadoop.hdfs.server.datanode.BlockSender.<init>(BlockSender.java:299)\r\n at org.apache.hadoop.hdfs.server.datanode.DataXceiver.readBlock(DataXceiver.java:547)\r\n at org.apache.hadoop.hdfs.protocol.datatransfer.Receiver.opReadBlock(Receiver.java:116)\r\n at org.apache.hadoop.hdfs.protocol.datatransfer.Receiver.processOp(Receiver.java:71)\r\n at org.apache.hadoop.hdfs.server.datanode.DataXceiver.run(DataXceiver.java:251)\r\n at java.lang.Thread.run(Thread.java:745)\r\n\r\n \r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fxu_36%40hotmail.com","name":"fxu_36@hotmail.com","key":"fxu_36@hotmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"feng xu","active":true,"timeZone":"Etc/UTC"},"created":"2018-04-18T18:44:57.958+0000","updated":"2018-04-18T18:44:57.958+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13153429/comment/16443156","id":"16443156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fxu_36%40hotmail.com","name":"fxu_36@hotmail.com","key":"fxu_36@hotmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"feng xu","active":true,"timeZone":"Etc/UTC"},"body":"By the way, java.io.[file.exists(|file://:exists%28/]) is not sufficient to determine if a file exists, because [fs|http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/6-b14/java/io/File.java#File.0fs].getBooleanAttributes() could fail with other reasons.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fxu_36%40hotmail.com","name":"fxu_36@hotmail.com","key":"fxu_36@hotmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"feng xu","active":true,"timeZone":"Etc/UTC"},"created":"2018-04-18T20:36:21.763+0000","updated":"2018-04-18T20:38:31.392+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-13476/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3spxj:"}}