{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13132259","self":"https://issues.apache.org/jira/rest/api/2/issue/13132259","key":"HDFS-13038","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2018-01-22T15:31:26.846+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jan 24 19:27:18 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_435744925_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-01-24T19:27:43.307+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-13038/watchers","watchCount":6,"isWatching":false},"created":"2018-01-19T18:25:18.402+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ljain","name":"ljain","key":"ljain","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lokesh Jain","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-01-24T19:27:43.324+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Currently any user with EXECUTE permission can run getfacl on a file or directory. This Jira adds a check for READ access of user on the inode path. \r\n{code:java}\r\n[root@host ~]$ hdfs dfs -copyFromLocal /etc/a.txt /tmp\r\n[root@host ~]$ hdfs dfs -setfacl -m user:abc:--- /tmp/a.txt\r\n{code}\r\nSince user abc does not have read permission on the file 'cat' command throws Permission Denied error but getfacl executes normally.\r\n{code:java}\r\n[abc@host ~]$ hdfs dfs -cat /tmp/a.txt\r\ncat: Permission denied: user=abc, access=READ, inode=\"/tmp/a.txt\":abc:hdfs:-rw-r--r-- \r\n[abc@host ~]$ hdfs dfs -getfacl /tmp/a.txt \r\n# file: /tmp/a.txt \r\n# owner:root \r\n# group: hdfs \r\nuser::rw- \r\nuser:abc:--- \r\ngroup::r-- \r\nmask::r-- \r\nother::r--\r\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12906865","id":"12906865","filename":"HDFS-13038.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ljain","name":"ljain","key":"ljain","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lokesh Jain","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-19T18:27:39.588+0000","size":2729,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12906865/HDFS-13038.001.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"User with no permission on file is able to run getfacl for that file","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ljain","name":"ljain","key":"ljain","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lokesh Jain","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nmaheshwari","name":"nmaheshwari","key":"nmaheshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Maheshwari","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13132259/comment/16334406","id":"16334406","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"Don't agree with the patch.  There's no formal posix spec for acls.  This patches appears even more restrictive than linux by requiring path read access instead of possibly parent read access.  Linux docs for getfacl state:\r\n{panel:title=PERMISSIONS}\r\nProcess with search access to a file (i.e., processes with read access to the containing directory of a file) are also granted read access to the file's ACLs. This is analogous to the permissions required for accessing the file mode.\r\n{panel}\r\n\r\nThis is confusing at best. It implies parent \"search access\" equals \"read access\".  \"Search access\" means execute bit regardless of read bit – which is what hdfs enforces today.  Please test how linux actually works and I'll verify when time permits.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2018-01-22T15:31:26.846+0000","updated":"2018-01-22T15:31:26.846+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13132259/comment/16338098","id":"16338098","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"Hdfs is following the same conventions as linux so I'll close this jira.\r\n\r\nI just made a dropbox directory \"getfacl-test\".  Added a file \"f\" only readable by me with an ACL for kihwal:\r\n{noformat}\r\n$ whoami\r\ndaryn\r\n\r\n$ find getfacl-test  -ls\r\n2006111485    0 drwx--x--x   2 daryn    users          60 Jan 24 19:10 getfacl-test\r\n2006109820    0 -rw-------   1 daryn    users           0 Jan 24 19:09 getfacl-test/f\r\n\r\n$ getfacl getfacl-test/f\r\n# file: getfacl-test/f\r\n# owner: daryn\r\n# group: users\r\nuser::rw-\r\nuser:kihwal:r--\t\t\t#effective:---\r\ngroup::---\r\nmask::---\r\nother::---\r\n{noformat}\r\n\r\n\r\nI can still do getfacl on a file using a user with no permissions to the file.\r\n{noformat}\r\n$ whoami\r\nhadoopqa\r\n\r\n$ find getfacl-test -ls\r\n2006111485    0 drwx--x--x   2 daryn    users          60 Jan 24 19:10 getfacl-test\r\nfind: `getfacl-test': Permission denied\r\n\r\n$ ls -l getfacl-test/f\r\n-rw-------+ 1 daryn users 0 Jan 24 19:09 getfacl-test/f\r\n\r\n$ cat getfacl-test/f\r\ncat: getfacl-test/f: Permission denied\r\n\r\n$ getfacl getfacl-test/f\r\n# file: getfacl-test/f\r\n# owner: daryn\r\n# group: users\r\nuser::rw-\r\nuser:kihwal:r--\t\t\t#effective:---\r\ngroup::---\r\nmask::---\r\nother::---\r\n{noformat}\r\n\r\nSo all you need is search (execute) perms to the parent directory.  If you think about it, the user/group shown by ls are just the default ACL.  Displaying additional ACLs isn't top secret information. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2018-01-24T19:27:18.148+0000","updated":"2018-01-24T19:27:18.148+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-13038/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3p4mv:"}}