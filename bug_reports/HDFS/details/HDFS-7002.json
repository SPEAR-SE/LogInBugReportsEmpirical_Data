{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12739431","self":"https://issues.apache.org/jira/rest/api/2/issue/12739431","key":"HDFS-7002","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2014-09-05T09:26:33.093+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Sep 05 09:26:33 UTC 2014","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2131039_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-09-05T09:26:33.073+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7002/watchers","watchCount":2,"isWatching":false},"created":"2014-09-05T08:51:02.060+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325049","id":"12325049","description":"2.2.0 release","name":"2.2.0","archived":false,"released":true,"releaseDate":"2013-10-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326696","id":"12326696","description":"2.4.1 bug-fix release","name":"2.4.1","archived":false,"released":true,"releaseDate":"2014-06-30"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-09-05T09:26:33.097+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319803","id":"12319803","name":"journal-node","description":"Journal Node for the QJM"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12320525","id":"12320525","name":"qjm","description":"Quorum Journal Manager"}],"timeoriginalestimate":null,"description":null,"customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Failed to rolling upgrade hdfs from 2.2.0 to 2.4.1","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sam+liu","name":"sam liu","key":"sam liu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam liu","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sam+liu","name":"sam liu","key":"sam liu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam liu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12739431/comment/14122697","id":"14122697","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sam+liu","name":"sam liu","key":"sam liu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Failed to rolling upgrade hdfs from 2.2.0 to 2.4.1, according to http://hadoop.apache.org/docs/r2.4.0/hadoop-project-dist/hadoop-hdfs/HdfsRollingUpgrade.html#Upgrading_Non-Federated_Clusters.\n\n[A] Cluster Info:\nName Nodes: host2(active), host3(standby)\nQJM Nodes: host1, host4, host5\nData Nodes: host4, host5\n\n[B] Issue Reproduce Steps:\n1. stop standy namenode on host3\n\n2. replace hadoop-2.2.0 binary with hadoop-2.4.1 binary\n\n3. failed to execute command 'hdfs namenode -initializeSharedEdits' with following exception, accordint to last comment of HDFS-5550.\n14/09/05 16:31:49 INFO namenode.AclConfigFlag: ACLs enabled? false\n14/09/05 16:31:49 INFO common.Storage: Lock on /hadoop/hdfs/name/in_use.lock acquired by nodename 155436@host3\n14/09/05 16:31:49 WARN namenode.FSNamesystem: Encountered exception loading fsimage\njava.io.IOException:\nFile system image contains an old layout version -47.\nAn upgrade to version -56 is required.\nPlease restart NameNode with the \"-rollingUpgrade started\" option if a rolling upgraded is already started; or restart NameNode with the \"-upgrade\" option to start a new upgrade.\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.recoverTransitionRead(FSImage.java:224)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFSImage(FSNamesystem.java:891)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.loadFromDisk(FSNamesystem.java:638)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.initializeSharedEdits(NameNode.java:980)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.createNameNode(NameNode.java:1340)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.main(NameNode.java:1424)\n14/09/05 16:31:49 ERROR namenode.NameNode: Could not initialize shared edits dir\n\n4. failed to execute command 'hdfs namenode -rollingUpgrade started'\n14/09/05 16:32:22 INFO namenode.EditLogInputStream: Fast-forwarding stream 'http://host4:8480/getJournal?jid=BICluster&segmentTxId=2570&storageInfo=-56%3A1686370894%3A0%3ACID-70b084bc-5e08-402e-b2e5-f4461d7dc69c' to transaction ID 2570\n14/09/05 16:32:22 ERROR namenode.EditLogInputStream: caught exception initializing http://host4:8480/getJournal?jid=BICluster&segmentTxId=2570&storageInfo=-56%3A1686370894%3A0%3ACID-70b084bc-5e08-402e-b2e5-f4461d7dc69c\norg.apache.hadoop.hdfs.server.namenode.TransferFsImage$HttpGetFailedException: Fetch of http://host4:8480/getJournal?jid=BICluster&segmentTxId=2570&storageInfo=-56%3A1686370894%3A0%3ACID-70b084bc-5e08-402e-b2e5-f4461d7dc69c failed with status code 403\nResponse message:\nThis node has storage info '-47:1686370894:0:CID-70b084bc-5e08-402e-b2e5-f4461d7dc69c' but the requesting node expected '-56:1686370894:0:CID-70b084bc-5e08-402e-b2e5-f4461d7dc69c'\n        at org.apache.hadoop.hdfs.server.namenode.EditLogFileInputStream$URLLog$1.run(EditLogFileInputStream.java:472)\n        at org.apache.hadoop.hdfs.server.namenode.EditLogFileInputStream$URLLog$1.run(EditLogFileInputStream.java:460)\n        at java.security.AccessController.doPrivileged(AccessController.java:366)\n        at javax.security.auth.Subject.doAs(Subject.java:572)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1558)\n        at org.apache.hadoop.security.SecurityUtil.doAsUser(SecurityUtil.java:448)\n        at org.apache.hadoop.security.SecurityUtil.doAsCurrentUser(SecurityUtil.java:442)\n        at org.apache.hadoop.hdfs.server.namenode.EditLogFileInputStream$URLLog.getInputStream(EditLogFileInputStream.java:459)\n        at org.apache.hadoop.hdfs.server.namenode.EditLogFileInputStream.init(EditLogFileInputStream.java:145)\n        at org.apache.hadoop.hdfs.server.namenode.EditLogFileInputStream.nextOpImpl(EditLogFileInputStream.java:196)\n        at org.apache.hadoop.hdfs.server.namenode.EditLogFileInputStream.nextOp(EditLogFileInputStream.java:254)\n        at org.apache.hadoop.hdfs.server.namenode.EditLogInputStream.readOp(EditLogInputStream.java:85)\n        at org.apache.hadoop.hdfs.server.namenode.EditLogInputStream.skipUntil(EditLogInputStream.java:151)\n        at org.apache.hadoop.hdfs.server.namenode.RedundantEditLogInputStream.nextOp(RedundantEditLogInputStream.java:178)\n        at org.apache.hadoop.hdfs.server.namenode.EditLogInputStream.readOp(EditLogInputStream.java:85)\n        at org.apache.hadoop.hdfs.server.namenode.EditLogInputStream.skipUntil(EditLogInputStream.java:151)\n        at org.apache.hadoop.hdfs.server.namenode.RedundantEditLogInputStream.nextOp(RedundantEditLogInputStream.java:178)\n        at org.apache.hadoop.hdfs.server.namenode.EditLogInputStream.readOp(EditLogInputStream.java:85)\n        at org.apache.hadoop.hdfs.server.namenode.FSEditLogLoader.loadEditRecords(FSEditLogLoader.java:180)\n        at org.apache.hadoop.hdfs.server.namenode.FSEditLogLoader.loadFSEdits(FSEditLogLoader.java:133)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadEdits(FSImage.java:805)\n        at org.apache.hadoop.hdfs.server.namenode.FSImage.loadFSImage(FSImage.java:665)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sam+liu","name":"sam liu","key":"sam liu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-09-05T08:53:38.976+0000","updated":"2014-09-05T08:53:38.976+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12739431/comment/14122716","id":"14122716","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajisakaa","name":"ajisakaa","key":"ajisakaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ajisakaa&avatarId=17238","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ajisakaa&avatarId=17238","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ajisakaa&avatarId=17238","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ajisakaa&avatarId=17238"},"displayName":"Akira Ajisaka","active":true,"timeZone":"Asia/Tokyo"},"body":"Rolling upgrades are available for the upgrades from 2.4+ only. Rolling upgrade from ~2.3 to 2.4+ is not supported.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajisakaa","name":"ajisakaa","key":"ajisakaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ajisakaa&avatarId=17238","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ajisakaa&avatarId=17238","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ajisakaa&avatarId=17238","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ajisakaa&avatarId=17238"},"displayName":"Akira Ajisaka","active":true,"timeZone":"Asia/Tokyo"},"created":"2014-09-05T09:26:33.093+0000","updated":"2014-09-05T09:26:33.093+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7002/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1zptb:"}}