{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12609173","self":"https://issues.apache.org/jira/rest/api/2/issue/12609173","key":"HDFS-3979","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323274","id":"12323274","description":"2.0.3-alpha release","name":"2.0.3-alpha","archived":false,"released":true,"releaseDate":"2013-02-14"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-09-26T19:57:19.138+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Nov 09 22:37:13 UTC 2012","customfield_12310420":"239565","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_3538832188_*|*_1_*:*_1_*:*_67421082_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-11-06T22:36:36.204+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-3979/watchers","watchCount":19,"isWatching":false},"created":"2012-09-26T04:52:22.956+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12322472","id":"12322472","description":"2.0.2-alpha release","name":"2.0.2-alpha","archived":false,"released":true,"releaseDate":"2012-10-09"}],"issuelinks":[{"id":"12359365","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12359365","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"outwardIssue":{"id":"12554266","key":"HBASE-5954","self":"https://issues.apache.org/jira/rest/api/2/issue/12554266","fields":{"summary":"Allow proper fsync support for HBase","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}},{"id":"12359081","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12359081","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12611950","key":"HDFS-4060","self":"https://issues.apache.org/jira/rest/api/2/issue/12611950","fields":{"summary":"TestHSync#testSequenceFileSync failed","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12358211","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12358211","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12439560","key":"HDFS-744","self":"https://issues.apache.org/jira/rest/api/2/issue/12439560","fields":{"summary":"Support hsync in HDFS","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-02-15T13:12:10.335+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312927","id":"12312927","name":"datanode"}],"timeoriginalestimate":null,"description":"See discussion in HDFS-744. The actual sync/flush operation in BlockReceiver is not on a synchronous path from the DFSClient, hence it is possible that a DN loses data that it has already acknowledged as persisted to a client.\n\nEdit: Spelling.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12546734","id":"12546734","filename":"hdfs-3979-sketch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-26T20:05:52.828+0000","size":2775,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12546734/hdfs-3979-sketch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12547049","id":"12547049","filename":"hdfs-3979-v2.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-28T21:30:10.649+0000","size":2363,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12547049/hdfs-3979-v2.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12549002","id":"12549002","filename":"hdfs-3979-v3.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-13T05:14:27.165+0000","size":2922,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12549002/hdfs-3979-v3.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12552061","id":"12552061","filename":"hdfs-3979-v4.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-11-05T05:00:36.039+0000","size":3214,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12552061/hdfs-3979-v4.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"2347","customfield_12312823":null,"summary":"Fix hsync semantics","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13463515","id":"13463515","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"Also see my comment here: https://issues.apache.org/jira/browse/HDFS-744?focusedCommentId=13279619&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13279619","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-26T04:53:42.436+0000","updated":"2012-09-26T04:53:42.436+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13464020","id":"13464020","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"More good discussion on HDFS-744.\n\nLooks like we can just enqueu the seqno for the packet after the sync/flush is finished. (Khan's idea)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-26T18:23:18.907+0000","updated":"2012-09-26T18:23:18.907+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13464115","id":"13464115","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks, Lars! BTW, you spell my name wrong. :-)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-26T19:57:19.138+0000","updated":"2012-09-26T19:57:19.138+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13464127","id":"13464127","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"Something like this.\n(This is a sketch, the only test I performed was compiling)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-26T20:05:52.830+0000","updated":"2012-09-26T20:05:52.830+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13464133","id":"13464133","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"(and sorry for misspelling you name)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-26T20:08:37.349+0000","updated":"2012-09-26T20:08:37.349+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13464289","id":"13464289","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"Let's try HadoopQA.\n\nTestHSync still passes. I'll also do some tests with HBase...\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-26T23:36:04.036+0000","updated":"2012-09-26T23:36:04.036+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13464359","id":"13464359","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12546734/hdfs-3979-sketch.txt\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/3239//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/3239//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-27T01:54:16.632+0000","updated":"2012-09-27T01:54:16.632+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13464402","id":"13464402","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"body":"TestHSync only tests the success code path, which makes me a bit nervous, as I'm not sure if putting the ack enqueue in the finally block is the right thing to do. I think you want the pipeline to fail and restart if there is an io exception.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-27T04:02:30.291+0000","updated":"2012-09-27T04:02:30.291+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13464410","id":"13464410","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"I'm not sure either. I am trying not to change the existing behavior.\n\nThe enqueue used to happen in the beginning of receivePacket(...), so if that latter part of the method fails the ack would already be enqueued.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-27T04:17:10.846+0000","updated":"2012-09-27T04:17:10.846+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13465331","id":"13465331","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"I agree it's probably not a good idea to enqueue in a finally block. The original code before HDFS-265 didn't do that either.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-28T04:14:28.982+0000","updated":"2012-09-28T04:14:28.982+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13465386","id":"13465386","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"Should we simply do the enqueue at the end of receivePacket(), then?\n\nSo just to make sure: In the current code the seqno is already enqueued in the beginning, so if there's an exception later in the code it won't have any effect on the enqued seqno. The finally is just preserves this existing behavior.\n\nWhat happens when there is an exception and the seqno is never enqueued? (and if that is OK, why is it not a problem now.)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-28T05:51:04.190+0000","updated":"2012-09-28T05:51:04.190+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13465915","id":"13465915","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"Enqueing the seqno at end seems like the best approach. (Indeed this is done in the 0.20.x code as both of you said). \nI wonder why this was changed? Will have a new patch momentarily.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-28T21:25:14.008+0000","updated":"2012-09-28T21:25:14.008+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13465919","id":"13465919","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"New patch. Order of local operations and waiting for downstream DNs now reflects the pre HDFS-265 logic.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-28T21:30:10.650+0000","updated":"2012-09-28T21:30:10.650+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13465987","id":"13465987","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12547049/hdfs-3979-v2.txt\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/3247//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/3247//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-28T23:04:07.215+0000","updated":"2012-09-28T23:04:07.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13466082","id":"13466082","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. I wonder why this was changed?\n\nMy guess is HDFS-265 intends to implement API3 rather than API4. https://issues.apache.org/jira/browse/HDFS-265?focusedCommentId=12710542&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12710542","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-29T02:02:43.199+0000","updated":"2012-09-29T02:02:43.199+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13466113","id":"13466113","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"I see. Thanks Kan. So now we we have API4 and (with HDFS-744) API5.\n\nFor applications like HBase we'd like API4 as well as API5.\n(API4 allows a hypothetical kill -9 of all DNs without loss of acknowledged data, API5 allows HW failures of all data nodes - i.e. a DC outage - with loss of acknowledged data)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-09-29T05:15:51.091+0000","updated":"2012-09-29T05:15:51.091+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13467270","id":"13467270","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"Do we want this change?\nSeems to me that HDFS-265 broke hsync/hflush and this would fix it.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-01T22:45:34.710+0000","updated":"2012-10-01T22:45:34.710+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13467292","id":"13467292","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Do we want the change?\n\nI do think that the change is required for the correct hsync semantics (and better hflush guarantee). I'm not too sure if the change is complete without some reasonable test cases for failure scenarios.\n\nBTW, do you have any new performance numbers for comparison as well?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-01T23:16:57.666+0000","updated":"2012-10-01T23:16:57.666+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13467882","id":"13467882","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"You don't think the existing pipeline tests cover the failure scenarios? \nI see if I can get some performance numbers.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-02T17:24:53.133+0000","updated":"2012-10-02T17:24:53.133+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13469628","id":"13469628","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. You don't think the existing pipeline tests cover the failure scenarios?\n\nGiven the existing hflush/hsync semantics (ack can reach client before any pipeline exceptions), I don't think the new semantics is covered by existing tests. I'm worried about the race between the ack and write errors.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-04T19:42:11.482+0000","updated":"2012-10-04T19:42:11.482+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13469671","id":"13469671","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"I've seen that race when I write a test for HDFS-744. I \"fixed\" it there by updating the metrics first... Ugh :)\n\nI think I can make a test that fails at least with reasonable probability with the current semantics.\n\nThe race between ack and write errors should be reduced (eliminated) with this patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-04T20:44:03.837+0000","updated":"2012-10-04T20:44:03.837+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13469712","id":"13469712","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. The race between ack and write errors should be reduced (eliminated) with this patch.\n\nIt should be eliminated with this patch. When there is write error, ack will not be queued.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-04T21:13:00.726+0000","updated":"2012-10-04T21:13:00.726+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13469725","id":"13469725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. It should be eliminated with this patch. When there is write error, ack will not be queued.\n\nI think so too, but it'll be nice to have a test to cover the case for future \"maintenance/refactor\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-04T21:23:39.009+0000","updated":"2012-10-04T21:23:39.009+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13469827","id":"13469827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"Thanks Luke and Kan. I'll come up with a test once I get some spare cycles (quite busy with HBase atm).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-04T23:22:01.544+0000","updated":"2012-10-04T23:22:01.544+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13469952","id":"13469952","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"{quote}\nFor applications like HBase we'd like API4 as well as API5.\n(API4 allows a hypothetical kill -9 of all DNs without loss of acknowledged data, API5 allows HW failures of all data nodes - i.e. a DC outage - with loss of acknowledged data)\n{quote}\nWhy API4 is needed for HBase?\n\nAs everyone known, there are usually 3 replicas in HDFS.  If only one of the datanodes is killed, the data is still available in the other two datanodes.  That's why we have invented \"hflush\" (i.e. API 3) in HDFS-265.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-05T01:30:16.506+0000","updated":"2012-10-05T01:30:16.506+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13469978","id":"13469978","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Why API4 is needed for HBase?\n\nMany configuration management system (simplest: pdsh -a hadoop-daemon.sh stop datanode) shutdown/restart HDFS by kill -9 datanodes in parallel. Having to acquiesce any OLTP like workload is error prone. How about a simple ops error: pdsh -a killall -9 java to the wrong window (hence the wrong cluster). IMO, API4 is not robust enough for HBase. Unless the performance difference is huge (> 20% for hflush), which I doubt, it's not worth the risk, again IMO.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-05T02:47:48.379+0000","updated":"2012-10-05T02:47:48.379+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13470016","id":"13470016","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"API4 is hflush (with change in OS buffers).\n\nThat's an interesting discussion by itself. hsync'ing every edit in HBase is prohibitive.\nI have some simple numbers in HBASE-5954.\n\nAlthough, I need to do that test again with the sync_file_range changes in HDFS-2465 (that would hopefully do most of the data sync'ing asynchronously and only sync the last changes and metadata synchronously upon client request).\n\nMany applications do not need every edit to be guaranteed on disk, but have \"sync points\". That is what I am aiming for in HBase. The application will know the specific semantics.\n\nWhat is really important for HBase (IMHO) is that every block is synced to disk when it is closed. HBase constantly rewrites existing data via compactions so without syncing arbitrarily old data can be lost during a rack or DC outage.\n\nLastly, we can play with this. For example only one of the replicas could sync to disk and the other's just guarantee the data in the OS buffers (API4.5 :) ).\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-05T04:34:04.154+0000","updated":"2012-10-05T04:34:04.154+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13470823","id":"13470823","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Why API4 is needed for HBase?\n\nAPI3 or API4, it probably doesn't make a huge difference, IMHO. On the other hand, assuming the performance penalty of going from API3 to API4 is negligible, it's probably not worth complicating the code to support API3 (instead of API4).\n\nbq. Lastly, we can play with this. For example only one of the replicas could sync to disk and the other's just guarantee the data in the OS buffers (API4.5  ).\n\nYes, it would be very interesting to see if it saves to sync only the local replica or acknowledge to the client upon the first successful sync of any replica.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-06T00:40:58.357+0000","updated":"2012-10-06T00:40:58.357+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13475529","id":"13475529","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"This little change makes TestHSync fail most of the time - without the rest of the patch, and never with this patch.\n\n(In HDFS-744 I had avoided this race, by updating the sync metric first. I know that was a hack... By updating the metric last in BlockReceiver.flushOrSync, this race becomes apparent again).\n\nWe do have pipeline tests that seem to verify correct pipeline behavior in the face of failures via fault injection: TestFiPipelines and TestFiHFlush.\n\nIn terms of the API3/API4 discussion, I think we agree that hflush should follow API4, right? (otherwise we'd have unduly complex code)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-13T05:14:27.167+0000","updated":"2012-10-13T05:14:27.167+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13475546","id":"13475546","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12549002/hdfs-3979-v3.txt\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/3327//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/3327//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-13T06:56:32.355+0000","updated":"2012-10-13T06:56:32.355+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13489212","id":"13489212","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xieliang007","name":"xieliang007","key":"xieliang007","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10434","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10434","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10434","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10434"},"displayName":"Liang Xie","active":true,"timeZone":"Asia/Shanghai"},"body":"Is there any objections on it, or more comments ? \nThis issue is a blocker for HBASE-5954, it would be better resolve asap:)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xieliang007","name":"xieliang007","key":"xieliang007","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10434","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10434","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10434","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10434"},"displayName":"Liang Xie","active":true,"timeZone":"Asia/Shanghai"},"created":"2012-11-02T02:36:59.284+0000","updated":"2012-11-02T02:36:59.284+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13489609","id":"13489609","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"body":"The patch lgtm, even though it lacks tests for failure cases for hsync.\n\nbq. This issue is a blocker for HBASE-5954, it would be better resolve asap\n\nYou can help by testing the patch and show some results.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-02T18:07:19.246+0000","updated":"2012-11-02T18:07:19.246+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13490069","id":"13490069","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. This little change makes TestHSync fail most of the time - without the rest of the patch, and never with this patch.\n\nLars, I don't quite understand your above comment. What's the behavior of TestHSync with and w/o your latest patch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-03T18:38:55.045+0000","updated":"2012-11-03T18:38:55.045+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13490113","id":"13490113","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"Hi Kan, the only difference between v2 and v3 is that in v3 the \"fsync\" metric is updated after the actual sync to the FS (BlockReceiver.flushOrSync).\n\nThis exposes the race condition we want to fix and makes TestHSync fail almost every run (the client return from hsync before the datanode could update the metric). With the rest of this patch applies this race is removed and TestHSync never fails.\n\nSo now we have a test case for the race condition.\n\n[~vicaya] The existing tests: TestFiPipelines and TestFiHFlush do not cover the other scenarios you worry about?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-11-03T22:24:26.492+0000","updated":"2012-11-03T22:24:26.492+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13490121","id":"13490121","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"+1\n\nThanks, Lars. Patch looks good to me.\n\nNicholas, would appreciate if you could also take a look. Thx!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-03T22:47:16.060+0000","updated":"2012-11-03T22:47:16.060+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13490268","id":"13490268","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Sure, will check the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-04T19:22:38.765+0000","updated":"2012-11-04T19:22:38.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13490285","id":"13490285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"The patch moves ack to the end in order to fix the sync semantics.  I think it will decrease the performance for non-sync write.  How about keeping enqueue early when syncBlock == false?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-04T20:01:36.788+0000","updated":"2012-11-04T20:01:36.788+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13490435","id":"13490435","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. I think it will decrease the performance for non-sync write. \n\nI'd welcome some clarity on whether writing to OS buffers is a real concern here.\n\nbq. How about keeping enqueue early when syncBlock == false?\n\nTo be on the conservative side, I'm OK with this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kzhang","name":"kzhang","key":"kzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-05T03:52:18.039+0000","updated":"2012-11-05T03:52:18.039+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13490445","id":"13490445","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"I'll make that change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-11-05T04:12:33.773+0000","updated":"2012-11-05T04:12:33.773+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13490453","id":"13490453","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"Updated patch with Nicholas' suggestion.\n\nI agree that the previous patch would have slowed all writes that reach the DN.\nWe can't distinguish between an hflush from the client and \"normal\" packet from the client.\nOn the other hand this no longer deals with Luke's \"kill -9\" scenario (where a cluster management tool would kill -9 datanodes in parallel), but in the end no tool really should do that.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-11-05T05:00:36.047+0000","updated":"2012-11-05T05:00:36.047+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13490476","id":"13490476","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12552061/hdfs-3979-v4.txt\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/3442//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/3442//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-11-05T06:38:21.736+0000","updated":"2012-11-05T06:38:21.736+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13490841","id":"13490841","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for the update, Lars.\n+1 patch looks good.  I will commit it if there is no more comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-05T19:20:42.807+0000","updated":"2012-11-05T19:20:42.807+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13490887","id":"13490887","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. I think it will decrease the performance for non-sync write.\n\nIt'll be nice if we can show/quantify the decrease in performance for non-sync writes. It may not be wise to introduce complexity and make hflush less robust if this is a non-issue.\n\nbq. The existing tests: TestFiPipelines and TestFiHFlush do not cover the other scenarios you worry about?\n\nIt seems that TestFiHFlush doesn't cover the failure scenarios. All the test cases are positive assertions (pipeline can recover in spite of disk error exceptions), which seems not very useful given the ack is done before the disk error exceptions are triggered. A new TestFiHSync seems necessary especially for the new patch, where the ack code path diverged from hflush. Basically, I want to make sure that hsync would be guaranteed to get an error if the pipeline cannot be recovered (e.g., due to required datanodes ran out of disk space etc).\n\nAnyway, I'm fine with filing another jira for these hflush/hsync improvement. \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-05T20:13:56.106+0000","updated":"2012-11-05T20:13:56.106+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13491900","id":"13491900","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"I have committed this.  Thanks, Lars!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-06T22:36:36.219+0000","updated":"2012-11-06T22:36:36.219+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13491946","id":"13491946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-trunk-Commit #2967 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/2967/])\n    HDFS-3979. For hsync, datanode should wait for the local sync to complete before sending ack. Contributed by Lars Hofhansl (Revision 1406382)\n\n     Result = SUCCESS\nszetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1406382\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockReceiver.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2012-11-06T23:26:38.399+0000","updated":"2012-11-06T23:26:38.399+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13492260","id":"13492260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Yarn-trunk #29 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/29/])\n    HDFS-3979. For hsync, datanode should wait for the local sync to complete before sending ack. Contributed by Lars Hofhansl (Revision 1406382)\n\n     Result = SUCCESS\nszetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1406382\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockReceiver.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2012-11-07T10:46:48.427+0000","updated":"2012-11-07T10:46:48.427+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13492321","id":"13492321","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Hdfs-trunk #1219 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1219/])\n    HDFS-3979. For hsync, datanode should wait for the local sync to complete before sending ack. Contributed by Lars Hofhansl (Revision 1406382)\n\n     Result = SUCCESS\nszetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1406382\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockReceiver.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2012-11-07T13:01:41.488+0000","updated":"2012-11-07T13:01:41.488+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13492363","id":"13492363","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Mapreduce-trunk #1249 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1249/])\n    HDFS-3979. For hsync, datanode should wait for the local sync to complete before sending ack. Contributed by Lars Hofhansl (Revision 1406382)\n\n     Result = FAILURE\nszetszwo : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1406382\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/BlockReceiver.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2012-11-07T14:01:47.735+0000","updated":"2012-11-07T14:01:47.735+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13494373","id":"13494373","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"body":"Thanks Nicholas.\n\nLuke, so the test you're looking for is starting 3 DNs, and then have the write permanently fail at any of them, and in all cases have the hsync fail on the client, right?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lhofhansl","name":"lhofhansl","key":"lhofhansl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Hofhansl","active":true,"timeZone":"Etc/UTC"},"created":"2012-11-09T22:30:25.379+0000","updated":"2012-11-09T22:30:25.379+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609173/comment/13494379","id":"13494379","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. So the test you're looking for is starting 3 DNs, and then have the write permanently fail at any of them, and in all cases have the hsync fail on the client, right?\n\nYes, that should provide basic coverage for the failure cases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vicaya","name":"vicaya","key":"vicaya","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Lu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-09T22:37:13.327+0000","updated":"2012-11-09T22:37:13.327+0000"}],"maxResults":50,"total":50,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-3979/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i00r93:"}}