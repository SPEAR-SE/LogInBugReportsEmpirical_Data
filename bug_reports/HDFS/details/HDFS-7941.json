{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12782585","self":"https://issues.apache.org/jira/rest/api/2/issue/12782585","key":"HDFS-7941","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-10-23T05:53:37.064+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jun 10 08:50:18 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7941/watchers","watchCount":11,"isWatching":false},"created":"2015-03-17T15:18:20.623+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327181","id":"12327181","description":"2.6.0 release","name":"2.6.0","archived":false,"released":true,"releaseDate":"2014-11-18"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-06-10T08:50:18.084+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312928","id":"12312928","name":"hdfs-client"}],"timeoriginalestimate":null,"description":"When using SequenceFile.Writer and appending+syncing to file repeatedly, the sync does not appear to work other than:\n- once after writing headers\n- when closing.\n\nImagine the following test case:\nhttp://pastebin.com/Y9xysCRX\n\nThis code would append a new record every second and then immediately sync it. One would also imagine that the file would grow for every append, however, this does not happen.\n\nAfter watching the behavior I have noticed that it only syncs the headers at the very beginning (providing a file of 164 bytes) and then never again until its closed. This despite it is asked to hsync() after every append.\n\nLooking into the debug logs, this also claims the same behavior (executed the provided code example and grepped for \"sync\"):\n\nSLF4J: Failed to load class \"org.slf4j.impl.StaticLoggerBinder\".\nSLF4J: Defaulting to no-operation (NOP) logger implementation\nSLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.\n2015-03-17 15:55:14 DEBUG ProtobufRpcEngine:253 - Call: fsync took 11ms\n\nThis was the only time the code ran fsync throughout the entire execution.\n\nThis has been tested (with similar result) for the following deployments:\n- sequencefile with no compression\n- sequencefile with record compression\n- sequencefile with block compression\n- textfile with no compression","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"hsync() not working for SequenceFile","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sbakke","name":"sbakke","key":"sbakke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sverre Bakke","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sbakke","name":"sbakke","key":"sbakke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sverre Bakke","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"HDP 2.2 running on Redhat","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12782585/comment/14371459","id":"14371459","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sbakke","name":"sbakke","key":"sbakke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sverre Bakke","active":true,"timeZone":"Etc/UTC"},"body":"Ok, I just tested this will BLOCK compression, RECORD compression as well as NONE compression, and same result on all modes. Furthermore, I tested without sequence files (i.e. normal files) and also here it only syncs at the very beginning and never again until file is closed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sbakke","name":"sbakke","key":"sbakke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sverre Bakke","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-20T15:21:50.176+0000","updated":"2015-03-20T15:21:50.176+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12782585/comment/14970490","id":"14970490","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=niranjan-wa","name":"niranjan-wa","key":"niranjan-wa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Niranjan Subramanian","active":true,"timeZone":"Etc/UTC"},"body":"Hi Sverre, \n\nAny update on the fix for this? I think there is a general issue on hsync(), this bug can be reproducible when someone directly calls FSDataOutputStream's hysnc().","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=niranjan-wa","name":"niranjan-wa","key":"niranjan-wa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Niranjan Subramanian","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-23T05:53:37.064+0000","updated":"2015-10-23T05:53:37.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12782585/comment/14970493","id":"14970493","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=niranjan-wa","name":"niranjan-wa","key":"niranjan-wa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Niranjan Subramanian","active":true,"timeZone":"Etc/UTC"},"body":"And ya internally SequenceFile.Writer uses FSDataOutputStream.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=niranjan-wa","name":"niranjan-wa","key":"niranjan-wa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Niranjan Subramanian","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-23T05:55:29.502+0000","updated":"2015-10-23T05:55:29.502+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12782585/comment/15316948","id":"15316948","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johannes.herr","name":"johannes.herr","key":"johannes.herr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johannes Herr","active":true,"timeZone":"Etc/UTC"},"body":"The file may not appear to grow because the new length is not sent to the Namenode on hsync or because Block-compression is used and the data is still in the compress buffer.\n\nSee http://stackoverflow.com/a/37664114/136247 for more details.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johannes.herr","name":"johannes.herr","key":"johannes.herr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johannes Herr","active":true,"timeZone":"Etc/UTC"},"created":"2016-06-06T18:35:09.933+0000","updated":"2016-06-06T18:35:09.933+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12782585/comment/15324064","id":"15324064","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"(Revised summary.)\n\nHave you tried hsync(UPDATE_LENGTH)?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-06-10T08:24:57.046+0000","updated":"2016-06-10T08:24:57.046+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12782585/comment/15324093","id":"15324093","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johannes.herr","name":"johannes.herr","key":"johannes.herr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johannes Herr","active":true,"timeZone":"Etc/UTC"},"body":"SequenceFile does not provide a hsync(UPDATE_LENGTH) method (that would be a method of an underlying DFSOutputStream).\n\nEven if it did, that would not solve the problem of block compressed data being buffered.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johannes.herr","name":"johannes.herr","key":"johannes.herr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johannes Herr","active":true,"timeZone":"Etc/UTC"},"created":"2016-06-10T08:50:18.084+0000","updated":"2016-06-10T08:50:18.084+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7941/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i26vcn:"}}