{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12611474","self":"https://issues.apache.org/jira/rest/api/2/issue/12611474","key":"HDFS-4043","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2012-10-13T04:23:37.166+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Oct 19 11:05:26 UTC 2012","customfield_12310420":"247842","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-4043/watchers","watchCount":6,"isWatching":false},"created":"2012-10-12T00:43:13.044+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":86400,"aggregatetimeoriginalestimate":86400,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320353","id":"12320353","description":"hadoop-2.0.0-alpha release","name":"2.0.0-alpha","archived":false,"released":true,"releaseDate":"2012-05-23"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12322465","id":"12322465","description":"2.0.1-alpha release","name":"2.0.1-alpha","archived":false,"released":true,"releaseDate":"2012-07-25"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12322472","id":"12322472","description":"2.0.2-alpha release","name":"2.0.2-alpha","archived":false,"released":true,"releaseDate":"2012-10-09"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323274","id":"12323274","description":"2.0.3-alpha release","name":"2.0.3-alpha","archived":false,"released":true,"releaseDate":"2013-02-14"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-10-19T11:05:26.153+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313400","id":"12313400","name":"security"}],"timeoriginalestimate":86400,"description":"The Namenode uses the loginAsNameNodeUser method in NameNode.java to login using the hdfs principal. This method in turn invokes SecurityUtil.login with a hostname (last parameter) obtained via a call to InetAddress.getHostName. This call does not always return the fully qualified host name, and thus causes the namenode to login to fail due to kerberos's inability to find a matching hdfs principal in the hdfs.keytab file. Instead it should use InetAddress.getCanonicalHostName. This is consistent with what is used internally by SecurityUtil.java to login in other services, such as the DataNode. ","customfield_10010":null,"timetracking":{"originalEstimate":"24h","remainingEstimate":"24h","originalEstimateSeconds":86400,"remainingEstimateSeconds":86400},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":86400,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"48852","customfield_12312823":null,"summary":"Namenode Kerberos Login does not use proper hostname for host qualified hdfs principal name.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ahadr","name":"ahadr","key":"ahadr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ahad Rana","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ahadr","name":"ahadr","key":"ahadr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ahad Rana","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":86400,"percent":0},"customfield_12311024":null,"environment":"CDH4U1 on Ubuntu 12.04","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":86400,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611474/comment/13475524","id":"13475524","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi Ahad Rana,\nI think,,this is same as HDFS-3980..Please refer following comment..\nhttps://issues.apache.org/jira/browse/HDFS-3980?focusedCommentId=13469267&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13469267..\n\n Can I duplicate this...?\n \nPlease correct me If I am wrong..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-10-13T04:23:37.166+0000","updated":"2012-10-13T04:23:37.166+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611474/comment/13475717","id":"13475717","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ahadr","name":"ahadr","key":"ahadr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ahad Rana","active":true,"timeZone":"Etc/UTC"},"body":"Hi Brahma,\n\nNot sure if this is exactly the same bug. It could definitely be the case\nthat the host name derived via KerberosAuthenticator.this*.url.getHost() *is\nnot the Canonical Hostname used to generate the server principal, so it is\ndefinitely similar in nature to the bug I reported. Have you verified that\nthe generated service principal name does not match the one stored in your\nkdc's database ?\n\nAhad.\n\nOn Fri, Oct 12, 2012 at 9:25 PM, Brahma Reddy Battula (JIRA) <\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ahadr","name":"ahadr","key":"ahadr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ahad Rana","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-13T22:00:02.508+0000","updated":"2012-10-13T22:00:02.508+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611474/comment/13475956","id":"13475956","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi Ahad,\nthanks for reply..\n{quote}\nHave you verified that\nthe generated service principal name does not match the one stored in your\nkdc's database ?\n{quote}\n\ngenerated principal is HTTP/hostname which is not added in the KDC(I mean not stored in kdc database) and not configured.. \n\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-10-15T04:33:18.393+0000","updated":"2012-10-15T04:33:18.393+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611474/comment/13478067","id":"13478067","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ahadr","name":"ahadr","key":"ahadr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ahad Rana","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n\nCan you explicitly set the namenode principal name (to the proper canonical\nname) in your hdfs-site via the following properties and see if this\nresolves your issues ?\n\n<property>\n  <name>dfs.namenode.kerberos.principal</name>\n  <value>hdfs/n01.prod.company.com@company.com</value>\n</property>\n<property>\n  <name>dfs.namenode.kerberos.internal.spnego.principal</name>\n  <value>HTTP/n01.prod.company.com@company.com</value>\n</property>\n\nBest,\n\nAhad.\n\nOn Sun, Oct 14, 2012 at 9:35 PM, Brahma Reddy Battula (JIRA) <\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ahadr","name":"ahadr","key":"ahadr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ahad Rana","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-17T17:42:02.491+0000","updated":"2012-10-17T17:42:02.491+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611474/comment/13478670","id":"13478670","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"HI Ahad thanks a lot for reply..\n\n{quote}\n<property>\n<name>dfs.namenode.kerberos.principal</name>\n<value>hdfs/n01.prod.company.com@company.com</value>\n</property>\n<property>\n<name>dfs.namenode.kerberos.internal.spnego.principal</name>\n<value>HTTP/n01.prod.company.com@company.com</value>\n</property>\n{quote}\n\ntwo properties I had configured as\n\nhdfs/hostname of machine@HADOOP.COM(RELAM)\nHTTP/hostname of machine@HADOOP.COM\n\nI added both principal's (hdfs/hostname of machine@HADOOP.COM and HTTP/hostname of machine@HADOOP.COM) to KDC and generated keytab\n\nbut it's failing for HTTP/(IP of machine) which is not added in the KDC and then ticket is failing like following while doing checkpoint..\n\nOct 04 03:07:43 host-*******-168 krb5kdc[24598](info): TGS_REQ (6 etypes {3 1 23 16 17 18}) *******.168: ISSUE: authtime 1349300202, etypes {rep=23 tkt=18 ses=23}, hdfs/hadoop@HADOOP.COM for hdfs/hadoop@HADOOP.COM\nOct 04 03:07:43 host-*******-168 krb5kdc[24598](info): TGS_REQ (6 etypes {3 1 23 16 17 18}) *******.168: ISSUE: authtime 1349300202, etypes {rep=23 tkt=18 ses=23}, hdfs/hadoop@HADOOP.COM for hdfs/hadoop@HADOOP.COM\nOct 04 03:07:43 host-*******-168 krb5kdc[24598](info): TGS_REQ (6 etypes {3 1 23 16 17 18}) *******.168: ISSUE: authtime 1349300202, etypes {rep=23 tkt=18 ses=23}, hdfs/hadoop@HADOOP.COM for HTTP/*******.168@HADOOP.COM\nOct 04 03:07:43 host-*******-168 krb5kdc[24598](info): TGS_REQ (6 etypes {3 1 23 16 17 18}) *******.168: ISSUE: authtime 1349300202, etypes {rep=23 tkt=18 ses=23}, hdfs/hadoop@HADOOP.COM for HTTP/*******.168@HADOOP.COM\n\n\nMostly your's and mine(HDP-3980) is same,I think...Since  KerberosAuthenticator.this*.url.getHost() is always retunring IP of the machine and then principal coming like HTTP/(ip of the machine)..\n\nPlease correct me If I am wrong...\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-10-18T05:01:19.979+0000","updated":"2012-10-18T05:01:19.979+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611474/comment/13479668","id":"13479668","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ahadr","name":"ahadr","key":"ahadr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ahad Rana","active":true,"timeZone":"Etc/UTC"},"body":"Hi Brahma,\n\nPlease disregard my last suggestion. Setting dfs.namenode.kerberos.principal or dfs.namenode.kerberos.internal.spnego.principal to and explicit principal name (instead of a pattern name with _HOST in it) triggers other bugs (see HDFS-4081). The bottom line is that it is probably best to set the hostname of the namenode to match exactly the name returned via a reverse-dns query (getCanonicalName). You are right however, that your problems are a manifestation of the same general bug (inconsistent resolution of canonical principal name via different code paths). Most definitely, incoming IP based connections need to use getCanonicalName to get back a host name that can be used to form the proper principal name. Otherwise you will need to probably go with IP based principal names ? \n\nAs mentioned above, I have reverted to setting the internal hostname for the namenodes/secondary namenodes to exactly match the fully qualified hostname returned via reverse-dns. And so far, things seems to be working properly now.   ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ahadr","name":"ahadr","key":"ahadr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ahad Rana","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-19T06:55:58.875+0000","updated":"2012-10-19T06:55:58.875+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611474/comment/13479954","id":"13479954","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"[~ahadr]\n\nLet's go ahead and close this JIRA.\n{quote}\nYou are right however, that your problems are a manifestation of the same general bug (inconsistent resolution of canonical principal name via different code paths). Most definitely, incoming IP based connections need to use getCanonicalName to get back a host name that can be used to form the proper principal name. Otherwise you will need to probably go with IP based principal names ?\n{quote}\ncan we discuss this point in HDF-3980..?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-10-19T11:05:26.153+0000","updated":"2012-10-19T11:05:26.153+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-4043/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i08q93:"}}