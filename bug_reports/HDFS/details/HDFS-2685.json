{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12535256","self":"https://issues.apache.org/jira/rest/api/2/issue/12535256","key":"HDFS-2685","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2012-01-03T15:49:20.554+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue May 19 19:28:33 UTC 2015","customfield_12310420":"220940","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_108132357759_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-05-19T19:28:33.693+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-2685/watchers","watchCount":4,"isWatching":false},"created":"2011-12-15T06:42:36.050+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314204","id":"12314204","description":"","name":"0.20.2","archived":false,"released":true,"releaseDate":"2010-02-16"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316319","id":"12316319","description":"","name":"0.20.204.0","archived":false,"released":true,"releaseDate":"2011-09-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316392","id":"12316392","description":"Merge append/sync support with security","name":"0.20.205.0","archived":false,"released":true,"releaseDate":"2011-10-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-05-19T19:28:33.801+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"_hadoop fs -ls_ command gives exit code for globbed input path, which is the exit code for the last resolved absolute path. Whereas _ls_ command always give same exit code regardless of position of non-existent path in globbing.\n\n{code}$ hadoop fs -mkdir input/20110{1,2,3}/{A,B,C,D}/{1,2} {code}\n\nSince directory 'input/201104/' is not present, the following command gives 255 as exit code.\n{code}$ hadoop fs -ls input/20110{1,2,3,4}/ ; echo $? {code}\n{noformat}\nFound 4 items\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201101/A\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201101/B\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201101/C\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201101/D\nFound 4 items\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201102/A\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201102/B\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201102/C\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201102/D\nFound 4 items\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201103/A\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201103/B\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201103/C\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201103/D\nls: Cannot access input/201104/: No such file or directory.\n255\n{noformat}\n\n\nThe directory 'input/201104/' is not present but given as second last parameter in globbing.\nThe following command gives 0 as exit code, because directory 'input/201103/' is present.\n{code}$ hadoop fs -ls input/20110{1,2,4,3}/ ; echo $? {code}\n{noformat}\nFound 4 items\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201101/A\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201101/B\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201101/C\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201101/D\nFound 4 items\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201102/A\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201102/B\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201102/C\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201102/D\nls: Cannot access input/201104/: No such file or directory.\nFound 4 items\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201103/A\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201103/B\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201103/C\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201103/D\n0\n{noformat}\n\n\n\nWhereas, on Linux, ls command gives non-zero(2) as exit code, irrespective of position of non-existent path in globbing.\n{code}$ mkdir -p input/20110{1,2,3,4}/{A,B,C,D}/{1,2} {code}\n\n\n{code}$ ls input/20110{1,2,4,3}/ ; echo $? {code}\n{noformat}\n/bin/ls: input/201104/: No such file or directory\ninput/201101/:\n./  ../  A/  B/  C/  D/\n\ninput/201102/:\n./  ../  A/  B/  C/  D/\n\ninput/201103/:\n./  ../  A/  B/  C/  D/\n2\n{noformat}\n\n\n\n{code}$ ls input/20110{1,2,3,4}/ ; echo $? {code}\n{noformat}\n/bin/ls: input/201104/: No such file or directory\ninput/201101/:\n./  ../  A/  B/  C/  D/\n\ninput/201102/:\n./  ../  A/  B/  C/  D/\n\ninput/201103/:\n./  ../  A/  B/  C/  D/\n2\n{noformat}\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"113960","customfield_12312823":null,"summary":"hadoop fs -ls globbing gives inconsistent exit code","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miteshsjat","name":"miteshsjat","key":"miteshsjat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mitesh Singh Jat","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miteshsjat","name":"miteshsjat","key":"miteshsjat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mitesh Singh Jat","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535256/comment/13178791","id":"13178791","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"Incorrect exit codes in 205 and earlier are pretty pervasive.  I did a complete overhaul of FsShell on 23/trunk that fixed this issue and many many others.  In general, an as-is back port of the new shell should be moderately trivial.  However, it'll be a dicey change since it contains a number of \"incompatible\" output changes to make it more shell-like.  Reverting the output to be 205-compatible will be difficult since all commands now use common code to make the output more consistent.\n\nI'll gladly answer questions if anyone would like to take on this jira and runs into issues.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2012-01-03T15:49:20.554+0000","updated":"2012-01-03T15:49:20.554+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535256/comment/13215424","id":"13215424","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miteshsjat","name":"miteshsjat","key":"miteshsjat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mitesh Singh Jat","active":true,"timeZone":"Asia/Kolkata"},"body":"As a workaround, I have created a C program to resolve the globbing, and return appropriate exit code.\n\n{code:title=hadoop_fs_ls_globbing.c}\n//-------------------------------------------------------------\n/*\n *       Filename:  hadoop_fs_ls_globbing.c\n *    Description:  TO support globbing in `hadoop fs -ls` command\n *        Created:  01/11/2012 09:39:55 AM (IST)\n *         Author:  Mitesh Singh Jat (), mitesh_singh_jat[at]yahoo[dot]co[dot]in\n */\n\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#define CMD_LEN 4096    // command line length\n#define PATH_LEN 256    // splits in path based on delimiters\n#define MAX_PATHS 256   // Maximum resolved paths in globbed path\n\nint print_usage(char *cmd_name) {\n    fprintf(stderr, \"Usage: %s [-c <hadoop_commands>] path\\n\",\n            cmd_name);\n    exit(EXIT_FAILURE);\n}\n\nint main(int argc, char *argv[])\n{\n    char *str1, *str2, *token, *subtoken;\n    char *saveptr1, *saveptr2;\n    int i, j, k;\n    char cmds[MAX_PATHS][CMD_LEN];\n    char *a[MAX_PATHS][PATH_LEN];\n    int total_paths = 1;\n    int nt = 0, nst = 0;\n    int retval = 0;\n    int exit_code = 0;\n    char cmd[CMD_LEN] = \"hadoop fs -ls \";\n    char delim[] = \"{}\";\n    char subdelim[] = \",\";\n    int nsts[PATH_LEN];\n    int xpaths;\n\n    for (i = 0; i < MAX_PATHS; ++i) {\n        strcpy(cmds[i], \"\");\n        for (j = 0; j < PATH_LEN; ++j)\n            a[i][j] = (char *) NULL;\n    }\n\n    if (argc < 2 || (argc > 2 && argc < 4)) \n        print_usage(argv[0]);\n    if (argc > 2) {\n        if (strncmp(argv[1], \"-c\", 2)) \n            print_usage(argv[0]);\n        strncpy(cmd, argv[2], CMD_LEN);\n        strncat(cmd, \" \", CMD_LEN);\n        argv += 2;\n    }\n    a[0][0] = cmd;\n    nsts[0] = 1;\n\n    for (j = 1, str1 = argv[1], nt = 0; ; j++, str1 = NULL, ++nt) {\n        token = strtok_r(str1, delim, &saveptr1);\n        if (token == NULL)\n            break;\n        //printf(\"%d: %s\\n\", j, token);\n\n        for (str2 = token, nst = 0; ; str2 = NULL, ++nst) {\n            subtoken = strtok_r(str2, subdelim, &saveptr2);\n            if (subtoken == NULL)\n                break;\n            //printf(\" --> %s\\n\", subtoken);\n            a[nt + 1][nst] = subtoken;\n        }\n        total_paths *= nst;\n        if (total_paths > MAX_PATHS) {\n            fprintf(stderr, \"%s: Total generated paths %d > %d\\n\",\n                    argv[0], total_paths, MAX_PATHS);\n            exit(EXIT_FAILURE);\n        }\n        nsts[nt + 1] = nst;\n    }\n    xpaths = total_paths;\n    for (i = 0; i < nt + 1; ++i) {\n        nst = nsts[i];\n        if (nst == 1) {\n            for (k = 0; k < total_paths; ++k) \n                strncat(cmds[k], a[i][0], CMD_LEN);\n        }\n        else {\n            xpaths = xpaths / nst;\n            for (k = 0; k < total_paths; ++k) {\n                j = (k / xpaths) % nst;\n                strncat(cmds[k], a[i][j], CMD_LEN);\n            }\n        }\n    }\n\n    for (i = 0; i < total_paths; ++i) {\n        printf(\"Running: %s\\n\", cmds[i]);\n        retval = system(cmds[i]);    // hadoop returns 0 - 255\n        if (retval != 0) {\n            exit_code = ~(retval & 0x000000FF);   // Get exit code as LSB \n            // remove comment for not to check remaining\n            //exit(exit_code);     \n        }\n    }\n\n    return (exit_code);\n} /* main */\n//-------------------------------------------------------------\n{code}\n\nCompilation on Linux/Unix\n{noformat}\n$ gcc -Wall -o hadoop_fs_ls_globbing hadoop_fs_ls_globbing.c\n{noformat}\n\n\nNow the above c program supports custom hadoop command (with option flag -c), for example \n\"hadoop fs -ls\"\n\"hadoop fs -test -e\"\n{noformat}\n$ ./hadoop_fs_ls_globbing -c \"hadoop fs -test -e\" \"input/20110{4,1}/{A,B}\"; echo $?\nRunning: hadoop fs -test -e input/201104/A\nRunning: hadoop fs -test -e input/201104/B\nRunning: hadoop fs -test -e input/201101/A\nRunning: hadoop fs -test -e input/201101/B\n255    <*****\n$ ./hadoop_fs_ls_globbing -c \"hadoop fs -ls\" \"input/20110{4,1}/{A,B}\"; echo $?\nRunning: hadoop fs -ls input/201104/A\nls: Cannot access input/201104/A: No such file or directory.\nRunning: hadoop fs -ls input/201104/B\nls: Cannot access input/201104/B: No such file or directory.\nRunning: hadoop fs -ls input/201101/A\nFound 2 items\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201101/A/1\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201101/A/2\nRunning: hadoop fs -ls input/201101/B\nFound 2 items\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201101/B/1\ndrwxr-xr-x   - mitesh supergroup          0 2011-12-15 11:51 /user/mitesh/input/201101/B/2\n255   <*****\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miteshsjat","name":"miteshsjat","key":"miteshsjat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mitesh Singh Jat","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-02-24T06:27:06.516+0000","updated":"2012-02-24T06:27:06.516+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535256/comment/14551070","id":"14551070","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviprak","name":"raviprak","key":"raviprak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=raviprak&avatarId=10113","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=raviprak&avatarId=10113","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=raviprak&avatarId=10113","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=raviprak&avatarId=10113"},"displayName":"Ravi Prakash","active":true,"timeZone":"America/Los_Angeles"},"body":"I don't think we plan to fix this in the 0.20 or branch-1 line ever. Closing as Won't Fix. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviprak","name":"raviprak","key":"raviprak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=raviprak&avatarId=10113","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=raviprak&avatarId=10113","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=raviprak&avatarId=10113","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=raviprak&avatarId=10113"},"displayName":"Ravi Prakash","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-19T19:28:33.773+0000","updated":"2015-05-19T19:28:33.773+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-2685/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0jv1r:"}}