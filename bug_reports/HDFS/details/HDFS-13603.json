{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13161264","self":"https://issues.apache.org/jira/rest/api/2/issue/13161264","key":"HDFS-13603","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed May 23 15:21:54 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-13603/watchers","watchCount":5,"isWatching":false},"created":"2018-05-23T00:28:47.399+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329057","id":"12329057","description":"2.8.0 release","name":"2.8.0","archived":false,"released":true,"releaseDate":"2017-03-22"}],"issuelinks":[{"id":"12534777","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12534777","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12911703","key":"HDFS-9405","self":"https://issues.apache.org/jira/rest/api/2/issue/12911703","fields":{"summary":"Warmup NameNode EDEK caches in background thread","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-05-23T15:22:22.040+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12323800","id":"12323800","name":"encryption"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"https://issues.apache.org/jira/browse/HDFS-9405 adds a background thread to pre-warm EDEK cache. \r\n\r\nHowever this fails and retries continuously if key retrieval fails for one encryption zone. In our usecase, we have temporarily removed keys for certain encryption zones.  Currently namenode and kms log is filled up with errors related to background thread retrying warmup for ever .\r\n\r\nThe pre-warm thread should\r\n * Continue to refresh other encryption zones even if it fails for one\r\n * Should retry only if it fails for all encryption zones, which will be the case when kms is down.\r\n\r\n ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Warmup NameNode EDEK thread retries continuously if there's an invalid key ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aajayaraj","name":"aajayaraj","key":"aajayaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34057","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"},"displayName":"Antony Jay","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aajayaraj","name":"aajayaraj","key":"aajayaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34057","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"},"displayName":"Antony Jay","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13161264/comment/16487460","id":"16487460","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aajayaraj","name":"aajayaraj","key":"aajayaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34057","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"},"displayName":"Antony Jay","active":true,"timeZone":"America/Los_Angeles"},"body":"{{ }}\r\n{{[2018-05-23 14:20:44,952] WARN [http-16000-11] (server.KMS) -hdfs- User hdfs/node0032.hostname.com@domain (auth:KERBEROS) request GET [https://node0038.hostname.com:16000/kms/v1/key/encrypt_keyname/_eek?num_keys=150&eek_op=generate] caused exception.}}\r\n{{ java.io.IOException: com.google.common.util.concurrent.UncheckedExecutionException: java.lang.NullPointerException: No KeyVersion exists for key 'encrypt_keyname'}}\r\n{{ at org.apache.hadoop.crypto.key.kms.server.KMS.generateEncryptedKeys(KMS.java:517)}}\r\n{{ at sun.reflect.GeneratedMethodAccessor45.invoke(Unknown Source)}}\r\n{{ at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)}}\r\n{{ at java.lang.reflect.Method.invoke(Method.java:498)}}\r\n{{ at com.sun.jersey.spi.container.JavaMethodInvokerFactory$1.invoke(JavaMethodInvokerFactory.java:60)}}\r\n{{ at com.sun.jersey.server.impl.model.method.dispatch.AbstractResourceMethodDispatchProvider$ResponseOutInvoker._dispatch(AbstractResourceMethodDispatchProvider.java:205)}}\r\n{{ at com.sun.jersey.server.impl.model.method.dispatch.ResourceJavaMethodDispatcher.dispatch(ResourceJavaMethodDispatcher.java:75)}}\r\n{{ at com.sun.jersey.server.impl.uri.rules.HttpMethodRule.accept(HttpMethodRule.java:288)}}\r\n{{ at com.sun.jersey.server.impl.uri.rules.RightHandPathRule.accept(RightHandPathRule.java:147)}}\r\n{{ at com.sun.jersey.server.impl.uri.rules.ResourceClassRule.accept(ResourceClassRule.java:108)}}\r\n{{ at com.sun.jersey.server.impl.uri.rules.RightHandPathRule.accept(RightHandPathRule.java:147)}}\r\n{{ at com.sun.jersey.server.impl.uri.rules.RootResourceClassesRule.accept(RootResourceClassesRule.java:84)}}\r\n{{ at com.sun.jersey.server.impl.application.WebApplicationImpl._handleRequest(WebApplicationImpl.java:1469)}}\r\n{{ at com.sun.jersey.server.impl.application.WebApplicationImpl._handleRequest(WebApplicationImpl.java:1400)}}\r\n{{ at com.sun.jersey.server.impl.application.WebApplicationImpl.handleRequest(WebApplicationImpl.java:1349)}}\r\n{{ at com.sun.jersey.server.impl.application.WebApplicationImpl.handleRequest(WebApplicationImpl.java:1339)}}\r\n{{ at com.sun.jersey.spi.container.servlet.WebComponent.service(WebComponent.java:416)}}\r\n{{ at com.sun.jersey.spi.container.servlet.ServletContainer.service(ServletContainer.java:537)}}\r\n{{ at com.sun.jersey.spi.container.servlet.ServletContainer.service(ServletContainer.java:699)}}\r\n{{ at javax.servlet.http.HttpServlet.service(HttpServlet.java:723)}}\r\n{{ at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)}}\r\n{{ at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)}}\r\n{{ at org.apache.hadoop.crypto.key.kms.server.KMSMDCFilter.doFilter(KMSMDCFilter.java:84)}}\r\n{{ at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)}}\r\n{{ at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)}}\r\n{{ at org.apache.hadoop.security.authentication.server.AuthenticationFilter.doFilter(AuthenticationFilter.java:631)}}\r\n{{ at org.apache.hadoop.security.token.delegation.web.DelegationTokenAuthenticationFilter.doFilter(DelegationTokenAuthenticationFilter.java:301)}}\r\n{{ at org.apache.hadoop.security.authentication.server.AuthenticationFilter.doFilter(AuthenticationFilter.java:579)}}\r\n{{ at org.apache.hadoop.crypto.key.kms.server.KMSAuthenticationFilter.doFilter(KMSAuthenticationFilter.java:130)}}\r\n{{ at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)}}\r\n{{ at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)}}\r\n{{ at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)}}\r\n{{ at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)}}\r\n{{ at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)}}\r\n{{ at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)}}\r\n{{ at java.lang.Thread.run(Thread.java:748)}}\r\n{{ Caused by: java.util.concurrent.ExecutionException: java.io.IOException: com.google.common.util.concurrent.UncheckedExecutionException: java.lang.NullPointerException: No KeyVersion exists for key 'encrypt_keyname'}}\r\n{{ at com.google.common.util.concurrent.AbstractFuture$Sync.getValue(AbstractFuture.java:289)}}\r\n{{ at com.google.common.util.concurrent.AbstractFuture$Sync.get(AbstractFuture.java:276)}}\r\n{{ at com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:111)}}\r\n{{ at com.google.common.util.concurrent.Uninterruptibles.getUninterruptibly(Uninterruptibles.java:132)}}\r\n{{ at com.google.common.cache.LocalCache$Segment.getAndRecordStats(LocalCache.java:2381)}}\r\n{{ at com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2351)}}\r\n{{ at com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2313)}}\r\n{{ at com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2228)}}\r\n{{ at com.google.common.cache.LocalCache.get(LocalCache.java:3965)}}\r\n{{ at com.google.common.cache.LocalCache.getOrLoad(LocalCache.java:3969)}}\r\n{{ at com.google.common.cache.LocalCache$LocalManualCache.get(LocalCache.java:4829)}}\r\n{{ at org.apache.hadoop.crypto.key.kms.ValueQueue.initializeQueuesForKeys(ValueQueue.java:274)}}\r\n{{ at org.apache.hadoop.crypto.key.kms.KMSClientProvider.warmUpEncryptedKeys(KMSClientProvider.java:886)}}\r\n{{ ... 5 more}}\r\n{{ Caused by: java.io.IOException: com.google.common.util.concurrent.UncheckedExecutionException: java.lang.NullPointerException: No KeyVersion exists for key 'encrypt_keyname'}}\r\n{{ at sun.reflect.GeneratedConstructorAccessor81.newInstance(Unknown Source)}}\r\n{{ at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)}}\r\n{{ at java.lang.reflect.Constructor.newInstance(Constructor.java:423)}}\r\n{{ at org.apache.hadoop.util.HttpExceptionUtils.validateResponse(HttpExceptionUtils.java:157)}}\r\n{{ at org.apache.hadoop.crypto.key.kms.KMSClientProvider.call(KMSClientProvider.java:527)}}\r\n{{ at org.apache.hadoop.crypto.key.kms.KMSClientProvider.call(KMSClientProvider.java:488)}}\r\n{{ at org.apache.hadoop.crypto.key.kms.KMSClientProvider.access$200(KMSClientProvider.java:94)}}\r\n{{ at org.apache.hadoop.crypto.key.kms.KMSClientProvider$EncryptedQueueRefiller.fillQueueForKey(KMSClientProvider.java:149)}}\r\n{{ at org.apache.hadoop.crypto.key.kms.ValueQueue$1.load(ValueQueue.java:246)}}\r\n{{ at org.apache.hadoop.crypto.key.kms.ValueQueue$1.load(ValueQueue.java:240)}}\r\n{{ at com.google.common.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3568)}}\r\n{{ at com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2350)}}\r\n{{ ... 12 more}}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aajayaraj","name":"aajayaraj","key":"aajayaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34057","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"},"displayName":"Antony Jay","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-05-23T15:21:54.969+0000","updated":"2018-05-23T15:22:22.033+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-13603/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3u18v:"}}