{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12617248","self":"https://issues.apache.org/jira/rest/api/2/issue/12617248","key":"HDFS-4222","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321657","id":"12321657","description":"1.2.0 release","name":"1.2.0","archived":false,"released":true,"releaseDate":"2013-05-13"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323955","id":"12323955","description":"0.23.7 release","name":"0.23.7","archived":false,"released":true,"releaseDate":"2013-04-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324031","id":"12324031","description":"2.1.0-beta release","name":"2.1.0-beta","archived":false,"released":true,"releaseDate":"2013-08-22"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-11-22T18:36:25.203+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed May 15 05:15:53 UTC 2013","customfield_12310420":"259455","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_187414452_*|*_1_*:*_2_*:*_8001589308_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-02-24T19:50:56.836+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-4222/watchers","watchCount":16,"isWatching":false},"created":"2012-11-22T01:07:33.123+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12318243","id":"12318243","description":"1.0.0 release","name":"1.0.0","archived":false,"released":true,"releaseDate":"2011-12-27"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12320052","id":"12320052","description":"0.23.3","name":"0.23.3","archived":false,"released":true,"releaseDate":"2012-09-20"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12320353","id":"12320353","description":"hadoop-2.0.0-alpha release","name":"2.0.0-alpha","archived":false,"released":true,"releaseDate":"2012-05-23"}],"issuelinks":[{"id":"12366061","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12366061","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12638145","key":"HDFS-4622","self":"https://issues.apache.org/jira/rest/api/2/issue/12638145","fields":{"summary":"Remove redundant synchronized from FSNamesystem#rollEditLog in branch-1","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/5","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/trivial.svg","name":"Trivial","id":"5"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-15T05:15:53.987+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"For Hadoop clusters configured to access directory information by LDAP, the FSNamesystem calls on behave of DFS clients might hang due to LDAP issues (including LDAP access issues caused by networking issues) while holding the single lock of FSNamesystem. That will result in the NN unresponsive and loss of the heartbeats from DNs.\n\nThe places LDAP got accessed by FSNamesystem calls are the instantiation of FSPermissionChecker, which could be moved out of the lock scope since the instantiation does not need the FSNamesystem lock. After the move, a DFS client hang will not affect other threads by hogging the single lock. This is especially helpful when we use separate RPC servers for ClientProtocol and DatanodeProtocol since the calls for DatanodeProtocol do not need to access LDAP. So even if DFS clients hang due to LDAP issues, the NN will still be able to process the requests (including heartbeats) from DNs.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12570416","id":"12570416","filename":"HDFS-4222.23.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-22T05:26:55.793+0000","size":28964,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12570416/HDFS-4222.23.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12570230","id":"12570230","filename":"HDFS-4222.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-21T00:49:12.949+0000","size":30581,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12570230/HDFS-4222.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12570045","id":"12570045","filename":"HDFS-4222.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-20T01:22:18.472+0000","size":27238,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12570045/HDFS-4222.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12568928","id":"12568928","filename":"hdfs-4222-branch-0.23.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-12T05:06:41.889+0000","size":29304,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12568928/hdfs-4222-branch-0.23.3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12570612","id":"12570612","filename":"HDFS-4222-branch-1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-23T06:00:06.869+0000","size":50555,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12570612/HDFS-4222-branch-1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12568929","id":"12568929","filename":"hdfs-4222-release-1.0.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-12T05:06:41.893+0000","size":46204,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12568929/hdfs-4222-release-1.0.3.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"124744","customfield_12312823":null,"summary":"NN is unresponsive and loses heartbeats of DNs when Hadoop is configured to use LDAP and LDAP has issues","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13502504","id":"13502504","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"body":"The following code snippets show a simple way to change FSNamesystem::renameTo in branch-0.23.4. Changes to other methods are similar.\n\n//////////// existent code\n  /** Rename src to dst */\n  void renameTo(String src, String dst, Options.Rename... options)\n      throws IOException, UnresolvedLinkException {\n...\n    writeLock();\n    try {\n      renameToInternal(src, dst, options);\n      if (auditLog.isInfoEnabled() && isExternalInvocation()) {\n        resultingStat = dir.getFileInfo(dst, false); \n      }\n    } finally {\n      writeUnlock();\n    }\n...\n  }\n\n\n  private void renameToInternal(String src, String dst,\n      Options.Rename... options) throws IOException {\n...\n    if (isPermissionEnabled) {\n      checkParentAccess(src, FsAction.WRITE);\n      checkAncestorAccess(dst, FsAction.WRITE);\n    }\n...\n  }\n\n\n  private FSPermissionChecker checkParentAccess(String path, FsAction access\n      ) throws AccessControlException, UnresolvedLinkException {\n    return checkPermission(path, false, null, access, null, null);\n  }\n\n\n  private FSPermissionChecker checkPermission(String path, boolean doCheckOwner,\n      FsAction ancestorAccess, FsAction parentAccess, FsAction access,\n      FsAction subAccess) throws AccessControlException, UnresolvedLinkException {\n    FSPermissionChecker pc = new FSPermissionChecker(\n        fsOwner.getShortUserName(), supergroup);\n    if (!pc.isSuper) {\n      dir.waitForReady();\n      readLock();\n      try {\n        pc.checkPermission(path, dir.rootDir, doCheckOwner,\n            ancestorAccess, parentAccess, access, subAccess);\n      } finally {\n        readUnlock();\n      } \n    }\n    return pc;\n  }\n\n//////////// proposed changes\n  /** Rename src to dst */\n  void renameTo(String src, String dst, Options.Rename... options)\n      throws IOException, UnresolvedLinkException {\n...\n    FSPermissionChecker pc = new FSPermissionChecker(\n        fsOwner.getShortUserName(), supergroup);\n\n    writeLock();\n    try {\n      renameToInternal(pc, src, dst, options);\n      if (auditLog.isInfoEnabled() && isExternalInvocation()) {\n        resultingStat = dir.getFileInfo(dst, false); \n      }\n    } finally {\n      writeUnlock();\n    }\n...\n  }\n\n\n  private void renameToInternal(FSPermissionChecker pc, String src, String dst,\n      Options.Rename... options) throws IOException {\n...\n    if (isPermissionEnabled) {\n      checkParentAccess(pc, src, FsAction.WRITE);\n      checkAncestorAccess(pc, dst, FsAction.WRITE);\n    }\n...\n  }\n\n\n  private FSPermissionChecker checkParentAccess(FSPermissionChecker pc, String path, FsAction access\n      ) throws AccessControlException, UnresolvedLinkException {\n    return checkPermission(pc, path, false, null, access, null, null);\n  }\n\n\n  private FSPermissionChecker checkPermission(FSPermissionChecker pc, String path, boolean doCheckOwner,\n      FsAction ancestorAccess, FsAction parentAccess, FsAction access,\n      FsAction subAccess) throws AccessControlException, UnresolvedLinkException {\n    if (!pc.isSuper) {\n      dir.waitForReady();\n      readLock();\n      try {\n        pc.checkPermission(path, dir.rootDir, doCheckOwner,\n            ancestorAccess, parentAccess, access, subAccess);\n      } finally {\n        readUnlock();\n      } \n    }\n    return pc;\n  }\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-22T01:09:16.104+0000","updated":"2012-11-22T01:09:16.104+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13502521","id":"13502521","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"body":"Sorry the former comment did not format well. I'm trying to format it now.\n\nThe following code snippets show a simple way to change FSNamesystem::renameTo in branch-0.23.4. Changes to other methods are similar.\n\n//////////// existent code\n{code:borderStyle=solid}\n  /** Rename src to dst */\n  void renameTo(String src, String dst, Options.Rename... options)\n      throws IOException, UnresolvedLinkException {\n...\n    writeLock();\n    try {\n      renameToInternal(src, dst, options);\n      if (auditLog.isInfoEnabled() && isExternalInvocation()) {\n        resultingStat = dir.getFileInfo(dst, false); \n      }\n    } finally {\n      writeUnlock();\n    }\n...\n  }\n\n\n  private void renameToInternal(String src, String dst,\n      Options.Rename... options) throws IOException {\n...\n    if (isPermissionEnabled) {\n      checkParentAccess(src, FsAction.WRITE);\n      checkAncestorAccess(dst, FsAction.WRITE);\n    }\n...\n  }\n\n\n  private FSPermissionChecker checkParentAccess(String path, FsAction access\n      ) throws AccessControlException, UnresolvedLinkException {\n    return checkPermission(path, false, null, access, null, null);\n  }\n\n\n  private FSPermissionChecker checkPermission(String path, boolean doCheckOwner,\n      FsAction ancestorAccess, FsAction parentAccess, FsAction access,\n      FsAction subAccess) throws AccessControlException, UnresolvedLinkException {\n    FSPermissionChecker pc = new FSPermissionChecker(\n        fsOwner.getShortUserName(), supergroup);\n    if (!pc.isSuper) {\n      dir.waitForReady();\n      readLock();\n      try {\n        pc.checkPermission(path, dir.rootDir, doCheckOwner,\n            ancestorAccess, parentAccess, access, subAccess);\n      } finally {\n        readUnlock();\n      } \n    }\n    return pc;\n  }\n{code}\n\n//////////// proposed changes\n{code:borderStyle=solid}\n  /** Rename src to dst */\n  void renameTo(String src, String dst, Options.Rename... options)\n      throws IOException, UnresolvedLinkException {\n...\n    FSPermissionChecker pc = new FSPermissionChecker(\n        fsOwner.getShortUserName(), supergroup);\n\n    writeLock();\n    try {\n      renameToInternal(pc, src, dst, options);\n      if (auditLog.isInfoEnabled() && isExternalInvocation()) {\n        resultingStat = dir.getFileInfo(dst, false); \n      }\n    } finally {\n      writeUnlock();\n    }\n...\n  }\n\n\n  private void renameToInternal(FSPermissionChecker pc, String src, String dst,\n      Options.Rename... options) throws IOException {\n...\n    if (isPermissionEnabled) {\n      checkParentAccess(pc, src, FsAction.WRITE);\n      checkAncestorAccess(pc, dst, FsAction.WRITE);\n    }\n...\n  }\n\n\n  private FSPermissionChecker checkParentAccess(FSPermissionChecker pc, String path, FsAction access\n      ) throws AccessControlException, UnresolvedLinkException {\n    return checkPermission(pc, path, false, null, access, null, null);\n  }\n\n\n  private FSPermissionChecker checkPermission(FSPermissionChecker pc, String path, boolean doCheckOwner,\n      FsAction ancestorAccess, FsAction parentAccess, FsAction access,\n      FsAction subAccess) throws AccessControlException, UnresolvedLinkException {\n    if (!pc.isSuper) {\n      dir.waitForReady();\n      readLock();\n      try {\n        pc.checkPermission(path, dir.rootDir, doCheckOwner,\n            ancestorAccess, parentAccess, access, subAccess);\n      } finally {\n        readUnlock();\n      } \n    }\n    return pc;\n  }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-22T01:37:17.344+0000","updated":"2012-11-22T01:37:17.344+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13502891","id":"13502891","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"Xiaobo, I think given that you described the change briefly earlier, the best way to cover the complete change is to by posting a patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-22T18:36:25.203+0000","updated":"2012-11-22T18:36:25.203+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13576383","id":"13576383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"body":"I manually tested the patch on release-1.0.3. Looks like we have some perf gain also.\n\nI will test hdfs-4222-branch-0.23.3.patch soon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-12T05:06:41.897+0000","updated":"2013-02-12T05:06:41.897+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13576388","id":"13576388","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"body":"Please review my patches. hdfs-4222-branch-0.23.3.patch should be easier to review. hdfs-4222-release-1.0.3.patch is messy since moving synchronized scopes result in reformatting.\n \nI think we should enclose all FSPermissionChecker instantiations in \"if (isPermissionEnabled)\" blocks as follows,\n\n    FSPermissionChecker pc = null;\n    if (isPermissionEnabled) {\n      pc = new FSPermissionChecker(fsOwner.getShortUserName(), supergroup);\n    }\n\nBut I have not done so because I want to limit the impact of this changes. If you know it is totally safe to do such changes, please let me know. Thanks a lot.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-12T05:16:04.022+0000","updated":"2013-02-12T05:16:04.022+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13579683","id":"13579683","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"body":"What branches should my patches be prepared for? trunk or branch-1 or branch-2 or branch-0.23.6? Thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-16T02:30:46.664+0000","updated":"2013-02-16T02:30:46.664+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13581594","id":"13581594","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"[~teledriver]Thanks for working on this. I will review this shortly. Please make the patch available for trunk first. Along with it, you can also make patch available for branch-1. For branch-2 and branch-0.23.6 the patch can be merged usually. If it cannot be, then I will let you know.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-19T20:24:24.743+0000","updated":"2013-02-19T20:24:24.743+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13581637","id":"13581637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"body":"Suresh, Thanks a lot. I should finish what you suggested within 2 days.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-19T21:20:04.113+0000","updated":"2013-02-19T21:20:04.113+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13581827","id":"13581827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"Xiaobo, as I was reviewing the code, I started making some changes. Let me post my patch as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-20T01:09:14.470+0000","updated":"2013-02-20T01:09:14.470+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13581839","id":"13581839","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"Changes in this patch:\n# Introduced {{FSNamesystem#fsOwnerShortUserName}} to avoid getting short username from a UGI {{FSNamesystem#fsOwner}} every time {{FSPermissionChecker}} is used.\n# Made changes to create FSPermissionChecker outside the FSNamesystem read and write lock. This is along the lines of the work Xiaobo has done.\n# Documented the synchronization semantics in FSPermissionChecker and made some members final.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-20T01:22:18.476+0000","updated":"2013-02-20T01:22:18.476+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13581909","id":"13581909","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12570045/HDFS-4222.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/3986//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/3986//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-20T03:05:09.561+0000","updated":"2013-02-20T03:05:09.561+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13582433","id":"13582433","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"Nice change.  I've quickly scanned the patch and {{checkSuperuserPrivilege}} internally instantiates a permission checker, which appears to be getting called within the namespace lock in a number of places too.\n\nTo reduce the size of the patch, would it maybe make sense to use a thread-local permission checker singleton?  Ie. {{FsPermissionChecker.init()}}  sets the thread-local for the current user, and then {{FsPermissionChecker.getInstance()}} instead of {{new FsPermissionChecker}} returns the singleton?  Just a thought.\n\nAnother thought might be an option to tell a UGI to \"lock-in\" it's group list.  Something earlier on at a high level, maybe the NN's RPC server, could call {{UserGroupInformation.getCurrentUser().lockGroups()}}.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2013-02-20T19:17:07.155+0000","updated":"2013-02-20T19:17:07.155+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13582479","id":"13582479","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Nice change. I've quickly scanned the patch and checkSuperuserPrivilege internally instantiates a permission checker, which appears to be getting called within the namespace lock in a number of places too.\nGood catch.\n\nbq. To reduce the size of the patch, would it maybe make sense to use a thread-local permission checker singleton? Ie. FsPermissionChecker.init() sets the thread-local for the current user, and then FsPermissionChecker.getInstance() instead of new FsPermissionChecker returns the singleton? Just a thought.\nNot sure how to make this work. When does thread local variable get initialized and when is it cleared, given a thread gets used for different current users?\n\nbq. Another thought might be an option to tell a UGI to \"lock-in\" it's group list. Something earlier on at a high level, maybe the NN's RPC server, could call UserGroupInformation.getCurrentUser().lockGroups().\nNot sure I understood this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-20T19:56:39.183+0000","updated":"2013-02-20T19:56:39.183+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13582737","id":"13582737","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"Updated patch to address Daryn's comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-21T00:49:12.952+0000","updated":"2013-02-21T00:49:12.952+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13582812","id":"13582812","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12570230/HDFS-4222.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/3990//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/3990//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-21T02:25:51.321+0000","updated":"2013-02-21T02:25:51.321+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13583245","id":"13583245","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"bq. Not sure how to make this work. When does thread local variable get initialized and when is it cleared, given a thread gets used for different current users?\n\nPerhaps init-ed in the same places where {{getPermissionChecker}} is being invoked, or ideally at a higher level to avoid all command methods from having \"to do the right\".\n\nbq. bq. Another thought might be an option to tell a UGI to \"lock-in\" it's group list. Something earlier on at a high level, maybe the NN's RPC server, could call UserGroupInformation.getCurrentUser().lockGroups().\nbq. Not sure I understood this.\n\n\"lockGroups\" would internally fetch the groups and then make them immutable in the UGI.  It could be invoked where {{getPermissionChecker}} is being invoked, or ideally at a higher level chokepoint for calls so it's a one-line change.  Maybe in the rpc call's doAs since a call shouldn't be running long enough that the groups will change.  This would inoculate future methods or overlooked methods from taking the lookup penalty within a lock.\n\nIn either case, I'm just trying to think of how to simplify the change and future-proof against similar issues.  Again though, I really like this change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2013-02-21T14:54:26.739+0000","updated":"2013-02-21T14:54:26.739+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13583299","id":"13583299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Perhaps init-ed in the same places where getPermissionChecker is being invoked, or ideally at a higher level to avoid all command methods from having \"to do the right\".\nOnly problem is, if subsequent methods are not passed FSPermissionChecker, they might end up calling getPermissionChecker (due to a bug) as well, that too inside the lock. The likelihood of that with parameter passing is low.\n\nbq. \"lockGroups\" would internally fetch the groups and then make them immutable in the UGI....\nWe should certainly explore this in a subsequent jira.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-21T15:50:09.992+0000","updated":"2013-02-21T15:50:09.992+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13583310","id":"13583310","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"bq. \"lockGroups\" would internally fetch the groups and then make them immutable in the UGI. \n\nThis will ensure group lookups happen before entering a critical section. But since mappings are cached in Groups and the UGI is short-lived, simply calling getGroups() early will be enough. One concern in early lookup is whether it will generate excessive extra lookups. Some methods in client protocol don't need permission checks as they are lease-based. For example, addBlock(), complete() and renewLease() are lease-based and their request rate is quite high. In a busy grid, they add up to over 450 requests/sec. But again, caching may reduce actual lookups, so it may not be a big deal.\n\nIf unconditionally forced early lookup is not acceptable, we could selectively do early lookup/cache-filling in NameNodeRpcServer for those calls that actually need group lookups and leave FSNamesystem mostly unchanged.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2013-02-21T16:08:07.796+0000","updated":"2013-02-21T16:08:07.796+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13583373","id":"13583373","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. If unconditionally forced early lookup is not acceptable...\nCurrent patch could have been much simpler, if FSPermissionChecker was always created. Lets do further optimizations in another patch.\n\nIf someone reviews this and +1s it, I will commit it. I plan on getting this into branch-1 as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-21T17:44:19.113+0000","updated":"2013-02-21T17:44:19.113+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13583525","id":"13583525","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"+1 The latest patch looks good to me. Future-proofing can be done separately if needed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2013-02-21T20:29:41.297+0000","updated":"2013-02-21T20:29:41.297+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13583552","id":"13583552","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"I committed the patch to trunk and branch-2. Keeping this jira open to make this change available for branch-1.\n\nThank you [~teledriver] for the original patch. Kihwal and Daryn, thanks for the review.\n\nKihwal, do you want me to commit this to branch 0.23?\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-21T21:09:55.663+0000","updated":"2013-02-21T21:09:55.663+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13583556","id":"13583556","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-trunk-Commit #3375 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/3375/])\n    HDFS-4222. NN is unresponsive and loses heartbeats from DNs when configured to use LDAP and LDAP has issues. Contributed by Xiaobo Peng and Suresh Srinivas. (Revision 1448801)\n\n     Result = SUCCESS\nsuresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1448801\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSPermissionChecker.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-21T21:14:31.438+0000","updated":"2013-02-21T21:14:31.438+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13583584","id":"13583584","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"bq. Kihwal, do you want me to commit this to branch 0.23?\n\nYes. Thanks Suresh.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2013-02-21T21:57:01.881+0000","updated":"2013-02-21T21:57:01.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13583923","id":"13583923","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"Canceling the patch to attach 0.23 patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-22T05:26:09.623+0000","updated":"2013-02-22T05:26:09.623+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13583924","id":"13583924","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"The merge was not straightforward. Kihwal, can you also do a quick review of 0.23 version of the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-22T05:26:55.797+0000","updated":"2013-02-22T05:26:55.797+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13584172","id":"13584172","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Yarn-trunk #135 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/135/])\n    HDFS-4222. NN is unresponsive and loses heartbeats from DNs when configured to use LDAP and LDAP has issues. Contributed by Xiaobo Peng and Suresh Srinivas. (Revision 1448801)\n\n     Result = SUCCESS\nsuresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1448801\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSPermissionChecker.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-22T10:46:49.921+0000","updated":"2013-02-22T10:46:49.921+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13584236","id":"13584236","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Hdfs-trunk #1324 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1324/])\n    HDFS-4222. NN is unresponsive and loses heartbeats from DNs when configured to use LDAP and LDAP has issues. Contributed by Xiaobo Peng and Suresh Srinivas. (Revision 1448801)\n\n     Result = FAILURE\nsuresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1448801\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSPermissionChecker.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-22T12:54:12.031+0000","updated":"2013-02-22T12:54:12.031+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13584288","id":"13584288","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Mapreduce-trunk #1352 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1352/])\n    HDFS-4222. NN is unresponsive and loses heartbeats from DNs when configured to use LDAP and LDAP has issues. Contributed by Xiaobo Peng and Suresh Srinivas. (Revision 1448801)\n\n     Result = SUCCESS\nsuresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1448801\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java\n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSPermissionChecker.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-22T14:05:16.126+0000","updated":"2013-02-22T14:05:16.126+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13584351","id":"13584351","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"The 0.23 patch looks fine. I also tried to resolve merge conflicts and ended up with pretty much the same patch as yours. The only significant code difference seems to be in getBlockLocations().","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2013-02-22T15:32:42.927+0000","updated":"2013-02-22T15:32:42.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13584371","id":"13584371","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Kihwal. I committed the patch to 0.23 branch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-22T15:59:52.024+0000","updated":"2013-02-22T15:59:52.024+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13585028","id":"13585028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"body":"Many thanks to Suresh, Kihwal, and Daryn for the help. I am uploading the patch for branch-1. Please review.\n\nI have to move the synchronized keyword from the method level to the block level. So there are many lines got reformatted. I reviewed my patch several times. It was time consuming. Thanks a lot.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-23T06:00:06.872+0000","updated":"2013-02-23T06:00:06.872+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13585107","id":"13585107","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Hdfs-0.23-Build #534 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/534/])\n    HDFS-4222. Merge r1448801 from trunk (Revision 1449083)\n\n     Result = SUCCESS\nsuresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1449083\nFiles : \n* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java\n* /hadoop/common/branches/branch-0.23/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSPermissionChecker.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-23T12:40:50.769+0000","updated":"2013-02-23T12:40:50.769+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13585469","id":"13585469","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"[~teledriver], thanks for working branch-1 patch. +1 for the patch. I will commit it soon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-24T19:43:49.221+0000","updated":"2013-02-24T19:43:49.221+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13585473","id":"13585473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"I committed the patch to branch-1 as well. Thank you Xiaobo!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-24T19:50:56.865+0000","updated":"2013-02-24T19:50:56.865+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13585654","id":"13585654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"body":"Thank you very much for the quick action, Suresh.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teledriver","name":"teledriver","key":"teledriver","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobo Peng","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-25T06:26:56.939+0000","updated":"2013-02-25T06:26:56.939+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12617248/comment/13657958","id":"13657958","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mattf","name":"mattf","key":"mattf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Foley","active":true,"timeZone":"America/Los_Angeles"},"body":"Closed upon release of Hadoop 1.2.0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mattf","name":"mattf","key":"mattf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Foley","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-05-15T05:15:53.978+0000","updated":"2013-05-15T05:15:53.978+0000"}],"maxResults":36,"total":36,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-4222/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0lp9r:"}}