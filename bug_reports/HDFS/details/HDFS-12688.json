{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13110772","self":"https://issues.apache.org/jira/rest/api/2/issue/13110772","key":"HDFS-12688","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/10004","id":"10004","description":"Not A Bug","name":"Not A Bug"},"customfield_12312322":null,"customfield_12310220":"2017-10-19T21:00:28.895+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Oct 20 16:24:17 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_76049536_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2017-10-20T16:24:17.830+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-12688/watchers","watchCount":2,"isWatching":false},"created":"2017-10-19T19:16:48.363+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327181","id":"12327181","description":"2.6.0 release","name":"2.6.0","archived":false,"released":true,"releaseDate":"2014-11-18"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-10-20T16:24:17.894+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12329603","id":"12329603","name":"hdfs"}],"timeoriginalestimate":null,"description":"Wrote a simple script to delete and create a file and ran it multiple times. However, some executions of the script randomly threw a FileAlreadyExists error while the others succeeded despite successful hdfs dfs -rm command. The script is as below, I have reproduced it in two different environments -- \r\n\r\nhdfs dfs -ls  /user/shriya/shell_test/\r\necho \"starting hdfs remove **************\" \r\nhdfs dfs -rm -r -f /user/shriya/shell_test/wordcountOutput\r\n echo \"hdfs compeleted!\"\r\nhdfs dfs -ls  /user/shriya/shell_test/\r\necho \"starting mapReduce*******************************\"\r\nmapred job -libjars /data/home/shriya/shell_test/hadoop-mapreduce-client-jobclient-2.7.1.jar -submit /data/home/shriya/shell_test/wordcountJob.xml\r\n\r\nThe message confirming successful move -- \r\n\r\n17/10/19 14:49:12 INFO fs.TrashPolicyDefault: Moved: 'hdfs://nameservice1/user/shriya/shell_test/wordcountOutput' to trash at: hdfs://nameservice1/user/shriya/.Trash/Current/user/shriya/shell_test/wordcountOutput1508438952728\r\n\r\nThe contents of subsequent -ls after -rm also showed that the file still existed)\r\n\r\nThe error I got when my MapReduce job tried to create the file -- \r\n\r\n17/10/19 14:50:00 WARN security.UserGroupInformation: PriviledgedActionException as:<REDACTED> (auth:KERBEROS) cause:org.apache.hadoop.mapred.FileAlreadyExistsException: Output directory hdfs://nameservice1/user/shriya/shell_test/wordcountOutput already exists\r\nException in thread \"main\" org.apache.hadoop.mapred.FileAlreadyExistsException: Output directory hdfs://nameservice1/user/shriya/shell_test/wordcountOutput already exists\r\n        at org.apache.hadoop.mapred.FileOutputFormat.checkOutputSpecs(FileOutputFormat.java:131)\r\n        at org.apache.hadoop.mapreduce.JobSubmitter.checkSpecs(JobSubmitter.java:272)\r\n        at org.apache.hadoop.mapreduce.JobSubmitter.submitJobInternal(JobSubmitter.java:143)\r\n        at org.apache.hadoop.mapreduce.Job$10.run(Job.java:1307)\r\n        at org.apache.hadoop.mapreduce.Job$10.run(Job.java:1304)\r\n        at java.security.AccessController.doPrivileged(Native Method)\r\n        at javax.security.auth.Subject.doAs(Subject.java:422)\r\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1920)\r\n        at org.apache.hadoop.mapreduce.Job.submit(Job.java:1304)\r\n        at org.apache.hadoop.mapreduce.tools.CLI.run(CLI.java:315)\r\n        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:70)\r\n        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:84)\r\n        at org.apache.hadoop.mapred.JobClient.main(JobClient.java:1277)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"HDFS File Not Removed Despite Successful \"Moved to .Trash\" Message","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Shriya_Gupta","name":"Shriya_Gupta","key":"shriya_gupta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shriya Gupta","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Shriya_Gupta","name":"Shriya_Gupta","key":"shriya_gupta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shriya Gupta","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13110772/comment/16211729","id":"16211729","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Have you checked the HDFS audit logs?  That should give you clues about what is happening here and who is re-creating the directory.  I suspect what's happening here is that the job is executing asynchronously, and you're actually running multiple copies of the job at the same time when you run the script multiple times.  If the job is still running then it is going to re-create the output directory when its tasks need to write output.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2017-10-19T21:00:28.895+0000","updated":"2017-10-19T21:00:28.895+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13110772/comment/16212035","id":"16212035","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Shriya_Gupta","name":"Shriya_Gupta","key":"shriya_gupta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shriya Gupta","active":true,"timeZone":"Etc/UTC"},"body":"I suspected that same asynchronous behaviour when this issue was brought to my attention by a user. However, at no point in time am I running two copies of the job at the same time. Each time, I have launched my script only after the previous execution would end.\r\n\r\nI suggested running it multiple times only because the error occurs randomly -- it has also shown up at the very first run of the script sometimes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Shriya_Gupta","name":"Shriya_Gupta","key":"shriya_gupta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shriya Gupta","active":true,"timeZone":"Etc/UTC"},"created":"2017-10-20T01:44:43.715+0000","updated":"2017-10-20T01:44:43.715+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13110772/comment/16212654","id":"16212654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Then there is very likely some other job or async behavior that is re-creating the directory.  Please examine the HDFS audit logs.  You should see why the directory is getting re-created after delete there and which node is doing it.  That will likely pinpoint exactly how this is occurring.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2017-10-20T13:48:13.659+0000","updated":"2017-10-20T13:48:13.659+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13110772/comment/16212839","id":"16212839","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Shriya_Gupta","name":"Shriya_Gupta","key":"shriya_gupta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shriya Gupta","active":true,"timeZone":"Etc/UTC"},"body":"You are right! There was another job that was writing to the same file in there and thus recreating it. This explain it, thank you!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Shriya_Gupta","name":"Shriya_Gupta","key":"shriya_gupta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shriya Gupta","active":true,"timeZone":"Etc/UTC"},"created":"2017-10-20T16:22:54.325+0000","updated":"2017-10-20T16:22:54.325+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13110772/comment/16212842","id":"16212842","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Shriya_Gupta","name":"Shriya_Gupta","key":"shriya_gupta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shriya Gupta","active":true,"timeZone":"Etc/UTC"},"body":"Another job was recreating the file that the user suspected wasn't being deleted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Shriya_Gupta","name":"Shriya_Gupta","key":"shriya_gupta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shriya Gupta","active":true,"timeZone":"Etc/UTC"},"created":"2017-10-20T16:24:17.889+0000","updated":"2017-10-20T16:24:17.889+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-12688/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3lhcv:"}}