{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12392974","self":"https://issues.apache.org/jira/rest/api/2/issue/12392974","key":"HDFS-14","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2008-04-02T21:01:33.604+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Apr 02 21:01:33 UTC 2008","customfield_12310420":"16915","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-14/watchers","watchCount":2,"isWatching":false},"created":"2008-04-02T20:53:19.366+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-06-20T07:41:51.521+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"I was experiencing what LOOKED like a deadlock on dfs writes... After digging a little deeper, i came across what i think is the root cause.\n\nDFSClient on createBlockOutputStream() at line 2005 sets the SoTimeout and specifies a timeout on socket connect which successfully takes care of both connection and read timeouts, but it seems as though socket writes do not honor any particular timeout value.  When you trace the SocketOutputStream.flush() to where we hang at socketWrite0(), there are no timeout values passed... and i'm doubtful that the native method reads system properties for any other timeout property.\n\nI feel as though DFSClient should be changed to wrap writes in some form of delegate to a method that takes a timeout  which uses the value  specified as \"dfs.socket.timeout\"\n\nIncluding my thread dump in case others are searching for similar traces:\n\n\"DataStreamer for file /tmp/AtomSeqImportProvider-119106c44fd block blk_672010209009706845\" prio=10 tid=0x00002aaae00d9800 nid=0x6e37 runnable [0x000000004141b000..0x000000004141ba80]\n   java.lang.Thread.State: RUNNABLE\n        at java.net.SocketOutputStream.socketWrite0(Native Method)\n        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)\n        at java.net.SocketOutputStream.write(SocketOutputStream.java:136)\n        at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)\n        at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)\n        - locked <0x00002aaab46fda10> (a java.io.BufferedOutputStream)\n        at java.io.DataOutputStream.flush(DataOutputStream.java:106)\n        at org.apache.hadoop.dfs.DFSClient$DFSOutputStream$DataStreamer.run(DFSClient.java:1627)\n        - locked <0x00002aaab411fff8> (a java.util.LinkedList)\n\n\"Thread-0\" prio=10 tid=0x00002aaae009f000 nid=0x6e29 waiting for monitor entry [0x0000000040f16000..0x0000000040f16a00]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n        at org.apache.hadoop.dfs.DFSClient$DFSOutputStream.writeChunk(DFSClient.java:2117)\n        - waiting to lock <0x00002aaab411fff8> (a java.util.LinkedList)\n        at org.apache.hadoop.fs.FSOutputSummer.writeChecksumChunk(FSOutputSummer.java:141)\n        at org.apache.hadoop.fs.FSOutputSummer.flushBuffer(FSOutputSummer.java:124)\n        - locked <0x00002aaab41202c8> (a org.apache.hadoop.dfs.DFSClient$DFSOutputStream)\n        at org.apache.hadoop.fs.FSOutputSummer.write1(FSOutputSummer.java:112)\n        at org.apache.hadoop.fs.FSOutputSummer.write(FSOutputSummer.java:86)\n        - locked <0x00002aaab41202c8> (a org.apache.hadoop.dfs.DFSClient$DFSOutputStream)\n        at org.apache.hadoop.fs.FSDataOutputStream$PositionCache.write(FSDataOutputStream.java:41)\n        at java.io.DataOutputStream.write(DataOutputStream.java:90)\n        - locked <0x00002aaab406e898> (a org.apache.hadoop.fs.FSDataOutputStream)\n        at java.io.FilterOutputStream.write(FilterOutputStream.java:80)\n        at com.imeem.talbot.tools.DataSourceImporter.performImport(DataSourceImporter.java:100)\n        at com.imeem.talbot.tools.DataSourceImporter.access$000(DataSourceImporter.java:46)\n        at com.imeem.talbot.tools.DataSourceImporter$1.run(DataSourceImporter.java:219)\n        at java.lang.Thread.run(Thread.java:619)\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"107849","customfield_12312823":null,"summary":"DFSClient should timeout on long writes","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rl337","name":"rl337","key":"rl337","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard Lee","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rl337","name":"rl337","key":"rl337","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard Lee","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"CentOS release 5, jdk1.6.0_02","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12392974/comment/12584773","id":"12584773","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"body":"> I feel as though DFSClient should be changed to wrap writes in some form of delegate to a method that takes a timeout which uses the value specified as \"dfs.socket.timeout\"\n\nThis is the case in 0.17. These writes have a timeout of around 10minutes. It not not configurable now, but it could be. There are socket writes in many different contexts and we might need different config timeouts for those. HADOOP-3124 is about one such config.\n\nTake a look at org.apache.hadoop.ipc.SocketOutputStream for more details if interested.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-04-02T21:01:33.604+0000","updated":"2008-04-02T21:01:33.604+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-14/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0itcn:"}}