{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12514784","self":"https://issues.apache.org/jira/rest/api/2/issue/12514784","key":"HDFS-2177","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2011-07-20T16:07:29.397+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jul 25 21:32:05 UTC 2011","customfield_12310420":"15088","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_551414228_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-07-26T21:38:29.413+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-2177/watchers","watchCount":7,"isWatching":false},"created":"2011-07-20T12:28:15.197+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-07-26T21:38:29.420+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"This was again discovered by Arpit Gupta! Restarting the namenode when the secondary namenode is checkpointing seems to remove everything from /","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12487758","id":"12487758","filename":"test_HDFS-2177.sh","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviprak","name":"raviprak","key":"raviprak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=raviprak&avatarId=10113","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=raviprak&avatarId=10113","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=raviprak&avatarId=10113","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=raviprak&avatarId=10113"},"displayName":"Ravi Prakash","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-07-25T21:32:05.862+0000","size":1245,"mimeType":"application/x-sh","content":"https://issues.apache.org/jira/secure/attachment/12487758/test_HDFS-2177.sh"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"113804","customfield_12312823":null,"summary":"Restarting the namenode when the secondary namenode is checkpointing seems to remove everything from /","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviprak","name":"raviprak","key":"raviprak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=raviprak&avatarId=10113","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=raviprak&avatarId=10113","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=raviprak&avatarId=10113","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=raviprak&avatarId=10113"},"displayName":"Ravi Prakash","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviprak","name":"raviprak","key":"raviprak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=raviprak&avatarId=10113","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=raviprak&avatarId=10113","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=raviprak&avatarId=10113","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=raviprak&avatarId=10113"},"displayName":"Ravi Prakash","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514784/comment/13068330","id":"13068330","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviprak","name":"raviprak","key":"raviprak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=raviprak&avatarId=10113","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=raviprak&avatarId=10113","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=raviprak&avatarId=10113","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=raviprak&avatarId=10113"},"displayName":"Ravi Prakash","active":true,"timeZone":"America/Los_Angeles"},"body":"Here's a relevant SNN log\n{noformat}\n2011-07-19 23:07:30,466 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Web server init done\n2011-07-19 23:07:30,467 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Secondary Web-server up at: virtual.somehost.com:50090\n2011-07-19 23:07:30,467 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Secondary image servlet up at: virtual.somehost.com:50490\n2011-07-19 23:07:30,467 WARN org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Checkpoint Period   :60 secs (1 min)\n2011-07-19 23:07:30,467 WARN org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Log Size Trigger    :2048000000 bytes (2000000 KB)\n2011-07-19 23:08:30,982 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Downloaded file fsimage size 7576 bytes.\n2011-07-19 23:08:30,993 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Downloaded file edits size 30 bytes.\n2011-07-19 23:08:31,093 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: defaultReplication = 3\n2011-07-19 23:08:31,093 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: maxReplication = 50\n2011-07-19 23:08:31,093 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: minReplication = 1\n2011-07-19 23:08:31,093 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: maxReplicationStreams = 2\n2011-07-19 23:08:31,093 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: shouldCheckForEnoughRacks = true\n2011-07-19 23:08:31,099 INFO org.apache.hadoop.hdfs.util.GSet: VM type       = 64-bit\n2011-07-19 23:08:31,099 INFO org.apache.hadoop.hdfs.util.GSet: 2% max memory = 273.85625 MB\n2011-07-19 23:08:31,099 INFO org.apache.hadoop.hdfs.util.GSet: capacity      = 2^25 = 33554432 entries\n2011-07-19 23:08:31,099 INFO org.apache.hadoop.hdfs.util.GSet: recommended=33554432, actual=33554432\n2011-07-19 23:08:31,291 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: fsOwner=hdfs/virtual.somehost.com@somerealm.com\n2011-07-19 23:08:31,291 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: supergroup=hdfs\n2011-07-19 23:08:31,291 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: isPermissionEnabled=true\n2011-07-19 23:08:31,305 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: dfs.block.invalidate.limit=1000\n2011-07-19 23:08:31,305 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: isBlockTokenEnabled=true blockKeyUpdateInterval=600 min(s), blockTokenLifetime=600 min(s)\n2011-07-19 23:08:31,333 INFO org.apache.hadoop.hdfs.server.namenode.NameNode: Caching file names occuring more than 10 times \n2011-07-19 23:08:31,349 INFO org.apache.hadoop.hdfs.server.namenode.FSImage: Loading image file /tmp/hadoop-someuser/dfs/namesecondary/current/fsimage using no compression\n2011-07-19 23:08:31,349 INFO org.apache.hadoop.hdfs.server.namenode.FSImage: Number of files = 71\n2011-07-19 23:08:31,370 INFO org.apache.hadoop.hdfs.server.namenode.FSImage: Number of files under construction = 0\n2011-07-19 23:08:31,375 INFO org.apache.hadoop.hdfs.server.namenode.FSImage: Image file of size 7576 loaded in 0 seconds.\n2011-07-19 23:08:31,386 INFO org.apache.hadoop.hdfs.server.namenode.FSImage: Edits file /tmp/hadoop-someuser/dfs/namesecondary/current/edits of size 30 edits # 2 loaded in 0 seconds.\n2011-07-19 23:08:31,388 INFO org.apache.hadoop.hdfs.server.namenode.FSEditLog: Number of transactions: 0 Total time for transactions(ms): 0Number of transactions batched in Syncs: 0 Number of syncs: 0 SyncTimes(ms): 0 \n2011-07-19 23:08:31,398 INFO org.apache.hadoop.hdfs.server.namenode.FSImage: Saving image file /tmp/hadoop-someuser/dfs/namesecondary/current/fsimage using no compression\n2011-07-19 23:08:31,408 INFO org.apache.hadoop.hdfs.server.namenode.FSImage: Image file of size 7600 saved in 0 seconds.\n2011-07-19 23:08:31,417 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Posted URL somehost.com:50470putimage=1&port=50490&machine=virtual.somehost.com&token=-35:1272447189:0:13111169\n10000:1311116479833:4396bbd3f5b9947166068f39b1307441:CID-1c3abcd4-60e7-4b3c-be9a-420e9df14b74:BP-1333203313-98.137.97.97-1311113548658&newChecksum=5650481e7cb891340dbcc1b22db43eb5\n2011-07-19 23:08:31,628 WARN org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Checkpoint done. New Image Size: 7600\n2011-07-19 23:09:31,687 INFO org.apache.hadoop.hdfs.server.namenode.FSEditLog: Number of transactions: 0 Total time for transactions(ms): 0Number of transactions batched in Syncs: 0 Number of syncs: 0 SyncTimes(ms): 0 \n2011-07-19 23:09:31,703 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Image has not changed. Will not download image.\n2011-07-19 23:09:31,720 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Downloaded file edits size 4 bytes.\n2011-07-19 23:09:31,721 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: defaultReplication = 3\n2011-07-19 23:09:31,721 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: maxReplication = 50\n2011-07-19 23:09:31,721 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: minReplication = 1\n2011-07-19 23:09:31,721 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: maxReplicationStreams = 2\n2011-07-19 23:09:31,721 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: shouldCheckForEnoughRacks = true\n2011-07-19 23:09:31,721 INFO org.apache.hadoop.hdfs.util.GSet: VM type       = 64-bit\n2011-07-19 23:09:31,721 INFO org.apache.hadoop.hdfs.util.GSet: 2% max memory = 273.85625 MB\n2011-07-19 23:09:31,721 INFO org.apache.hadoop.hdfs.util.GSet: capacity      = 2^25 = 33554432 entries\n2011-07-19 23:09:31,721 INFO org.apache.hadoop.hdfs.util.GSet: recommended=33554432, actual=33554432\n2011-07-19 23:09:31,909 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: fsOwner=hdfs/virtual.somehost.com@somerealm.com\n2011-07-19 23:09:31,909 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: supergroup=hdfs\n2011-07-19 23:09:31,909 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: isPermissionEnabled=true\n2011-07-19 23:09:31,909 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: dfs.block.invalidate.limit=1000\n2011-07-19 23:09:31,909 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem: isBlockTokenEnabled=true blockKeyUpdateInterval=600 min(s), blockTokenLifetime=600 min(s)\n2011-07-19 23:09:31,909 INFO org.apache.hadoop.hdfs.server.namenode.NameNode: Caching file names occuring more than 10 times \n2011-07-19 23:09:31,911 INFO org.apache.hadoop.hdfs.server.namenode.FSImage: Edits file /tmp/hadoop-someuser/dfs/namesecondary/current/edits of size 4 edits # 0 loaded in 0 seconds.\n2011-07-19 23:09:31,911 INFO org.apache.hadoop.hdfs.server.namenode.FSEditLog: Number of transactions: 0 Total time for transactions(ms): 0Number of transactions batched in Syncs: 0 Number of syncs: 0 SyncTimes(ms): 0 \n2011-07-19 23:09:31,914 INFO org.apache.hadoop.hdfs.server.namenode.FSImage: Saving image file /tmp/hadoop-someuser/dfs/namesecondary/current/fsimage using no compression\n2011-07-19 23:09:31,918 INFO org.apache.hadoop.hdfs.server.namenode.FSImage: Image file of size 107 saved in 0 seconds.\n2011-07-19 23:09:31,927 INFO org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Posted URL somehost.com:50470putimage=1&port=50490&machine=virtual.somehost.com&token=-35:1272447189:0:13111169\n71000:1311116911612:5650481e7cb891340dbcc1b22db43eb5:CID-1c3abcd4-60e7-4b3c-be9a-420e9df14b74:BP-1333203313-98.137.97.97-1311113548658&newChecksum=fab43b7e4a607aa4611d16d20e1b261c\n2011-07-19 23:09:31,971 WARN org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode: Checkpoint done. New Image Size: 107\n{noformat}\n\nAs you can see, the image size which was 7600 shrunk to 107 in the very next checkpoint. (Checkpointing was configured to be every 60 seconds). This was exactly the same time as the namenode was shutdown and restarted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviprak","name":"raviprak","key":"raviprak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=raviprak&avatarId=10113","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=raviprak&avatarId=10113","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=raviprak&avatarId=10113","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=raviprak&avatarId=10113"},"displayName":"Ravi Prakash","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-07-20T12:37:39.174+0000","updated":"2011-07-20T12:37:39.174+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514784/comment/13068464","id":"13068464","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=atm","name":"atm","key":"atm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=atm&avatarId=14136","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=atm&avatarId=14136","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=atm&avatarId=14136","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=atm&avatarId=14136"},"displayName":"Aaron T. Myers","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Ravi, can you reproduce this reliably? Can you write a test to exercise this case consistently?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=atm","name":"atm","key":"atm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=atm&avatarId=14136","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=atm&avatarId=14136","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=atm&avatarId=14136","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=atm&avatarId=14136"},"displayName":"Aaron T. Myers","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-07-20T16:07:29.397+0000","updated":"2011-07-20T16:07:29.397+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514784/comment/13068465","id":"13068465","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitgupta","name":"arpitgupta","key":"arpitgupta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Gupta","active":true,"timeZone":"America/Los_Angeles"},"body":"After more investigation it was determined that when the edits log is empty and checkpointing takes place it makes the image file empty as well. This is has no relation to the restart. So may be we should change the title?\n\n\nAlso does it make sense to investigate this post all the changes needed for HDFS-1073","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitgupta","name":"arpitgupta","key":"arpitgupta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Gupta","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-07-20T16:08:56.541+0000","updated":"2011-07-20T16:08:56.541+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514784/comment/13068466","id":"13068466","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=atm","name":"atm","key":"atm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=atm&avatarId=14136","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=atm&avatarId=14136","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=atm&avatarId=14136","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=atm&avatarId=14136"},"displayName":"Aaron T. Myers","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. After more investigation it was determined that when the edits log is empty and checkpointing takes place it makes the image file empty as well. This is has no relation to the restart. So may be we should change the title?\n\nWe should certainly change the title if you're confident that this is the observed behavior.\n\nbq. Also does it make sense to investigate this post all the changes needed for HDFS-1073\n\nCertainly worth re-investigating in trunk post HDFS-1073 merge, but we should look into this as well for the 0.22 (and perhaps prior) branches.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=atm","name":"atm","key":"atm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=atm&avatarId=14136","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=atm&avatarId=14136","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=atm&avatarId=14136","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=atm&avatarId=14136"},"displayName":"Aaron T. Myers","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-07-20T16:11:12.037+0000","updated":"2011-07-20T16:11:12.037+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514784/comment/13068474","id":"13068474","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitgupta","name":"arpitgupta","key":"arpitgupta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Gupta","active":true,"timeZone":"America/Los_Angeles"},"body":"I believe the reason the restart of the namenode is necessary to see the issue as it re reads the image file back in memory thus showing the users an empty namespace. However restart does not play any role in making the edits log empty.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arpitgupta","name":"arpitgupta","key":"arpitgupta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arpit Gupta","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-07-20T16:25:02.502+0000","updated":"2011-07-20T16:25:02.502+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514784/comment/13068518","id":"13068518","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviprak","name":"raviprak","key":"raviprak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=raviprak&avatarId=10113","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=raviprak&avatarId=10113","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=raviprak&avatarId=10113","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=raviprak&avatarId=10113"},"displayName":"Ravi Prakash","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Aaron, Arpit had written a test which reliably reproduces this on a 10 node cluster. I'm trying to reproduce this on a single node cluster but haven't been successful so far.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviprak","name":"raviprak","key":"raviprak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=raviprak&avatarId=10113","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=raviprak&avatarId=10113","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=raviprak&avatarId=10113","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=raviprak&avatarId=10113"},"displayName":"Ravi Prakash","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-07-20T18:04:40.590+0000","updated":"2011-07-20T18:04:40.590+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514784/comment/13068530","id":"13068530","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=atm","name":"atm","key":"atm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=atm&avatarId=14136","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=atm&avatarId=14136","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=atm&avatarId=14136","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=atm&avatarId=14136"},"displayName":"Aaron T. Myers","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Arpit had written a test which reliably reproduces this on a 10 node cluster. I'm trying to reproduce this on a single node cluster but haven't been successful so far.\n\nI'm surprised cluster size would be a factor, given that this is an NN/2NN-only issue.\n\nIdeally you would create a test case using the unit test framework in the project. This might make it easier to formulate said test case since you could precisely control the timing/interleaving of NN and 2NN interactions using mockito, etc. I suspect creating a test to reliably exercise this case on a running cluster will be very difficult.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=atm","name":"atm","key":"atm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=atm&avatarId=14136","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=atm&avatarId=14136","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=atm&avatarId=14136","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=atm&avatarId=14136"},"displayName":"Aaron T. Myers","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-07-20T18:15:28.372+0000","updated":"2011-07-20T18:15:28.372+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12514784/comment/13070781","id":"13070781","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviprak","name":"raviprak","key":"raviprak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=raviprak&avatarId=10113","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=raviprak&avatarId=10113","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=raviprak&avatarId=10113","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=raviprak&avatarId=10113"},"displayName":"Ravi Prakash","active":true,"timeZone":"America/Los_Angeles"},"body":"The version of HDFS running on the 10 node clusters was remotes/origin/MR-279. I wasn't able to reproduce this issue on trunk (which was running on my single node cluster). On MR-279 ( e3d9a2bcbcab817043b1c4c41efb7036ce00904f ) its pretty easy. I'm attaching a test you can use to replicate the behavior on a single node cluster. I'm not going to work on this any longer (investigate why its happening) because this issue wasn't on trunk (already been fixed?).\n\nTo run the test:\n1. Please set your checkpoint period (dfs.namenode.checkpoint.period) to 10 seconds. \n2. The idea is to make the NN shutdown at exactly the time the SNN is doing a checkpoint. On my machine the fillHDFS function takes exactly the time to cause that. You might have to adjust the sleep times while looking at the NN and SNN logs to replicate this.\n3. The test fills up /tmp to create a big edits file. I'm not sure if that is necessary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviprak","name":"raviprak","key":"raviprak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=raviprak&avatarId=10113","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=raviprak&avatarId=10113","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=raviprak&avatarId=10113","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=raviprak&avatarId=10113"},"displayName":"Ravi Prakash","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-07-25T21:32:05.886+0000","updated":"2011-07-25T21:32:05.886+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-2177/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ju33:"}}