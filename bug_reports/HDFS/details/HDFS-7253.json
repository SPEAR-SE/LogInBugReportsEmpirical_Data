{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12748239","self":"https://issues.apache.org/jira/rest/api/2/issue/12748239","key":"HDFS-7253","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2014-10-15T12:02:19.082+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Oct 15 12:14:51 UTC 2014","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_8104697_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-10-15T12:07:23.948+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7253/watchers","watchCount":2,"isWatching":false},"created":"2014-10-15T09:52:19.340+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325049","id":"12325049","description":"2.2.0 release","name":"2.2.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"issuelinks":[{"id":"12399014","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12399014","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12740723","key":"HDFS-7045","self":"https://issues.apache.org/jira/rest/api/2/issue/12740723","fields":{"summary":"Fix NameNode deadlock when opening file under /.reserved path","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-10-15T12:14:51.799+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"One day my active namenode hanged and I dumped the program stacks by jstack.In the stacks file, I saw most threads were waiting FSNamesystem.fsLock, both  readLock and writeLock were unacquirable, but no thread was holding writeLock.\nI tried to access the web interface of this namenode but was blocked. and I tried to failover the active node to another namenode manually (zkfs did not discover this node was hanging) but it was also failed. So I killed this namenode trying to recover the production environment, then the failover was triggered, standby nn transited to active, and then, the new active namenode hanged.\nMy following steps are useless and can be ignored. At last, I thought it was caused by an incorrect lock handling in FSNamesystem.getBlockLocationsUpdateTimes, which I will describe in the first comment.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12674964","id":"12674964","filename":"nn1013.jstack","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-15T10:06:03.773+0000","size":266519,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12674964/nn1013.jstack"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12674966","id":"12674966","filename":"Tester.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-15T10:12:37.337+0000","size":1957,"mimeType":"text/x-java","content":"https://issues.apache.org/jira/secure/attachment/12674966/Tester.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12674971","id":"12674971","filename":"Trigger.tgz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-15T11:00:01.586+0000","size":3384,"mimeType":"application/x-compressed-tar","content":"https://issues.apache.org/jira/secure/attachment/12674971/Trigger.tgz"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"getBlockLocationsUpdateTimes missing handle exception may cause fsLock dead lock","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748239/comment/14172217","id":"14172217","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"body":"I checked all the operations about FSNamesystem.fsLock.readLock, and find that there is a line between readLock()/writeLock and try-finnaly block.\n{code:java}\n      if (isReadOp) { // first attempt is with readlock\n        checkOperation(OperationCategory.READ);\n        readLock();\n      }  else { // second attempt is with  write lock\n        checkOperation(OperationCategory.WRITE);\n        writeLock(); // writelock is needed to set accesstime\n      }\n      src = FSDirectory.resolvePath(src, pathComponents, dir);\n      try {\n{code}\n\nThe function FSDirectory.resolvePath may throw a FileNotFoundException, cause the previously acquired lock not released.\n\nAnd I do found the logs of FileNotFoundException, about 2 minutes before no useful logs appending to log files.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-15T10:02:58.565+0000","updated":"2014-10-15T10:02:58.565+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748239/comment/14172219","id":"14172219","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"body":"stacks during hanging","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-15T10:06:03.782+0000","updated":"2014-10-15T10:06:03.782+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748239/comment/14172224","id":"14172224","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"body":"attach a simple test case, which may cause the test program hang and may produce similar jstack dumps.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-15T10:12:37.344+0000","updated":"2014-10-15T10:12:37.344+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748239/comment/14172255","id":"14172255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"body":"After digging into the function FSDirectory.resolvePath, I discoved that this bug only affect the invalid paths with prefix /.reserved/.inodes. Yes, I am using hdfs-nfs as my clients, and the FIleNotFoundException may be caused by another question in hdfs-nfs.\n\nI wrote a small program that can reproduce the problem. And I tested it in my 2.2 cluster.\n\nI did not try higher version hadoop, but related source code is not changed in newest version 2.5.1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-15T11:00:01.594+0000","updated":"2014-10-15T11:00:01.594+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748239/comment/14172292","id":"14172292","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi Carrey, this had been fixed in HDFS-7045, target version is 2.6.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-10-15T12:02:19.082+0000","updated":"2014-10-15T12:02:19.082+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748239/comment/14172297","id":"14172297","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks Carrey for reporting the issue, mark it as invalid since it's already fixed in HDFS-7045.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hitliuyi","name":"hitliuyi","key":"hitliuyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yi Liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-10-15T12:07:23.993+0000","updated":"2014-10-15T12:07:23.993+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748239/comment/14172299","id":"14172299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"body":"thanks [~hitliuyi]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=CarreyZhan","name":"CarreyZhan","key":"carreyzhan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carrey Zhan","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-15T12:14:51.799+0000","updated":"2014-10-15T12:14:51.799+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-7253/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i216t3:"}}