{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12629735","self":"https://issues.apache.org/jira/rest/api/2/issue/12629735","key":"HDFS-4451","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323274","id":"12323274","description":"2.0.3-alpha release","name":"2.0.3-alpha","archived":false,"released":true,"releaseDate":"2013-02-14"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-01-29T19:15:53.315+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Feb 01 14:04:13 UTC 2013","customfield_12310420":"310231","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_177911474_*|*_1_*:*_1_*:*_279522_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-01-31T19:03:27.074+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-4451/watchers","watchCount":8,"isWatching":false},"created":"2013-01-29T17:33:36.122+0000","customfield_12310192":"This is an incompatible change from release 2.0.2-alpha and prior releases. Balancer tool exited with exit code 1 on success. It is changed to exit with exit code 0 on success. Non 0 exit code indicates failure.","customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10342","value":"Incompatible change","id":"10342"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12322472","id":"12322472","description":"2.0.2-alpha release","name":"2.0.2-alpha","archived":false,"released":true,"releaseDate":"2012-10-09"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-02-15T13:12:42.308+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313153","id":"12313153","name":"balancer & mover"}],"timeoriginalestimate":null,"description":"Though the org.apache.hadoop.util.Tool interface javadocs indicate  implementations should return 0 on success, the org.apache.hadoop.hdfs.server.balance.Balancer.Cli implementation returns the int values of this enum instead:\n\n  // Exit status\n  enum ReturnStatus {\n    SUCCESS(1),\n    IN_PROGRESS(0),\n    ALREADY_RUNNING(-1),\n    NO_MOVE_BLOCK(-2),\n    NO_MOVE_PROGRESS(-3),\n    IO_EXCEPTION(-4),\n    ILLEGAL_ARGS(-5),\n    INTERRUPTED(-6);\n\nThis created an issue for us when we tried to run the hdfs balancer as a cron job.   Cron sends emails whenever a executable it runs exits non-zero.   We'd either have to disable all emails and miss real issues or fix this bug.\n\nI think both SUCCESS and IN_PROGRESS ReturnStatuses should lead to exit 0.\n\nMarking this change as incompatible because existing scripts which interpret exit 1 as success will be broken (unless they defensively/liberally interpret both exit 1 and exit 0 as success).","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12567400","id":"12567400","filename":"HDFS-4451.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jtblatt","name":"jtblatt","key":"jtblatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Blatt","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-31T17:57:23.317+0000","size":5982,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12567400/HDFS-4451.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12567157","id":"12567157","filename":"HDFS-4451.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jtblatt","name":"jtblatt","key":"jtblatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Blatt","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-30T16:33:15.057+0000","size":6196,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12567157/HDFS-4451.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12567007","id":"12567007","filename":"HDFS-4451.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jtblatt","name":"jtblatt","key":"jtblatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Blatt","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-29T17:38:44.791+0000","size":7103,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12567007/HDFS-4451.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"310576","customfield_12312823":null,"summary":"hdfs balancer command returns exit code 1 on success instead of 0","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jtblatt","name":"jtblatt","key":"jtblatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Blatt","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jtblatt","name":"jtblatt","key":"jtblatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Blatt","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Centos 6.3, JDK 1.6.0_25","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13565557","id":"13565557","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jtblatt","name":"jtblatt","key":"jtblatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Blatt","active":true,"timeZone":"Etc/UTC"},"body":"Continuing to use the ReturnStatus enum for most calls.  Only mapping SUCCESS(1) to int 0 in the return value of the Tool's interface implementation.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jtblatt","name":"jtblatt","key":"jtblatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Blatt","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-29T17:38:15.625+0000","updated":"2013-01-29T17:38:15.625+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13565671","id":"13565671","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:green}+1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12567007/HDFS-4451.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/3903//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/3903//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-29T19:15:53.315+0000","updated":"2013-01-29T19:15:53.315+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13566244","id":"13566244","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks, Joshua.  I applied the patch to trunk and ran these test suites successfully: TestBalancer, TestBalancerWithEncryptedTransfer, TestBalancerWithHANameNodes, TestBalancerWithMultipleNameNodes, TestBalancerWithNodeGroup, TestBalancerBandwidth.  Here are a few comments.\n\n1. It appears that it is not possible for the tool to exit with IN_PROGRESS.  We have this code in the static {{Balancer#run}} method:\n\n{code}\nboolean done = false;\nfor(int iteration = 0; !done; iteration++) {\n  done = true;\n  Collections.shuffle(connectors);\n  for(NameNodeConnector nnc : connectors) {\n    final Balancer b = new Balancer(nnc, p, conf);\n    final ReturnStatus r = b.run(iteration, formatter, conf);\n    // clean all lists\n    b.resetData(conf);\n    if (r == ReturnStatus.IN_PROGRESS) {\n      done = false;\n    } else if (r != ReturnStatus.SUCCESS) {\n      //must be an error statue, return.\n      return r.code;\n    }\n  }\n\n  if (!done) {\n    Thread.sleep(sleeptime);\n  }\n}\n{code}\n\nThis loop will not terminate while return status is IN_PROGRESS, so I expect we would never exit the CLI with IN_PROGRESS.  If that's the case, then we wouldn't need to map IN_PROGRESS to a successful exit, and {{toExitCode}} could simplify to something like code == 1 ? 0 : 1.\n\n2. Actually, I wonder if the simpler change is just to swap the codes in the enum, so that it's SUCCESS(0) and IN_PROGRESS(1).  Then, we wouldn't need {{toExitCode}}.  If callers never really see the IN_PROGRESS exit code (for the reasons stated above) and if we're already declaring this change backwards-incompatible, then this would be simpler.\n\n3. Do you want to add a test that calls {{twoNodeTest(conf, true)}}?  I see that the {{useTool}} flag has been introduced in the method signature, but I didn't find any tests that set the flag to true.\n\n{code}\n-  private void twoNodeTest(Configuration conf) throws Exception {\n+  private void twoNodeTest(Configuration conf, boolean useTool) throws Exception {\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-30T07:11:25.513+0000","updated":"2013-01-30T07:11:25.513+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13566562","id":"13566562","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jblatt","name":"jblatt","key":"jblatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Blatt","active":true,"timeZone":"Etc/UTC"},"body":"Happy to change the patch to follow either suggestion 1 or 2.   \n\nOn 3, happy to do that as well.   I just felt that the one node test was sufficient to test the exit code, the two node test is exercised elsewhere, so running the two node test a second time to check the exit code would mostly just increase test run time.\n\nAnyhoo, nothing worth arguing about.   I'll attach a new patch that follows the suggestions from 2 and 3 shortly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jblatt","name":"jblatt","key":"jblatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Blatt","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-30T16:02:17.469+0000","updated":"2013-01-30T16:02:17.469+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13566591","id":"13566591","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jtblatt","name":"jtblatt","key":"jtblatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Blatt","active":true,"timeZone":"Etc/UTC"},"body":"Change SUCCESS int value to 0\nExecute two node test in testExitZeroOnSuccess test case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jtblatt","name":"jtblatt","key":"jtblatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Blatt","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-30T16:33:15.060+0000","updated":"2013-01-30T16:33:15.060+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13566608","id":"13566608","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"+1\n\nThanks, Joshua!\n\n{quote}\nI just felt that the one node test was sufficient to test the exit code\n{quote}\n\nIf that extra test doesn't add anything, then the other option would be to remove the {{useTool}} flag from the {{twoNodeTest}} method signature, just so the unused flag doesn't cause any confusion.\n\nTo whichever committer picks this up: would you please review my thinking in the earlier comments about swapping the enum values?  I believe this is a safe (but backwards-incompatible) change, but I would appreciate it if you'd double-check.  Thanks!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-30T16:50:58.532+0000","updated":"2013-01-30T16:50:58.532+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13566713","id":"13566713","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:green}+1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12567157/HDFS-4451.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/3908//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/3908//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-30T18:17:02.745+0000","updated":"2013-01-30T18:17:02.745+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13566940","id":"13566940","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 for Chris's comments earlier.\n\nbq. If that extra test doesn't add anything, then the other option would be to remove the useTool flag from the twoNodeTest method signature, just so the unused flag doesn't cause any confusion.\nLets remove useTool from twoNodeTest and just use one node test to test the exit code.\n\nOne minor optional thing, you have lot of empty lines in the code. It could be more compact:\n{code}\n private void runBalancerCli(Configuration conf,\n     long totalUsedSpace, long totalCapacity) throws Exception {\n   waitForHeartBeat(totalUsedSpace, totalCapacity, client, cluster);\n\n   final String[] args = { \"-policy\", \"datanode\" };\n   final Tool tool = new Cli();    \n   tool.setConf(conf);\n   final int r = tool.run(args); // start rebalancing\n   \n   assertEquals(\"Tools should exit 0 on success\", 0, r);\n   waitForHeartBeat(totalUsedSpace, totalCapacity, client, cluster);\n   LOG.info(\"Rebalancing with default ctor.\");\n   waitForBalancer(totalUsedSpace, totalCapacity, client, cluster);\n }\n\n  * Verify balancer CLI exit code on success is 0\n  */\n @Test(timeout=100000)\n public void testExitZeroOnSuccess() throws Exception {\n   final Configuration conf = new HdfsConfiguration();   \n   initConf(new HdfsConfiguration());  \n   oneNodeTest(conf, true);\n }\n\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-30T21:51:50.238+0000","updated":"2013-01-30T21:51:50.238+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13567892","id":"13567892","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 again for the new patch\n\nI reran all of the balancer tests that I mentioned above, and they all passed.\n\nThanks again for the contribution, Joshua!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-31T18:13:15.309+0000","updated":"2013-01-31T18:13:15.309+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13567918","id":"13567918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 for the change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-31T18:41:43.490+0000","updated":"2013-01-31T18:41:43.490+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13567955","id":"13567955","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"I committed the patch to trunk and branch-2.\n\nThank you Joshua!\n\nIs this change needed in branch-1?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-31T19:03:27.100+0000","updated":"2013-01-31T19:03:27.100+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13567962","id":"13567962","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-trunk-Commit #3306 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/3306/])\n    Change incorrect jira number HDFS-4151 to HDFS-4451 and move it to incompatible section. (Revision 1441123)\n\n     Result = SUCCESS\nsuresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1441123\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-31T19:08:06.329+0000","updated":"2013-01-31T19:08:06.329+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13567978","id":"13567978","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jtblatt","name":"jtblatt","key":"jtblatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Blatt","active":true,"timeZone":"Etc/UTC"},"body":"Thanks guys!\n\nSpeaking only for ourselves, we only need it in branch-2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jtblatt","name":"jtblatt","key":"jtblatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Blatt","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-31T19:14:03.843+0000","updated":"2013-01-31T19:14:03.843+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13568012","id":"13568012","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:green}+1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12567400/HDFS-4451.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/3917//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/3917//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-31T19:34:55.873+0000","updated":"2013-01-31T19:34:55.873+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13568651","id":"13568651","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Yarn-trunk #114 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/114/])\n    Change incorrect jira number HDFS-4151 to HDFS-4451 and move it to incompatible section. (Revision 1441123)\n\n     Result = SUCCESS\nsuresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1441123\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-01T10:47:06.950+0000","updated":"2013-02-01T10:47:06.950+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13568729","id":"13568729","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Hdfs-trunk #1303 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1303/])\n    Change incorrect jira number HDFS-4151 to HDFS-4451 and move it to incompatible section. (Revision 1441123)\n\n     Result = SUCCESS\nsuresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1441123\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-01T13:02:54.550+0000","updated":"2013-02-01T13:02:54.550+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629735/comment/13568750","id":"13568750","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-Mapreduce-trunk #1331 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1331/])\n    Change incorrect jira number HDFS-4151 to HDFS-4451 and move it to incompatible section. (Revision 1441123)\n\n     Result = SUCCESS\nsuresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1441123\nFiles : \n* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-01T14:04:13.122+0000","updated":"2013-02-01T14:04:13.122+0000"}],"maxResults":17,"total":17,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-4451/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1hjg7:"}}