{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12727064","self":"https://issues.apache.org/jira/rest/api/2/issue/12727064","key":"HDFS-6676","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jul 21 08:21:52 UTC 2014","customfield_12310420":"405171","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_592955913_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-07-21T08:22:40.908+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-6676/watchers","watchCount":1,"isWatching":false},"created":"2014-07-14T11:40:05.035+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326143","id":"12326143","description":"2.4.0 release","name":"2.4.0","archived":false,"released":true,"releaseDate":"2014-04-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-07-21T08:22:40.943+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313400","id":"12313400","name":"security"}],"timeoriginalestimate":null,"description":"When I made a request http://server-1941.novalocal:16000/kms/v1/names in firefox. (before, i set configs in firefox according https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/sso-config-firefox.html), following info was found in logs/kms.log.\n2014-07-14 19:18:30,461 WARN  AuthenticationFilter - Authentication exception: GSSException: Failure unspecified at GSS-API level (Mechanism level: EncryptedData is encrypted using keytype DES CBC mode with CRC-32 but decryption key is of type NULL)\norg.apache.hadoop.security.authentication.client.AuthenticationException: GSSException: Failure unspecified at GSS-API level (Mechanism levelis of type NULL)\n\tat org.apache.hadoop.security.authentication.server.KerberosAuthenticationHandler.authenticate(KerberosAuthenticationHandler.java:380)\n\tat org.apache.hadoop.security.authentication.server.AuthenticationFilter.doFilter(AuthenticationFilter.java:357)\n\tat org.apache.hadoop.crypto.key.kms.server.KMSAuthenticationFilter.doFilter(KMSAuthenticationFilter.java:100)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:861)\n\tat org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:606)\n\tat org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: GSSException: Failure unspecified at GSS-API level (Mechanism level: EncryptedData is encrypted using keytype DES CBC mode with CRC-32 but decryption key is of type NULL)\n\tat sun.security.jgss.krb5.Krb5Context.acceptSecContext(Krb5Context.java:788)\n\tat sun.security.jgss.GSSContextImpl.acceptSecContext(GSSContextImpl.java:342)\n\tat sun.security.jgss.GSSContextImpl.acceptSecContext(GSSContextImpl.java:285)\n\tat sun.security.jgss.spnego.SpNegoContext.GSS_acceptSecContext(SpNegoContext.java:875)\n\tat sun.security.jgss.spnego.SpNegoContext.acceptSecContext(SpNegoContext.java:548)\n\tat sun.security.jgss.GSSContextImpl.acceptSecContext(GSSContextImpl.java:342)\n\tat sun.security.jgss.GSSContextImpl.acceptSecContext(GSSContextImpl.java:285)\n\tat org.apache.hadoop.security.authentication.server.KerberosAuthenticationHandler$2.run(KerberosAuthenticationHandler.java:347)\n\tat org.apache.hadoop.security.authentication.server.KerberosAuthenticationHandler$2.run(KerberosAuthenticationHandler.java:329)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.authentication.server.KerberosAuthenticationHandler.authenticate(KerberosAuthenticationHandler.java:329)\n\t... 14 more\nCaused by: KrbException: EncryptedData is encrypted using keytype DES CBC mode with CRC-32 but decryption key is of type NULL\n\tat sun.security.krb5.EncryptedData.decrypt(EncryptedData.java:169)\n\tat sun.security.krb5.KrbCred.<init>(KrbCred.java:131)\n\tat sun.security.jgss.krb5.InitialToken$OverloadedChecksum.<init>(InitialToken.java:282)\n\tat sun.security.jgss.krb5.InitSecContextToken.<init>(InitSecContextToken.java:130)\n\tat sun.security.jgss.krb5.Krb5Context.acceptSecContext(Krb5Context.java:771)\n\t... 25 more\n\t\nKerberos is enabled successful in my environment:\nklist\nTicket cache: FILE:/tmp/krb5cc_0\nDefault principal: HTTP/server-1941.novalocal@NOVALOCAL\n\nValid starting     Expires            Service principal\n07/14/14 19:18:10  07/15/14 19:18:09  krbtgt/NOVALOCAL@NOVALOCAL\n\trenew until 07/14/14 19:18:10\n07/14/14 19:18:30  07/15/14 19:18:09  HTTP/server-1941.novalocal@NOVALOCAL\n\trenew until 07/14/14 19:18:10\n\nFollowing are kdc configs:\ncat /etc/krb5.conf\n[logging]\n default = FILE:/var/log/krb5libs.log\n kdc = FILE:/var/log/krb5kdc.log\n admin_server = FILE:/var/log/kadmind.log\n\n[libdefaults]\n default_realm = NOVALOCAL\n dns_lookup_realm = false\n dns_lookup_kdc = false\n ticket_lifetime = 24h\n renew_lifetime = 7d\n forwardable = true\n udp_preference_limit = 1000000\n default_tkt_enctypes = des-cbc-md5 des-cbc-crc des3-cbc-sha1\n default_tgs_enctypes = des-cbc-md5 des-cbc-crc des3-cbc-sha1\n permitted_enctypes = des-cbc-md5 des-cbc-crc des3-cbc-sha1\n allow_weak_crypto = true\n\n\n[realms]\n NOVALOCAL = {\n  kdc = server-355:88\n  admin_server = server-355:749\n  default_domain=novalocal\n }\n\n[domain_realm]\n .novalocal = NOVALOCAL\n novalocal = NOVALOCAL\n\n\ncat /var/kerberos/krb5kdc/kdc.conf\n[kdcdefaults]\nkdc_ports = 88\nkdc_tcp_ports = 88\n \n[realms]\nNOVALOCAL = {\n  acl_file = /var/kerberos/krb5kdc/kadm5.acl\n  dict_file = /usr/share/dict/words\n  admin_keytab = /var/kerberos/krb5kdc/kadm5.keytab\n  master_key_type = des3-hmac-sha1\n  supported_enctypes = arcfour-hmac:normal des3-hmac-sha1:normal des-cbc-crc:normal des:normal des:v4 des:norealm des:onlyrealm des:afs3\n}\n \nI have updated my jdk to build 1.7.0_60-b19\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"405206","customfield_12312823":null,"summary":"KMS throws AuthenticationException when enabling kerberos authentication ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kellyzly","name":"kellyzly","key":"kellyzly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liyunzhang","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kellyzly","name":"kellyzly","key":"kellyzly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liyunzhang","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727064/comment/14068314","id":"14068314","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kellyzly","name":"kellyzly","key":"kellyzly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liyunzhang","active":true,"timeZone":"Asia/Shanghai"},"body":"you can enable kerberos http spnego authentication of KMS in following steps\n1.config kdc server successfully\n2.generate keberos ticket in client\nex.kinit HTTP/liyunzhangcentos.sh.intel.com@SH.INTEL.COM -kt /home/zly/http.keytab \n3.edit kms-site.xml, edit following property item\n<property>\n<name>hadoop.kms.authentication.type</name>\n<value>kerberos</value>\n<description>\n simple or kerberos\n</description>\n</property>\n<property>\n<name>hadoop.kms.authentication.kerberos.keytab</name>\n<value>/home/zly/hadoop-3.0.0-SNAPSHOT/etc/hadoop/kerberos/HTTP.keytab</value>\n<description>\n</description>\n</property>   \n<property>\n<name>hadoop.kms.authentication.kerberos.principal</name>\n<value>HTTP/liyunzhangcentos.sh.intel.com@SH.INTEL.COM</value>\n<description>\n</description>\n</property>\n4.start kms server\n5.use curl to test kms functions like create key\nex:#curl -i --negotiate -u: -X POST -d @createkey.json http://liyunzhangcentos.sh.intel.com:16000/kms/v1/keys --header \"Content-Type:application/json\"\nHTTP/1.1 401 Unauthorized\nServer: Apache-Coyote/1.1\nWWW-Authenticate: Negotiate\nSet-Cookie: hadoop.auth=; Expires=Thu, 01-Jan-1970 00:00:00 GMT; HttpOnly\nContent-Type: text/html;charset=utf-8\nContent-Length: 997\nDate: Mon, 21 Jul 2014 06:27:59 GMT\nHTTP/1.1 201 Created\nServer: Apache-Coyote/1.1\nSet-Cookie: hadoop.auth=u=HTTP&p=HTTP/liyunzhangcentos.sh.intel.com@SH.INTEL.COM&t=kerberos&e=1405960084208&s=UgeM6AwoHo46HDntyVXB/OLK6u8=; Expires=Mon, 21-Jul-2014 16:28:04 GMT; HttpOnly\nLocation: http://liyunzhangcentos.sh.intel.com:16000/kms/v1/keys/v1/key/k1\nContent-Type: application/json\nContent-Length: 55\nDate: Mon, 21 Jul 2014 06:28:33 GMT\nRes {\"versionName\" : \"k1@0\",\n  \"material\" : \"12345w==\"\n} ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kellyzly","name":"kellyzly","key":"kellyzly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liyunzhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-07-21T08:21:52.299+0000","updated":"2014-07-21T08:21:52.299+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-6676/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1xq9b:"}}