{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12723444","self":"https://issues.apache.org/jira/rest/api/2/issue/12723444","key":"HDFS-6600","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-04-21T00:03:08.441+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jul 20 18:15:41 UTC 2018","customfield_12310420":"401631","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-6600/watchers","watchCount":10,"isWatching":false},"created":"2014-06-24T19:16:11.406+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["BB2015-05-TBR"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326143","id":"12326143","description":"2.4.0 release","name":"2.4.0","archived":false,"released":true,"releaseDate":"2014-04-07"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335732","id":"12335732","description":"3.0.0-alpha1 release","name":"3.0.0-alpha1","archived":false,"released":true,"releaseDate":"2016-09-03"}],"issuelinks":[{"id":"12390334","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12390334","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12540302","key":"HDFS-2856","self":"https://issues.apache.org/jira/rest/api/2/issue/12540302","fields":{"summary":"Fix block protocol so that Datanodes don't require root or jsvc","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-07-20T18:15:41.837+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313400","id":"12313400","name":"security"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312944","id":"12312944","name":"tools"}],"timeoriginalestimate":null,"description":"In a secured cluster, running hdfs fsck -move fails.  When trying to move the recovered blocks to lost+found, fsck tries to start using a DFSClient, but it doesn't have the credentials to authenticate that client.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12726715","id":"12726715","filename":"HDFS-6600.1.PATCH","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"created":"2015-04-21T00:03:54.792+0000","size":83135,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12726715/HDFS-6600.1.PATCH"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12748342","id":"12748342","filename":"HDFS-6600.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"created":"2015-08-02T05:13:08.609+0000","size":34943,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12748342/HDFS-6600.2.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"401704","customfield_12312823":null,"summary":"fsck -move fails in secured clusters.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723444/comment/14042555","id":"14042555","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"See below for the warnings and stack trace that show up in the NameNode log.  Using -delete instead of -move still works, because that's going straight through the {{NameNodeRpcServer}} for a metadata operation instead of requiring a full client (and therefore authentication of that client).\n\n{code}\n2014-06-24 19:09:07,009 WARN  ipc.Client (Client.java:run(672)) - Exception encountered while connecting to the server : org.apache.hadoop.security.AccessControlException: Client cannot authenticate via:[TOKEN, KERBEROS]\n2014-06-24 19:09:07,012 WARN  namenode.NameNode (NamenodeFsck.java:lostFoundInit(708)) - Cannot initialize /lost+found .\n2014-06-24 19:09:07,012 ERROR namenode.NameNode (NamenodeFsck.java:copyBlocksToLostFound(562)) - copyBlocksToLostFound: error processing /user/vagrant/hello\njava.io.IOException: failed to initialize lost+found\n        at org.apache.hadoop.hdfs.server.namenode.NamenodeFsck.copyBlocksToLostFound(NamenodeFsck.java:506)\n        at org.apache.hadoop.hdfs.server.namenode.NamenodeFsck.check(NamenodeFsck.java:460)\n        at org.apache.hadoop.hdfs.server.namenode.NamenodeFsck.fsck(NamenodeFsck.java:233)\n        at org.apache.hadoop.hdfs.server.namenode.FsckServlet$1.run(FsckServlet.java:67)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:396)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1557)\n        at org.apache.hadoop.hdfs.server.namenode.FsckServlet.doGet(FsckServlet.java:58)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:707)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:820)\n        at org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:511)\n        at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1221)\n        at org.apache.hadoop.security.authentication.server.AuthenticationFilter.doFilter(AuthenticationFilter.java:392)\n        at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1212)\n        at org.apache.hadoop.http.HttpServer2$QuotingInputFilter.doFilter(HttpServer2.java:1192)\n        at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1212)\n        at org.apache.hadoop.http.NoCacheFilter.doFilter(NoCacheFilter.java:45)\n        at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1212)\n        at org.apache.hadoop.http.NoCacheFilter.doFilter(NoCacheFilter.java:45)\n        at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1212)\n        at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:399)\n        at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)\n        at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:182)\n        at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:766)\n        at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:450)\n        at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:230)\n        at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\n        at org.mortbay.jetty.Server.handle(Server.java:326)\n        at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:542)\n        at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:928)\n        at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:549)\n        at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212)\n        at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404)\n        at org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:410)\n        at org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582)\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-24T19:18:58.559+0000","updated":"2014-06-24T19:18:58.559+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723444/comment/14503996","id":"14503996","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"body":"Please review the patch\n\n{color:green}+1 overall{color}.  \n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 3.0.0) warnings.\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"created":"2015-04-21T00:03:08.441+0000","updated":"2015-04-21T00:03:08.441+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723444/comment/14503997","id":"14503997","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"body":"{color:green}+1 overall{color}.  \n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 3.0.0) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"created":"2015-04-21T00:03:54.799+0000","updated":"2015-04-21T00:03:54.799+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723444/comment/14504186","id":"14504186","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12726715/HDFS-6600.1.PATCH\n  against trunk revision c92f6f3.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-app hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-common hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient:\n\n                  org.apache.hadoop.mapreduce.v2.app.TestMRApp\n                  org.apache.hadoop.mapreduce.v2.app.job.impl.TestTaskAttempt\n                  org.apache.hadoop.mapreduce.v2.TestMROldApiJobs\n                  org.apache.hadoop.mapreduce.lib.output.TestJobOutputCommitter\n\n                                      The following test timeouts occurred in hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-app hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-common hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient:\n\norg.apache.hadoop.mapred.TestJobCleanup\norg.apache.hadoop.mapreduce.v2.TestMRJobsWithProfiler\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/10324//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/10324//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-21T02:40:23.993+0000","updated":"2015-04-21T02:40:23.993+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723444/comment/14551195","id":"14551195","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Hello [~krish.dey].  Thank you for taking up this long-standing issue.\n\nI'm curious if this can work by using {{UserGroupInformation.getLoginUser().doAs(...)}} without re-login from the keytab.  The process was already logged in as the NameNode principal during NameNode startup, so I'd expect this to work.  Have you tried testing with the {{SecurityUtil#login}} line removed?\n\nThis patch is significantly larger because of reformatting changes.  Thank you for cleaning up the code, but could you please omit reformatting changes from this patch?  That helps reviewers focus on the logic changes.  If you'd still like to contribute clean-up work, then that would be welcome on a separate jira.\n\nLonger term, I really wonder if fsck would benefit from having a private API that simply reassociates blocks to a new path/inode.  This would be something like {{concat}}, except instead of working on a source file path/inode, it would work on a source set of blocks.  It would be a pure metadata operation, so we wouldn't pay the network bandwidth cost of copying file content.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-19T20:50:08.573+0000","updated":"2015-05-19T20:50:08.573+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723444/comment/14571341","id":"14571341","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"body":"HI Chris Nauroth,\n\nI think I have tried using UserGroupInformation.getLoginUser().doAs(...) but will try that once more and let you know.\nWill revert the clean up/formatting on the classes and resubmit it.\n\nI agree on the thought of using private API and associates the block to new path/Inode\nThanks\nKrish\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"created":"2015-06-03T17:11:21.335+0000","updated":"2015-06-03T17:11:21.335+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723444/comment/14650554","id":"14650554","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"body":"+1 overall\n\n __________ \n< Success! >\n ---------- \n \\     /\\  ___  /\\\n  \\   // \\/   \\/ \\\\\n     ((    O O    ))\n      \\\\ /     \\ //\n       \\/  | |  \\/ \n        |  | |  |  \n        |  | |  |  \n        |   o   |  \n        | |   | |  \n        |m|   |m| \n\n| Vote |           Subsystem |  Runtime   | Comment\n============================================================================\n|   0  |          pre-patch  |  13m 50s   | Pre-patch trunk compilation is \n|      |                     |            | healthy.\n|  +1  |            @author  |  0m 00s    | The patch does not contain any \n|      |                     |            | @author tags.\n|  +1  |     tests included  |  0m 00s    | The patch appears to include 2 new \n|      |                     |            | or modified test files.\n|  +1  |              javac  |  5m 27s    | There were no new javac warning \n|      |                     |            | messages.\n|  +1  |            javadoc  |  7m 04s    | There were no new javadoc warning \n|      |                     |            | messages.\n|  +1  |      release audit  |  0m 25s    | The applied patch does not increase \n|      |                     |            | the total number of release audit\n|      |                     |            | warnings.\n|  +1  |         checkstyle  |  1m 09s    | There were no new checkstyle \n|      |                     |            | issues.\n|  +1  |         whitespace  |  0m 00s    | The patch has no lines that end in \n|      |                     |            | whitespace.\n|  +1  |            install  |  1m 18s    | mvn install still works. \n|  +1  |    eclipse:eclipse  |  0m 41s    | The patch built with \n|      |                     |            | eclipse:eclipse.\n|  +1  |           findbugs  |  2m 04s    | The patch does not introduce any \n|      |                     |            | new Findbugs (version 3.0.0)\n|      |                     |            | warnings.\n|      |                     |  32m 00s   | ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"created":"2015-08-01T23:45:31.670+0000","updated":"2015-08-01T23:45:31.670+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723444/comment/14650557","id":"14650557","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"body":"Hi Chris,\n\nI have made the modification and the formatting has been reverted.\n\nPlease review and let me know.\n\nThanks\nKrish","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"created":"2015-08-01T23:52:38.562+0000","updated":"2015-08-01T23:52:38.562+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723444/comment/15239420","id":"15239420","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amitabhakarmakar","name":"amitabhakarmakar","key":"amitabhakarmakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amitabha Karmakar","active":true,"timeZone":"America/New_York"},"body":"Hi,\n  Did we do anything further with this patch ? Right now its spawning a lot of problems for us.\n\nThanks,\nAmitabha.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amitabhakarmakar","name":"amitabhakarmakar","key":"amitabhakarmakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amitabha Karmakar","active":true,"timeZone":"America/New_York"},"created":"2016-04-13T15:25:11.610+0000","updated":"2016-04-13T15:25:11.610+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723444/comment/16545797","id":"16545797","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jojochuang","name":"jojochuang","key":"jojochuang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jojochuang&avatarId=25508","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jojochuang&avatarId=25508","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jojochuang&avatarId=25508","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jojochuang&avatarId=25508"},"displayName":"Wei-Chiu Chuang","active":true,"timeZone":"America/Los_Angeles"},"body":"This is unfortunate. I am still able to reproduce this bug on a Hadoop 3 cluster.\r\n\r\nInterestingly, while -move doesn't work in such a case, -delete works.\r\nIf you look at the code,  -delete simply calls NameNodeRpc API as the current user\r\n{code:title=NameNodeFsck#deleteCorruptedFile}\r\nprivate void deleteCorruptedFile(String path) {\r\n    try {\r\n      namenode.getRpcServer().delete(path, true);\r\n      LOG.info(\"Fsck: deleted corrupt file \" + path);\r\n    } catch (Exception e) {\r\n      LOG.error(\"Fsck: error deleting corrupted file \" + path, e);\r\n      internalError = true;\r\n    }\r\n  }\r\n{code}\r\nwhereas -move starts a dfs client and copy the file. Since NameNode APIs doesn't implement file copy, fsck has to start a client and copy the file explicitly. Why does it called '-move\" when it actually does copy?\r\n\r\nI am not quite sure if the attached patch is the right approach to fix the problem. Fsck doesn't check for super user permission by itself. So if you force fsck to run as login user (which has superuser perm), any user could run fsck and move the file to list+found.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jojochuang","name":"jojochuang","key":"jojochuang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jojochuang&avatarId=25508","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jojochuang&avatarId=25508","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jojochuang&avatarId=25508","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jojochuang&avatarId=25508"},"displayName":"Wei-Chiu Chuang","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-07-16T22:09:23.661+0000","updated":"2018-07-16T22:09:23.661+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723444/comment/16551088","id":"16551088","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"body":"Hi Wei,\r\n\r\n \r\n\r\nThanks for reporting this.\r\n\r\nIts been a long time and i will look into the code again.\r\n\r\nBut its not copy but the move of the path to the lost+found.\r\n\r\nAllow me sometime.\r\n\r\n \r\n\r\nThanks\r\n\r\nKrish","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=krish.dey","name":"krish.dey","key":"krish.dey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=krish.dey&avatarId=36615","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=krish.dey&avatarId=36615","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=krish.dey&avatarId=36615","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=krish.dey&avatarId=36615"},"displayName":"Krish Dey","active":true,"timeZone":"America/New_York"},"created":"2018-07-20T18:15:41.837+0000","updated":"2018-07-20T18:15:41.837+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-6600/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1x4rb:"}}