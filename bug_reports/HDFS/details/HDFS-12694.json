{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13111366","self":"https://issues.apache.org/jira/rest/api/2/issue/13111366","key":"HDFS-12694","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Nov 03 06:51:15 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-12694/watchers","watchCount":2,"isWatching":false},"created":"2017-10-23T10:52:34.689+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329057","id":"12329057","description":"2.8.0 release","name":"2.8.0","archived":false,"released":true,"releaseDate":"2017-03-22"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12334863","id":"12334863","description":"2.7.4 release","name":"2.7.4","archived":false,"released":true,"releaseDate":"2017-08-04"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12339198","id":"12339198","name":"2.8.1","archived":false,"released":true,"releaseDate":"2017-06-08"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-11-03T06:51:15.389+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"Somebody else installed another HDFS in hosted machine outside the dockers.\r\n\r\nBut the data node in the hosted machine appears in the docker machine.\r\n\r\n| Node | Http Address | Capacity | Blocks | Block pool used | Version|\r\n| docker1:50010 (10.240.1.101:50010) |\tdocker1:50075 | 931.06 GB | 8420 | 116.64 GB (12.53%) | 2.8.1 |\r\n| docker2:50010 (10.240.1.102:50010) | docker2:50075 | 916.77 GB | 8420 | 116.64 GB (12.72%) | 2.8.1 |\r\n| docker3:50010 (10.240.1.64:50010) | docker3:50075 | 916.77 GB | 0 | 28 KB (0%) | 2.8.1 |\r\n\r\nThe IP address of docker3 should be 10..240.1.103, but it is 10.240.1.64 here which is the IP address of host3. They also have a data node running on host3.\r\n\r\nWe can see in docker3, the used blocks is 0, no data is added here. The replication is 3.\r\nIf I use fsck to check the files, many replication blocks are missing. I think it is because of the IP address.\r\n\r\nFurther more, if I stop the data node in docker3, the heart beat will stop. This is correct.\r\nSo it is a weird bug. \r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Wrong data node registered in docker","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=HalfLegend","name":"HalfLegend","key":"halflegend","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10442","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10442","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10442","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10442"},"displayName":"HalfLegend","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=HalfLegend","name":"HalfLegend","key":"halflegend","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10442","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10442","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10442","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10442"},"displayName":"HalfLegend","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"There hosted machines and each one have a docker.\r\nHosted machines: host1, host2, host3\r\ndockers : docker1, docker2, docker3\r\n\r\nI installed HDFS in each docker. (version 2.8.1)\r\nDocker1 and Docker2 have name node.\r\nDocker1,2,3 all have data node.\r\nI have a weave network of 10.240.1.0/24\r\n","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13111366/comment/16237178","id":"16237178","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=HalfLegend","name":"HalfLegend","key":"halflegend","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10442","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10442","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10442","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10442"},"displayName":"HalfLegend","active":true,"timeZone":"Asia/Shanghai"},"body":"I find the cause, but still don't know why.\r\n\r\nI stopped the firewall on Host3, and then restarted the hdfs on docker3. Everything goes fine. So the problem is because of the firewall.\r\n\r\nI established a VPN server on host3, using the firewall to forward requests. I opened all the ports on host3.\r\nThis is the configuration of the firewall:\r\n\r\n $ firewall-cmd --list-all\r\npublic (active)\r\n  target: default\r\n  icmp-block-inversion: no\r\n  interfaces: eno1\r\n  sources:\r\n  services: dhcpv6-client ssh ipsec\r\n  ports: 1-65534/tcp 500/udp 4500/udp 1-65534/udp\r\n  protocols:\r\n  masquerade: yes\r\n  forward-ports:\r\n  source-ports:\r\n  icmp-blocks:\r\n  rich rules:\r\n\r\n\r\nPlease confirm, which configuration affects the register of the data node.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=HalfLegend","name":"HalfLegend","key":"halflegend","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10442","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10442","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10442","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10442"},"displayName":"HalfLegend","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-11-03T06:51:15.389+0000","updated":"2017-11-03T06:51:15.389+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-12694/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3ll0v:"}}