{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12902370","self":"https://issues.apache.org/jira/rest/api/2/issue/12902370","key":"HDFS-9197","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-02-22T19:26:00.278+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Feb 29 16:27:24 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-9197/watchers","watchCount":4,"isWatching":false},"created":"2015-10-05T07:14:28.696+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325255","id":"12325255","description":"2.3.0 release","name":"2.3.0","archived":false,"released":true,"releaseDate":"2014-02-20"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326143","id":"12326143","description":"2.4.0 release","name":"2.4.0","archived":false,"released":true,"releaseDate":"2014-04-07"}],"issuelinks":[{"id":"12457833","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12457833","type":{"id":"10020","name":"Cloners","inward":"is cloned by","outward":"is a clone of","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10020"},"inwardIssue":{"id":"12940924","key":"HDFS-9841","self":"https://issues.apache.org/jira/rest/api/2/issue/12940924","fields":{"summary":"FileDiff's skipped by hdfs snapshotDiff","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-02-29T16:27:24.646+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320700","id":"12320700","name":"snapshots","description":"HDFS snapshots"}],"timeoriginalestimate":null,"description":"Summary\nWhen a file in HDFS is read, its corresponding inode's accessTime field is updated. If the file is present in the last snapshot, the accessTime change causes a FileDiff to be added to the SnapshotDiff of the last snapshot.\nThis behavior has the following problems:\n- Since FileDiff's reside in memory on the namenodes, snapshots become progressively more memory-heavy with increasing volume of data in hdfs. On a system with frequent updates, e.g. hourly, this becomes a big problem since for, say 2000 snapshots, one can have 2000 FileDiff's per file pointing to the same inode.\n- FSImage grows in size tremendously, and upload operation from standby to active namenode takes much longer.\n-The generated FileDiff does not contain any useful information that I can see. Since all FileDiff's for that file are pointing to the same inode, the accessTime they see is the same.-\n- I was wrong about the last point. Each FileDiff includes a SnapshotCopy attribute, which contains the updated accessTime. This may be a feature, but I'd question the value of having it enabled by default.\n\nConfiguration:\nCDH 5.0.5 (Hadoop 2.3 / 2.4)\nWe are NOT overwriting the default parameter:\nDFS_NAMENODE_ACCESSTIME_PRECISION_DEFAULT = 3600000;\nNote that it determines the allowed frequency of accessTime field updates - every hour by default.\n\nHow to reproduce:\n{code}\n[root@node1076]# hdfs dfs -ls /data/tenants/testenv.testtenant/wddata\nFound 3 items\ndrwxr-xr-x   - hdfs hadoop          0 2015-10-04 10:52 /data/tenants/testenv.testtenant/wddata/folder1\n-rw-r--r--   3 hdfs hadoop         38 2015-10-05 03:13 /data/tenants/testenv.testtenant/wddata/testfile1\n-rw-r--r--   3 hdfs hadoop         21 2015-10-04 10:45 /data/tenants/testenv.testtenant/wddata/testfile2\n[root@node1076]# hdfs dfs -ls /data/tenants/testenv.testtenant/wddata/.snapshot\nFound 8 items\ndrwxr-xr-x   - hdfs hadoop          0 2015-10-04 10:47 /data/tenants/testenv.testtenant/wddata/.snapshot/sn1\ndrwxr-xr-x   - hdfs hadoop          0 2015-10-04 10:47 /data/tenants/testenv.testtenant/wddata/.snapshot/sn2\ndrwxr-xr-x   - hdfs hadoop          0 2015-10-04 10:52 /data/tenants/testenv.testtenant/wddata/.snapshot/sn3\ndrwxr-xr-x   - hdfs hadoop          0 2015-10-04 10:53 /data/tenants/testenv.testtenant/wddata/.snapshot/sn4\ndrwxr-xr-x   - hdfs hadoop          0 2015-10-04 10:57 /data/tenants/testenv.testtenant/wddata/.snapshot/sn5\ndrwxr-xr-x   - hdfs hadoop          0 2015-10-04 10:58 /data/tenants/testenv.testtenant/wddata/.snapshot/sn6\ndrwxr-xr-x   - hdfs hadoop          0 2015-10-05 03:13 /data/tenants/testenv.testtenant/wddata/.snapshot/sn7\ndrwxr-xr-x   - hdfs hadoop          0 2015-10-05 04:20 /data/tenants/testenv.testtenant/wddata/.snapshot/sn8\n[root@node1076]# hdfs dfs -createSnapshot /data/tenants/testenv.testtenant/wddata sn9\nCreated snapshot /data/tenants/testenv.testtenant/wddata/.snapshot/sn9\n[root@node1076]# hdfs snapshotDiff /data/tenants/testenv.testtenant/wddata sn8 sn9\nDifference between snapshot sn8 and snapshot sn9 under directory /data/tenants/testenv.testtenant/wddata:\n\n################\n## IMPORTANT: testfile1 was put into HDFS more than 1 hour ago, which triggers the accessTime update.\n################\n[root@node1076]# hdfs dfs -cat /data/tenants/testenv.testtenant/wddata/testfile1\nThis is test file 1, but now it's 11.\n[root@node1076]# hdfs dfs -createSnapshot /data/tenants/testenv.testtenant/wddata sn10\nCreated snapshot /data/tenants/testenv.testtenant/wddata/.snapshot/sn10\n[root@node1076]# hdfs snapshotDiff /data/tenants/testenv.testtenant/wddata sn9 sn10\nDifference between snapshot sn9 and snapshot sn10 under directory /data/tenants/testenv.testtenant/wddata:\nM\t./testfile1\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Snapshot FileDiff added to last snapshot when INodeFile accessTime field is updated","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=axenol","name":"axenol","key":"axenol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=axenol&avatarId=29291","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=axenol&avatarId=29291","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=axenol&avatarId=29291","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=axenol&avatarId=29291"},"displayName":"Alex Ivanov","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=axenol","name":"axenol","key":"axenol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=axenol&avatarId=29291","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=axenol&avatarId=29291","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=axenol&avatarId=29291","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=axenol&avatarId=29291"},"displayName":"Alex Ivanov","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12902370/comment/15157532","id":"15157532","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"It seems that you can avoid this problem by changing Dfs.namenode.access time.precision.  I'm not sure what change we could make here since atime has the semantics you describe.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-02-22T19:26:00.278+0000","updated":"2016-02-22T19:26:00.278+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12902370/comment/15170941","id":"15170941","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=axenol","name":"axenol","key":"axenol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=axenol&avatarId=29291","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=axenol&avatarId=29291","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=axenol&avatarId=29291","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=axenol&avatarId=29291"},"displayName":"Alex Ivanov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~cmccabe], what I'm proposing is creating a configuration parameter, which specifies whether or not to create a FileDiff for a snapshot based on *atime* changes, otherwise there is pernicious growth of the namenode metadata, which is not even obvious in Hadoop >= 2.5, as specified in [HDFS-9841|https://issues.apache.org/jira/browse/HDFS-9841]. Access time is enabled by default in Hadoop, but not obviously so since you have to go through the API to see it, i.e. *hdfs dfs -ls* does not show it.\n\nAlternatively, *dfs.namenode.access time.precision* should be set to 0 by default, therefore disabling access time, so that people don't run into issues if they don't use it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=axenol","name":"axenol","key":"axenol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=axenol&avatarId=29291","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=axenol&avatarId=29291","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=axenol&avatarId=29291","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=axenol&avatarId=29291"},"displayName":"Alex Ivanov","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-02-28T07:07:08.958+0000","updated":"2016-02-28T07:07:08.958+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12902370/comment/15172080","id":"15172080","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~axenol], I definitely agree that we should be able to see these additional fields being added via snapshotDiff.  If we can't, that's frustrating.\n\n\"Access time\" is a very frustrating feature.  As you noticed, it essentially turns every read operation into a write operation.  This has a lot of bad effects... on local filesystems, it generates lots of writes to disk just from reading files.  It complicates the implementation of distributed filesystems.  Clearly, it also increases snapshot sizes since writes need to be recorded in snapshots.\n\nThese bad things are all fundamental to atime.  This is one reason why many sysadmins always run with \"noatime.\"  It's why Linux distributions ship with \"relatime\" (reduced granularity atime) by default.  HDFS's {{dfs.namenode.access.time.precision}} configuration key is similar.  We could consider changing {{dfs.namenode.access time.precision}} to 0 by default in Hadoop 3.0, since most would consider it an incompatible change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-02-29T16:21:39.068+0000","updated":"2016-02-29T16:21:39.068+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12902370/comment/15172087","id":"15172087","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=axenol","name":"axenol","key":"axenol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=axenol&avatarId=29291","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=axenol&avatarId=29291","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=axenol&avatarId=29291","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=axenol&avatarId=29291"},"displayName":"Alex Ivanov","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for your input, [~cmccabe], this sounds reasonable.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=axenol","name":"axenol","key":"axenol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=axenol&avatarId=29291","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=axenol&avatarId=29291","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=axenol&avatarId=29291","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=axenol&avatarId=29291"},"displayName":"Alex Ivanov","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-02-29T16:27:24.646+0000","updated":"2016-02-29T16:27:24.646+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-9197/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2mkzr:"}}