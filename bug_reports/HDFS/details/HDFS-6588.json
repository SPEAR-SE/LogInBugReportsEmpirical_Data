{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12723040","self":"https://issues.apache.org/jira/rest/api/2/issue/12723040","key":"HDFS-6588","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-06-23T18:12:39.401+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat May 02 04:51:07 UTC 2015","customfield_12310420":"401227","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-6588/watchers","watchCount":5,"isWatching":false},"created":"2014-06-22T20:44:38.725+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["BB2015-05-TBR"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326264","id":"12326264","description":"2.5.0 release","name":"2.5.0","archived":false,"released":true,"releaseDate":"2014-08-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-05-06T03:33:26.895+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313400","id":"12313400","name":"security"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12319200","id":"12319200","name":"webhdfs","description":"WebHDFS: HTTP REST API for HDFS"}],"timeoriginalestimate":null,"description":"When addressing Daryn Sharp's comment for HDFS-6475 quoted below:\n{quote}\nWhat I'm saying is I think the patch adds too much unnecessary code. Filing an improvement to delete all but a few lines of the code changed in this patch seems a bit odd. I think you just need to:\n- Delete getTrueCause entirely instead of moving it elsewhere\n- In saslProcess, just throw the exception instead of running it through getTrueCause since it's not a \"InvalidToken wrapping another exception\" anymore.\n- Keep your 3-line change to unwrap SecurityException in toResponse\n{quote}\n\nThere are multiple test failures, after making the suggested changes, Filing this jira to dedicate to the investigation of removing getTrueCause method.\n\nMore detail will be put in the first comment.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12657013","id":"12657013","filename":"HDFS-6588.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-22T00:52:06.100+0000","size":9087,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12657013/HDFS-6588.001.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12656378","id":"12656378","filename":"HDFS-6588.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-17T22:42:48.053+0000","size":9087,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12656378/HDFS-6588.001.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12655819","id":"12655819","filename":"HDFS-6588.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-15T17:52:21.869+0000","size":9087,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12655819/HDFS-6588.001.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12655689","id":"12655689","filename":"HDFS-6588.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-15T05:26:18.700+0000","size":9087,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12655689/HDFS-6588.001.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"401306","customfield_12312823":null,"summary":"Investigating removing getTrueCause method in Server.java","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14040245","id":"14040245","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"There are the following errors (see https://builds.apache.org/job/PreCommit-HDFS-Build/7198//testReport/):\n\n{code} \n org.apache.hadoop.ipc.TestSaslRPC.testErrorMessage[0]\t0.6 sec\t1\n org.apache.hadoop.ipc.TestSaslRPC.testErrorMessage[1]\t22 ms\t1\n org.apache.hadoop.ipc.TestSaslRPC.testErrorMessage[2]\t18 ms\t1\n org.apache.hadoop.ipc.TestSaslRPC.testErrorMessage[3]\t18 ms\t1\n org.apache.hadoop.ipc.TestSaslRPC.testErrorMessage[4]\t15 ms\t1\n org.apache.hadoop.hdfs.web.TestWebHdfsTokens.testLazyTokenFetchForSWebhdfs\t5.5 sec\t1\n org.apache.hadoop.hdfs.web.TestWebHdfsTokens.testLazyTokenFetchForWebhdfs\n{code}\n\nThe errors belong to two categories:\n\n1. TestWebHdfsTokens\n\nIt failed due to the following exception:\n{code}\njava.security.PrivilegedActionException: org.apache.hadoop.security.token.SecretManager$InvalidToken: token (HDFS_DELEGATION_TOKEN token 5 for DummyUser) can't be found in cache.\n{code}\nthus causing a SecurityException thrown by UserProvider with cause InvalidToken, which is the InvalidToken listed above. The reason is \"token not found in cache\" and it has no cause assigned.\n\nThis means UserProvider could throw two types of exception relevant to our discussion:\n\nT1. SecurityException with InvalidToken as cause, which has StandbyException as cause. Reported in HDFS-6475.\nT2. SecurityException with InvalidToken as cause, which has no cause assigned, and the failure was because \"token not found in cache\".\n\nI found that currently committeed code (including Daryn's fix HDFS-6222) appear to have handled T2, and there actually seems to be no real problem with T2, except my earlier patch to HDFS-6475 \"touched\" it by returning the InvalidToken, which triggerd these test failures.  I am modifying the patch of HDFS-6475 to just process T1 (and not T2) and submitting new version there. \n\nHi [~daryn]  thanks a lot for your review and comments earlier at HDFS-6475. hope this change will be fine with you. I will invite you to comment there when I have the new version uploaded. Appreciate very much.\n\n2. TestSaslRPC\n\n{code}\nexpected:<[Token is invali]d> but was:<[DIGEST-MD5: IO error acquiring passwor]d>\nStacktrace\n\norg.junit.ComparisonFailure: expected:<[Token is invali]d> but was:<[DIGEST-MD5: IO error acquiring passwor]d>\n\tat org.junit.Assert.assertEquals(Assert.java:115)\n\tat org.junit.Assert.assertEquals(Assert.java:144)\n\tat org.apache.hadoop.ipc.TestSaslRPC.testErrorMessage(TestSaslRPC.java:387)\n{code}\n\nThis error happened because we no longer pass the exception through getTrueCause. \n\nThe stack when the above error happened is listed below as a reference.  We can see that the {{retriableRetrievePassword}} method is called, and this test designed it to return InvalidToken because of class {{BadTokenSecretManager}} in the test code TestSaslRPC.java. \n\nHi [~jingzhao], many thanks for your review and advice in HDFS-6475. The {{getTrueCause}} method is part of the HDFS-5322 solution you worked out. Would you please comment whether the above failed tests (failed because of  getTrueCause removal) reflect some real use scenarios? If so, then the logic getgTrueCause need to be reflected in somewhere if this method is to be removed. Thanks.\n\n{code}\nTestSaslRPC$BadTokenSecretManager.retrievePassword(TestSaslRPC$TestTokenIdentifier) line: 268\t\nTestSaslRPC$BadTokenSecretManager(TestSaslRPC$TestTokenSecretManager).retrievePassword(TokenIdentifier) line: 1\t\nTestSaslRPC$BadTokenSecretManager(SecretManager<T>).retriableRetrievePassword(T) line: 91\t\nSaslRpcServer$SaslDigestCallbackHandler.getPassword(TokenIdentifier) line: 275\t\nSaslRpcServer$SaslDigestCallbackHandler.handle(Callback[]) line: 302\t\nDigestMD5Server.validateClientResponse(byte[][]) line: 585\t\nDigestMD5Server.evaluateResponse(byte[]) line: 244\t\nServer$Connection.processSaslToken(RpcHeaderProtos$RpcSaslProto) line: 1392\t\nServer$Connection.processSaslMessage(RpcHeaderProtos$RpcSaslProto) line: 1369\t\nServer$Connection.saslProcess(RpcHeaderProtos$RpcSaslProto) line: 1270\t\nServer$Connection.saslReadAndProcess(DataInputStream) line: 1244\t\nServer$Connection.processRpcOutOfBandRequest(RpcHeaderProtos$RpcRequestHeaderProto, DataInputStream) line: 1932\t\nServer$Connection.processOneRpc(byte[]) line: 1805\t\nServer$Connection.readAndProcess() line: 1548\t\nServer$Listener.doRead(SelectionKey) line: 753\t\nServer$Listener$Reader.doRunLoop() line: 627\t\nServer$Listener$Reader.run() line: 598\t\n{code}\n\nBTW, I have spent quite some time to analyze this, I do believe removal of {{getTrueCause}} is a separate issue and deserve a new jira here. I hope you'd agree based on the information provided above. If you still think it should be taken care of as part of HDFS-6475, please let me know. I'm certainly open for discussion. Thanks a lot.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-22T20:54:54.592+0000","updated":"2014-06-22T20:54:54.592+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14041062","id":"14041062","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"body":"HDFS-5322 should not be related to the failed test. In general, HDFS-5322 simply handles the same issue you're fixing in HDFS-6475, but for the RPC side. So please feel free to make any change you think necessary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-23T18:12:39.401+0000","updated":"2014-06-23T18:12:39.401+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14041112","id":"14041112","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi  [~jingzhao], thanks a lot for the comments. Sorry I didn't make it clear. What I wanted to say was that the getTrueCause method is part of the HDFS-5322 work, the reported tests failed here because of removing getTrueCause(). We could modify the tests to make them pass, but my worry was that the tests were set up to capture real user scenario, changing the test setup might make them no longer reflect real user scenario.\n\nBased on your answer above, however, I guess we could just modify the tests accordingly after removing the getTrueCause() method. Please correct me if I'm wrong. Thanks.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-23T18:40:56.372+0000","updated":"2014-06-23T18:40:56.372+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14041119","id":"14041119","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"body":"Yeah, also the failed tests were not introduced by HDFS-5322 actually.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jingzhao","name":"jingzhao","key":"jingzhao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jing Zhao","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-23T18:47:18.119+0000","updated":"2014-06-23T18:47:18.119+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14041337","id":"14041337","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Jing.\n\nI found that the getTrueCause() method interacts with the following code \n{code}\n  @Override\n  public byte[] retrievePassword(\n      DelegationTokenIdentifier identifier) throws InvalidToken {\n    try {\n      // this check introduces inconsistency in the authentication to a\n      // HA standby NN.  non-token auths are allowed into the namespace which\n      // decides whether to throw a StandbyException.  tokens are a bit\n      // different in that a standby may be behind and thus not yet know\n      // of all tokens issued by the active NN.  the following check does\n      // not allow ANY token auth, however it should allow known tokens in\n      namesystem.checkOperation(OperationCategory.READ);\n    } catch (StandbyException se) {\n      // FIXME: this is a hack to get around changing method signatures by\n      // tunneling a non-InvalidToken exception as the cause which the\n      // RPC server will unwrap before returning to the client\n      InvalidToken wrappedStandby = new InvalidToken(\"StandbyException\");\n      wrappedStandby.initCause(se);\n      throw wrappedStandby;\n    }\n{code}\nin DelegationTokenSecretManager.java introduced by HADOOP-9880.\n\nIf we remove the getTrueCause() logic, at minimum, still need to retain the logic (currently in getTrueCause) to  return the InvalidToken exception that's wrapped by SaslException.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-23T21:23:17.833+0000","updated":"2014-06-23T21:23:17.833+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14042110","id":"14042110","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Upon discussion in HDFS-6475, will try to replace calls to retrievePassword with calls to retriableRetrievePassword as part of fixing this jira. They two calls throw different exceptions, the surrounding logic of the call need to be examined to handle them appropriately.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-24T13:40:45.864+0000","updated":"2014-06-24T13:40:45.864+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14061715","id":"14061715","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~daryn], [~jingzhao] and [~atm],\n\nThanks you all for reviewing HDFS_6475 earlier. Sorry for some delay to follow up with this jira because I took some time off.  I just attached a patch. Your review and input is highly appreciated.\n\nSome quick summary of the patch:\n\n1. Changed AbstractDelegationTokenSecretManager.verifyToken to call retriableRetrievePassword instead of retrievePassword, so it can throw StandbyException. Changed exception specification of related methods.\n\n2. Revised the logic in ExceptionHandler and the test I added for HDFS-6475, so now we handle the case that SecurityException that directly wraps StandbyException (no InvalidToken in between)\n\n3. Largely dropped the logic of getTrueCause. One thing I noticed is, there is a scenario that SaslException wraps InvalidToken as cause, which need to be handled by saslProcess method of Server class. So I didn't totally remove the getTrueCause method. Instead, I left the code to handle this scenario as the only logic there.  As a result, Server.java no longer explicitly depends on StandbyException and RetriableException.\n\nRemoving getTrueCause method as a whole caused the test failure reported in this jira, because of the above described scenario.  \n\nThe stack looks like\n{code}\n14/07/14 10:42:28 WARN ipc.Server: Auth failed for 127.0.0.1:58082:null (DIGEST-MD5: IO error acquiring password)\njavax.security.sasl.SaslException: DIGEST-MD5: IO error acquiring password [Caused by org.apache.hadoop.security.token.SecretManager$InvalidToken: Token is invalid]\n\tat com.sun.security.sasl.digest.DigestMD5Server.validateClientResponse(DigestMD5Server.java:594)\n\tat com.sun.security.sasl.digest.DigestMD5Server.evaluateResponse(DigestMD5Server.java:244)\n\tat org.apache.hadoop.ipc.Server$Connection.processSaslToken(Server.java:1413)\n\tat org.apache.hadoop.ipc.Server$Connection.processSaslMessage(Server.java:1390)\n\tat org.apache.hadoop.ipc.Server$Connection.saslProcess(Server.java:1289)\n\tat org.apache.hadoop.ipc.Server$Connection.saslReadAndProcess(Server.java:1244)\n\tat org.apache.hadoop.ipc.Server$Connection.processRpcOutOfBandRequest(Server.java:1953)\n\tat org.apache.hadoop.ipc.Server$Connection.processOneRpc(Server.java:1826)\n\tat org.apache.hadoop.ipc.Server$Connection.readAndProcess(Server.java:1569)\n\tat org.apache.hadoop.ipc.Server$Listener.doRead(Server.java:753)\n\tat org.apache.hadoop.ipc.Server$Listener$Reader.doRunLoop(Server.java:627)\n\tat org.apache.hadoop.ipc.Server$Listener$Reader.run(Server.java:598)\nCaused by: org.apache.hadoop.security.token.SecretManager$InvalidToken: Token is invalid\n\tat org.apache.hadoop.ipc.TestSaslRPC$BadTokenSecretManager.retrievePassword(TestSaslRPC.java:268)\n\tat org.apache.hadoop.ipc.TestSaslRPC$TestTokenSecretManager.retrievePassword(TestSaslRPC.java:1)\n\tat org.apache.hadoop.security.token.SecretManager.retriableRetrievePassword(SecretManager.java:91)\n\tat org.apache.hadoop.security.SaslRpcServer$SaslDigestCallbackHandler.getPassword(SaslRpcServer.java:275)\n\tat org.apache.hadoop.security.SaslRpcServer$SaslDigestCallbackHandler.handle(SaslRpcServer.java:302)\n\tat com.sun.security.sasl.digest.DigestMD5Server.validateClientResponse(DigestMD5Server.java:585)\n\t... 11 more\n{code}\n\nThanks.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-15T05:56:36.527+0000","updated":"2014-07-15T05:56:36.527+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14061836","id":"14061836","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12655689/HDFS-6588.001.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.fs.shell.TestCopyPreserveFlag\n                  org.apache.hadoop.fs.TestSymlinkLocalFSFileContext\n                  org.apache.hadoop.fs.shell.TestTextCommand\n                  org.apache.hadoop.ipc.TestIPC\n                  org.apache.hadoop.fs.TestSymlinkLocalFSFileSystem\n                  org.apache.hadoop.fs.shell.TestPathData\n                  org.apache.hadoop.fs.TestDFVariations\n                  org.apache.hadoop.hdfs.server.blockmanagement.TestBlocksWithNotEnoughRacks\n                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover\n                  org.apache.hadoop.hdfs.tools.TestDFSAdminWithHA\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/7345//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/7345//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-15T08:32:26.010+0000","updated":"2014-07-15T08:32:26.010+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14062400","id":"14062400","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"It appeared to be a glitch in the testing, re-upload the same patch to trigger a new run. However, there seems to be a real problem with \norg.apache.hadoop.hdfs.tools.TestDFSAdminWithHA.testSaveNamespace, which failed in other runs many times, filed HDFS-6683.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-15T17:51:59.371+0000","updated":"2014-07-15T17:51:59.371+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14062668","id":"14062668","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12655819/HDFS-6588.001.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.fs.TestSymlinkLocalFSFileSystem\n                  org.apache.hadoop.fs.TestSymlinkLocalFSFileContext\n                  org.apache.hadoop.ipc.TestIPC\n                  org.apache.hadoop.hdfs.tools.TestDFSAdminWithHA\n                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/7350//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/7350//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-15T21:22:44.622+0000","updated":"2014-07-15T21:22:44.622+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14062813","id":"14062813","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Similar failures were reported with another run for a different jira:\n\nhttps://builds.apache.org/job/PreCommit-HDFS-Build/7338/#showFailuresLink\n\nRerunning the failed tests locally are successful. Talked with [~cmccabe] about the Symlink related failures and he indicated that symlink is not currently supported and he said these test failures can be ignored for now.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-15T23:00:36.137+0000","updated":"2014-07-15T23:00:36.137+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14063603","id":"14063603","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Filed HDFS-6694 for TestPipelinesFailover.testPipelineRecoveryStress failure (it failed in other JIRA tests too).  \n\nPatch version 001 for this jira is good for review. Thanks a lot.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-16T15:22:07.437+0000","updated":"2014-07-16T15:22:07.437+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14063973","id":"14063973","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Rerunning the failed tests locally are successful. Talked with Colin Patrick McCabe about the Symlink related failures and he indicated that symlink is not currently supported and he said these test failures can be ignored for now.\n\nI said symlinks are disabled in the current *stable releases* of Hadoop.  If you want to get a patch into *trunk*, you still have to ensure that the symlink unit tests don't fail, or provide an explanation of why your patch is not at fault for any failures.  (I know Jenkins has had some issues since the machines were upgraded.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmccabe","name":"cmccabe","key":"cmccabe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cmccabe&avatarId=29060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cmccabe&avatarId=29060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cmccabe&avatarId=29060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cmccabe&avatarId=29060"},"displayName":"Colin P. McCabe","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-16T19:32:06.768+0000","updated":"2014-07-16T19:32:06.768+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14064426","id":"14064426","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~cmccabe]. \n\nIn the same comment I quoted from, I was trying to say that another test without the patch here failed the same tests :\n{quote}\nSimilar failures were reported with another run for a different jira:\nhttps://builds.apache.org/job/PreCommit-HDFS-Build/7338/#showFailuresLink\n{quote}\nI believe the patch here is not related to symlink at all.  I will upload the same patch one more time when HDFS-6683/HDFS-6693 is committed.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-17T00:47:51.215+0000","updated":"2014-07-17T00:47:51.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14065704","id":"14065704","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Upload same patch to trigger a new test.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-17T22:42:48.060+0000","updated":"2014-07-17T22:42:48.060+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14065896","id":"14065896","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12656378/HDFS-6588.001.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.fs.shell.TestCopyPreserveFlag\n                  org.apache.hadoop.fs.TestSymlinkLocalFSFileContext\n                  org.apache.hadoop.fs.shell.TestTextCommand\n                  org.apache.hadoop.ipc.TestIPC\n                  org.apache.hadoop.fs.TestSymlinkLocalFSFileSystem\n                  org.apache.hadoop.fs.shell.TestPathData\n                  org.apache.hadoop.fs.TestDFVariations\n                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover\n                  org.apache.hadoop.hdfs.server.datanode.TestDataNodeMultipleRegistrations\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/7376//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/7376//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-18T02:00:12.641+0000","updated":"2014-07-18T02:00:12.641+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14067968","id":"14067968","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"The symlink tests failed three times in a row here, which indicates that something is wrong. I filed HDFS-6707, investigated and found root cause (irrelevant to the patch of HDFS-6588), posted patch there pending review.  The other tests failed here appear to be flaky, but will try a run again once HDFS-6707 fix is committed.\n \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-20T16:10:53.771+0000","updated":"2014-07-20T16:10:53.771+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14069622","id":"14069622","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Now HDFS-6707 is committed, uploading patch 001 again for another run.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-22T00:52:44.771+0000","updated":"2014-07-22T00:52:44.771+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14069799","id":"14069799","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12657013/HDFS-6588.001.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.ipc.TestIPC\n                  org.apache.hadoop.hdfs.server.balancer.TestBalancer\n                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/7414//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/7414//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-22T04:29:24.649+0000","updated":"2014-07-22T04:29:24.649+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14072524","id":"14072524","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"HI [~daryn], since the fix is trying to address your comments in HDFS-6475,  I wonder if you can be the first one to review the patch. I'd really appreciate it. \n\nThe test failures appear to be irrelevant to the fix here: the TestPipelinesFailover failure was reported as HDFS-6694. For TestIPC and TestBalancer, they are stuck at the same method at\n{quote}\ntest timed out after 100000 milliseconds\nStacktrace\njava.lang.Exception: test timed out after 100000 milliseconds\n\tat java.net.Inet4AddressImpl.getLocalHostName(Native Method)\n\tat java.net.InetAddress.getLocalHost(InetAddress.java:1374)\n{quote}\nI filed HADOOP-10588 and am following up from there.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-23T23:11:41.203+0000","updated":"2014-07-23T23:11:41.203+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14072528","id":"14072528","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Sorry typo, the TestIPC jira is HADOOP-10888.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhangal","name":"yzhangal","key":"yzhangal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongjun Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-23T23:14:17.900+0000","updated":"2014-07-23T23:14:17.900+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14524866","id":"14524866","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"\\\\\n\\\\\n| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Patch URL | http://issues.apache.org/jira/secure/attachment/12657013/HDFS-6588.001.patch |\n| Optional Tests | javadoc javac unit findbugs checkstyle |\n| git revision | trunk / f1a152c |\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/10636/console |\n\n\nThis message was automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-02T04:44:02.724+0000","updated":"2015-05-02T04:44:02.724+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723040/comment/14524901","id":"14524901","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"\\\\\n\\\\\n| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Patch URL | http://issues.apache.org/jira/secure/attachment/12657013/HDFS-6588.001.patch |\n| Optional Tests | javadoc javac unit findbugs checkstyle |\n| git revision | trunk / f1a152c |\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/10651/console |\n\n\nThis message was automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-02T04:51:07.117+0000","updated":"2015-05-02T04:51:07.117+0000"}],"maxResults":23,"total":23,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-6588/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1x2av:"}}