{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13108819","self":"https://issues.apache.org/jira/rest/api/2/issue/13108819","key":"HDFS-12643","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2017-10-12 07:23:05.913","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-12643/watchers","watchCount":7,"isWatching":false},"created":"2017-10-12T07:23:05.913+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-10-12T07:23:05.913+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312918","id":"12312918","name":"documentation"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312926","id":"12312926","name":"namenode"}],"timeoriginalestimate":null,"description":"The current implementation of the HDFS maintenance state feature is confusing and error-prone. The documentation is missing important information that's required for the correct use of the feature.\r\n\r\nFor example, if the Hadoop admin wants to put a single node in maintenance state, he/she can add a single entry to the maintenance file with the contents:\r\n\r\n{code}\r\n{\r\n   \"hostName\": \"host-1.example.com\",\r\n   \"adminState\": \"IN_MAINTENANCE\",\r\n   \"maintenanceExpireTimeInMS\": 1507663698000\r\n}\r\n{code}\r\n\r\nLet's say now that the actual maintenance finished well before the set expiration time and the Hadoop admin wants to bring the node back to NORMAL state. It would be natural to simply change the state of the node, as show below, and run another refresh:\r\n\r\n{code}\r\n{\r\n   \"hostName\": \"host-1.example.com\",\r\n   \"adminState\": \"NORMAL\"\r\n}\r\n{code}\r\n\r\nThe configuration file above, though, not only take the node {{host-1}} out of maintenance state but it also *blacklists all the other DataNodes*. This behaviour seems inconsistent to me and is due to {{emptyInServiceNodeLists}} being set to {{false}} [here|https://github.com/apache/hadoop/blob/230b85d5865b7e08fb7aaeab45295b5b966011ef/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/CombinedHostFileManager.java#L80] only when there is at least one node with {{adminState = NORMAL}} listed in the file.\r\n\r\nI believe that it would be more consistent, and less error prone, to simply implement the following:\r\n* If the dfs.hosts file is empty, all nodes are allowed and in normal state\r\n* If the file is not empty, any host *not* listed in the file is *blacklisted*, regardless of the state of the hosts listed in the file.\r\n\r\nRegardless of the implementation being changed or not, the documentation also needs to be updated to ensure the readers know of the caveats mentioned above.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"HDFS maintenance state behaviour is confusing and not well documented","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=asdaraujo","name":"asdaraujo","key":"asdaraujo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=asdaraujo&avatarId=24580","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=asdaraujo&avatarId=24580","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=asdaraujo&avatarId=24580","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=asdaraujo&avatarId=24580"},"displayName":"Andre Araujo","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=asdaraujo","name":"asdaraujo","key":"asdaraujo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=asdaraujo&avatarId=24580","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=asdaraujo&avatarId=24580","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=asdaraujo&avatarId=24580","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=asdaraujo&avatarId=24580"},"displayName":"Andre Araujo","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-12643/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3l67z:"}}