{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12551443","self":"https://issues.apache.org/jira/rest/api/2/issue/12551443","key":"HDFS-3295","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2012-04-24T15:14:23.722+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Feb 25 02:25:51 UTC 2014","customfield_12310420":"236251","customfield_12312320":null,"customfield_12310222":"10002_*:*_5_*:*_55874866604_*|*_1_*:*_5_*:*_2673724212_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-02-25T02:25:51.048+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-3295/watchers","watchCount":8,"isWatching":false},"created":"2012-04-18T10:56:00.292+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315571","id":"12315571","description":"","name":"0.23.0","archived":false,"released":true,"releaseDate":"2011-11-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-02-25T02:25:51.103+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313153","id":"12313153","name":"balancer & mover"}],"timeoriginalestimate":null,"description":"Scenario:\nReplication factor = 1,fs.defaultFS=hdfs://namenodeip:port,dfs.namenode.rpc-address=namenodeip:port.\nstep 1: started DN1.Pumped 4.67GB of data\nstep 2: started DN2.\nstep 3: issued the balancer cmd(./start-balancer.sh -threshold 1)\n\nTotally  848.41 MB  has been moved to 2DN and took 4 iterations to move the blocks to 2DN.\n\nBut in balancer output in all the iterations the number of bytes already moved is alway 0KB  and there is mismatch in the Bytes being moved with the bytes left to move\n\nBalancer output for 2nd Iteration\n=================================\n{noformat}\nTime Stamp               Iteration#  Bytes Already Moved  Bytes Left To Move  Bytes Being Moved\nApr 18, 2012 12:41:20 PM          0                 0 KB           848.41 MB          151.18 MB\nApr 18, 2012 1:06:46 PM           1                 0 KB           646.02 MB          151.18 MB\nApr 18, 2012 1:10:28 PM           2                 0 KB           417.43 MB          151.18 MB\nApr 18, 2012 1:14:04 PM           3                 0 KB           223.84 MB          151.18 MB\nApr 18, 2012 1:18:10 PM           4                 0 KB            30.34 MB          151.18 MB{noformat}\n\nIn the above balancer output\n\n•Bytes already moved is 0KB\n• In 3 rd iterarion Bytes left to move is 223.84 MB but Bytes being moved is 151.18 MB . So in next iteration the bytes left to move should be 223.84 MB - 151.18 MB \n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315571","id":"12315571","description":"","name":"0.23.0","archived":false,"released":true,"releaseDate":"2011-11-11"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12529861","id":"12529861","filename":"HDFS-3295.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-05-26T11:47:56.560+0000","size":11397,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12529861/HDFS-3295.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12529857","id":"12529857","filename":"HDFS-3295.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-05-26T10:08:25.642+0000","size":11251,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12529857/HDFS-3295.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12528554","id":"12528554","filename":"HDFS-3295.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-05-22T04:55:39.994+0000","size":9791,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12528554/HDFS-3295.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12528380","id":"12528380","filename":"HDFS-3295.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-05-21T03:58:54.228+0000","size":9028,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12528380/HDFS-3295.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12528075","id":"12528075","filename":"HDFS-3295.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-05-18T15:24:25.874+0000","size":8953,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12528075/HDFS-3295.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"2555","customfield_12312823":null,"summary":"Mismatch in number of bytes already moved and number of bytes being moved in balancer report","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreina","name":"andreina","key":"andreina","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"J.Andreina","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andreina","name":"andreina","key":"andreina","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"J.Andreina","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551443/comment/13260643","id":"13260643","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"body":"My analysis :\nIn each iteration we create a new Balancer object\n{code}\n b = new Balancer(nnc, p, conf);\n{code}\nThe bytesMoved calculated from dispatchBlockMoves() in iteration n will get set to 0 again in iteration n+1 as per the above code. Hence when it reaches, \n{code}\nformatter.format(\"%-24s %10d  %19s  %18s  %17s\\n\", \n          DateFormat.getDateTimeInstance().format(new Date()),\n          iteration,\n          StringUtils.byteDesc(bytesMoved.get()),\n          StringUtils.byteDesc(bytesLeftToMove),\n          StringUtils.byteDesc(bytesToMove)\n          );\n{code}\nbytesMoved will be equal to 0.\n\nAlso I have seen some cases where there is no block move for 5 continuous iterations Balancer is not exiting. This is also due to the above reason where notChangedIterations is getting set 0 for each iteration. Hence it never reaches the value >1.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-04-24T15:14:23.722+0000","updated":"2012-04-24T15:14:23.722+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551443/comment/13264676","id":"13264676","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"body":"Scenario 2: Balancer will not exit, even when there is no block movement for 5 continuous iterations.\n\nSteps to reproduce it.\n\nreplication = 1.\nStep 1: start NN and DN1.pump 4 GB of data\nStep 2: start DN2 and stop DN2. It will take 10.5 min for NN to recongnize that the DN2 is down\nStep 3: issue balancer (./hdfs balancer -threshold 1)\n\nBalancer will keep on iterating and will never exit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-04-30T04:48:41.906+0000","updated":"2012-04-30T04:48:41.906+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551443/comment/13278878","id":"13278878","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"body":"Uploading a patch addressing both the scenarios.\n\n1. Created a new class BalancerMetrics in Balancer.java , which has fieds that are common between a NamenodeConnector and Balancer for all the iterations.\n2. Created a map nncVsBalancerMetricsMap which has NamenodeConnector as key and BalancerMetrics as value. So that now for each nnc we will get the fields from this map that are common for the all the iterations and hence this will solve the issue.\n\nPlease review and provide your comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-05-18T15:39:58.349+0000","updated":"2012-05-18T15:39:58.349+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551443/comment/13278969","id":"13278969","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12528075/HDFS-3295.patch\n  against trunk revision .\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 1 new or modified test files.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    -1 javadoc.  The javadoc tool appears to have generated 2 warning messages.\n\n    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.hdfs.server.balancer.TestBalancerWithDNDown\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/2475//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/2475//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-05-18T17:06:14.617+0000","updated":"2012-05-18T17:06:14.617+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551443/comment/13279948","id":"13279948","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"body":"Updated the test case in the patch. This time before starting the balancer waiting for the replication set for the file to complete.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-05-21T04:01:07.059+0000","updated":"2012-05-21T04:01:07.059+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551443/comment/13279976","id":"13279976","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12528380/HDFS-3295.patch\n  against trunk revision .\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 1 new or modified test files.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.hdfs.server.balancer.TestBalancerWithDNDown\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/2493//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/2493//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-05-21T05:50:16.377+0000","updated":"2012-05-21T05:50:16.377+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551443/comment/13280750","id":"13280750","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12528554/HDFS-3295.patch\n  against trunk revision .\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 1 new or modified test files.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:\n\n                  org.apache.hadoop.hdfs.server.balancer.TestBalancerWithDNDown\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/2502//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/2502//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-05-22T06:22:02.367+0000","updated":"2012-05-22T06:22:02.367+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551443/comment/13283964","id":"13283964","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"body":"In test case the shutdownDatanode thread before shutting down the datanode balancer completed all the iterations. Thus using CountDownLatch to make sure that first datanode gets shutdown in the second iteration and then balancer resumes with its iterations.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashish+singhi","name":"ashish singhi","key":"ashish singhi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Singhi","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-05-26T11:50:48.773+0000","updated":"2012-05-26T11:50:48.773+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551443/comment/13283966","id":"13283966","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12529857/HDFS-3295.patch\n  against trunk revision .\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 1 new or modified test files.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/2522//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/2522//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-05-26T11:53:08.356+0000","updated":"2012-05-26T11:53:08.356+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551443/comment/13283979","id":"13283979","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12529861/HDFS-3295.patch\n  against trunk revision .\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 1 new or modified test files.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HDFS-Build/2524//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HDFS-Build/2524//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-05-26T13:29:41.114+0000","updated":"2012-05-26T13:29:41.114+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551443/comment/13426496","id":"13426496","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"body":"+1 on the nice finding on the bug. However, shall we think some cleaner way to fix it? Rather than keeping local variable for each nnc, I think we can keep a map from nnc to balancer object. Then each time, we just call get(nnc) to return (or new if not initiated before) a balancer. That make change on Balancer more concisely. Good work on new unit test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"created":"2012-08-01T10:31:21.856+0000","updated":"2012-08-01T10:31:21.856+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551443/comment/13426519","id":"13426519","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks a lot, Junping, for taking a look and Also thanks to Meng for reporting the issue in other JIRA.\n\nI think currently Balancer will shutdown its executor pools in run method itself once it balanced. So, when we reuse the same balancer, it will fail to use the executor pools as they got shutdown as part of previous run. \n\nMay be the other option is to add the shutdown method in balancer and lets iterate for all the nnConnectors and shutdown the corresponding Balancer? So, the executors can be used when we reuse the balancer object with the nnConnectors.\nAshish, what do you think about this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-08-01T11:01:38.282+0000","updated":"2012-08-01T11:01:38.282+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551443/comment/13911144","id":"13911144","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"body":"This issue has been fixed in HDFS-4261, let's resolve it as \"Cannot Reproduce\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djp","name":"djp","key":"djp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=djp&avatarId=16954","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=djp&avatarId=16954","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=djp&avatarId=16954","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=djp&avatarId=16954"},"displayName":"Junping Du","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-02-25T02:25:51.079+0000","updated":"2014-02-25T02:25:51.079+0000"}],"maxResults":13,"total":13,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-3295/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i00sjb:"}}