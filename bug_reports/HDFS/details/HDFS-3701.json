{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12599834","self":"https://issues.apache.org/jira/rest/api/2/issue/12599834","key":"HDFS-3701","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310942","id":"12310942","key":"HDFS","name":"Hadoop HDFS","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317959","id":"12317959","description":"1.1.0 release","name":"1.1.0","archived":false,"released":true,"releaseDate":"2012-10-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-07-23T11:42:51.608+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Oct 17 18:27:26 UTC 2012","customfield_12310420":"247528","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_5497228144_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-09-25T01:50:49.961+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-3701/watchers","watchCount":16,"isWatching":false},"created":"2012-07-23T10:50:21.830+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320249","id":"12320249","description":"maintenance release on branch-1.0","name":"1.0.3","archived":false,"released":true,"releaseDate":"2012-05-07"}],"issuelinks":[{"id":"12358098","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12358098","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12608587","key":"HDFS-3965","self":"https://issues.apache.org/jira/rest/api/2/issue/12608587","fields":{"summary":"DFSInputStream should not eat up exceptions if file is under construction","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12355389","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12355389","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12599111","key":"HBASE-6401","self":"https://issues.apache.org/jira/rest/api/2/issue/12599111","fields":{"summary":"HBase may lose edits after a crash if used with HDFS 1.0.3 or older","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12365505","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12365505","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12636469","key":"HDFS-4590","self":"https://issues.apache.org/jira/rest/api/2/issue/12636469","fields":{"summary":"Add more Unit Test Case for HDFS-3701 HDFS Miss Final Block Reading when File is Open for Write","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/6","id":"6","description":"A new unit, integration or system test.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/requirement.png","name":"Test","subtask":false}}}},{"id":"12358093","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12358093","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12549917","key":"HDFS-3222","self":"https://issues.apache.org/jira/rest/api/2/issue/12549917","fields":{"summary":"DFSInputStream#openInfo should not silently get the length as 0 when locations length is zero for last partial block.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12357571","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12357571","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12606879","key":"HBASE-6751","self":"https://issues.apache.org/jira/rest/api/2/issue/12606879","fields":{"summary":"Too many retries, leading a a delay to read the HLog after a datanode failure","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-03-12T00:35:02.403+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312928","id":"12312928","name":"hdfs-client"}],"timeoriginalestimate":null,"description":"When the file is opened for writing, the DFSClient calls one of the datanode owning the last block to get its size. If this datanode is dead, the socket exception is shallowed and the size of this last block is equals to zero. This seems to be fixed on trunk, but I didn't find a related Jira. On 1.0.3, it's not fixed. It's on the same area as HDFS-1950 or HDFS-3222.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12544242","id":"12544242","filename":"HDFS-3701.branch-1.v2.merged.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"created":"2012-09-07T16:48:35.291+0000","size":11766,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12544242/HDFS-3701.branch-1.v2.merged.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12546321","id":"12546321","filename":"HDFS-3701.branch-1.v3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-24T16:02:32.577+0000","size":11256,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12546321/HDFS-3701.branch-1.v3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12546419","id":"12546419","filename":"HDFS-3701.branch-1.v4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-25T00:45:39.378+0000","size":11314,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12546419/HDFS-3701.branch-1.v4.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12542614","id":"12542614","filename":"HDFS-3701.ontopof.v1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"created":"2012-08-27T15:40:13.112+0000","size":2114,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12542614/HDFS-3701.ontopof.v1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12542466","id":"12542466","filename":"HDFS-3701.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-08-26T18:39:30.521+0000","size":11620,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12542466/HDFS-3701.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"46458","customfield_12312823":null,"summary":"HDFS may miss the final block when reading a file opened for writing if one of the datanode is dead","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13420581","id":"13420581","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Nicolas,\n\nThanks a lot for digging into DFS changes.\n\n By seeing the description, HDFS-3222 can fix partly, and there are other changes to read the block from all DNs and check specific to ReplicaNotFoundException. If it sees ReplicaNotFoundException from all DNs, then only we will return 0, otherwise we will throw exception.\nCombining these changes should fix this problems. But I don't think we have the specific exception like ReplicaNotFoundException in branch-1.\nI think this new category of exceptions got introduced as part new Appned design. So, distinquishing the replica not found exception and other remote exceptions will be difficult in branch-1 ( let me check the latest code, whether it is possible due to many issues backporting recently)\n\n\nThanks\nUma","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-07-23T11:42:51.608+0000","updated":"2012-07-23T11:42:51.608+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13420689","id":"13420689","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"body":"Hi Uma,\n\nThank you very much for the feedback. In 1.0.3 ReplicaNotFoundException is not there for sure. If it's not there on the branch-1, and if the backport is not planned, a possible workaround would be to at least try on all the datanodes available, and if they all fail with a socket exception rethrow an exception instead of continuing. For other cases, we would return 0.\nThat would not solve all cases, but would decrease the probability of occurence. And this should not bring false positive, the only case that would work today but not after this fix is the case with an empty last block and all datanodes dead. In this case, we would throw an error while previously the DFSClient would have returned O.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"created":"2012-07-23T14:52:02.123+0000","updated":"2012-07-23T14:52:02.123+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13420766","id":"13420766","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"body":"To be clear, this issue is about data loss.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stack","name":"stack","key":"stack","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"stack","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-07-23T16:38:08.493+0000","updated":"2012-07-23T16:38:08.493+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13420871","id":"13420871","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"body":"btw, I if you're ok with the approach I can propose a patch on branch-1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"created":"2012-07-23T18:47:41.900+0000","updated":"2012-07-23T18:47:41.900+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13421175","id":"13421175","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"body":"Yes, that should help us in almost solving this problem.\nIn our internal branch(based on branch-1), we were re-throwing the exception after trying for all the nodes. \n\n{code}\nTo be clear, this issue is about data loss.\n{code}\nYes, Stack. This I have seen in my clusters. We solved it by adding above proposed code and HDFS-3222. \n\n( That time I concentrated to fix HDFS-3222 only on branch-2. But I should have proposed the changes for branch-1 as well :( . See the effect versions marked in HDFS-3222 ). One small gap I have seen in branch-1 is, bytes acked not tracked properly compared to hadoop-2 today. so, if we read the length from some other node which is having lesser length than primary node, and primary node connect back just before starting the actual read request. That time, still this kind of problems will be there. I have seen other JIRA, that 'we have to mark that failed node into dead node list when we get the rpc errors while fetching the length' should help in solving that issue.\n Have not seen so far after that fix in our internal branch.\n\nSo, I am +1 for doing that.\n\n@Nicolas, do you have patch ready for branch-1? if no, I will generate the patch on branch-1 in some time next week.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-07-24T04:56:47.116+0000","updated":"2012-07-24T04:56:47.116+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13421239","id":"13421239","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"body":"@Uma\nI don't have the patch, so if you generate it it's obviously fine by me. Thanks a lot!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"created":"2012-07-24T07:33:10.727+0000","updated":"2012-07-24T07:33:10.727+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13431821","id":"13431821","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"body":"Hi Uma,\n\nHave you been able to generate the patch?\n\nThanks you,\n\nNicolas","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"created":"2012-08-09T14:09:41.255+0000","updated":"2012-08-09T14:09:41.255+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13431829","id":"13431829","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Nicolas, I really did not get the time to work on it as I was busy in some tasks from last few days. Hopefully I will get to it on next week or so.\nBTW, If you feel urgent and you have time to do it, I would be happy to review it and commint in some time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-08-09T14:18:10.734+0000","updated":"2012-08-09T14:18:10.734+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13431898","id":"13431898","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"body":"Thanks for the quick answer, Uma. It's not a matter of days for us, so we can wait for you. And short term I will propose something for HDFS-3705 as the workaround I have for it in HBase is a little bit too much of a workaround :-).\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"created":"2012-08-09T15:21:20.331+0000","updated":"2012-08-09T15:21:20.331+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13442143","id":"13442143","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"body":"Attached initial version of patch, Which is basically merge of HDFS-3222 and added the code to try from other DNs when getting the length for last block. I have not tested this, as I am putting my major efforts on Hadoop-2, did not installed branch-1 cluster.\nDo you mind have a look and test the same.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-08-26T18:44:52.038+0000","updated":"2012-08-26T18:44:52.038+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13442182","id":"13442182","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"body":"Thanks Uma. Sure, I will try it early next week.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"created":"2012-08-26T20:55:02.321+0000","updated":"2012-08-26T20:55:02.321+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13442480","id":"13442480","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"body":"Hi Uma,\n\nI've done a few changes, it seems to work. HBase tests are ok with this new HDFS version, HDFS tests are in progress locally but seems to work ok as well. HDFS-3701.ontopof.v1.patch contains my changes only.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"created":"2012-08-27T15:39:52.512+0000","updated":"2012-08-27T15:39:52.512+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13450156","id":"13450156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Nicolas, which branch is your patch for?  I tried to apply it for branch-1 but it failed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-06T23:27:10.160+0000","updated":"2012-09-06T23:27:10.160+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13450330","id":"13450330","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks N, for the update on patch. sorry for the late on this.\n\n@Nicholas, I think both patches may required to apply. First we have to apply other patch and then  HDFS-3701.ontopof.v1.patch. Because he mentioned 'ontopof'.\n\nToday, If I get time, I will merge both and provide a single one after reviewing his changes. After that it should be possible for you to apply and check. Thanks a lot, Nicholas for your time.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-07T04:18:58.524+0000","updated":"2012-09-07T04:18:58.524+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13450777","id":"13450777","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"body":"Hi Uma and Nicholas,\n\nI uploaded a merged and rebased patch, for branch-1. It contains nothing else that what is already in HDFS-3701.ontopof.v1.patch and HDFS-3701.patch.\n\nIt's in HDFS-3701.branch-1.v2.merged.patch\n\nThanks for your time!\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"created":"2012-09-07T16:45:39.821+0000","updated":"2012-09-07T16:45:39.821+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13460397","id":"13460397","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"body":"Hi there,\n\nDid you have time to look at the patch? It could cause a dataloss, so it would be great to have it integrated...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nkeywal","name":"nkeywal","key":"nkeywal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolas Liochon","active":true,"timeZone":"Europe/Paris"},"created":"2012-09-21T09:50:04.195+0000","updated":"2012-09-21T09:50:04.195+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13460403","id":"13460403","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Nicholas,\n\nDo you mind taking a look at this patch. \nSince I put the patch here, I expect some one to review this!\n\nSeems like Nicolas, has verified it with his clusters and also updated with minor modifications in it.\n\nPatch has: porting os HDFS-3222 and looping over the remaining DNs to get length as trunk and hadoop-2 does.\n\nThanks,\nUma","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-21T09:57:56.065+0000","updated":"2012-09-21T09:57:56.065+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13460518","id":"13460518","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Uma and Nicolas, sorry that I have not got a chance to check the patch.  Will review it soon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-21T14:22:32.620+0000","updated":"2012-09-21T14:22:32.620+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13461744","id":"13461744","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"- fetchLocatedBlocksAndGetLastBlockLength() returns the last block length but the length is only used for checking whether it equals to -1.  So how about changing the return type to boolean (false means location unavailable) and renaming it to fetchLocatedBlocks()?  Then, openInfo could be simplified as below\n{code}\n    synchronized void openInfo() throws IOException {\n      for(int retries = 3; retries > 0; retries--) {\n        if (fetchLocatedBlocks()) {\n          //fetch block success\n          return;\n        } else {\n          // Last block location unavailable. When a cluster restarts,\n          // DNs may not report immediately. At this time partial block\n          // locations will not be available with NN for getting the length.\n          // Lets retry a few times to get the length.\n          DFSClient.LOG.warn(\"Last block locations unavailable. \"\n              + \"Datanodes might not have reported blocks completely.\"\n              + \" Will retry for \" + retries + \" times\");\n          waitFor(4000);\n        }\n      }\n      throw new IOException(\"Could not obtain the last block locations.\");\n    }\n{code}\n\n- We may also change the return type of updateBlockInfo(..) to boolean since the length is not used.  I am fine if you want to keep the length.\n\n- Throw InterruptedIOException, a subclass of IOException, instead of IOException in waitFor(..).\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-24T11:37:54.436+0000","updated":"2012-09-24T11:37:54.436+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13461754","id":"13461754","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks a lot, Nicholas for the review.\nI will address them in next patch soon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-24T12:00:08.077+0000","updated":"2012-09-24T12:00:08.077+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13461764","id":"13461764","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"body":"Uma, if you are busy let me know. I can post address Nicholas's comments. Given that 1.1.0 new RC might be built today, it is good to get this in soon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sureshms","name":"sureshms","key":"sureshms","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Suresh Srinivas","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-24T12:27:54.098+0000","updated":"2012-09-24T12:27:54.098+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13461876","id":"13461876","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks a lot, Suresh for the help you offered.\nI have attached a patch which addresses Nicholas's comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-24T16:02:32.579+0000","updated":"2012-09-24T16:02:32.579+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13462266","id":"13462266","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"- fetchLocatedBlocks() should use the return value of updateBlockInfo(..).  \n{code}\n@@ -1965,54 +1996,77 @@\n       updateBlockInfo(newInfo);\n       this.locatedBlocks = newInfo;\n       this.currentNode = null;\n+      return true;\n     }\n{code}\nThe code above should be\n{code}\n@@ -1965,54 +1996,77 @@\n-      updateBlockInfo(newInfo);\n+      boolean b = updateBlockInfo(newInfo);\n       this.locatedBlocks = newInfo;\n       this.currentNode = null;\n+      return b;\n     }\n{code}\n- This is a separated issue: The following comment should be removed since the old and new block lists must be the same even with append.  Append may add new blocks but the existing blocks must be the same.  See if you also want to remove it with the patch here.\n{code}\n//In fetchLocatedBlocks(),\n       // I think this check is not correct. A file could have been appended to\n       // between two calls to openInfo().\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-24T23:47:55.225+0000","updated":"2012-09-24T23:47:55.225+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13462306","id":"13462306","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"body":"Oops, Its my mistake. Prepared it on hurry. Really sorry for my mistake here.\n\nActually I might have removed thinking that updateBlkInfo will throw exception in failure. did not looked bak once changed updateBlkInfo.\n\nRemoved comment along with this patch.\n\nIn trunk, waitFor is throwing IOException, do you think, I can file a small trivial bug and change for consistency in code?  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-25T00:45:39.380+0000","updated":"2012-09-25T00:45:39.380+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13462322","id":"13462322","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 patch looks good.  Please run tests and test-patch if you haven't.  Thanks a lot!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-25T01:02:04.066+0000","updated":"2012-09-25T01:02:04.066+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13462353","id":"13462353","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"body":"I have just committed to branch-1, Committed revision 1389678.\nHave not seen any new failure in my env with this path.\n\nThanks a lot Nicolas for your contribution in this issue and closer track on it.\n\nThanks a lot to Nicholas for your reviews!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-25T01:50:49.971+0000","updated":"2012-09-25T01:50:49.971+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13465901","id":"13465901","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mattf","name":"mattf","key":"mattf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Foley","active":true,"timeZone":"America/Los_Angeles"},"body":"merged to branch-1.1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mattf","name":"mattf","key":"mattf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Foley","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-28T21:03:38.793+0000","updated":"2012-09-28T21:03:38.793+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599834/comment/13478157","id":"13478157","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mattf","name":"mattf","key":"mattf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Foley","active":true,"timeZone":"America/Los_Angeles"},"body":"Closed upon release of Hadoop-1.1.0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mattf","name":"mattf","key":"mattf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Foley","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-17T18:27:26.439+0000","updated":"2012-10-17T18:27:26.439+0000"}],"maxResults":28,"total":28,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HDFS-3701/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i08bh3:"}}