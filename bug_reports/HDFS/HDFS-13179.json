{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": null,
        "components": [{
            "id": "12327021",
            "name": "fs",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12327021"
        }],
        "created": "2018-02-22T22:32:48.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gabor.bota&avatarId=33034",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gabor.bota&avatarId=33034",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gabor.bota&avatarId=33034",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=gabor.bota&avatarId=33034"
            },
            "displayName": "Gabor Bota",
            "key": "gabor.bota",
            "name": "gabor.bota",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=gabor.bota",
            "timeZone": "Europe/Budapest"
        },
        "customfield_10010": null,
        "customfield_12310191": null,
        "customfield_12310192": null,
        "customfield_12310220": "2018-03-12T20:10:21.272+0000",
        "customfield_12310222": null,
        "customfield_12310230": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "1.0",
        "customfield_12310320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12310920": "9223372036854775807",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i3qhv3:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Mon Mar 26 09:02:10 UTC 2018",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "The error caused by TimeoutException because the test is waiting to ensure that the file is replicated to DISK storage but the replication can't be finished to DISK during the 30s timeout in ensureFileReplicasOnStorageType(), but the file is still on RAM_DISK - so there is no data loss.\r\n\r\nAdding the following to TestLazyPersistReplicaRecovery.java:56 essentially fixes the flakiness. \r\n{code:java}\r\n    try {\r\n      ensureFileReplicasOnStorageType(path1, DEFAULT);\r\n    }catch (TimeoutException t){\r\n      LOG.warn(\"We got \\\"\" + t.getMessage() + \"\\\" so trying to find data on RAM_DISK\");\r\n      ensureFileReplicasOnStorageType(path1, RAM_DISK);\r\n    }\r\n  }\r\n{code}\r\n\r\nSome thoughts:\r\n* Successful and failed tests run similar to the point when datanode restarts. Restart line is the following in the log: LazyPersistTestCase - Restarting the DataNode\r\n* There is a line which only occurs in the failed test: *addStoredBlock: Redundant addStoredBlock request received for blk_1073741825_1001 on node 127.0.0.1:49455 size 5242880*\r\n* This redundant request at BlockManager#addStoredBlock could be the main reason for the test fail. Something wrong with the gen stamp? Corrupt replicas? \r\n\r\n=============================\r\n\r\nCurrent fail ratio based on my test of TestLazyPersistReplicaRecovery: \r\n1000 runs, 34 failures (3.4% fail)\r\n\r\nFailure rate analysis:\r\nTestLazyPersistReplicaRecovery.testDnRestartWithSavedReplicas: 3.4%\r\n\r\n33 failures caused by: {noformat}\r\njava.util.concurrent.TimeoutException: Timed out waiting for condition. Thread diagnostics: Timestamp: 2018-01-05 11:50:34,964 \"IPC Server handler 6 on 39589\" \r\n{noformat}\r\n\r\n1 failure caused by: {noformat}\r\njava.net.BindException: Problem binding to [localhost:56729] java.net.BindException: Address already in use; For more details see: http://wiki.apache.org/hadoop/BindException at org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.TestLazyPersistReplicaRecovery.testDnRestartWithSavedReplicas(TestLazyPersistReplicaRecovery.java:49) Caused by: java.net.BindException: Address already in use at org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.TestLazyPersistReplicaRecovery.testDnRestartWithSavedReplicas(TestLazyPersistReplicaRecovery.java:49)\r\n{noformat}\r\n\r\n=============================\r\n\r\nExample stacktrace:\r\n{noformat}\r\nTimed out waiting for condition. Thread diagnostics:\r\nTimestamp: 2017-11-01 10:36:49,499\r\n\"Thread-1\" prio=5 tid=13 runnable\r\njava.lang.Thread.State: RUNNABLE\r\nat java.lang.Thread.dumpThreads(Native Method)\r\nat java.lang.Thread.getAllStackTraces(Thread.java:1610)\r\nat org.apache.hadoop.test.TimedOutTestsListener.buildThreadDump(TimedOutTestsListener.java:87)\r\nat org.apache.hadoop.test.TimedOutTestsListener.buildThreadDiagnosticString(TimedOutTestsListener.java:73)\r\nat org.apache.hadoop.test.GenericTestUtils.waitFor(GenericTestUtils.java:369)\r\nat org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.LazyPersistTestCase.ensureFileReplicasOnStorageType(LazyPersistTestCase.java:140)\r\nat org.apache.hadoop.hdfs.server.datanode.fsdataset.impl.TestLazyPersistReplicaRecovery.testDnRestartWithSavedReplicas(TestLazyPersistReplicaRecovery.java:54)\r\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\nat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\nat java.lang.reflect.Method.invoke(Method.java:498)\r\n...\r\n{noformat}",
        "duedate": null,
        "environment": null,
        "fixVersions": [],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/critical.svg",
            "id": "2",
            "name": "Critical",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/2"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310942&avatarId=10094",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310942&avatarId=10094",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310942&avatarId=10094",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310942&avatarId=10094"
            },
            "id": "12310942",
            "key": "HDFS",
            "name": "Hadoop HDFS",
            "projectCategory": {
                "description": "Scalable Distributed Computing",
                "id": "10292",
                "name": "Hadoop",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10292"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12310942"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gabor.bota&avatarId=33034",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gabor.bota&avatarId=33034",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gabor.bota&avatarId=33034",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=gabor.bota&avatarId=33034"
            },
            "displayName": "Gabor Bota",
            "key": "gabor.bota",
            "name": "gabor.bota",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=gabor.bota",
            "timeZone": "Europe/Budapest"
        },
        "resolution": null,
        "resolutiondate": null,
        "status": {
            "description": "The issue is open and ready for the assignee to start work on it.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
            "id": "1",
            "name": "Open",
            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
            "statusCategory": {
                "colorName": "blue-gray",
                "id": 2,
                "key": "new",
                "name": "To Do",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2"
            }
        },
        "subtasks": [],
        "summary": "TestLazyPersistReplicaRecovery#testDnRestartWithSavedReplicas fails intermittently",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2018-03-27T02:50:53.000+0000",
        "versions": [{
            "archived": false,
            "description": "3.0.0 GA release",
            "id": "12341433",
            "name": "3.0.0",
            "releaseDate": "2017-12-13",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12341433"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HDFS-13179/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HDFS-13179/watchers",
            "watchCount": 7
        },
        "workratio": -1
    },
    "id": "13140341",
    "key": "HDFS-13179",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13140341"
}