{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12748168","self":"https://issues.apache.org/jira/rest/api/2/issue/12748168","key":"ZOOKEEPER-2062","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326786","id":"12326786","description":"Alpha release against 3.5 branch","name":"3.5.1","archived":false,"released":true,"releaseDate":"2015-09-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326518","id":"12326518","name":"3.6.0","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-10-15T01:29:43.928+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue May 05 11:19:54 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_787913960_*|*_1_*:*_1_*:*_16676906583_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-05-05T02:44:05.466+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2062/watchers","watchCount":6,"isWatching":false},"created":"2014-10-14T23:23:44.988+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316644","id":"12316644","description":"Dynamic Reconfig, Remove Watches, Local Session","name":"3.5.0","archived":false,"released":true,"releaseDate":"2014-08-04"}],"issuelinks":[{"id":"12422744","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12422744","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12529452","key":"ZOOKEEPER-1274","self":"https://issues.apache.org/jira/rest/api/2/issue/12529452","fields":{"summary":"Support child watches to be displayed with 4 letter zookeeper commands (i.e. wchs, wchp and wchc)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-05-05T11:19:54.986+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312427","id":"12312427","name":"tests","description":"For issues with test cases"}],"timeoriginalestimate":null,"description":"[junit] Running org.apache.zookeeper.RemoveWatchesTest\n    [junit] Tests run: 46, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 306.188 sec","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12728183","id":"12728183","filename":"ZOOKEEPER-2062.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-25T23:52:05.999+0000","size":8415,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12728183/ZOOKEEPER-2062.001.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12728243","id":"12728243","filename":"ZOOKEEPER-2062.002.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-26T17:50:40.637+0000","size":8313,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12728243/ZOOKEEPER-2062.002.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12728495","id":"12728495","filename":"ZOOKEEPER-2062.003.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-27T19:50:34.106+0000","size":9996,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12728495/ZOOKEEPER-2062.003.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12729218","id":"12729218","filename":"ZOOKEEPER-2062.004.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-29T16:42:51.293+0000","size":12133,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12729218/ZOOKEEPER-2062.004.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"RemoveWatchesTest takes forever to run","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14171846","id":"14171846","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks @fpj for pointing out this. Following are the testcases which takes huge amount of time. Most of them have verification points by checking that the watcher(data/child) is really removed or not, its done by waiting few seconds(CONNECTION_TIMEOUT/5) for the watch notifications. This certainly needs improvement and can think for a better verification idea.\n\n{code}\nRemoveWatchesTest.java\n       Assert.assertFalse(\"Shouldn't remove data watcher\", w1.matches());\n\n       // matches logic is waiting for the watch notification ?\n        public boolean matches() throws InterruptedException {\n            if (!latch.await(CONNECTION_TIMEOUT/5, TimeUnit.MILLISECONDS)) {\n                LOG.error(\"Failed waiting to remove the watches\");\n                return false;\n            }\n{code}\n\n{code}\ntestRemoveAllChildWatchesOnAPath[0]\t30 sec\tPassed\ntestRemoveAllChildWatchesOnAPath[1]\t30 sec\tPassed\ntestRemoveAllDataWatchesOnAPath[0]\t30 sec\tPassed\ntestRemoveAllDataWatchesOnAPath[1]\t30 sec\tPassed\ntestRemoveWatcherWhenNoConnection[0]\t14 sec\tPassed\ntestRemoveWatcherWhenNoConnection[1]\t14 sec\tPassed\ntestMultipleChildWatchers[0]\t\t9 sec\tPassed\ntestMultipleChildWatchers[1]\t\t9 sec\tPassed\ntestManyWatchersWhenNoConnection[1]\t6.9 sec\tPassed\ntestChRootRemoveWatcher[0]\t\t6.1 sec\tPassed\ntestChRootRemoveWatcher[1]\t\t6 sec\tPassed\ntestMultipleDataWatchers[0]\t\t6 sec\tPassed\ntestMultipleDataWatchers[1]\t\t6 sec\tPassed\ntestRemoveAnyChildWatcher[0]\t\t6 sec\tPassed\ntestRemoveAnyChildWatcher[1]\t\t6 sec\tPassed\ntestRemoveAnyDataWatcher[0]\t\t6 sec\tPassed\ntestRemoveAnyDataWatcher[1]\t\t6 sec\tPassed\ntestRemoveSingleWatcher[0]\t\t6.4 sec\tPassed\ntestRemoveSingleWatcher[1]\t\t6 sec\tPassed\ntestManyWatchersWhenNoConnection[0]\t5.2 sec\tPassed\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2014-10-15T01:29:43.928+0000","updated":"2014-10-15T01:29:43.928+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14171873","id":"14171873","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Again, few of these test cases has similar kinda false notification checks by waiting long time. Here its 30secs wait period to see any possibility of getting a false notification:\n{code}\nAssert.assertFalse(\"Received data watch notification!\",\n                dWatchCount.await(CONNECTION_TIMEOUT, TimeUnit.MILLISECONDS));\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2014-10-15T01:51:42.597+0000","updated":"2014-10-15T01:51:42.597+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14512772","id":"14512772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"[~rakeshr], I'm attaching a patch that speeds up the 4 slowest tests in the suite.  Would you be interested in reviewing?  Running the entire {{RemoveWatchesTest}} suite from trunk on my machine takes ~5 minutes.  With this patch, that drops to ~2 minutes.\n\nThis required hooking into the internals of some of the production code.  This is the least intrusive way to do it that I could find, but let me know if you have other ideas.  I've defined a new {{WatchManagerListener}} interface that receives direct notification when the {{WatchManager}} triggers a watch.  For the tests that need to check that they did not receive notification after removing a watch, they can use the listener to check immediately instead of relying on a long wait to be sure.  This also makes the tests deterministic as opposed to the waiting approach.\n\nI wanted to make sure I didn't harm what the tests were trying to prove.  To do that, I temporarily introduced a bug in my local environment.  I hacked {{ZKDatabase#removeWatch}} so that it didn't actually remove the watch.  When I did that, the tests still failed and caught the bug (as they should).\n\nPlease let me know your thoughts on the patch.  It would be nice to shave a few minutes off of every pre-commit run.  :-)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-25T23:52:06.006+0000","updated":"2015-04-25T23:52:06.006+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14512806","id":"14512806","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12728183/ZOOKEEPER-2062.001.patch\n  against trunk revision 1672934.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2648//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2648//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2648//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-26T00:49:14.279+0000","updated":"2015-04-26T00:49:14.279+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14513157","id":"14513157","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm attaching patch v002, which simplifies the test a bit by having it directly implement the {{WatchManagerListener}} interface.  I also corrected a JavaDoc typo in {{WatchManagerListener}}.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-26T17:50:40.642+0000","updated":"2015-04-26T17:50:40.642+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14513182","id":"14513182","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12728243/ZOOKEEPER-2062.002.patch\n  against trunk revision 1672934.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2650//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2650//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2650//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-26T18:48:48.850+0000","updated":"2015-04-26T18:48:48.850+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14513407","id":"14513407","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":" [~cnauroth] I really appreciate your thoughts. Its very nice approach by directly using the {{DataTree}} watch information in tests. This would make the tests more deterministic as opposed to the waiting approach. Your idea of {{WatchManagerListener}} makes it simple. On a second thought I'm trying to avoid creating an extra listener just for testing purpose, if we couldn't manage to find a best way, I agree to go ahead with the {{WatchManagerListener}}. Can we first think of using existing data structures and the APIs available in {{DataTree}} to satisfy the test assertions.\n\n\nI've tried slightly different approach. Please see the below improvement and does this sound good to you? If yes, we will modify all the similar waiting cases into this kinda approach.\n\n1. In {{testRemoveAllDataWatchesOnAPath}}. Modify the below part\n{code}\n        Assert.assertNotNull(\"Didn't set data watches\",\n                zk2.exists(\"/node1\", w2));\n\n        removeAllWatches(zk2, \"/node1\", WatcherType.Data, false, Code.OK);\n        Assert.assertTrue(\"Didn't remove data watcher\",\n                rmWatchCount.await(CONNECTION_TIMEOUT, TimeUnit.MILLISECONDS));\n\n        zk1.setData(\"/node1\", \"test\".getBytes(), -1);\n        LOG.info(\"Waiting for data watchers notification after watch removal\");\n        Assert.assertFalse(\"Received data watch notification!\",\n                dWatchCount.await(CONNECTION_TIMEOUT, TimeUnit.MILLISECONDS));\n        Assert.assertEquals(\"Received watch notification after removal!\", 2,\n                dWatchCount.getCount());\n{code}\n\nto\n\n{code}\n        Set<Long> sessions = getServer(serverFactory).getZKDatabase()\n                .getDataTree().getWatchesByPath().getSessions(\"/node1\");\n        Assert.assertNotNull(\"Didn't find the session\", sessions);\n        final long sessionId = sessions.iterator().next();\n        Assert.assertEquals(\"Session mismatches\", zk2.getSessionId(), sessionId);\n\n        removeAllWatches(zk2, \"/node1\", WatcherType.Data, false, Code.OK);\n\n        Assert.assertTrue(\"Didn't remove data watcher\",\n                rmWatchCount.await(CONNECTION_TIMEOUT, TimeUnit.MILLISECONDS));\n        Assert.assertFalse(\"Child watchers exists after removal!\",\n                getServer(serverFactory).getZKDatabase().getDataTree()\n                .getWatchesByPath().hasSessions(\"/node1\"));\n{code}\n\n2. In {{testChRootRemoveWatcher}}. Modify the below part\n{code}\nAssert.assertFalse(\"Shouldn't remove data watcher\", w2.matches());\n{code}\n\nto \n\n{code}\n        Assert.assertEquals(\"Didn't find child watcher\", 1, zk2\n                .getChildWatches().size());\n        removeWatches(zk2, \"/node1\", w2, WatcherType.Any, false, Code.OK);\n        Assert.assertTrue(\"Didn't remove child watcher\", w2.matches());\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-04-27T01:47:36.517+0000","updated":"2015-04-27T01:47:36.517+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14514596","id":"14514596","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fournc","name":"fournc","key":"fournc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Camille Fournier","active":true,"timeZone":"Etc/UTC"},"body":"I dig this a bunch.\n[~rakeshr] if you wanna upload an updated patch with your changes I will review it and pending my +1 you can check it in.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fournc","name":"fournc","key":"fournc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Camille Fournier","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-27T18:15:49.743+0000","updated":"2015-04-27T18:15:49.743+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14514607","id":"14514607","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks, Camille.  I've got something in progress making similar changes across the suite.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-27T18:19:34.381+0000","updated":"2015-04-27T18:19:34.381+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14514617","id":"14514617","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"I also wanted to mention that {{DataTree#getWatchesByPath}} returns only data watchers (not child watchers), so I modified the suggestion from Rakesh a bit to check if the {{ServerCnxn}} is registered as a watcher for covering both cases.  Thanks for the help Rakesh!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-27T18:25:39.741+0000","updated":"2015-04-27T18:25:39.741+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14514833","id":"14514833","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm attaching patch v003.  This brings the whole test suite run down to 1 minute 20 seconds on my machine.\n\nThis applies the suggestions from the last comment from Rakesh.  As mentioned in my last comment though, I found that {{DataTree#getWatchesByPath}} returned only data watches.  Instead of relying on that, I've added assertions on whether or not the server-side session is registered as a watcher.  Let me know if this is sufficient.\n\n{{testRemoveSingleWatcher}} and {{testMultipleDataWatchers}} are still a tad slow.  However, I didn't want to change these, because it seems these are specifically intended to check session close semantics.  Once the session is closed, trying to do these new assertions wouldn't be valid, so I left these tests waiting on the latches for timeouts.\n\nI also didn't change the {{*NoConnection}} tests.  It seems the only option here would be to downtune client timeout settings, which could get finicky.\n\nI verified again that introducing bugs in {{ZKDatabase}} causes test failures, so the tests are still capable of catching regressions.\n\nRakesh and Camille, what do you think of this version?  Thanks again for your guidance!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-27T19:50:34.112+0000","updated":"2015-04-27T19:50:34.112+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14514960","id":"14514960","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12728495/ZOOKEEPER-2062.003.patch\n  against trunk revision 1676359.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2652//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2652//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2652//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-27T20:48:27.070+0000","updated":"2015-04-27T20:48:27.070+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14515020","id":"14515020","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"I just spotted ZOOKEEPER-1274 tracking an enhancement to include child watches in the watch reports for {{wchc}} and {{wchp}}.  I'm linking the issues for the benefit of anyone who stumbles onto this conversation later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-27T21:18:28.786+0000","updated":"2015-04-27T21:18:28.786+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14519233","id":"14519233","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~cnauroth] for taking care this. Latest patch looks nice!\n\nFor the {{testRemoveSingleWatcher}} and {{testMultipleDataWatchers}}. Its written to see any events triggered after the session closure. I think there is a space to improve this also. In these tests, {{assertFalse}} is too costly and we could replace the {{assertFalse}} statement like below and move them above {{zk1.close();}} statement.\n\n{code}\n        Assert.assertTrue(\"Didn't remove data watcher\", w1.matches());\n        Assert.assertFalse(\"Should have removed data watcher\", w2.matches());\n{code}\n\nto \n\n{code}\n        Assert.assertEquals(\"Didn't find data watcher\", 1, zk2.getDataWatches().size());\n        Assert.assertEquals(\"Didn't find data watcher\", \"/node2\", zk2.getDataWatches().get(0));\n        removeWatches(zk2, \"/node2\", w2, WatcherType.Any, false, Code.OK);\n        Assert.assertTrue(\"Didn't remove data watcher\", w2.matches());\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-04-29T12:11:35.356+0000","updated":"2015-04-29T12:11:35.356+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14519696","id":"14519696","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks again, Rakesh.  Here is patch v004 incorporating your last suggestion.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-29T16:42:51.301+0000","updated":"2015-04-29T16:42:51.301+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14519785","id":"14519785","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12729218/ZOOKEEPER-2062.004.patch\n  against trunk revision 1676359.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2657//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2657//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2657//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-29T17:33:33.656+0000","updated":"2015-04-29T17:33:33.656+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14519804","id":"14519804","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. -1 core tests. The patch failed core unit tests.\n\nThe test failure looks unrelated, since the patch changed only one test suite, and the failure is in a different test suite.\n\nThere is a nice speed-up visible in that last Jenkins run!  :-)\n\nBefore:\nTests run: 46, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 306.188 sec\n\nAfter:\nTests run: 46, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 54.075 sec\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-29T17:40:49.338+0000","updated":"2015-04-29T17:40:49.338+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14519817","id":"14519817","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~cnauroth], Nice to see the tests passed in 53secs in the latest jenkins report. I could see only {{*NoConnection}} tests are taking more time, but I'm OK as these unit test cases depending on zookeeper client connection timeouts.\n\n{code}\ntestChRootRemoveWatcher[0]\t\t\t86 ms\tPassed\ntestChRootRemoveWatcher[1]\t\t\t76 ms\tPassed\ntestManyChildWatchers[0]\t\t\t0.3 sec\tPassed\ntestManyChildWatchers[1]\t\t\t0.24 secPassed\ntestManyDataWatchers[0]\t\t\t\t0.28 secPassed\ntestManyDataWatchers[1]\t\t\t\t0.26 secPassed\ntestManyPreNodeWatchers[0]\t\t\t0.21 secPassed\ntestManyPreNodeWatchers[1]\t\t\t0.19 secPassed\ntestManyWatchersWhenNoConnection[0]\t\t5.7 sec\tPassed\ntestManyWatchersWhenNoConnection[1]\t\t6.3 sec\tPassed\ntestMultipleChildWatchers[0]\t\t\t3 sec\tPassed\ntestMultipleChildWatchers[1]\t\t\t3 sec\tPassed\ntestMultipleDataWatchers[0]\t\t\t67 ms\tPassed\ntestMultipleDataWatchers[1]\t\t\t58 ms\tPassed\ntestNoWatcherException[0]\t\t\t79 ms\tPassed\ntestNoWatcherException[1]\t\t\t60 ms\tPassed\ntestNoWatcherServerException[0]\t\t\t58 ms\tPassed\ntestNoWatcherServerException[1]\t\t\t46 ms\tPassed\ntestNullWatcherReference[0]\t\t\t48 ms\tPassed\ntestNullWatcherReference[1]\t\t\t45 ms\tPassed\ntestRemoveAllChildWatchers[0]\t\t\t59 ms\tPassed\ntestRemoveAllChildWatchers[1]\t\t\t59 ms\tPassed\ntestRemoveAllChildWatchesOnAPath[0]\t\t50 ms\tPassed\ntestRemoveAllChildWatchesOnAPath[1]\t\t47 ms\tPassed\ntestRemoveAllDataWatchers[0]\t\t\t65 ms\tPassed\ntestRemoveAllDataWatchers[1]\t\t\t64 ms\tPassed\ntestRemoveAllDataWatchesOnAPath[0]\t\t55 ms\tPassed\ntestRemoveAllDataWatchesOnAPath[1]\t\t48 ms\tPassed\ntestRemoveAllNoWatcherException[0]\t\t55 ms\tPassed\ntestRemoveAllNoWatcherException[1]\t\t46 ms\tPassed\ntestRemoveAllWatchers[0]\t\t\t73 ms\tPassed\ntestRemoveAllWatchers[1]\t\t\t62 ms\tPassed\ntestRemoveAllWatchesOnAPath[0]\t\t\t55 ms\tPassed\ntestRemoveAllWatchesOnAPath[1]\t\t\t51 ms\tPassed\ntestRemoveAnyChildWatcher[0]\t\t\t62 ms\tPassed\ntestRemoveAnyChildWatcher[1]\t\t\t53 ms\tPassed\ntestRemoveAnyDataWatcher[0]\t\t\t66 ms\tPassed\ntestRemoveAnyDataWatcher[1]\t\t\t52 ms\tPassed\ntestRemoveSingleWatcher[0]\t\t\t0.36 secPassed\ntestRemoveSingleWatcher[1]\t\t\t54 ms\tPassed\ntestRemoveWatcherWhenNoConnection[0]\t\t16 sec\tPassed\ntestRemoveWatcherWhenNoConnection[1]\t\t15 sec\tPassed\ntestRemoveWhenMultipleChildWatchesOnAPath[0]\t55 ms\tPassed\ntestRemoveWhenMultipleChildWatchesOnAPath[1]\t50 ms\tPassed\ntestRemoveWhenMultipleDataWatchesOnAPath[0]\t58 ms\tPassed\ntestRemoveWhenMultipleDataWatchesOnAPath[1]\t51 ms\tPassed\n{code}\n\n+1 latest patch looks good to me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-04-29T17:45:37.654+0000","updated":"2015-04-29T17:45:37.654+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14527805","id":"14527805","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~cnauroth] for the contribution!\n\nCommitted to trunk : http://svn.apache.org/viewvc?view=revision&revision=1677724\nCommitted to br3.5 : http://svn.apache.org/viewvc?view=revision&revision=1677726","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-05-05T02:42:44.256+0000","updated":"2015-05-05T02:42:44.256+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14527873","id":"14527873","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"[~rakeshr], thank you for the helpful code review feedback and the commit!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-05T04:18:03.407+0000","updated":"2015-05-05T04:18:03.407+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12748168/comment/14528274","id":"14528274","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in ZooKeeper-trunk #2682 (See [https://builds.apache.org/job/ZooKeeper-trunk/2682/])\nZOOKEEPER-2062 RemoveWatchesTest takes forever to run (Chris Nauroth via rakeshr) (rakeshr: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1677724)\n* /zookeeper/trunk/CHANGES.txt\n* /zookeeper/trunk/src/java/test/org/apache/zookeeper/RemoveWatchesTest.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-05T11:19:54.986+0000","updated":"2015-05-05T11:19:54.986+0000"}],"maxResults":21,"total":21,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2062/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i216dr:"}}