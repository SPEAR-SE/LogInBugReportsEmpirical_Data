{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12987824","self":"https://issues.apache.org/jira/rest/api/2/issue/12987824","key":"ZOOKEEPER-2471","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-07-08T23:35:47.973+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Sep 07 16:25:03 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2471/watchers","watchCount":7,"isWatching":false},"created":"2016-07-08T15:52:07.361+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335444","id":"12335444","description":"Beta release against 3.5 branch","name":"3.5.3","archived":false,"released":true,"releaseDate":"2017-04-17"}],"issuelinks":[{"id":"12511383","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12511383","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"13093016","key":"ZOOKEEPER-2869","self":"https://issues.apache.org/jira/rest/api/2/issue/13093016","fields":{"summary":"Allow for exponential backoff in ClientCnxn.SendThread on connection re-establishment","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbenediktson","name":"dbenediktson","key":"dbenediktson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Benediktson","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-09-07T16:25:18.482+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/3","description":"This issue is being actively worked on at the moment by the assignee.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/inprogress.png","name":"In Progress","id":"3","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312381","id":"12312381","name":"java client","description":"The java client interface for ZooKeeper"}],"timeoriginalestimate":null,"description":"ClientCnxnSocket uses a member variable \"now\" to track the current time, and lastSend / lastHeard variables to track socket liveness. Implementations, and even ClientCnxn itself, are expected to call both updateNow() to reset \"now\" to System.currentTimeMillis, and then call updateLastSend()/updateLastHeard() on IO completions.\n\nThis is a fragile contract, so it's not surprising that there's a bug resulting from it: ClientCnxn.SendThread.run() calls updateLastSendAndHeard() as soon as startConnect() returns, but it does not call updateNow() first. I expect when this was written, either the expectation was that startConnect() was an asynchronous operation and that updateNow() would have been called very recently, or simply the requirement to call updateNow() was forgotten at this point. As far as I can see, this bug has been present since the \"updateNow\" method was first introduced in the distant past. As it turns out, since startConnect() calls HostProvider.next(), which can sleep, quite a lot of time can pass, leaving a big gap between \"now\" and now.\n\nIf you are using very short session timeouts (one of our ZK ensembles has many clients using a 1-second timeout), this is potentially disastrous, because the sleep time may exceed the connection timeout itself, which can potentially result in the Java client being stuck in a perpetual reconnect loop. The exact code path it goes through in this case is complicated, because there has to be a previously-closed socket still waiting in the selector (otherwise, the first timeout evaluation will not fail because \"now\" still hasn't been updated, and then the actual connect timeout will be applied in ClientCnxnSocket.doTransport()) so that select() will harvest the IO from the previous socket and updateNow(), resulting in the next loop through ClientCnxnSocket.SendThread.run() observing the spurious timeout and failing. In practice it does happen to us fairly frequently; we only got to the bottom of the bug yesterday. Worse, when it does happen, the Zookeeper client object is rendered unusable: it's stuck in a perpetual reconnect loop where it keeps sleeping, opening a socket, and immediately closing it.\n\nI have a patch. Rather than calling updateNow() right after startConnect(), my fix is to remove the \"now\" member variable and the updateNow() method entirely, and to instead just call System.currentTimeMillis() whenever time needs to be evaluated. I realize there is a benefit (aside from a trivial micro-optimization not worth worrying about) to having the time be \"fixed\", particularly for truth in the logging: if time is fixed by an updateNow() call, then the log for a timeout will still show exactly the same value the code reasoned about. However, this benefit is in my opinion not enough to merit the fragility of the contract which led to this (for us) highly impactful and difficult-to-find bug in the first place.\n\nI'm currently running ant tests locally against my patch on trunk, and then I'll upload it here.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12816961","id":"12816961","filename":"ZOOKEEPER-2471.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbenediktson","name":"dbenediktson","key":"dbenediktson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Benediktson","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-09T01:28:03.782+0000","size":7193,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12816961/ZOOKEEPER-2471.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Java Zookeeper Client incorrectly considers time spent sleeping as time spent connecting, potentially resulting in infinite reconnect loop","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbenediktson","name":"dbenediktson","key":"dbenediktson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Benediktson","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbenediktson","name":"dbenediktson","key":"dbenediktson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Benediktson","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"all","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/15368658","id":"15368658","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbenediktson","name":"dbenediktson","key":"dbenediktson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Benediktson","active":true,"timeZone":"America/Los_Angeles"},"body":"If anyone can assign this to me, I'll upload the patch I have.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbenediktson","name":"dbenediktson","key":"dbenediktson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Benediktson","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-08T23:10:57.520+0000","updated":"2016-07-08T23:10:57.520+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/15368721","id":"15368721","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shralex","name":"shralex","key":"shralex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Shraer","active":true,"timeZone":"America/Los_Angeles"},"body":"I added you to the list, you should be able to assign JIRAs to yourself now. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shralex","name":"shralex","key":"shralex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Shraer","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-08T23:35:47.973+0000","updated":"2016-07-08T23:35:47.973+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/15368870","id":"15368870","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12816961/ZOOKEEPER-2471.patch\n  against trunk revision 1750739.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3268//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3268//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3268//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-09T01:49:14.645+0000","updated":"2016-07-09T01:49:14.645+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/16120259","id":"16120259","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user DanBenediktson opened a pull request:\n\n    https://github.com/apache/zookeeper/pull/330\n\n    ZOOKEEPER-2471: ZK Java client should not count sleep time as connect time\n\n    ClientCnxnSocket uses a member variable \"now\" to track the current time, but does not update it at all potentially-blocking times: in particular, it does not update it after the random sleep introduced if an initial connect attempt fails. This results in the random sleep time being counted towards connect time, resulting in incorrect application of connection timeout currently, and if ZOOKEEPER-2869 is taken, a very real possibility (we have seen it in production) of wedging the Zookeeper client so that it can never successfully reconnect, because its sleep time may grow beyond its connection timeout, especially in scenarios where there is a big gap between negotiated session timeout and client-requested session timeout.\n    \n    Rather than fixing the bug by adding another \"updateNow()\" call, keeping the brittle \"updateNow()\" implementation which led to the bug in the first place, I have deleted updateNow() and replaced usage of that member variable with actually getting the current system timestamp whenever the implementation needs to know the current time.\n    \n    Regarding unit testing, this is, IMO, too difficult to test without introducing a lot of invasive changes to ClientCnxn.java, seeing as the only effective change is that, on connection retry, the random sleep time is no longer counted towards a time budget. I can throw a lot of mocks at this, like ClientReconnectTest, but I'm still going to be stuck depending on the behavior of that randomly-generated sleep time, which is going to be inherently unreliable. If a fix is taken for ZOOKEEPER-2869, this should become much easier to test, since I will then be able to inject a different backoff sleep behavior, and since I'm planning to submit a pull request for that ticket as well, so maybe as a compromise I can submit a test for this bug fix at that time?\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/DanBenediktson/zookeeper ZOOKEEPER-2471\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/330.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #330\n    \n----\ncommit 60f38726e7f07b4bb970cc8fb089363ff48eb3df\nAuthor: Dan Benediktson <dbenediktson@twitter.com>\nDate:   2017-08-09T16:41:42Z\n\n    ZOOKEEPER-2471: Zookeeper Java client should not count time spent sleeping as time spent connecting\n    \n    Rather than keep the brittle \"updateNow()\" implementation which led to the bug and fixing the bug by\n    adding another \"updateNow()\" call, I have deleted updateNow() and replaced usage of that member variable\n    with actually getting the current system timestamp.\n    \n    This is, IMO, too difficult to test without introducing a lot of invasive changes to ClientCnxn.java,\n    seeing as the only effective change is that, on connection retry, a random sleep time is no longer\n    counted towards a time budget. If a fix is taken for ZOOKEEPER-2869, this should become much easier to\n    test, and since I'm planning to submit a pull request for that ticket as well, maybe as a compromise\n    I can submit a test for this patch at that time?\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-09T17:05:06.757+0000","updated":"2017-08-09T17:05:06.757+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/16120297","id":"16120297","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +0 tests included.  The patch appears to be a documentation patch that doesn't require tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/929//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/929//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/929//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-09T17:20:32.843+0000","updated":"2017-08-09T17:20:32.843+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/16120331","id":"16120331","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbenediktson","name":"dbenediktson","key":"dbenediktson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Benediktson","active":true,"timeZone":"America/Los_Angeles"},"body":"Core tests that I see failed in the log both had already passed on my local run:\nChrootClientTest.testNonExistingOpCode\nWatchEventWhenAutoResetTest.testNodeDataChanged\n\nThe first one is clearly suspicious because my patch allegedly \"fixed\" the corresponding ClientTest.testNonExistingOpCode, which it shouldn't have done anything about, so I'm pretty certain that's just a flaky test.\n\nI've tried running both of those test cases about 10 times on my MBP to no avail; they pass every time. I also already ran the full \"ant test\" suite before submitting the patch in the first place, and it all succeeded.\n\nAny suggestions here?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbenediktson","name":"dbenediktson","key":"dbenediktson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Benediktson","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-09T17:39:56.787+0000","updated":"2017-08-09T17:39:56.787+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/16120376","id":"16120376","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"These are known flaky tests. See ZOOKEEPER-2786, ZOOKEEPER-2807. They usually pass when run in isolation, because the flaky behavior is only triggered under specific conditions - e.g. when server uses Netty instead of NIO, or when multiple tests implicitly share resources but they shouldn't. If you also use Jenkins, you can set up a Jenkins job to stress test entire unit tests - that is what I usually do before declaring a flaky test is fixed, aside from doing code reviews and local verifications.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2017-08-09T18:06:32.589+0000","updated":"2017-08-09T18:06:32.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/16120512","id":"16120512","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +0 tests included.  The patch appears to be a documentation patch that doesn't require tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/932//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/932//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/932//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-09T19:29:07.950+0000","updated":"2017-08-09T19:29:07.950+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/16133300","id":"16133300","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user nicktrav commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/330\n  \n    Feels a little awkward to have a non-trivial change without any tests :/\n    \n    > I'm still going to be stuck depending on the behavior of that randomly-generated sleep time, which is going to be inherently unreliable\n    \n    Thinking aloud here ... given your second commit updates to use the `Time` utility, could you now inject that class, (or perhaps a faked implementation given the methods are static), into `ClientCnxnSocket` and its subclasses? This would make it more amenable to testing. You'd have more control over the times that are returned.\n    \n    You'd still need to plumb that through into `ClientCnxn`, but it looks like the constructor takes a `ClientCnxnSocket`, which could work here?\n    \n    Maybe we can get that scaffolding wired up in another PR, get that merged in, and this change could leverage that?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-18T17:16:21.110+0000","updated":"2017-08-18T17:16:21.110+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/16133639","id":"16133639","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user hanm commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/330\n  \n    The `now` variable was there when this project starts, and `updateNow` was introduced in ZOOKEEPER-909 which was just a refactoring so it's irrelevant to the core logic. I had a chat with @phunt who wrote the original code and the `now` was not introduced by accident - according to Pat it's used to solve two problems:\n    * A performance optimization by caching as on some platforms getting current time is not cheap.\n    * On some platforms get current time will go backwards so to prevent that a cached time was used at the very start.\n    Now after 10 years and many changes (like using monotonic clock) the original design might become irrelevant, and it might make sense to instead calculate the now time when needed. Though, I'd like to have another look into this issue before making a conclusion.\n    \n    One idea is to have a test case that shows the bug (client infinity connect loop etc), and then verify that the bug gets fixed with the patch. This will be more convincing. I understand writing such test takes more effort than the patch itself, but eventually it's something must to have for such a change.\n    \n    On a side note - this patch is doing fine with my stress test and does not cause any regressions.\n    \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-18T21:23:58.798+0000","updated":"2017-08-18T21:23:58.798+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/16136328","id":"16136328","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user nicktrav commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/330\n  \n    @DanBenediktson - I've been looking into writing a test for this patch, but I can't seem to replicate the case you speak about on the original ticket.\n    \n    Specifically:\n    \n    > The exact code path it goes through in this case is complicated, because there has to be a previously-closed socket still waiting in the selector (otherwise, the first timeout evaluation will not fail because \"now\" still hasn't been updated, and then the actual connect timeout will be applied in ClientCnxnSocket.doTransport()) so that select() will harvest the IO from the previous socket and updateNow(), resulting in the next loop through ClientCnxnSocket.SendThread.run() observing the spurious timeout and failing.\n    \n    Are you able to provide some more details on how this client can get into this state? Walking through the code, I'm having difficulty understanding how the client can end up a reconnect loop.\n    \n    We are keen to see this patch land as it would make a fix for ZOOKEEPER-2869 inherently safer.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-22T05:40:09.609+0000","updated":"2017-08-22T05:40:09.609+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/16136834","id":"16136834","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbenediktson","name":"dbenediktson","key":"dbenediktson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Benediktson","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for the reviews, [~nickt] and [~hanm]. Sorry, I should have been more clear about the scenario: although I didn't realize it at the time I initially filed this bug (I wasn't aware of the extent of the divergence of my own fork from mainline), I don't think you can reasonably run into an infinite connect loop on *current* Apache Zookeeper. On the current code base, hitting an infinite connect loop basically requires falling victim to the random number generator repeatedly; not likely at all.\n\nHowever, if you pick up exponential backup from ZOOKEEPER-2869, it becomes a certainty if you hit the right conditions: basically, you just need to get enough initial failures to rack up a large exponential sleep backoff, which in practice happened to us during leader election on a large ensemble, and then your sleep time can potentially outgrow your connect timeout. That's somewhat dependent on the backoff algorithm used, but the one we have is pretty reasonable in how it caps the backoff, and it was certainly still possible there: we had applications which went down completely since they were unable to connect to ZK until we recycled the application every time we leader elected the ensemble they talked to, until we fixed this.\n\nSo, that's why I suggested in the pull request that maybe a compromise would be to submit tests along with ZOOKEEPER-2869: a lot of the machinery that's needed to make this testable is actually stuff that can be introduced as part of the product feature in ZOOKEEPER-2869.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbenediktson","name":"dbenediktson","key":"dbenediktson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Benediktson","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-22T14:05:00.415+0000","updated":"2017-08-22T14:05:00.415+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/16137090","id":"16137090","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickt","name":"nickt","key":"nickt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nick Travers","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for the response [~dbenediktson]. Re-reading your comments, I just can't seem to replicate the case you talk about where a client gets stuck in a reconnect loop.\n\nHere's how I'm testing this:\n- introduce an artificially high sleep time (say 5 seconds), replacing the random timeout in the client [here|https://github.com/apache/zookeeper/blob/release-3.5.3/src/java/main/org/apache/zookeeper/ClientCnxn.java#L1059], via what is essentially a crude patch for ZOOKEEPER-2869 \n- Set up an ensemble of 5 ZK servers\n- Set up a client with an artificially low connect timeout of 1 second, as you describe. Wait for an initial client connection to be established\n- Trigger a leader re-election by restarting the current leader\n- At this point, the client sleeps for the artificially long timeout for a few cycles through the loop, until the leader has been re-elected\n- Ultimately, the client is able to reconnect\n\nI'm not observing the infinite reconnect loop you describe.\n\nIn my mind it makes more sense to be able to observe this bug first before trying to patch it, and that seems to come up only _after_ introducing a fix for ZOOKEEPER-2869.\n\nWhat do you think about opening an additional PR for ZOOKEEPER-2869 so we can try to more easily reproduce the bug for ZOOKEEPER-2471? At that point the test scaffolding will be in place to make this task much easier.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickt","name":"nickt","key":"nickt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nick Travers","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-22T17:32:23.266+0000","updated":"2017-08-22T17:32:23.266+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/16155840","id":"16155840","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user nicktrav commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/330\n  \n    @DanBenediktson - bumping this. Any thoughts?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-06T18:28:43.359+0000","updated":"2017-09-06T18:28:43.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/16155862","id":"16155862","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbenediktson","name":"dbenediktson","key":"dbenediktson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Benediktson","active":true,"timeZone":"America/Los_Angeles"},"body":"Hey, sorry, I've been meaning to get back to this, but I wasn't expecting to sign up for porting the exponential backoff retry until this was in. Polishing that patch up so that it can be accepted in mainline will take me a fair bit more time, since our version of the code straight-up replaced the existing logic with jittered exponential backoff (we haven't run a JVM ZK client without jittered exponential backoff in > 1.5 years), and I doubt Apache ZK would be willing to accept that. I simply don't have time right now to do that work, and won't for at least a month. It also makes me a bit nervous to offer a pull request for the exponential backoff feature without this fix already checked in, since this was an extremely expensive bug for us, but I'm sympathetic to the desire to unit test it; we simply didn't have time to concoct a unit test back when we needed the fix urgently, since the nature of Zookeeper code makes it generally pretty difficult to add unit tests for most areas, including this one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbenediktson","name":"dbenediktson","key":"dbenediktson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Benediktson","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-09-06T18:39:36.164+0000","updated":"2017-09-06T18:39:36.164+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12987824/comment/16157176","id":"16157176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickt","name":"nickt","key":"nickt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nick Travers","active":true,"timeZone":"America/Los_Angeles"},"body":"We (Square) are less concerned with this bug, more so with the exponential backoff fix for ZOOKEEPER-2869. Given we've not been able to reproduce the infinite reconnect issue (on both mainline as well as 3.4.x with our patch applied), I more inclined to say that a merging a fix for ZOOKEEPER-2869 makes more sense right now. I think that would, at least, make reproducing the infinite reconnect issue easier in the future, as it provides a means to set up a client with an artificially high reconnect time.\n\nWe have a patch for ZOOKEEPER-2869 that we are running internally, with tests (\\!), that we'd be happy to offer up for review.\n\n[~hanm] - any thoughts on the best path forward here?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickt","name":"nickt","key":"nickt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nick Travers","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-09-07T16:25:03.538+0000","updated":"2017-09-07T16:25:18.462+0000"}],"maxResults":16,"total":16,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2471/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i30pkn:"}}