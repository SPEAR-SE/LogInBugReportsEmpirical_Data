{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13005710","self":"https://issues.apache.org/jira/rest/api/2/issue/13005710","key":"ZOOKEEPER-2591","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/10004","id":"10004","description":"Not A Bug","name":"Not A Bug"},"customfield_12312322":null,"customfield_12310220":"2017-06-29T10:43:33.409+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Jul 08 18:22:53 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_131127089_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2016-09-19T14:41:56.748+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2591/watchers","watchCount":6,"isWatching":false},"created":"2016-09-18T02:16:31.321+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-07-08T18:22:53.393+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12329414","id":"12329414","name":"security"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"Container nodes check the ACL before creation, but the deletion doesn't check  the ACL rights. The code below succeeds even tough we removed ACL access permissions for \"/a\".\n\n{code}\n        zk.create(\"/a\", null, Ids.OPEN_ACL_UNSAFE, CreateMode.CONTAINER);\n        ArrayList<ACL> list = new ArrayList<>();\n        list.add(new ACL(0, Ids.ANYONE_ID_UNSAFE));\n        zk.setACL(\"/\", list, -1);\n\n        zk.delete(\"/a\", -1);\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"The deletion of Container znode doesn't check ACL delete permission","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/15503671","id":"15503671","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"body":"{{OpCode.deleteContainer}} is asynchronously deleted by {{ContainerManager.checkContainers()}} and it doesn't need to check the ACL because it performs a garbage collection if the znode is empty. Therefore, a client delete operation is issued as a {{OpsCode.delete}} and handled as usual, including the ACL checking. The first example posted on this issue was also wrong in that delete does check the ACL rights of the parent nor the child.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"created":"2016-09-19T14:41:56.865+0000","updated":"2016-09-19T14:41:56.865+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16068154","id":"16068154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Bhupendra","name":"Bhupendra","key":"bhupendra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bhupendra Kumar Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"IMO, OpCode.deleteContainer request can be initiated from client even though there is no explicit API in Zookeeper.java. \nIn that case if ACL check is bypassed, node can be deleted by any user. So ACL check must be present if request is originated from client and ACL check can be skipped if request is system internal. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Bhupendra","name":"Bhupendra","key":"bhupendra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bhupendra Kumar Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-06-29T10:43:33.409+0000","updated":"2017-06-29T10:43:33.409+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16068397","id":"16068397","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randgalt","name":"randgalt","key":"randgalt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=randgalt&avatarId=16746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=randgalt&avatarId=16746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=randgalt&avatarId=16746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=randgalt&avatarId=16746"},"displayName":"Jordan Zimmerman","active":true,"timeZone":"America/Panama"},"body":"[~Bhupendra] If DeleteContainer had a client API then ACL would make sense. But, the automatic version has no client associated with the operation and therefore there is no ACL/Auth to apply.\n\nNote: you _can_ delete containers from the client via normal delete() command and the ACL is respected.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randgalt","name":"randgalt","key":"randgalt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=randgalt&avatarId=16746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=randgalt&avatarId=16746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=randgalt&avatarId=16746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=randgalt&avatarId=16746"},"displayName":"Jordan Zimmerman","active":true,"timeZone":"America/Panama"},"created":"2017-06-29T14:17:02.124+0000","updated":"2017-06-29T14:17:56.712+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16069679","id":"16069679","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Bhupendra","name":"Bhupendra","key":"bhupendra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bhupendra Kumar Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"I agree that DeleteContainer client API is not provided but what If a malicious user creates the DeleteContainer request by his own and sends to server ? do server have any check to safeguard against this ? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Bhupendra","name":"Bhupendra","key":"bhupendra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bhupendra Kumar Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-06-30T08:15:10.197+0000","updated":"2017-06-30T08:15:10.197+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16070201","id":"16070201","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randgalt","name":"randgalt","key":"randgalt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=randgalt&avatarId=16746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=randgalt&avatarId=16746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=randgalt&avatarId=16746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=randgalt&avatarId=16746"},"displayName":"Jordan Zimmerman","active":true,"timeZone":"America/Panama"},"body":"Yeah, I guess that could happen. IMO it isn't a big deal. ZooKeeper applications are expecting these nodes to disappear after a while. The server only deletes the node if it has no children. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randgalt","name":"randgalt","key":"randgalt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=randgalt&avatarId=16746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=randgalt&avatarId=16746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=randgalt&avatarId=16746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=randgalt&avatarId=16746"},"displayName":"Jordan Zimmerman","active":true,"timeZone":"America/Panama"},"created":"2017-06-30T14:37:01.190+0000","updated":"2017-06-30T14:37:01.190+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16071390","id":"16071390","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Bhupendra","name":"Bhupendra","key":"bhupendra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bhupendra Kumar Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"Right, But What if the malicious user deletes this node as soon as it gets created. In that case the applications which tries to create children inside this parent node, will fail. Its rare case but quite possible. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Bhupendra","name":"Bhupendra","key":"bhupendra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bhupendra Kumar Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-07-01T20:20:53.320+0000","updated":"2017-07-01T20:21:51.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16071397","id":"16071397","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randgalt","name":"randgalt","key":"randgalt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=randgalt&avatarId=16746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=randgalt&avatarId=16746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=randgalt&avatarId=16746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=randgalt&avatarId=16746"},"displayName":"Jordan Zimmerman","active":true,"timeZone":"America/Panama"},"body":"That's an extreme edge case but it is possible. We can prevent that by enforcing the container check of \"node.stat.getCversion() > 0\" - that would be a lot easier than adding an ACL check in PrepRequestProcessor's handling of OpCode.deleteContainer","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randgalt","name":"randgalt","key":"randgalt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=randgalt&avatarId=16746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=randgalt&avatarId=16746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=randgalt&avatarId=16746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=randgalt&avatarId=16746"},"displayName":"Jordan Zimmerman","active":true,"timeZone":"America/Panama"},"created":"2017-07-01T20:52:56.551+0000","updated":"2017-07-01T20:52:56.551+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16072530","id":"16072530","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"body":"[~randgalt], another edge case would be the following: a client create a container znode and populate it with children znodes. This client is the only in charge of deleting the children. Another clients should only be able to read the children znode contents, but a misbehaved client can delete children znodes in the container znode. With ACL properly set this other clients would not be able to delete the children of the master client. Does it make sense?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"created":"2017-07-03T14:37:54.354+0000","updated":"2017-07-03T14:37:54.354+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16072539","id":"16072539","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randgalt","name":"randgalt","key":"randgalt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=randgalt&avatarId=16746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=randgalt&avatarId=16746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=randgalt&avatarId=16746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=randgalt&avatarId=16746"},"displayName":"Jordan Zimmerman","active":true,"timeZone":"America/Panama"},"body":"[~eribeiro] - I don't follow. The container node is created with an ACL. It uses the same create() method as normal node creation. A rogue client cannot delete child nodes without proper Auth.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randgalt","name":"randgalt","key":"randgalt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=randgalt&avatarId=16746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=randgalt&avatarId=16746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=randgalt&avatarId=16746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=randgalt&avatarId=16746"},"displayName":"Jordan Zimmerman","active":true,"timeZone":"America/Panama"},"created":"2017-07-03T14:41:09.510+0000","updated":"2017-07-03T14:41:09.510+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16072579","id":"16072579","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"body":"[~randgalt], oops, excuse me! I didn't look at this issue nor this part of the code since the issue was closed. My misunderstanding was because this line:\n\nhttps://github.com/apache/zookeeper/blob/a0eba7abd002498631da8d8127261c297c911590/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java#L402\n\nwas not present in this block:\n\nhttps://github.com/apache/zookeeper/blob/a0eba7abd002498631da8d8127261c297c911590/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java#L375-L392\n\n*So, even though the creation follows the same path, the container deletion has a different one.*\n\nBut I totally agree with you that this issue can not be worth working on, or could use something different from adding a checkACL. :)\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"created":"2017-07-03T14:59:57.788+0000","updated":"2017-07-03T15:11:15.905+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16072606","id":"16072606","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randgalt","name":"randgalt","key":"randgalt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=randgalt&avatarId=16746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=randgalt&avatarId=16746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=randgalt&avatarId=16746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=randgalt&avatarId=16746"},"displayName":"Jordan Zimmerman","active":true,"timeZone":"America/Panama"},"body":"container deletion, itself, is different yes. But, my point is that ZooKeeper clients expect containers to disappear so there's no real security risk. The only edge case I can see is a rogue client quickly deleting a container. We can fix that edge case by applying the logic as I describe above.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randgalt","name":"randgalt","key":"randgalt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=randgalt&avatarId=16746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=randgalt&avatarId=16746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=randgalt&avatarId=16746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=randgalt&avatarId=16746"},"displayName":"Jordan Zimmerman","active":true,"timeZone":"America/Panama"},"created":"2017-07-03T15:12:27.148+0000","updated":"2017-07-03T15:12:35.512+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16072626","id":"16072626","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"body":"Cool, got it. It is the only edge case previously described and your solution is nice. Excuse me for disturbing the talk with a spurious example.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"created":"2017-07-03T15:22:50.202+0000","updated":"2017-07-03T15:22:50.202+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16073119","id":"16073119","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arshad.mohammad","name":"arshad.mohammad","key":"arshad.mohammad","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Mohammad Arshad","active":true,"timeZone":"Asia/Singapore"},"body":"Adding  \"node.stat.getCversion() > 0\" check makes sense to me. anybody submitting patch? I will review it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arshad.mohammad","name":"arshad.mohammad","key":"arshad.mohammad","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Mohammad Arshad","active":true,"timeZone":"Asia/Singapore"},"created":"2017-07-04T05:30:00.902+0000","updated":"2017-07-04T05:30:00.902+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16073224","id":"16073224","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Bhupendra","name":"Bhupendra","key":"bhupendra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bhupendra Kumar Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"About solution to have a check node.stat.getCversion() > 0 , I have one doubt . Lets consider a scenario as below \n\n1. create container node \n2. create child1\n3. delete child1\n   cVersion = 1 , child count = 0\n\n4. create child2\n5. delete child2\n6. cVersion = 2, child count = 0\n7. Timer triggers and deletes container node \n\nWhat if malicious user deletes the container node after step 3. I agree that after step 3 even if system timer runs it will delete the container node too ... But then why allow malicious user to delete at all ... \n\nIn my opinion we can have a internal Boolean in Request object which marked as true by ContainerManager and false for all other cases. We can skip the ACL check only if Boolean if true. Does it make sense ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Bhupendra","name":"Bhupendra","key":"bhupendra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bhupendra Kumar Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-07-04T07:20:40.503+0000","updated":"2017-07-04T07:20:40.503+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16077831","id":"16077831","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Bhupendra","name":"Bhupendra","key":"bhupendra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bhupendra Kumar Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"Guys, Any thoughts on this ... ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Bhupendra","name":"Bhupendra","key":"bhupendra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bhupendra Kumar Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-07-07T08:55:33.273+0000","updated":"2017-07-07T08:55:33.273+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16078251","id":"16078251","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randgalt","name":"randgalt","key":"randgalt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=randgalt&avatarId=16746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=randgalt&avatarId=16746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=randgalt&avatarId=16746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=randgalt&avatarId=16746"},"displayName":"Jordan Zimmerman","active":true,"timeZone":"America/Panama"},"body":"[~Bhupendra] - I don't understand how that would work. Any field that ContainerManager adds to the Request object could also be added by a rogue client. Can you give an example of how this would work?\n\nAnother possibility is to somehow disallow OpCode.deleteContainer coming from a connected client.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randgalt","name":"randgalt","key":"randgalt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=randgalt&avatarId=16746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=randgalt&avatarId=16746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=randgalt&avatarId=16746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=randgalt&avatarId=16746"},"displayName":"Jordan Zimmerman","active":true,"timeZone":"America/Panama"},"created":"2017-07-07T15:35:53.517+0000","updated":"2017-07-07T15:40:56.850+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16079260","id":"16079260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Bhupendra","name":"Bhupendra","key":"bhupendra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bhupendra Kumar Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"As I understand, Request object  (org.apache.zookeeper.server.Request) is created in server side only.  Idea was to have boolean to indicate the type of request like system internal request or client request.  Since this boolean will be set only by server so client can not control this. We can also do this by some other way like extend Request to create DeleteContainerRequest and check the request oject instance type in prepRequestProcessor and then skip the ACL for system generated request.\n\n{quote}\nAnother possibility is to somehow disallow OpCode.deleteContainer coming from a connected client.\n{quote}\n\nI agree your idea  to disallow deleteContainer request from client completely. That way there is no need to add ACL check . I think we can check this in processPacket() method before submitting the request to request Processor.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Bhupendra","name":"Bhupendra","key":"bhupendra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bhupendra Kumar Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-07-08T18:12:34.020+0000","updated":"2017-07-08T18:13:45.500+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13005710/comment/16079263","id":"16079263","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randgalt","name":"randgalt","key":"randgalt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=randgalt&avatarId=16746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=randgalt&avatarId=16746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=randgalt&avatarId=16746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=randgalt&avatarId=16746"},"displayName":"Jordan Zimmerman","active":true,"timeZone":"America/Panama"},"body":"I think preventing deleteContainer from clients is the best bet. We could even have a class of opcodes that are marked \"internal only\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=randgalt","name":"randgalt","key":"randgalt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=randgalt&avatarId=16746","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=randgalt&avatarId=16746","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=randgalt&avatarId=16746","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=randgalt&avatarId=16746"},"displayName":"Jordan Zimmerman","active":true,"timeZone":"America/Panama"},"created":"2017-07-08T18:22:53.393+0000","updated":"2017-07-08T18:22:53.393+0000"}],"maxResults":18,"total":18,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2591/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i33ref:"}}