{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12948074","self":"https://issues.apache.org/jira/rest/api/2/issue/12948074","key":"ZOOKEEPER-2383","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12338036","id":"12338036","description":"Fix release against 3.4 branch","name":"3.4.10","archived":false,"released":true,"releaseDate":"2017-03-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335444","id":"12335444","description":"Beta release against 3.5 branch","name":"3.5.3","archived":false,"released":true,"releaseDate":"2017-04-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326518","id":"12326518","name":"3.6.0","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2016-03-08T17:38:41.980+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jan 23 04:03:38 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_3_*:*_17952202349_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_2_*:*_8057443372","customfield_12312321":null,"resolutiondate":"2017-01-03T17:54:19.921+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2383/watchers","watchCount":16,"isWatching":false},"created":"2016-03-08T17:00:14.423+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"9.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326517","id":"12326517","description":"Fix release against 3.4 branch","name":"3.4.8","archived":false,"released":true,"releaseDate":"2016-02-22"}],"issuelinks":[{"id":"12459684","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12459684","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12941580","key":"SOLR-8724","self":"https://issues.apache.org/jira/rest/api/2/issue/12941580","fields":{"summary":"Upgrade Zookeeper to 3.4.8","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12489712","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12489712","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"13030203","key":"ZOOKEEPER-2655","self":"https://issues.apache.org/jira/rest/api/2/issue/13030203","fields":{"summary":"Improve NIOServerCnxn#isZKServerRunning to reflect the semantics correctly","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}},{"id":"12494542","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12494542","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13042404","key":"ARIES-1684","self":"https://issues.apache.org/jira/rest/api/2/issue/13042404","fields":{"summary":"Upgrade ZooKeeper to 3.4.10","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}},{"id":"12476881","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12476881","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12995073","key":"SOLR-9386","self":"https://issues.apache.org/jira/rest/api/2/issue/12995073","fields":{"summary":"Upgrade Zookeeper to 3.4.10","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21148&avatarType=issuetype","name":"Task","subtask":false,"avatarId":21148}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-03-31T09:01:14.880+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312451","id":"12312451","name":"jmx","description":"JMX Support"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"In attempting to upgrade Solr's ZooKeeper dependency from 3.4.6 to 3.4.8 (SOLR-8724) I ran into test failures where attempts to create a node in a newly started standalone ZooKeeperServer were failing because of an assertion in MBeanRegistry.\n\nZooKeeperServer.startup() first sets up its request processor chain then registers itself in JMX, but if a connection comes in before the server's JMX registration happens, registration of the connection will fail because it trips the assertion that (effectively) its parent (the server) has already registered itself.\n\n{code:java|title=ZooKeeperServer.java}\n    public synchronized void startup() {\n        if (sessionTracker == null) {\n            createSessionTracker();\n        }\n        startSessionTracker();\n        setupRequestProcessors();\n\n        registerJMX();\n\n        state = State.RUNNING;\n        notifyAll();\n    }\n{code}\n\n{code:java|title=MBeanRegistry.java}\n    public void register(ZKMBeanInfo bean, ZKMBeanInfo parent)\n        throws JMException\n    {\n        assert bean != null;\n        String path = null;\n        if (parent != null) {\n            path = mapBean2Path.get(parent);\n            assert path != null;\n        }\n{code}\n\nThis problem appears to be new with ZK 3.4.8 - AFAIK Solr never had this issue with ZK 3.4.6. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12792038","id":"12792038","filename":"release-3.4.8-extra-logging.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"created":"2016-03-08T17:24:00.018+0000","size":2824,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12792038/release-3.4.8-extra-logging.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12792036","id":"12792036","filename":"TestZkStandaloneJMXRegistrationRaceConcurrent.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"created":"2016-03-08T17:24:00.008+0000","size":2081,"mimeType":"text/x-java-source","content":"https://issues.apache.org/jira/secure/attachment/12792036/TestZkStandaloneJMXRegistrationRaceConcurrent.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12792037","id":"12792037","filename":"zk-3.4.8-MBeanRegistry.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"created":"2016-03-08T17:24:00.015+0000","size":10183,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12792037/zk-3.4.8-MBeanRegistry.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12792040","id":"12792040","filename":"zk-3.4.8-NPE.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"created":"2016-03-08T17:27:42.795+0000","size":12467,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12792040/zk-3.4.8-NPE.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12837652","id":"12837652","filename":"ZOOKEEPER-2383.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-11-06T16:44:03.563+0000","size":22078,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12837652/ZOOKEEPER-2383.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12822349","id":"12822349","filename":"ZOOKEEPER-2383.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-08-05T18:08:43.431+0000","size":15441,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12822349/ZOOKEEPER-2383.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12822237","id":"12822237","filename":"ZOOKEEPER-2383.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-08-05T05:34:09.119+0000","size":14827,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12822237/ZOOKEEPER-2383.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12819926","id":"12819926","filename":"ZOOKEEPER-2383.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-25T13:21:23.619+0000","size":14762,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12819926/ZOOKEEPER-2383.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12821043","id":"12821043","filename":"ZOOKEEPER-2383-br-3-4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-29T18:04:26.486+0000","size":14052,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12821043/ZOOKEEPER-2383-br-3-4.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Startup race in ZooKeeperServer","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15185285","id":"15185285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"body":"This program triggers the problem for me roughly 10% of the time with ZK 3.4.8 - note that if I don't use a thread to start ZooKeeperServer, the connection always comes in after the server has had a chance to register itself with JMX (imports omitted - attaching full file here in a sec): \n\n{code:java|title=TestZkStandaloneJMXRegistrationRaceConcurrent.java}\npublic class TestZkStandaloneJMXRegistrationRaceConcurrent {\n  public static void main(String[] args) throws IOException, InterruptedException, KeeperException {\n    class ServerThread extends Thread {\n      private ZooKeeperServer server;\n      private ServerCnxnFactory cnxnFactory;\n      @Override public void run() {\n        try {\n          File tempDir = Files.createTempDirectory(FileSystems.getDefault().getPath(\".\"),\"test\").toFile();\n          FileTxnSnapLog txnSnapLog = new FileTxnSnapLog(tempDir, tempDir);\n          server = new ZooKeeperServer\n            (txnSnapLog, 2000, 2000, 4000, null, new ZKDatabase(txnSnapLog));\n          cnxnFactory = ServerCnxnFactory.createFactory(55555, -1);\n          cnxnFactory.startup(server);\n        } catch (IOException e) {\n          throw new RuntimeException(e);\n        } catch (InterruptedException e) { \n          Thread.currentThread().interrupt();\n        }\n      }\n      public void shutdown() throws IOException, InterruptedException {\n        cnxnFactory.shutdown();\n        cnxnFactory.join();\n        server.shutdown();\n      }\n    }\n    ServerThread serverThread = new ServerThread();\n    serverThread.setDaemon(true);\n    serverThread.start();\n    Thread.sleep(3);\n    ZooKeeper zk = new ZooKeeper(\"127.0.0.1:55555\", 45000, new Watcher() {\n        public void process(WatchedEvent event) {} });\n    zk.create(\"/testing123\", new byte[]{}, Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL);\n    serverThread.shutdown();\n    serverThread.join();\n  }\n}\n{code}\n\nHere's an excerpt from a log exhibiting the failure - I'll also attach the full log (I've added some logging to ZK 3.4.8 - I'll attach a patch showing those additions here in a minute):\n\n{noformat}\n2016-03-08 11:32:08,414 [myid:] - WARN  [SyncThread:0:MBeanRegistry@100] - bean 'Connections/127.0.0.1/0x153571244a70000' with parent 'StandaloneServer_port55555' has null path.\njava.lang.Throwable: \n\tat org.apache.zookeeper.jmx.MBeanRegistry.register(MBeanRegistry.java:98)\n\tat org.apache.zookeeper.server.ServerCnxnFactory.registerConnection(ServerCnxnFactory.java:147)\n\tat org.apache.zookeeper.server.ZooKeeperServer.finishSessionInit(ZooKeeperServer.java:613)\n\tat org.apache.zookeeper.server.FinalRequestProcessor.processRequest(FinalRequestProcessor.java:181)\n\tat org.apache.zookeeper.server.SyncRequestProcessor.flush(SyncRequestProcessor.java:200)\n\tat org.apache.zookeeper.server.SyncRequestProcessor.run(SyncRequestProcessor.java:131)\n2016-03-08 11:32:08,414 [myid:] - WARN  [Thread-0:MBeanRegistry@118] - registered bean 'StandaloneServer_port55555' with parent 'null' at path '/'\njava.lang.Throwable: \n\tat org.apache.zookeeper.jmx.MBeanRegistry.register(MBeanRegistry.java:116)\n\tat org.apache.zookeeper.server.ZooKeeperServer.registerJMX(ZooKeeperServer.java:385)\n\tat org.apache.zookeeper.server.ZooKeeperServer.startup(ZooKeeperServer.java:418)\n\tat org.apache.zookeeper.server.NIOServerCnxnFactory.startup(NIOServerCnxnFactory.java:119)\n\tat TestZkStandaloneJMXRegistrationRaceConcurrent$1ServerThread.run(TestZkStandaloneJMXRegistrationRaceConcurrent.java:29)\n2016-03-08 11:32:08,415 [myid:] - ERROR [SyncThread:0:ZooKeeperCriticalThread@49] - Severe unrecoverable error, from thread : SyncThread:0\njava.lang.AssertionError\n\tat org.apache.zookeeper.jmx.MBeanRegistry.register(MBeanRegistry.java:104)\n\tat org.apache.zookeeper.server.ServerCnxnFactory.registerConnection(ServerCnxnFactory.java:147)\n\tat org.apache.zookeeper.server.ZooKeeperServer.finishSessionInit(ZooKeeperServer.java:613)\n\tat org.apache.zookeeper.server.FinalRequestProcessor.processRequest(FinalRequestProcessor.java:181)\n\tat org.apache.zookeeper.server.SyncRequestProcessor.flush(SyncRequestProcessor.java:200)\n\tat org.apache.zookeeper.server.SyncRequestProcessor.run(SyncRequestProcessor.java:131)\n2016-03-08 11:32:08,416 [myid:] - WARN  [Thread-0:MBeanRegistry@118] - registered bean 'InMemoryDataTree' with parent 'StandaloneServer_port55555' at path '/StandaloneServer_port55555'\njava.lang.Throwable: \n\tat org.apache.zookeeper.jmx.MBeanRegistry.register(MBeanRegistry.java:116)\n\tat org.apache.zookeeper.server.ZooKeeperServer.registerJMX(ZooKeeperServer.java:389)\n\tat org.apache.zookeeper.server.ZooKeeperServer.startup(ZooKeeperServer.java:418)\n\tat org.apache.zookeeper.server.NIOServerCnxnFactory.startup(NIOServerCnxnFactory.java:119)\n\tat TestZkStandaloneJMXRegistrationRaceConcurrent$1ServerThread.run(TestZkStandaloneJMXRegistrationRaceConcurrent.java:29)\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"created":"2016-03-08T17:17:11.659+0000","updated":"2016-03-08T17:17:11.659+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15185299","id":"15185299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"body":"Attaching files:\n\nTest case: TestZkStandaloneJMXRegistrationRaceConcurrent.java\nZK 3.4.8 source patch to add JXM logging: release-3.4.8-extra-logging.patch\nLog file exhibiting failure: zk-3.4.8-MBeanRegistry.log\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"created":"2016-03-08T17:24:00.021+0000","updated":"2016-03-08T17:24:00.021+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15185305","id":"15185305","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"body":"Sometimes the attached test case will trigger a NullPointerException in ZooKeeperServer.createSession() - see attached zk-3.4.8-NPE.log.  For some reason I never saw this failure mode in Solr tests using ZK 3.4.8.\n\n{noformat}\n2016-03-08 11:29:00,374 [myid:] - WARN  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:55555:NIOServerCnxnFactory@213] - Ignoring unexpected runtime e\nxception\njava.lang.NullPointerException\n        at org.apache.zookeeper.server.ZooKeeperServer.createSession(ZooKeeperServer.java:569)\n        at org.apache.zookeeper.server.ZooKeeperServer.processConnectRequest(ZooKeeperServer.java:902)\n        at org.apache.zookeeper.server.NIOServerCnxn.readConnectRequest(NIOServerCnxn.java:418)\n        at org.apache.zookeeper.server.NIOServerCnxn.readPayload(NIOServerCnxn.java:198)\n        at org.apache.zookeeper.server.NIOServerCnxn.doIO(NIOServerCnxn.java:244)\n        at org.apache.zookeeper.server.NIOServerCnxnFactory.run(NIOServerCnxnFactory.java:203)\n        at java.lang.Thread.run(Thread.java:745)\n{noformat} ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"created":"2016-03-08T17:27:42.798+0000","updated":"2016-03-08T17:27:42.798+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15185323","id":"15185323","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"[~steve_rowe] Thanks for reporting this issue. According to git blame, the latest changes around the startup method in ZooKeeperServer are due to ZOOKEEPER-1907, which actually turned out to be quite problematic, so this could be another issue due to that patch, I'm not sure.\n\n{noformat}\n91f579e4 src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java     (Hongchao Deng          2015-08-17 20:52:07 +0000  411)     public synchronized void startup() {\n55b03fce src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java     (Mahadev Konar          2012-01-31 06:50:06 +0000  412)         if (sessionTracker == null) {\n55b03fce src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java     (Mahadev Konar          2012-01-31 06:50:06 +0000  413)             createSessionTracker();\n55b03fce src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java     (Mahadev Konar          2012-01-31 06:50:06 +0000  414)         }\n55b03fce src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java     (Mahadev Konar          2012-01-31 06:50:06 +0000  415)         startSessionTracker();\n097b7979 zookeeper/java/src/com/yahoo/zookeeper/server/ZooKeeperServer.java (Benjamin Reed          2008-05-12 23:01:25 +0000  416)         setupRequestProcessors();\n87e1e030 src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java     (Patrick D. Hunt        2009-01-15 22:57:14 +0000  417) \n87e1e030 src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java     (Patrick D. Hunt        2009-01-15 22:57:14 +0000  418)         registerJMX();\n87e1e030 src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java     (Patrick D. Hunt        2009-01-15 22:57:14 +0000  419) \n91f579e4 src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java     (Hongchao Deng          2015-08-17 20:52:07 +0000  420)         state = State.RUNNING;\n91f579e4 src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java     (Hongchao Deng          2015-08-17 20:52:07 +0000  421)         notifyAll();\n097b7979 zookeeper/java/src/com/yahoo/zookeeper/server/ZooKeeperServer.java (Benjamin Reed          2008-05-12 23:01:25 +0000  422)     }\n\n{noformat}\n\n{noformat}\ncommit 91f579e40755de870ed9123c8fd55925517d9aa6\nAuthor: Hongchao Deng <hdeng@apache.org>\nDate:   Mon Aug 17 20:52:07 2015 +0000\n\n    ZOOKEEPER-1907 Improve Thread handling (Rakesh R via hdeng)\n    \n    git-svn-id: https://svn.apache.org/repos/asf/zookeeper/branches/branch-3.4@1696337 13f79535-47bb-0310-9956-ffa450edef68\n{noformat}\n\n[~rakesh_r] could you have a look, please?\n\nCC [~rgs] [~phunt]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-03-08T17:38:41.980+0000","updated":"2016-03-08T17:39:07.198+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15185412","id":"15185412","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"body":"FWIW, I was able to work around the problem in Solr tests by subclassing ZooKeeperServer and ordering server JMX registration before setting up its request processing pipeline, like so:\n\n{code:java}\n private class TestZooKeeperServer extends ZooKeeperServer {\n    @Override protected void registerJMX() {\n      // no-op - super.registerJMX() is called in overridden startup()\n    }\n    /** Register in JMX before starting the request processors. */\n    @Override public void startup() {\n      super.registerJMX();\n      super.startup();\n    }\n    public TestZooKeeperServer(FileTxnSnapLog txnLogFactory, int tickTime,\n                               int minSessionTimeout, int maxSessionTimeout,\n                               DataTreeBuilder treeBuilder, ZKDatabase zkDb) {\n      super(txnLogFactory, tickTime, minSessionTimeout, maxSessionTimeout, treeBuilder, zkDb);\n    }\n  }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"created":"2016-03-08T18:19:58.232+0000","updated":"2016-03-08T18:19:58.232+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15185740","id":"15185740","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"body":"Similarly to the subclassed ZooKeeperServer above, if I apply the following patch to ZK 3.4.8 and run the attached test case with it, the JMX registration race no longer happens:\n\n{code:java}\nIndex: src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java\n===================================================================\n--- src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java\t(revision 1732157)\n+++ src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java\t(working copy)\n@@ -413,10 +413,9 @@\n             createSessionTracker();\n         }\n         startSessionTracker();\n+        registerJMX();\n         setupRequestProcessors();\n \n-        registerJMX();\n-\n         state = State.RUNNING;\n         notifyAll();\n     }\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"created":"2016-03-08T20:37:00.355+0000","updated":"2016-03-08T20:37:00.355+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15186556","id":"15186556","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~steve_rowe] for reporting this issue and good analysis.\n\nbq. According to git blame, the latest changes around the startup method in ZooKeeperServer are due to ZOOKEEPER-1907, which actually turned out to be quite problematic, so this could be another issue due to that patch, I'm not sure.\n\n[~fpj], sure I'm happy to investigate this. To understand the impact of ZOOKEEPER-1907, first I took the code before ZOOKEEPER-1907 commit version {{da3e7e0d4b66ac5a25d40ae2d0102b1b57994b62}}. I've debugged the code and able to re-produce the issue even without ZOOKEEPER-1907 changes.\n\nComing back to the issues reported in this jira, there are two issues. IIUC, both the cases are due to the race between server startup and processing a client connection request. I've tried an attempt to figure it out, please see the below sequence that creating the trouble.\n# NullPointerException while creating session\n{code}\n2016-03-08 11:29:00,374 [myid:] - WARN  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:55555:NIOServerCnxnFactory@213] - Ignoring unexpected runtime exception\njava.lang.NullPointerException\n\tat org.apache.zookeeper.server.ZooKeeperServer.createSession(ZooKeeperServer.java:569)\n{code}\n+Thread-1: Starting the server+\n1=> Invoked cnxnFactory.startup(server);\n2=> Started NIOServerCxn.Factory thread and register OP_ACCEPT to accept connections\n3=> sets zookeeper server to the connection factory\n4=> loads zookeeper data\n5=> Assume server is about to invoke {{zks.startup();}} and {{sessionTracker}} is not yet initialized.\n+Thread-2: creating client connection+\n1=> sends connection request to the server\n2=> NIOServerCnxn reads the request and invokes {{NIOServerCnxn#readConnectRequest()}}\n3=> It then calls {{zkServer.processConnectRequest(this, incomingBuffer);}}\n4=> While processing the request it needs {{sessionTracker}} reference, but this is not yet initialized and the server is still in the startup phase causing the NPE error.\n# MBeanRegistry throws assertion error due to parent doesn't exists\n{code}\n2016-03-08 11:29:00,449 [myid:] - WARN  [Thread-0:MBeanRegistry@118] - registered bean 'InMemoryDataTree' with parent 'StandaloneServer_port55555' at path '/StandaloneServer_port55555'\njava.lang.Throwable: \n\tat org.apache.zookeeper.jmx.MBeanRegistry.register(MBeanRegistry.java:116)\n{code}\n+Thread-1: Starting the server+\n1=> Invoked cnxnFactory.startup(server);\n2=> Started NIOServerCxn.Factory thread and register OP_ACCEPT to accept connections\n3=> sets zookeeper server to the connection factory\n4=> loads zookeeper data\n5=> Server invoked {{zks.startup();}}\n6=> Started session tracker\n7=> Finished settingup RequestProcessors\n8=> Invoked {{ZooKeeperServer#registerJMX();}}\n9=> Now assume ZooKeeperServer has initialized {{jmxServerBean = new ZooKeeperServerBean(this);}} and about to register the bean in the registry {{MBeanRegistry.getInstance().register(jmxServerBean, null);}}\n+Thread-2: creating client connection+\n1=> sends connection request to the server\n2=> NIOServerCnxn reads the request and invokes {{NIOServerCnxn#readConnectRequest()}}\n3=> It then calls {{zkServer.processConnectRequest(this, incomingBuffer);}}\n4=> Since all the request processors are ready, it successfully creates the session and goes to register the connection bean\n5=> Now, it will invoke {{zkServer.finishSessionInit()}}. Here it invokes {{serverCnxnFactory.registerConnection(cnxn);}} and hitting the path error.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-03-09T05:38:52.639+0000","updated":"2016-03-09T05:38:52.639+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15189157","id":"15189157","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"I think I found the code changes which results in this bug. Its due to the change in startup sequence - ZOOKEEPER-2026.\n\nHere it just moved up setting 'zkServer' reference before starting up the standalone server fully. Internally, this 'zkServer' reference is used to see ZooKeeperServer's running status. In the defect scenario, the standalone server is partially started(by Thread1) and simultaneously client(by Thread2) send a connection request. Since the 'zkServer' is not null it proceeds to process the connection request and causing the trouble. Please refer my previous comment to understand the problematic call sequence.\n\n{code}\nZooKeeperServer.java\n\n    private void readConnectRequest() throws IOException, InterruptedException {\n        if (zkServer == null) {\n            throw new IOException(\"ZooKeeperServer not running\");\n        }\n        zkServer.processConnectRequest(this, incomingBuffer);\n        initialized = true;\n    }\n{code}\n\nProbably should use server RUNNING state instead of \"zkServer == null\" checks to know the running status. Server is updating the state to RUNNING after starting all the services.\n{code}\nZooKeeperServer.java\n\n    public synchronized void startup() {\n        if (sessionTracker == null) {\n            createSessionTracker();\n        }\n        startSessionTracker();\n        setupRequestProcessors();\n\n        registerJMX();\n\n        state = State.RUNNING;\n        notifyAll();\n    }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-03-10T11:23:25.447+0000","updated":"2016-03-10T11:23:25.447+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15198781","id":"15198781","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbrosenberg%40gmail.com","name":"jbrosenberg@gmail.com","key":"jbrosenberg@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Rosenberg","active":true,"timeZone":"America/New_York"},"body":"I've run into similar issues, with the register call causing an AssertionError, which is not caught anywhere, which results in test failures (especially if you have multiple QuorumPeers running in the same jvm during tests).  JMX registration gets confused if you have individual nodes starting and stopping.   (Asserts are only enabled for us during testing/ci, so it doesn't affect production).\nI worked around it be calling {code}MBeanRegistry.setInstance(new FakeMBeanRegistry()){code}.  Where {code}FakeMBeanRegistry{code} looks like:\n\n{code}\n  public static class FakeMBeanRegistry extends MBeanRegistry {\n    @Override public void register(ZKMBeanInfo bean, ZKMBeanInfo parent) throws JMException {}\n    @Override public void unregister(ZKMBeanInfo bean) {}\n    @Override public void unregisterAll() {}\n  }\n{code}\n\nMaybe there should be a flag to disable all JMX registrations (e.g. for most tests), and it could be handled with something like this fake class.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbrosenberg%40gmail.com","name":"jbrosenberg@gmail.com","key":"jbrosenberg@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Rosenberg","active":true,"timeZone":"America/New_York"},"created":"2016-03-17T05:39:19.936+0000","updated":"2016-03-17T05:39:19.936+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15206169","id":"15206169","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~jbrosenberg@gmail.com]. Disbaling or mocking may affect the {{org.apache.zookeeper.testJMXEnv#ensureAll(expectednames)}} verification, isn't it?. In unit tests, it verifies all the registered jmx beans to ensure that the server is started fully.\n\n[~fpj], I have one idea to fix this issue by modifying the condition {{zkServer == null}} with {{zkServer.isRunning()}} status check. After seeing the code changes, I feel to push this logic carefully after 3.5.2 release, which is waiting to be released soon. Also, I think needs to identify and add more unit test cases covering server startup/shutdown/restart corner cases in order to push this change. Now, I'm planning to revert ZOOKEEPER-2026 committed changes and re-open the jira. Does this makes sense to you?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-03-22T11:02:46.194+0000","updated":"2016-03-22T11:02:46.194+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15206310","id":"15206310","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbrosenberg%40gmail.com","name":"jbrosenberg@gmail.com","key":"jbrosenberg@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Rosenberg","active":true,"timeZone":"America/New_York"},"body":"Yes, agreed, you wouldn't use a FakeMBeanRegistry for tests that are actually testing the jmx functionality!\nHowever, I think it makes sense to have it be something easily configurable/settable for most tests (and especially for tests which launch multiple peers in the same jvm).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbrosenberg%40gmail.com","name":"jbrosenberg@gmail.com","key":"jbrosenberg@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Rosenberg","active":true,"timeZone":"America/New_York"},"created":"2016-03-22T13:05:46.536+0000","updated":"2016-03-22T13:05:46.536+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15391420","id":"15391420","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ozawa","name":"ozawa","key":"ozawa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ozawa&avatarId=21740","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ozawa&avatarId=21740","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ozawa&avatarId=21740","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ozawa&avatarId=21740"},"displayName":"Tsuyoshi Ozawa","active":true,"timeZone":"America/Los_Angeles"},"body":"[~rakeshr] hi Rakesh, how is the progress of this issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ozawa","name":"ozawa","key":"ozawa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ozawa&avatarId=21740","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ozawa&avatarId=21740","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ozawa&avatarId=21740","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ozawa&avatarId=21740"},"displayName":"Tsuyoshi Ozawa","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-25T06:38:39.091+0000","updated":"2016-07-25T06:38:39.091+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15391428","id":"15391428","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"[~ozawa], thanks for the interest. I was busy with other things and will give priority to this issue. I will update patch soon. I'm planning to include this in 3.4.9 release and please see the [3.4.9 release discussion|http://goo.gl/SJJhbx]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-25T06:53:01.127+0000","updated":"2016-07-25T06:53:01.127+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15391877","id":"15391877","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Attached initial patch where I've used {{zkServer.isRunning()}} status to check whether the server is up and running. Appreciate your help in reviews. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-25T13:23:09.287+0000","updated":"2016-07-25T13:23:09.287+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15392021","id":"15392021","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"fyi: The patch got a green [build_3284|https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3284/] , unfortunately there is a {{Permission denied}} issue in the build and due to that its not commenting to the jira. Anyone has idea about this problem?\n\n{code}\n[exec] /home/jenkins/jenkins-slave/workspace/PreCommit-ZOOKEEPER-Build/trunk/src/java/test/bin/test-patch.sh: line 558: /home/jenkins/tools/jiracli/latest/jira: Permission denied\n     [exec] /home/jenkins/jenkins-slave/workspace/PreCommit-ZOOKEEPER-Build/trunk/src/java/test/bin/test-patch.sh: line 559: /home/jenkins/tools/jiracli/latest/jira: Permission denied\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-25T14:45:26.725+0000","updated":"2016-07-25T14:45:26.725+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15396992","id":"15396992","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12819926/ZOOKEEPER-2383.patch\n  against trunk revision 1754188.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3290//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3290//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3290//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-28T05:56:09.119+0000","updated":"2016-07-28T05:56:09.119+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15399042","id":"15399042","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=suda","name":"suda","key":"suda","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akihiro Suda","active":true,"timeZone":"Asia/Tokyo"},"body":"+1 (non-binding).\n\nLocally tested ZooKeeperServerStartupTest 300 times and it passed.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=suda","name":"suda","key":"suda","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akihiro Suda","active":true,"timeZone":"Asia/Tokyo"},"created":"2016-07-29T09:40:32.855+0000","updated":"2016-07-29T09:40:32.855+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15399613","id":"15399613","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thank you [~suda] for the feedback.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-29T16:26:59.255+0000","updated":"2016-07-29T16:26:59.255+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15399680","id":"15399680","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"body":"[~rakeshr], looks like your patch is against trunk - if you make a branch-3.4 version of the patch, I'll run Solr's tests using a build off that branch (I'm assuming the next Solr ZK dep version will be 3.4.9).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"created":"2016-07-29T17:01:41.082+0000","updated":"2016-07-29T17:01:41.082+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15399783","id":"15399783","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~steve_rowe]. I'm attaching another patch based on br-3.4, would be great to see your feedback on this.\n\nNote: Jenkins will pick this {{ZK-2383-br-3-4}} patch and will fail while applying against trunk code, please ignore it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-29T18:07:31.040+0000","updated":"2016-07-29T18:07:31.040+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15399789","id":"15399789","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12821043/ZOOKEEPER-2383-br-3-4.patch\n  against trunk revision 1754188.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    -1 patch.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3310//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-29T18:09:26.597+0000","updated":"2016-07-29T18:09:26.597+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15408727","id":"15408727","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"body":"[~rakeshr], I patched branch-3.4 at revision 1754563 with your {{ZOOKEEPER-2383-br-3-4.patch}}, applied my SOLR-8724 patch with a small change to account for ZOOKEEPER-2141, and changed the depended-on ZK version from 3.4.8 to 3.4.9-SNAPSHOT (the version built off branch-3.4 with your patch), and Solr tests pass, so +1 from me to include your patch in the 3.4.9 release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","key":"steve_rowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true,"timeZone":"America/New_York"},"created":"2016-08-05T01:08:32.535+0000","updated":"2016-08-05T01:08:32.535+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15408810","id":"15408810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks a lot [~steve_rowe] for the feedback. \n\n[~fpj], [~phunt], [~rgs], do you have some cycles to review this. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-08-05T03:19:08.973+0000","updated":"2016-08-05T03:19:08.973+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15408826","id":"15408826","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rgs","name":"rgs","key":"rgs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rgs&avatarId=18469","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rgs&avatarId=18469","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rgs&avatarId=18469","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rgs&avatarId=18469"},"displayName":"Raul Gutierrez Segales","active":true,"timeZone":"America/Los_Angeles"},"body":"[~rakeshr]: looks good to me, one nit though. In testClientConnectionRequestDuringStartup:\n\n{code}\n+        CountdownWatcher watcher = new CountdownWatcher();\n+        new ZooKeeper(HOSTPORT, ClientBase.CONNECTION_TIMEOUT, watcher);\n{code}\n\nlets assign the ZooKeeper object to a var and explicitly clean it up when done. Other than that, +1.\n\nHappy to merge it after that. Thanks [~rakeshr]!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rgs","name":"rgs","key":"rgs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rgs&avatarId=18469","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rgs&avatarId=18469","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rgs&avatarId=18469","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rgs&avatarId=18469"},"displayName":"Raul Gutierrez Segales","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-08-05T03:48:21.254+0000","updated":"2016-08-05T03:48:21.254+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15408906","id":"15408906","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~rgs]. Attached new patch addressing the comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-08-05T05:35:12.082+0000","updated":"2016-08-05T05:35:12.082+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15408930","id":"15408930","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12822237/ZOOKEEPER-2383.patch\n  against trunk revision 1755100.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3324//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3324//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3324//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-05T05:59:39.152+0000","updated":"2016-08-05T05:59:39.152+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15409316","id":"15409316","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12822237/ZOOKEEPER-2383.patch\n  against trunk revision 1755100.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3325//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3325//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3325//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-05T10:57:06.532+0000","updated":"2016-08-05T10:57:06.532+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15409640","id":"15409640","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"ZOOKEEPER-2383-br-3-4.patch may also be updated with this fix as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2016-08-05T16:14:48.396+0000","updated":"2016-08-05T16:14:48.396+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15409673","id":"15409673","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"One small suggestion - the condition of {code} zkServer == null || !zkServer.isRunning() {code} could be refactored into a dedicated method such as {code} boolean isZKServerRunning(ZooKeeperServer zkServer) { return zkServer != null && zkServer.isRunning(); }{code}, which centralized such logic and make it reusable later. We could put it in Command.java or ZKUtil.java maybe?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2016-08-05T16:30:36.040+0000","updated":"2016-08-05T16:30:36.040+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15409828","id":"15409828","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~hanm] for the reviews. It looks like {{ZKUtil.java}} has ZooKeeper client related operations. Attached new patch, where I've tried keeping {{isZKServerRunning()}} in {{AbstractFourLetterCommand.java}}. Does this sound good to you?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-08-05T18:08:44.153+0000","updated":"2016-08-05T18:10:33.805+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15409886","id":"15409886","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12822349/ZOOKEEPER-2383.patch\n  against trunk revision 1755100.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3327//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3327//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3327//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-05T18:39:16.605+0000","updated":"2016-08-05T18:39:16.605+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15409917","id":"15409917","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"Thanks Rakesh for quick reply - looks good to me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2016-08-05T19:10:04.951+0000","updated":"2016-08-05T19:10:04.951+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15410424","id":"15410424","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12822349/ZOOKEEPER-2383.patch\n  against trunk revision 1755379.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3328//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3328//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3328//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-06T03:18:29.419+0000","updated":"2016-08-06T03:18:29.419+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15410820","id":"15410820","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"[~rgs], would you take another look at the latest patch and help me pushing this in. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-08-07T04:17:00.066+0000","updated":"2016-08-07T04:17:00.066+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15420205","id":"15420205","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"[~rgs] possible for you take another look?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-08-14T04:11:58.568+0000","updated":"2016-08-14T04:11:58.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15422902","id":"15422902","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"I am moving this out to 3.4.10 for now. Please feel free to discuss the target version, Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-08-16T15:38:28.796+0000","updated":"2016-08-16T15:38:28.796+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15470882","id":"15470882","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"I've got +1(non-binding) from [~steve_rowe] and [~hanm].\n\nHi [~fpj], [~rgs], do you have some cycles to review the proposed patch considering the bug priority. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-09-07T15:13:22.294+0000","updated":"2016-09-07T15:13:22.294+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15499075","id":"15499075","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"[~rakesh_r] I have checked the 3.4 patch. In {{NettyServerCnxn}}, it looks like we are only updating the code for 4lws. Don't we have to also update it here:\n\n{noformat}\n                        if (zks == null) {\n                            throw new IOException(\"ZK down\");\n                        }\n{noformat}\n\nThis is in {{NettyServerCnxn.receiveMessage}.\n\nAbout the test case:\n\n# I ran it with and without the changes. With the changes, it works fine. Without the changes, it hangs forever. I noticed in the logs that it gets:\n\n{noformat}\njava.lang.AssertionError: Since zk server is not started createsession method to be invoked\n{noformat}\n\nbut it never exists as the client keeps trying to connect. It sounds like some thread is hanging and not letting the test framework exit.\n\n# This sentence doesn't make much sense to me: {{Since zk server is not started createsession method to be invoked}}\n# Please reduce the test case timeout to no longer than 30s.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-09-17T13:57:01.179+0000","updated":"2016-09-17T13:57:01.179+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15499350","id":"15499350","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~fpj] for the comments. \n\nbq. In NettyServerCnxn, it looks like we are only updating the code for 4lws. Don't we have to also update it here:\n\nI think, I have handled this case and the following condition present in [ZOOKEEPER-2383-br-3-4.patch|https://issues.apache.org/jira/secure/attachment/12821043/ZOOKEEPER-2383-br-3-4.patch]. Am I missing any other case apart from the below line of code.\n{code}\n@@ -735,7 +735,7 @@\n                         bb.flip();\n \n                         ZooKeeperServer zks = this.zkServer;\n-                        if (zks == null) {\n+                        if (zks == null || !zks.isRunning()) {\n                             throw new IOException(\"ZK down\");\n                         }\n                         if (initialized) {\n{code}\n\nbq. but it never exists as the client keeps trying to connect. It sounds like some thread is hanging and not letting the test framework exit.\nWithout patch it fails at {{simplezks.waitForStartupInvocation(10)}}. On the other side {{SimpleZooKeeperServer#startup}} thread is waiting at startupDelayLatch.await() and this is causing an indefinite wait. How about adding the countdown logic in finally so that it will proceed:\n{code}\n\t        try {\n            Assert.assertFalse(\n                    \"Should fail to create zk client session as server is not fully started\",\n                    simplezks.waitForSessionCreation(10));\n        } finally {\n            LOG.info(\n                    \"Decrements the count of the latch, so that server will proceed with startup\");\n            startupDelayLatch.countDown();\n        }\n{code}\n\nbq. This sentence doesn't make much sense to me: Since zk server is not started createsession method to be invoked\nI will modify this to \"Should fail to create zk client session as server is not fully started\"\n\nbq. Please reduce the test case timeout to no longer than 30s.\nAgreed.\n\nFYI, apart from the above, I had fixed [Michael's comment|https://issues.apache.org/jira/browse/ZOOKEEPER-2383?focusedCommentId=15409673&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15409673] and [Raul's comment|https://issues.apache.org/jira/browse/ZOOKEEPER-2383?focusedCommentId=15408826&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15408826] in trunk patch, need to rebase branch-3-4 patch to incorporate these comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-09-17T17:05:41.824+0000","updated":"2016-09-17T17:29:46.209+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15502828","id":"15502828","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"[~rakesh_r] the try/finally suggestion sounds good.\n\nI have a couple more comments that I'm not sure we can address, but I have have them written down at least:\n\n# It sounds like you have covered all necessary {{zkServer == null}} cases, but I'm concerned we might have missed any, I'm not sure there is a way of guaranteeing and the only course of action is visual inspection. It'd be much better if we could sort out the problem in the startup call instead of relying on the methods accessing the {{zkServer}} to check whether the server is running.\n#The test case isn't covering the whole modified code. In particular, it is not covering the 4lw changes this patch is making.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-09-19T09:22:12.832+0000","updated":"2016-09-19T09:22:12.832+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15502832","id":"15502832","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Actually, what prevents us from doing this:\n\n{noformat}\n--- a/src/java/main/org/apache/zookeeper/server/NIOServerCnxnFactory.java\n+++ b/src/java/main/org/apache/zookeeper/server/NIOServerCnxnFactory.java\n@@ -113,10 +113,10 @@ public void start() {\n     @Override\n     public void startup(ZooKeeperServer zks) throws IOException,\n             InterruptedException {\n-        start();\n         setZooKeeperServer(zks);\n         zks.startdata();\n         zks.startup();\n+        start();\n     }\n{noformat}\n\nInterestingly, the tests pass for me with this change, so if it doesn't work, then we have at least a test coverage problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-09-19T09:23:57.824+0000","updated":"2016-09-19T09:23:57.824+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15507169","id":"15507169","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"bq. The test case isn't covering the whole modified code. In particular, it is not covering the 4lw changes this patch is making.\nAgreed, would need to add more test cases covering 4lw and netty server.\n\nbq. Actually, what prevents us from doing this:\nIts an interesting thought to view the problem from different angle and frame a simple solution. I could see the following changes will happen if we move #start() at the end.\n\n# If someone sends 4lw command to the server during startup, zk server won't respond to it and will not print message {{\"This ZooKeeper instance is not currently serving requests\"}}.\n# There is a change in the client and server side logging.\nBefore:\n{code}\n2016-09-20 22:17:33,542 [myid:127.0.0.1:11222] - INFO  [main-SendThread(127.0.0.1:11222):ClientCnxn$SendThread@1113] - Opening socket connection to server 127.0.0.1/127.0.0.1:11222. Will not attempt to authenticate using SASL (unknown error)\n2016-09-20 22:17:33,548 [myid:] - INFO  [NIOServerCxnFactory.AcceptThread:0.0.0.0/0.0.0.0:11222:NIOServerCnxnFactory$AcceptThread@296] - Accepted socket connection from /127.0.0.1:12510\n2016-09-20 22:17:33,548 [myid:127.0.0.1:11222] - INFO  [main-SendThread(127.0.0.1:11222):ClientCnxn$SendThread@948] - Socket connection established, initiating session, client: /127.0.0.1:12510, server: 127.0.0.1/127.0.0.1:11222\n2016-09-20 22:17:33,563 [myid:] - WARN  [NIOWorkerThread-1:NIOServerCnxn@369] - Exception causing close of session 0x0: ZooKeeperServer not running\n2016-09-20 22:17:33,564 [myid:] - INFO  [NIOWorkerThread-1:NIOServerCnxn@607] - Closed socket connection for client /127.0.0.1:12510 (no session established for client)\n2016-09-20 22:17:33,564 [myid:127.0.0.1:11222] - INFO  [main-SendThread(127.0.0.1:11222):ClientCnxn$SendThread@1231] - Unable to read additional data from server sessionid 0x0, likely server has closed socket, closing socket connection and attempting reconnect\n{code}\nAfter:\n{code}\n2016-09-20 22:14:15,309 [myid:127.0.0.1:11222] - INFO  [main-SendThread(127.0.0.1:11222):ClientCnxn$SendThread@1113] - Opening socket connection to server 127.0.0.1/127.0.0.1:11222. Will not attempt to authenticate using SASL (unknown error)\n2016-09-20 22:14:15,312 [myid:127.0.0.1:11222] - INFO  [main-SendThread(127.0.0.1:11222):ClientCnxn$SendThread@948] - Socket connection established, initiating session, client: /127.0.0.1:12418, server: 127.0.0.1/127.0.0.1:11222\n2016-09-20 22:14:45,313 [myid:127.0.0.1:11222] - WARN  [main-SendThread(127.0.0.1:11222):ClientCnxn$SendThread@1181] - Client session timed out, have not heard from server in 30001ms for sessionid 0x0\n{code}\n\nIdeally server startup won't take too much time, only exceptional case is zks#loadData() is too large. I'm not aware about the use case of 4lws during startup, do anyone expect quick output shows server not running rather than connection timeout?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-09-20T17:18:17.858+0000","updated":"2016-09-20T17:18:17.858+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15528370","id":"15528370","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"[~fpj], any thoughts about the above points? Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-09-28T04:43:34.259+0000","updated":"2016-09-28T04:43:34.259+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15636358","id":"15636358","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Will this proposed fix induce any other component integration test failures. Would be great to see your view on the above analysis. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-11-04T13:40:10.362+0000","updated":"2016-11-04T13:40:10.362+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15636584","id":"15636584","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Moving the {{start()}} call to the end of the {{startup()}} method will cause the change of behavior you point out, that's correct, we shouldn't do it.\n\nApplying the test alone without the other changes still makes the test run forever. We need to fix it.\n\nThere are a few format suggestions I wanted to make, perhaps it is better to have a pull request for this. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-11-04T15:00:17.611+0000","updated":"2016-11-04T15:00:17.611+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15636680","id":"15636680","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~fpj]. OK, I'll modify the test case and create pull request.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-11-04T15:25:44.176+0000","updated":"2016-11-04T15:25:44.176+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15642047","id":"15642047","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user rakeshadr opened a pull request:\n\n    https://github.com/apache/zookeeper/pull/101\n\n    ZOOKEEPER-2383\n\n    \n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/rakeshadr/zookeeper-1 ZK-2383\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/101.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #101\n    \n----\ncommit 401ce15e7cd1eeb0e8cef367bff53c1054ea17df\nAuthor: Rakesh Radhakrishnan <rakeshr@apache.org>\nDate:   2016-11-06T16:24:53Z\n\n    ZOOKEEPER-2383\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-06T16:35:48.115+0000","updated":"2016-11-06T16:35:48.115+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15642057","id":"15642057","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Attached patch including test cases to verify the changs w.r.t {{NIOServerCnxn}}, {{NettyServerCnxn}}, {{flw commands}}.\n\nHi [~fpj], Created PR {{https://github.com/apache/zookeeper/pull/101}}, please take  look at this. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-11-06T16:44:03.582+0000","updated":"2016-11-06T16:44:03.582+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15642086","id":"15642086","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12837652/ZOOKEEPER-2383.patch\n  against trunk revision bcb07a09b06c91243ed244f04a71b8daf629e286.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    -1 findbugs.  The patch appears to introduce 19 new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3526//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3526//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3526//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-06T17:06:24.400+0000","updated":"2016-11-06T17:06:24.400+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15642088","id":"15642088","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12837652/ZOOKEEPER-2383.patch\n  against trunk revision bcb07a09b06c91243ed244f04a71b8daf629e286.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    -1 findbugs.  The patch appears to introduce 19 new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3527//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3527//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3527//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-06T17:06:53.650+0000","updated":"2016-11-06T17:06:53.650+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15643583","id":"15643583","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 2 new or modified tests.\n\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/46//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-07T09:13:33.405+0000","updated":"2016-11-07T09:13:33.405+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15724255","id":"15724255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Hi [~fpj], would be great to see your feedback on the [proposed code changes|https://github.com/apache/zookeeper/pull/101], do you have some cycles to review this. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-12-06T04:03:29.734+0000","updated":"2016-12-06T04:03:29.734+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15752671","id":"15752671","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user fpj commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/101#discussion_r92712695\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/ZooKeeperServerStartupTest.java ---\n    @@ -0,0 +1,266 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +package org.apache.zookeeper.server;\n    +\n    +import static org.apache.zookeeper.client.FourLetterWordMain.send4LetterWord;\n    +\n    +import java.io.File;\n    +import java.io.IOException;\n    +import java.util.concurrent.CountDownLatch;\n    +import java.util.concurrent.TimeUnit;\n    +\n    +import org.apache.zookeeper.PortAssignment;\n    +import org.apache.zookeeper.ZKTestCase;\n    +import org.apache.zookeeper.ZooKeeper;\n    +import org.apache.zookeeper.common.X509Exception.SSLContextException;\n    +import org.apache.zookeeper.test.ClientBase;\n    +import org.apache.zookeeper.test.ClientBase.CountdownWatcher;\n    +import org.junit.After;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +import org.slf4j.Logger;\n    +import org.slf4j.LoggerFactory;\n    +\n    +/**\n    + * This class tests the startup behavior of ZooKeeper server.\n    + */\n    +public class ZooKeeperServerStartupTest extends ZKTestCase {\n    +    private static final Logger LOG = LoggerFactory\n    +            .getLogger(ZooKeeperServerStartupTest.class);\n    +    private static int PORT = PortAssignment.unique();\n    +    private static String HOST = \"127.0.0.1\";\n    +    private static String HOSTPORT = HOST + \":\" + PORT;\n    +    private static final String ZK_NOT_SERVING = \"This ZooKeeper instance is not currently serving requests\";\n    +\n    +    private ServerCnxnFactory servcnxnf;\n    +    private ZooKeeperServer zks;\n    +    private File tmpDir;\n    +    private CountDownLatch startupDelayLatch = new CountDownLatch(1);\n    +\n    +    @After\n    +    public void teardown() throws Exception {\n    +        // count down to avoid infinite blocking call due to this latch, if\n    +        // any.\n    +        startupDelayLatch.countDown();\n    +\n    +        if (servcnxnf != null) {\n    +            servcnxnf.shutdown();\n    +        }\n    +        if (zks != null) {\n    +            zks.shutdown();\n    +        }\n    +        if (zks.getZKDatabase() != null) {\n    +            zks.getZKDatabase().close();\n    +        }\n    +        ClientBase.recursiveDelete(tmpDir);\n    +    }\n    +\n    +    /**\n    +     * Test case for\n    +     * {@link https://issues.apache.org/jira/browse/ZOOKEEPER-2383}.\n    +     */\n    +    @Test(timeout = 30000)\n    +    public void testClientConnectionRequestDuringStartupWithNIOServerCnxn()\n    +            throws Exception {\n    +        tmpDir = ClientBase.createTmpDir();\n    +        ClientBase.setupTestEnv();\n    +\n    +        startSimpleZKServer(startupDelayLatch);\n    +        SimpleZooKeeperServer simplezks = (SimpleZooKeeperServer) zks;\n    +        Assert.assertTrue(\n    +                \"Failed to invoke zks#startup() method during server startup\",\n    +                simplezks.waitForStartupInvocation(10));\n    +\n    +        CountdownWatcher watcher = new CountdownWatcher();\n    +        ZooKeeper zkClient = new ZooKeeper(HOSTPORT,\n    +                ClientBase.CONNECTION_TIMEOUT, watcher);\n    +\n    +        Assert.assertFalse(\n    +                \"Since server is not fully started, zks#createSession() shouldn't be invoked\",\n    +                simplezks.waitForSessionCreation(5));\n    +\n    +        LOG.info(\n    +                \"Decrements the count of the latch, so that server will proceed with startup\");\n    +        startupDelayLatch.countDown();\n    +\n    +        Assert.assertTrue(\"waiting for server being up \", ClientBase\n    +                .waitForServerUp(HOSTPORT, ClientBase.CONNECTION_TIMEOUT));\n    +\n    +        Assert.assertTrue(\n    +                \"Failed to invoke zks#createSession() method during client session creation\",\n    +                simplezks.waitForSessionCreation(5));\n    +        watcher.waitForConnected(ClientBase.CONNECTION_TIMEOUT);\n    +        zkClient.close();\n    +    }\n    +\n    +    /**\n    +     * Test case for\n    +     * {@link https://issues.apache.org/jira/browse/ZOOKEEPER-2383}.\n    +     */\n    +    @Test(timeout = 30000)\n    +    public void testClientConnectionRequestDuringStartupWithNettyServerCnxn()\n    +            throws Exception {\n    +        tmpDir = ClientBase.createTmpDir();\n    +        ClientBase.setupTestEnv();\n    +\n    +        String originalServerCnxnFactory = System\n    +                .getProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY);\n    +        try {\n    +            System.setProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY,\n    +                    NettyServerCnxnFactory.class.getName());\n    +            startSimpleZKServer(startupDelayLatch);\n    +            SimpleZooKeeperServer simplezks = (SimpleZooKeeperServer) zks;\n    +            Assert.assertTrue(\n    +                    \"Failed to invoke zks#startup() method during server startup\",\n    +                    simplezks.waitForStartupInvocation(10));\n    +\n    +            CountdownWatcher watcher = new CountdownWatcher();\n    +            ZooKeeper zkClient = new ZooKeeper(HOSTPORT,\n    +                    ClientBase.CONNECTION_TIMEOUT, watcher);\n    +\n    +            Assert.assertFalse(\n    +                    \"Since server is not fully started, zks#createSession() shouldn't be invoked\",\n    +                    simplezks.waitForSessionCreation(5));\n    +\n    +            LOG.info(\n    +                    \"Decrements the count of the latch, so that server will proceed with startup\");\n    +            startupDelayLatch.countDown();\n    +\n    +            Assert.assertTrue(\"waiting for server being up \", ClientBase\n    +                    .waitForServerUp(HOSTPORT, ClientBase.CONNECTION_TIMEOUT));\n    +\n    +            Assert.assertTrue(\n    +                    \"Failed to invoke zks#createSession() method during client session creation\",\n    +                    simplezks.waitForSessionCreation(5));\n    +            watcher.waitForConnected(ClientBase.CONNECTION_TIMEOUT);\n    +            zkClient.close();\n    +        } finally {\n    +            // reset cnxn factory\n    +            if (originalServerCnxnFactory == null) {\n    +                System.clearProperty(\n    +                        ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY);\n    +                return;\n    +            }\n    +            System.setProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY,\n    +                    originalServerCnxnFactory);\n    +        }\n    +    }\n    +\n    +    /**\n    +     * Test case for\n    +     * {@link https://issues.apache.org/jira/browse/ZOOKEEPER-2383}.\n    +     */\n    +    @Test(timeout = 30000)\n    +    public void testFourLetterWords() throws Exception {\n    +        startSimpleZKServer(startupDelayLatch);\n    +        verify(\"conf\", ZK_NOT_SERVING);\n    +        verify(\"crst\", ZK_NOT_SERVING);\n    +        verify(\"cons\", ZK_NOT_SERVING);\n    +        verify(\"dirs\", ZK_NOT_SERVING);\n    +        verify(\"dump\", ZK_NOT_SERVING);\n    +        verify(\"mntr\", ZK_NOT_SERVING);\n    +        verify(\"stat\", ZK_NOT_SERVING);\n    +        verify(\"srst\", ZK_NOT_SERVING);\n    +        verify(\"wchp\", ZK_NOT_SERVING);\n    +        verify(\"wchc\", ZK_NOT_SERVING);\n    +        verify(\"wchs\", ZK_NOT_SERVING);\n    +        verify(\"isro\", \"null\");\n    +    }\n    +\n    +    private void verify(String cmd, String expected)\n    +            throws IOException, SSLContextException {\n    +        String resp = sendRequest(cmd);\n    +        LOG.info(\"cmd \" + cmd + \" expected \" + expected + \" got \" + resp);\n    +        Assert.assertTrue(\"Unexpected response\", resp.contains(expected));\n    +    }\n    +\n    +    private String sendRequest(String cmd)\n    +            throws IOException, SSLContextException {\n    +        return send4LetterWord(HOST, PORT, cmd);\n    +    }\n    +\n    +    private void startSimpleZKServer(CountDownLatch startupDelayLatch)\n    +            throws IOException {\n    +        zks = new SimpleZooKeeperServer(tmpDir, tmpDir, 3000,\n    +                startupDelayLatch);\n    +        SyncRequestProcessor.setSnapCount(100);\n    +        final int PORT = Integer.parseInt(HOSTPORT.split(\":\")[1]);\n    +\n    +        servcnxnf = ServerCnxnFactory.createFactory(PORT, -1);\n    +        Thread startupThread = new Thread() {\n    +            public void run() {\n    +                try {\n    +                    servcnxnf.startup(zks);\n    +                } catch (IOException | InterruptedException e) {\n    --- End diff --\n    \n    We can't have a multi-catch with Java 6, which is the earliest version we say we support in the docs.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-15T22:19:30.166+0000","updated":"2016-12-15T22:19:30.166+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15752679","id":"15752679","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"There is a compilation issue in the 3.4 branch, I left a comment in the pull request:\n\n{noformat}\ncompile-test:\n    [mkdir] Created dir: /Users/fpj/code/github/zookeeper/build/test/classes\n    [javac] Compiling 145 source files to /Users/fpj/code/github/zookeeper/build/test/classes\n    [javac] warning: [options] bootstrap class path not set in conjunction with -source 1.6\n    [javac] /Users/fpj/code/github/zookeeper/src/java/test/org/apache/zookeeper/server/ZooKeeperServerStartupTest.java:209: error: multi-catch statement is not supported in -source 1.6\n    [javac]                 } catch (IOException | InterruptedException e) {\n    [javac]                                      ^\n    [javac]   (use -source 7 or higher to enable multi-catch statement)\n    [javac] 1 error\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-12-15T22:21:05.210+0000","updated":"2016-12-15T22:21:05.210+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15754024","id":"15754024","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user rakeshadr commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/101#discussion_r92785304\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/ZooKeeperServerStartupTest.java ---\n    @@ -0,0 +1,266 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +package org.apache.zookeeper.server;\n    +\n    +import static org.apache.zookeeper.client.FourLetterWordMain.send4LetterWord;\n    +\n    +import java.io.File;\n    +import java.io.IOException;\n    +import java.util.concurrent.CountDownLatch;\n    +import java.util.concurrent.TimeUnit;\n    +\n    +import org.apache.zookeeper.PortAssignment;\n    +import org.apache.zookeeper.ZKTestCase;\n    +import org.apache.zookeeper.ZooKeeper;\n    +import org.apache.zookeeper.common.X509Exception.SSLContextException;\n    +import org.apache.zookeeper.test.ClientBase;\n    +import org.apache.zookeeper.test.ClientBase.CountdownWatcher;\n    +import org.junit.After;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +import org.slf4j.Logger;\n    +import org.slf4j.LoggerFactory;\n    +\n    +/**\n    + * This class tests the startup behavior of ZooKeeper server.\n    + */\n    +public class ZooKeeperServerStartupTest extends ZKTestCase {\n    +    private static final Logger LOG = LoggerFactory\n    +            .getLogger(ZooKeeperServerStartupTest.class);\n    +    private static int PORT = PortAssignment.unique();\n    +    private static String HOST = \"127.0.0.1\";\n    +    private static String HOSTPORT = HOST + \":\" + PORT;\n    +    private static final String ZK_NOT_SERVING = \"This ZooKeeper instance is not currently serving requests\";\n    +\n    +    private ServerCnxnFactory servcnxnf;\n    +    private ZooKeeperServer zks;\n    +    private File tmpDir;\n    +    private CountDownLatch startupDelayLatch = new CountDownLatch(1);\n    +\n    +    @After\n    +    public void teardown() throws Exception {\n    +        // count down to avoid infinite blocking call due to this latch, if\n    +        // any.\n    +        startupDelayLatch.countDown();\n    +\n    +        if (servcnxnf != null) {\n    +            servcnxnf.shutdown();\n    +        }\n    +        if (zks != null) {\n    +            zks.shutdown();\n    +        }\n    +        if (zks.getZKDatabase() != null) {\n    +            zks.getZKDatabase().close();\n    +        }\n    +        ClientBase.recursiveDelete(tmpDir);\n    +    }\n    +\n    +    /**\n    +     * Test case for\n    +     * {@link https://issues.apache.org/jira/browse/ZOOKEEPER-2383}.\n    +     */\n    +    @Test(timeout = 30000)\n    +    public void testClientConnectionRequestDuringStartupWithNIOServerCnxn()\n    +            throws Exception {\n    +        tmpDir = ClientBase.createTmpDir();\n    +        ClientBase.setupTestEnv();\n    +\n    +        startSimpleZKServer(startupDelayLatch);\n    +        SimpleZooKeeperServer simplezks = (SimpleZooKeeperServer) zks;\n    +        Assert.assertTrue(\n    +                \"Failed to invoke zks#startup() method during server startup\",\n    +                simplezks.waitForStartupInvocation(10));\n    +\n    +        CountdownWatcher watcher = new CountdownWatcher();\n    +        ZooKeeper zkClient = new ZooKeeper(HOSTPORT,\n    +                ClientBase.CONNECTION_TIMEOUT, watcher);\n    +\n    +        Assert.assertFalse(\n    +                \"Since server is not fully started, zks#createSession() shouldn't be invoked\",\n    +                simplezks.waitForSessionCreation(5));\n    +\n    +        LOG.info(\n    +                \"Decrements the count of the latch, so that server will proceed with startup\");\n    +        startupDelayLatch.countDown();\n    +\n    +        Assert.assertTrue(\"waiting for server being up \", ClientBase\n    +                .waitForServerUp(HOSTPORT, ClientBase.CONNECTION_TIMEOUT));\n    +\n    +        Assert.assertTrue(\n    +                \"Failed to invoke zks#createSession() method during client session creation\",\n    +                simplezks.waitForSessionCreation(5));\n    +        watcher.waitForConnected(ClientBase.CONNECTION_TIMEOUT);\n    +        zkClient.close();\n    +    }\n    +\n    +    /**\n    +     * Test case for\n    +     * {@link https://issues.apache.org/jira/browse/ZOOKEEPER-2383}.\n    +     */\n    +    @Test(timeout = 30000)\n    +    public void testClientConnectionRequestDuringStartupWithNettyServerCnxn()\n    +            throws Exception {\n    +        tmpDir = ClientBase.createTmpDir();\n    +        ClientBase.setupTestEnv();\n    +\n    +        String originalServerCnxnFactory = System\n    +                .getProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY);\n    +        try {\n    +            System.setProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY,\n    +                    NettyServerCnxnFactory.class.getName());\n    +            startSimpleZKServer(startupDelayLatch);\n    +            SimpleZooKeeperServer simplezks = (SimpleZooKeeperServer) zks;\n    +            Assert.assertTrue(\n    +                    \"Failed to invoke zks#startup() method during server startup\",\n    +                    simplezks.waitForStartupInvocation(10));\n    +\n    +            CountdownWatcher watcher = new CountdownWatcher();\n    +            ZooKeeper zkClient = new ZooKeeper(HOSTPORT,\n    +                    ClientBase.CONNECTION_TIMEOUT, watcher);\n    +\n    +            Assert.assertFalse(\n    +                    \"Since server is not fully started, zks#createSession() shouldn't be invoked\",\n    +                    simplezks.waitForSessionCreation(5));\n    +\n    +            LOG.info(\n    +                    \"Decrements the count of the latch, so that server will proceed with startup\");\n    +            startupDelayLatch.countDown();\n    +\n    +            Assert.assertTrue(\"waiting for server being up \", ClientBase\n    +                    .waitForServerUp(HOSTPORT, ClientBase.CONNECTION_TIMEOUT));\n    +\n    +            Assert.assertTrue(\n    +                    \"Failed to invoke zks#createSession() method during client session creation\",\n    +                    simplezks.waitForSessionCreation(5));\n    +            watcher.waitForConnected(ClientBase.CONNECTION_TIMEOUT);\n    +            zkClient.close();\n    +        } finally {\n    +            // reset cnxn factory\n    +            if (originalServerCnxnFactory == null) {\n    +                System.clearProperty(\n    +                        ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY);\n    +                return;\n    +            }\n    +            System.setProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY,\n    +                    originalServerCnxnFactory);\n    +        }\n    +    }\n    +\n    +    /**\n    +     * Test case for\n    +     * {@link https://issues.apache.org/jira/browse/ZOOKEEPER-2383}.\n    +     */\n    +    @Test(timeout = 30000)\n    +    public void testFourLetterWords() throws Exception {\n    +        startSimpleZKServer(startupDelayLatch);\n    +        verify(\"conf\", ZK_NOT_SERVING);\n    +        verify(\"crst\", ZK_NOT_SERVING);\n    +        verify(\"cons\", ZK_NOT_SERVING);\n    +        verify(\"dirs\", ZK_NOT_SERVING);\n    +        verify(\"dump\", ZK_NOT_SERVING);\n    +        verify(\"mntr\", ZK_NOT_SERVING);\n    +        verify(\"stat\", ZK_NOT_SERVING);\n    +        verify(\"srst\", ZK_NOT_SERVING);\n    +        verify(\"wchp\", ZK_NOT_SERVING);\n    +        verify(\"wchc\", ZK_NOT_SERVING);\n    +        verify(\"wchs\", ZK_NOT_SERVING);\n    +        verify(\"isro\", \"null\");\n    +    }\n    +\n    +    private void verify(String cmd, String expected)\n    +            throws IOException, SSLContextException {\n    +        String resp = sendRequest(cmd);\n    +        LOG.info(\"cmd \" + cmd + \" expected \" + expected + \" got \" + resp);\n    +        Assert.assertTrue(\"Unexpected response\", resp.contains(expected));\n    +    }\n    +\n    +    private String sendRequest(String cmd)\n    +            throws IOException, SSLContextException {\n    +        return send4LetterWord(HOST, PORT, cmd);\n    +    }\n    +\n    +    private void startSimpleZKServer(CountDownLatch startupDelayLatch)\n    +            throws IOException {\n    +        zks = new SimpleZooKeeperServer(tmpDir, tmpDir, 3000,\n    +                startupDelayLatch);\n    +        SyncRequestProcessor.setSnapCount(100);\n    +        final int PORT = Integer.parseInt(HOSTPORT.split(\":\")[1]);\n    +\n    +        servcnxnf = ServerCnxnFactory.createFactory(PORT, -1);\n    +        Thread startupThread = new Thread() {\n    +            public void run() {\n    +                try {\n    +                    servcnxnf.startup(zks);\n    +                } catch (IOException | InterruptedException e) {\n    --- End diff --\n    \n    Thank you @fpj . I've separated out the catch block and done another commit in PR.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-16T10:16:39.396+0000","updated":"2016-12-16T10:16:39.396+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15754060","id":"15754060","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 2 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/130//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/130//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/130//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-16T10:28:50.315+0000","updated":"2016-12-16T10:28:50.315+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15754062","id":"15754062","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 2 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/129//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/129//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/129//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-16T10:30:02.834+0000","updated":"2016-12-16T10:30:02.834+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15754181","id":"15754181","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user fpj commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/101\n  \n    This is including the commit I just did for ZOOKEEPER-761, could you rebase your branch, please, @rakeshadr ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-16T11:28:59.511+0000","updated":"2016-12-16T11:28:59.511+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15754797","id":"15754797","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 2 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/134//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/134//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/134//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-16T15:59:13.057+0000","updated":"2016-12-16T15:59:13.057+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15754824","id":"15754824","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user rakeshadr commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/101\n  \n    oops, I've rebased it and hope the PR is clean now. Please take a look at this when you get some time. Thanks!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-16T16:08:22.821+0000","updated":"2016-12-16T16:08:22.821+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15768361","id":"15768361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/zookeeper/pull/101\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-21T22:32:35.479+0000","updated":"2016-12-21T22:32:35.479+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15768373","id":"15768373","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"[~rakesh_r] pull request #101 merged fine onto master, but not branch 3.5. I haven't tried branch 3.4.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-12-21T22:36:10.986+0000","updated":"2016-12-21T22:36:25.982+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15768490","id":"15768490","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Jenkins build ZooKeeper-trunk #3204 (See [https://builds.apache.org/job/ZooKeeper-trunk/3204/])\nZOOKEEPER-2383: Startup race in ZooKeeperServer (fpj: rev eac693cc76a34f96b9116ef33d1e92af7129416d)\n* (edit) src/java/main/org/apache/zookeeper/server/command/AbstractFourLetterCommand.java\n* (edit) src/java/main/org/apache/zookeeper/server/command/DumpCommand.java\n* (edit) src/java/main/org/apache/zookeeper/server/command/StatResetCommand.java\n* (edit) src/java/main/org/apache/zookeeper/server/command/IsroCommand.java\n* (edit) src/java/main/org/apache/zookeeper/server/command/ConsCommand.java\n* (edit) src/java/main/org/apache/zookeeper/server/admin/Commands.java\n* (edit) src/java/main/org/apache/zookeeper/server/command/MonitorCommand.java\n* (edit) src/java/main/org/apache/zookeeper/server/command/ConfCommand.java\n* (edit) src/java/main/org/apache/zookeeper/server/command/WatchCommand.java\n* (add) src/java/test/org/apache/zookeeper/server/ZooKeeperServerStartupTest.java\n* (edit) src/java/main/org/apache/zookeeper/server/NIOServerCnxn.java\n* (edit) src/java/main/org/apache/zookeeper/server/NettyServerCnxn.java\n* (edit) src/java/main/org/apache/zookeeper/server/command/CnxnStatResetCommand.java\n* (edit) src/java/main/org/apache/zookeeper/server/command/DirsCommand.java\n* (edit) src/java/main/org/apache/zookeeper/server/command/StatCommand.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-21T23:37:36.745+0000","updated":"2016-12-21T23:37:36.745+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15768992","id":"15768992","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thank you [~fpj] for the help in resolving this.\nbq. pull request #101 merged fine onto master, but not branch 3.5. I haven't tried branch 3.4.\nI've tried cherry pick the commits to branch-3.5 locally and it worked. Is there anything specific to be done to {{branch 3.5}}?. But it requires a separate PR for {{branch 3.4}} as the code is different from master branch, I'will create a PR for {{branch 3.4}} shortly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-12-22T04:25:52.778+0000","updated":"2016-12-22T04:25:52.778+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15770897","id":"15770897","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~hanm] for merging this to {{branch-3.5}}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-12-22T19:35:04.065+0000","updated":"2016-12-22T19:35:04.065+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15773276","id":"15773276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user rakeshadr opened a pull request:\n\n    https://github.com/apache/zookeeper/pull/135\n\n    ZOOKEEPER-2383: Startup race in ZooKeeperServer\n\n    \n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/rakeshadr/zookeeper-1 ZK-2383-br-3.4\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/135.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #135\n    \n----\ncommit 08d26512f131897f82b2566439c55c8fe539c4e5\nAuthor: Rakesh Radhakrishnan <rakeshr@apache.org>\nDate:   2016-12-23T16:54:12Z\n\n    ZOOKEEPER-2383: Startup race in ZooKeeperServer\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-23T17:00:41.607+0000","updated":"2016-12-23T17:00:41.607+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15773279","id":"15773279","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"[PR_135|https://github.com/apache/zookeeper/pull/135] is created to merge the changes to {{branch-3.4}}. Please review this. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-12-23T17:03:11.152+0000","updated":"2016-12-23T17:03:11.152+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15795574","id":"15795574","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user hanm commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/135\n  \n    @rakeshadr The test file is put in source folder (src/java/main/org/apache/zookeeper/server/ZooKeeperServerStartupTest.java) - it should be put in test folder (src/java/test) right?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-03T17:17:14.592+0000","updated":"2017-01-03T17:17:14.592+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15795616","id":"15795616","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user rakeshadr commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/135\n  \n    Thanks @hanm for pointing out this. I've moved the test accordingly.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-03T17:37:58.330+0000","updated":"2017-01-03T17:37:58.330+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15795648","id":"15795648","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user hanm commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/135\n  \n    Thanks @rakeshadr , looks good. Merging.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-03T17:52:01.221+0000","updated":"2017-01-03T17:52:01.221+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15795654","id":"15795654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"Issue resolved by pull request 135\n[https://github.com/apache/zookeeper/pull/135]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2017-01-03T17:54:20.056+0000","updated":"2017-01-03T17:54:20.056+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15833796","id":"15833796","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user hanm commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/135\n  \n    @rakeshadr Could you close this PR since it has been merged in? Thanks.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-23T01:36:53.507+0000","updated":"2017-01-23T01:36:53.507+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15833876","id":"15833876","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user rakeshadr closed the pull request at:\n\n    https://github.com/apache/zookeeper/pull/135\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-23T04:03:20.109+0000","updated":"2017-01-23T04:03:20.109+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12948074/comment/15833877","id":"15833877","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user rakeshadr commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/135\n  \n    Done!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-23T04:03:38.670+0000","updated":"2017-01-23T04:03:38.670+0000"}],"maxResults":74,"total":74,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2383/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2ucfr:"}}