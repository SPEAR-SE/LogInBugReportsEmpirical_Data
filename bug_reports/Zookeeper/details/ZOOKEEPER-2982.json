{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13139513","self":"https://issues.apache.org/jira/rest/api/2/issue/13139513","key":"ZOOKEEPER-2982","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12340141","id":"12340141","description":"Beta release against 3.5 branch","name":"3.5.4","archived":false,"released":true,"releaseDate":"2018-05-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326518","id":"12326518","name":"3.6.0","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2018-02-19T23:13:02.822+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed May 09 01:05:42 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_6751764865_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-05-08T22:57:31.259+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2982/watchers","watchCount":6,"isWatching":false},"created":"2018-02-19T19:28:06.429+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316644","id":"12316644","description":"Dynamic Reconfig, Remove Watches, Local Session","name":"3.5.0","archived":false,"released":true,"releaseDate":"2014-08-04"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326786","id":"12326786","description":"Alpha release against 3.5 branch","name":"3.5.1","archived":false,"released":true,"releaseDate":"2015-09-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335444","id":"12335444","description":"Beta release against 3.5 branch","name":"3.5.3","archived":false,"released":true,"releaseDate":"2017-04-17"}],"issuelinks":[{"id":"12527619","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12527619","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12597797","key":"ZOOKEEPER-1506","self":"https://issues.apache.org/jira/rest/api/2/issue/12597797","fields":{"summary":"Re-try DNS hostname -> IP resolution if node connection fails","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-05-09T01:05:42.624+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"ZOOKEEPER-1506 fixed a DNS resolution issue in 3.4.  Some portions of the fix haven't yet been ported to 3.5.\r\n\r\nTo recap the outstanding problem in 3.5, if a given ZK server is started before all peer addresses are resolvable, that server may cache a negative lookup result and forever fail to resolve the address.    For example, deploying ZK 3.5 to Kubernetes using a StatefulSet plus a Service (headless) may fail because the DNS records are created lazily.\r\n\r\n{code}\r\n2018-02-18 09:11:22,583 [myid:0] - WARN  [QuorumPeer[myid=0](plain=/0:0:0:0:0:0:0:0:2181)(secure=disabled):Follower@95] - Exception when following the leader\r\njava.net.UnknownHostException: zk-2.zk.default.svc.cluster.local\r\n        at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:184)\r\n        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\r\n        at java.net.Socket.connect(Socket.java:589)\r\n        at org.apache.zookeeper.server.quorum.Learner.sockConnect(Learner.java:227)\r\n        at org.apache.zookeeper.server.quorum.Learner.connectToLeader(Learner.java:256)\r\n        at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:76)\r\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:1133)\r\n{code}\r\n\r\nIn the above example, the address `zk-2.zk.default.svc.cluster.local` was not resolvable when the server started, but became resolvable shortly thereafter.    The server should eventually succeed but doesn't.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12911406","id":"12911406","filename":"3.5.3-beta.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-21T17:33:10.706+0000","size":16995,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12911406/3.5.3-beta.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12911293","id":"12911293","filename":"fixed.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-20T23:18:41.523+0000","size":60218,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12911293/fixed.log"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Re-try DNS hostname -> IP resolution","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16369441","id":"16369441","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"Looking at `Learner` in 3.4 versus 3.5, a necessary call within `findLeader` to `recreateSocketAddresses` was added in 3.4 but not ported to 3.5.  The suggested fix is to add the call.\r\n\r\nNote that other elements of ZOOKEEPR-1506 were already ported:\r\nhttps://github.com/apache/zookeeper/commit/d2a49163b7bc7c9589140dbba7f60e591028f908\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-19T19:31:04.811+0000","updated":"2018-02-19T19:31:04.811+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16369596","id":"16369596","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user EronWright opened a pull request:\n\n    https://github.com/apache/zookeeper/pull/468\n\n    ZOOKEEPER-2982: Re-try DNS hostname -> IP resolution if node connection fails\n\n    This PR ports a fix from the 3.4 to the 3.5 branch, that was originally made in ZOOKEEPER-1506.\r\n\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/EronWright/zookeeper ZOOKEEPER-2982\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/468.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #468\n    \n----\ncommit 4f8f3ce8074b878f2a6e32c15ec177f4dcd050e0\nAuthor: Eron Wright <eron.wright@...>\nDate:   2018-02-19T23:05:44Z\n\n    ZOOKEEPER-2982 Re-try DNS hostname -> IP resolution if node connection fails\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-02-19T23:13:02.822+0000","updated":"2018-02-19T23:13:02.822+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16370631","id":"16370631","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abrahamfine","name":"abrahamfine","key":"abrahamfine","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abraham Fine","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm wondering if  [~rthille] can chime in on this.\r\n\r\nIt looks like the change this JIRA is talking about is referenced by https://issues.apache.org/jira/browse/ZOOKEEPER-1506?focusedCommentId=14711955&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-14711955\r\n\r\nIs there a reason why this change was left out of branch-3.5 (and master)?\r\n\r\nMy guess is that in master and branch-3.5 we always call `recreateSocketAddresses` in `connectOne` which should be called during leader election of communication to another quorum member stops. Again, it would be great to have [~rthille] confirm/tell me how wrong I am.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abrahamfine","name":"abrahamfine","key":"abrahamfine","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abraham Fine","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-20T21:53:41.576+0000","updated":"2018-02-20T22:28:06.970+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16370670","id":"16370670","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user afine commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/468\n  \n    @EronWright I left a comment in the JIRA. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-02-20T22:28:47.499+0000","updated":"2018-02-20T22:28:47.499+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16370676","id":"16370676","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"I can confirm that the fix is effective in my K8s environment.  I discovered the problem while using 3.5.3-beta.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-20T22:32:15.404+0000","updated":"2018-02-20T22:32:15.404+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16370682","id":"16370682","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I don't see a reason why it would be a problem to invoke \\{recreateSocketAddresses} from \\{Learner.findLeader}. That method is simply returning the \\{QuorumServer} instance corresponding to the server it believes to be the leader.\r\n\r\nThe thing that is puzzling is how a server ended up voting for another server that it can't talk to (because the name doesn't resolve). Is it a race that eventually goes away?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2018-02-20T22:36:37.561+0000","updated":"2018-02-20T22:36:37.561+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16370688","id":"16370688","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"Looking at the code a bit, the learner makes a raw socket connection (`connectToLeader` -> `sockConnect`) not involving `QuorumCnxManager`.   Sorry I don't know all the details.   ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-20T22:38:56.277+0000","updated":"2018-02-20T22:38:56.277+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16370690","id":"16370690","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"[~eronwright] a follower invokes followLeader after leader election completes. followLeader makes a call to connectToLeader.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2018-02-20T22:41:10.412+0000","updated":"2018-02-20T22:41:10.412+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16370694","id":"16370694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"Sorry I was just responding to [~abrahamfine] regarding why `connectOne` doesn't cover all cases.\r\n\r\nBased on empirical evidence I think this patch is critical for ZK 3.5.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-20T22:44:47.085+0000","updated":"2018-02-20T22:44:47.085+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16370695","id":"16370695","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"[~eronwright] in your set up, once you get that exception, is it the case that the ensemble never recovers (it is never able to elect a leader)?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2018-02-20T22:45:44.388+0000","updated":"2018-02-20T22:45:44.388+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16370699","id":"16370699","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"[~fpj] that is correct; without the patch, the ensemble never comes online.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-20T22:47:36.396+0000","updated":"2018-02-20T22:47:36.396+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16370708","id":"16370708","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abrahamfine","name":"abrahamfine","key":"abrahamfine","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abraham Fine","active":true,"timeZone":"America/Los_Angeles"},"body":"[~eronwright] I think `connectToLeader` uses the address from `findLeader` which should read the `QuorumVerifier` updated by `recreateSocketAddresses` called in `connectOne`.\r\n\r\nI have a feeling it would be tough, but if you could come up with a test to reproduce the issue you are facing or give us step by step instructions to reproduce (ideally outside of K8s) that would help us confirm the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abrahamfine","name":"abrahamfine","key":"abrahamfine","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abraham Fine","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-20T22:55:54.778+0000","updated":"2018-02-20T22:55:54.778+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16370712","id":"16370712","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"The step-by-step instructions are:\r\n1. configure a three node ensemble (0,1,2).\r\n2. by whatever means, configure 0 such that it cannot resolve the DNS address of 1 and/or 2.   Do likewise for other servers.\r\n3. Start the ensemble, observing the {{UnknownHostException}} as shown in the description.\r\n4. While the servers are running, fix the DNS issue so that the addresses may be resolved.\r\n5. Observe that the exception continues to occur.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-20T23:01:43.700+0000","updated":"2018-02-20T23:01:43.700+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16370721","id":"16370721","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"[~eronwright] could you upload some server logs so that we can have a look, please?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2018-02-20T23:08:20.968+0000","updated":"2018-02-20T23:08:20.968+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16370735","id":"16370735","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"Attached 'fixed.log' which demonstrates the behavior after the fix is applied.   Let me know if you also need to see the output from an unpatched cluster (I would prefer not to spend the time to get that).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-20T23:20:27.217+0000","updated":"2018-02-20T23:20:27.217+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16371425","id":"16371425","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"[~eronwright]\r\n\r\nI've tried this on localhost by adding fake dns names to /etc/hosts like this:\r\n{noformat}\r\n127.0.0.1 one.andor.org\r\n127.0.0.1 two.andor.org\r\n#127.0.0.1 three.andor.org{noformat}\r\nFirst, all of the 3 entries were commented out and I started ZooKeeper nodes with the following server config:\r\n{noformat}\r\nserver.1=one.andor.org:2222:2223\r\nserver.2=two.andor.org:3333:3334\r\nserver.3=three.andor.org:4444:4445\r\n{noformat}\r\nNodes were unable to connect because of the following resolution error:\r\n{noformat}\r\n2018-02-21 14:33:25,509 [myid:1] - WARN [QuorumPeer[myid=1](plain=/0:0:0:0:0:0:0:0:2181)(secure=disabled):QuorumPeer$QuorumServer@172] - Failed to resolve address: two.andor.org\r\njava.net.UnknownHostException: two.andor.org\r\nat java.net.InetAddress.getAllByName0(InetAddress.java:1273)\r\nat java.net.InetAddress.getAllByName(InetAddress.java:1185)\r\nat java.net.InetAddress.getAllByName(InetAddress.java:1119)\r\nat java.net.InetAddress.getByName(InetAddress.java:1069)\r\nat org.apache.zookeeper.server.quorum.QuorumPeer$QuorumServer.recreateSocketAddresses(QuorumPeer.java:170)\r\nat org.apache.zookeeper.server.quorum.QuorumPeer.recreateSocketAddresses(QuorumPeer.java:726)\r\nat org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:686)\r\nat org.apache.zookeeper.server.quorum.QuorumCnxManager.connectAll(QuorumCnxManager.java:720)\r\nat org.apache.zookeeper.server.quorum.FastLeaderElection.lookForLeader(FastLeaderElection.java:919)\r\nat org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:1171){noformat}\r\nSimilar entries are keep repeated in both server logs. As I can see ZK is trying to call recreateSocketAddresses() and tries to re-resolve the address every time it's trying to connect.\r\n\r\nThis is the case _without_ your patch.\r\n\r\nWhen I enabled the entries in /etc/hosts, the following error showed up in the logs:\r\n{noformat}\r\n2018-02-21 14:37:07,178 [myid:1] - WARN [QuorumPeer[myid=1](plain=/0:0:0:0:0:0:0:0:2181)(secure=disabled):QuorumCnxManager@663] - Cannot open channel to 2 at election address two.andor.org/127.0.0.1:3334\r\njava.net.ConnectException: Connection refused (Connection refused)\r\nat java.net.PlainSocketImpl.socketConnect(Native Method)\r\nat java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)\r\nat java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)\r\nat java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)\r\nat java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\r\nat java.net.Socket.connect(Socket.java:580)\r\nat org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:641)\r\nat org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:692)\r\nat org.apache.zookeeper.server.quorum.QuorumCnxManager.connectAll(QuorumCnxManager.java:720)\r\nat org.apache.zookeeper.server.quorum.FastLeaderElection.lookForLeader(FastLeaderElection.java:919)\r\nat org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:1171){noformat}\r\nThe error shows that DNS resolution was successful (127.0.0.1) and the connection issue is different (Connection refused) which might be related to my silly test environment (socket has not been created on the other side), but the key takeaway here is that [~abrahamfine] is probably right and the re-resolution happens properly.\r\n\r\nI repeated the test with your patch too and the results are the same. No difference.\r\n\r\nMaybe I'm missing something and the test might not be relevant at all, but at least it's a little bit confusing.\r\n\r\n[~eronwright]Would you please attach logs running the same ensemble _without_ your patch too?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-02-21T13:53:50.914+0000","updated":"2018-02-21T13:53:50.914+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16371452","id":"16371452","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"From the logs, we can see the same exception being raised when the server is trying to connect to elect a leader:\r\n\r\n{noformat}\r\n2018-02-20 20:41:25,669 [myid:1] - WARN  [QuorumPeer[myid=1](plain=/0:0:0:0:0:0:0:0:2181)(secure=disabled):QuorumPeer$QuorumServer@173] - Failed to resolve address: pravega-zookeeper-2.pravega-zookeeper-headless.default.svc.cluster.local\r\njava.net.UnknownHostException: pravega-zookeeper-2.pravega-zookeeper-headless.default.svc.cluster.local\r\n\tat java.net.InetAddress.getAllByName0(InetAddress.java:1280)\r\n\tat java.net.InetAddress.getAllByName(InetAddress.java:1192)\r\n\tat java.net.InetAddress.getAllByName(InetAddress.java:1126)\r\n\tat java.net.InetAddress.getByName(InetAddress.java:1076)\r\n\tat org.apache.zookeeper.server.quorum.QuorumPeer$QuorumServer.recreateSocketAddresses(QuorumPeer.java:171)\r\n\tat org.apache.zookeeper.server.quorum.QuorumPeer.recreateSocketAddresses(QuorumPeer.java:727)\r\n\tat org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:682)\r\n\tat org.apache.zookeeper.server.quorum.QuorumCnxManager.connectAll(QuorumCnxManager.java:716)\r\n\tat org.apache.zookeeper.server.quorum.FastLeaderElection.lookForLeader(FastLeaderElection.java:919)\r\n\tat org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:1190)\r\n{noformat}\r\n\r\nOnce the address resolves and it can connect, the exception goes away and the notification messages flow regularly. The question is why the update performed during leader election to the quorum view in {{QuorumCnxManager.connectOne}} is not taking any effect in the view that {{Learner.findLeader}} uses to get the `QuorumServer` instance to connect to the leader. Two possibilities I can think of:\r\n\r\n1- The server hasn't connected to the elected server during leader election, in which case the address wasn't updated.\r\n2- The quorum view that the learner is using to get the quorum server instance is not the one that was updated in {{QuorumCnxManager}}.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2018-02-21T14:13:04.689+0000","updated":"2018-02-21T14:13:04.689+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16371727","id":"16371727","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks everyone for your patience.  I've attached a log showing the unpatched behavior (3.5.3-beta).   You'll observe two ongoing exceptions, one from {{QuorumCnxManager}}, the other from {{Learner}}.     Around {{2018-02-21 17:23:36,746}}, the DNS record finally comes up and {{QuorumCnxManager}} recovers whereas {{Learner}} doesn't.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-21T17:38:21.084+0000","updated":"2018-02-21T17:38:21.084+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16371886","id":"16371886","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I think I know what's going on. It is correct that {{connectOne}} invokes {{recreateSocketAddresses}}, but that invocation won't happen in the case that the server receives a connection request rather than starting the connection. In fact, servers with larger ids are always supposed to start the connections.\r\n\r\nI think the patch proposed here of invoking {{recreateSocketAddresses}} in {{findLeader}} in the learner class makes sense to compensate for {{recreateSocketAddresses}} not being invoked during leader election. Any other insight or anything I'm missing?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2018-02-21T19:19:40.942+0000","updated":"2018-02-21T19:19:40.942+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16371943","id":"16371943","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"[~fpj] I think you're right.\r\n\r\nLooking at the logfile that [~eronwright]uploaded recently I see connections are being received from other members of the ensembe on the election port. myid=1 is just unable to initiate due to DNS error and doesn't either give up connection, because not realizing that myid=1 < id of the other connection.\r\n\r\nI believe the ensembe looks like this:\r\n\r\nmyid=1 zookeeper-0.zookeeper-headless.default.svc.cluster.local 10.8.2.14\r\nmyid=2 zookeeper-1.zookeeper-headless.default.svc.cluster.local 10.8.0.6\r\nmyid=3 zookeeper-2.zookeeper-headless.default.svc.cluster.local 10.8.1.7\r\n\r\n \r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-02-21T20:14:38.088+0000","updated":"2018-02-21T20:14:38.088+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16371980","id":"16371980","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"Looks like that sock.connect() in connectToLeader() requires the address to be resolved already.\r\n\r\nIf QuorumCnxnManager() fails to do that, connectToLeader() should be able to detect & fix it by doing resolution explicitly when addr.isUnresolved() == true.\r\n\r\nNot sure if it's any better than doing recreateSocketAddress() in findLeader(), but it may be another option to consider.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-02-21T20:42:20.258+0000","updated":"2018-02-21T20:42:42.634+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16372542","id":"16372542","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I have tried your recipe for reproducing as well [~andorm] by changing {{/etc/hosts}} and got the same issue. The problem is that the leader fails to bind to the port, which actually makes me wonder whether we need to do anything about the leader with respect to this issue:\r\n\r\n{noformat}\r\njava.net.SocketException: Unresolved address\r\n\tat java.net.ServerSocket.bind(ServerSocket.java:368)\r\n\tat java.net.ServerSocket.bind(ServerSocket.java:329)\r\n\tat org.apache.zookeeper.server.quorum.Leader.<init>(Leader.java:240)\r\n\tat org.apache.zookeeper.server.quorum.QuorumPeer.makeLeader(QuorumPeer.java:1023)\r\n\tat org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:1226)\r\n{noformat}\r\n\r\nYour suggestion of the alternative change is sensible, but I'd say that for consistency, it is better that we simply do the same that we have in 3.4, which is to make the change in {{findLeader}}.\r\n\r\nOne thing that I believe we haven't been able to do is to have a test case to report it. It would be good to have it, but I'm not sure what would be a good way.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2018-02-22T08:33:27.969+0000","updated":"2018-02-22T08:33:54.705+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16373047","id":"16373047","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"[~fpj] Sounds reasonable to me.\r\n\r\nI'll think about how to test this and will let you know when I can come up with something. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-02-22T16:42:39.313+0000","updated":"2018-02-22T16:42:39.313+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16375152","id":"16375152","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"[~fpj] ready to merge this fix?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-24T00:08:07.911+0000","updated":"2018-02-24T00:08:07.911+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16375213","id":"16375213","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abrahamfine","name":"abrahamfine","key":"abrahamfine","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abraham Fine","active":true,"timeZone":"America/Los_Angeles"},"body":"[~fpj] I believe your diagnosis to be correct and I agree that [~eronwright]'s fix would solve the problem in the case that DNS eventually is fixed. My concern with the current solution is that it could cause us to jump back and forth between leader election and the quorum when the DNS stays in a bad state. For example, imagine a 3 node cluster {z1, z2, z3}. z3 is always offline and z2 has no entry in dns. z2 will connect to z1 and win the leader election. When it comes time to form the quorum z1 will be unable to follow z2 as it wont be able to resolve its address.\r\n\r\nJust spitballing here, but what if we had z1 connect to the {{remoteSocketAddress}} of the socket created from the connection it received in {{QuorumCnxManager}}? I understand there are some security concerns here and I'm not sure how much we care about that since they would be cured by Kerberos or TLS (one day). We could also do a reverse dns lookup and reject the connection if the reverse lookup does not align with our expected hostname. \r\n\r\nWhat do you guys think?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abrahamfine","name":"abrahamfine","key":"abrahamfine","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abraham Fine","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-24T01:38:34.051+0000","updated":"2018-02-24T01:42:41.033+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16377219","id":"16377219","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"My humble opinion is that there's no risk in taking this patch as-is, since it fixes a regression.   Improvements could be made from there, on their own strength.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-26T17:35:42.883+0000","updated":"2018-02-26T17:35:42.883+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16393254","id":"16393254","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"[~andorm] are you driving this issue now?   Would you please assign the bug appropriately?\r\n\r\nI'm keen to see the patch make it into 3.5.4.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-03-09T17:40:38.747+0000","updated":"2018-03-09T17:40:48.731+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16397477","id":"16397477","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"[~abrahamfine] are you OK with accepting this patch as-is for now?  This would fix the regression between 3.4 and 3.5.  Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-03-13T19:04:33.985+0000","updated":"2018-03-13T19:04:33.985+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16398500","id":"16398500","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"hey guys, here are some comments based on the latest points:\r\n\r\n[~abrahamfine] the improvement you are proposing requires further discussion. for one thing, the user has told us to use names and now we are trying to second-guess how to connect to the server. I'm not saying this is necessarily a bad idea, but I feel it needs to be addressed separately. I think we should go for now with the fix that [~eronwright] is proposing as it fixes an issue with the port.\r\n\r\n[~andorm] do you think you will be able to come up with a test case? To recap, I think we need to test that we are able to resolve names correctly despite changes in the mapping of name to address. I'm not sure what a good way of testing it would be.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2018-03-14T12:30:34.204+0000","updated":"2018-03-14T12:30:34.204+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16439848","id":"16439848","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"Are we ready to accept this patch yet?   ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-04-16T18:34:03.438+0000","updated":"2018-04-16T18:34:03.438+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16448996","id":"16448996","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"[~fpj] would you please assign this issue to someone and clarify what your expectations are? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-04-23T22:53:06.359+0000","updated":"2018-04-23T22:53:06.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16460772","id":"16460772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abalur","name":"abalur","key":"abalur","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhin Balur","active":true,"timeZone":"Etc/UTC"},"body":"Can someone please comment on whether this is getting merged in 3.5.4?? When is 3.5.4 expected?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abalur","name":"abalur","key":"abalur","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhin Balur","active":true,"timeZone":"Etc/UTC"},"created":"2018-05-02T09:27:50.572+0000","updated":"2018-05-02T09:27:50.572+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16467049","id":"16467049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Based on this comment, I'm +1 from this change:\r\n\r\nhttps://issues.apache.org/jira/browse/ZOOKEEPER-2982?focusedCommentId=16371886&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16371886\r\n\r\nIt would have been good to have a test case, but we haven't been able to come up with anything, so I suggest we leave it for future work. We also have a +1 from [~andorm] in the pull request.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2018-05-08T08:10:45.770+0000","updated":"2018-05-08T08:10:45.770+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16468019","id":"16468019","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +0 tests included.  The patch appears to be a documentation patch that doesn't require tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1665//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1665//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1665//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2018-05-08T22:02:33.790+0000","updated":"2018-05-08T22:02:33.790+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16468044","id":"16468044","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"body":"Note that I opened two PRs - one for {{branch-3.5}} and the other for {{master}} branch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eronwright","name":"eronwright","key":"eronwright","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Eron Wright ","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-05-08T22:21:25.698+0000","updated":"2018-05-08T22:21:25.698+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16468083","id":"16468083","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Issue resolved by pull request 513\n[https://github.com/apache/zookeeper/pull/513]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2018-05-08T22:57:31.287+0000","updated":"2018-05-08T22:57:31.287+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13139513/comment/16468194","id":"16468194","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Jenkins build ZooKeeper-trunk #15 (See [https://builds.apache.org/job/ZooKeeper-trunk/15/])\nZOOKEEPER-2982: Re-try DNS hostname -> IP resolution if node connection (fpj: rev b1f6279a8c4708d1df7dd1128dc4fdf41fc7e24a)\n* (edit) src/java/main/org/apache/zookeeper/server/quorum/Learner.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2018-05-09T01:05:42.624+0000","updated":"2018-05-09T01:05:42.624+0000"}],"maxResults":37,"total":37,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2982/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3qcrj:"}}