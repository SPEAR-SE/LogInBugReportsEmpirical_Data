{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12517940","self":"https://issues.apache.org/jira/rest/api/2/issue/12517940","key":"ZOOKEEPER-1146","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314469","id":"12314469","description":"Kerberos client auth, multi support, deb/rpm pkging.","name":"3.4.0","archived":false,"released":true,"releaseDate":"2011-11-22"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-08-07T05:58:35.409+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Sep 08 05:19:16 UTC 2011","customfield_12310420":"3976","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_848191756_*|*_1_*:*_1_*:*_16393419_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-08-14T17:30:58.715+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1146/watchers","watchCount":1,"isWatching":false},"created":"2011-08-04T17:21:13.579+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314469","id":"12314469","description":"Kerberos client auth, multi support, deb/rpm pkging.","name":"3.4.0","archived":false,"released":true,"releaseDate":"2011-11-22"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-11-23T19:22:40.681+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312380","id":"12312380","name":"c client","description":"The c client interface to ZooKeeper"}],"timeoriginalestimate":null,"description":"I tried running my latency tester against trunk, in so doing I noticed that the C/Python (not sure which yet) client performance has seriously degraded since 3.3.3.\n\nThe first run (below) is with released 3.3.3 client against a 3 server ensemble running released 3.3.3 server code. The second run is the exact same environment (same ensemble), however using trunk c/zkpython client.\n\nNotice:\n\n1) in the first run operations are approx 10ms/write, 0.25ms/read - which is pretty much what's expected.\n\n2) however in the second run we are seeing 50ms/operation regardless of read or write.\n\n{noformat}\n[phunt@c0309 zk-smoketest-3.3.3]$ PYTHONPATH=lib.linux-x86_64-2.6/ LD_LIBRARY_PATH=lib.linux-x86_64-2.6/ python26 ./zk-latencies.py --servers \"c0309:2181,c0310:2181,c0311:2181\" --znode_size=100 --znode_count=100 --timeout=5000 --synchronous\nConnecting to c0309:2181\nConnected in 16 ms, handle is 0\nConnecting to c0310:2181\nConnected in 16 ms, handle is 1\nConnecting to c0311:2181\nConnected in 15 ms, handle is 2\nTesting latencies on server c0309:2181 using syncronous calls\ncreated     100 permanent znodes  in    959 ms (9.599378 ms/op 104.173415/sec)\nset         100           znodes  in    933 ms (9.332101 ms/op 107.157002/sec)\nget         100           znodes  in     27 ms (0.270889 ms/op 3691.551589/sec)\ndeleted     100 permanent znodes  in    881 ms (8.812950 ms/op 113.469388/sec)\ncreated     100 ephemeral znodes  in    956 ms (9.564152 ms/op 104.557103/sec)\nwatched     100           znodes  in     26 ms (0.264361 ms/op 3782.707587/sec)\ndeleted     100 ephemeral znodes  in    881 ms (8.819292 ms/op 113.387792/sec)\nnotif       100           watches in    999 ms (9.994299 ms/op 100.057038/sec)\nTesting latencies on server c0310:2181 using syncronous calls\ncreated     100 permanent znodes  in    964 ms (9.640460 ms/op 103.729490/sec)\nset         100           znodes  in    933 ms (9.332800 ms/op 107.148981/sec)\nget         100           znodes  in     29 ms (0.299308 ms/op 3341.036650/sec)\ndeleted     100 permanent znodes  in    886 ms (8.864651 ms/op 112.807603/sec)\ncreated     100 ephemeral znodes  in    958 ms (9.585140 ms/op 104.328161/sec)\nwatched     100           znodes  in     30 ms (0.300801 ms/op 3324.459240/sec)\ndeleted     100 ephemeral znodes  in    886 ms (8.865030 ms/op 112.802779/sec)\nnotif       100           watches in   1000 ms (10.000212 ms/op 99.997878/sec)\nTesting latencies on server c0311:2181 using syncronous calls\ncreated     100 permanent znodes  in    958 ms (9.582071 ms/op 104.361569/sec)\nset         100           znodes  in    935 ms (9.359350 ms/op 106.845024/sec)\nget         100           znodes  in     25 ms (0.252700 ms/op 3957.263893/sec)\ndeleted     100 permanent znodes  in    891 ms (8.913291 ms/op 112.192013/sec)\ncreated     100 ephemeral znodes  in    958 ms (9.584489 ms/op 104.335246/sec)\nwatched     100           znodes  in     25 ms (0.251091 ms/op 3982.627356/sec)\ndeleted     100 ephemeral znodes  in    891 ms (8.915379 ms/op 112.165730/sec)\nnotif       100           watches in   1000 ms (10.000508 ms/op 99.994922/sec)\nLatency test complete\n[phunt@c0309 zk-smoketest-3.3.3]$ cd ../zk-smoketest-trunk/\n[phunt@c0309 zk-smoketest-trunk]$ PYTHONPATH=lib.linux-x86_64-2.6/ LD_LIBRARY_PATH=lib.linux-x86_64-2.6/ python26 ./zk-latencies.py --servers \"c0309:2181,c0310:2181,c0311:2181\" --znode_size=100 --znode_count=100 --timeout=5000 --synchronous\nConnecting to c0309:2181\nConnected in 31 ms, handle is 0\nConnecting to c0310:2181\nConnected in 16 ms, handle is 1\nConnecting to c0311:2181\nConnected in 16 ms, handle is 2\nTesting latencies on server c0309:2181 using syncronous calls\ncreated     100 permanent znodes  in   5099 ms (50.999281 ms/op 19.608119/sec)\nset         100           znodes  in   5066 ms (50.665429 ms/op 19.737324/sec)\nget         100           znodes  in   4009 ms (40.093150 ms/op 24.941916/sec)\ndeleted     100 permanent znodes  in   5040 ms (50.404449 ms/op 19.839519/sec)\ncreated     100 ephemeral znodes  in   5124 ms (51.249170 ms/op 19.512511/sec)\nwatched     100           znodes  in   4051 ms (40.514441 ms/op 24.682557/sec)\ndeleted     100 ephemeral znodes  in   5048 ms (50.484939 ms/op 19.807888/sec)\nnotif       100           watches in   1000 ms (10.004182 ms/op 99.958199/sec)\nTesting latencies on server c0310:2181 using syncronous calls\ncreated     100 permanent znodes  in   5115 ms (51.157510 ms/op 19.547472/sec)\nset         100           znodes  in   5056 ms (50.568910 ms/op 19.774996/sec)\nget         100           znodes  in   4099 ms (40.999382 ms/op 24.390612/sec)\ndeleted     100 permanent znodes  in   5041 ms (50.418010 ms/op 19.834182/sec)\ncreated     100 ephemeral znodes  in   5083 ms (50.835850 ms/op 19.671157/sec)\nwatched     100           znodes  in   4100 ms (41.003261 ms/op 24.388304/sec)\ndeleted     100 ephemeral znodes  in   5058 ms (50.581930 ms/op 19.769906/sec)\nnotif       100           watches in   1000 ms (10.005081 ms/op 99.949219/sec)\nTesting latencies on server c0311:2181 using syncronous calls\ncreated     100 permanent znodes  in   5099 ms (50.992720 ms/op 19.610642/sec)\nset         100           znodes  in   5091 ms (50.916569 ms/op 19.639972/sec)\nget         100           znodes  in   4099 ms (40.996401 ms/op 24.392385/sec)\ndeleted     100 permanent znodes  in   5066 ms (50.669601 ms/op 19.735699/sec)\ncreated     100 ephemeral znodes  in   5124 ms (51.249208 ms/op 19.512496/sec)\nwatched     100           znodes  in   4099 ms (40.999141 ms/op 24.390755/sec)\ndeleted     100 ephemeral znodes  in   5049 ms (50.498819 ms/op 19.802443/sec)\nnotif       100           watches in    999 ms (9.997852 ms/op 100.021486/sec)\nLatency test complete\n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12489411","id":"12489411","filename":"ZOOKEEPER-1146.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-08-04T21:54:20.113+0000","size":1218,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12489411/ZOOKEEPER-1146.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"32691","customfield_12312823":null,"summary":"significant regression in client (c/python) performance","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12517940/comment/13079512","id":"13079512","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"I reviewed all the changes that went into zkpython btw 3.3.3 and current trunk, I don't see anything that would account for this. Fairly certain this must be a c client change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-08-04T18:24:49.002+0000","updated":"2011-08-04T18:24:49.002+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12517940/comment/13079532","id":"13079532","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"I've narrowed this down to the following commit:\n\nZOOKEEPER-992. MT Native Version of Windows C Client (Dheeraj Agrawal via michim)\n\nprior to this 10ms/op, subsequent to this patch 50ms/op.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-08-04T18:59:58.561+0000","updated":"2011-08-04T18:59:58.561+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12517940/comment/13079609","id":"13079609","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"turns out this change is responsible:\n\n{noformat}\n-            setsockopt(zh->fd, IPPROTO_TCP, TCP_NODELAY, &on, sizeof(int));\n+            setsockopt(zh->fd, IPPROTO_TCP, TCP_NODELAY, &on, sizeof(char));\n{noformat}\n\nsetsockopt is returning -1 after this change (failed to set). Without this change the performance is as expected.\n\nI'll craft a patch or this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-08-04T21:29:36.442+0000","updated":"2011-08-04T21:29:36.442+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12517940/comment/13079626","id":"13079626","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"This patch fixes the issue on Linux and also logs a WARNING if it fails.\n\nI believe this will compile/test successfully on win32 but I'm not sure as I don't have a setup to test it (although I did look at the docs and afaict it should work). Would be good for someone on the win32 side to verify.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-08-04T21:54:20.153+0000","updated":"2011-08-04T21:54:20.153+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12517940/comment/13080544","id":"13080544","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 looks good. great job tracking it down pat!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-08-07T05:58:35.409+0000","updated":"2011-08-07T05:58:35.409+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12517940/comment/13080604","id":"13080604","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fournc","name":"fournc","key":"fournc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Camille Fournier","active":true,"timeZone":"Etc/UTC"},"body":"I'll have Dheeraj take a look at this in win32 next week and make sure it all checks out.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fournc","name":"fournc","key":"fournc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Camille Fournier","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-07T17:18:22.561+0000","updated":"2011-08-07T17:18:22.561+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12517940/comment/13082398","id":"13082398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dheerajagrawal","name":"dheerajagrawal","key":"dheerajagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dheeraj Agrawal","active":true,"timeZone":"Etc/UTC"},"body":"tested this on windows and dont see any issues. Thanks Patrick ...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dheerajagrawal","name":"dheerajagrawal","key":"dheerajagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dheeraj Agrawal","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-10T15:27:13.567+0000","updated":"2011-08-10T15:27:13.567+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12517940/comment/13082636","id":"13082636","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12489411/ZOOKEEPER-1146.patch\n  against trunk revision 1152141.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/433//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/433//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/433//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-10T20:06:01.694+0000","updated":"2011-08-10T20:06:01.694+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12517940/comment/13082887","id":"13082887","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12489411/ZOOKEEPER-1146.patch\n  against trunk revision 1152141.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/439//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/439//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/439//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-11T03:44:50.573+0000","updated":"2011-08-11T03:44:50.573+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12517940/comment/13084868","id":"13084868","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"body":"I just pushed this. thanks pat!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-14T17:30:58.724+0000","updated":"2011-08-14T17:30:58.724+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12517940/comment/13085024","id":"13085024","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in ZooKeeper-trunk #1266 (See [https://builds.apache.org/job/ZooKeeper-trunk/1266/])\n    ZOOKEEPER-1146. significant regression in client (c/python) performance. (phunt via mahadev)\n\nmahadev : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1157574\nFiles : \n* /zookeeper/trunk/src/c/src/zookeeper.c\n* /zookeeper/trunk/CHANGES.txt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2011-08-15T10:55:24.496+0000","updated":"2011-08-15T10:55:24.496+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12517940/comment/13098562","id":"13098562","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brofield","name":"brofield","key":"brofield","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brodie Thiesfield","active":true,"timeZone":"Etc/UTC"},"body":"This fix is incorrect, Windows uses an int not a char for this socket option, just like the rest of the world. \n\nRef: http://msdn.microsoft.com/en-us/library/ms740476%28v=vs.85%29.aspx\nlevel = IPPROTO_TCP\nValue\tType\tDescription\nTCP_NODELAY\tBOOL\tDisables the Nagle algorithm for send coalescing.\n\nSo what is a \"BOOL\"? \nhttp://msdn.microsoft.com/en-us/library/aa383751%28v=vs.85%29.aspx\nBOOL\t\nA Boolean variable (should be TRUE or FALSE).\nThis type is declared in WinDef.h as follows:\ntypedef int BOOL;\n\n\nThe fix should be changed from an ifdef on WIN32 to just the int...\n\n   int enable_tcp_nodelay = 1;\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brofield","name":"brofield","key":"brofield","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brodie Thiesfield","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-07T02:57:12.611+0000","updated":"2011-09-07T02:57:12.611+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12517940/comment/13099063","id":"13099063","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dheerajagrawal","name":"dheerajagrawal","key":"dheerajagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dheeraj Agrawal","active":true,"timeZone":"Etc/UTC"},"body":"Yes, we can use it as int. Although while testing on windows, it didn't return an error code, which i would have expected, if there were any issues.\n\nIf we change this to int for both unix/windows, we will need to change the setsockopt and have ifdef around it to avoid warnings. Optval is char* for windows, so we will need a cast to (char*) around the optval.\n\nint setsockopt(int s, int level, int optname, const void *optval, socklen_t optlen); \nint setsockopt(\n  __in  SOCKET s,\n  __in  int level,\n  __in  int optname,\n  __in  const char *optval,\n  __in  int optlen\n);\n\nsetsockopt(zh->fd, IPPROTO_TCP, TCP_NODELAY, (char*) &on, sizeof(int));\n\nCan you submit a patch for this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dheerajagrawal","name":"dheerajagrawal","key":"dheerajagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dheeraj Agrawal","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-07T16:08:29.203+0000","updated":"2011-09-07T16:08:29.203+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12517940/comment/13100020","id":"13100020","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Please create a new jira and attach the patch to that - thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-08T05:19:16.982+0000","updated":"2011-09-08T05:19:16.982+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1146/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i05yin:"}}