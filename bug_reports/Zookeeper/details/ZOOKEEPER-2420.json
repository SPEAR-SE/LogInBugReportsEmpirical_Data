{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12964204","self":"https://issues.apache.org/jira/rest/api/2/issue/12964204","key":"ZOOKEEPER-2420","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2016-05-03T13:22:04.375+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Nov 18 07:11:34 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2083467756_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_15203592218","customfield_12312321":null,"resolutiondate":"2016-11-18T07:11:34.135+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2420/watchers","watchCount":7,"isWatching":false},"created":"2016-05-02T05:13:54.386+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12486897","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12486897","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"13003962","key":"ZOOKEEPER-2574","self":"https://issues.apache.org/jira/rest/api/2/issue/13003962","fields":{"summary":"PurgeTxnLog can inadvertently delete required txn log files","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-11-18T07:39:33.090+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"Autopurge retains all log files whose zxid are >= the zxid of the oldest snapshot file that it is going to retain (in PurgeTxnLog retainNRecentSnapshots()). However, unless there is a log file with the same zxid as the oldest snapshot file being retained (and whether log file and snapshot file zxids are equal is timing dependent), loading the database from snapshots/logs will start with the log file _prior_ to the snapshot's zxid. Thus, to avoid data loss autopurge should retain the log file prior to the oldest retained snapshot as well, unless it verifies that it contains no zxids beyond what the snapshot contains or there is a log file whose zxid == snapshot zxid.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12803766","id":"12803766","filename":"ZOOKEEPER-2420.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-12T23:45:44.393+0000","size":9467,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12803766/ZOOKEEPER-2420.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12806090","id":"12806090","filename":"ZOOKEEPER-2420.patch_v2","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-25T09:03:04.615+0000","size":13880,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12806090/ZOOKEEPER-2420.patch_v2"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12806310","id":"12806310","filename":"ZOOKEEPER-2420.patch_v3","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-26T07:56:57.252+0000","size":16315,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12806310/ZOOKEEPER-2420.patch_v3"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Autopurge deletes log file prior to oldest retained snapshot even though restore may need it","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15268693","id":"15268693","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arshad.mohammad","name":"arshad.mohammad","key":"arshad.mohammad","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Mohammad Arshad","active":true,"timeZone":"Asia/Singapore"},"body":"Very important issue, it leads to data loss. Thanks [~EdRowe] for reporting it. are u willing to submit a patch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arshad.mohammad","name":"arshad.mohammad","key":"arshad.mohammad","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Mohammad Arshad","active":true,"timeZone":"Asia/Singapore"},"created":"2016-05-03T13:22:04.375+0000","updated":"2016-05-03T13:22:04.375+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15270317","id":"15270317","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"body":"Sure. I won't be able to get to it for a few days but I can put something together.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-04T08:33:04.366+0000","updated":"2016-05-04T08:33:04.366+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15283034","id":"15283034","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"body":"I've posted a patch for review. Please have a look.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-13T19:17:28.194+0000","updated":"2016-05-13T19:17:28.194+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15284878","id":"15284878","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"Hi [~EdRowe], thanks for the patch! \nretainNRecentSnapshots will miss an edge case because the current selection logic rely on a filter like this:\n{code:title=retainNRecentSnapshots.java|borderStyle=solid}\nFile snapShot = snaps.get(snaps.size() -1);\n        final long leastZxidToBeRetain = Util.getZxidFromName(\n                snapShot.getName(), PREFIX_SNAPSHOT);\n\n        class MyFileFilter implements FileFilter{\n            private final String prefix;\n            MyFileFilter(String prefix){\n                this.prefix=prefix;\n            }\n            public boolean accept(File f){\n                if(!f.getName().startsWith(prefix + \".\"))\n                    return false;\n                long fZxid = Util.getZxidFromName(f.getName(), prefix);\n                if (fZxid >= leastZxidToBeRetain) {\n                    return false;\n                }\n                return true;\n            }\n        }\n{code}\nThis logic will miss one case when the zxid we need to retain is contained in a transaction log file whose name (fZxid here) is smaller than leastZxidToBeRetain. This log file is the 'prior' log file you mentioned.\n\nLooking more around in the code, I think we already have a method that we can use to safely pick up the list of transaction log files we are about to retain:\n{code:title=FileTxnLog.java.java|borderStyle=solid}\n    /**\n     * Find the log file that starts at, or just before, the snapshot. Return\n     * this and all subsequent logs. Results are ordered by zxid of file,\n     * ascending order.\n     * @param logDirList array of files\n     * @param snapshotZxid return files at, or before this zxid\n     * @return\n     */\n    public static File[] getLogFiles(File[] logDirList,long snapshotZxid) {\n        List<File> files = Util.sortDataDir(logDirList, \"log\", true);\n        long logZxid = 0;\n        // Find the log file that starts before or at the same time as the\n        // zxid of the snapshot\n        for (File f : files) {\n            long fzxid = Util.getZxidFromName(f.getName(), \"log\");\n            if (fzxid > snapshotZxid) {\n                continue;\n            }\n            // the files\n            // are sorted with zxid's\n            if (fzxid > logZxid) {\n                logZxid = fzxid;\n            }\n        }\n        List<File> v=new ArrayList<File>(5);\n        for (File f : files) {\n            long fzxid = Util.getZxidFromName(f.getName(), \"log\");\n            if (fzxid < logZxid) {\n                continue;\n            }\n            v.add(f);\n        }\n        return v.toArray(new File[0]);\n\n    }\n{code}\n\nThis method essentially returns the full list of transaction log files a given snapshot depends on for recovery purpose. How about we remove the filter in retainNRecentSnapshots and use this method instead? What do you think about this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2016-05-16T17:28:22.830+0000","updated":"2016-05-16T17:28:22.830+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15290613","id":"15290613","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Michael. I'm looking into your suggestion. In the process I think I've discovered another bug. Stay tuned.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-19T07:22:29.631+0000","updated":"2016-05-19T07:22:29.631+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15299714","id":"15299714","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"body":"New patch uploaded. [~hanm] as you suggested I am now using FileTxnLog.getLogFiles() to find the zxid of the oldest log file we need to retain. This change keeps the logic about \"prior logs\" confined to getLogFiles() which is definitely cleaner. I did not remove the filter or the comparison by zxid because it is required to prevent incorrectly deleting new snapshots/logs in a race condition - I added a comment in the new patch to discuss this case. I also refactored/renamed retainNRecentSnapshots() -> purgeOlderSnapshots() and changed it to take a single snapshot file rather than a list because it makes the interface cleaner and more obvious (the list was solely used to provide the oldest snapshot).\n\nAs part of this patch I also fixed a bug in FileSnap.findNRecentSnapshots() - if there were fewer than n snapshots available then it would also return log files.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-25T09:09:53.943+0000","updated":"2016-05-25T09:09:53.943+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15301216","id":"15301216","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"Hi [~EdRowe]. The v2 patch LGTM. A few more comments:\n\nL184: Good finding and fix on the bug in findNRecentSnapshots. Do you think if it's easy to add a test that explicitly cover the bug you fixed?\n\nL189: (nit) missing spaces around '=='. This is not introduced in your patch, but since you are here we may just fix it so it's consistent with rest of code base :)\n\nL355-356 : Should we revise the comment by adding one case, so it looks like: \"get the snapshot logs that are greater than, or equal to, or just before the given zxid' ?\n\nAlso FYI, after you uploaded a new patch, you can click the \"Submit Patch\" patch in the JIRA issue, this will change the JIRA status to \"Patch Available\" (some folks may monitoring that list to pick items to review), also it will trigger pre-commit builds that will apply your patch and run tests. \n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2016-05-26T00:42:26.506+0000","updated":"2016-05-26T00:42:26.506+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15301716","id":"15301716","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"body":"v3 patch uploaded. [~hanm] it adds the test (augments existing test for findNRecentSnapshots), fixes the == and revises the comment as you suggested.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-26T07:58:01.232+0000","updated":"2016-05-26T07:58:01.232+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15302318","id":"15302318","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"+1 on v3 patch. Thanks [~EdRowe]!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2016-05-26T16:08:59.944+0000","updated":"2016-05-26T16:08:59.944+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15311345","id":"15311345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Hm. I'm trying to understand why is this just showing up now, given the severity of the problem (fwiw I believe we should make this a blocker). iirc this code has been in place forever, even before \"autopurge\" existed - it was used for the external \"clean\" mechanism. It seems unusual that this is just cropping up now - why?\n\nOne reason I can think of, is it related to the fact that sending of diffs was fixed around 3.4.(6?) timeframe? ([~fpj]?)\n\nDoes the test fail w/o the fix? In the sense, does the test recreate the situation you are trying fix in this jira.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-06-01T23:24:55.595+0000","updated":"2016-06-01T23:24:55.595+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15311349","id":"15311349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"ps. please follow the naming convention for patches defined in htc: https://cwiki.apache.org/confluence/display/ZOOKEEPER/HowToContribute as it simplifies downloading/review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-06-01T23:28:21.217+0000","updated":"2016-06-01T23:28:21.217+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15311816","id":"15311816","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"body":"My original description was not 100% accurate - I've updated it to point out that loading the DB from logs actually only looks at a prior log if there isn't a log with the same zxid as the snapshot. However, whether there is equivalency between log zxid and snapshot zxid is timing dependent so the == case at best reduces occurrences of the bug.\n\nI'm not sure why this issue hasn't been found before now. I discovered it by reading the code and then empirically reproduced it. \n\nThe patch adds new test case testSnapFilesEqualsToRetainWithPrecedingLog to test this specific case in isolation, and updates existing test cases testSnapFilesGreaterThanToRetain and testSnapFilesLessThanToRetain (all in PurgeTxnTest.java) to test the corrected behavior. If these new/updated tests are run against the original code (modulo the refactoring I did in the patch) they will all fail. \n\nRe: patch naming convention for updated patches - I hadn't noticed that. Will follow it in the future.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=EdRowe","name":"EdRowe","key":"edrowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ed Rowe","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-06-02T06:27:48.854+0000","updated":"2016-06-02T06:27:48.854+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15313099","id":"15313099","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I'm not saying we shouldn't fix this, in fact, [~EdRowe] has been doing a pretty good job at spotting corner cases with the snapshot/txn log code. However, in most cases, the snapshot that matters is the latest and not the oldest, so even if we screw up with respect to the oldest, we will very likely have all txn logs to make it work. I'm clearly putting aside the issue described in ZOOKEEPER-1549, which is the king of the blockers for me. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-06-02T21:26:25.692+0000","updated":"2016-06-02T21:26:25.692+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15313124","id":"15313124","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"bq. However, in most cases, the snapshot that matters is the latest and not the oldest, so even if we screw up with respect to the oldest, we will very likely have all txn logs to make it work.\nMy guess is in practice production clusters usually retain more than one snapshot; otherwise, with one snapshot it's both the old and the new one, which might make the issue easier to appear.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2016-06-02T21:39:23.903+0000","updated":"2016-06-02T21:39:23.903+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15313185","id":"15313185","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"My recollection is that the minimum is a value greater than 1, I think it is 3.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-06-02T22:13:04.564+0000","updated":"2016-06-02T22:13:04.564+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15313341","id":"15313341","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"Yes it's 3 and restore only uses the latest snapshot.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2016-06-02T23:56:08.249+0000","updated":"2016-06-02T23:56:08.249+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15331098","id":"15331098","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Agree - kudos Ed!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-06-15T03:54:44.137+0000","updated":"2016-06-15T03:54:44.137+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15662891","id":"15662891","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~EdRowe] for the good work.\n\nHi All,  \n\nLike [~hanm] pointed out, both this jira and ZOOKEEPER-2574 are addressing same case. Could you please look at [my comments in ZK-2574 jira|https://issues.apache.org/jira/browse/ZOOKEEPER-2574?focusedCommentId=15662873&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15662873] and let me know your thoughts. Based on your feedback will take an action. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-11-14T06:13:06.893+0000","updated":"2016-11-14T06:13:06.893+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15662934","id":"15662934","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12806310/ZOOKEEPER-2420.patch_v3\n  against trunk revision 73e102a58d01b27bc6208bbfbde2d12f0deba1f4.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    -1 findbugs.  The patch appears to introduce 20 new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3532//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3532//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3532//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-14T06:32:52.362+0000","updated":"2016-11-14T06:32:52.362+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12964204/comment/15676003","id":"15676003","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"Closing this JIRA and use ZOOKEEPER-2574 where discussions are more active to track the fix. Thanks for [~erowe]'s contribution on the discussions and patches here - will integrate part of the work into ZOOKEEPER-2574.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2016-11-18T07:11:34.281+0000","updated":"2016-11-18T07:11:34.281+0000"}],"maxResults":20,"total":20,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2420/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2x0xb:"}}