{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13142067","self":"https://issues.apache.org/jira/rest/api/2/issue/13142067","key":"ZOOKEEPER-2991","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon May 07 07:57:28 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2991/watchers","watchCount":1,"isWatching":false},"created":"2018-03-02T10:45:33.718+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12338036","id":"12338036","description":"Fix release against 3.4 branch","name":"3.4.10","archived":false,"released":true,"releaseDate":"2017-03-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12339207","id":"12339207","description":"Fix release against 3.4 branch","name":"3.4.11","archived":false,"released":true,"releaseDate":"2017-11-09"}],"issuelinks":[{"id":"12533442","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12533442","type":{"id":"12310060","name":"Container","inward":"Is contained by","outward":"contains","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310060"},"outwardIssue":{"id":"13075866","key":"ZOOKEEPER-2795","self":"https://issues.apache.org/jira/rest/api/2/issue/13075866","fields":{"summary":"Change log level for \"ZKShutdownHandler is not registered\" error message","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/5","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/trivial.svg","name":"Trivial","id":"5"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/5","id":"5","description":"General wishlist item.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Wish","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-05-07T07:57:28.704+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"Commit d497aac4 introduced the ZooKeeperServer#registerServerShutdownHandler method and corresponding ZooKeeperServerShutdownHandler class.  Both the method and class are package-protected, resulting in the expectation that non-ZK code should not use either.\r\n\r\nHowever, if registerServerShutdownHandler is *not* called, then ZK will log an error:\r\n{quote}ZKShutdownHandler is not registered, so ZooKeeper server won't take any action on ERROR or SHUTDOWN server state changes\r\n{quote}\r\nThere are several problems here.  In order of importance (for me, at least!)\r\n\r\nFirst, (most important) this certainly should not be logged as an error.  Depending on usage, there may be no need for a shutdown handler.  Always logging an error (with no opportunity to silence it) is therefore wrong.\r\n\r\nSecond, the ability to learn of state changes may be of general interest (monitoring, etc); however, this is not possible if the method is protected.\r\n\r\nThird, the method accepts a concrete class that is designed to use a CountDownLatch. This is not appropriate in all cases.  The method should be updated to accept an interface.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Server logs error on shutdown","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulmillar","name":"paulmillar","key":"paulmillar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=paulmillar&avatarId=35857","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paulmillar&avatarId=35857","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paulmillar&avatarId=35857","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paulmillar&avatarId=35857"},"displayName":"Paul Millar","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulmillar","name":"paulmillar","key":"paulmillar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=paulmillar&avatarId=35857","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paulmillar&avatarId=35857","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paulmillar&avatarId=35857","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paulmillar&avatarId=35857"},"displayName":"Paul Millar","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13142067/comment/16465582","id":"16465582","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulmillar","name":"paulmillar","key":"paulmillar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=paulmillar&avatarId=35857","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paulmillar&avatarId=35857","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paulmillar&avatarId=35857","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paulmillar&avatarId=35857"},"displayName":"Paul Millar","active":true,"timeZone":"Europe/Berlin"},"body":"ZOOKEEPER-2795 is almost the same as this bug report","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulmillar","name":"paulmillar","key":"paulmillar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=paulmillar&avatarId=35857","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paulmillar&avatarId=35857","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paulmillar&avatarId=35857","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paulmillar&avatarId=35857"},"displayName":"Paul Millar","active":true,"timeZone":"Europe/Berlin"},"created":"2018-05-07T07:57:28.704+0000","updated":"2018-05-07T07:57:28.704+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2991/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3qsgn:"}}