{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12720291","self":"https://issues.apache.org/jira/rest/api/2/issue/12720291","key":"ZOOKEEPER-1936","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326518","id":"12326518","name":"3.6.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12343268","id":"12343268","description":"Beta release against 3.5 branch","name":"3.5.5","archived":false,"released":false}],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-08-20T18:24:07.376+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon May 29 14:14:51 UTC 2017","customfield_12310420":"398490","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1936/watchers","watchCount":16,"isWatching":false},"created":"2014-06-10T07:25:37.326+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"7.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323310","id":"12323310","description":"Fix release against 3.4 branch","name":"3.4.6","archived":false,"released":true,"releaseDate":"2014-03-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316644","id":"12316644","description":"Dynamic Reconfig, Remove Watches, Local Session","name":"3.5.0","archived":false,"released":true,"releaseDate":"2014-08-04"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-05-10T20:09:32.729+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"We sometime see issues with ZooKeeper server not starting and seeing this error in the log:\n\n\n[2014-05-27 09:29:48.248] ERROR   : -               \n.org.apache.zookeeper.server.ZooKeeperServerMain    Unexpected exception,\nexiting abnormally\\nexception=\\njava.io.IOException: Unable to create data\ndirectory /home/y/var/zookeeper/version-2\\n\\tat\norg.apache.zookeeper.server.persistence.FileTxnSnapLog.<init>(FileTxnSnapLog.java:85)\\n\\tat\norg.apache.zookeeper.server.ZooKeeperServerMain.runFromConfig(ZooKeeperServerMain.java:103)\\n\\tat\norg.apache.zookeeper.server.ZooKeeperServerMain.initializeAndRun(ZooKeeperServerMain.java:86)\\n\\tat\norg.apache.zookeeper.server.ZooKeeperServerMain.main(ZooKeeperServerMain.java:52)\\n\\tat\norg.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:116)\\n\\tat\norg.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:78)\\n\\t\n[...]\n\nStack trace from JVM gives this:\n\n\"PurgeTask\" daemon prio=10 tid=0x000000000201d000 nid=0x1727 runnable\n[0x00007f55d7dc7000]\n   java.lang.Thread.State: RUNNABLE\n    at java.io.UnixFileSystem.createDirectory(Native Method)\n    at java.io.File.mkdir(File.java:1310)\n    at java.io.File.mkdirs(File.java:1337)\n    at\norg.apache.zookeeper.server.persistence.FileTxnSnapLog.<init>(FileTxnSnapLog.java:84)\n    at org.apache.zookeeper.server.PurgeTxnLog.purge(PurgeTxnLog.java:68)\n    at\norg.apache.zookeeper.server.DatadirCleanupManager$PurgeTask.run(DatadirCleanupManager.java:140)\n    at java.util.TimerThread.mainLoop(Timer.java:555)\n    at java.util.TimerThread.run(Timer.java:505)\n\n\"zookeeper server\" prio=10 tid=0x00000000027df800 nid=0x1715 runnable\n[0x00007f55d7ed8000]\n   java.lang.Thread.State: RUNNABLE\n    at java.io.UnixFileSystem.createDirectory(Native Method)\n    at java.io.File.mkdir(File.java:1310)\n    at java.io.File.mkdirs(File.java:1337)\n    at\norg.apache.zookeeper.server.persistence.FileTxnSnapLog.<init>(FileTxnSnapLog.java:84)\n    at\norg.apache.zookeeper.server.ZooKeeperServerMain.runFromConfig(ZooKeeperServerMain.java:103)\n    at\norg.apache.zookeeper.server.ZooKeeperServerMain.initializeAndRun(ZooKeeperServerMain.java:86)\n    at\norg.apache.zookeeper.server.ZooKeeperServerMain.main(ZooKeeperServerMain.java:52)\n    at\norg.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:116)\n    at\norg.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:78)\n[...]\n\nSo it seems that when autopurge is used (as it is in our case), it might happen at the same time as starting the server itself. In FileTxnSnapLog() it will check if the directory exists and create it if not. These two tasks do this at the same time, and mkdir fails and server exits the JVM.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12831161","id":"12831161","filename":"ZOOKEEPER-1936.branch-3.4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-09-30T20:13:16.431+0000","size":1232,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12831161/ZOOKEEPER-1936.branch-3.4.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12663176","id":"12663176","filename":"ZOOKEEPER-1936.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=apurtell","name":"apurtell","key":"apurtell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=apurtell&avatarId=20553","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=apurtell&avatarId=20553","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=apurtell&avatarId=20553","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=apurtell&avatarId=20553"},"displayName":"Andrew Purtell","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-20T18:24:07.372+0000","size":1253,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12663176/ZOOKEEPER-1936.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12782377","id":"12782377","filename":"ZOOKEEPER-1936.v2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-14T22:12:00.768+0000","size":912,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12782377/ZOOKEEPER-1936.v2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12783285","id":"12783285","filename":"ZOOKEEPER-1936.v3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-20T06:03:59.534+0000","size":1221,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12783285/ZOOKEEPER-1936.v3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12782581","id":"12782581","filename":"ZOOKEEPER-1936.v3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-15T18:38:28.879+0000","size":1173,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12782581/ZOOKEEPER-1936.v3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12785224","id":"12785224","filename":"ZOOKEEPER-1936.v4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-29T19:17:32.106+0000","size":1781,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12785224/ZOOKEEPER-1936.v4.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12831166","id":"12831166","filename":"ZOOKEEPER-1936.v5.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-09-30T20:26:51.626+0000","size":2200,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12831166/ZOOKEEPER-1936.v5.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"398615","customfield_12312823":null,"summary":"Server exits when unable to create data directory due to race ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hmusum","name":"hmusum","key":"hmusum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harald Musum","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hmusum","name":"hmusum","key":"hmusum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harald Musum","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/14104283","id":"14104283","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=apurtell","name":"apurtell","key":"apurtell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=apurtell&avatarId=20553","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=apurtell&avatarId=20553","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=apurtell&avatarId=20553","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=apurtell&avatarId=20553"},"displayName":"Andrew Purtell","active":true,"timeZone":"America/Los_Angeles"},"body":"Attached patch applies to trunk and branch-3.4","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=apurtell","name":"apurtell","key":"apurtell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=apurtell&avatarId=20553","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=apurtell&avatarId=20553","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=apurtell&avatarId=20553","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=apurtell&avatarId=20553"},"displayName":"Andrew Purtell","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-20T18:24:07.376+0000","updated":"2014-08-20T18:24:07.376+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/14104625","id":"14104625","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12663176/ZOOKEEPER-1936.patch\n  against trunk revision 1619166.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    -1 patch.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2292//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-20T21:24:30.385+0000","updated":"2014-08-20T21:24:30.385+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/14105744","id":"14105744","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rgs","name":"rgs","key":"rgs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rgs&avatarId=18469","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rgs&avatarId=18469","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rgs&avatarId=18469","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rgs&avatarId=18469"},"displayName":"Raul Gutierrez Segales","active":true,"timeZone":"America/Los_Angeles"},"body":"lgtm, +1. cc: [~shralex], [~phunt]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rgs","name":"rgs","key":"rgs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rgs&avatarId=18469","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rgs&avatarId=18469","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rgs&avatarId=18469","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rgs&avatarId=18469"},"displayName":"Raul Gutierrez Segales","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-21T18:35:59.974+0000","updated":"2014-08-21T18:35:59.974+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15089595","id":"15089595","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"We encountered this issue during testing, though intermittently.\n\nCan the fix be committed ?\n[~shralex] [~phunt]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-08T17:48:22.175+0000","updated":"2016-01-08T17:48:22.175+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15089628","id":"15089628","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12663176/ZOOKEEPER-1936.patch\n  against trunk revision 1720227.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    -1 patch.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3005//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-08T18:15:12.917+0000","updated":"2016-01-08T18:15:12.917+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15089636","id":"15089636","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"[~fpj]:\nCan you take a look ?\n\nThanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-08T18:18:25.397+0000","updated":"2016-01-08T18:18:25.397+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15098985","id":"15098985","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Alternate patch for consideration.\n\nOnly throw exception if dataDir doesn't exist and mkdirs() call fails.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-14T22:12:00.783+0000","updated":"2016-01-14T22:12:00.783+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15098999","id":"15098999","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rgs","name":"rgs","key":"rgs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rgs&avatarId=18469","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rgs&avatarId=18469","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rgs&avatarId=18469","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rgs&avatarId=18469"},"displayName":"Raul Gutierrez Segales","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~tedyu@apache.org] - looking. Maybe we can get this in for 3.4.8 as well. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rgs","name":"rgs","key":"rgs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rgs&avatarId=18469","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rgs&avatarId=18469","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rgs&avatarId=18469","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rgs&avatarId=18469"},"displayName":"Raul Gutierrez Segales","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-14T22:15:00.010+0000","updated":"2016-01-14T22:15:00.010+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15099001","id":"15099001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rgs","name":"rgs","key":"rgs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rgs&avatarId=18469","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rgs&avatarId=18469","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rgs&avatarId=18469","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rgs&avatarId=18469"},"displayName":"Raul Gutierrez Segales","active":true,"timeZone":"America/Los_Angeles"},"body":"cc: [~cnauroth], [~rakeshr]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rgs","name":"rgs","key":"rgs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rgs&avatarId=18469","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rgs&avatarId=18469","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rgs&avatarId=18469","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rgs&avatarId=18469"},"displayName":"Raul Gutierrez Segales","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-14T22:16:17.687+0000","updated":"2016-01-14T22:16:17.687+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15099184","id":"15099184","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12782377/ZOOKEEPER-1936.v2.patch\n  against trunk revision 1720227.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    -1 patch.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3008//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-15T00:21:15.547+0000","updated":"2016-01-15T00:21:15.547+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15101270","id":"15101270","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~yuzhihong@gmail.com] for the fix. +1 for the additional {{#exists()}} check.\n\nI've few comments:\n# Could you consider {{snapDir}} creation too.\n{code}\n            if (!this.snapDir.mkdirs()) {\n                throw new DatadirException(\"Unable to create snap directory \"\n                        + this.snapDir);\n            }\n{code}\n# Can we reduce the nested calls. How about using AND operator like,\n{code}\nif (!this.dataDir.mkdirs() && !this.dataDir.exists())\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-01-15T06:12:40.401+0000","updated":"2016-01-15T06:12:40.401+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15101984","id":"15101984","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"what happens if the call to mkdir legitimaly fails? It looks like we would assume that the directory exists and would move on. I think we need to differentiate the dir existing from other issues when creating it. Does it sound reasonable?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-01-15T16:10:13.885+0000","updated":"2016-01-15T16:10:13.885+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15102058","id":"15102058","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"After logging onto the node where the error happened, we found that dataDir didn't exist. \nSo my patch doesn't suffice. \n\nManual start on that node didn't reproduce the error though.\n\nComment is welcome.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-15T16:50:54.457+0000","updated":"2016-01-15T16:50:54.457+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15102249","id":"15102249","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm in favor of the approach in patch v2.  This would be a deterministic fix.  Adding a delay like the first patch might still not work if we got unlucky in the way the OS scheduled the threads.  What do others think?\n\n[~tedyu], could you please do the following?\n\n# Make the same fix for {{snapDir}}, which is right after the code you already changed in {{FileTxnSnapLog}}.  Otherwise, we might get past the {{dataDir}} creation only to fail again on {{snapDir}}.\n# Post 2 patch files: one that applied to trunk and one that applies to branch-3.4.\n# Generate the patch files with {{git diff --no-prefix}} for compatibility with our pre-commit automation.\n\nThank you!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-15T18:26:45.584+0000","updated":"2016-01-15T18:26:45.584+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15102276","id":"15102276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch v3 addresses comments from Chris and Rakesh.\n\nThe same patch can be applied smoothly on branch-3.4\n\nLet me know if separate patch for branch-3.4 should be attached.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-15T18:42:13.647+0000","updated":"2016-01-15T18:42:13.647+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15102294","id":"15102294","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"but [~ted_yu] said that even with his patch {{dataDir}} wasn't created, and if what you suggest in step 1 fixed it, then the directory would be there, no? I'm actually wondering if there is something else causing trouble.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-01-15T18:55:07.911+0000","updated":"2016-01-15T18:55:07.911+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15102301","id":"15102301","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12782581/ZOOKEEPER-1936.v3.patch\n  against trunk revision 1720227.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    -1 patch.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3009//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-15T18:57:27.077+0000","updated":"2016-01-15T18:57:27.077+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15102307","id":"15102307","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Yeah, my comments got crossed up, because I hadn't refreshed the page to see the latest.\n\nUnfortunately, [{{File#mkdirs}}|http://docs.oracle.com/javase/7/docs/api/java/io/File.html#mkdirs()] only gives us a boolean response with no further information about root cause.  [~tedyu], do you think you can try as a troubleshooting step switching it to call [{{Files#createDirectories}}|http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#createDirectories(java.nio.file.Path,%20java.nio.file.attribute.FileAttribute...)] ?  That might give us more detailed information about the error.\n\nWe can't use the JDK 1.7 file APIs in the 3.4 maintenance line, so this would just be a temporary troubleshooting step.  We can use those APIs in trunk/branch-3.5 though.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-15T19:02:24.672+0000","updated":"2016-01-15T19:02:24.672+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15108039","id":"15108039","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rgs","name":"rgs","key":"rgs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rgs&avatarId=18469","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rgs&avatarId=18469","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rgs&avatarId=18469","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rgs&avatarId=18469"},"displayName":"Raul Gutierrez Segales","active":true,"timeZone":"America/Los_Angeles"},"body":"[~tedyu@apache.org]: mind generating the patch with something like:\n\n{code}\ngit diff --no-prefix HEAD~1.. > ZOOKEEPER-1936.patch\n{code}\n\nThe latest one you uploaded didn't apply cleanly. Patch lgtm, +1.\n\n[~fpj], [~cnauroth]: mind giving it one last look?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rgs","name":"rgs","key":"rgs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rgs&avatarId=18469","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rgs&avatarId=18469","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rgs&avatarId=18469","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rgs&avatarId=18469"},"displayName":"Raul Gutierrez Segales","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-20T05:35:36.469+0000","updated":"2016-01-20T05:35:36.469+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15108068","id":"15108068","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Previous patch was generated for branch-3.4\n\nAttached patch for trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-20T06:05:07.534+0000","updated":"2016-01-20T06:05:07.534+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15108083","id":"15108083","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"For better understanding about the target branch, probably can include branch details while naming the patch, something like {{ZOOKEEPER-1936-br-3-4.patch}} and for trunk can use like {{ZOOKEEPER-1936.patch}}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-01-20T06:17:15.164+0000","updated":"2016-01-20T06:17:15.164+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15108088","id":"15108088","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12783285/ZOOKEEPER-1936.v3.patch\n  against trunk revision 1720227.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3010//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3010//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3010//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-20T06:20:43.586+0000","updated":"2016-01-20T06:20:43.586+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15108940","id":"15108940","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3010//testReport/org.apache.zookeeper.test/AsyncHammerTest/testHammer/\n\ndoesn't seem to be related to the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-20T17:08:46.277+0000","updated":"2016-01-20T17:08:46.277+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15113278","id":"15113278","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Any thing I need to do here ? [~rgs]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-22T22:47:48.923+0000","updated":"2016-01-22T22:47:48.923+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15123906","id":"15123906","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"[~yuzhihong@gmail.com], my understanding is that you only can repro this in standalone mode, not when deploying a full ensemble.  Is that correct?  Did you get to a point where you had a consistent repro and were able to verify that this patch helped fix it?\n\nThe logic change looks correct to me, but I'm trying to figure out if there is really something more going on, as suggested in earlier comments.  Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-29T18:18:50.468+0000","updated":"2016-01-29T18:18:50.468+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15123934","id":"15123934","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Haven't got a chance to reproduce the bug.\n\nAfter some QE fix, hbase un-secure deployment works reliably.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-29T18:32:03.454+0000","updated":"2016-01-29T18:32:03.454+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15123961","id":"15123961","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"It's a tough call then.  I don't see a way to write a deterministic JUnit test to prove the fix.  I'm reluctant to accept a code change without a test or a manual verification, at least on a stable maintenance line.\n\nHere is my take on it.  Even without a consistent repro, I see the theoretical problem in the code.  The logic change in the patch looks correct to me, even if there might have been something more happening when Ted reported it.  Let's put a fix into trunk and branch-3.5, but not branch-3.4.  In trunk and branch-3.5, we also can make the switch to [{{Files#createDirectories}}|http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#createDirectories(java.nio.file.Path,%20java.nio.file.attribute.FileAttribute...)] that I mentioned earlier, because those branches are compiling to JDK 7.  That way, if we see another repro, we'll get additional debugging information to help with any subsequent patches.\n\nWould some other committers like to comment on that plan?  Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-29T18:44:03.618+0000","updated":"2016-01-29T18:44:03.618+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15124007","id":"15124007","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch v4 addresses Chris' comment above","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-29T19:08:42.902+0000","updated":"2016-01-29T19:08:42.902+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15124017","id":"15124017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12785223/ZOOKEEPER-1936.v4.patch\n  against trunk revision 1726354.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    -1 patch.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3021//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-29T19:15:00.990+0000","updated":"2016-01-29T19:15:00.990+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15124054","id":"15124054","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12785224/ZOOKEEPER-1936.v4.patch\n  against trunk revision 1726354.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3022//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3022//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3022//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-29T19:31:04.571+0000","updated":"2016-01-29T19:31:04.571+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15124117","id":"15124117","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"There was a test failure in {{WatcherTest#testWatcherAutoResetWithLocal}}, but I can't reproduce it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-01-29T20:04:53.930+0000","updated":"2016-01-29T20:04:53.930+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15397513","id":"15397513","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mumrah","name":"mumrah","key":"mumrah","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Arthur","active":true,"timeZone":"America/New_York"},"body":"Are there any known scenarios that will trigger this race? We've seen it intermittently in an EC2 environment, but have yet to figure out why it happens there and not other environments. \n\nAlso, any updates on the status of this issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mumrah","name":"mumrah","key":"mumrah","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Arthur","active":true,"timeZone":"America/New_York"},"created":"2016-07-28T13:10:54.812+0000","updated":"2016-07-28T13:10:54.812+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15397533","id":"15397533","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12785224/ZOOKEEPER-1936.v4.patch\n  against trunk revision 1754188.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3298//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3298//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3298//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-28T13:35:51.735+0000","updated":"2016-07-28T13:35:51.735+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15397919","id":"15397919","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Hello [~mumrah].  At this point, I don't believe any of us have a repro, so bringing in this patch was not prioritized.  I'm going to update fix version to 3.5.3 to indicate that as the next potential release to contain the patch.\n\nI'm curious if you are running the 3.5 release line of ZooKeeper, and if so, do you have the ability to apply the latest proposed patch?  If we can get confirmation that the patch fixes the problem you're seeing in your environment, then that would help build confidence in the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-28T18:03:26.730+0000","updated":"2016-07-28T18:03:26.730+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15398047","id":"15398047","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nicholas.dipiazza","name":"nicholas.dipiazza","key":"nicholas.dipiazza","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicholas DiPiazza","active":true,"timeZone":"Etc/UTC"},"body":"[~cnauroth] Is it going to be viciously hard to patch this against the 3.4 release? I took a stab at it and the codebases are pretty different so i didn't get too far and figured I'd ask you.\n\nI looking into testing on the latest branch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nicholas.dipiazza","name":"nicholas.dipiazza","key":"nicholas.dipiazza","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicholas DiPiazza","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-28T19:11:55.104+0000","updated":"2016-07-28T19:18:20.460+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15398125","id":"15398125","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Hello [~nicholas.dipiazza].  The v3 patch attachment is similar logic that is compatible with the 3.4 release line.  If you can test your 3.4-based environment with that patch, then that would be interesting for us.  Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-28T20:07:33.181+0000","updated":"2016-07-28T20:07:33.181+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15398609","id":"15398609","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nicholas.dipiazza","name":"nicholas.dipiazza","key":"nicholas.dipiazza","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicholas DiPiazza","active":true,"timeZone":"Etc/UTC"},"body":"v1 and v2 patch with no changes. v3 doesn't:\n\n{code}\nbranch-3.4\n{code}\n\n{code}\npatch -p0 < ZOOKEEPER-1936.v3.patch\npatching file src/java/main/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java\nHunk #1 FAILED at 101.\nHunk #2 FAILED at 117.\n2 out of 2 hunks FAILED -- saving rejects to file src/java/main/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java.rej\n{code}\n\n{code}\ncat src/java/main/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java.rej\n--- src/java/main/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java\n+++ src/java/main/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java\n@@ -101,7 +101,7 @@ public FileTxnSnapLog(File dataDir, File snapDir) throws IOException {\n                         + \" is false). Please create this directory manually.\");\n             }\n \n-            if (!this.dataDir.mkdirs()) {\n+            if (!this.dataDir.mkdirs() && !this.dataDir.exists()) {\n                 throw new DatadirException(\"Unable to create data directory \"\n                         + this.dataDir);\n             }\n@@ -117,7 +117,7 @@ public FileTxnSnapLog(File dataDir, File snapDir) throws IOException {\n                         + \" is false). Please create this directory manually.\");\n             }\n \n-            if (!this.snapDir.mkdirs()) {\n+            if (!this.snapDir.mkdirs() && !this.snapDir.exists()) {\n                 throw new DatadirException(\"Unable to create snap directory \"\n                         + this.snapDir);\n             }\n{code}\n\nMy attempt at patching 3.4.9:\n\nhttps://github.com/apache/zookeeper/pull/75\n\n**zookeeper-1936-port-3.4.patch**\n{code}\ndiff --git a/src/java/main/org/apache/zookeeper/server/persistence/FileTxnLog.java b/src/java/main/org/apache/zookeeper/server/persistence/FileTxnLog.java\nindex b1682c3..3f26b0a 100644\n--- a/src/java/main/org/apache/zookeeper/server/persistence/FileTxnLog.java\n+++ b/src/java/main/org/apache/zookeeper/server/persistence/FileTxnLog.java\n@@ -355,7 +355,20 @@\n      * logs\n      */\n     public TxnIterator read(long zxid) throws IOException {\n-        return new FileTxnIterator(logDir, zxid);\n+        return read(zxid, true);\n+    }\n+\n+    /**\n+     * start reading all the transactions from the given zxid.\n+     *\n+     * @param zxid the zxid to start reading transactions from\n+     * @param fastForward true if the iterator should be fast forwarded to point\n+     *        to the txn of a given zxid, else the iterator will point to the\n+     *        starting txn of a txnlog that may contain txn of a given zxid\n+     * @return returns an iterator to iterate through the transaction logs\n+     */\n+    public TxnIterator read(long zxid, boolean fastForward) throws IOException {\n+        return new FileTxnIterator(logDir, zxid, fastForward);\n     }\n \n     /**\n@@ -375,10 +388,10 @@\n             }\n             long pos = input.getPosition();\n             // now, truncate at the current position\n-            RandomAccessFile raf = new RandomAccessFile(itr.logFile, \"rw\");\n+            RandomAccessFile raf=new RandomAccessFile(itr.logFile,\"rw\");\n             raf.setLength(pos);\n             raf.close();\n-            while (itr.goToNextLog()) {\n+            while(itr.goToNextLog()) {\n                 if (!itr.logFile.delete()) {\n                     LOG.warn(\"Unable to truncate {}\", itr.logFile);\n                 }\n@@ -523,12 +536,34 @@\n          * create an iterator over a transaction database directory\n          * @param logDir the transaction database directory\n          * @param zxid the zxid to start reading from\n+         * @param fastForward   true if the iterator should be fast forwarded to\n+         *        point to the txn of a given zxid, else the iterator will\n+         *        point to the starting txn of a txnlog that may contain txn of\n+         *        a given zxid\n+         * @throws IOException\n+         */\n+        public FileTxnIterator(File logDir, long zxid, boolean fastForward)\n+                throws IOException {\n+            this.logDir = logDir;\n+            this.zxid = zxid;\n+            init();\n+\n+            if (fastForward && hdr != null) {\n+                while (hdr.getZxid() < zxid) {\n+                    if (!next())\n+                        break;\n+                }\n+            }\n+        }\n+        \n+        /**\n+         * create an iterator over a transaction database directory\n+         * @param logDir the transaction database directory\n+         * @param zxid the zxid to start reading from\n          * @throws IOException\n          */\n         public FileTxnIterator(File logDir, long zxid) throws IOException {\n-          this.logDir = logDir;\n-          this.zxid = zxid;\n-          init();\n+            this(logDir, zxid, true);\n         }\n \n         /**\n@@ -552,10 +587,17 @@\n             goToNextLog();\n             if (!next())\n                 return;\n-            while (hdr.getZxid() < zxid) {\n-                if (!next())\n-                    return;\n+        }\n+        \n+        /**\n+         * Return total storage size of txnlog that will return by this iterator.\n+         */\n+        public long getStorageSize() {\n+            long sum = 0;\n+            for (File f : storedFiles) {\n+                sum += f.length();\n             }\n+            return sum;\n         }\n \n         /**\n@@ -637,8 +679,6 @@\n                 crc.update(bytes, 0, bytes.length);\n                 if (crcValue != crc.getValue())\n                     throw new IOException(CRC_ERROR);\n-                if (bytes == null || bytes.length == 0)\n-                    return false;\n                 hdr = new TxnHeader();\n                 record = SerializeUtils.deserializeTxn(bytes, hdr);\n             } catch (EOFException e) {\ndiff --git a/src/java/main/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java b/src/java/main/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java\nindex 6f0df51..98d94b4 100644\n--- a/src/java/main/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java\n+++ b/src/java/main/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java\n@@ -58,6 +58,10 @@\n     \n     private static final Logger LOG = LoggerFactory.getLogger(FileTxnSnapLog.class);\n     \n+    public static final String ZOOKEEPER_DATADIR_AUTOCREATE =\n+            \"zookeeper.datadir.autocreate\";\n+\n+    public static final String ZOOKEEPER_DATADIR_AUTOCREATE_DEFAULT = \"true\";\n     /**\n      * This listener helps\n      * the external apis calling\n@@ -80,15 +84,38 @@\n \n         this.dataDir = new File(dataDir, version + VERSION);\n         this.snapDir = new File(snapDir, version + VERSION);\n+        // by default create snap/log dirs, but otherwise complain instead\n+        // See ZOOKEEPER-1161 for more details\n+        boolean enableAutocreate = Boolean.valueOf(\n+                System.getProperty(ZOOKEEPER_DATADIR_AUTOCREATE,\n+                        ZOOKEEPER_DATADIR_AUTOCREATE_DEFAULT));\n         if (!this.dataDir.exists()) {\n-            if (!this.dataDir.mkdirs()) {\n-                throw new IOException(\"Unable to create data directory \"\n+            if (!enableAutocreate) {\n+                throw new DatadirException(\"Missing data directory \"\n+                        + this.dataDir\n+                        + \", automatic data directory creation is disabled (\"\n+                        + ZOOKEEPER_DATADIR_AUTOCREATE\n+                        + \" is false). Please create this directory manually.\");\n+            }\n+\n+            if (!this.dataDir.mkdirs() && !this.dataDir.exists()) {\n+                throw new DatadirException(\"Unable to create data directory \"\n                         + this.dataDir);\n             }\n         }\n         if (!this.snapDir.exists()) {\n-            if (!this.snapDir.mkdirs()) {\n-                throw new IOException(\"Unable to create snap directory \"\n+            // by default create this directory, but otherwise complain instead\n+            // See ZOOKEEPER-1161 for more details\n+            if (!enableAutocreate) {\n+                throw new DatadirException(\"Missing snap directory \"\n+                        + this.snapDir\n+                        + \", automatic data directory creation is disabled (\"\n+                        + ZOOKEEPER_DATADIR_AUTOCREATE\n+                        + \" is false). Please create this directory manually.\");\n+            }\n+\n+            if (!this.snapDir.mkdirs() && !this.snapDir.exists()) {\n+                throw new DatadirException(\"Unable to create snap directory \"\n                         + this.snapDir);\n             }\n         }\n@@ -164,6 +191,33 @@\n             }\n         }\n         return highestZxid;\n+    }\n+\n+    /**\n+     * Get TxnIterator for iterating through txnlog starting at a given zxid\n+     *\n+     * @param zxid starting zxid\n+     * @return TxnIterator\n+     * @throws IOException\n+     */\n+    public TxnIterator readTxnLog(long zxid) throws IOException {\n+        return readTxnLog(zxid, true);\n+    }\n+\n+    /**\n+     * Get TxnIterator for iterating through txnlog starting at a given zxid\n+     *\n+     * @param zxid starting zxid\n+     * @param fastForward true if the iterator should be fast forwarded to point\n+     *        to the txn of a given zxid, else the iterator will point to the\n+     *        starting txn of a txnlog that may contain txn of a given zxid\n+     * @return TxnIterator\n+     * @throws IOException\n+     */\n+    public TxnIterator readTxnLog(long zxid, boolean fastForward)\n+            throws IOException {\n+        FileTxnLog txnLog = new FileTxnLog(dataDir);\n+        return txnLog.read(zxid, fastForward);\n     }\n     \n     /**\n@@ -338,4 +392,14 @@\n         txnLog.close();\n         snapLog.close();\n     }\n+\n+    @SuppressWarnings(\"serial\")\n+    public static class DatadirException extends IOException {\n+        public DatadirException(String msg) {\n+            super(msg);\n+        }\n+        public DatadirException(String msg, Exception e) {\n+            super(msg, e);\n+        }\n+    }\n }\n{code}\n\n*UPDATE:* Testing 3.4.9 with this patch looks ok for me. you might have squashed this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nicholas.dipiazza","name":"nicholas.dipiazza","key":"nicholas.dipiazza","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicholas DiPiazza","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-29T02:26:03.138+0000","updated":"2016-07-29T05:40:04.365+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15398742","id":"15398742","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user nddipiazza opened a pull request:\n\n    https://github.com/apache/zookeeper/pull/75\n\n    https://issues.apache.org/jira/browse/ZOOKEEPER-1936\n\n    https://issues.apache.org/jira/browse/ZOOKEEPER-1936\n    \n    port fix to 3.4\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/nddipiazza/zookeeper ZOOKEEPER-1936\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/75.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #75\n    \n----\ncommit bdd8798895e21bf3158c63c1d00aa99fba5e9f34\nAuthor: Nicholas DiPiazza <nicholas.dipiazza@lucidworks.com>\nDate:   2016-07-29T05:32:03Z\n\n    https://issues.apache.org/jira/browse/ZOOKEEPER-1936 \n    \n    port fix to 3.4\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-29T05:38:22.427+0000","updated":"2016-07-29T05:38:22.427+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15505015","id":"15505015","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"This patch has been stalled, because there is no easy way to write a unit test for it, and no one has been able to produce a consistent repro in a live environment.\n\nI have good news.  I was able to find a consistent repro with an environment that could reproduce the problem in approximately 80% of ZooKeeper server starts.  FWIW, the OS was SUSE11sp3, and it was running ZooKeeper 3.4.6.  I applied the v3 patch, deployed it in this environment, and we could no longer repro.\n\nBased on successful manual testing, I am now +1 to commit patch v4 to trunk and branch-3.5, and commit patch v3 to branch-3.4.  I will wait until later in the week in case other committers who have been watching the issue would like to discuss further.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-09-19T23:27:37.188+0000","updated":"2016-09-19T23:27:37.188+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15531396","id":"15531396","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mattf","name":"mattf","key":"mattf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Foley","active":true,"timeZone":"America/Los_Angeles"},"body":"[~cnauroth], please do commit.  +1.  Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mattf","name":"mattf","key":"mattf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Foley","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-09-29T00:45:09.860+0000","updated":"2016-09-29T00:45:09.860+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15534026","id":"15534026","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"[~rgs] or [~fpj], could I please trouble one of you to do one last review pass to make sure we're in agreement before I commit?  Thank you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-09-29T20:56:39.273+0000","updated":"2016-09-29T20:56:39.273+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15536684","id":"15536684","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I was looking at this pull request:\n\nhttps://github.com/apache/zookeeper/pull/75.patch\n\nbut it looks like it doesn't correspond to the v4 patch attached. What is it precisely that we are proposing to merge?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-09-30T18:36:52.744+0000","updated":"2016-09-30T18:36:52.744+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15536734","id":"15536734","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Is it better to catch {{FileAlreadyExistsException}} for the {{Files.createDirectories}} call to be safe, in the case the directory is created concurrently?\n\nI'm actually wondering why we added that {{DatadirException}}. I'd much rather just keep it {{IOException}} instead... I understand this isn't being introduced in this patch, although maybe for 3.4 if we merge there. Actually, what are the fix versions for this issue?   \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-09-30T18:52:10.290+0000","updated":"2016-09-30T18:52:10.290+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15536740","id":"15536740","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Given that I'm not sure what exactly we are considering to merge at this point, I don't know who the assignee is. Once we clarify it, I can assign accordingly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-09-30T18:56:31.473+0000","updated":"2016-09-30T18:56:31.473+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15536893","id":"15536893","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"[~fpj], thank you for looking.  I am proposing that we fix this for 3.5.3 and 3.4.10.  I am proposing separate patches for the 2 branches, so that we can use the NIO APIs with the richer error reporting in trunk/branch-3.5 and use the JDK 6 APIs in branch-3.4.\n\nI now realize that the trunk/branch-3.5 patch wasn't ready.  Thanks for pointing out the problem.  [~yuzhihong@gmail.com], would you please update that to catch the exception from {{Files#createDirectories}} and allow the method to succeed if the directory already exists?  That will keep it similar to the branch-3.4 logic.  Would you please upload new patch files for both trunk/branch-3.5 and branch-3.4?  That will help eliminate the current confusion about which patch files to use.\n\nTed has contributed the most recent patches that I am proposing to commit after another revision, so I'll assign to him.\n\nbq. I'm actually wondering why we added that DatadirException. I'd much rather just keep it IOException instead.\n\nThis traces back to ZOOKEEPER-1161, which introduced the ability to disable automatic directory creation.  Part of that includes special handling of {{DatadirException}} in {{QuorumPeerMain}} and {{ZooKeeperServerMain}} so that they can return unique exit codes when directory creation fails.  I think we need to keep this as is for now to preserve backward compatibility.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-09-30T19:57:56.149+0000","updated":"2016-09-30T19:57:56.149+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15550505","id":"15550505","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Is there anything I can do to move this forward ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-10-06T01:10:43.861+0000","updated":"2016-10-06T01:10:43.861+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15551351","id":"15551351","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I'd expect [~cnauroth] to +1 it. In the meanwhile, I've had another look, and there are a couple of things I don't understand:\n\n- With the 3.4 patch, we have this:\n\n{noformat}\nif (!this.dataDir.exists()) {\n            if (!this.dataDir.mkdirs() && !this.dataDir.exists()) {\n{noformat} \n\nwhy do we need the first call to {{this.dataDir.exists()}} and the encapsulating if block? It sounds like we don't need the outer if block.\n\n- In the 3.5 patch, I'm not sure why we need this if:\n\n{noformat}\nif (!this.snapDir.exists())\n{noformat}\n\nIn the case {{Files.createDirectories}} fails to create the directory, then we will have an exception, so the two possible outcomes are: 1) directory is created just fine; 2) exception is thrown. Consequently, it doesn't look like we need that last if, but maybe I'm missing something.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-10-06T08:45:36.589+0000","updated":"2016-10-06T08:45:36.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/15930873","id":"15930873","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user Humbedooh closed the pull request at:\n\n    https://github.com/apache/zookeeper/pull/75\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-17T23:12:11.688+0000","updated":"2017-03-17T23:12:11.688+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/16028186","id":"16028186","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eolivelli","name":"eolivelli","key":"eolivelli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Enrico Olivelli","active":true,"timeZone":"Europe/Rome"},"body":"this issue is marked as fixversion = 3.5.4, the PR #75 has been closed.\nI cannot find commits in 3.5 branch\nwhich is the actual status ?\n\nI am very interested in this fix","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eolivelli","name":"eolivelli","key":"eolivelli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Enrico Olivelli","active":true,"timeZone":"Europe/Rome"},"created":"2017-05-29T09:58:08.127+0000","updated":"2017-05-29T09:58:08.127+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/16028323","id":"16028323","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I think it was simply closed, I had a few comments there that were never addressed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2017-05-29T13:22:21.071+0000","updated":"2017-05-29T13:22:21.071+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/16028326","id":"16028326","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"It also looks like the diff was broken as the number of commits listed is large. I haven't looked closely but it seems that merges weren't done appropriately.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2017-05-29T13:25:36.699+0000","updated":"2017-05-29T13:25:36.699+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12720291/comment/16028392","id":"16028392","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eolivelli","name":"eolivelli","key":"eolivelli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Enrico Olivelli","active":true,"timeZone":"Europe/Rome"},"body":"[~fpj] [~yuzhihong@gmail.com] [~cnauroth] \n\nI can pick up the issue a propose my local patch.\n\nThis issue is quite annoying in JUnit tests cases of projects which use ZK and spawn ZK servers.\n\nI would like to provide a patch for 3.5 branch and 3.6\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eolivelli","name":"eolivelli","key":"eolivelli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Enrico Olivelli","active":true,"timeZone":"Europe/Rome"},"created":"2017-05-29T14:14:51.152+0000","updated":"2017-05-29T14:14:51.152+0000"}],"maxResults":52,"total":52,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1936/votes","votes":3,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1wlsf:"}}