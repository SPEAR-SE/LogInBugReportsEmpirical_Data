{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13013006","self":"https://issues.apache.org/jira/rest/api/2/issue/13013006","key":"ZOOKEEPER-2616","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-10-17T23:20:04.003+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jan 30 20:34:37 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2616/watchers","watchCount":5,"isWatching":false},"created":"2016-10-17T22:08:49.232+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12331981","id":"12331981","description":"Alpha release against 3.5 branch","name":"3.5.2","archived":false,"released":true,"releaseDate":"2016-07-21"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-01-30T20:34:37.951+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"Only 1 of the 3 nodes of the ensemble is started. The server successfully started in readonly (\"Read-only server started\").\n\n{code:title=client}System.setProperty(\"readonlymode.enabled\", \"true\");\n\nString cs = \"QA-E8WIN11:2181,QA-E8WIN12:2181,QA-E8WIN13:2181\";\nZooKeeper zk = new ZooKeeper(cs, 30000, null, true);\n\t\t\n// wait for connection\nwhile (!zk.getState().isConnected()) {\n\tThread.sleep(1000);\n\tlogger.error(zk.getState());\n}\nzk.getData(\"/\", false, new Stat());\n\nlogger.error(\"DONE\");{code}\n\n\nThe client code above manages to acquire a connection (\"CONNECTEDREADONLY\") but the subsequent getData fails with ConnectionLoss:\n\n{code:title=client log}2016-10-17 14:37:43 ERROR TestCuratorReadOnly:31 - CONNECTEDREADONLY\n2016-10-17 14:39:49 ERROR o.a.z.ClientCnxn:526 - Error while calling watcher \njava.lang.NullPointerException\n\tat org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:524) [zookeeper-3.5.2-alpha.jar:3.5.2-alpha--1]\n\tat org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:499) [zookeeper-3.5.2-alpha.jar:3.5.2-alpha--1]\nException in thread \"main\" org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss for /\n\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:99)\n\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:51)\n\tat org.apache.zookeeper.ZooKeeper.getData(ZooKeeper.java:1956)\n\tat org.apache.zookeeper.ZooKeeper.getData(ZooKeeper.java:1985)\n\tat TestCuratorReadOnly.main(TestCuratorReadOnly.java:33){code}\n\nFull server logs are attached, but here are the relevant parts:\n\n{code:title=server log}\n2016-10-17 14:37:31,375 [myid:1] - INFO  [Thread-2:ReadOnlyZooKeeperServer@73] - Read-only server started\n(...)\n2016-10-17 14:37:55,241 [myid:1] - INFO  [NIOServerCxnFactory.AcceptThread:/0.0.0.0:2181:NIOServerCnxnFactory$AcceptThread@296] - Accepted socket connection from /10.11.12.4:40800\n2016-10-17 14:37:55,250 [myid:1] - INFO  [NIOWorkerThread-1:ZooKeeperServer@964] - Client attempting to establish new session at /10.11.12.4:40800\n2016-10-17 14:37:55,255 [myid:1] - INFO  [ProcessThread(sid:1 cport:-1)::ZooKeeperServer@678] - Established session 0x100024619520000 with negotiated timeout 30000 for client /10.11.12.4:40800\n(...)\n [org.apache.ZooKeeperService:name0=ReplicatedServer_id1,name1=replica.1,name2=ReadOnlyServer,name3=Connections,name4=10.11.12.4,name5=0x100024619520000]\n2016-10-17 14:38:26,929 [myid:1] - INFO  [ProcessThread(sid:1 cport:-1)::NIOServerCnxn@607] - Closed socket connection for client /10.11.12.4:40800 which had sessionid 0x100024619520000{code}\n\nThe client and server are using official 3.5.2-alpha.\n\n{code:title=zoo.cfg}autopurge.purgeInterval=3\ninitLimit=10\nsyncLimit=5\nautopurge.snapRetainCount=3\nsnapCount=10000\nminSessionTimeout=5000\nmaxSessionTimeout=600000\ntickTime=2000\nadmin.commandURL=/commands\nquorumListenOnAllIPs=true\ndataDir=C:/workspace/zookeeper-3.5.2-alpha/data\nadmin.serverPort=8080\nadmin.enableServer=false\nstandaloneEnabled=false\ndynamicConfigFile=C:/workspace/zookeeper-3.5.2-alpha/conf/zoo.cfg.dynamic.10000046b{code}\n\n{code:title=zoo.cfg.dynamic.10000046b}server.1=QA-E8WIN11:2888:3888:participant;0.0.0.0:2181\nserver.2=QA-E8WIN12:2888:3888:participant;0.0.0.0:2181\nserver.3=QA-E8WIN13:2888:3888:participant;0.0.0.0:2181{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12833841","id":"12833841","filename":"test2_client.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"created":"2016-10-17T23:56:24.994+0000","size":10571,"mimeType":"text/x-log","content":"https://issues.apache.org/jira/secure/attachment/12833841/test2_client.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12833840","id":"12833840","filename":"test2_server.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"created":"2016-10-17T23:56:24.987+0000","size":34222,"mimeType":"text/x-log","content":"https://issues.apache.org/jira/secure/attachment/12833840/test2_server.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12836445","id":"12836445","filename":"test3_server.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-01T21:48:12.053+0000","size":33521,"mimeType":"text/x-log","content":"https://issues.apache.org/jira/secure/attachment/12836445/test3_server.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12850038","id":"12850038","filename":"ZOOKEEPER-2616.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"created":"2017-01-30T20:34:37.929+0000","size":1469,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12850038/ZOOKEEPER-2616.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12833820","id":"12833820","filename":"zookeeper-Administrator-server-QA-E8WIN11.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"created":"2016-10-17T22:09:36.925+0000","size":40082,"mimeType":"text/x-log","content":"https://issues.apache.org/jira/secure/attachment/12833820/zookeeper-Administrator-server-QA-E8WIN11.log"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"ZK client fails to connect to ReadOnly server","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13013006/comment/15583653","id":"15583653","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"body":"Server log","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"created":"2016-10-17T22:09:36.930+0000","updated":"2016-10-17T22:09:36.930+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13013006/comment/15583815","id":"15583815","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nerdyyatrice","name":"nerdyyatrice","key":"nerdyyatrice","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"The logs says the session timed out after 30 secs (which is exactly the negotiated timeout). I wonder if you can post the client log to show when was the first request sent after it connected?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nerdyyatrice","name":"nerdyyatrice","key":"nerdyyatrice","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-10-17T23:20:04.003+0000","updated":"2016-10-17T23:20:04.003+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13013006/comment/15583890","id":"15583890","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"body":"Client + server log files","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"created":"2016-10-17T23:56:24.997+0000","updated":"2016-10-17T23:56:24.997+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13013006/comment/15583921","id":"15583921","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nerdyyatrice","name":"nerdyyatrice","key":"nerdyyatrice","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"The sever looks fine, the problem is on the client\nI am not sure where is the following log coming from (can't see any print out from the code you posted)\n\n2016-10-17 16:49:26 ERROR TestZooKeerpReadOnly:25 - CONNECTEDREADONLY\n\nit looked like the client side hit some error and didn't do anything for a long time and then the server timed out\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nerdyyatrice","name":"nerdyyatrice","key":"nerdyyatrice","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-10-18T00:10:54.711+0000","updated":"2016-10-18T00:10:54.711+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13013006/comment/15583965","id":"15583965","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"body":"The extra log comes from my code, I added a logger.error(zk.getState()); after the while loop.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"created":"2016-10-18T00:34:07.696+0000","updated":"2016-10-18T00:34:07.696+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13013006/comment/15584289","id":"15584289","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nerdyyatrice","name":"nerdyyatrice","key":"nerdyyatrice","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Can you add a lot more logs in the processing path on the server side instead then? There is just not much logs to show anything on the server side to show when (or whether) does it get the request.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nerdyyatrice","name":"nerdyyatrice","key":"nerdyyatrice","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-10-18T03:19:21.777+0000","updated":"2016-10-18T03:19:21.777+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13013006/comment/15584498","id":"15584498","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"body":"This is not easy, not sure where to start. Would you have specific classes / methods in mind?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"created":"2016-10-18T05:19:40.127+0000","updated":"2016-10-18T05:19:40.127+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13013006/comment/15589621","id":"15589621","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nerdyyatrice","name":"nerdyyatrice","key":"nerdyyatrice","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Yes,  can you add some logs in processPacket function in the ZookeeperServer class\n\nand in the  processRequest function in the  ReadOnlyRequestProcessor class?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nerdyyatrice","name":"nerdyyatrice","key":"nerdyyatrice","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-10-19T19:25:52.743+0000","updated":"2016-10-19T19:25:52.743+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13013006/comment/15626771","id":"15626771","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"body":"zookeeper logs with extra debug info","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-01T21:48:12.058+0000","updated":"2016-11-01T21:48:12.058+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13013006/comment/15626776","id":"15626776","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"body":"I attached the server output. We can only see the logs from ReadOnlyRequestProcessor.processRequest.\nZookeeperServer.processPacket doesn't seem to be involved here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-01T21:49:36.744+0000","updated":"2016-11-01T21:49:36.744+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13013006/comment/15633569","id":"15633569","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nerdyyatrice","name":"nerdyyatrice","key":"nerdyyatrice","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Can you please also paste the logs you added? I am not sure how logs in  ZookeeperServer.processPacket not being called. That's the entry point.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nerdyyatrice","name":"nerdyyatrice","key":"nerdyyatrice","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-11-03T17:33:34.225+0000","updated":"2016-11-03T17:33:48.132+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13013006/comment/15633610","id":"15633610","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"body":"{code:title=ZookeeperServer.java}     public void processPacket(ServerCnxn cnxn, ByteBuffer incomingBuffer) throws IOException {\n    \tLog.warn(\"ZooKeeperServer.processPacket for session \"+Long.toHexString(cnxn.getSessionId()));\n(...){code}\n\n{code:title=ReadOnlyRequestProcessor.java}     @Override\n     public void processRequest(Request request) {\n+    \tLOG.warn(\"ReadOnlyRequestProcessor.processRequest for session \"+Long.toHexString(request.sessionId));\n         if (!finished) {\n+        \tLOG.warn(\"ReadOnlyRequestProcessor.processRequest for session \"+Long.toHexString(request.sessionId)+\": adding request to queue.\");\n             queuedRequests.add(request);\n+        }else{\n+        \tLOG.warn(\"ReadOnlyRequestProcessor.processRequest for session \"+Long.toHexString(request.sessionId)+\": NOT adding request to queue (finished=true).\");\n         }\n     }{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benjamin.jaton","name":"benjamin.jaton","key":"benjamin.jaton","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Jaton","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-03T17:45:44.334+0000","updated":"2016-11-03T17:45:44.334+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13013006/comment/15845864","id":"15845864","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"body":"Hi [~benjamin.jaton], \n\nI am having trouble trying to repro this bug as a ZK unit test. Are you still facing this issue? If you have time I would like to see if you could take a look at the unit test I am attaching here and see what I can be doing wrong.\n\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"created":"2017-01-30T20:34:37.938+0000","updated":"2017-01-30T20:34:37.938+0000"}],"maxResults":13,"total":13,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2616/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3508f:"}}