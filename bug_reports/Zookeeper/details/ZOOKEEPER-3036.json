{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13158155","self":"https://issues.apache.org/jira/rest/api/2/issue/13158155","key":"ZOOKEEPER-3036","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-07-26T21:44:34.145+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 23 10:25:07 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-3036/watchers","watchCount":4,"isWatching":false},"created":"2018-05-09T10:48:14.375+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12338036","id":"12338036","description":"Fix release against 3.4 branch","name":"3.4.10","archived":false,"released":true,"releaseDate":"2017-03-30"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-08-23T10:25:07.624+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312379","id":"12312379","name":"quorum","description":"Quorum determination for ZooKeeper"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"We got an issue with one of the zookeeprs (Leader), causing the entire kafka cluster to fail:\r\n\r\n2018-05-09 02:29:01,730 [myid:3] - ERROR [LearnerHandler-/192.168.0.91:42490:LearnerHandler@648] - Unexpected exception causing shutdown while sock still open\r\njava.net.SocketTimeoutException: Read timed out\r\n        at java.net.SocketInputStream.socketRead0(Native Method)\r\n        at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)\r\n        at java.net.SocketInputStream.read(SocketInputStream.java:171)\r\n        at java.net.SocketInputStream.read(SocketInputStream.java:141)\r\n        at java.io.BufferedInputStream.fill(BufferedInputStream.java:246)\r\n        at java.io.BufferedInputStream.read(BufferedInputStream.java:265)\r\n        at java.io.DataInputStream.readInt(DataInputStream.java:387)\r\n        at org.apache.jute.BinaryInputArchive.readInt(BinaryInputArchive.java:63)\r\n        at org.apache.zookeeper.server.quorum.QuorumPacket.deserialize(QuorumPacket.java:83)\r\n        at org.apache.jute.BinaryInputArchive.readRecord(BinaryInputArchive.java:99)\r\n        at org.apache.zookeeper.server.quorum.LearnerHandler.run(LearnerHandler.java:559)\r\n2018-05-09 02:29:01,730 [myid:3] - WARN  [LearnerHandler-/192.168.0.91:42490:LearnerHandler@661] - ******* GOODBYE /192.168.0.91:42490 ********\r\n\r\n \r\n\r\nWe would expect that zookeeper will choose another Leader and the Kafka cluster will continue to work as expected, but that was not the case.\r\n\r\n ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Unexpected exception in zookeeper","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oded%40coralogix.com","name":"oded@coralogix.com","key":"oded@coralogix.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oded","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oded%40coralogix.com","name":"oded@coralogix.com","key":"oded@coralogix.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oded","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"3 Zookeepers, 5 kafka servers","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13158155/comment/16558929","id":"16558929","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lu.kevin","name":"lu.kevin","key":"lu.kevin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Kevin Lu","active":true,"timeZone":"Etc/UTC"},"body":"[~oded@coralogix.com] did you get this resolved? We ran into this issue too, and there was a zookeeper IP in our ensemble that was down. We removed the downed zookeeper IP from the ensemble, did a rolling restart of the zookeeper cluster, and it seems to have fixed it so far... \r\n\r\n \r\n\r\nAdditionally, see https://issues.apache.org/jira/browse/KAFKA-5642 as this was related in our case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lu.kevin","name":"lu.kevin","key":"lu.kevin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Kevin Lu","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-26T21:44:34.145+0000","updated":"2018-07-26T21:44:34.145+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13158155/comment/16559328","id":"16559328","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oded%40coralogix.com","name":"oded@coralogix.com","key":"oded@coralogix.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oded","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n\nWe did the same but the issue returned again. It happens to us from time to\ntime, and we handle it manually.\nThe main problem is that it caused kafka for \"split brain\" where the\ncluster believes it has more then one controller.\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oded%40coralogix.com","name":"oded@coralogix.com","key":"oded@coralogix.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oded","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-27T06:30:00.085+0000","updated":"2018-07-27T06:30:00.085+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13158155/comment/16560186","id":"16560186","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lu.kevin","name":"lu.kevin","key":"lu.kevin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Kevin Lu","active":true,"timeZone":"Etc/UTC"},"body":"[~oded@coralogix.com] yes multiple brokers think they are the controller.\r\n\r\nWhat version of Kafka are you using? We found this issue in 0.10.2.0, and upgrading to 1.1.1 seems to have fixed the problem. It is stable now, but not sure if it will happen again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lu.kevin","name":"lu.kevin","key":"lu.kevin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Kevin Lu","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-27T19:41:45.978+0000","updated":"2018-07-27T19:41:45.978+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13158155/comment/16560215","id":"16560215","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oded%40coralogix.com","name":"oded@coralogix.com","key":"oded@coralogix.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oded","active":true,"timeZone":"Etc/UTC"},"body":"We are running with kafka 1.1.0\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oded%40coralogix.com","name":"oded@coralogix.com","key":"oded@coralogix.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oded","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-27T19:56:00.153+0000","updated":"2018-07-27T19:56:00.153+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13158155/comment/16561417","id":"16561417","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"What is the issue related to ZooKeeper in this case? When a learner thread dies the leader should be able to start another learner thread once the follower / observer corresponding to the died learner thread comes back. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2018-07-30T04:38:27.796+0000","updated":"2018-07-30T04:38:27.796+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13158155/comment/16561968","id":"16561968","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"can you give a bit more detail as to what happened? there were 3 servers. it sounds like one of the followers failed right? the leader should keep working with the other follower alive. did the leader actually shutdown as well?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-07-30T14:23:24.978+0000","updated":"2018-07-30T14:23:24.978+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13158155/comment/16590037","id":"16590037","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oded%40coralogix.com","name":"oded@coralogix.com","key":"oded@coralogix.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oded","active":true,"timeZone":"Etc/UTC"},"body":"Hope it will help , before we were getting the split brain, we saw this log:\r\n\r\nkafka-cluster-zookeeper-1 zookeeper 2018-08-22 20:04:46,623 [myid:2] - INFO  [ProcessThread(sid:2 cport:-1)::PrepRequestProcessor@648] - Got user-level KeeperException when processing sessionid:0x26561ad5c49000f type:ping cxid:0xfffffffffffffffe zxid:0xfffffffffffffffe txntype:unknown reqpath:n/a Error Path:null Error:KeeperErrorCode = Session moved\r\nkafka-cluster-zookeeper-1 zookeeper 2018-08-22 20:05:50,885 [myid:2] - INFO  [ProcessThread(sid:2 cport:-1)::PrepRequestProcessor@648] - Got user-level KeeperException when processing sessionid:0x16561ad5c490007 type:delete cxid:0xabc zxid:0x100000cbe txntype:-1 reqpath:n/a Error Path:/config/changes/config_change_0000000001 Error:KeeperErrorCode = NoNode for /config/changes/config_change_0000000001\r\n\r\n \r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oded%40coralogix.com","name":"oded@coralogix.com","key":"oded@coralogix.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oded","active":true,"timeZone":"Etc/UTC"},"created":"2018-08-23T10:25:07.624+0000","updated":"2018-08-23T10:25:07.624+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-3036/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3tij3:"}}