{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13117142","self":"https://issues.apache.org/jira/rest/api/2/issue/13117142","key":"ZOOKEEPER-2938","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-02-12T16:59:54.133+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed May 16 06:38:39 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2938/watchers","watchCount":6,"isWatching":false},"created":"2017-11-09T00:31:57.929+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323310","id":"12323310","description":"Fix release against 3.4 branch","name":"3.4.6","archived":false,"released":true,"releaseDate":"2014-03-10"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-05-16T06:38:39.248+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"We see the following logs in the node with {{myid: 1}}\r\n{code}\r\n2017-11-08 15:06:28,375 [myid:1] - INFO  [WorkerSender[myid=1]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (2, 1)\r\n2017-11-08 15:06:28,375 [myid:1] - INFO  [WorkerSender[myid=1]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (3, 1)\r\n2017-11-08 15:07:28,375 [myid:1] - INFO  [WorkerReceiver[myid=1]:FastLeaderElection@597] - Notification: 1 (message format version), 1 (n.leader), 0x28e000a8750 (n.zxid), 0x1 (n.round), LOOKING (n.state), 1 (n.sid), 0x28e (n.peerEpoch) LOOKING (my state)\r\n2017-11-08 15:07:28,375 [myid:1] - INFO  [WorkerSender[myid=1]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (2, 1)\r\n2017-11-08 15:07:28,376 [myid:1] - INFO  [WorkerSender[myid=1]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (3, 1)\r\n2017-11-08 15:08:28,375 [myid:1] - INFO  [WorkerReceiver[myid=1]:FastLeaderElection@597] - Notification: 1 (message format version), 1 (n.leader), 0x28e000a8750 (n.zxid), 0x1 (n.round), LOOKING (n.state), 1 (n.sid), 0x28e (n.peerEpoch) LOOKING (my state)\r\n2017-11-08 15:08:28,376 [myid:1] - INFO  [WorkerSender[myid=1]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (2, 1)\r\n2017-11-08 15:08:28,376 [myid:1] - INFO  [WorkerSender[myid=1]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (3, 1)\r\n2017-11-08 15:09:28,376 [myid:1] - INFO  [WorkerReceiver[myid=1]:FastLeaderElection@597] - Notification: 1 (message format version), 1 (n.leader), 0x28e000a8750 (n.zxid), 0x1 (n.round), LOOKING (n.state), 1 (n.sid), 0x28e (n.peerEpoch) LOOKING (my state)\r\n2017-11-08 15:09:28,376 [myid:1] - INFO  [WorkerSender[myid=1]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (2, 1)\r\n2017-11-08 15:09:28,376 [myid:1] - INFO  [WorkerSender[myid=1]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (3, 1)\r\n2017-11-08 15:10:28,376 [myid:1] - INFO  [WorkerReceiver[myid=1]:FastLeaderElection@597] - Notification: 1 (message format version), 1 (n.leader), 0x28e000a8750 (n.zxid), 0x1 (n.round), LOOKING (n.state), 1 (n.sid), 0x28e (n.peerEpoch) LOOKING (my state)\r\n2017-11-08 15:10:28,376 [myid:1] - INFO  [WorkerSender[myid=1]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (2, 1)\r\n2017-11-08 15:10:28,377 [myid:1] - INFO  [WorkerSender[myid=1]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (3, 1)\r\n{code}\r\n\r\nOn the nodes with {{myid: 2}} and {{myid: 3}}, we see connection broken events for {{myid: 1}}\r\n{code}\r\n2017-11-07 02:54:32,135 [myid:2] - WARN  [RecvWorker:1:QuorumCnxManager$RecvWorker@780] - Connection broken for id 1, my id = 2, error =\r\njava.net.SocketException: Connection reset\r\n        at java.net.SocketInputStream.read(SocketInputStream.java:209)\r\n        at java.net.SocketInputStream.read(SocketInputStream.java:141)\r\n        at java.net.SocketInputStream.read(SocketInputStream.java:223)\r\n        at java.io.DataInputStream.readInt(DataInputStream.java:387)\r\n        at org.apache.zookeeper.server.quorum.QuorumCnxManager$RecvWorker.run(QuorumCnxManager.java:765)\r\n2017-11-07 02:54:32,135 [myid:2] - WARN  [RecvWorker:1:QuorumCnxManager$RecvWorker@783] - Interrupting SendWorker\r\n2017-11-07 02:54:32,135 [myid:2] - WARN  [SendWorker:1:QuorumCnxManager$SendWorker@697] - Interrupted while waiting for message on queue\r\njava.lang.InterruptedException\r\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.reportInterruptAfterWait(AbstractQueuedSynchronizer.java:2014)\r\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2088)\r\n        at java.util.concurrent.ArrayBlockingQueue.poll(ArrayBlockingQueue.java:418)\r\n        at org.apache.zookeeper.server.quorum.QuorumCnxManager.pollSendQueue(QuorumCnxManager.java:849)\r\n        at org.apache.zookeeper.server.quorum.QuorumCnxManager.access$500(QuorumCnxManager.java:64)\r\n        at org.apache.zookeeper.server.quorum.QuorumCnxManager$SendWorker.run(QuorumCnxManager.java:685)\r\n2017-11-07 02:54:32,135 [myid:2] - WARN  [SendWorker:1:QuorumCnxManager$SendWorker@706] - Send worker leaving thread\r\n{code}\r\n\r\nFrom the reported occurrences, it looks like this is a problem only when the node with the smallest {{myid}} loses connection.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Server is unable to join quorum after connection broken to other peers","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bothra90","name":"bothra90","key":"bothra90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhay Bothra","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bothra90","name":"bothra90","key":"bothra90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhay Bothra","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13117142/comment/16245047","id":"16245047","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bothra90","name":"bothra90","key":"bothra90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhay Bothra","active":true,"timeZone":"America/Los_Angeles"},"body":"We're also wondering if this could be related to ZOOKEEPER-1732 and ZOOKEEPER-2172","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bothra90","name":"bothra90","key":"bothra90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhay Bothra","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-11-09T01:10:23.772+0000","updated":"2017-11-09T01:12:19.135+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13117142/comment/16361076","id":"16361076","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adamjshook","name":"adamjshook","key":"adamjshook","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam J Shook","active":true,"timeZone":"America/New_York"},"body":"We are experiencing this as well, but the node that continually drops the connection does not have the smallest {{myid}} – here it is 6 but 5 is the smallest (5, 6, 7 are the IDs).  ZooKeeper 3.4.6.  Killing the leader resulted in the full ensemble returning.\r\n\r\n{code:java}\r\n2018-02-12 16:29:48,428 [myid:6] - INFO  [Thread-1:QuorumCnxManager$Listener@504] - My election bind port: /10.122.11.104:6666\r\n2018-02-12 16:29:48,440 [myid:6] - INFO  [QuorumPeer[myid=6]/0.0.0.0:4444:QuorumPeer@714] - LOOKING\r\n2018-02-12 16:29:48,443 [myid:6] - INFO  [QuorumPeer[myid=6]/0.0.0.0:4444:FastLeaderElection@815] - New election. My id =  6, proposed zxid=0x1b00653e67\r\n2018-02-12 16:29:48,453 [myid:6] - INFO  [WorkerSender[myid=6]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (7, 6)\r\n2018-02-12 16:29:48,453 [myid:6] - INFO  [WorkerReceiver[myid=6]:FastLeaderElection@597] - Notification: 1 (message format version), 6 (n.leader), 0x1b00653e67 (n.zxid), 0x1 (n.round), LOOKING (n.state), 6 (\r\nn.sid), 0x1b (n.peerEpoch) LOOKING (my state)\r\n2018-02-12 16:29:48,657 [myid:6] - INFO  [QuorumPeer[myid=6]/0.0.0.0:4444:FastLeaderElection@849] - Notification time out: 400\r\n2018-02-12 16:29:48,657 [myid:6] - INFO  [WorkerReceiver[myid=6]:FastLeaderElection@597] - Notification: 1 (message format version), 6 (n.leader), 0x1b00653e67 (n.zxid), 0x1 (n.round), LOOKING (n.state), 6 (\r\nn.sid), 0x1b (n.peerEpoch) LOOKING (my state)\r\n2018-02-12 16:29:48,658 [myid:6] - INFO  [WorkerSender[myid=6]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (7, 6)\r\n2018-02-12 16:29:49,058 [myid:6] - INFO  [QuorumPeer[myid=6]/0.0.0.0:4444:FastLeaderElection@849] - Notification time out: 800\r\n2018-02-12 16:29:49,058 [myid:6] - INFO  [WorkerReceiver[myid=6]:FastLeaderElection@597] - Notification: 1 (message format version), 6 (n.leader), 0x1b00653e67 (n.zxid), 0x1 (n.round), LOOKING (n.state), 6 (\r\nn.sid), 0x1b (n.peerEpoch) LOOKING (my state)\r\n2018-02-12 16:29:49,859 [myid:6] - INFO  [QuorumPeer[myid=6]/0.0.0.0:4444:FastLeaderElection@849] - Notification time out: 1600\r\n2018-02-12 16:29:50,058 [myid:6] - INFO  [WorkerSender[myid=6]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (7, 6)\r\n2018-02-12 16:29:50,059 [myid:6] - INFO  [WorkerReceiver[myid=6]:FastLeaderElection@597] - Notification: 1 (message format version), 6 (n.leader), 0x1b00653e67 (n.zxid), 0x1 (n.round), LOOKING (n.state), 6 (\r\nn.sid), 0x1b (n.peerEpoch) LOOKING (my state)\r\n2018-02-12 16:29:50,059 [myid:6] - INFO  [WorkerSender[myid=6]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (7, 6)\r\n2018-02-12 16:29:51,660 [myid:6] - INFO  [QuorumPeer[myid=6]/0.0.0.0:4444:FastLeaderElection@849] - Notification time out: 3200\r\n2018-02-12 16:29:51,660 [myid:6] - INFO  [WorkerReceiver[myid=6]:FastLeaderElection@597] - Notification: 1 (message format version), 6 (n.leader), 0x1b00653e67 (n.zxid), 0x1 (n.round), LOOKING (n.state), 6 (\r\nn.sid), 0x1b (n.peerEpoch) LOOKING (my state)\r\n2018-02-12 16:29:51,660 [myid:6] - INFO  [WorkerSender[myid=6]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (7, 6)\r\n2018-02-12 16:29:54,861 [myid:6] - INFO  [QuorumPeer[myid=6]/0.0.0.0:4444:FastLeaderElection@849] - Notification time out: 6400\r\n2018-02-12 16:29:54,861 [myid:6] - INFO  [WorkerReceiver[myid=6]:FastLeaderElection@597] - Notification: 1 (message format version), 6 (n.leader), 0x1b00653e67 (n.zxid), 0x1 (n.round), LOOKING (n.state), 6 (\r\nn.sid), 0x1b (n.peerEpoch) LOOKING (my state)\r\n2018-02-12 16:29:54,862 [myid:6] - INFO  [WorkerSender[myid=6]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (7, 6)\r\n2018-02-12 16:30:01,262 [myid:6] - INFO  [QuorumPeer[myid=6]/0.0.0.0:4444:FastLeaderElection@849] - Notification time out: 12800\r\n2018-02-12 16:30:01,263 [myid:6] - INFO  [WorkerReceiver[myid=6]:FastLeaderElection@597] - Notification: 1 (message format version), 6 (n.leader), 0x1b00653e67 (n.zxid), 0x1 (n.round), LOOKING (n.state), 6 (\r\nn.sid), 0x1b (n.peerEpoch) LOOKING (my state)\r\n2018-02-12 16:30:01,263 [myid:6] - INFO  [WorkerSender[myid=6]:QuorumCnxManager@193] - Have smaller server identifier, so dropping the connection: (7, 6)\r\n2018-02-12 16:30:02,050 [myid:6] - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:4444:NIOServerCnxnFactory@197] - Accepted socket connection from /127.0.0.1:54541\r\n2018-02-12 16:30:02,057 [myid:6] - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:4444:NIOServerCnxn@827] - Processing ruok command from /127.0.0.1:54541\r\n2018-02-12 16:30:02,060 [myid:6] - INFO  [Thread-2:NIOServerCnxn@1007] - Closed socket connection for client /127.0.0.1:54541 (no session established for client)\r\n2018-02-12 16:30:02,449 [myid:6] - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:4444:NIOServerCnxnFactory@197] - Accepted socket connection from /127.0.0.1:54611\r\n2018-02-12 16:30:02,450 [myid:6] - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:4444:NIOServerCnxn@827] - Processing ruok command from /127.0.0.1:54611\r\n2018-02-12 16:30:02,451 [myid:6] - INFO  [Thread-3:NIOServerCnxn@1007] - Closed socket connection for client /127.0.0.1:54611 (no session established for client)\r\n2018-02-12 16:30:02,789 [myid:6] - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:4444:NIOServerCnxnFactory@197] - Accepted socket connection from /127.0.0.1:54671\r\n2018-02-12 16:30:02,790 [myid:6] - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:4444:NIOServerCnxn@827] - Processing ruok command from /127.0.0.1:54671\r\n2018-02-12 16:30:02,791 [myid:6] - INFO  [Thread-4:NIOServerCnxn@1007] - Closed socket connection for client /127.0.0.1:54671 (no session established for client)\r\n... these messages continue\r\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adamjshook","name":"adamjshook","key":"adamjshook","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam J Shook","active":true,"timeZone":"America/New_York"},"created":"2018-02-12T16:59:54.133+0000","updated":"2018-02-12T17:13:53.799+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13117142/comment/16370875","id":"16370875","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bothra90","name":"bothra90","key":"bothra90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhay Bothra","active":true,"timeZone":"America/Los_Angeles"},"body":"On our other quorum peers, we see a lot of connections in CLOSE_WAIT state to port 4181. Could these somehow prevent the quorum peer from processing leader election messages from the affected peer?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bothra90","name":"bothra90","key":"bothra90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhay Bothra","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-21T02:40:20.506+0000","updated":"2018-02-21T02:40:20.506+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13117142/comment/16423586","id":"16423586","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sumitagrawal","name":"sumitagrawal","key":"sumitagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"sumit agrawal","active":true,"timeZone":"Etc/UTC"},"body":"We have received similar issue in quorum of 5 nodes, id: 1, 2, 3, 4, 5. Here 2 & 4 have connection error from node 3. Node 5 is leader.\r\n\r\nNode 3 while connecting to 2 & 4 failed due to connection error. But its giving similar error:\r\nHave smaller server identifier, so dropping the connection: (5, 3)\r\nAnd node 3 not able to join the quorum. But it should join (but 3 nodes are running as required for quorum).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sumitagrawal","name":"sumitagrawal","key":"sumitagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"sumit agrawal","active":true,"timeZone":"Etc/UTC"},"created":"2018-04-03T07:30:03.939+0000","updated":"2018-04-03T07:30:03.939+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13117142/comment/16472472","id":"16472472","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"[~bothra90]\r\n\r\nThanks for reporting this issue, I'm taking a look at it. You mentioned that's it might be related to ZOOKEEPER-1732, are you sure about that? That would mean that it had never been fixed.\r\n\r\nBecause the log snippet you provided and the one I can see from [~adamjshook] doesn't seem to me related. In the original issue there wasn't any connection problem between the participants. The node was unable to join the ensemble even though it had all the necessary information of the running ensembe. (e.g. all notifications from other servers)\r\n\r\n[~sumitagrawal] This applies to your report as well, it looks like you all had similar issues, but I doubt it's anyhow related to 1732.\r\n\r\n[~fpj] Would you please take a very quick look at this ticket?\r\n\r\nYou worked on the original issues and might be able to confirm that this is not related. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-05-11T18:47:34.357+0000","updated":"2018-05-11T18:47:34.357+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13117142/comment/16476555","id":"16476555","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"[~bothra90] [~adamjshook] [~sumitagrawal]\r\n\r\nAre you saying that restarting only the failing node didn't solve the problem?\r\n\r\nSo, basically you had to restart the leader itself to get the full ensemble working again?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-05-15T22:25:09.871+0000","updated":"2018-05-15T22:25:09.871+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13117142/comment/16476920","id":"16476920","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bothra90","name":"bothra90","key":"bothra90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhay Bothra","active":true,"timeZone":"America/Los_Angeles"},"body":"[~andorm]: Yes, restarting the failing node does not help, but restarting the leader does.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bothra90","name":"bothra90","key":"bothra90","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhay Bothra","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-05-16T06:38:39.248+0000","updated":"2018-05-16T06:38:39.248+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2938/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3mkkv:"}}