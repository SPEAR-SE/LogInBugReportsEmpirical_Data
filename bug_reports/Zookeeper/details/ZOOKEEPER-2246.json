{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12855756","self":"https://issues.apache.org/jira/rest/api/2/issue/12855756","key":"ZOOKEEPER-2246","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326518","id":"12326518","name":"3.6.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12343268","id":"12343268","description":"Beta release against 3.5 branch","name":"3.5.5","archived":false,"released":false}],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-08-13T06:52:17.217+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Sep 16 06:44:35 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2246/watchers","watchCount":8,"isWatching":false},"created":"2015-08-13T02:44:54.933+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12470593","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12470593","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12754914","key":"ZOOKEEPER-2080","self":"https://issues.apache.org/jira/rest/api/2/issue/12754914","fields":{"summary":"Fix deadlock in dynamic reconfiguration","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-05-10T20:09:09.801+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312379","id":"12312379","name":"quorum","description":"Quorum determination for ZooKeeper"}],"timeoriginalestimate":null,"description":"Receive worker can take a long time to shut down because the socket timeout is set to zero: http://s.apache.org/TfI\n\nThere was a discussion on the mailing list a while back: http://s.apache.org/cYG","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12755516","id":"12755516","filename":"0001-ZOOKEEPER-2246-quorum-connection-manager-takes-a-lon.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pmvmware","name":"pmvmware","key":"pmvmware","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Powell Molleti","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-11T23:38:52.278+0000","size":11167,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12755516/0001-ZOOKEEPER-2246-quorum-connection-manager-takes-a-lon.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"quorum connection manager takes a long time to shut down","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michim","name":"michim","key":"michim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michi Mutsuzaki","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michim","name":"michim","key":"michim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michi Mutsuzaki","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12855756/comment/14694804","id":"14694804","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Yes, a timeout of zero is interpreted as an infinite timeout. I'm not seeing any specific reason for waiting infinitely. IMHO, timeout could be {{self.tickTime * self.syncLimit}} similar to SendWorker thread.\n{code}\n     // OK to wait until socket disconnects while reading.\n     sock.setSoTimeout(0);\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-08-13T06:52:17.217+0000","updated":"2015-08-13T06:52:17.217+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12855756/comment/14703612","id":"14703612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geek101","name":"geek101","key":"geek101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Powell Molleti","active":true,"timeZone":"America/Los_Angeles"},"body":"Java doc for SO_TIMEOUT http://bit.ly/1LjGGVq implies that this timeout is only for blocking calls and does not apply for send() aka writes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geek101","name":"geek101","key":"geek101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Powell Molleti","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-08-19T19:26:36.246+0000","updated":"2015-08-19T19:26:36.246+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12855756/comment/14724085","id":"14724085","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pmvmware","name":"pmvmware","key":"pmvmware","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Powell Molleti","active":true,"timeZone":"America/Los_Angeles"},"body":"Plainly removing  sock.setSoTimeout(0) from http://s.apache.org/TfI has the unintended consequence of shutting down both the RecvWorker and SendWorker threads for all cases. Seems like current code is designed to  keep the socket alive (and threads to keep running) so as to reuse this channel to communicate again with the the peer node which still alive but needs to redo leader election.\n\nI could not reproduce any issue if threads shutdown after the timeout since new threads are created for next iteration of leader election. I rather would like to reuse the threads and the channel hence I propose the following approach.\n\nThe alternative I suggest is to still remove setSoTimeout(0) from here: http://s.apache.org/TfI  , also enable SO_KEEPALIVE via setKeepAlive() on this socket and do not consider it an error when timeout occurs here: http://bit.ly/1JHIdVY but consider it an error when it happens here: http://bit.ly/1NTjQ9R\n\nThis means that users can play with keep alive timeouts for TCP sockets to quicken TCP socket failures propagating to user-space and zookeeper also resets the socket if it detects other side is not responding when it knows it needs a response within some bounded time.\n\nIdeally I wish there is some userspace pings of every socket channel between zookeeper nodes to detect dead channels quickly. Seems like one exists for sockets that do Follow/Lead after leader election is done but not for this?. Such a feature could be added with care towards making it backward compatible.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pmvmware","name":"pmvmware","key":"pmvmware","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Powell Molleti","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-08-31T21:35:09.268+0000","updated":"2015-08-31T21:35:09.268+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12855756/comment/14740516","id":"14740516","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=suda","name":"suda","key":"suda","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akihiro Suda","active":true,"timeZone":"Asia/Tokyo"},"body":"ZOOKEEPER-2080 seems tightly related to this.\n\nhttps://issues.apache.org/jira/browse/ZOOKEEPER-2080?focusedCommentId=14740513&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14740513\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=suda","name":"suda","key":"suda","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akihiro Suda","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-09-11T10:06:51.361+0000","updated":"2015-09-11T10:06:51.361+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12855756/comment/14741739","id":"14741739","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pmvmware","name":"pmvmware","key":"pmvmware","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Powell Molleti","active":true,"timeZone":"America/Los_Angeles"},"body":"ZOOKEEPER-2246: quorum connection manager takes a long time to shut down\n    \n    Enable SO_TIMEOUT and SO_KEEPALIVE for the socket.\n    Do not close the socket on a read timeout for reading the header of the msg.\n    \n    Patch submitted by VMWare Inc.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pmvmware","name":"pmvmware","key":"pmvmware","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Powell Molleti","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-11T23:38:52.281+0000","updated":"2015-09-11T23:38:52.281+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12855756/comment/14743356","id":"14743356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=suda","name":"suda","key":"suda","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akihiro Suda","active":true,"timeZone":"Asia/Tokyo"},"body":"Hi [~pmvmware], +1 for your great patch.\n\nUnfortunately I can still hit ZOOKEEPER-2080 with your patch.\n\nI consider this is because the socket is still uninterruptible, and \n{{java.nio.channels.SocketChannel}} (which is interruptible) looks better than plain old {{java.net.Socket}}.\n\nIf you have a different opinion about interruption handling, please let me know.\n\nThanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=suda","name":"suda","key":"suda","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akihiro Suda","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-09-14T10:49:11.466+0000","updated":"2015-09-14T10:49:11.466+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12855756/comment/14743357","id":"14743357","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=suda","name":"suda","key":"suda","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akihiro Suda","active":true,"timeZone":"Asia/Tokyo"},"body":"Hi [~pmvmware], +1 for your great patch.\n\nUnfortunately I can still hit ZOOKEEPER-2080 with your patch.\n\nI consider this is because the socket is still uninterruptible, and \n{{java.nio.channels.SocketChannel}} (which is interruptible) looks better than plain old {{java.net.Socket}}.\n\nIf you have a different opinion about interruption handling, please let me know.\n\nThanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=suda","name":"suda","key":"suda","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akihiro Suda","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-09-14T10:49:12.017+0000","updated":"2015-09-14T10:49:12.017+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12855756/comment/14746057","id":"14746057","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pmvmware","name":"pmvmware","key":"pmvmware","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Powell Molleti","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Akihiro,\n\nThanks for looking at the patch. Reading up on SocketChannel and InputStream/OutputStream you are correct about better interrupt-ability of SocketChannel while performing read/write operations.\n\nHowever looking at the code of RecvWorker/SendWorker/Listener and Halt() in QCM class it seems like CloseSocket() is called for all paths before calling thread.interrupt(). And since both read() and write() operations throw IOException when socket is already closed I think a blocking read() should throw an exception if socket is closed. Hence the shutdown of these threads seems safe as far finish() , halt() code paths are concerned. \n\nI tried to look at logs from [ZOOKEEPER-2080|https://issues.apache.org/jira/browse/ZOOKEEPER-2080] and I am unable to reach any conclusion on using SocketChannel could solve the problem or that is even the root cause of that issue. I will continue to look at it more closely.\n\nI can however modify the patch to use SocketChannel instead of InputStream/OutputStream and perhaps you can help try to reproduce it with that?.\n\nLet me know.\nthanks\nPowell.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pmvmware","name":"pmvmware","key":"pmvmware","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"Powell Molleti","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-15T20:02:56.260+0000","updated":"2015-09-15T20:02:56.260+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12855756/comment/14746992","id":"14746992","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=suda","name":"suda","key":"suda","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akihiro Suda","active":true,"timeZone":"Asia/Tokyo"},"body":"Hi, [~pmvmware]\n\nYes, you got a point.\n\nActually, I found old ZooKeeper (< 3.4.0) had used blocking-mode {{java.nio.channels.SocketChannel}}.\nHowever, it has been replaced to {{java.net.Socket}} since [{{b6e612}}|https://github.com/apache/zookeeper/commit/b6e612a6a075ed1dc44addafc480c20ff972b54a] (17 Nov 2010) so as to support {{SO_TIMEOUT}}. (ZOOKEEPER-900)\n(It is possible to support {{SO_TIMEOUT}} in {{java.nio.channels.SocketChannel}}, but needs an eccentric trick: https://technfun.wordpress.com/2009/01/29/networking-in-java-non-blocking-nio-blocking-nio-and-io/)\n\nNote that there has been 5 years of strong desire for drastic refactoring of QCM  (ZOOKEEPER-901), but it might take a time to get resolved.\n\nSo I suggest to merge the patch, and call it a day for the moment.\n\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=suda","name":"suda","key":"suda","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akihiro Suda","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-09-16T06:44:35.116+0000","updated":"2015-09-16T06:44:35.116+0000"}],"maxResults":9,"total":9,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2246/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2iuy7:"}}