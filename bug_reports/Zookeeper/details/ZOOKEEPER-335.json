{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12416126","self":"https://issues.apache.org/jira/rest/api/2/issue/12416126","key":"ZOOKEEPER-335","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314469","id":"12314469","description":"Kerberos client auth, multi support, deb/rpm pkging.","name":"3.4.0","archived":false,"released":true,"releaseDate":"2011-11-22"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-06-02T18:45:38.326+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jun 17 10:57:10 UTC 2011","customfield_12310420":"47894","customfield_12312320":null,"customfield_12310222":"10002_*:*_2_*:*_426907318_*|*_1_*:*_2_*:*_71408616015_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-06-14T05:14:31.874+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-335/watchers","watchCount":7,"isWatching":false},"created":"2009-03-04T18:55:48.570+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"9.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313381","id":"12313381","description":"Focus on system test, operations documentation, and begin multi-tenancy investigation.","name":"3.1.0","archived":false,"released":true,"releaseDate":"2009-02-13"}],"issuelinks":[{"id":"12332606","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12332606","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12467595","key":"ZOOKEEPER-790","self":"https://issues.apache.org/jira/rest/api/2/issue/12467595","fields":{"summary":"Last processed zxid set prematurely while establishing leadership","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12345059","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12345059","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"outwardIssue":{"id":"12529897","key":"ZOOKEEPER-1278","self":"https://issues.apache.org/jira/rest/api/2/issue/12529897","fields":{"summary":"acceptedEpoch not handling zxid rollover in lower 32bits","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-11-23T19:22:30.010+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"currently the zookeeper followers do not commit the new leader election. This will cause problems in a failure scenarios with a follower acking to the same leader txn id twice, which might be two different intermittent leaders and allowing them to propose two different txn's of the same zxid.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12447658","id":"12447658","filename":"faultynode-vishal.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-22T03:03:07.191+0000","size":116726,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12447658/faultynode-vishal.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12447392","id":"12447392","filename":"zk.log.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=msolo","name":"msolo","key":"msolo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Solomon","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-17T22:16:27.127+0000","size":5061,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12447392/zk.log.gz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12447490","id":"12447490","filename":"zklogs.tar.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-18T20:06:50.149+0000","size":76728,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12447490/zklogs.tar.gz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12481666","id":"12481666","filename":"ZOOKEEPER-335_2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-07T06:48:07.344+0000","size":57022,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12481666/ZOOKEEPER-335_2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12481730","id":"12481730","filename":"ZOOKEEPER-335_3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-07T18:32:00.595+0000","size":58993,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12481730/ZOOKEEPER-335_3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12481761","id":"12481761","filename":"ZOOKEEPER-335_4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-08T00:13:36.444+0000","size":59649,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12481761/ZOOKEEPER-335_4.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12481990","id":"12481990","filename":"ZOOKEEPER-335_5.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-09T22:48:42.827+0000","size":59469,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12481990/ZOOKEEPER-335_5.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12481665","id":"12481665","filename":"ZOOKEEPER-335.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-07T05:47:48.203+0000","size":56053,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12481665/ZOOKEEPER-335.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12449532","id":"12449532","filename":"ZOOKEEPER-790.travis.log.bz2","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-07-15T03:24:55.989+0000","size":44747,"mimeType":"application/x-bzip2","content":"https://issues.apache.org/jira/secure/attachment/12449532/ZOOKEEPER-790.travis.log.bz2"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"33127","customfield_12312823":null,"summary":"zookeeper servers should commit the new leader txn to their logs.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"subtasks":[{"id":"12508720","key":"ZOOKEEPER-1081","self":"https://issues.apache.org/jira/rest/api/2/issue/12508720","fields":{"summary":"modify leader/follower code to correctly deal with new leader","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}},{"id":"12508721","key":"ZOOKEEPER-1082","self":"https://issues.apache.org/jira/rest/api/2/issue/12508721","fields":{"summary":"modify leader election to correctly take into account current epoch","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12724318","id":"12724318","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"body":"to fix this issue we require server -server protocol change. Thsi protocol change will break backwards compatibility. To maintain backwards compatibility the code becomes quite complex and tricky. Instead of making a last minute change and having to do al lthe testing to check if backwards compatibily for servers is maintained, I am moving it to 3.3 to see if we want to fix it in a backwards compatible manner or fix it in 4.0 and break backwards compatibility. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-25T22:02:48.356+0000","updated":"2009-06-25T22:02:48.356+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12843639","id":"12843639","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"body":"given the change is non trivial as mentioned above, I am moving this to 3.4 for now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-10T17:16:37.260+0000","updated":"2010-03-10T17:16:37.260+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12874733","id":"12874733","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Raising to blocker level - we've seen this reported by users a couple times now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-02T18:45:38.326+0000","updated":"2010-06-02T18:45:38.326+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12874888","id":"12874888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=charitymid","name":"charitymid","key":"charitymid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Charity Majors","active":true,"timeZone":"Etc/UTC"},"body":"I ran into this bug this morning, but it also seemed to put my cluster into an unusable state.  The cluster stopped accepting all connections, until I restarted node one.  After node one departed the cluster, nodes two and three formed a quorum and started serving again.  Node one was unable to rejoin, and had this error:\n\n2010-06-02 17:04:56,486 - FATAL [QuorumPeer:/0:0:0:0:0:0:0:0:2181:Follower@71] - Leader epoch a is less than our epoch b\n2010-06-02 17:04:56,486 - WARN  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:Follower@82] - Exception when following the leader\njava.io.IOException: Error: Epoch of leader is lower\n\nuntil I cleared the data directory and restarted again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=charitymid","name":"charitymid","key":"charitymid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Charity Majors","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-03T00:31:54.011+0000","updated":"2010-06-03T00:31:54.011+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12879520","id":"12879520","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n\nWe are running into this bug very often (almost 60-75% hit rate) while testing our newly developed application over ZK.\nThis is almost a blocker for us. Will the fix be simplified if backward compatibility was not an issue?\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-16T21:47:17.689+0000","updated":"2010-06-16T21:47:17.689+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12879548","id":"12879548","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"We are unable to reproduce this issue. If you can provide the server logs (all servers) and attach them to this jira it would be very helpful. Some detail on the approx time of the issue so we can correlate to the logs would help too (summary of what you did/do to cause it, etc... anything that might help us nail this one down).\n\nDetail on ZK version, OS, Java version, HW info, etc... would also be of use to us. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-16T22:23:48.187+0000","updated":"2010-06-16T22:23:48.187+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12879967","id":"12879967","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=msolo","name":"msolo","key":"msolo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Solomon","active":true,"timeZone":"Etc/UTC"},"body":"I am having this exact issue, but I am not upgrading. I am merely restarting the cluster.\n\nI have a cluster of three. I took down host1 and verified that my application remained and reconnected to host2 and host3.\n\nWith host1 back online, I took down host2. I noticed that the java process was spinning over 100% CPU and realized it had not come back up.\n\nThis is running the 3.3.0 JAR release on a dual proc, quad-core Intel box. I'm running SuSE 10.3, 64-bit, with this version of java:\n\njava version \"1.6.0_10\"\nJava(TM) SE Runtime Environment (build 1.6.0_10-b33)\nJava HotSpot(TM) Server VM (build 11.0-b15, mixed mode)\n\nI will attach a log file.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=msolo","name":"msolo","key":"msolo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Solomon","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-17T22:14:28.064+0000","updated":"2010-06-17T22:14:28.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12879968","id":"12879968","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=msolo","name":"msolo","key":"msolo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Solomon","active":true,"timeZone":"Etc/UTC"},"body":"This is the log file of my second attempt to restart a wedged zookeeper server.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=msolo","name":"msolo","key":"msolo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Solomon","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-17T22:16:27.194+0000","updated":"2010-06-17T22:16:27.194+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12880001","id":"12880001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for the log Mike. This issue does seem similar to what Charity reported:\n\n2010-06-17 14:35:34,263 - FATAL [QuorumPeer:/0:0:0:0:0:0:0:0:2181:Follower@71] - Leader epoch 1 is less than our epoch 2\n\nUnfortunately the attached log shows information only after the problem occurred. Any chance you could upload the logs during the initial event? (what I mean is when the problem originally started) Also the logs from the other servers in the ensemble (again, at the time that the problem originally occurred) would really help. Thanks.\n\nHave you been able to clear the problem? It's fairly straightforward to resolve - Charity resolved by; 1) bring down the failing server, 2) clear the data directory of that server (only), 3) start that server. You only want to do this for the server that's unable to rejoin the quorum - ie the one thats outputting \"Leader epoch 1 is less than our epoch 2\", _not_ for all servers in the ensemble.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-17T23:33:14.610+0000","updated":"2010-06-17T23:33:14.610+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12880202","id":"12880202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Mike, There is one thing I don't understand. From the logs, it looks like servers 1 and 3 are proposing a zxid of 0 (second field of notification) during election, which makes me think that they had no state at all:\n\n{noformat}\n2010-06-17 14:35:40,714 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FastLeaderElection@689] - Notification: 2, 8589934884, 2, 2, LOOKING, LOOKING, 2\n2010-06-17 14:35:40,714 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FastLeaderElection@799] - Notification: 3, 0, 1, 2, LOOKING, FOLLOWING, 1\n2010-06-17 14:35:40,714 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FastLeaderElection@799] - Notification: 3, 0, 1, 2, LOOKING, LEADING, 3\n{noformat}\n\nServer 2 on the other hand had accepted updates based on the zxid it proposes. Were they supposed to have no state at all? Have you deleted your logs and snapshots before restarting the servers? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2010-06-18T13:38:50.467+0000","updated":"2010-06-18T13:38:50.467+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12880234","id":"12880234","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Side note: Flavio can you enter a JIRA to fix this log message, it would really be helpful to have attribute names in the log message do simplify debugging. (general review of quorum logging would be great, fix stuff like this and ensure that enough information is provided to debug - add logging?) Perhaps coordinate with Ivan, I think he was trying to change things a bit to enable more log analysis support in the \"loggrapher\" contrib.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-18T15:55:31.288+0000","updated":"2010-06-18T15:55:31.288+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12880305","id":"12880305","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n\nI have attached the logs. The log entries are similar to those reported by others.\n\nWe are testing with 3 nodes. Each node is run in a VM running SLES 11. All 3 VMs are run on the same host. VMs are sharing the same disk. cpuinfo and meminfo for VM is in the attached file.\nI have also tried to collect more info with -verbose:gc -Xloggc:/../ -Xprof options to java.\n\ngc.lg contains the gc output\nrest of the info should be in msgs.log\nDefault java heap size was used. java version  \"1.6.0_18\" was used.\n\nOne point to note - In my case, on the misbehaving node could not joing the cluster. Rest of the cluster was stable (except for the flood of log messages on the leader because the misbehaving follower kept terminating session).\n\nHope this helps.\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-18T20:06:50.328+0000","updated":"2010-06-18T20:06:50.328+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12880320","id":"12880320","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Guys, I don't see enough information in these logs to determine what's going on. Let me tell you what I'm seeing so that perhaps other folks can help me out here. \n\nOne part of the log that is suspicious is this one:\n\n{noformat}\n=6693 [QuorumPeer:/0.0.0.0:2181] WARN  org.apache.zookeeper.server.quorum.Learner  - Got zxid 0x300000001 expected 0x1\n=6693 [QuorumPeer:/0.0.0.0:2181] WARN  org.apache.zookeeper.server.quorum.Learner  - Got zxid 0x300000001 expected 0x1\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor30]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor27]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor22]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor23]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor18]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor20]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor19]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor31]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor21]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor26]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor25]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor33]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor29]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor28]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor24]\n[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor32]\n\n************* NODE RESTARTED HERE **********************\n{noformat}\n\nBefore being restarted, the bad node receives a proposal with zxid <3,1> and it expects <0,1>. Next in the logs after being restarted, I can see that it is complaining that it has epoch 4 and the leader 3. Something strange apparently happened during the restart. It also seems to be the case that the node was being able to talk to the others (first entries in the log before the excerpt above).\n\nDo you guys see anything I'm overlooking?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2010-06-18T20:48:30.426+0000","updated":"2010-06-18T20:48:30.426+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12880917","id":"12880917","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"vishal comment on list:\n\n\nI might be wrong here, but let me try to chip in my few cents.\n\nI think the problem is in LearnerHandler.java at the leader fo this\nFollower.\n\n            /* see what other packets from the proposal\n             * and tobeapplied queues need to be sent\n             * and then decide if we can just send a DIFF\n             * or we actually need to send the whole snapshot\n             */\n            long leaderLastZxid = leader.startForwarding(this, updates);\n---> this leaderLastZxid returned is probably incorrect.\n            // a special case when both the ids are the same\n            if (peerLastZxid == leaderLastZxid) {\n                packetToSend = Leader.DIFF;\n                zxidToSend = leaderLastZxid;\n            }\n\n            QuorumPacket newLeaderQP = new QuorumPacket(Leader.NEWLEADER,\n                    leaderLastZxid, null, null);\n            oa.writeRecord(newLeaderQP, \"packet\");\n            bufferedOutput.flush()\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-21T18:02:54.064+0000","updated":"2010-06-21T18:02:54.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12880918","id":"12880918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"vishal comment on list:\n\n\nNevermind. I am on the wrong track. Flavio's earlier mail did clarify that\nthe follower received the epoch before restart.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-21T18:03:12.097+0000","updated":"2010-06-21T18:03:12.097+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12880919","id":"12880919","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Vishal comment on list:\n\n\nHi Flavio,\n\nI have 3 set of logs and they all seem to indicate two problems on the\nmisbehaving follower:\n\nProblem 1: Expected zxid is incorrect\n=0    [QuorumPeer:/0.0.0.0:2181] WARN\norg.apache.zookeeper.server.quorum.Learner  - Got zxid 0x300000002 expected\n0x1\n=0    [QuorumPeer:/0.0.0.0:2181] WARN\norg.apache.zookeeper.server.quorum.Learner  - Got zxid 0x300000002 expected\n0x1\n=2495 [QuorumPeer:/0.0.0.0:2181] WARN\norg.apache.zookeeper.server.quorum.Learner  - Got zxid 0x400000001 expected\n0x1\n=2495 [QuorumPeer:/0.0.0.0:2181] WARN\norg.apache.zookeeper.server.quorum.Learner  - Got zxid 0x400000001 expected\n0x1\n=191617 [QuorumPeer:/0.0.0.0:2181] WARN\norg.apache.zookeeper.server.quorum.Learner  - Got zxid 0x500000001 expected\n0x1\n=191617 [QuorumPeer:/0.0.0.0:2181] WARN\norg.apache.zookeeper.server.quorum.Learner  - Got zxid 0x500000001 expected\n0x1\n=0    [QuorumPeer:/0.0.0.0:2181] WARN\norg.apache.zookeeper.server.quorum.Learner  - Got zxid 0x600000001 expected\n0x1\n=0    [QuorumPeer:/0.0.0.0:2181] WARN\norg.apache.zookeeper.server.quorum.Learner  - Got zxid 0x600000001 expected\n0x1\n=245016 [QuorumPeer:/0.0.0.0:2181] WARN\norg.apache.zookeeper.server.quorum.Learner  - Got zxid 0x700000001 expected\n0x1\n=245016 [QuorumPeer:/0.0.0.0:2181] WARN\norg.apache.zookeeper.server.quorum.Learner  - Got zxid 0x700000001 expected\n0x1\n\nNote expected zxid is always 0x1 (lastQueued is always 0?)\n\nProblem 2: While joining the cluster expected epoch is 1 higher than seen\nearlier\n=14991 [QuorumPeer:/0.0.0.0:2181] FATAL\norg.apache.zookeeper.server.quorum.Learner  - Leader epoch 7 is less than\nour epoch 8\n\n-Vishal\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-21T18:03:30.275+0000","updated":"2010-06-21T18:03:30.275+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12881028","id":"12881028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n\nI enabled tracing and did some more debugging. Looks like the restarted peer (and trying to join the cluster) determines that it is a leader and increments its epoch. However, rest of the nodes don't acknowledge this node as the leader, and hence, have an older epoch. I will attache the log. Unfortunately, I don't have traces from other nodes. I will repeat the experiment later and attache logs from other nodes. \n\nScenario:\n- Form a 3 node cluster. This is not just ZK cluster. It also involves our application cluster that uses ZK.\n- Kill one of the follower\n- After a minute or so restart follower\n- Follower rejects leader with \"Leader epoch y is less than our epoch y + 1\"\n\nFrom logs:\n\na) Peer X restarts and starts leader election.\na) For a small window of time, X thinks that it is the new leader! During this window, for some reason, rest of the nodes tell X that they are also trying to find a leader. I.e., all 3 nodes are in LOOKING state. After seeing that all 3 nodes are in LOOKING state, X decides to be a leader?\n\n   155 2010-06-20 23:22:46,421 - DEBUG [WorkerSender Thread:QuorumCnxManager@346] - Opening channel to server 1\n   156 2010-06-20 23:22:46,423 - DEBUG [WorkerReceiver Thread:FastLeaderElection$Messenger$WorkerReceiver@214] - Receive new notification message. My id = 0\n   157 2010-06-20 23:22:46,424 - INFO  [QuorumPeer:/0.0.0.0:2181:FastLeaderElection@689] - Notification: 0, 77309411393, 1, 0, LOOKING, LOOKING, 0\n   158 2010-06-20 23:22:46,424 - DEBUG [QuorumPeer:/0.0.0.0:2181:FastLeaderElection@495] - id: 0, proposed id: 0, zxid: 77309411393, proposed zxid: 77309411393\n   159 2010-06-20 23:22:46,424 - DEBUG [QuorumPeer:/0.0.0.0:2181:FastLeaderElection@717] - Adding vote: From = 0, Proposed leader = 0, Porposed zxid = 77309411393, Proposed epoch = 1\n   160 2010-06-20 23:22:46,426 - INFO  [WorkerSender Thread:QuorumCnxManager@162] - Have smaller server identifier, so dropping the connection: (1, 0)\n   161 2010-06-20 23:22:46,426 - DEBUG [WorkerSender Thread:QuorumCnxManager@346] - Opening channel to server 2\n   162 2010-06-20 23:22:46,427 - DEBUG [Thread-1:QuorumCnxManager$Listener@445] - Connection request /192.168.1.182:46701\n   163 2010-06-20 23:22:46,427 - DEBUG [Thread-1:QuorumCnxManager$Listener@448] - Connection request: 0\n   164 2010-06-20 23:22:46,428 - DEBUG [Thread-1:QuorumCnxManager$SendWorker@504] - Address of remote peer: 1\n   165 2010-06-20 23:22:46,428 - INFO  [WorkerSender Thread:QuorumCnxManager@162] - Have smaller server identifier, so dropping the connection: (2, 0)\n   166 2010-06-20 23:22:46,431 - DEBUG [WorkerReceiver Thread:FastLeaderElection$Messenger$WorkerReceiver@214] - Receive new notification message. My id = 0\n   167 2010-06-20 23:22:46,432 - INFO  [QuorumPeer:/0.0.0.0:2181:FastLeaderElection@689] - Notification: 1, 77309411372, 1, 0, LOOKING, LOOKING, 1\n   168 2010-06-20 23:22:46,432 - DEBUG [QuorumPeer:/0.0.0.0:2181:FastLeaderElection@495] - id: 1, proposed id: 0, zxid: 77309411372, proposed zxid: 77309411393\n   169 2010-06-20 23:22:46,432 - DEBUG [QuorumPeer:/0.0.0.0:2181:FastLeaderElection@717] - Adding vote: From = 1, Proposed leader = 1, Porposed zxid = 77309411372, Proposed epoch = 1\n   170 2010-06-20 23:22:46,436 - DEBUG [Thread-1:QuorumCnxManager$Listener@445] - Connection request /192.168.1.183:44310\n   171 2010-06-20 23:22:46,436 - DEBUG [Thread-1:QuorumCnxManager$Listener@448] - Connection request: 0\n   172 2010-06-20 23:22:46,436 - DEBUG [Thread-1:QuorumCnxManager$SendWorker@504] - Address of remote peer: 2\n   173 2010-06-20 23:22:46,440 - DEBUG [WorkerReceiver Thread:FastLeaderElection$Messenger$WorkerReceiver@214] - Receive new notification message. My id = 0\n   174 2010-06-20 23:22:46,440 - INFO  [QuorumPeer:/0.0.0.0:2181:FastLeaderElection@689] - Notification: 2, 73014444097, 1, 0, LOOKING, LOOKING, 2\n   175 2010-06-20 23:22:46,440 - DEBUG [QuorumPeer:/0.0.0.0:2181:FastLeaderElection@495] - id: 2, proposed id: 0, zxid: 73014444097, proposed zxid: 77309411393\n   176 2010-06-20 23:22:46,441 - DEBUG [QuorumPeer:/0.0.0.0:2181:FastLeaderElection@717] - Adding vote: From = 2, Proposed leader = 2, Porposed zxid = 73014444097, Proposed epoch = 1\n   177 2010-06-20 23:22:46,441 - INFO  [QuorumPeer:/0.0.0.0:2181:QuorumPeer@647] - LEADING\n\nb) As a result X  increments its epoch. Worse, since this node decided to be a leader, it starts doing transactions. The first set of transactions start removing all ephemeral nodes. But these transactions are only done locally. Other peers do not ack these transactions since they know that this peer is not the leader.\n\nc) After a few seconds (8 secs), X relinquishes leadership since it does not receive any ack from rest of the peers\nd) It starts leader election again. This time, rests of the peers respond correctly informing X that a leader already exists.\ne) X determines that it should now follow the leader and starts handshake with the leader. However, X has incremented its epoch in the mean time. X thinks that the epoch sent by the leader during handshake is older than the epoch it has noticed before. X aborts connection with the leader.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-22T02:45:05.013+0000","updated":"2010-06-22T02:45:05.013+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12881033","id":"12881033","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"body":"Apologies for multiple attachments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-22T03:03:07.319+0000","updated":"2010-06-22T03:03:07.319+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12881168","id":"12881168","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Thanks for detailed assessment, Vishal. In Step b, the fact that the process believes it is the leader is not a problem, and it happens because we queue notification messages during leader election. \n\nThe real issue is that leader code is setting the last processed zxid to the first of the new epoch even before connecting to a quorum of followers. Because the leader code sets this value before connecting to a quorum of followers (Leader.java:281) and the follower code throws an IOException (Follower.java:73) if the leader epoch is smaller, we have that when the false leader drops leadership and becomes a follower, it finds a smaller epoch and kills itself.\n\nI noticed that this follower check was not there before (not present in 3.0 branch), and it might have been introduced when we did the observer reorganization. For now I propose that we move line Leader.java:281 to Leader.java:470. It simply changes the point in which we set the last processed zxid to one in which we know that  a quorum of followers supports the leader. I reasoned a bit about it and verified that tests pass.\n\nA patch for the change I'm proposing is trivial, but a unit test will require some work, so I'd rather hear opinions first. Also, please note that this problem is not related to the topic of this jira, so we might consider working on a different jira from this point on. \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2010-06-22T11:14:22.435+0000","updated":"2010-06-22T11:14:22.435+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12881236","id":"12881236","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Vishal, if Flavio provides you with a patch could you apply it and verify with your configuration?\n\nFlavio, please provide an initial patch that people could use to verify. We'll hold off on a release until you add the test(s), but this would be great to start with.\n\nThanks all for helping to track this down!\n\nI'd like to fast track a 3.3.2 release, so if possible please make this a priority.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-22T16:13:48.171+0000","updated":"2010-06-22T16:13:48.171+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12881244","id":"12881244","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I have created a new jira for this issue: ZOOKEEPER-790. There is a patch there.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2010-06-22T16:50:44.251+0000","updated":"2010-06-22T16:50:44.251+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12881280","id":"12881280","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"body":"I will try out the patch. FYI I am using 3.3.0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-22T18:18:13.334+0000","updated":"2010-06-22T18:18:13.334+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12888684","id":"12888684","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"body":"Unfortunately I still observed the \"Leader epoch\" issue and needed to manually force a leader election for the cluster to recover. This test was performed with the following base+patches, applied in the order listed.\n\nZookeeper 3.3.1\nZOOKEEPER-744\nZOOKEEPER-790\n\n\n{code}\n2010-07-15 02:43:57,181 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FileSnap@82] - Reading snapshot /data/zookeeper/version-2/snapshot.2300001ac2\n2010-07-15 02:43:57,384 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FastLeaderElection@649] - New election. My id =  1, Proposed zxid = 154618826848\n2010-07-15 02:43:57,385 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FastLeaderElection@689] - Notification: 1, 154618826848, 4, 1, LOOKING, LOOKING, 1\n2010-07-15 02:43:57,385 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FastLeaderElection@799] - Notification: 2, 146030952153, 3, 1, LOOKING, LEADING, 2\n2010-07-15 02:43:57,385 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FastLeaderElection@799] - Notification: 2, 146030952153, 3, 1, LOOKING, FOLLOWING, 3\n2010-07-15 02:43:57,385 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:QuorumPeer@642] - FOLLOWING\n2010-07-15 02:43:57,385 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:ZooKeeperServer@151] - Created server with tickTime 2000 minSessionTimeout 4000 maxSessionTimeout 40000 datadir /data/zookeeper/txlog/version-2 snapdir /data/zookeeper/version-2\n2010-07-15 02:43:57,387 - FATAL [QuorumPeer:/0:0:0:0:0:0:0:0:2181:Follower@71] - Leader epoch 23 is less than our epoch 24\n2010-07-15 02:43:57,387 - WARN  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:Follower@82] - Exception when following the leader \njava.io.IOException: Error: Epoch of leader is lower\n        at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:73)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:644)\n2010-07-15 02:43:57,387 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:Follower@166] - shutdown called \njava.lang.Exception: shutdown Follower\n        at org.apache.zookeeper.server.quorum.Follower.shutdown(Follower.java:166)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:648)\n{code}\n\n\nI followed the recipe @vishal provided for recreating.\n\n(a) Stop one follower in a three node cluster\n(b) Get some tea while it falls behind\n(c) Start the node stopped in (a).\n\n\nThese timestamps show where the follower was stopped. It also shows when it was turned back on.\n\n{code}\n2010-07-15 02:35:36,398 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:NIOServerCnxn@1661] - Established session 0x229aa13cfc6276b with negotiated timeout 10000 for client /10.209.45.114:34562\n2010-07-15 02:39:18,907 - INFO  [main:QuorumPeerConfig@90] - Reading configuration from: /etc/zookeeper/conf/zoo.cfg\n{code}\n\n\nThis timestamp is the first ``Leader epoch`` line. Everything between these two points will be the interesting bits.\n\n{code}\n2010-07-15 02:39:43,339 - FATAL [QuorumPeer:/0:0:0:0:0:0:0:0:2181:Follower@71] - Leader epoch 23 is less than our epoch 24\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-07-15T03:21:39.911+0000","updated":"2010-07-15T03:21:39.911+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12888686","id":"12888686","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"body":"Please see my most recent comment for a summary of where the interesting lines are in this log file.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-07-15T03:24:56.070+0000","updated":"2010-07-15T03:24:56.070+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12934189","id":"12934189","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rss1987","name":"rss1987","key":"rss1987","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Radu Marin","active":true,"timeZone":"Etc/UTC"},"body":"We are hitting this problem often. A follower starts infinite looping on this, and it does not accept clients anymore.\n\nIt says LOOKING, than FOLLOWING, than \"Leader epoch y is less than our epoch y +1 \", throws exception in shutdown and loops again.\n\nThe only way I could make it work again it was to cleanup the data directory and restart the server.\n\nAny change this will be fixed soon ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rss1987","name":"rss1987","key":"rss1987","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Radu Marin","active":true,"timeZone":"Etc/UTC"},"created":"2010-11-20T20:48:35.658+0000","updated":"2010-11-20T20:48:35.658+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/12934202","id":"12934202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Radu, It sounds like the problem you mention has been resolved in ZOOKEEPER-790. I'm not sure which version you're using, but perhaps you should consider moving to 3.3.2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2010-11-20T22:21:33.506+0000","updated":"2010-11-20T22:21:33.506+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13006250","id":"13006250","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"body":"{quote}\nto fix this issue we require server -server protocol change. Thsi protocol change will break backwards compatibility. To maintain backwards compatibility the code becomes quite complex and tricky. Instead of making a last minute change and having to do all the testing to check if backwards compatibily for servers is maintained, I am moving it to 3.3 to see if we want to fix it in a backwards compatible manner or fix it in 4.0 and break backwards compatibility.\n{quote}\n\nUntil the bug is fixed, will it be possible to avoid running into this scenario by doing the following:\n1. Create a znode /dummy\n2. After receiving a SyncConnected write some data to /dummy\n3. Then proceed with other write transactions\n\nEssentially, do a NULL transaction from the client. Will this prevent the log divergence to affect divergence of ordering of client transactions?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-13T18:49:57.311+0000","updated":"2011-03-13T18:49:57.311+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13015965","id":"13015965","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"body":"Folks,\n\nCan someone comment if the work around that I mentioned in my previous comment is valid?\n\nThanks.\n-Vishal","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2011-04-05T15:36:18.834+0000","updated":"2011-04-05T15:36:18.834+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13043017","id":"13043017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n\nI think we are running into this bug where the leader dies after\nrecording the transaction locally but before sending it out to the followers.\n\nThis is causing log divergence, which is causing the client connected\nto the old leader (after reboot) to  see different\ndata. Unfortunately, I don't have the transaction logs to look\ninto. But based on the ZooKeeper logs I am strongly suspecting that we\nare running into this bug. I have given the description below. Please\nlet me know if you think I am on the wrong track.\n\nWe have a 3 node cluster. IP addresses are *.53, *.54 and *.55.\n\n1) 54 is the leader and is rebooted by our test.\n\n2) Node 55 becomes ZK leader\n2011-05-30 22:56:45.797 INFO - [QuorumPeer[myid=2]/0:0:0:0:0:0:0:0:2181:QuorumPeer@662] - LEADING\n\nThe next transaction it will do will be zxid 0x0x5D00000001. We can see this from the zxid below:\n\n2011-05-30 22:56:46.819 INFO - [LearnerHandler[myid=2]-/192.168.4.1:33329:Leader@503] - Have quorum of supporters; starting up and setting last processed zxid: 399431958528\n\n3) Our client on 55 attempts to create a znode. This is the first\ntransaction after 55 becomes the leader. The following application\nmessage tells us that is writing to ZK.\n\n2011-05-30 22:56:52.608 INFO - commitTransaction - Committing transaction 21068:\n\nThis will translate to ZooKeeper transaction ID 0x5D00000001. Now, at\nthe same instant 53 was rebooted by the test.\n\nNow 54 and 53 are both down, 55 loses quorum and is rebooted by our watchdog.\n2011-05-30 22:56:54.922 WARN - [LearnerHandler[myid=2]-/192.168.4.1:33329:LearnerHandler@475] - ******* GOODBYE /192.168.4.1:33329 ********\n2011-05-30 22:56:55.916 INFO - [QuorumPeer[myid=2]/0:0:0:0:0:0:0:0:2181:Leader@396] - Shutdown called\njava.lang.Exception: shutdown Leader! reason: Only 0 followers, need 1\n\nAt this step, I will assume that 53 logged transaction ID 0x5D00000001\n*and* 53 went offline before receiving this transaction from 55. I am\nnot able to verify this since I don't have the transaction logs. But I\nthink this assumption is valid and can be inferred from the\ndescription below.\n\n\n4) Now, 53 and 54 reboot. 53 becomes leader. Since neither 53 and 54\nhave heard of 55's 0x5D00000001 transaction, 53 also decides to\nstart doing the transaction from 0x5D00000001.\nCorresponding log entry from 53:\n2011-05-30 22:58:10.116 INFO - [LearnerHandler[myid=1]-/192.168.4.1:52419:Leader@503] - Have quorum of supporters; starting up and setting last processed zxid: 399431958528\n\nThis is where 55 and rest of the cluster will differ in their\nstates. Same zxid but different content.\n\n5) 55 reboots and rejoins the cluster. It tells 54 that it has\ntransaction 0x5D00000001 logged. 54 sends it a diff of transactions\nstarting from 0x5D00000002.\n\nWe can see that from the following entry in 55's log:\n2011-05-30 22:58:24.677 WARN - [QuorumPeer[myid=2]/0:0:0:0:0:0:0:0:2181:Learner@341] - Got zxid 0x5d00000002 expected 0x1\n\nThus, old transaction 0x5D00000001 remains in 55 logs. As a result,\nthe client connected to 55 sees different data.\n\n- I understand the fix proposed is to perform a null transaction after\nleader election. I can work on it, but I am not sure why this is considered as a\ncomplex fix. Mahadev mentioned earlier that the bug fix (for the\ncurrent ZAB version) will break backward compatibility. Can someone\nexplain why?\n\n- In the meantime, as a workaround, we are forcing our client to do a dummy transaction\nafter leader election. We have a few clients so I think this workaround\nwill work without much overhead.\n\nComments/suggestions?\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-02T19:54:12.845+0000","updated":"2011-06-02T19:54:12.845+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13043114","id":"13043114","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"yes this is the scenario that creates the issue. note that step 5 has to occur soon after step 4 otherwise 55 will get a state transfer rather than a diff and the problem will be fixed.\n\nthe fix isn't really performing a null transaction. (it is a work around, but you also need to get the timing right.) the problem is actually two parts: 1) the new epoch isn't getting logged properly. 2) once we do log properly we also need to make sure that we distinguish epochs that we tried to join from epochs that we did join. see https://cwiki.apache.org/confluence/display/ZOOKEEPER/Zab1.0 for the details.\n\nfixing it is rather easy, it is making sure that it is backwards compatible that is a bit tricky. i should have it done today hopefully. well at least a first cut. the problem is that method is rather complicated and adding in the backwards compatibility makes it more so. i'm going to avoid refactoring for the first cut so that it is clear what i have modified. note that this affects both the leading code and the leader election code.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-02T22:52:58.363+0000","updated":"2011-06-02T22:52:58.363+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13043152","id":"13043152","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fournc","name":"fournc","key":"fournc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Camille Fournier","active":true,"timeZone":"Etc/UTC"},"body":"Was there an email or something about this? Could we get a summary of the current state of correctness vis a vis the existing implementation? It makes me a bit nervous seeing this come in seemingly out of the blue, considering the criticality of the production systems I'm running on top of \"pre\"Zab1.0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fournc","name":"fournc","key":"fournc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Camille Fournier","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-03T00:15:55.599+0000","updated":"2011-06-03T00:15:55.599+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13043164","id":"13043164","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"body":"{quote}\nnote that step 5 has to occur soon after step 4 otherwise 55 will get a state transfer rather than a diff and the problem will be fixed.\n{quote}\n\nYes, I realized that. In our case, the new leader is sending diffs to the faulty node.\n\n{quote}\nthe fix isn't really performing a null transaction. (it is a work around, but you also need to get the timing right.)\n{quote}\n\nIt will be a workaround but it will be useful for pre zab 1.0 users. Why do you think we need to get the timing right? We just need to ensure that the leader performs the transaction before accepting any transactions from clients.\n\nDo you agree that my workaround from the client side will work? (another workaround is to always send SNAP instead of DIFF).\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-03T01:08:39.451+0000","updated":"2011-06-03T01:08:39.451+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13043171","id":"13043171","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"body":"{quote}\nWas there an email or something about this?\n{quote}\n\nhttp://zookeeper-user.578899.n2.nabble.com/Divergence-in-ZK-transaction-logs-in-some-corner-cases-td2547596.html\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-03T01:29:01.924+0000","updated":"2011-06-03T01:29:01.924+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13043176","id":"13043176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fournc","name":"fournc","key":"fournc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Camille Fournier","active":true,"timeZone":"Etc/UTC"},"body":"What year is it now...? :)\nWould be nice if we got somewhat more regular pings about this stuff, for the newer joiners.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fournc","name":"fournc","key":"fournc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Camille Fournier","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-03T01:47:21.830+0000","updated":"2011-06-03T01:47:21.830+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13043311","id":"13043311","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"vishal, i'm not sure if i understand your proposal correctly. when i originally read it i thought you meant to have a client make sure to do an innocuous first transaction, but you would run into timing issues there because another client might be first.\n\nyour comment got me thinking about another way, which you were probably proposing all along: if the leader issues the first innocuous transaction, and makes sure it is committed before it processes any more it might be easier than doing things at the quorum packet layer. i'm going to see if i can map it to the flow in the tech report. it would help with the backwards compatibility.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-03T11:28:56.880+0000","updated":"2011-06-03T11:28:56.880+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13043441","id":"13043441","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"body":"{quote}\nvishal, i'm not sure if i understand your proposal correctly. when i originally read it i thought you meant to have a client make sure to do an innocuous first transaction, but you would run into timing issues there because another client might be first.\n{quote}\n\nYou are right about the timing issue. To avoid another client from\ndoing a transaction I do the null transactions from all clients :-)\nNot efficient, but avoids this race. However, while testing this\nclient side workaround I ran into another problem. Our application\nuses watchdogs and reboots the machines when zookeeper is disconnect\nfor long periods of time. As a result, the client cannot guarantee\nthat the first transaction to be logged will be always the null\ntransaction. It could be a createSession. So two nodes can still have\nlog divergence. If a node misses createSession from its transaction\nlog, then it will not expire it. doh! should have realized this.  Now,\nI can go a step ahead and make sure that the first session creation is\ninnocuous. This will work, but does not sound good. I will probably\ngive up on my idea for client side work around.\n\n{quote}\nyour comment got me thinking about another way, which you were probably proposing all along: if the leader issues the first innocuous transaction, and makes sure it is committed before it processes any more it might be easier than doing things at the quorum packet layer. i'm going to see if i can map it to the flow in the tech report. it would help with the backwards compatibility.\n{quote}\n\nYes, that was what I was proposing (and hence confused about backward compatibility).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-03T16:17:43.595+0000","updated":"2011-06-03T16:17:43.595+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13043888","id":"13043888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"are you able to reproduce the problem reliably? i think my test case does it, but i'm curious if it fixes your problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-03T17:25:45.106+0000","updated":"2011-06-03T17:25:45.106+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13043926","id":"13043926","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"body":"I am able to repro the bug reliably.\n{quote}\nbut i'm curious if it fixes your problem.\n{quote}\nWhat are you referring to? The client side does fix the problem for us, but it is a bit ugly fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-03T18:10:46.376+0000","updated":"2011-06-03T18:10:46.376+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13045293","id":"13045293","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"fixed the FLE tests.\n\nright now the hierarchal quorum tests are failing. flavio can you see if you notice anything?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-07T06:48:07.419+0000","updated":"2011-06-07T06:48:07.419+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13045412","id":"13045412","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"body":"Hi Ben, Flavio,\n\nThanks. We will try out the patch.\n\nFor the record, after some more discussion with Ben I realized that none of the workarounds that I was trying would work. Fixing this bug would need change in the protocol. Thanks for the clarification..\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vishalmlst","name":"vishalmlst","key":"vishalmlst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vishal Kher","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-07T13:17:53.065+0000","updated":"2011-06-07T13:17:53.065+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13045579","id":"13045579","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"this has a small fix in it. still working on two more tests that aren't passing. i think it might be a problem in the tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-07T18:32:00.656+0000","updated":"2011-06-07T18:32:00.656+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13045715","id":"13045715","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"i think this is it. after i make sure the tests pass. i'll upload it to review.apache.org.\n\nvishal and flavio can you check it out?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-08T00:13:36.472+0000","updated":"2011-06-08T00:13:36.472+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13045727","id":"13045727","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12481761/ZOOKEEPER-335_4.patch\n  against trunk revision 1132489.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 13 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    -1 findbugs.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/308//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/308//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/308//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-08T00:46:59.482+0000","updated":"2011-06-08T00:46:59.482+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13046049","id":"13046049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Findbugs has a single issue that needs to be addressed:\n\nHE_EQUALS_USE_HASHCODE: Class defines equals() and uses Object.hashCode()\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-08T16:23:19.655+0000","updated":"2011-06-08T16:23:19.655+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13046887","id":"13046887","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"addressed flavio's review and the findbug issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-09T22:48:42.869+0000","updated":"2011-06-09T22:48:42.869+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13046888","id":"13046888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/877/\n-----------------------------------------------------------\n\nReview request for fpj and Vishal Kher.\n\n\nSummary\n-------\n\nzookeeper servers should commit the new leader txn to their logs.\n\n\nThis addresses bug ZOOKEEPER-335.\n    https://issues.apache.org/jira/browse/ZOOKEEPER-335\n\n\nDiffs\n-----\n\n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java 1134016 \n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java 1134016 \n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Follower.java 1134016 \n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Leader.java 1134016 \n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Learner.java 1134016 \n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/LearnerHandler.java 1134016 \n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java 1134016 \n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/StateSummary.java PRE-CREATION \n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Vote.java 1134016 \n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/util/ZxidUtils.java PRE-CREATION \n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java 1134016 \n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerTestBase.java 1134016 \n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/ClientBase.java 1134016 \n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/ReadOnlyModeTest.java 1134016 \n  http://svn.apache.org/repos/asf/zookeeper/trunk/src/zookeeper.jute 1134016 \n\nDiff: https://reviews.apache.org/r/877/diff\n\n\nTesting\n-------\n\n\nThanks,\n\nBenjamin\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-09T22:48:59.567+0000","updated":"2011-06-09T22:48:59.567+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13046913","id":"13046913","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12481990/ZOOKEEPER-335_5.patch\n  against trunk revision 1132489.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 13 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/311//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/311//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/311//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-09T23:17:26.349+0000","updated":"2011-06-09T23:17:26.349+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13048665","id":"13048665","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"+1, I have reviewed the patch twice and I don't have further issues. Also, I believe the patch I provided in ZOOKEEPER-1082 has been correctly incorporated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2011-06-13T17:26:32.360+0000","updated":"2011-06-13T17:26:32.360+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13048910","id":"13048910","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"ok if there are no objections, i'd like to get this in tonight. i plan on just applying to trunk since the change is rather deep. given that we have never seen this bug in production it's probably better to not risk the stable branch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-14T00:06:57.130+0000","updated":"2011-06-14T00:06:57.130+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13048981","id":"13048981","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed revision 1135382. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-14T05:14:31.884+0000","updated":"2011-06-14T05:14:31.884+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12416126/comment/13050966","id":"13050966","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in ZooKeeper-trunk #1215 (See [https://builds.apache.org/job/ZooKeeper-trunk/1215/])\n    ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-17T10:57:10.608+0000","updated":"2011-06-17T10:57:10.608+0000"}],"maxResults":51,"total":51,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-335/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0617j:"}}