{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12443477","self":"https://issues.apache.org/jira/rest/api/2/issue/12443477","key":"ZOOKEEPER-628","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2009-12-16T19:27:17.600+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Sep 06 07:15:32 UTC 2011","customfield_12310420":"62190","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_54395971191_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-09-06T15:58:02.487+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-628/watchers","watchCount":1,"isWatching":false},"created":"2009-12-16T01:58:31.336+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":"session, ephemeral node, server","customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314068","id":"12314068","description":"Fix release against 3.2 branch","name":"3.2.1","archived":false,"released":true,"releaseDate":"2009-09-04"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-09-06T15:58:02.521+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"I find a very strange scenario today, I'm not sure how it happen, I just found it like this. Maybe you can give me some information about it, my Zookeeper Server is version 3.2.1.\n\nMy Zookeeper cluster contains three servers, with ip: 10.81.12.144,10.81.12.145,10.81.12.141. I wrote a client to create ephemeral node under znode: se/diserver_tc. The client runs on the server with ip 10.81.13.173. The client can create a ephemeral node on zookeeper server and write the host ip (10.81.13.173) in to the node as its data. There is only one client process can be running at a time, because the client will listen to a certain port.\n\nIt is strange that I found there were two ephemeral node with the ip 10.81.13.173 under znode se/diserver_tc.\nse/diserver_tc/diserver_tc0000000067\nSTAT:\n        czxid: 124554079820\n        mzxid: 124554079820\n        ctime: 1260609598547\n        mtime: 1260609598547\n        version: 0\n        cversion: 0\n        aversion: 0\n        ephemeralOwner: 226627854640480810\n        dataLength: 92\n        numChildren: 0\n        pzxid: 124554079820\n\nse/diserver_tc/diserver_tc0000000095\nSTAT:\n        czxid: 128849019107\n        mzxid: 128849019107\n        ctime: 1260772197356\n        mtime: 1260772197356\n        version: 0\n        cversion: 0\n        aversion: 0\n        ephemeralOwner: 154673159808876591\n        dataLength: 92\n        numChildren: 0\n        pzxid: 128849019107\n\nThere are TWO with different session id! And after I kill the client process on the server 10.81.13.173, the se/diserver_tc/diserver_tc0000000095 node disappear, but the se/diserver_tc/diserver_tc0000000067 stay the same. That means it is not my coding mistake to create the node twice. I checked several times and I'm sure that there is no another client instance running. And I use the 'stat' command to check the three zookeeper servers, and there is no client from 10.81.13.173,\n\n$echo stat | nc 10.81.12.144 2181   \nZookeeper version: 3.2.1-808558, built on 08/27/2009 18:48 GMT\nClients:\n /10.81.13.173:35676[1](queued=0,recved=0,sent=0) # it is caused by the nc process\n\nLatency min/avg/max: 0/3/254\nReceived: 11081\nSent: 0\nOutstanding: 0\nZxid: 0x1e000001f5\nMode: follower\nNode count: 32\n\n$ echo stat | nc 10.81.12.141 2181\nZookeeper version: 3.2.1-808558, built on 08/27/2009 18:48 GMT\nClients:\n /10.81.12.152:58110[1](queued=0,recved=10374,sent=0)\n /10.81.13.173:35677[1](queued=0,recved=0,sent=0) # it is caused by the nc process\n\nLatency min/avg/max: 0/0/37\nReceived: 37128\nSent: 0\nOutstanding: 0\nZxid: 0x1e000001f5\nMode: follower\nNode count: 26\n\n$ echo stat | nc 10.81.12.145 2181\nZookeeper version: 3.2.1-808558, built on 08/27/2009 18:48 GMT\nClients:\n /10.81.12.153:19130[1](queued=0,recved=10624,sent=0)\n /10.81.13.173:35678[1](queued=0,recved=0,sent=0) # it is caused by the nc process\n\nLatency min/avg/max: 0/2/213\nReceived: 26700\nSent: 0\nOutstanding: 0\nZxid: 0x1e000001f5\nMode: leader\nNode count: 26\n\nThe three 'stat' commands show different Node count! ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"32956","customfield_12312823":null,"summary":"the ephemeral node wouldn't disapper due to session close error","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=creatstar","name":"creatstar","key":"creatstar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qian Ye","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=creatstar","name":"creatstar","key":"creatstar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qian Ye","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Linux 2.6.9 x86_64","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12443477/comment/12791121","id":"12791121","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=creatstar","name":"creatstar","key":"creatstar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qian Ye","active":true,"timeZone":"Etc/UTC"},"body":"P.S.\nse/diserver_tc/diserver_tc0000000067 is only appear on the server 10.81.12.144, the one with the most Node count\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=creatstar","name":"creatstar","key":"creatstar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qian Ye","active":true,"timeZone":"Etc/UTC"},"created":"2009-12-16T02:00:51.977+0000","updated":"2009-12-16T02:00:51.977+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12443477/comment/12791134","id":"12791134","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=creatstar","name":"creatstar","key":"creatstar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qian Ye","active":true,"timeZone":"Etc/UTC"},"body":"the 'dump' information for the three servers:\n\n$ echo dump | nc 10.81.12.141 2181 \nSessionTracker dump: \norg.apache.zookeeper.server.quorum.FollowerSessionTracker@5d684e26\nephemeral nodes dump:\nSessions with Ephemerals (3):\n0x3258bdcc1c10068:\n        /se/fras/fras0000000079\n        /se/fras_tc/fras_tc0000000077\n0x225826b5ab2002f:\n        /se/diserver/diserver0000000114\n        /se/diserver_tc/diserver_tc0000000094\n0x125826b5c1f0019:\n        /se/diserver_tc/diserver_tc0000000098\n        /se/diserver/diserver0000000118\n\n$ echo dump | nc 10.81.12.144 2181 \nSessionTracker dump: \norg.apache.zookeeper.server.quorum.FollowerSessionTracker@62ebcdbb\nephemeral nodes dump:\nSessions with Ephemerals (7):\n0x3258bdcc1c10068:\n        /se/fras/fras0000000079\n        /se/fras_tc/fras_tc0000000077\n0x3258bc635750001:\n        /se/diserver_tc/diserver_tc0000000076\n<b>0x32524d5440e022a:</b>\n<b>        /se/diserver_tc/diserver_tc0000000067</b>\n0x3258bc635750000:\n        /se/fras/fras0000000049\n        /se/fras_tc/fras_tc0000000049\n0x225826b5ab2002f:\n        /se/diserver/diserver0000000114\n        /se/diserver_tc/diserver_tc0000000094\n0x125826b5c1f0019:\n        /se/diserver_tc/diserver_tc0000000098\n        /se/diserver/diserver0000000118\n0x225826b5ab20011:\n        /se/diserver_tc/diserver_tc0000000081\n        /se/diserver/diserver0000000107\n\n$ echo dump | nc 10.81.12.145 2181 \nSessionTracker dump: \nSession Sets (9):\n0 expire at Wed Dec 16 10:05:08 CST 2009:\n0 expire at Wed Dec 16 10:05:10 CST 2009:\n0 expire at Wed Dec 16 10:05:14 CST 2009:\n0 expire at Wed Dec 16 10:05:18 CST 2009:\n0 expire at Wed Dec 16 10:05:20 CST 2009:\n0 expire at Wed Dec 16 10:05:24 CST 2009:\n1 expire at Wed Dec 16 10:05:28 CST 2009:\n        82615565794869273\n1 expire at Wed Dec 16 10:05:30 CST 2009:\n        226741136511795304\n1 expire at Wed Dec 16 10:05:34 CST 2009:\n        154673159808876591\n\nephemeral nodes dump:\nSessions with Ephemerals (3):\n0x3258bdcc1c10068:\n        /se/fras/fras0000000079\n        /se/fras_tc/fras_tc0000000077\n0x225826b5ab2002f:\n        /se/diserver/diserver0000000114\n        /se/diserver_tc/diserver_tc0000000094\n0x125826b5c1f0019:\n        /se/diserver_tc/diserver_tc0000000098\n        /se/diserver/diserver0000000118\n\nIt seems that the server 10.81.12.144 still keep lots of sessions which should have be expired ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=creatstar","name":"creatstar","key":"creatstar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qian Ye","active":true,"timeZone":"Etc/UTC"},"created":"2009-12-16T02:15:50.533+0000","updated":"2009-12-16T02:15:50.533+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12443477/comment/12791537","id":"12791537","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Qian this is great information. Can you tar/gzip the log files from all the servers and attach them? Any/all log files you have would be useful for us to see.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-12-16T19:27:17.600+0000","updated":"2009-12-16T19:27:17.600+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12443477/comment/12791583","id":"12791583","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"body":"qian,\n I was thinking about how this could happen and I think this could be possible with some amount of corruption in the zk database. ZOOKEEPER-596 should get rid of all those scenarios. Would it be possible for you to upload the zookeeper data directory and snapshots for all the servers? It would come in very handy to find out what the problem could have been. you can tar and zip it up and upload it on the jira.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"created":"2009-12-16T20:58:57.324+0000","updated":"2009-12-16T20:58:57.324+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12443477/comment/12797870","id":"12797870","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=creatstar","name":"creatstar","key":"creatstar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qian Ye","active":true,"timeZone":"Etc/UTC"},"body":"err...sorry, i wasn't aware of these comments,\nthe log files below the level of WARN were not recorded due to a wrong log4j.properties, and the data directory and snapshots contains some sensitive information, sorry that I cannot upload them. :-(","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=creatstar","name":"creatstar","key":"creatstar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qian Ye","active":true,"timeZone":"Etc/UTC"},"created":"2010-01-08T01:52:28.864+0000","updated":"2010-01-08T01:52:28.864+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12443477/comment/13097768","id":"13097768","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thkoch","name":"thkoch","key":"thkoch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thkoch&avatarId=11540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thkoch&avatarId=11540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thkoch&avatarId=11540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thkoch&avatarId=11540"},"displayName":"Thomas Koch","active":true,"timeZone":"Etc/UTC"},"body":"Can this issue be closed? A possible causing bug has been closed, last activity 20 months ago, no logs available, and ZK version 3.2.x","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thkoch","name":"thkoch","key":"thkoch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thkoch&avatarId=11540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thkoch&avatarId=11540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thkoch&avatarId=11540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thkoch&avatarId=11540"},"displayName":"Thomas Koch","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-06T07:15:32.622+0000","updated":"2011-09-06T07:15:32.622+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-628/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0605j:"}}