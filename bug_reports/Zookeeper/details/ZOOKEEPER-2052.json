{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12745421","self":"https://issues.apache.org/jira/rest/api/2/issue/12745421","key":"ZOOKEEPER-2052","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325149","id":"12325149","description":"Fix release against 3.4 branch","name":"3.4.7","archived":false,"released":true,"releaseDate":"2015-12-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326786","id":"12326786","description":"Alpha release against 3.5 branch","name":"3.5.1","archived":false,"released":true,"releaseDate":"2015-09-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326518","id":"12326518","name":"3.6.0","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-10-05T16:32:10.930+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Oct 28 11:10:52 UTC 2014","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"10002_*:*_8_*:*_1940178337_*|*_1_*:*_8_*:*_297378519_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-10-28T04:41:16.933+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2052/watchers","watchCount":7,"isWatching":false},"created":"2014-10-02T07:08:40.122+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"11.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323310","id":"12323310","description":"Fix release against 3.4 branch","name":"3.4.6","archived":false,"released":true,"releaseDate":"2014-03-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316644","id":"12316644","description":"Dynamic Reconfig, Remove Watches, Local Session","name":"3.5.0","archived":false,"released":true,"releaseDate":"2014-08-04"}],"issuelinks":[{"id":"12398328","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12398328","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12546846","key":"ZOOKEEPER-1424","self":"https://issues.apache.org/jira/rest/api/2/issue/12546846","fields":{"summary":"ZooKeeper will not allow a client to delete a tree when it should allow it","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-10-28T11:10:52.283+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"We stumbled upon a ZooKeeper bug where a node with no children cannot be removed on our 3 node ZooKeeper ensemble or standalone ZooKeeper on Red Hat Enterprise Linux x86_64 environment.  Here is an example scenario/setup:\n\no Standalone ZooKeeper or 3 node ensemble (v3.4.6)\no 2 Java clients (v3.4.6)\n  - Client A creates a persistent node (e.g.:  /metadata/resources)\n  - Client B creates ephemeral nodes under this persistent node \n\no Client A attempts to remove the /metadata/resources node via multi op  \n   delete but fails since there are children\no Client B's session expired, all the ephemeral nodes are removed\no Client A attempts to recursively remove /metadata/resources node via \n   multi op, this is expected to succeed but got the following exception:\n      org.apache.zookeeper.KeeperException$NotEmptyException:     \n         KeeperErrorCode = Directory not empty\n\n   (Note that Client B is the only client that creates these ephemeral nodes)\n\no After this, we use zkCli.sh to inspect the problematic node but the zkCli.sh shows the /metadata/resources node indeed have no children but it will not allow /metadata/resources node to get deleted.  (shown below)\n\n[zk: localhost:2181(CONNECTED) 0] ls /\n[zookeeper, metadata]\n[zk: localhost:2181(CONNECTED) 1] ls /metadata\n[resources]\n[zk: localhost:2181(CONNECTED) 2] get /metadata/resources\nnull\ncZxid = 0x3\nctime = Wed Oct 01 22:04:11 PDT 2014\nmZxid = 0x3\nmtime = Wed Oct 01 22:04:11 PDT 2014\npZxid = 0x9\ncversion = 2\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 0\nnumChildren = 0\n[zk: localhost:2181(CONNECTED) 3] delete /metadata/resources\nNode not empty: /metadata/resources\n[zk: localhost:2181(CONNECTED) 4] get /metadata/resources   \nnull\ncZxid = 0x3\nctime = Wed Oct 01 22:04:11 PDT 2014\nmZxid = 0x3\nmtime = Wed Oct 01 22:04:11 PDT 2014\npZxid = 0x9\ncversion = 2\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 0\nnumChildren = 0\n\no The only ways to remove this node is to either:\n   a) Restart the ZooKeeper server\n   b) set data to /metadata/resources then followed by a subsequent delete.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12673516","id":"12673516","filename":"test-jenkins.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T03:37:42.859+0000","size":12772,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12673516/test-jenkins.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12672505","id":"12672505","filename":"zookeeper.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-02T07:09:42.617+0000","size":30481,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12672505/zookeeper.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12673165","id":"12673165","filename":"ZOOKEEPER-2052.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-06T19:04:56.693+0000","size":9596,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12673165/ZOOKEEPER-2052.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12673056","id":"12673056","filename":"ZOOKEEPER-2052.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-06T04:44:59.879+0000","size":7469,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12673056/ZOOKEEPER-2052.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12672951","id":"12672951","filename":"ZOOKEEPER-2052.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-04T20:34:35.348+0000","size":7385,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12672951/ZOOKEEPER-2052.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12673530","id":"12673530","filename":"ZOOKEEPER-2052-v2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T05:31:11.249+0000","size":20004,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12673530/ZOOKEEPER-2052-v2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12673687","id":"12673687","filename":"ZOOKEEPER-2052-v3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T20:08:53.437+0000","size":19142,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12673687/ZOOKEEPER-2052-v3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12673707","id":"12673707","filename":"ZOOKEEPER-2052-v3-release.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T21:01:35.531+0000","size":19659,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12673707/ZOOKEEPER-2052-v3-release.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12673758","id":"12673758","filename":"ZOOKEEPER-2052-v4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T23:34:57.934+0000","size":19348,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12673758/ZOOKEEPER-2052-v4.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12675054","id":"12675054","filename":"ZOOKEEPER-2052-v5.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-15T17:22:47.282+0000","size":18849,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12675054/ZOOKEEPER-2052-v5.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12675053","id":"12675053","filename":"ZOOKEEPER-2052-v5-branch34.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-15T17:22:39.643+0000","size":17935,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12675053/ZOOKEEPER-2052-v5-branch34.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Unable to delete a node when the node has no children","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Red Hat Enterprise Linux 6.1 x86_64, standalone or 3 node ensemble (v3.4.6), 2 Java clients (v3.4.6)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14156152","id":"14156152","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Attached zookeeper server debug log","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-02T07:09:42.625+0000","updated":"2014-10-02T07:09:42.625+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14156163","id":"14156163","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"This issue looks very similar to https://issues.apache.org/jira/browse/ZOOKEEPER-1424 \nwhere it was reported on ZooKeeper v3.4.2","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-02T07:17:39.722+0000","updated":"2014-10-02T07:17:39.722+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14158745","id":"14158745","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Got abit curious, so went through the code in the PrepRequestProcessor class, particularly the multi logic path.  Here are some observations:\n\na)  There were no outstanding changes to the /metadata or /metadata/resources node prior the first multi.\n\nb)  During the first multi with delete, it saves the pending changes in getPendingChanges() but I noticed that it is calling getRecordForPath(path) which saves a ChangeRecord with zxid = -1 \n     (zks.outstandingChangesForPath.get(path) returns null and hence, it produces this ChangeRecord from the ZKDatabase if the node exists.) \n\nc)  The multi op with delete failed since there was an ephemeral node under /metadata/resources and the operation rolls back in rollbackPendingChanges(); it removes the new ChangeRecords added by the multi; however, the ChangeRecords with zxid = -1 are injected back to outstandingChangesForPath since getPendingChanges() saved them.\n\nCan someone with knowledge in this code area comment on c)?   \n\nShouldn't getPendingChanges() only obtain actual \"pending changes\" strictly from outstandingChangeForPath instead?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-04T00:00:36.927+0000","updated":"2014-10-04T00:00:36.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14159277","id":"14159277","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Attach patch with fix and  junit to reproduce the symptom.\n\nFix summary:\n\ngetPendingChanges() should only save ChangeRecord\nstrictly from zks.outstandingChanges since getRecordForPath() can \nreturn ChangeRecord with zxid = -1 which is from the ZKDatabase and \nnot the actual outstanding change.  This would cause unwanted *new* \nChangeRecords added to zks.outstandingChanges during \nrollbackPendingChanges() when the multi() fails.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-04T20:34:35.356+0000","updated":"2014-10-04T20:34:35.356+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14159279","id":"14159279","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Appreciate if someone can review and comment on the patch.  Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-04T20:44:31.744+0000","updated":"2014-10-04T20:44:31.744+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14159582","id":"14159582","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12672951/ZOOKEEPER-2052.patch\n  against trunk revision 1628224.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    -1 patch.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2369//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-05T16:32:10.930+0000","updated":"2014-10-05T16:32:10.930+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14159614","id":"14159614","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"The patch was generated on v3.4.6. Will resubmit patch for trunk when I get a chance.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-05T18:13:29.986+0000","updated":"2014-10-05T18:13:29.986+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14159647","id":"14159647","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~yipng].\n\nThis sounds a known issue. Can you explain your solution with an example? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-05T19:15:10.713+0000","updated":"2014-10-05T19:15:10.713+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14160001","id":"14160001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Resubmit patch for trunk.  Patch includes junit testcase to reproduce the issue and the fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-06T04:44:59.887+0000","updated":"2014-10-06T04:44:59.887+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14160006","id":"14160006","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Hongchao:\n\nAs illustrated in the junit testcase, the first multi failure was the culprit to this issue.  When the first multi with delete executes, it stores the pending changes for the path but in this specific case, there were no outstanding changes for those paths.  The getPendingChanges() method mistakenly saved the records that was obtained by the ZKDatabase with zxid = -1 (these are not outstanding changes).  When multi delete fails(there were ephemeral nodes under /mymetadata/resources), it attempts to remove the added change records from the multi operation and restore the outstanding changes for the paths.  But there were none to begin with, so the rollback actually added new change records.  When the multi op rolls back, one would expect that there shouldn't be any *new* change records.\n\nWhen client B's session expired, all its ephemeral nodes get removed, so the subsequent multi delete should succeed; however, due to this lingering change record in the zks.outstandingChanges, it prevents any deletion to /mymetadata/resources since the ChangeRecord still have the count for the ephemeral nodes.\n\nHence, the solution is to save pending changes only if there is an actual outstanding change for that path.  (zxid != -1)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-06T05:02:11.497+0000","updated":"2014-10-06T05:02:11.497+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14160013","id":"14160013","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12673056/ZOOKEEPER-2052.patch\n  against trunk revision 1628224.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    -1 release audit.  The applied patch generated 2 release audit warnings (more than the trunk's current 0 warnings).\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2370//testReport/\nRelease audit warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2370//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2370//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2370//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-06T05:30:14.838+0000","updated":"2014-10-06T05:30:14.838+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14160057","id":"14160057","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"[~yipng]\nThanks for the explanation and hard work on patch.\nI think your patch doesn't work for the following case:\n{code}\nmulti:\n  delete \"/existed\" => succeed\n  delete \"/non-existed\" => failed\n{code}\n\nIn such case, the entire operation set should be aborted. However, your patch will lead to non-aborted operations.\n\nThis case seems specific on \"number of children\". I wonder if a Children.count() could substitute the variable to fix this problem. I didn't have enough time to look at it now.\n\nI wonder why you want to call a delete within multi(). This bug would be fixed later... However, in your case, I didn't why you need to call multi for the delete. multi() was introduced in ZOOKEEPER-965 to do multi-update. I think it isn't checked very well for other usages by far.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-06T07:11:34.373+0000","updated":"2014-10-06T07:11:34.373+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14160158","id":"14160158","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Hongchao:\n\nThanks for taking a look at the patch.  The patch only deals with saving pending changes and it does not change any of precondition checkings for delete; hence, I am not sure \nwhy it didn't work the way you described.  Anyhow, I verified your scenario and it works as expected where the second  delete on a non-exist node will triggered the abort of the entire \noperation.  A KeeperException.NoNodeException was thrown at getPathForRecord() in this case and the /existed node was not deleted.   \n\n2014-10-06 02:38:21,795 [myid:] - INFO  [ProcessThread(sid:0 cport:11221)::PrepRequestProcessor@798] - Got user-level KeeperException when processing sessionid:0x148e4d2ed5b0000 type:multi cxid:0x4 zxid:0x4 txntype:2 reqpath:n/a aborting remaining multi ops. Error Path:/non-existed Error:KeeperErrorCode = NoNode for /non-existed\norg.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode\n...\n\nI did ran the patch with \"ant clean test\" before submitting it and the all tests passed in my environment.  Is there a particular test case you are referring to for the core tests that failed?  \nI see 6 failed tests in core test report but its error details show that the \"Address already in use\" for 4 of the testcases and the other 2 are \"waiting for server being up\"  and \n\"Forked Java VM exited abnormally. Please note the time in the report does not reflect the time until the VM exit.\" respectively.  It looks like socket bind issues \npreventing the tests to run in completion.\n\nThe testcase was a simplified version to reproduce the issue.   We use multi() with delete to remove a set of nodes in its entirety or none at all as advertised by the multi javadoc.\nPartial deletions will result in inconsistency of the application state. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-06T10:17:39.630+0000","updated":"2014-10-06T10:17:39.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14160289","id":"14160289","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"[~yipng] Good catch and thanks for unit test to understand it more.\n\nI didn't fully understood the logic why change record is adding into the {{outstandingChangesForPath}} when {{outstandingChanges}} is empty. I think this is resulting into the failure situation. Could anyone knows this logic.\n\n{code}\nPrepRequestProcessor#rollbackPendingChanges(){\n     //....\n     boolean empty = zks.outstandingChanges.isEmpty(); \n     //....\n     if (!empty && (c.zxid < firstZxid)) {\n          continue;\n     }\n\n     zks.outstandingChangesForPath.put(c.path, c);\n}\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2014-10-06T13:37:05.891+0000","updated":"2014-10-06T13:37:05.891+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14160725","id":"14160725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Added a testcase to confirm what Hongchao's scenario works.  Rerun with \nant clean test, all tests passed in my environment ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-06T19:04:56.701+0000","updated":"2014-10-06T19:04:56.701+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14160821","id":"14160821","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12673165/ZOOKEEPER-2052.patch\n  against trunk revision 1628224.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    -1 release audit.  The applied patch generated 2 release audit warnings (more than the trunk's current 0 warnings).\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2372//testReport/\nRelease audit warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2372//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2372//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2372//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-06T19:50:58.987+0000","updated":"2014-10-06T19:50:58.987+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14160955","id":"14160955","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Rakesh, it took some time for us to reproduce this issue since it happens intermittently.  \n\nI see there are a great deal of discussion and information exchange in https://issues.apache.org/jira/browse/ZOOKEEPER-965 ,\nparticularly there was a comment there regarding details on the rollbackPendingChanges() implementation.  It would certainly be \nvery helpful if folks involved with that jira can comment further.\n\nNevertheless, there seems to be a bug in getPendingChanges() where it can save a ChangeRecord with zxid = -1 (obtained from getRecordForPath )\nIf I understand this correctly, this ChangeRecord is NOT an entry from the zks.outstandingChangesForPath map but came from ZKDatabase.   Since \nit is not an actual outstanding change for the path, it shouldn't be saved in getPendingChanges() as then it will introduce new ChangeRecords when the\nmulti() fails.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-06T21:09:56.775+0000","updated":"2014-10-06T21:09:56.775+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14161406","id":"14161406","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for [~yipng] and [~rakeshr]'s discussion here. I dig into the code a little bit.\n\nLet me brief up how the error is caused in code level:\n1. when a multi delete was initiated, _pendingChanges_ add a copy of parent node ([github link|https://github.com/apache/zookeeper/blob/ac3371a133fffcb31e3f0c489a3564fe5ed2a851/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java#L231]).\n2. when delete failed and multi rolled back, it adds back _pendingChanges_ to _outstandingsForPath_ (should this be reamed _lastChangeForPath_)\n3. when a session was closed, unfortunately, its parent's last change isn't modified ([github link|https://github.com/apache/zookeeper/blob/ac3371a133fffcb31e3f0c489a3564fe5ed2a851/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java#L670]).\n4. when another delete happened, unfortunately (again &_&), it checked parent's record which is put back by multi rollback ([github link|https://github.com/apache/zookeeper/blob/ac3371a133fffcb31e3f0c489a3564fe5ed2a851/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java#L482]).\n\nThe fix is simple: do what delete do ([github link|https://github.com/apache/zookeeper/blob/ac3371a133fffcb31e3f0c489a3564fe5ed2a851/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java#L491])\n\n[~yipng], Do you wanna work on this or will I create a patch based on the above discussion?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-07T03:17:37.817+0000","updated":"2014-10-07T03:17:37.817+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14161408","id":"14161408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"So in the fix I mean also changing parent's record like what delete operation does.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-07T03:22:58.029+0000","updated":"2014-10-07T03:22:58.029+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14161471","id":"14161471","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"I have another question: what's diff between create and create2?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-07T05:04:27.875+0000","updated":"2014-10-07T05:04:27.875+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14161505","id":"14161505","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~thawan].\n\nZOOKEEPER-1624 adds parent record into pendingOutstandings which introduces a concern in the [following line|https://github.com/apache/zookeeper/blob/ac3371a133fffcb31e3f0c489a3564fe5ed2a851/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java#L284]:\n{code}\n  Iterator<ChangeRecord> priorIter = pendingChangeRecords.values().iterator();\n            while (priorIter.hasNext()) {\n                ChangeRecord c = priorIter.next();\n                 ...\n                zks.outstandingChangesForPath.put(c.path, c);\n            }\n{code}\n\nThis might take parent records not in outstandingChanges (e.g. delete) into outstandingChangesForPath. Could you share any insight into this?\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-07T05:44:59.441+0000","updated":"2014-10-07T05:44:59.441+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14162039","id":"14162039","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"I think the root cause is for something that didn't exist in _outstandingChangesForPath_ would be added back because of [this line|https://github.com/apache/zookeeper/blob/ac3371a133fffcb31e3f0c489a3564fe5ed2a851/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java#L284].\n\nIn my humble understanding, the purpose of rollback is to restore what original _outstandingChanges_ and _outstandingChangesForPath_. So something that wasn't there should be removed instead of put zxid=-1.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-07T16:12:40.346+0000","updated":"2014-10-07T16:12:40.346+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14162066","id":"14162066","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"I also believe that in closeSession it's neccesary to addChangeRecord ( parentCr ). Even though this isn't the main problem and the effect is ephemeral -- outstandingChanges will be removed at the end.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-07T16:25:02.707+0000","updated":"2014-10-07T16:25:02.707+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14162073","id":"14162073","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~marshall].\n\nPlease see my above two comments. Can you share any insight to fix this problem?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-07T16:29:10.903+0000","updated":"2014-10-07T16:29:10.903+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14162344","id":"14162344","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Hongchao Deng wrote:\n>I think the root cause is for something that didn't exist in outstandingChangesForPath would be added back because of this line.\n>In my humble understanding, the purpose of rollback is to restore what original outstandingChanges and outstandingChangesForPath. So something that wasn't there should be removed >instead of put zxid=-1.\n\nRight, so if there was no entry in outstandingChangesForPath for the path to begin with, why save it during getPendingChanges()?  This is what the current patch is addressing, it checks to see if zxid != -1 before saving actual outstanding change for the path.  \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-07T19:17:12.075+0000","updated":"2014-10-07T19:17:12.075+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14162392","id":"14162392","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"[~yipng]\nI agree that your patch is a good start on finding the root cause.\n\nChecking zxid != -1 is kinda obscure in code and sounds a temp patch. Certain paths doesn't exist in _outstandingChangesForPath_ and we shouldn't put it back in rollback. This means the change record doesn't need to be constructed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-07T19:43:40.029+0000","updated":"2014-10-07T19:43:40.029+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14162436","id":"14162436","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"[~yipng]\nAnd the test should also reflect that the root cause for _outstandingChangesForPath_ is fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-07T20:05:22.248+0000","updated":"2014-10-07T20:05:22.248+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14162462","id":"14162462","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Hongchao\n\nI agree, perhaps getPendingChanges() should not call getRecordsForPath() and just check with outstandingChangesForPath directly.  I see difference places in the code where it has these hardcoded zxids with 0 and -1, perhaps they can get clean up in another jira to bring code clarity.  Let's continue to improve the patch.  =)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-07T20:21:16.728+0000","updated":"2014-10-07T20:21:16.728+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14162877","id":"14162877","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"[~rakeshr]\nGood catch!\nI think the code\n{code}\n if (!empty && (c.zxid < firstZxid)) {\n          continue;\n }\n{code}\nmeans that for anything that wasn't in outstanding shouldn't be put back into outSForPath. However, it failed when outstanding is empty","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T00:52:50.804+0000","updated":"2014-10-08T00:52:50.804+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14162998","id":"14162998","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Rakesh R, Hongchao Deng.\n\nYes, I think you guys are right.  Since the list is empty after the revert in rollbackPendingChanges(), this means possibly the FinalRequestProcessor thread have processed ChangeRecord and have removed it from the outstandingChanges list; hence, the logic in rollbackPendingChanges() should not apply any of the prior saved changes back into outstandingChangesForPath map.\n\nSo in summary, it appears there are two bugs found so far:\n\n1) getPendingChanges() saves ChangeRecord(s) for path that does not exist in outstandingChangesForPath ( zxid = -1 )\n2) rollbackPendingChanges() puts back prior saved changes back to outstandingChangesForPath when the outstandingChange list is empty.\n\nWorking on another patch now and will resubmit it for review.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T03:08:57.715+0000","updated":"2014-10-08T03:08:57.715+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14163013","id":"14163013","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"[~yipng]\nI am almost done with my patch...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T03:26:39.201+0000","updated":"2014-10-08T03:26:39.201+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14163020","id":"14163020","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"[~yipng]\nI am familiar with the outstanding stuff. Let me handle this in the low level code. Thanks :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T03:38:40.035+0000","updated":"2014-10-08T03:38:40.035+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14163029","id":"14163029","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Hongchao:\nSure, no problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T03:55:47.086+0000","updated":"2014-10-08T03:55:47.086+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14163049","id":"14163049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12673516/test-jenkins.patch\n  against trunk revision 1628224.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    -1 release audit.  The applied patch generated 2 release audit warnings (more than the trunk's current 0 warnings).\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2377//testReport/\nRelease audit warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2377//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2377//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2377//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-08T04:20:17.084+0000","updated":"2014-10-08T04:20:17.084+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14163065","id":"14163065","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Just took a brief look at the latest patch.  In rollingPendingChange(), the logic to compare with the firstZxid has been removed and now it applies the pending changes directly to outstandingChangesForPath.   Is it safe to do this?\n\nNote that between the time the pending changes are saved and the time the multi abort, the outstanding changes may have been removed by the FinalRequestProcessor thread.\n\n\n+            // add previously existed records back.\n+            for (ChangeRecord c: pendingChangeRecords.values()) {\n                 zks.outstandingChangesForPath.put(c.path, c);\n             }","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T04:53:57.608+0000","updated":"2014-10-08T04:53:57.608+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14163070","id":"14163070","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"That's right.\nI should add a comment there.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T04:59:43.681+0000","updated":"2014-10-08T04:59:43.681+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14163091","id":"14163091","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"body":"Hongchao:\n\nYou meant you will place back the logic for the firstZxid comparision in rollingPendingChange() right?  Since it may not be correct to assume that the saved pending changes are still in the outstandingChanges list due to race condition I mentioned on my previous comment.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","key":"yipng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T05:16:28.036+0000","updated":"2014-10-08T05:16:28.036+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14163094","id":"14163094","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"Yes. I also added a note on the code.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T05:17:22.144+0000","updated":"2014-10-08T05:17:22.144+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14163111","id":"14163111","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"Created a RB: https://reviews.apache.org/r/26437/diff/#","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T05:35:33.180+0000","updated":"2014-10-08T05:35:33.180+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14163139","id":"14163139","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12673530/ZOOKEEPER-2052-v2.patch\n  against trunk revision 1628224.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 9 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    -1 release audit.  The applied patch generated 2 release audit warnings (more than the trunk's current 0 warnings).\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2378//testReport/\nRelease audit warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2378//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2378//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2378//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-08T06:19:30.358+0000","updated":"2014-10-08T06:19:30.358+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14164016","id":"14164016","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12673651/ZOOKEEPER-2052-v3.patch\n  against trunk revision 1630026.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 9 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    -1 release audit.  The applied patch generated 2 release audit warnings (more than the trunk's current 0 warnings).\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2380//testReport/\nRelease audit warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2380//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2380//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2380//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-08T19:26:04.819+0000","updated":"2014-10-08T19:26:04.819+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14164080","id":"14164080","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"[~fpj] [~rakeshr] [~rgs]\n\nThis bug is reproducible by aborting multi for a delete.\nCan you take a look at the patch: https://reviews.apache.org/r/26437/diff/# ?\n\nThe release audit might be caused by the legacy Apache header starting with \"/**\" (should be one star). I have updated them in latest patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T20:11:21.403+0000","updated":"2014-10-08T20:11:21.403+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14164134","id":"14164134","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12673687/ZOOKEEPER-2052-v3.patch\n  against trunk revision 1630026.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 9 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    -1 release audit.  The applied patch generated 2 release audit warnings (more than the trunk's current 0 warnings).\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2381//testReport/\nRelease audit warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2381//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2381//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2381//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-08T20:50:52.717+0000","updated":"2014-10-08T20:50:52.717+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14164168","id":"14164168","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rgs","name":"rgs","key":"rgs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rgs&avatarId=18469","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rgs&avatarId=18469","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rgs&avatarId=18469","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rgs&avatarId=18469"},"displayName":"Raul Gutierrez Segales","active":true,"timeZone":"America/Los_Angeles"},"body":"[~hdeng]: reviewed. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rgs","name":"rgs","key":"rgs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rgs&avatarId=18469","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rgs&avatarId=18469","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rgs&avatarId=18469","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rgs&avatarId=18469"},"displayName":"Raul Gutierrez Segales","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-08T21:06:34.630+0000","updated":"2014-10-08T21:06:34.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14164195","id":"14164195","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12673707/ZOOKEEPER-2052-v3-release.patch\n  against trunk revision 1630026.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 9 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    -1 release audit.  The applied patch generated 2 release audit warnings (more than the trunk's current 0 warnings).\n\n    -1 core tests.  The patch failed core unit tests.\n\n    -1 contrib tests.  The patch failed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2382//testReport/\nRelease audit warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2382//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2382//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2382//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-08T21:23:25.498+0000","updated":"2014-10-08T21:23:25.498+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14164196","id":"14164196","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12673710/ZOOKEEPER-2052-v4.patch\n  against trunk revision 1630026.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 9 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    -1 release audit.  The applied patch generated 2 release audit warnings (more than the trunk's current 0 warnings).\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2383//testReport/\nRelease audit warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2383//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2383//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2383//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-08T21:23:26.113+0000","updated":"2014-10-08T21:23:26.113+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14164451","id":"14164451","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12673758/ZOOKEEPER-2052-v4.patch\n  against trunk revision 1630026.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 9 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    -1 release audit.  The applied patch generated 2 release audit warnings (more than the trunk's current 0 warnings).\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2384//testReport/\nRelease audit warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2384//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2384//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2384//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-09T00:22:07.730+0000","updated":"2014-10-09T00:22:07.730+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14165303","id":"14165303","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"[~rakeshr] [~fpj] [~marshall] [~tdunning]\n\nThe failure seems irrelevant. Please review this patch: https://reviews.apache.org/r/26437/diff/#\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-09T16:03:10.164+0000","updated":"2014-10-09T16:03:10.164+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14166065","id":"14166065","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I haven't been following this issue closely, give me some time to digest it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2014-10-10T00:34:54.393+0000","updated":"2014-10-10T00:34:54.393+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14166076","id":"14166076","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"[~fpj]\nGreat!\nJust a brief sum-up :)\nThe issue is caused by multi rollback that put records from zkDatabase into outStandingChangesForPath:\n\nhttps://github.com/apache/zookeeper/blob/ac3371a133fffcb31e3f0c489a3564fe5ed2a851/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java#L232\n\nhttps://github.com/apache/zookeeper/blob/ac3371a133fffcb31e3f0c489a3564fe5ed2a851/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java#L284","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-10T00:40:36.559+0000","updated":"2014-10-10T00:40:36.559+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14166509","id":"14166509","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=marshall","name":"marshall","key":"marshall","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marshall McMullen","active":true,"timeZone":"America/Denver"},"body":"I'm just seeing this jira for the first time as well. It looks like a really fantastic find and definitely very concerning if the issue is indeed as you describe. I'm pretty swamped at work at present so it may take me a few days before I'll have a chance to dig into this but I'll be very happy to do so... Will update when I've had a chance to digest this issue and comment on it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=marshall","name":"marshall","key":"marshall","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marshall McMullen","active":true,"timeZone":"America/Denver"},"created":"2014-10-10T07:22:18.219+0000","updated":"2014-10-10T07:22:18.219+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14170164","id":"14170164","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Here is my initial reaction to the patch. The changes to rollback seem ok. I'm wondering though if we can't get around with getRecordForPath() and if we really need to declare getOutstandingChange(). One of the problems pointed out here is that getPendingChanges is adding a record for a path that doesn't exist and I was wondering why a nonode exception is not being thrown for such a znode, which would skip the addition of the -1 record to the hashmap. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2014-10-13T22:56:34.366+0000","updated":"2014-10-13T22:56:34.366+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14170185","id":"14170185","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~fpj]. Thanks for looking at it.\n\nbq. One of the problems pointed out here is that getPendingChanges is adding a record for a path that doesn't exist and I was wondering why a nonode exception is not being thrown for such a znode, which would skip the addition of the -1 record to the hashmap.\n\nI didn't get your question..\nSo the case described is:\n\n* ClientA.create( \"/a\", ... PERSISTENT) => succeed\n* ClientB.create( \"/a/b\", ... EPHEMERAL) => succeed\n* ClientA.multi([ delete(\"/a\") ]) => fail, abort. This left a OutStandingRecord{ path=\"/a\", zxid=-1, childCount=1} which didn't get removed.\n* ClientB disconnect.\n* ClientA.delete(\"/a\") => fail. Because it gets the left [OutStandingRecord|https://github.com/fengjingchao/zookeeper/blob/trunk/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java#L482] and thinks [childCount > 0|https://github.com/fengjingchao/zookeeper/blob/trunk/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java#L485]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-13T23:09:11.290+0000","updated":"2014-10-13T23:09:11.290+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14170245","id":"14170245","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"[~fpj]\n\nbq. I was wondering why a nonode exception is not being thrown for such a znode, which would skip the addition of the -1 record to the hashmap.\n\nI think I understand kinda... So the node does exist. It's just not in outstanding changes. Every operation will be removed from outstanding changes after FinalRequestProcessor.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-13T23:41:27.415+0000","updated":"2014-10-13T23:41:27.415+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14170332","id":"14170332","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. I'm wondering though if we can't get around with getRecordForPath()\n\nI think using getRecordForPath() would still work :) Let me know what you think.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-14T01:11:17.552+0000","updated":"2014-10-14T01:11:17.552+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14171618","id":"14171618","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Sure, got it. Initially I didn't like that much that we are adding getOutstandingChange, which is a tweaked version of getRecordForPath, but after having another look, I think it is clean like this. It is fine with me to leave getOutstandingChange unless you can think of clean way of removing it.\n\nLet me do some local testing and I'll +1 it. Also, have you checked if we need separate patches for branches 3.4, 3.5, and trunk? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2014-10-14T22:08:48.348+0000","updated":"2014-10-14T22:08:48.348+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14171636","id":"14171636","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"This patch is tested on trunk. I was waiting for feedback from you or anyone else who have experience in multi() stuff.\nAs long as the patch makes sense, it would be easy for me to create relevant patches for 3.4, 3.5 :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-14T22:19:23.212+0000","updated":"2014-10-14T22:19:23.212+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14171988","id":"14171988","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=marshall","name":"marshall","key":"marshall","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marshall McMullen","active":true,"timeZone":"America/Denver"},"body":"I'm going to go look over the final version of this patch on RB, but I think you guys have absolutely nailed this problem. I would I could give some useful insight into why it was originally implemented this way but I think it was just an oversight on our part. The particular use case of deleting a multi with intermixed ephemeral nodes is one we would never have encountered or tested against and thus I probably just didn't think of that... Anyhow, great find.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=marshall","name":"marshall","key":"marshall","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marshall McMullen","active":true,"timeZone":"America/Denver"},"created":"2014-10-15T04:59:39.778+0000","updated":"2014-10-15T04:59:39.778+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14171996","id":"14171996","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=marshall","name":"marshall","key":"marshall","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marshall McMullen","active":true,"timeZone":"America/Denver"},"body":"I reviewed the RB and the changes look solid to me. +1 from me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=marshall","name":"marshall","key":"marshall","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marshall McMullen","active":true,"timeZone":"America/Denver"},"created":"2014-10-15T05:04:26.554+0000","updated":"2014-10-15T05:04:26.554+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14172057","id":"14172057","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"[~hdeng] Thanks for the patch. Test cases looks nice. I've added few comments in RB, pls see before preparing the final patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2014-10-15T06:21:10.244+0000","updated":"2014-10-15T06:21:10.244+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14172505","id":"14172505","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I'm cancelling the patch until we fix the issues that [~rakeshr] has raised and we have patches for all branches. Otw, +1, lgtm.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2014-10-15T15:58:24.506+0000","updated":"2014-10-15T15:58:24.506+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14172551","id":"14172551","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"[~rakeshr]\nThanks for the comments. Addressed them and feel welcome to take a look at the new changes. https://reviews.apache.org/r/26437/diff/#","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-15T16:32:03.351+0000","updated":"2014-10-15T16:32:03.351+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14172677","id":"14172677","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12675045/ZOOKEEPER-2052-v5.patch\n  against trunk revision 1631280.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 6 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2391//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2391//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2391//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-15T17:55:53.603+0000","updated":"2014-10-15T17:55:53.603+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14172715","id":"14172715","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12675054/ZOOKEEPER-2052-v5.patch\n  against trunk revision 1631280.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 6 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2392//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2392//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2392//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-15T18:16:04.349+0000","updated":"2014-10-15T18:16:04.349+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14173911","id":"14173911","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"My local jenkins job showed the branch34 patch also passed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-16T16:22:11.959+0000","updated":"2014-10-16T16:22:11.959+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14176045","id":"14176045","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"[~fpj][~rakeshr]\nThe two patches for trunk and branch-3.4 has been uploaded and tested.\nPlease take a time to review it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-18T15:45:37.003+0000","updated":"2014-10-18T15:45:37.003+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14176076","id":"14176076","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"+1, the latest patch looks good to me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2014-10-18T18:37:08.188+0000","updated":"2014-10-18T18:37:08.188+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14184004","id":"14184004","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"I think [~fpj] has already given +1. Please feel free to stop me if anything else:)\n\nI'll commit this tomorrow sometime. Thanks everyone for the reviews!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2014-10-25T06:48:21.511+0000","updated":"2014-10-25T06:48:21.511+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14186351","id":"14186351","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Thank you [~hdeng] and [~yipng].\n\nCommitted to trunk : http://svn.apache.org/viewvc?view=revision&revision=1634776\nCommitted to br3.4 : http://svn.apache.org/viewvc?view=revision&revision=1634777\nCommitted to br3.5 : http://svn.apache.org/viewvc?view=revision&revision=1634778","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2014-10-28T04:40:58.733+0000","updated":"2014-10-28T04:40:58.733+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12745421/comment/14186700","id":"14186700","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in ZooKeeper-trunk #2484 (See [https://builds.apache.org/job/ZooKeeper-trunk/2484/])\nZOOKEEPER-2052 Unable to delete a node when the node has no children (Hongchao Deng and Yip Ng via rakeshr) (rakeshr: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1634776)\n* /zookeeper/trunk/CHANGES.txt\n* /zookeeper/trunk/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java\n* /zookeeper/trunk/src/java/test/org/apache/zookeeper/server/PrepRequestProcessorTest.java\n* /zookeeper/trunk/src/java/test/org/apache/zookeeper/test/MultiTransactionTest.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-28T11:10:52.283+0000","updated":"2014-10-28T11:10:52.283+0000"}],"maxResults":70,"total":70,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2052/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i20pr3:"}}