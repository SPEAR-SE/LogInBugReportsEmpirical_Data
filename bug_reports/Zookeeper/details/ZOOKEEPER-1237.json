{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12527972","self":"https://issues.apache.org/jira/rest/api/2/issue/12527972","key":"ZOOKEEPER-1237","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12338036","id":"12338036","description":"Fix release against 3.4 branch","name":"3.4.10","archived":false,"released":true,"releaseDate":"2017-03-30"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2011-10-20T22:44:54.766+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Dec 21 09:07:20 UTC 2016","customfield_12310420":"92387","customfield_12312320":null,"customfield_12310222":"1_*:*_2_*:*_166172589598_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_60170","customfield_12312321":null,"resolutiondate":"2017-01-24T23:58:58.377+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1237/watchers","watchCount":39,"isWatching":false},"created":"2011-10-20T16:54:48.773+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316276","id":"12316276","description":"Fix release against 3.3 branch","name":"3.3.4","archived":false,"released":true,"releaseDate":"2011-11-26"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314469","id":"12314469","description":"Kerberos client auth, multi support, deb/rpm pkging.","name":"3.4.0","archived":false,"released":true,"releaseDate":"2011-11-22"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316644","id":"12316644","description":"Dynamic Reconfig, Remove Watches, Local Session","name":"3.5.0","archived":false,"released":true,"releaseDate":"2014-08-04"}],"issuelinks":[{"id":"12492165","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12492165","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12743135","key":"ZOOKEEPER-2044","self":"https://issues.apache.org/jira/rest/api/2/issue/12743135","fields":{"summary":"CancelledKeyException in zookeeper branch-3.4","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-05-31T00:16:03.659+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"After applying ZOOKEEPER-1049 to 3.3.3 (I believe the same problem exists in 3.4/3.5 but haven't tested this) I'm seeing the following exception more frequently:\n\n{noformat}\nOct 19, 1:31:53 PM ERROR\nUnexpected Exception:\njava.nio.channels.CancelledKeyException\nat sun.nio.ch.SelectionKeyImpl.ensureValid(SelectionKeyImpl.java:55)\nat sun.nio.ch.SelectionKeyImpl.interestOps(SelectionKeyImpl.java:59)\nat org.apache.zookeeper.server.NIOServerCnxn.sendBuffer(NIOServerCnxn.java:418)\nat org.apache.zookeeper.server.NIOServerCnxn.sendResponse(NIOServerCnxn.java:1509)\nat org.apache.zookeeper.server.FinalRequestProcessor.processRequest(FinalRequestProcessor.java:367)\nat org.apache.zookeeper.server.quorum.CommitProcessor.run(CommitProcessor.java:73)\n{noformat}\n\nThis is a long standing problem where we try to send a response after the socket has been closed. Prior to ZOOKEEPER-1049 this issues happened much less frequently (2 sec linger), but I believe it was possible. The timing window is just wider now.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12596704","id":"12596704","filename":"zookeeper-3.4.5-ZK1237.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cls","name":"cls","key":"cls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Seawood","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-07T20:57:22.785+0000","size":2240,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12596704/zookeeper-3.4.5-ZK1237.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"32655","customfield_12312823":null,"summary":"ERRORs being logged when queued responses are sent after socket has closed.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/13131859","id":"13131859","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"sendBuffer is eating (log then ignore) any Exception generated by sock.write - this is problematic.\n\nIn this case - cancelledkeyexception, say the caller is watch notification. We'll end up flooding the logs with ERRORS, one for each failed notification. If we provided indication of failure back to the caller it could decide to stop sending notifications earlier.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-10-20T18:11:48.551+0000","updated":"2011-10-20T18:11:48.551+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/13132146","id":"13132146","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fournc","name":"fournc","key":"fournc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Camille Fournier","active":true,"timeZone":"Etc/UTC"},"body":"Why do we ignore that exception in sendBuffer, instead of closing the connection at that point?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fournc","name":"fournc","key":"fournc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Camille Fournier","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-20T22:44:54.766+0000","updated":"2011-10-20T22:44:54.766+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/13144820","id":"13144820","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"body":"Moving it out of 3.4.0, not a blocker.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"created":"2011-11-05T20:26:40.174+0000","updated":"2011-11-05T20:26:40.174+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/13640683","id":"13640683","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eikenberry","name":"eikenberry","key":"eikenberry","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Eikenberry","active":true,"timeZone":"America/Los_Angeles"},"body":"Using 3.3.5 these errors are filling up my logs making it harder to diagnose issues when they do happen. Is there any progress on this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eikenberry","name":"eikenberry","key":"eikenberry","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Eikenberry","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-24T17:28:24.194+0000","updated":"2013-04-24T17:28:24.194+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/13732728","id":"13732728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cls","name":"cls","key":"cls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Seawood","active":true,"timeZone":"America/Los_Angeles"},"body":"This patch downgrades the EndOfStream Exception to a debug message.  It also adds .isValid() checks to avoid the CancelledKeyException.\n\nAt a glance, the real problem appears to be that there's no way for the client to deregister itself from the server via the C API.  According to zookeeper.h, calling zookeeper_close() is supposed to close the filehandle and free up resources (presumably on the client side) but afaict, there's nothing on the server side to acknowledge that a client has legitimately disconnected.  In NIOServerCnxn.java, there's even a comment to the effect that when the server initiates a disconnect, it only closes the socket and then lets the doIO() routine clean things up, which results in the additional exceptions being thrown.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cls","name":"cls","key":"cls","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Seawood","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-07T20:57:22.787+0000","updated":"2013-08-07T20:57:22.787+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/13860047","id":"13860047","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tobe","name":"tobe","key":"tobe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"chendihao","active":true,"timeZone":"Asia/Shanghai"},"body":"Is there any progress now? [~phunt]\nWe have the same problem when shutting down the thread without closing the client. Using 3.3.5. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tobe","name":"tobe","key":"tobe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"chendihao","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-01-02T06:45:32.136+0000","updated":"2014-01-02T06:45:32.136+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/14000951","id":"14000951","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michim","name":"michim","key":"michim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michi Mutsuzaki","active":true,"timeZone":"America/Los_Angeles"},"body":"Is this still a problem in 3.4/3.5? How can I reproduce this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michim","name":"michim","key":"michim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michi Mutsuzaki","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-18T02:26:30.568+0000","updated":"2014-05-18T02:26:30.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/14005490","id":"14005490","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanpeng+Lin","name":"yanpeng Lin","key":"yanpeng lin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yanpeng Lin","active":true,"timeZone":"Asia/Tokyo"},"body":"I got this CancelledKeyException from 3.4.6.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yanpeng+Lin","name":"yanpeng Lin","key":"yanpeng lin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yanpeng Lin","active":true,"timeZone":"Asia/Tokyo"},"created":"2014-05-22T01:09:16.957+0000","updated":"2014-05-22T01:09:16.957+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/14005497","id":"14005497","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michim","name":"michim","key":"michim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michi Mutsuzaki","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Yanpeng. Would it be easy to write a small testcase to reproduce the issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michim","name":"michim","key":"michim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michi Mutsuzaki","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-22T01:13:35.846+0000","updated":"2014-05-22T01:13:35.846+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/14041345","id":"14041345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clarkhaskins","name":"clarkhaskins","key":"clarkhaskins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Clark Haskins","active":true,"timeZone":"Etc/UTC"},"body":"2014-06-23 19:43:20,227 - ERROR [CommitProcessor:3:NIOServerCnxn@445] - Unexpected Exception:\njava.nio.channels.CancelledKeyException\n\tat sun.nio.ch.SelectionKeyImpl.ensureValid(SelectionKeyImpl.java:55)\n\tat sun.nio.ch.SelectionKeyImpl.interestOps(SelectionKeyImpl.java:59)\n\tat org.apache.zookeeper.server.NIOServerCnxn.sendBuffer(NIOServerCnxn.java:418)\n\tat org.apache.zookeeper.server.NIOServerCnxn.sendResponse(NIOServerCnxn.java:1509)\n\tat org.apache.zookeeper.server.NIOServerCnxn.process(NIOServerCnxn.java:1545)\n\tat org.apache.zookeeper.server.WatchManager.triggerWatch(WatchManager.java:115)\n\tat org.apache.zookeeper.server.WatchManager.triggerWatch(WatchManager.java:87)\n\tat org.apache.zookeeper.server.DataTree.deleteNode(DataTree.java:577)\n\tat org.apache.zookeeper.server.DataTree.killSession(DataTree.java:829)\n\tat org.apache.zookeeper.server.DataTree.processTxn(DataTree.java:804)\n\tat org.apache.zookeeper.server.ZKDatabase.processTxn(ZKDatabase.java:328)\n\tat org.apache.zookeeper.server.FinalRequestProcessor.processRequest(FinalRequestProcessor.java:103)\n\tat org.apache.zookeeper.server.quorum.CommitProcessor.run(CommitProcessor.java:73)\n2014-06-23 19:43:20,227 - ERROR [CommitProcessor:3:NIOServerCnxn@445] - Unexpected Exception:\njava.nio.channels.CancelledKeyException\n\tat sun.nio.ch.SelectionKeyImpl.ensureValid(SelectionKeyImpl.java:55)\n\tat sun.nio.ch.SelectionKeyImpl.interestOps(SelectionKeyImpl.java:59)\n\tat org.apache.zookeeper.server.NIOServerCnxn.sendBuffer(NIOServerCnxn.java:418)\n\tat org.apache.zookeeper.server.NIOServerCnxn.sendResponse(NIOServerCnxn.java:1509)\n\tat org.apache.zookeeper.server.NIOServerCnxn.process(NIOServerCnxn.java:1545)\n\tat org.apache.zookeeper.server.WatchManager.triggerWatch(WatchManager.java:115)\n\tat org.apache.zookeeper.server.WatchManager.triggerWatch(WatchManager.java:87)\n\tat org.apache.zookeeper.server.DataTree.deleteNode(DataTree.java:577)\n\tat org.apache.zookeeper.server.DataTree.killSession(DataTree.java:829)\n\tat org.apache.zookeeper.server.DataTree.processTxn(DataTree.java:804)\n\tat org.apache.zookeeper.server.ZKDatabase.processTxn(ZKDatabase.java:328)\n\tat org.apache.zookeeper.server.FinalRequestProcessor.processRequest(FinalRequestProcessor.java:103)\n\tat org.apache.zookeeper.server.quorum.CommitProcessor.run(CommitProcessor.java:73)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clarkhaskins","name":"clarkhaskins","key":"clarkhaskins","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Clark Haskins","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-23T21:31:30.351+0000","updated":"2014-06-23T21:31:30.351+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/14041348","id":"14041348","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jonbringhurst","name":"jonbringhurst","key":"jonbringhurst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jonbringhurst&avatarId=19323","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jonbringhurst&avatarId=19323","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jonbringhurst&avatarId=19323","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jonbringhurst&avatarId=19323"},"displayName":"Jon Bringhurst","active":true,"timeZone":"America/Los_Angeles"},"body":"[~clarkhaskins]'s stack trace is for Zookeeper 3.3.4.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jonbringhurst","name":"jonbringhurst","key":"jonbringhurst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jonbringhurst&avatarId=19323","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jonbringhurst&avatarId=19323","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jonbringhurst&avatarId=19323","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jonbringhurst&avatarId=19323"},"displayName":"Jon Bringhurst","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-23T21:33:12.994+0000","updated":"2014-06-23T21:33:12.994+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/14042140","id":"14042140","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I'm essentially wondering the same thing as Michi, are the additional checks in the proposed patch enough?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2014-06-24T14:07:34.845+0000","updated":"2014-06-24T14:07:34.845+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/14055547","id":"14055547","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=getadroit%40gmail.com","name":"getadroit@gmail.com","key":"getadroit@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"adroit","active":true,"timeZone":"Etc/UTC"},"body":"I am using 3.4.6 and we have same issue.\n\nERROR [CommitProcessor:1:NIOServerCnxn@178] - Unexpected Exception:\njava.nio.channels.CancelledKeyException\n        at sun.nio.ch.SelectionKeyImpl.ensureValid(Unknown Source)\n        at sun.nio.ch.SelectionKeyImpl.interestOps(Unknown Source)\n        at org.apache.zookeeper.server.NIOServerCnxn.sendBuffer(NIOServerCnxn.java:151)\n        at org.apache.zookeeper.server.NIOServerCnxn.sendResponse(NIOServerCnxn.java:1081)\n        at org.apache.zookeeper.server.NIOServerCnxn.process(NIOServerCnxn.java:1118)\n        at org.apache.zookeeper.server.WatchManager.triggerWatch(WatchManager.java:120)\n        at org.apache.zookeeper.server.WatchManager.triggerWatch(WatchManager.java:92)\n        at org.apache.zookeeper.server.DataTree.deleteNode(DataTree.java:591)\n        at org.apache.zookeeper.server.DataTree.processTxn(DataTree.java:802)\n        at org.apache.zookeeper.server.ZKDatabase.processTxn(ZKDatabase.java:329)\n        at org.apache.zookeeper.server.ZooKeeperServer.processTxn(ZooKeeperServer.java:994)\n        at org.apache.zookeeper.server.FinalRequestProcessor.processRequest(FinalRequestProcessor.java:116)\n        at org.apache.zookeeper.server.quorum.CommitProcessor.run(CommitProcessor.java:74)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=getadroit%40gmail.com","name":"getadroit@gmail.com","key":"getadroit@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"adroit","active":true,"timeZone":"Etc/UTC"},"created":"2014-07-08T21:13:52.373+0000","updated":"2014-07-08T21:13:52.373+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/15011378","id":"15011378","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arcadius","name":"arcadius","key":"arcadius","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arcadius Ahouansou","active":true,"timeZone":"Europe/London"},"body":"Any progress on this please?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arcadius","name":"arcadius","key":"arcadius","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arcadius Ahouansou","active":true,"timeZone":"Europe/London"},"created":"2015-11-18T16:49:13.474+0000","updated":"2015-11-18T16:49:13.474+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527972/comment/15766534","id":"15766534","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=DEvil0000","name":"DEvil0000","key":"devil0000","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Binzberger","active":true,"timeZone":"Europe/Berlin"},"body":"looks similar to ZOOKEEPER-2044 - could this be the same thing?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=DEvil0000","name":"DEvil0000","key":"devil0000","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Binzberger","active":true,"timeZone":"Europe/Berlin"},"created":"2016-12-21T09:07:20.073+0000","updated":"2016-12-21T09:07:20.073+0000"}],"maxResults":15,"total":15,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1237/votes","votes":16,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i05yan:"}}