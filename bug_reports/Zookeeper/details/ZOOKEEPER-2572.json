{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13003762","self":"https://issues.apache.org/jira/rest/api/2/issue/13003762","key":"ZOOKEEPER-2572","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-09-13T22:08:36.385+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Sep 07 07:14:59 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2572/watchers","watchCount":5,"isWatching":false},"created":"2016-09-09T05:50:32.560+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334700","id":"12334700","description":"Fix release against 3.4 branch","name":"3.4.9","archived":false,"released":true,"releaseDate":"2016-09-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12331981","id":"12331981","description":"Alpha release against 3.5 branch","name":"3.5.2","archived":false,"released":true,"releaseDate":"2016-07-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12339207","id":"12339207","description":"Fix release against 3.4 branch","name":"3.4.11","archived":false,"released":true,"releaseDate":"2017-11-09"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gaoshu","name":"gaoshu","key":"gaoshu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"gaoshu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-06-22T04:49:04.360+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"In FileTxnLog.truncate, we have:\n{code}\npublic boolean truncate(long zxid) throws IOException {\n        FileTxnIterator itr = null;\n        try {\n            itr = new FileTxnIterator(this.logDir, zxid);\n            PositionInputStream input = itr.inputStream;\n            if(input == null) {\n                throw new IOException(\"No log files found to truncate! This could \" +\n                        \"happen if you still have snapshots from an old setup or \" +\n                        \"log files were deleted accidentally or dataLogDir was changed in zoo.cfg.\");\n            }\n            long pos = input.getPosition();\n            // now, truncate at the current position\n            RandomAccessFile raf=new RandomAccessFile(itr.logFile,\"rw\");\n            raf.setLength(pos);\n            raf.close();\n            while(itr.goToNextLog()) {\n                if (!itr.logFile.delete()) {\n                    LOG.warn(\"Unable to truncate {}\", itr.logFile);\n                }\n            }\n        } finally {\n            close(itr);\n        }\n        return true;\n    }\n{code}\n\n{{raf}} here can be potentially in a state of not closed after leaving the method, if there is an (IO) exception thrown from setLength.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Potential resource leak in FileTxnLog.truncate","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/15488593","id":"15488593","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"body":"Hey [~hanm], really good catch! :D \n\n/cc [~fpj], [~breed], [~rakesh_r]\n\nWhile studying this piece of code, I have seen a curious fact: *{{FileTxnLog.truncate}} never returns false*. It's either throws IOException or returns {{true}}.\n\nBut then it's call hierarchy eventually calls {{ZkDatabase.truncateLog}} as below (my comments are in upper case below):\n{code}\n    public boolean truncateLog(long zxid) throws IOException {\n        clear();\n\n        // truncate the log\n        boolean truncated = snapLog.truncateLog(zxid);\n\n        // IT WILL NEVER ENTER IN THIS IF\n        if (!truncated) {\n            return false;\n        }\n\n        loadDataBase();\n        return true;\n    }\n{code}\n\nAnd the method above is called by {{Learner.syncWithLeader}}, again with a snippet below that will never be called, plus getting out of the {{syncWithLeader}} middway. \n\n{code}\n                boolean truncated=zk.getZKDatabase().truncateLog(qp.getZxid());\n                // AGAIN, NEVER CAN WILL BE TRUE\n                if (!truncated) {\n                    // not able to truncate the log\n                    LOG.error(\"Not able to truncate the log \"\n                            + Long.toHexString(qp.getZxid()));\n                    System.exit(13);\n                }\n{code}\n\nDoes it make sense what I am saying?\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"created":"2016-09-13T22:08:36.385+0000","updated":"2016-09-13T22:11:37.388+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/15488628","id":"15488628","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"body":"My central question is: besides the possible resource leak that Michael pointed out, what's the right way of dealing with being unable to truncate the log file? Return false if unable to truncate the file in the while loop? To catch the exception in {{raf.setLength(pos);}} and set a flag to false? Let any error bubble up and remove the {{boolean truncated = }} from the calling methods?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eribeiro","name":"eribeiro","key":"eribeiro","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=eribeiro&avatarId=16169","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=eribeiro&avatarId=16169","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=eribeiro&avatarId=16169","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=eribeiro&avatarId=16169"},"displayName":"Edward Ribeiro","active":true,"timeZone":"America/Sao_Paulo"},"created":"2016-09-13T22:20:41.190+0000","updated":"2016-09-13T22:20:41.190+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/15488886","id":"15488886","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"bq. Does it make sense what I am saying?\nI think that is dead code, good catch.\n\nbq. what's the right way of dealing with being unable to truncate the log file?\nCurrently if a file failed to truncate, the exception will bubble up and got caught in [Follower.java|https://github.com/apache/zookeeper/blob/master/src/java/main/org/apache/zookeeper/server/quorum/Follower.java#L93], so the error is handled - but we lose the original (IMO) better error message logging of {{LOG.error(\"Not able to truncate the log \"+ Long.toHexString(qp.getZxid()));}}. Maybe we can catch the exception at syncWithLeader, log the detailed error with zxid, then rethrow it. \n\nAnd it certainly sounds odd that we have a boolean return signature which only return true...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2016-09-14T00:02:59.156+0000","updated":"2016-09-14T00:02:59.156+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16150402","id":"16150402","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gaoshu","name":"gaoshu","key":"gaoshu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"gaoshu","active":true,"timeZone":"Asia/Shanghai"},"body":"In addition, I think the {{itr.logFile.delete()}} can be replaced by {{Files.delete(itr.logFile.toPath())}}. If failed, Files.delete can throw an exception, which this is useful for error reporting and to diagnosed why a file cannot be deleted. Then the function will return void if successful, or throw an exception.  Then we can log the detailed error and rethrow it. But the Files.delete is available for jdk1.7 +","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gaoshu","name":"gaoshu","key":"gaoshu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"gaoshu","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-09-01T11:52:17.130+0000","updated":"2017-09-01T11:54:33.315+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16150427","id":"16150427","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user bitgaoshu opened a pull request:\n\n    https://github.com/apache/zookeeper/pull/356\n\n    ZOOKEEPER-2572: Fix potential resource leak in FileTxnLog.truncate\n\n    \n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/bitgaoshu/zookeeper fix/ZOOKEEPER-2572\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/356.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #356\n    \n----\ncommit 4c21eb8bc56ed4d54dac8d1a16f054f08f2efc2e\nAuthor: bitgaoshu <bitgaoshu@gmail.com>\nDate:   2017-08-31T12:24:40Z\n\n    ZOOKEEPER-2572: Fix potential resource leak in FileTxnLog.truncate\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-01T12:23:48.012+0000","updated":"2017-09-01T12:23:48.012+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16150449","id":"16150449","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +0 tests included.  The patch appears to be a documentation patch that doesn't require tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/988//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/988//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/988//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-01T12:44:45.783+0000","updated":"2017-09-01T12:44:45.783+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16152028","id":"16152028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user maoling commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/356#discussion_r136731827\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/persistence/FileTxnLog.java ---\n    @@ -399,18 +403,20 @@ public boolean truncate(long zxid) throws IOException {\n                 }\n                 long pos = input.getPosition();\n                 // now, truncate at the current position\n    -            RandomAccessFile raf=new RandomAccessFile(itr.logFile,\"rw\");\n    +            raf = new RandomAccessFile(itr.logFile, \"rw\");\n                 raf.setLength(pos);\n    -            raf.close();\n                 while(itr.goToNextLog()) {\n    -                if (!itr.logFile.delete()) {\n    -                    LOG.warn(\"Unable to truncate {}\", itr.logFile);\n    +                try {\n    +                    Files.delete(itr.logFile.toPath());\n    +                } catch (NoSuchFileException e) {\n                     }\n                 }\n             } finally {\n                 close(itr);\n    +            if (raf != null) {\n    +                raf.close();\n    +            }\n             }\n    -        return true;\n         }\n    --- End diff --\n    \n    IMHO.should we put code block `Line416-Line418 ` before ` Line415` ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-04T01:17:31.854+0000","updated":"2017-09-04T01:17:31.854+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16152029","id":"16152029","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user maoling commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/356#discussion_r136732072\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/persistence/FileTxnLog.java ---\n    @@ -399,18 +403,20 @@ public boolean truncate(long zxid) throws IOException {\n                 }\n                 long pos = input.getPosition();\n                 // now, truncate at the current position\n    -            RandomAccessFile raf=new RandomAccessFile(itr.logFile,\"rw\");\n    +            raf = new RandomAccessFile(itr.logFile, \"rw\");\n                 raf.setLength(pos);\n    -            raf.close();\n                 while(itr.goToNextLog()) {\n    -                if (!itr.logFile.delete()) {\n    -                    LOG.warn(\"Unable to truncate {}\", itr.logFile);\n    +                try {\n    +                    Files.delete(itr.logFile.toPath());\n    +                } catch (NoSuchFileException e) {\n                     }\n                 }\n    --- End diff --\n    \n    - Do we have any intentions for changing `itr.logFile.delete() `  to ` Files.delete(itr.logFile.toPath())` ? confused about this:\n       > Files.delete can throw an exception, which this is useful for error reporting and to diagnosed why a file cannot be deleted.\n    - catch `NoSuchFileException` with even no log ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-04T01:22:43.115+0000","updated":"2017-09-04T01:22:43.115+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16152030","id":"16152030","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user maoling commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/356#discussion_r136732115\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/quorum/Learner.java ---\n    @@ -395,11 +395,12 @@ else if (qp.getType() == Leader.SNAP) {\n                     //we need to truncate the log to the lastzxid of the leader\n                     LOG.warn(\"Truncating log to get in sync with the leader 0x\"\n                             + Long.toHexString(qp.getZxid()));\n    -                boolean truncated=zk.getZKDatabase().truncateLog(qp.getZxid());\n    -                if (!truncated) {\n    +                try {\n    +                    zk.getZKDatabase().truncateLog(qp.getZxid());\n    +                } catch (IOException e) {\n                         // not able to truncate the log\n    -                    LOG.error(\"Not able to truncate the log \"\n    -                            + Long.toHexString(qp.getZxid()));\n    +                    LOG.error(\"Not able to truncate the log {}, Unexpected exception \"\n    +                            + Long.toHexString(qp.getZxid()), e);\n                         System.exit(13);\n    --- End diff --\n    \n    this format of log is right?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-04T01:23:34.396+0000","updated":"2017-09-04T01:23:34.396+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16152061","id":"16152061","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user bitgaoshu commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/356#discussion_r136737378\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/persistence/FileTxnLog.java ---\n    @@ -399,18 +403,20 @@ public boolean truncate(long zxid) throws IOException {\n                 }\n                 long pos = input.getPosition();\n                 // now, truncate at the current position\n    -            RandomAccessFile raf=new RandomAccessFile(itr.logFile,\"rw\");\n    +            raf = new RandomAccessFile(itr.logFile, \"rw\");\n                 raf.setLength(pos);\n    -            raf.close();\n                 while(itr.goToNextLog()) {\n    -                if (!itr.logFile.delete()) {\n    -                    LOG.warn(\"Unable to truncate {}\", itr.logFile);\n    +                try {\n    +                    Files.delete(itr.logFile.toPath());\n    +                } catch (NoSuchFileException e) {\n                     }\n                 }\n             } finally {\n                 close(itr);\n    +            if (raf != null) {\n    +                raf.close();\n    +            }\n             }\n    -        return true;\n         }\n    --- End diff --\n    \n    o, sorry. I can't realize what the difference both.  Can you make me clear about that, then  I can fix it better?  Thanks\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-04T02:54:22.791+0000","updated":"2017-09-04T02:54:22.791+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16152082","id":"16152082","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user bitgaoshu commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/356#discussion_r136739382\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/quorum/Learner.java ---\n    @@ -395,11 +395,12 @@ else if (qp.getType() == Leader.SNAP) {\n                     //we need to truncate the log to the lastzxid of the leader\n                     LOG.warn(\"Truncating log to get in sync with the leader 0x\"\n                             + Long.toHexString(qp.getZxid()));\n    -                boolean truncated=zk.getZKDatabase().truncateLog(qp.getZxid());\n    -                if (!truncated) {\n    +                try {\n    +                    zk.getZKDatabase().truncateLog(qp.getZxid());\n    +                } catch (IOException e) {\n                         // not able to truncate the log\n    -                    LOG.error(\"Not able to truncate the log \"\n    -                            + Long.toHexString(qp.getZxid()));\n    +                    LOG.error(\"Not able to truncate the log {}, Unexpected exception \"\n    +                            + Long.toHexString(qp.getZxid()), e);\n                         System.exit(13);\n    --- End diff --\n    \n    update\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-04T03:31:02.918+0000","updated":"2017-09-04T03:31:02.918+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16152083","id":"16152083","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user bitgaoshu commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/356#discussion_r136739423\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/persistence/FileTxnLog.java ---\n    @@ -399,18 +403,20 @@ public boolean truncate(long zxid) throws IOException {\n                 }\n                 long pos = input.getPosition();\n                 // now, truncate at the current position\n    -            RandomAccessFile raf=new RandomAccessFile(itr.logFile,\"rw\");\n    +            raf = new RandomAccessFile(itr.logFile, \"rw\");\n                 raf.setLength(pos);\n    -            raf.close();\n                 while(itr.goToNextLog()) {\n    -                if (!itr.logFile.delete()) {\n    -                    LOG.warn(\"Unable to truncate {}\", itr.logFile);\n    +                try {\n    +                    Files.delete(itr.logFile.toPath());\n    +                } catch (NoSuchFileException e) {\n                     }\n                 }\n    --- End diff --\n    \n    - i think ```Files.delete```  can provide more detailed messages if delete operation failed.  I'm not sure this change is necessary or not.\n    - update\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-04T03:31:48.658+0000","updated":"2017-09-04T03:31:48.658+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16152091","id":"16152091","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +0 tests included.  The patch appears to be a documentation patch that doesn't require tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/991//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/991//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/991//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-04T03:44:13.074+0000","updated":"2017-09-04T03:44:13.074+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16152567","id":"16152567","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user bitgaoshu commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/356\n  \n    Test Again\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-04T12:37:28.620+0000","updated":"2017-09-04T12:37:28.620+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16153734","id":"16153734","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user maoling commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/356#discussion_r137003935\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/persistence/FileTxnLog.java ---\n    @@ -409,13 +409,15 @@ public void truncate(long zxid) throws IOException {\n                     try {\n                         Files.delete(itr.logFile.toPath());\n                     } catch (NoSuchFileException e) {\n    +                    LOG.info(\"An NoSuchFileException was thrown when delete file {}\" +\n    +                    \", but will continue. Assume this file has been deleted successfully.\", itr.logFile);\n                     }\n                 }\n             } finally {\n    -            close(itr);\n                 if (raf != null) {\n                     raf.close();\n    --- End diff --\n    \n    IMHO, `raf.close();`  should be surrounded with `try-catch` ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-05T14:29:10.881+0000","updated":"2017-09-05T14:29:10.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16153763","id":"16153763","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user maoling commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/356#discussion_r137008765\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/persistence/FileTxnLog.java ---\n    @@ -399,18 +403,20 @@ public boolean truncate(long zxid) throws IOException {\n                 }\n                 long pos = input.getPosition();\n                 // now, truncate at the current position\n    -            RandomAccessFile raf=new RandomAccessFile(itr.logFile,\"rw\");\n    +            raf = new RandomAccessFile(itr.logFile, \"rw\");\n                 raf.setLength(pos);\n    -            raf.close();\n                 while(itr.goToNextLog()) {\n    -                if (!itr.logFile.delete()) {\n    -                    LOG.warn(\"Unable to truncate {}\", itr.logFile);\n    +                try {\n    +                    Files.delete(itr.logFile.toPath());\n    +                } catch (NoSuchFileException e) {\n                     }\n                 }\n    --- End diff --\n    \n    - A option:  remain the origin code in the master branch unchanged.just log the `itr.logFile` and `zxid`\n    - B option:  choose `Files.delete`  because it throws `exception` rather than `itr.logFile.delete()` returns `boolean` ,**dont't catch it** and it will be caught in `Learner.java#syncWithLeader` and log it with `zxid`\n    - am I right?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-05T14:45:33.012+0000","updated":"2017-09-05T14:45:33.012+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16156575","id":"16156575","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user bitgaoshu commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/356#discussion_r137459795\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/persistence/FileTxnLog.java ---\n    @@ -409,13 +409,15 @@ public void truncate(long zxid) throws IOException {\n                     try {\n                         Files.delete(itr.logFile.toPath());\n                     } catch (NoSuchFileException e) {\n    +                    LOG.info(\"An NoSuchFileException was thrown when delete file {}\" +\n    +                    \", but will continue. Assume this file has been deleted successfully.\", itr.logFile);\n                     }\n                 }\n             } finally {\n    -            close(itr);\n                 if (raf != null) {\n                     raf.close();\n    --- End diff --\n    \n    update\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-07T06:55:31.365+0000","updated":"2017-09-07T06:55:31.365+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16156576","id":"16156576","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user bitgaoshu commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/356#discussion_r137459820\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/persistence/FileTxnLog.java ---\n    @@ -399,18 +403,20 @@ public boolean truncate(long zxid) throws IOException {\n                 }\n                 long pos = input.getPosition();\n                 // now, truncate at the current position\n    -            RandomAccessFile raf=new RandomAccessFile(itr.logFile,\"rw\");\n    +            raf = new RandomAccessFile(itr.logFile, \"rw\");\n                 raf.setLength(pos);\n    -            raf.close();\n                 while(itr.goToNextLog()) {\n    -                if (!itr.logFile.delete()) {\n    -                    LOG.warn(\"Unable to truncate {}\", itr.logFile);\n    +                try {\n    +                    Files.delete(itr.logFile.toPath());\n    +                } catch (NoSuchFileException e) {\n                     }\n                 }\n    --- End diff --\n    \n    update\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-07T06:55:40.234+0000","updated":"2017-09-07T06:55:40.234+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13003762/comment/16156601","id":"16156601","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +0 tests included.  The patch appears to be a documentation patch that doesn't require tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1002//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1002//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1002//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-09-07T07:14:59.813+0000","updated":"2017-09-07T07:14:59.813+0000"}],"maxResults":19,"total":19,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2572/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i33fdj:"}}