{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12666137","self":"https://issues.apache.org/jira/rest/api/2/issue/12666137","key":"ZOOKEEPER-1747","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2013-09-12T12:49:00.591+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Sep 12 15:06:54 UTC 2013","customfield_12310420":"346076","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1213249043_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-09-12T15:05:18.965+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1747/watchers","watchCount":2,"isWatching":false},"created":"2013-08-29T14:04:29.941+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321883","id":"12321883","description":"Fix release against 3.4 branch","name":"3.4.5","archived":false,"released":true,"releaseDate":"2012-11-18"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-09-12T15:06:54.122+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"On multiple occasions when ZK was not able to write out a transaction log or a snapshot file, the consequent attempt to restart the server fails. Usually it happens when the underlying file system filled up; thus, preventing ZK server from writing out consistent data file.\n\nUpon start-up, the server reads in the snapshot and the transaction log. If the deserializer fails and throws an exception, server terminates. Please see the stack trace below.\n\nServer not coming up for whatever reason is often an undesirable condition. It would be nice to have an option to force-ignore parsing errors, especially, in the transaction log. A check sum on the data could be a possible solution to ensure the integrity and \"parsability\".\n\nAnother robustness enhancement could be via proper handling of the condition when snapshot or transaction log cannot be completely written to disk. Basically, better handling of write errors.\n\n\n{noformat}\n2013-08-28 12:05:30,732 ERROR [ZooKeeperServerMain] Unexpected exception, exiting abnormally\njava.io.EOFException\n        at java.io.DataInputStream.readInt(DataInputStream.java:375)\n        at org.apache.jute.BinaryInputArchive.readInt(BinaryInputArchive.java:63)\n        at org.apache.zookeeper.server.persistence.FileHeader.deserialize(FileHeader.java:64)\n        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.inStreamCreated(FileTxnLog.java:558)\n        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.createInputArchive(FileTxnLog.java:577)\n        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.goToNextLog(FileTxnLog.java:543)\n        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.next(FileTxnLog.java:625)\n        at org.apache.zookeeper.server.persistence.FileTxnSnapLog.restore(FileTxnSnapLog.java:160)\n        at org.apache.zookeeper.server.ZKDatabase.loadDataBase(ZKDatabase.java:223)\n        at org.apache.zookeeper.server.ZooKeeperServer.loadData(ZooKeeperServer.java:250)\n        at org.apache.zookeeper.server.ZooKeeperServer.startdata(ZooKeeperServer.java:383)\n        at org.apache.zookeeper.server.NIOServerCnxnFactory.startup(NIOServerCnxnFactory.java:122)\n        at org.apache.zookeeper.server.ZooKeeperServerMain.runFromConfig(ZooKeeperServerMain.java:112)\n        at org.apache.zookeeper.server.ZooKeeperServerMain.initializeAndRun(ZooKeeperServerMain.java:86)\n        at org.apache.zookeeper.server.ZooKeeperServerMain.main(ZooKeeperServerMain.java:52)\n        at org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:129)\n        at org.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:78)\n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"346377","customfield_12312823":null,"summary":"Zookeeper server fails to start if transaction log file is corrupted","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=evolvah","name":"evolvah","key":"evolvah","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=evolvah&avatarId=26976","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=evolvah&avatarId=26976","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=evolvah&avatarId=26976","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=evolvah&avatarId=26976"},"displayName":"Sergey Maslyakov","active":true,"timeZone":"America/Chicago"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=evolvah","name":"evolvah","key":"evolvah","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=evolvah&avatarId=26976","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=evolvah&avatarId=26976","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=evolvah&avatarId=26976","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=evolvah&avatarId=26976"},"displayName":"Sergey Maslyakov","active":true,"timeZone":"America/Chicago"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Solaris10/x86, Java 1.6","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666137/comment/13765392","id":"13765392","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abranzyck","name":"abranzyck","key":"abranzyck","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=abranzyck&avatarId=16792","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=abranzyck&avatarId=16792","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=abranzyck&avatarId=16792","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=abranzyck&avatarId=16792"},"displayName":"Germ치n Blanco","active":true,"timeZone":"Europe/Berlin"},"body":"We have seen this issue also with inconsistent state between acceptedEpoch, currentEpoch and the transaction log. In that case the error is:\n{noformat}\n2013-09-12 12:30:51,586 [myid:10] - ERROR [main:QuorumPeer@453] - Unable to load database on disk\njava.io.IOException: The current epoch, 6, is older than the last zxid, 34359738487\n        at org.apache.zookeeper.server.quorum.QuorumPeer.loadDataBase(QuorumPeer.java:435)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.start(QuorumPeer.java:409)\n        at org.apache.zookeeper.server.quorum.QuorumPeerMain.runFromConfig(QuorumPeerMain.java:151)\n        at org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:111)\n        at org.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:78)\n2013-09-12 12:30:51,587 [myid:10] - ERROR [main:QuorumPeerMain@89] - Unexpected exception, exiting abnormally\njava.lang.RuntimeException: Unable to run quorum server\n        at org.apache.zookeeper.server.quorum.QuorumPeer.loadDataBase(QuorumPeer.java:454)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.start(QuorumPeer.java:409)\n        at org.apache.zookeeper.server.quorum.QuorumPeerMain.runFromConfig(QuorumPeerMain.java:151)\n        at org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:111)\n        at org.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:78)\nCaused by: java.io.IOException: The current epoch, 6, is older than the last zxid, 34359738487\n        at org.apache.zookeeper.server.quorum.QuorumPeer.loadDataBase(QuorumPeer.java:435)\n        ... 4 more\n{noformat}\nI guess \"force-ignore\" means that the server just ignores whatever is in the disk and starts with zxid=0, or?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abranzyck","name":"abranzyck","key":"abranzyck","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=abranzyck&avatarId=16792","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=abranzyck&avatarId=16792","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=abranzyck&avatarId=16792","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=abranzyck&avatarId=16792"},"displayName":"Germ치n Blanco","active":true,"timeZone":"Europe/Berlin"},"created":"2013-09-12T12:49:00.591+0000","updated":"2013-09-12T12:49:00.591+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666137/comment/13765472","id":"13765472","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=evolvah","name":"evolvah","key":"evolvah","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=evolvah&avatarId=26976","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=evolvah&avatarId=26976","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=evolvah&avatarId=26976","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=evolvah&avatarId=26976"},"displayName":"Sergey Maslyakov","active":true,"timeZone":"America/Chicago"},"body":"Let me take my original statement about \"force-ignoring\" errors back. I think Zookeeper server should handle data consistency issues gracefully. This means, it needs to handle this type of errors as opposed to terminating. The reaction to an error can be controlled by the user.\n\n# For fatal errors, such as missing {{myid}} file, ZK server server shall exit.\n# For non-fatal data consistency errors (empty log, missing epoch files, etc), ZK can be instructed to:\n## Come up empty\n## Make \"best effort\" in restoring DataTree. If no data can be restored consistently, ZK can be instructed to:\n### Come up empty\n### Exit\n\nThis way, a system operator, who is not a ZK expert, can be given a set of work instruction on how to recover a failing ZK service.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=evolvah","name":"evolvah","key":"evolvah","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=evolvah&avatarId=26976","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=evolvah&avatarId=26976","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=evolvah&avatarId=26976","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=evolvah&avatarId=26976"},"displayName":"Sergey Maslyakov","active":true,"timeZone":"America/Chicago"},"created":"2013-09-12T14:31:37.094+0000","updated":"2013-09-12T14:31:37.094+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666137/comment/13765496","id":"13765496","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abranzyck","name":"abranzyck","key":"abranzyck","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=abranzyck&avatarId=16792","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=abranzyck&avatarId=16792","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=abranzyck&avatarId=16792","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=abranzyck&avatarId=16792"},"displayName":"Germ치n Blanco","active":true,"timeZone":"Europe/Berlin"},"body":"Could this be a duplicate of ZOOKEEPER-1621?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=abranzyck","name":"abranzyck","key":"abranzyck","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=abranzyck&avatarId=16792","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=abranzyck&avatarId=16792","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=abranzyck&avatarId=16792","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=abranzyck&avatarId=16792"},"displayName":"Germ치n Blanco","active":true,"timeZone":"Europe/Berlin"},"created":"2013-09-12T14:53:34.077+0000","updated":"2013-09-12T14:53:34.077+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666137/comment/13765509","id":"13765509","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=evolvah","name":"evolvah","key":"evolvah","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=evolvah&avatarId=26976","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=evolvah&avatarId=26976","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=evolvah&avatarId=26976","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=evolvah&avatarId=26976"},"displayName":"Sergey Maslyakov","active":true,"timeZone":"America/Chicago"},"body":"Yes, it is. Thank you for pointing this out. I marked this entry as a duplicate of 1621.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=evolvah","name":"evolvah","key":"evolvah","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=evolvah&avatarId=26976","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=evolvah&avatarId=26976","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=evolvah&avatarId=26976","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=evolvah&avatarId=26976"},"displayName":"Sergey Maslyakov","active":true,"timeZone":"America/Chicago"},"created":"2013-09-12T15:06:54.122+0000","updated":"2013-09-12T15:06:54.122+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1747/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1nofr:"}}