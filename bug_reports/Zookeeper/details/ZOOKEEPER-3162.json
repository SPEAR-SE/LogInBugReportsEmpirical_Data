{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13190396","self":"https://issues.apache.org/jira/rest/api/2/issue/13190396","key":"ZOOKEEPER-3162","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":10200,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326518","id":"12326518","name":"3.6.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12343268","id":"12343268","description":"Beta release against 3.5 branch","name":"3.5.5","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12343587","id":"12343587","name":"3.4.14","archived":false,"released":false}],"aggregatetimespent":10200,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2018-11-08T02:22:22.915+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Nov 12 22:21:18 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2962997740_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-11-12T22:21:18.404+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-3162/watchers","watchCount":2,"isWatching":false},"created":"2018-10-09T15:18:00.711+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["pull-request-available"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313216","id":"12313216","description":"","name":"3.0.0","archived":false,"released":true,"releaseDate":"2008-10-27"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12342973","id":"12342973","description":"Fix release against 3.4 branch","name":"3.4.13","archived":false,"released":true,"releaseDate":"2018-07-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrea.reale","name":"andrea.reale","key":"andrea.reale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrea.reale&avatarId=37003","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrea.reale&avatarId=37003","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrea.reale&avatarId=37003","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrea.reale&avatarId=37003"},"displayName":"Andrea Reale","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-11-24T19:52:39.867+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312380","id":"12312380","name":"c client","description":"The c client interface to ZooKeeper"}],"timeoriginalestimate":null,"description":"As reported (but never fixed) in the past by ZOOKEEPER-2409, ZOOKEEPER-2038 and (partly) ZOOKEEPER-2878, the C client lock-recipe implementation is broken.\r\n\r\nI identified three issues.\r\n\r\nThe main one (as also reported in the aforementioned reports) is that the logic that goes through the lock waiting list is broken. child_floor uses strcmp and compares the full node name (i.e., sessionID-sequence) rather than only comparing the sequence number. This makes it possible for two different clients to hold the lock at the same time: assume two clients, one associated with session A, the other with session B, with A < B lexicographically. Now assume that at some point a thread in B holds a lock and a thread in A tries to acquire the same lock. A will manage to get the lock because of the wrong comparison function, so now two guys hold the lock.\r\n\r\nThe second issue is a possible deadlock inside zkr_lock_operation. zkr_lock_operation is always called by holding the mutex associated to the client lock. In some cases, zkr_lock_operaton may decide to give-up locking and call zkr_lock_unlock to release the lock. When this happens, it will try to acquire again the same phtread mutex, which will lead to a deadlock.\r\n\r\nThe third issue relates to the return value of zkr_lock_lock. According to the API docs, the functions returns 0 when no errors. Then it is up to the invoker to check when the lock is held by calling zkr_lock_isowner. However, the implementation, in case of no error, returns zkr_lock_isowner. This is wrong because it becomes impossible to distinguish an error condition from a success (but not ownerhsip). Instead the API (as described in the docs, btw) should return always 0 when no errors occur.\r\n\r\nShortly I will add the link to a PR fixing the issues.\r\n\r\nÂ ","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"2h 50m","remainingEstimateSeconds":0,"timeSpentSeconds":10200},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Broken lock semantics in C client lock-recipe","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrea.reale","name":"andrea.reale","key":"andrea.reale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrea.reale&avatarId=37003","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrea.reale&avatarId=37003","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrea.reale&avatarId=37003","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrea.reale&avatarId=37003"},"displayName":"Andrea Reale","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrea.reale","name":"andrea.reale","key":"andrea.reale","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrea.reale&avatarId=37003","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrea.reale&avatarId=37003","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrea.reale&avatarId=37003","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrea.reale&avatarId=37003"},"displayName":"Andrea Reale","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":10200,"total":10200,"percent":100},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10430","value":"Patch","id":"10430"}],"progress":{"progress":10200,"total":10200,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/comment/16679192","id":"16679192","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Jenkins build Zookeeper-trunk-single-thread #99 (See [https://builds.apache.org/job/Zookeeper-trunk-single-thread/99/])\nZOOKEEPER-3162: Broken lock semantics in C client lock-recipe. (andor: rev 477fa0724fa66cc41d14e8a974ab4ac2a1b68433)\n* (edit) zookeeper-recipes/zookeeper-recipes-lock/src/main/c/tests/TestClient.cc\n* (edit) zookeeper-recipes/zookeeper-recipes-lock/src/main/c/src/zoo_lock.c\n* (edit) zookeeper-recipes/zookeeper-recipes-queue/build.xml\n* (edit) zookeeper-recipes/zookeeper-recipes-lock/build.xml\n* (edit) zookeeper-recipes/zookeeper-recipes-lock/src/main/c/configure.ac\n* (edit) zookeeper-recipes/zookeeper-recipes-queue/src/main/c/configure.ac\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-08T02:22:22.915+0000","updated":"2018-11-08T02:22:22.915+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/comment/16679247","id":"16679247","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Jenkins build ZooKeeper-trunk #261 (See [https://builds.apache.org/job/ZooKeeper-trunk/261/])\nZOOKEEPER-3162: Broken lock semantics in C client lock-recipe. (andor: rev 477fa0724fa66cc41d14e8a974ab4ac2a1b68433)\n* (edit) zookeeper-recipes/zookeeper-recipes-queue/src/main/c/configure.ac\n* (edit) zookeeper-recipes/zookeeper-recipes-lock/src/main/c/src/zoo_lock.c\n* (edit) zookeeper-recipes/zookeeper-recipes-lock/build.xml\n* (edit) zookeeper-recipes/zookeeper-recipes-lock/src/main/c/configure.ac\n* (edit) zookeeper-recipes/zookeeper-recipes-lock/src/main/c/tests/TestClient.cc\n* (edit) zookeeper-recipes/zookeeper-recipes-queue/build.xml\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-08T03:18:12.901+0000","updated":"2018-11-08T03:18:12.901+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/comment/16684435","id":"16684435","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"Issue resolved by pull request 699\n[https://github.com/apache/zookeeper/pull/699]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-11-12T22:21:18.428+0000","updated":"2018-11-12T22:21:18.428+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-3162/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":17,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/152729","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user andreareale opened a pull request:\n\n    https://github.com/apache/zookeeper/pull/662\n\n    ZOOKEEPER-3162\n\n    This PR fixes a few issues with the C client lock-recipe, as documented in more detailed in [ZOOKEEPER-3162](https://issues.apache.org/jira/browse/ZOOKEEPER-3162) on JIRA.\r\n    \r\n    Details are also provided in the individual commits, but in short:\r\n    - Fix a bug in the choice of the predecessor node while trying to acquire the lock\r\n    - Fix a possible deadlock in zkr_lock_operation\r\n    - Fix the return value of zkr_lock_lock to abide to the prescribed semantics.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/ibm-research-ireland/zookeeper ZOOKEEPER-3162\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/662.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #662\n    \n----\ncommit f5b0e09820fa0713d64119e4ba70fe0d07533a96\nAuthor: Andrea Reale <realean2@...>\nDate:   2018-10-09T09:23:50Z\n\n    Fix wrong include path for C recipes\n    \n    Signed-off-by: Andrea Reale <realean2@ie.ibm.com>\n\ncommit d6e1953840f56c2c42948ff1958be779465e2bb9\nAuthor: Andrea Reale <realean2@...>\nDate:   2018-08-03T16:35:56Z\n\n    Bugfix on zookeeper-recipes-lock C implementation\n    \n    - Fixes ZOOKEEPER-2408,ZOOKEEPER-2038, and (partly) ZOOKEEPER-2878\n    - Fixes child_floor by using strcmp_suffix instead of strcmp. This will\n      do the correct lookups within the sorted waiters list. Without this\n      the lock semantics are broken: e.g., assuming that session A < session\n      B (alfanumerically), if a thread from session B holds the lock, and a\n      thread from session A tries to acquire it it will find no predecessor\n      in child_floor and get the lock as well.\n    - Uses binary search to find child_floor (optimization)\n    \n    Signed-off-by: Andrea Reale <realean2@ie.ibm.com>\n\ncommit e95da861ba0340949baa65b6f143d8a4e67aee6c\nAuthor: Andrea Reale <realean2@...>\nDate:   2018-08-15T16:35:07Z\n\n    Fixes deadlock in zoo_lock_operation\n    \n    zkr_lock_operation is always called by holding the mutex associated to\n    the client lock. In some cases, zkr_lock_operaton may decide to give-up\n    locking and call zkr_lock_unlock to release the lock. When this happens,\n    it will try to acquire again the same phtread mutex, which will lead to\n    a deadlock.\n    \n    This commit fixes the issue by calling a non-protected version of\n    zkr_lock_unlock from within zkr_lock_operatino.\n    \n    Signed-off-by: Andrea Reale <realean2@ie.ibm.com>\n\ncommit 51ac01ecd06aca9d368519ff925a3539ddef35b4\nAuthor: Andrea Reale <realean2@...>\nDate:   2018-10-09T14:52:11Z\n\n    Fix return semantics of zkr_lock_lock\n    \n    Returns 0 (on no-errors) from zkr_lock_lock. This matches the\n    API documentation. Additionall, returning zkr_lock_isowner is also\n    semantically wrong: a caller might be enqueued for lock acquision and\n    still not the owner; in such a case the function should still return 0\n    because that is the expected behavior.\n    \n    Signed-off-by: Andrea Reale <realean2@ie.ibm.com>\n\n----\n","created":"2018-10-09T15:42:22.338+0000","updated":"2018-10-09T15:42:22.338+0000","started":"2018-10-09T15:42:22.338+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"152729","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/152735","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/662\n  \n    \n    Refer to this link for build results (access rights to CI server needed): \n    https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2394/\n\n","created":"2018-10-09T15:57:09.094+0000","updated":"2018-10-09T15:57:09.094+0000","started":"2018-10-09T15:57:09.093+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"152735","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/152744","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user andreareale commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/662\n  \n    retest this please\n","created":"2018-10-09T16:12:21.630+0000","updated":"2018-10-09T16:12:21.630+0000","started":"2018-10-09T16:12:21.630+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"152744","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/152773","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/662\n  \n    \n    Refer to this link for build results (access rights to CI server needed): \n    https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2397/\n\n","created":"2018-10-09T16:37:54.110+0000","updated":"2018-10-09T16:37:54.110+0000","started":"2018-10-09T16:37:54.109+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"152773","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/153083","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user nkalmar commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/662\n  \n    Looks good, thanks @andreareale \r\n    The C test fail looks like it's the flaky one:\r\n    *** Error in `./zktest-mt': free(): invalid pointer: 0x00002b913dcd5000 ***\r\n    I think there's already a fix underway.\r\n    \r\n    This should also go into 3.5 as well (possibly to 3.4 especially the include path fix).\n","created":"2018-10-10T09:17:12.100+0000","updated":"2018-10-10T09:17:12.100+0000","started":"2018-10-10T09:17:12.099+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"153083","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/153143","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user nkalmar commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/662\n  \n    retest this please\n","created":"2018-10-10T14:05:31.938+0000","updated":"2018-10-10T14:05:31.938+0000","started":"2018-10-10T14:05:31.937+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"153143","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/153150","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/662\n  \n    \n    Refer to this link for build results (access rights to CI server needed): \n    https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2417/\n\n","created":"2018-10-10T14:21:19.259+0000","updated":"2018-10-10T14:21:19.259+0000","started":"2018-10-10T14:21:19.258+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"153150","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/154375","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/662\n  \n    \n    Refer to this link for build results (access rights to CI server needed): \n    https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2437/\n\n","created":"2018-10-15T17:02:49.878+0000","updated":"2018-10-15T17:02:49.878+0000","started":"2018-10-15T17:02:49.877+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"154375","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/154668","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user andreareale commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/662\n  \n    Thanks @nkalmar. There were some additional path issues in the recipes ant test targets. Updated the PR to fix them as well. Please, let me know if there is anything I can do to help with merging.\n","created":"2018-10-16T09:03:37.143+0000","updated":"2018-10-16T09:03:37.143+0000","started":"2018-10-16T09:03:37.143+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"154668","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/155894","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user tamaashu commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/662\n  \n    looks okay, thanks for fixing build issues too\n","created":"2018-10-18T13:59:51.918+0000","updated":"2018-10-18T13:59:51.918+0000","started":"2018-10-18T13:59:51.917+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"155894","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/163399","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user andreareale commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/662\n  \n    Hi @nkalmar, @tamaashu and thanks for the reviews. Any chance to see this merged any time soon?\n","created":"2018-11-07T10:10:22.896+0000","updated":"2018-11-07T10:10:22.896+0000","started":"2018-11-07T10:10:22.895+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"163399","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/163412","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user tamaashu commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/662\n  \n    Since I'm not a committer I cannot do so. @anmolnar @hanm could you please review this PR? Thanks.\n","created":"2018-11-07T10:35:02.707+0000","updated":"2018-11-07T10:35:02.707+0000","started":"2018-11-07T10:35:02.706+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"163412","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/163742","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/zookeeper/pull/662\n","created":"2018-11-07T23:55:21.647+0000","updated":"2018-11-07T23:55:21.647+0000","started":"2018-11-07T23:55:21.646+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"163742","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/163743","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user anmolnar commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/662\n  \n    Committed to 3.5 and master branches. Thanks @andreareale !\r\n    Please create separate pull request for branch-3.4\n","created":"2018-11-07T23:55:42.012+0000","updated":"2018-11-07T23:55:42.012+0000","started":"2018-11-07T23:55:42.012+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"163743","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/165059","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user andreareale opened a pull request:\n\n    https://github.com/apache/zookeeper/pull/699\n\n    ZOOKEEPER-3162 (branch3.4). Broken lock semantics in C client lock-recipe.\n\n    This is a new pull request that, as requested, ports PR #662 to branch-3.4\r\n    \r\n    This PR fixes a few issues with the C client lock-recipe, as documented in more detailed in ZOOKEEPER-3162 on JIRA.\r\n    \r\n    Details are also provided in the individual commits, but in short:\r\n    - Fix a bug in the choice of the predecessor node while trying to acquire the lock\r\n    - Fix a possible deadlock in zkr_lock_operation\r\n    - Fix the return value of zkr_lock_lock to abide to the prescribed semantics.\r\n\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/ibm-research-ireland/zookeeper ZOOKEEPER-3162_branch3.4\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/699.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #699\n    \n----\ncommit 07d5b8e3fb2b3ea5df9df9ea22fd9706da15e1d9\nAuthor: Andrea Reale <realean2@...>\nDate:   2018-10-09T09:23:50Z\n\n    Fix wrong include path for C recipes\n    \n    Signed-off-by: Andrea Reale <realean2@ie.ibm.com>\n\ncommit 38e7266089d62ffe4ddc0dd1b0cd7632a58641fa\nAuthor: Andrea Reale <realean2@...>\nDate:   2018-08-03T16:35:56Z\n\n    Bugfix on zookeeper-recipes-lock C implementation\n    \n    - Fixes ZOOKEEPER-2408,ZOOKEEPER-2038, and (partly) ZOOKEEPER-2878\n    - Fixes child_floor by using strcmp_suffix instead of strcmp. This will\n      do the correct lookups within the sorted waiters list. Without this\n      the lock semantics are broken: e.g., assuming that session A < session\n      B (alfanumerically), if a thread from session B holds the lock, and a\n      thread from session A tries to acquire it it will find no predecessor\n      in child_floor and get the lock as well.\n    - Uses binary search to find child_floor (optimization)\n    \n    Signed-off-by: Andrea Reale <realean2@ie.ibm.com>\n\ncommit 99f5959efeb8049c5318515b5d87b6e80add35c0\nAuthor: Andrea Reale <realean2@...>\nDate:   2018-10-09T14:52:11Z\n\n    Fix return semantics of zkr_lock_lock\n    \n    Returns 0 (on no-errors) from zkr_lock_lock. This matches the\n    API documentation. Additionall, returning zkr_lock_isowner is also\n    semantically wrong: a caller might be enqueued for lock acquision and\n    still not the owner; in such a case the function should still return 0\n    because that is the expected behavior.\n    \n    Signed-off-by: Andrea Reale <realean2@ie.ibm.com>\n\ncommit b33a0bf8545f089a9f29c43414125032a2b5c1d3\nAuthor: Andrea Reale <realean2@...>\nDate:   2018-08-15T16:35:07Z\n\n    Fixes deadlock in zoo_lock_operation\n    \n    zkr_lock_operation is always called by holding the mutex associated to\n    the client lock. In some cases, zkr_lock_operaton may decide to give-up\n    locking and call zkr_lock_unlock to release the lock. When this happens,\n    it will try to acquire again the same phtread mutex, which will lead to\n    a deadlock.\n    \n    This commit fixes the issue by calling a non-protected version of\n    zkr_lock_unlock from within zkr_lock_operatino.\n    \n    Signed-off-by: Andrea Reale <realean2@ie.ibm.com>\n\n----\n","created":"2018-11-12T19:00:11.910+0000","updated":"2018-11-12T19:00:11.910+0000","started":"2018-11-12T19:00:11.909+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"165059","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/165083","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user andreareale commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/699\n  \n    @anmolnar , as requested this is a duplicate of PR #662 ported onto branch-3.4.\r\n    It applied cleanly except for the calls to the logging macros, which in 3.5 support logging by callback as far as I understood.\r\n    Thanks!\n","created":"2018-11-12T19:53:12.650+0000","updated":"2018-11-12T19:53:12.650+0000","started":"2018-11-12T19:53:12.648+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"165083","issueId":"13190396"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13190396/worklog/165177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user anmolnar commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/699\n  \n    Committed. Thanks @andreareale !\r\n    Please assign the jira to yourself and close this PR.\n","created":"2018-11-12T22:22:43.297+0000","updated":"2018-11-12T22:22:43.297+0000","started":"2018-11-12T22:22:43.297+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"165177","issueId":"13190396"}]},"customfield_12311820":"0|i3yztr:"}}