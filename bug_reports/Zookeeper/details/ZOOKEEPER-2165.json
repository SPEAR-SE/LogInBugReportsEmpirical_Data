{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12820792","self":"https://issues.apache.org/jira/rest/api/2/issue/12820792","key":"ZOOKEEPER-2165","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-04-15T06:11:48.592+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Apr 23 08:42:10 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2165/watchers","watchCount":3,"isWatching":false},"created":"2015-04-14T11:42:28.067+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-04-23T08:42:10.700+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312379","id":"12312379","name":"quorum","description":"Quorum determination for ZooKeeper"}],"timeoriginalestimate":null,"description":"Class QuoromPeer has a constructor which takes a QuorumVerifier value as a parameter. This class is defined in package \"org.apache.zookeeper.server.quorum.flexible\" but that package is not exported.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"OSGi requires package \"server.quorom.flexible\" be exported","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skitching","name":"skitching","key":"skitching","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Simon Kitching","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skitching","name":"skitching","key":"skitching","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Simon Kitching","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820792/comment/14494001","id":"14494001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skitching","name":"skitching","key":"skitching","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Simon Kitching","active":true,"timeZone":"Europe/Berlin"},"body":"The fix is trivial, and affects only top-level file \"build.xml\". The MANIFEST.MF is specified in build.xml via a hand-written <manifest> tag with nested <attribute> entries. The one for ExportPackage needs to be extended to include \"org.apache.zookeeper.server.quorum.flexible\".\n\nWith the current manifest, an OSGi bundle that tries to use class QuorumPeer will automatically try to import package quorum.flexible and fail to resolve. This can be worked around by forcing the quorom.flexible to not be imported, but that is not very elegant.\n\nWorkaround for apps using zookeeper and maven-bundle-plugin:\n  <Import-Package>!org.apache.zookeeper.quorum.flexible, *</Import-Package>","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skitching","name":"skitching","key":"skitching","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Simon Kitching","active":true,"timeZone":"Europe/Berlin"},"created":"2015-04-14T11:44:41.052+0000","updated":"2015-04-14T11:44:41.052+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820792/comment/14495717","id":"14495717","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michim","name":"michim","key":"michim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michi Mutsuzaki","active":true,"timeZone":"America/Los_Angeles"},"body":"Thank you for the report [~skitching]. Would you like to submit a patch? Also, is there a way to verify that we are OSGi compliant as a part of the build? I remember having similar issues before.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michim","name":"michim","key":"michim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michi Mutsuzaki","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-15T06:11:48.592+0000","updated":"2015-04-15T06:11:48.592+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12820792/comment/14508678","id":"14508678","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hendrik-sst","name":"hendrik-sst","key":"hendrik-sst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hendrik Spohr","active":true,"timeZone":"Etc/UTC"},"body":"Hi [~michim],\n\nHere is a patch (You need to apply the one I have posted for ZOOKEEPER-1942 before):\n{code}\ndiff --git a/build.xml b/build.xml\nindex 559e115..d819eed 100644\n--- a/build.xml\n+++ b/build.xml\n@@ -564,7 +564,7 @@ xmlns:maven=\"antlib:org.apache.maven.artifact.ant\">\n                 <attribute name=\"Bundle-License\" value=\"http://www.apache.org/licenses/LICENSE-2.0.txt\"/>\n                 <attribute name=\"Bundle-DocURL\" value=\"http://hadoop.apache.org/zookeeper\"/>\n                 <attribute name=\"Import-Package\" value='javax.management;resolution:=optional,javax.security.auth.callback,javax.security.auth.login,javax.security.sasl,org.slf4j;version=\"[1.6,2)\",org.jboss.netty.buffer;resolution:=optional;version=\"[3.2,4)\",org.jboss.netty.c\n-                <attribute name=\"Export-Package\" value='org.apache.zookeeper;version=\"${version}\",org.apache.zookeeper.client;version=\"${version}\",org.apache.zookeeper.data;version=\"${version}\",org.apache.zookeeper.version;version=\"${version}\",org.apache.zookeeper.server;vers\n+                <attribute name=\"Export-Package\" value='org.apache.zookeeper;version=\"${version}\",org.apache.zookeeper.client;version=\"${version}\",org.apache.zookeeper.data;version=\"${version}\",org.apache.zookeeper.version;version=\"${version}\",org.apache.zookeeper.server;vers\n             </manifest>\n         </jar>\n     </target>\n{code}\n\nTo test for a OSGi correct MANIFEST: That is not easy IMHO. You could create a test with pax-exam or similar an check the the bundles starts up at all (which would be not the case for ZOOKEEPER-1942). However a defect as this would not be detected. You would ne to write test code that uses the API classes in order to verify that client bundles can load them.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hendrik-sst","name":"hendrik-sst","key":"hendrik-sst","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hendrik Spohr","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-23T08:42:10.700+0000","updated":"2015-04-23T08:42:10.700+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2165/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2d82f:"}}