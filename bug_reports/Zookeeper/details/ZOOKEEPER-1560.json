{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12611273","self":"https://issues.apache.org/jira/rest/api/2/issue/12611273","key":"ZOOKEEPER-1560","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321883","id":"12321883","description":"Fix release against 3.4 branch","name":"3.4.5","archived":false,"released":true,"releaseDate":"2012-11-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316644","id":"12316644","description":"Dynamic Reconfig, Remove Watches, Local Session","name":"3.5.0","archived":false,"released":true,"releaseDate":"2014-08-04"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-10-11T21:10:19.423+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Oct 31 23:00:47 UTC 2012","customfield_12310420":"247171","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_1709690394_*|*_1_*:*_1_*:*_86655775_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-10-31T18:44:12.017+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1560/watchers","watchCount":11,"isWatching":false},"created":"2012-10-10T23:45:05.870+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"11.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319841","id":"12319841","description":"Fix release against 3.4 branch.","name":"3.4.4","archived":false,"released":true,"releaseDate":"2012-09-23"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316644","id":"12316644","description":"Dynamic Reconfig, Remove Watches, Local Session","name":"3.5.0","archived":false,"released":true,"releaseDate":"2014-08-04"}],"issuelinks":[{"id":"12358821","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12358821","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12611304","key":"ZOOKEEPER-1561","self":"https://issues.apache.org/jira/rest/api/2/issue/12611304","fields":{"summary":"Zookeeper client may hang on a server restart","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-10-31T23:00:47.081+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312381","id":"12312381","name":"java client","description":"The java client interface for ZooKeeper"}],"timeoriginalestimate":null,"description":"To reproduce, try creating a node with 0.5M of data using java client. The test will hang waiting for a response from the server. See the attached patch for the test that reproduces the issue.\n\nIt seems that ZOOKEEPER-1437 introduced a few issues to {{ClientCnxnSocketNIO.doIO}} that prevent {{ClientCnxnSocketNIO}} from sending large packets that require several invocations of {{SocketChannel.write}} to complete. The first issue is that the call to {{outgoingQueue.removeFirstOccurrence(p);}} removes the packet from the queue even if the packet wasn't completely sent yet.  It looks to me that this call should be moved under {{if (!pbb.hasRemaining())}} The second issue is that {{p.createBB()}} is reinitializing {{ByteBuffer}} on every iteration, which confuses {{SocketChannel.write}}. And the third issue is caused by extra calls to {{cnxn.getXid()}} that increment xid on every iteration and confuse the server.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12548669","id":"12548669","filename":"ZOOKEEPER-1560.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imotov","name":"imotov","key":"imotov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Motov","active":true,"timeZone":"America/New_York"},"created":"2012-10-10T23:47:04.885+0000","size":921,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12548669/ZOOKEEPER-1560.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12548823","id":"12548823","filename":"zookeeper-1560-v1.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-11T23:25:29.092+0000","size":2370,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12548823/zookeeper-1560-v1.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12548828","id":"12548828","filename":"zookeeper-1560-v2.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T00:08:24.445+0000","size":2986,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12548828/zookeeper-1560-v2.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12548839","id":"12548839","filename":"zookeeper-1560-v3.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T01:21:30.059+0000","size":3285,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12548839/zookeeper-1560-v3.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12548889","id":"12548889","filename":"zookeeper-1560-v4.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T13:53:12.973+0000","size":4326,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12548889/zookeeper-1560-v4.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12548893","id":"12548893","filename":"zookeeper-1560-v5.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T14:46:33.328+0000","size":4548,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12548893/zookeeper-1560-v5.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12548898","id":"12548898","filename":"zookeeper-1560-v6.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T15:02:56.255+0000","size":4649,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12548898/zookeeper-1560-v6.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12548908","id":"12548908","filename":"zookeeper-1560-v7.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T15:55:22.975+0000","size":4636,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12548908/zookeeper-1560-v7.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12551039","id":"12551039","filename":"ZOOKEEPER-1560-v8_r3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-26T23:20:46.682+0000","size":7493,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12551039/ZOOKEEPER-1560-v8_r3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12551585","id":"12551585","filename":"ZOOKEEPER-1560-v8_r4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-31T17:43:19.519+0000","size":8367,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12551585/ZOOKEEPER-1560-v8_r4.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12550725","id":"12550725","filename":"ZOOKEEPER-1560-v8.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-25T00:57:54.812+0000","size":5934,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12550725/ZOOKEEPER-1560-v8.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"45345","customfield_12312823":null,"summary":"Zookeeper client hangs on creation of large nodes","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imotov","name":"imotov","key":"imotov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Motov","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imotov","name":"imotov","key":"imotov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Motov","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13473700","id":"13473700","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imotov","name":"imotov","key":"imotov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Motov","active":true,"timeZone":"America/New_York"},"body":"Test that reproduces that issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imotov","name":"imotov","key":"imotov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Motov","active":true,"timeZone":"America/New_York"},"created":"2012-10-10T23:47:04.887+0000","updated":"2012-10-10T23:47:04.887+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474514","id":"13474514","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shralex","name":"shralex","key":"shralex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Shraer","active":true,"timeZone":"America/Los_Angeles"},"body":"Please also see ZOOKEEPER-1561","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shralex","name":"shralex","key":"shralex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Shraer","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-11T21:10:19.423+0000","updated":"2012-10-11T21:10:19.423+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474571","id":"13474571","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"In doIO(), should we check the return value from:\n{code}\n                    sock.write(pbb);\n{code}\nHere is jstack where testLargeNodeData hung:\n{code}\n\"main\" prio=5 tid=7f9bed000800 nid=0x10c382000 in Object.wait() [10c380000]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\t- waiting on <7dc1a15c0> (a org.apache.zookeeper.ClientCnxn$Packet)\n\tat java.lang.Object.wait(Object.java:485)\n\tat org.apache.zookeeper.ClientCnxn.submitRequest(ClientCnxn.java:1309)\n\t- locked <7dc1a15c0> (a org.apache.zookeeper.ClientCnxn$Packet)\n\tat org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:781)\n\tat org.apache.zookeeper.test.ClientTest.testLargeNodeData(ClientTest.java:531)\n{code}\nI think we can send data in chunks if pbb.remaining() is beyond certain threshold.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-11T22:37:08.007+0000","updated":"2012-10-11T22:37:08.007+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474616","id":"13474616","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"Patch v1 implements the chunk'ed write.\n\nClientTest passes.\n\nPlease provide your comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-11T23:25:29.094+0000","updated":"2012-10-11T23:25:29.094+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474617","id":"13474617","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"junit.run:\n    [junit] Running org.apache.zookeeper.test.ClientTest\n    [junit] Tests run: 12, Failures: 0, Errors: 0, Time elapsed: 17.694 sec","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-11T23:28:06.074+0000","updated":"2012-10-11T23:28:06.074+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474624","id":"13474624","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ekoontz","name":"ekoontz","key":"ekoontz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ekoontz&avatarId=11640","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ekoontz&avatarId=11640","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ekoontz&avatarId=11640","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ekoontz&avatarId=11640"},"displayName":"Eugene Koontz","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Ted, I think originalLimit can be final, just as CHUNK_SIZE is. Also should CHUNK_SIZE be a configurable setting, defaulting to 2000?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ekoontz","name":"ekoontz","key":"ekoontz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ekoontz&avatarId=11640","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ekoontz&avatarId=11640","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ekoontz&avatarId=11640","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ekoontz&avatarId=11640"},"displayName":"Eugene Koontz","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-11T23:34:05.041+0000","updated":"2012-10-11T23:34:05.041+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474631","id":"13474631","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"bq. should CHUNK_SIZE be a configurable setting\nIf I knew how to access Configuration instance from within ClientCnxnSocketNIO :-)\n\nbq. originalLimit can be final\nSure. Will incorporate into next patch after I get more review comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-11T23:42:23.651+0000","updated":"2012-10-11T23:42:23.651+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474641","id":"13474641","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"Let QA run the tests","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-11T23:49:21.641+0000","updated":"2012-10-11T23:49:21.641+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474645","id":"13474645","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ekoontz","name":"ekoontz","key":"ekoontz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ekoontz&avatarId=11640","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ekoontz&avatarId=11640","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ekoontz&avatarId=11640","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ekoontz&avatarId=11640"},"displayName":"Eugene Koontz","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Ted,\nFor making the chunk size configurable, I think something like this would work: (add to same file as you are patching (ClientCnxnSocketNIO.java))\n\n{code}\npublic static final String CLIENT_WRITE_CHUNK_SIZE = \"zookeeper.client.nio.writechunk\";\n\n...\n\nfinal int CHUNK_SIZE = getProperty(CLIENT_WRITE_CHUNK_SIZE,2000);\n\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ekoontz","name":"ekoontz","key":"ekoontz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ekoontz&avatarId=11640","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ekoontz&avatarId=11640","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ekoontz&avatarId=11640","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ekoontz&avatarId=11640"},"displayName":"Eugene Koontz","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-11T23:55:36.171+0000","updated":"2012-10-11T23:55:36.171+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474656","id":"13474656","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"Thanks Eugene for the hint.\n\nHere is patch v2 which passed ClientTest as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T00:08:24.447+0000","updated":"2012-10-12T00:08:24.447+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474668","id":"13474668","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shralex","name":"shralex","key":"shralex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Shraer","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Ted,\n\nwhy not test for the return value of sock.write ? \n\nperhaps if it couldn't write the entire chunk size we can raise an exception.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shralex","name":"shralex","key":"shralex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Shraer","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-12T00:30:29.743+0000","updated":"2012-10-12T00:30:29.743+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474669","id":"13474669","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12548823/zookeeper-1560-v1.txt\n  against trunk revision 1391526.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1212//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1212//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1212//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T00:32:43.738+0000","updated":"2012-10-12T00:32:43.738+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474670","id":"13474670","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ekoontz","name":"ekoontz","key":"ekoontz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ekoontz&avatarId=11640","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ekoontz&avatarId=11640","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ekoontz&avatarId=11640","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ekoontz&avatarId=11640"},"displayName":"Eugene Koontz","active":true,"timeZone":"America/Los_Angeles"},"body":"@Ted, your patch looks good as far as configurability/final-ness.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ekoontz","name":"ekoontz","key":"ekoontz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ekoontz&avatarId=11640","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ekoontz&avatarId=11640","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ekoontz&avatarId=11640","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ekoontz&avatarId=11640"},"displayName":"Eugene Koontz","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-12T00:33:01.964+0000","updated":"2012-10-12T00:33:01.964+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474679","id":"13474679","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"What exception should be raised if not all data is written ?\nThanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-12T00:42:44.032+0000","updated":"2012-10-12T00:42:44.032+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474683","id":"13474683","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shralex","name":"shralex","key":"shralex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Shraer","active":true,"timeZone":"America/Los_Angeles"},"body":"maybe IOException since this is what sock.write may throw anyway.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shralex","name":"shralex","key":"shralex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Shraer","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-12T00:47:40.073+0000","updated":"2012-10-12T00:47:40.073+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474709","id":"13474709","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"Patch v3 adds the check for number of bytes written.\n\nClientTest passed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T01:21:30.061+0000","updated":"2012-10-12T01:21:30.061+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474715","id":"13474715","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12548828/zookeeper-1560-v2.txt\n  against trunk revision 1391526.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1213//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1213//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1213//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T01:31:16.628+0000","updated":"2012-10-12T01:31:16.628+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474742","id":"13474742","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12548839/zookeeper-1560-v3.txt\n  against trunk revision 1391526.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1214//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1214//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1214//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T02:37:45.945+0000","updated":"2012-10-12T02:37:45.945+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474747","id":"13474747","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"I couldn't reproduce the error in test.ClientTest\nLooking at \nhttp://docs.oracle.com/javase/6/docs/api/java/nio/channels/SocketChannel.html#write%28java.nio.ByteBuffer%29\nbq. Unless otherwise specified, a write operation will return only after writing all of the r requested bytes.\nI think the additional check in patch v3 may not be needed","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T02:52:59.347+0000","updated":"2012-10-12T02:52:59.347+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474830","id":"13474830","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shralex","name":"shralex","key":"shralex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Shraer","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Ted,\n\ninstead of int expectedSize = pbb.limit() - pbb.position();\nyou can use pbb.remaining().\n\nBTW, the JIRA description mentions several problems with the same block of code.\nThe first one of them (dequeuing before we know sending succeeded) also causes ZK-1561. \nPlease correct me if I'm wrong but seems like the current patch doesn't address the 3 problems\nmentioned in the description of this JIRA.\n\nThanks,\nAlex","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shralex","name":"shralex","key":"shralex","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Shraer","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-12T06:09:14.827+0000","updated":"2012-10-12T06:09:14.827+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474981","id":"13474981","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fanster.z","name":"fanster.z","key":"fanster.z","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jacky007","active":true,"timeZone":"Asia/Shanghai"},"body":"I think this would work for both 1560 and 1561.\n{noformat}\n if (p != null) {\n                    updateLastSend();\n                    if ((p.requestHeader != null) &&\n                            (p.requestHeader.getType() != OpCode.ping) &&\n                            (p.requestHeader.getType() != OpCode.auth)) {\n                        p.requestHeader.setXid(cnxn.getXid());\n                    }\n                    p.createBB();\n                    ByteBuffer pbb = p.bb;\n          --->   while (pbb.hasRemaining()) sock.write(pbb);\n          --->   outgoingQueue.removeFirstOccurrence(p);\n                    sentCount++;\n                    if (p.requestHeader != null\n                            && p.requestHeader.getType() != OpCode.ping\n                            && p.requestHeader.getType() != OpCode.auth) {\n                        pending.add(p);\n                    }\n       }\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fanster.z","name":"fanster.z","key":"fanster.z","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jacky007","active":true,"timeZone":"Asia/Shanghai"},"created":"2012-10-12T13:11:54.653+0000","updated":"2012-10-12T13:11:54.653+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13474991","id":"13474991","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"Patch v4 adopts what Igor and Jacky suggested.\n\nSince Packet p is guaranteed to send all bytes in its ByteBuffer, I think problem 2 no longer exists.\n\nChrootClientTest and ClientTest both passed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T13:53:12.975+0000","updated":"2012-10-12T13:53:12.975+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13475014","id":"13475014","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12548889/zookeeper-1560-v4.txt\n  against trunk revision 1391526.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1215//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1215//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1215//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T14:25:39.310+0000","updated":"2012-10-12T14:25:39.310+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13475032","id":"13475032","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"From https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1215//testReport/org.apache.zookeeper.test/ClientTest/testLargeNodeData/ :\n{code}\n2012-10-12 14:10:50,042 [myid:] - WARN  [main-SendThread(localhost:11221):ClientCnxn$SendThread@1089] - Session 0x13a555031cf0000 for server localhost/127.0.0.1:11221, unexpected error, closing socket connection and attempting reconnect\njava.io.IOException: Couldn't write 2000 bytes, 1152 bytes written\n\tat org.apache.zookeeper.ClientCnxnSocketNIO.doIO(ClientCnxnSocketNIO.java:142)\n\tat org.apache.zookeeper.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:370)\n\tat org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1068)\n2012-10-12 14:10:50,044 [myid:] - WARN  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:11221:NIOServerCnxn@349] - caught end of stream exception\nEndOfStreamException: Unable to read additional data from client sessionid 0x13a555031cf0000, likely client has closed socket\n\tat org.apache.zookeeper.server.NIOServerCnxn.doIO(NIOServerCnxn.java:220)\n\tat org.apache.zookeeper.server.NIOServerCnxnFactory.run(NIOServerCnxnFactory.java:208)\n\tat java.lang.Thread.run(Thread.java:662)\n{code}\nPatch v5 adds more information to exception message.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T14:46:33.330+0000","updated":"2012-10-12T14:46:33.330+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13475050","id":"13475050","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"Patch v6 changes the condition for raising IOE: if there is no progress between successive sock.write() calls.\n\nI guess socket's output buffer might be a limiting factor as to the number of bytes written in a particular sock.write() call.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T15:02:56.257+0000","updated":"2012-10-12T15:02:56.257+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13475062","id":"13475062","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12548893/zookeeper-1560-v5.txt\n  against trunk revision 1391526.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1216//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1216//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1216//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T15:15:18.520+0000","updated":"2012-10-12T15:15:18.520+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13475079","id":"13475079","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12548898/zookeeper-1560-v6.txt\n  against trunk revision 1391526.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1217//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1217//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1217//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T15:36:23.679+0000","updated":"2012-10-12T15:36:23.679+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13475085","id":"13475085","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ekoontz","name":"ekoontz","key":"ekoontz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ekoontz&avatarId=11640","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ekoontz&avatarId=11640","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ekoontz&avatarId=11640","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ekoontz&avatarId=11640"},"displayName":"Eugene Koontz","active":true,"timeZone":"America/Los_Angeles"},"body":"It seems like in a particular iteration, 0 bytes is written:\n\n{code}\nlocalhost/127.0.0.1:11222, unexpected error, closing socket connection and attempting reconnect\n     [exec]     [junit] java.io.IOException: Couldn't write 2000 bytes, 0 bytes written in this iteration and 77152 bytes written in total. Original limit: 500074\n     [exec]     [junit] \tat org.apache.zookeeper.ClientCnxnSocketNIO.doIO(ClientCnxnSocketNIO.java:145)\n     [exec]     [junit] \tat org.apache.zookeeper.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:375)\n     [exec]     [junit] \tat org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1068)\n     [exec]     [junit] 2012-10-12 15:20:42,629 [myid:] - WARN  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:11222:NIOServerCnxn@349] - caught end of stream exception\n     [exec]     [junit] EndOfStreamException: Unable to read additional data from client sessionid 0x13a55902b650001, likely client has closed socket\n     [exec]     [junit] \tat org.apache.zookeeper.server.NIOServerCnxn.doIO(NIOServerCnxn.java:220)\n     [exec]     [junit] \tat org.apache.zookeeper.server.NIOServerCnxnFactory.run(NIOServerCnxnFactory.java:208)\n     [exec]     [junit] \tat java.lang.Thread.run(Thread.java:662)\n     [exec]     [junit] 2012-10-12 15:20:42,630 [myid:] - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:11222:NIOServerCnxn@1001] - Closed socket connection for client /127.0.0.1:57126 which had sessionid 0x13a55902b650001\n{code}\n\nSeems like there's a strange resemblance among all the test failures thus far: always fails after 77152 bytes written.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ekoontz","name":"ekoontz","key":"ekoontz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ekoontz&avatarId=11640","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ekoontz&avatarId=11640","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ekoontz&avatarId=11640","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ekoontz&avatarId=11640"},"displayName":"Eugene Koontz","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-12T15:41:00.854+0000","updated":"2012-10-12T15:41:00.854+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13475095","id":"13475095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"Patch v7 changes the IOE to a warning.\nLet's see if the test is able to make further progress.\n\nI wonder whether 77152 bytes would be big enough for most use cases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T15:55:22.977+0000","updated":"2012-10-12T15:55:22.977+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13475134","id":"13475134","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12548908/zookeeper-1560-v7.txt\n  against trunk revision 1391526.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1218//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1218//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1218//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T16:39:31.710+0000","updated":"2012-10-12T16:39:31.710+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13475146","id":"13475146","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"Good news was that patch v7 passed.\nNot so good news was that I didn't find any occurrence of the warning message I added in v7.\n\nEssentially patch v7 is the same as patch v2 - we shouldn't bail if a single sock.write() call didn't make progress.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-12T16:47:31.219+0000","updated":"2012-10-12T16:47:31.219+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483426","id":"13483426","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"body":"A couple questions/concerns:\n\n- Is it safe to write out the whole packet in a while loop? Doing so essentially causes the thread to block until everything is written. This seems pretty dangerous to me since there's only a single SendThread -- I think it would be safer to take the current approach of only doing one socket write per invocation of doIO. We would still need to address issue 1 in the description (packets are being removed from the queue even if they weren't fully written).\n\n- What is the purpose of chunking the data? Why not write as much as possible?\n\n- This was commented on earlier, but what's going on with issues 2 and 3 from the description? Addressing only issue 1 seems to fix the problem of sending large packets.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-24T17:46:14.903+0000","updated":"2012-10-24T17:46:14.903+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483507","id":"13483507","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for the review.\nI agree chunking is not needed.\nbq. it would be safer to take the current approach of only doing one socket write per invocation of doIO\nIf we leave Packet p in the outgoingQueue if there is data pending to be written and return from doIO, would the next invocation of doIO continue writing the remaining data from the same Packet ?\nIf so, what is the benefit of one socket write per invocation ?\nShould we remove the Packet p and enqueue it to the tail of outgoingQueue if there is data pending ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-24T19:35:53.242+0000","updated":"2012-10-24T19:35:53.242+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483544","id":"13483544","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"body":"The benefit of one socket write per invocation is that it frees up the SendThread to perform other actions in between writes. For instance, it looks like the SendThread is also response for reading incoming data in doIO. I'm not sure what the consequences of having the thread block until the whole packet is written are; it might be ok, but if we can avoid looping it might save us some trouble later.\n\nThe next invocation of doIO should continue writing any remaining data from a previous packet (we don't want to mix up data from different packets). However, I'm not sure the current code will do this correctly -- I think it's possible for another packet to be pushed onto the queue while another packet is in the middle of being written. I'm going to look into this further.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-24T20:13:20.811+0000","updated":"2012-10-24T20:13:20.811+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483563","id":"13483563","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"For problem #3, I only found one call to getXid() in doIO:\n{code}\n                        p.requestHeader.setXid(cnxn.getXid());\n{code}\nwhich is not in a loop. Some clarification would be nice.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-24T20:30:24.993+0000","updated":"2012-10-24T20:30:24.993+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483566","id":"13483566","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"That's a good point, the while loop in the patch seems like it would block when the tcp buffer is full (e.g. if the server is slow to read). I don't think that's a good idea. Rather we should have the code structured similar to what it was before - write as much as possible and then use the selector to wait for the socket to become writeable again. Eventually the send buffer will drain and we can remove it from the queue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-24T20:32:58.818+0000","updated":"2012-10-24T20:32:58.818+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483592","id":"13483592","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nekto0n","name":"nekto0n","key":"nekto0n","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nikita Vetoshkin","active":true,"timeZone":"Asia/Ashgabat"},"body":"If no one can prepend {{outgoingQueue}} with packet, straightforward implementation like this should work:\n{noformat}\ndiff --git a/src/java/main/org/apache/zookeeper/ClientCnxnSocketNIO.java b/src/java/main/org/apache/zookeeper/ClientCnxnSocketNIO.java\nindex 70d8538..457c8cc 100644\n--- a/src/java/main/org/apache/zookeeper/ClientCnxnSocketNIO.java\n+++ b/src/java/main/org/apache/zookeeper/ClientCnxnSocketNIO.java\n@@ -111,17 +111,20 @@ public class ClientCnxnSocketNIO extends ClientCnxnSocket {\n                         cnxn.sendThread.clientTunneledAuthenticationInProgress());\n \n                 if (p != null) {\n-                    outgoingQueue.removeFirstOccurrence(p);\n                     updateLastSend();\n-                    if ((p.requestHeader != null) &&\n-                            (p.requestHeader.getType() != OpCode.ping) &&\n-                            (p.requestHeader.getType() != OpCode.auth)) {\n-                        p.requestHeader.setXid(cnxn.getXid());\n+                    if (p.bb != null) {\n+                        if ((p.requestHeader != null) &&\n+                                (p.requestHeader.getType() != OpCode.ping) &&\n+                                (p.requestHeader.getType() != OpCode.auth)) {\n+                            p.requestHeader.setXid(cnxn.getXid());\n+                        }\n+                        p.createBB();\n+                    // otherwise we're in the middle of sending packet\n                     }\n-                    p.createBB();\n                     ByteBuffer pbb = p.bb;\n                     sock.write(pbb);\n                     if (!pbb.hasRemaining()) {\n+                        outgoingQueue.removeFirstOccurrence(p);\n                         sentCount++;\n                         if (p.requestHeader != null\n                                 && p.requestHeader.getType() != OpCode.ping\n\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nekto0n","name":"nekto0n","key":"nekto0n","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nikita Vetoshkin","active":true,"timeZone":"Asia/Ashgabat"},"created":"2012-10-24T21:07:48.621+0000","updated":"2012-10-24T21:07:48.621+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483597","id":"13483597","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"Looking at createBB(), upon exit the field bb wouldn't be null.\nI wonder why p.createBB() is enclosed in the if (p.bb != null) block above ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-24T21:13:06.359+0000","updated":"2012-10-24T21:13:06.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483601","id":"13483601","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. similar to what it was before - write as much as possible and then use the selector to wait for the socket to become writeable again\nI looked at svn log for ClientCnxnSocketNIO.java back to 2011-04-12 and didn't seem to find the above change.\nFYI","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-24T21:18:57.288+0000","updated":"2012-10-24T21:18:57.288+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483662","id":"13483662","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"ClientTest normally takes 36 seconds.\nI ran ClientTest, twice, with Nikita's change:\n{code}\n    [junit] Running org.apache.zookeeper.test.ClientTest\n    [junit] Tests run: 12, Failures: 12, Errors: 0, Time elapsed: 340.748 sec\n    [junit] Test org.apache.zookeeper.test.ClientTest FAILED\n{code}\nI then tried the following:\n{code}\nIndex: src/java/main/org/apache/zookeeper/ClientCnxnSocketNIO.java\n===================================================================\n--- src/java/main/org/apache/zookeeper/ClientCnxnSocketNIO.java (revision 1401900)\n+++ src/java/main/org/apache/zookeeper/ClientCnxnSocketNIO.java (working copy)\n@@ -111,17 +111,20 @@\n                         cnxn.sendThread.clientTunneledAuthenticationInProgress());\n\n                 if (p != null) {\n-                    outgoingQueue.removeFirstOccurrence(p);\n                     updateLastSend();\n                     if ((p.requestHeader != null) &&\n-                            (p.requestHeader.getType() != OpCode.ping) &&\n-                            (p.requestHeader.getType() != OpCode.auth)) {\n-                        p.requestHeader.setXid(cnxn.getXid());\n+                        (p.requestHeader.getType() != OpCode.ping) &&\n+                        (p.requestHeader.getType() != OpCode.auth)) {\n+                      p.requestHeader.setXid(cnxn.getXid());\n                     }\n-                    p.createBB();\n+                    if (p.bb == null) {\n+                        p.createBB();\n+                        // otherwise we're in the middle of sending packet\n+                    }\n                     ByteBuffer pbb = p.bb;\n                     sock.write(pbb);\n                     if (!pbb.hasRemaining()) {\n+                        outgoingQueue.removeFirstOccurrence(p);\n                         sentCount++;\n                         if (p.requestHeader != null\n                                 && p.requestHeader.getType() != OpCode.ping\n{code}\ntestLargeNodeData encountered connection loss.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-24T22:26:22.404+0000","updated":"2012-10-24T22:26:22.404+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483691","id":"13483691","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. Should we remove the Packet p and enqueue it to the tail of outgoingQueue if there is data pending ?\nThe answer to my own question is no.\nThis would very likely result in connection loss / timeout when node data size is large.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-24T22:51:40.503+0000","updated":"2012-10-24T22:51:40.503+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483725","id":"13483725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. PDH: similar to what it was before - write as much as possible and then use the selector to wait for the socket to become writeable again\n\nbq. Ted: I looked at svn log for ClientCnxnSocketNIO.java back to 2011-04-12 and didn't seem to find the above change. FYI\n\nHi Ted, the following is what I was referring to. This is from latest on branch-3.3, 3.4.4 has a similar (although broken) block where it's a bit less obvious what's happening. branch-3.3 is more clear.\n\nNotice that we first attempt to write, if !remaining them we remove from the queue, otw we'll wait till the next time the selector wakes us up (the final isempty check is pretty criticial here as well to set interest correctly) and retry until the buffer is drained.\n\n{noformat}\n            if (sockKey.isWritable()) {\n                synchronized (outgoingQueue) {\n                    if (!outgoingQueue.isEmpty()) {\n                        ByteBuffer pbb = outgoingQueue.getFirst().bb;\n                        sock.write(pbb);\n                        if (!pbb.hasRemaining()) {\n                            sentCount++;\n                            Packet p = outgoingQueue.removeFirst();\n                            if (p.header != null\n                                    && p.header.getType() != OpCode.ping\n                                    && p.header.getType() != OpCode.auth) {\n                                pendingQueue.add(p);\n                            }\n                        }\n                    }\n                }\n            }\n            if (outgoingQueue.isEmpty()) {\n                disableWrite();\n            } else {\n                enableWrite();\n            }\n{noformat}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-24T23:27:40.545+0000","updated":"2012-10-24T23:27:40.545+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483737","id":"13483737","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"I got the following based on the above code snippet:\n{code}\nIndex: src/java/main/org/apache/zookeeper/ClientCnxnSocketNIO.java\n===================================================================\n--- src/java/main/org/apache/zookeeper/ClientCnxnSocketNIO.java\t(revision 1401904)\n+++ src/java/main/org/apache/zookeeper/ClientCnxnSocketNIO.java\t(working copy)\n@@ -111,18 +111,18 @@\n                         cnxn.sendThread.clientTunneledAuthenticationInProgress());\n \n                 if (p != null) {\n-                    outgoingQueue.removeFirstOccurrence(p);\n                     updateLastSend();\n                     if ((p.requestHeader != null) &&\n                             (p.requestHeader.getType() != OpCode.ping) &&\n                             (p.requestHeader.getType() != OpCode.auth)) {\n                         p.requestHeader.setXid(cnxn.getXid());\n                     }\n-                    p.createBB();\n+                    if (p.bb == null) p.createBB();\n                     ByteBuffer pbb = p.bb;\n                     sock.write(pbb);\n                     if (!pbb.hasRemaining()) {\n                         sentCount++;\n+                        outgoingQueue.removeFirstOccurrence(p);\n                         if (p.requestHeader != null\n                                 && p.requestHeader.getType() != OpCode.ping\n                                 && p.requestHeader.getType() != OpCode.auth) {\n@@ -141,8 +141,12 @@\n             synchronized(pendingQueue) {\n                 pendingQueue.addAll(pending);\n             }\n-\n         }\n+        if (outgoingQueue.isEmpty()) {\n+          disableWrite();\n+        } else {\n+            enableWrite();\n+        }\n     }\n \n     private Packet findSendablePacket(LinkedList<Packet> outgoingQueue,\n{code}\nI still saw testLargeNodeData fail:\n{code}\nTestcase: testLargeNodeData took 0.714 sec\n  Caused an ERROR\nKeeperErrorCode = ConnectionLoss for /large\norg.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss for /large\n  at org.apache.zookeeper.KeeperException.create(KeeperException.java:99)\n  at org.apache.zookeeper.KeeperException.create(KeeperException.java:51)\n  at org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:783)\n  at org.apache.zookeeper.test.ClientTest.testLargeNodeData(ClientTest.java:61)\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-24T23:49:25.914+0000","updated":"2012-10-24T23:49:25.914+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483748","id":"13483748","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imotov","name":"imotov","key":"imotov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Motov","active":true,"timeZone":"America/New_York"},"body":"{quote}\nFor problem #3, I only found one call to getXid() in doIO:\n{code}\np.requestHeader.setXid(cnxn.getXid());\n{code}\nwhich is not in a loop. Some clarification would be nice.\n{quote}\nIt's in the outer loop, so to speak. If the packet is large and is sent in chunks, Xid is incremented for every chunk. Before ZOOKEEPER-1437 it was incremented for every packet. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=imotov","name":"imotov","key":"imotov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Motov","active":true,"timeZone":"America/New_York"},"created":"2012-10-25T00:04:04.897+0000","updated":"2012-10-25T00:04:04.897+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483787","id":"13483787","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"body":"I've created a new patch (ZOOKEEPER-1560-v8.patch) that incorporates what we have so far (moving removeFirstOccurrence to after the packet is completely written, only calling createBB when a BB doesn't already exist, and only calling setXid when no xid is already set). It also modifies findSendablePacket to always choose the first packet if it is partially written. The only place that a packet is prepended to outgoingQueue is ClientCnxn.primeConnection, which should only happen at the very beginning, so a partially-written packet should remain at the beginning of the queue until it is removed. I also cleaned up some of the code so the changes look more extensive than they really are :) Posted at https://reviews.apache.org/r/7730. I added comments to mark the important parts (as opposed to the clean up).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-25T00:57:54.814+0000","updated":"2012-10-25T00:57:54.814+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483809","id":"13483809","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12550725/ZOOKEEPER-1560-v8.patch\n  against trunk revision 1391526.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1238//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1238//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1238//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-25T01:29:26.706+0000","updated":"2012-10-25T01:29:26.706+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13483823","id":"13483823","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"body":"I left some minor comments on review board.\nNice work, Skye.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yuzhihong%40gmail.com","name":"yuzhihong@gmail.com","key":"yuzhihong@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-25T02:04:16.798+0000","updated":"2012-10-25T02:04:16.798+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13485273","id":"13485273","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"body":"syncing with review board","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-26T23:20:46.685+0000","updated":"2012-10-26T23:20:46.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13485293","id":"13485293","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12551039/ZOOKEEPER-1560-v8_r3.patch\n  against trunk revision 1391526.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1241//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1241//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1241//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-26T23:58:35.673+0000","updated":"2012-10-26T23:58:35.673+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13485720","id":"13485720","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"In patch v8, I don't see special handling for cnxn.getXid()\nFYI","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-28T21:42:44.532+0000","updated":"2012-10-28T21:42:44.532+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13485854","id":"13485854","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. In patch v8, I don't see special handling for cnxn.getXid()\n\nHi Ted, I'm not clear, what do you mean by that comment?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-29T06:27:59.356+0000","updated":"2012-10-29T06:27:59.356+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13486044","id":"13486044","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"It was about 'the third issue is caused by extra calls to cnxn.getXid() that increment xid on every iteration and confuse the server.'\nIn previous patch, there was check whether Xid is 0 before calling p.requestHeader.setXid().","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-29T14:22:23.864+0000","updated":"2012-10-29T14:22:23.864+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13486983","id":"13486983","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"Skye provided the latest patch. Assigning to Skye.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-30T16:15:48.581+0000","updated":"2012-10-30T16:15:48.581+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13487332","id":"13487332","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"body":"Rather than checking if the xid is 0, the new patch moves the xid code into the if (p.bb == null) block. We're essentially checking whether we've already started writing the packet, and if we haven't, we call createBB and setXid. Since we always do these two actions under the same condition (i.e., when we see a new packet), there's no reason to have two separate checks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-30T22:51:53.484+0000","updated":"2012-10-30T22:51:53.484+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13487335","id":"13487335","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"Above explanation makes sense.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-30T22:57:10.273+0000","updated":"2012-10-30T22:57:10.273+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13487525","id":"13487525","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Looks good to me. +1 on the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-31T04:59:52.573+0000","updated":"2012-10-31T04:59:52.573+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13488002","id":"13488002","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"body":"Add ClientTest.testLargeNodeData to v8_r3 patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-31T17:43:19.521+0000","updated":"2012-10-31T17:43:19.521+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13488010","id":"13488010","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12551585/ZOOKEEPER-1560-v8_r4.patch\n  against trunk revision 1404260.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    -1 patch.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1242//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-31T17:51:50.393+0000","updated":"2012-10-31T17:51:50.393+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13488025","id":"13488025","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"body":"Can anyone figure out why QA couldn't apply the patch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skye","name":"skye","key":"skye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Skye Wanderman-Milne","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-31T18:01:41.025+0000","updated":"2012-10-31T18:01:41.025+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13488034","id":"13488034","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"body":"I think Patrick forgot to announce the integration of your prior patch:\n{code}\nr1404260 | phunt | 2012-10-31 10:24:54 -0700 (Wed, 31 Oct 2012) | 1 line\n\nZOOKEEPER-1560 Zookeeper client hangs on creation of large nodes (Skye Wanderman-Milne via phunt)\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhihyu%40ebaysf.com","name":"zhihyu@ebaysf.com","key":"zhihyu@ebaysf.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Yu","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-31T18:08:15.353+0000","updated":"2012-10-31T18:08:15.353+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13488070","id":"13488070","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Things take time. ;-)\n\nI was waiting for Skye to update the patch to include the missing test. It's failing to apply now because the most recent patch is now partially committed to trunk. Working on it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-31T18:36:59.250+0000","updated":"2012-10-31T18:36:59.250+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13488077","id":"13488077","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to branch-3.4 and trunk. Thanks Skye et. al. !","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-31T18:44:12.035+0000","updated":"2012-10-31T18:44:12.035+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12611273/comment/13488345","id":"13488345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in ZooKeeper-trunk #1728 (See [https://builds.apache.org/job/ZooKeeper-trunk/1728/])\n    ZOOKEEPER-1560 Zookeeper client hangs on creation of large nodes. Added missing test. (Skye Wanderman-Milne via phunt) (Revision 1404288)\nZOOKEEPER-1560 Zookeeper client hangs on creation of large nodes (Skye Wanderman-Milne via phunt) (Revision 1404260)\n\n     Result = SUCCESS\nphunt : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1404288\nFiles : \n* /zookeeper/trunk/src/java/test/org/apache/zookeeper/test/ClientTest.java\n\nphunt : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1404260\nFiles : \n* /zookeeper/trunk/src/java/main/org/apache/zookeeper/ClientCnxnSocketNIO.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-31T23:00:47.081+0000","updated":"2012-10-31T23:00:47.081+0000"}],"maxResults":63,"total":63,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1560/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i084lr:"}}