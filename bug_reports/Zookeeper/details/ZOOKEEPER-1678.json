{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12639720","self":"https://issues.apache.org/jira/rest/api/2/issue/12639720","key":"ZOOKEEPER-1678","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-07-09T09:43:18.630+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 09 09:43:18 UTC 2013","customfield_12310420":"320189","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1678/watchers","watchCount":7,"isWatching":false},"created":"2013-03-29T00:19:02.671+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321883","id":"12321883","description":"Fix release against 3.4 branch","name":"3.4.5","archived":false,"released":true,"releaseDate":"2012-11-18"}],"issuelinks":[{"id":"12367260","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12367260","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12477470","key":"ZOOKEEPER-900","self":"https://issues.apache.org/jira/rest/api/2/issue/12477470","fields":{"summary":"FLE implementation should be improved to use non-blocking sockets","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-07-09T09:43:18.630+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312378","id":"12312378","name":"leaderElection","description":"Leader election algorithm for ZooKeeper"}],"timeoriginalestimate":null,"description":"In a 5-node ZK cluster setup, in the following state:\n* 1 host is down / not reachable.\n* 4 hosts are up.\n* 3 ZK servers are in quorum.\n* a 4th ZK server was restarted and is trying to re-join the quorum.\n\nThe 4th server is not able to rejoin the quorum because the connection to the host that is not established, and apparently takes to long to timeout.\n\nStack traces and additional information coming.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"320530","customfield_12312823":null,"summary":"Server fails to join quorum when a peer is unreachable (5 ZK server setup)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliolopez","name":"juliolopez","key":"juliolopez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Julio Lopez","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliolopez","name":"juliolopez","key":"juliolopez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Julio Lopez","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"java version \"1.6.0_32\"\nJava(TM) SE Runtime Environment (build 1.6.0_32-b05)\nJava HotSpot(TM) 64-Bit Server VM (build 20.7-b02, mixed mode)\n\nDistributor ID:\tUbuntu\nDescription:\tUbuntu 12.04.1 LTS\nRelease:\t12.04\nCodename:\tprecise\n\nuname -a Linux ha-vani3-0 3.2.0-23-virtual #36-Ubuntu SMP Tue Apr 10 22:29:03 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12639720/comment/13616907","id":"13616907","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliolopez","name":"juliolopez","key":"juliolopez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Julio Lopez","active":true,"timeZone":"America/Los_Angeles"},"body":"Apparently, the ZK server that is trying to re-join the quorum takes too long to realize that it cannot reach the node that is down.  It seems to take about 60+ seconds to timeout a connection attempt when looking for the quorum.\nEvery 60 - 70 seconds, an exception of the following form shows up:\n\n{{\n2013-03-29 00:14:16,181 - WARN  [WorkerSender[myid=1]:QuorumCnxManager@368] - Cannot open channel to 3 at election address 10.51.21.140:3888\njava.net.NoRouteToHostException: No route to host\n        at java.net.PlainSocketImpl.socketConnect(Native Method)\n        at java.net.PlainSocketImpl.doConnect(Unknown Source)\n        at java.net.PlainSocketImpl.connectToAddress(Unknown Source)\n        at java.net.PlainSocketImpl.connect(Unknown Source)\n        at java.net.SocksSocketImpl.connect(Unknown Source)\n        at java.net.Socket.connect(Unknown Source)\n        at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:354)\n        at org.apache.zookeeper.server.quorum.QuorumCnxManager.toSend(QuorumCnxManager.java:327)\n        at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.process(FastLeaderElection.java:393)\n        at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.run(FastLeaderElection.java:365)\n        at java.lang.Thread.run(Unknown Source)\n}}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliolopez","name":"juliolopez","key":"juliolopez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Julio Lopez","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-29T00:30:51.954+0000","updated":"2013-03-29T00:30:51.954+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12639720/comment/13616914","id":"13616914","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliolopez","name":"juliolopez","key":"juliolopez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Julio Lopez","active":true,"timeZone":"America/Los_Angeles"},"body":"This probably means that \"WorkSender\" is blocked for that long in connect() (in connectOne), and thus cannot contact enough peers (and get responses) before org.apache.zookeeper.server.quorum.FastLeaderElection.lookForLeader() times out, which is capped ({{maxNotificationInterval}}) at 60 secs.\n\nIn theory, the connect should take no longer that tickTime * syncLimit, which in this case are set to: {{tickTime=2000}}, {{initLimit=10}}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliolopez","name":"juliolopez","key":"juliolopez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Julio Lopez","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-29T00:47:29.532+0000","updated":"2013-03-29T00:47:29.532+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12639720/comment/13616915","id":"13616915","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliolopez","name":"juliolopez","key":"juliolopez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Julio Lopez","active":true,"timeZone":"America/Los_Angeles"},"body":"{{syncLimit=5}}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliolopez","name":"juliolopez","key":"juliolopez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Julio Lopez","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-29T00:48:22.619+0000","updated":"2013-03-29T00:48:22.619+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12639720/comment/13616919","id":"13616919","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliolopez","name":"juliolopez","key":"juliolopez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Julio Lopez","active":true,"timeZone":"America/Los_Angeles"},"body":"*Stack traces*\n\n{code}\n2013-03-28 22:27:01\nFull thread dump Java HotSpot(TM) 64-Bit Server VM (20.7-b02 mixed mode):\n\n\"RecvWorker:2\" prio=10 tid=0x00007fb5e0003000 nid=0x3f4e runnable [0x00007fb61c5d3000]\n   java.lang.Thread.State: RUNNABLE\n    at java.net.SocketInputStream.socketRead0(Native Method)\n    at java.net.SocketInputStream.read(Unknown Source)\n    at java.net.SocketInputStream.read(Unknown Source)\n    at java.io.DataInputStream.readInt(Unknown Source)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager$RecvWorker.run(QuorumCnxManager.java:747)\n\n\"SendWorker:2\" prio=10 tid=0x00007fb5e0001800 nid=0x3f4d waiting on condition [0x00007fb61c6d4000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x000000008b800228> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n    at java.util.concurrent.locks.LockSupport.parkNanos(Unknown Source)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(Unknown Source)\n    at java.util.concurrent.ArrayBlockingQueue.poll(Unknown Source)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.pollSendQueue(QuorumCnxManager.java:831)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.access$500(QuorumCnxManager.java:62)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager$SendWorker.run(QuorumCnxManager.java:667)\n\n\"RecvWorker:5\" prio=10 tid=0x00007fb5e000f800 nid=0x2378 runnable [0x00007fb5e7bfa000]\n   java.lang.Thread.State: RUNNABLE\n    at java.net.SocketInputStream.socketRead0(Native Method)\n    at java.net.SocketInputStream.read(Unknown Source)\n    at java.net.SocketInputStream.read(Unknown Source)\n    at java.io.DataInputStream.readInt(Unknown Source)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager$RecvWorker.run(QuorumCnxManager.java:747)\n\n\"SendWorker:5\" prio=10 tid=0x00007fb5e000d800 nid=0x2377 waiting on condition [0x00007fb5e7cfb000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x000000008b800408> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n    at java.util.concurrent.locks.LockSupport.parkNanos(Unknown Source)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(Unknown Source)\n    at java.util.concurrent.ArrayBlockingQueue.poll(Unknown Source)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.pollSendQueue(QuorumCnxManager.java:831)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.access$500(QuorumCnxManager.java:62)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager$SendWorker.run(QuorumCnxManager.java:667)\n\n\"RecvWorker:4\" prio=10 tid=0x00007fb5e000c000 nid=0x232a runnable [0x00007fb5e7dfc000]\n   java.lang.Thread.State: RUNNABLE\n    at java.net.SocketInputStream.socketRead0(Native Method)\n    at java.net.SocketInputStream.read(Unknown Source)\n    at java.net.SocketInputStream.read(Unknown Source)\n    at java.io.DataInputStream.readInt(Unknown Source)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager$RecvWorker.run(QuorumCnxManager.java:747)\n\n\"SendWorker:4\" prio=10 tid=0x00007fb5e000a800 nid=0x2329 waiting on condition [0x00007fb5e7efd000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x000000008b810878> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n    at java.util.concurrent.locks.LockSupport.parkNanos(Unknown Source)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(Unknown Source)\n    at java.util.concurrent.ArrayBlockingQueue.poll(Unknown Source)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.pollSendQueue(QuorumCnxManager.java:831)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.access$500(QuorumCnxManager.java:62)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager$SendWorker.run(QuorumCnxManager.java:667)\n\n\"QuorumPeer[myid=1]/0:0:0:0:0:0:0:0:2181\" prio=10 tid=0x00007fb620178000 nid=0xecd waiting on condition [0x00007fb61c7d5000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x000000008b813010> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n    at java.util.concurrent.locks.LockSupport.parkNanos(Unknown Source)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(Unknown Source)\n    at java.util.concurrent.LinkedBlockingQueue.poll(Unknown Source)\n    at org.apache.zookeeper.server.quorum.FastLeaderElection.lookForLeader(FastLeaderElection.java:754)\n    at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:716)\n\n\"WorkerReceiver[myid=1]\" daemon prio=10 tid=0x00007fb62017c000 nid=0xecc waiting on condition [0x00007fb61c8d6000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x000000008b863200> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n    at java.util.concurrent.locks.LockSupport.parkNanos(Unknown Source)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(Unknown Source)\n    at java.util.concurrent.ArrayBlockingQueue.poll(Unknown Source)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.pollRecvQueue(QuorumCnxManager.java:883)\n    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerReceiver.run(FastLeaderElection.java:205)\n    at java.lang.Thread.run(Unknown Source)\n\n\"WorkerSender[myid=1]\" daemon prio=10 tid=0x00007fb620180000 nid=0xecb waiting on condition [0x00007fb61c9d7000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x000000008b82a360> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n    at java.util.concurrent.locks.LockSupport.parkNanos(Unknown Source)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(Unknown Source)\n    at java.util.concurrent.LinkedBlockingQueue.poll(Unknown Source)\n    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.run(FastLeaderElection.java:362)\n    at java.lang.Thread.run(Unknown Source)\n\n\"10.51.21.144:3888\" prio=10 tid=0x00007fb620185000 nid=0xeca runnable [0x00007fb61cad8000]\n   java.lang.Thread.State: RUNNABLE\n    at java.net.PlainSocketImpl.socketAccept(Native Method)\n    at java.net.PlainSocketImpl.accept(Unknown Source)\n    - locked <0x000000008b863660> (a java.net.SocksSocketImpl)\n    at java.net.ServerSocket.implAccept(Unknown Source)\n    at java.net.ServerSocket.accept(Unknown Source)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager$Listener.run(QuorumCnxManager.java:491)\n\n\"NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181\" daemon prio=10 tid=0x00007fb62018c000 nid=0xec9 runnable [0x00007fb61cbd9000]\n   java.lang.Thread.State: RUNNABLE\n    at sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)\n    at sun.nio.ch.EPollArrayWrapper.poll(Unknown Source)\n    at sun.nio.ch.EPollSelectorImpl.doSelect(Unknown Source)\n    at sun.nio.ch.SelectorImpl.lockAndDoSelect(Unknown Source)\n    - locked <0x000000008b85ec68> (a sun.nio.ch.Util$2)\n    - locked <0x000000008b85ec58> (a java.util.Collections$UnmodifiableSet)\n    - locked <0x000000008b85ea00> (a sun.nio.ch.EPollSelectorImpl)\n    at sun.nio.ch.SelectorImpl.select(Unknown Source)\n    at org.apache.zookeeper.server.NIOServerCnxnFactory.run(NIOServerCnxnFactory.java:178)\n    at java.lang.Thread.run(Unknown Source)\n\n\"PurgeTask\" daemon prio=10 tid=0x00007fb620142800 nid=0xeaa in Object.wait() [0x00007fb61cde2000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n    at java.lang.Object.wait(Native Method)\n    - waiting on <0x000000008b863b40> (a java.util.TaskQueue)\n    at java.util.TimerThread.mainLoop(Unknown Source)\n    - locked <0x000000008b863b40> (a java.util.TaskQueue)\n    at java.util.TimerThread.run(Unknown Source)\n\n\"RMI TCP Accept-0\" daemon prio=10 tid=0x00007fb620123000 nid=0xe39 runnable [0x00007fb6244aa000]\n   java.lang.Thread.State: RUNNABLE\n    at java.net.PlainSocketImpl.socketAccept(Native Method)\n    at java.net.PlainSocketImpl.accept(Unknown Source)\n    - locked <0x000000008b8640b0> (a java.net.SocksSocketImpl)\n    at java.net.ServerSocket.implAccept(Unknown Source)\n    at java.net.ServerSocket.accept(Unknown Source)\n    at sun.rmi.transport.tcp.TCPTransport$AcceptLoop.executeAcceptLoop(Unknown Source)\n    at sun.rmi.transport.tcp.TCPTransport$AcceptLoop.run(Unknown Source)\n    at java.lang.Thread.run(Unknown Source)\n\n\"Low Memory Detector\" daemon prio=10 tid=0x00007fb62008a800 nid=0xe38 runnable [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"C2 CompilerThread1\" daemon prio=10 tid=0x00007fb620088800 nid=0xe37 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"C2 CompilerThread0\" daemon prio=10 tid=0x00007fb620085800 nid=0xe36 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"Signal Dispatcher\" daemon prio=10 tid=0x00007fb620083800 nid=0xe35 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"Finalizer\" daemon prio=10 tid=0x00007fb62006a800 nid=0xe31 in Object.wait() [0x00007fb624c10000]\n   java.lang.Thread.State: WAITING (on object monitor)\n    at java.lang.Object.wait(Native Method)\n    - waiting on <0x000000008b864868> (a java.lang.ref.ReferenceQueue$Lock)\n    at java.lang.ref.ReferenceQueue.remove(Unknown Source)\n    - locked <0x000000008b864868> (a java.lang.ref.ReferenceQueue$Lock)\n    at java.lang.ref.ReferenceQueue.remove(Unknown Source)\n    at java.lang.ref.Finalizer$FinalizerThread.run(Unknown Source)\n\n\"Reference Handler\" daemon prio=10 tid=0x00007fb620068800 nid=0xe30 in Object.wait() [0x00007fb624d11000]\n   java.lang.Thread.State: WAITING (on object monitor)\n    at java.lang.Object.wait(Native Method)\n    - waiting on <0x000000008b863a50> (a java.lang.ref.Reference$Lock)\n    at java.lang.Object.wait(Object.java:485)\n    at java.lang.ref.Reference$ReferenceHandler.run(Unknown Source)\n    - locked <0x000000008b863a50> (a java.lang.ref.Reference$Lock)\n\n\"main\" prio=10 tid=0x00007fb620008000 nid=0xe2c in Object.wait() [0x00007fb626a07000]\n   java.lang.Thread.State: WAITING (on object monitor)\n    at java.lang.Object.wait(Native Method)\n    - waiting on <0x000000008b810990> (a org.apache.zookeeper.server.quorum.QuorumPeer)\n    at java.lang.Thread.join(Unknown Source)\n    - locked <0x000000008b810990> (a org.apache.zookeeper.server.quorum.QuorumPeer)\n    at java.lang.Thread.join(Unknown Source)\n    at org.apache.zookeeper.server.quorum.QuorumPeerMain.runFromConfig(QuorumPeerMain.java:152)\n    at org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:111)\n    at org.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:78)\n\n\"VM Thread\" prio=10 tid=0x00007fb620061800 nid=0xe2f runnable\n\n\"GC task thread#0 (ParallelGC)\" prio=10 tid=0x00007fb62001b000 nid=0xe2d runnable\n\n\"GC task thread#1 (ParallelGC)\" prio=10 tid=0x00007fb62001c800 nid=0xe2e runnable\n\n\"VM Periodic Task Thread\" prio=10 tid=0x00007fb620132000 nid=0xe3a waiting on condition\n\nJNI global references: 1530\n\nHeap\n PSYoungGen      total 24448K, used 1510K [0x00000000d92b0000, 0x00000000db0f0000, 0x0000000100000000)\n  eden space 24320K, 5% used [0x00000000d92b0000,0x00000000d94118b0,0x00000000daa70000)\n  from space 128K, 75% used [0x00000000daee0000,0x00000000daef8000,0x00000000daf00000)\n  to   space 1088K, 0% used [0x00000000dafe0000,0x00000000dafe0000,0x00000000db0f0000)\n PSOldGen        total 79488K, used 626K [0x000000008b800000, 0x00000000905a0000, 0x00000000d92b0000)\n  object space 79488K, 0% used [0x000000008b800000,0x000000008b89cae0,0x00000000905a0000)\n PSPermGen       total 21248K, used 10142K [0x0000000086600000, 0x0000000087ac0000, 0x000000008b800000)\n  object space 21248K, 47% used [0x0000000086600000,0x0000000086fe78d0,0x0000000087ac0000)\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliolopez","name":"juliolopez","key":"juliolopez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Julio Lopez","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-29T00:51:14.110+0000","updated":"2013-03-29T00:51:14.110+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12639720/comment/13616921","id":"13616921","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliolopez","name":"juliolopez","key":"juliolopez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Julio Lopez","active":true,"timeZone":"America/Los_Angeles"},"body":"A potentially simple solution could be to randomize the order in which the {{notmsg}} are put in the queue in {{org.apache.zookeeper.server.quorum.FastLeaderElection.sendNotifications()}}.  Alternatively, have at least more than one WorkerSender, probably close to the number of total number of ZK servers in the cluster, but it's not clear what the concurrency implications are there.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=juliolopez","name":"juliolopez","key":"juliolopez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Julio Lopez","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-29T00:56:59.344+0000","updated":"2013-03-29T00:56:59.344+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12639720/comment/13703093","id":"13703093","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"[~juliolopez] FLE pushes notifications to other servers, but it could happen that we start a server and there is no one else around, so instead of sending an overwhelming number of messages, the server backs off and caps at 60 seconds as you say if I remember correctly. I don't mind having that cap value configurable if it helps with you case. \n\nI'm not convinced that the randomization of notifications will make any difference, but perhaps I'm not understanding your proposal correctly.\n\nI think you're referring to SendWorker in QCM, is it right? We do have one per server, no?\n\nAs [~abranzyck] pointed out, it sounds like the problem reported here could be solved by the fix of ZOOKEEPER-900. Could you guys make sure that solution works here and possibly provide an updated patch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2013-07-09T09:43:18.630+0000","updated":"2013-07-09T09:43:18.630+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1678/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1j8vb:"}}