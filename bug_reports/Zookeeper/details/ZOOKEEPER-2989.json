{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13141901","self":"https://issues.apache.org/jira/rest/api/2/issue/13141901","key":"ZOOKEEPER-2989","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":7800,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":7800,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-03-13T19:48:58.691+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat May 26 04:02:24 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2989/watchers","watchCount":2,"isWatching":false},"created":"2018-03-01T20:34:50.604+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["pull-request-available"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335444","id":"12335444","description":"Beta release against 3.5 branch","name":"3.5.3","archived":false,"released":true,"releaseDate":"2017-04-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=maoling","name":"maoling","key":"maoling","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=maoling&avatarId=32024","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=maoling&avatarId=32024","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=maoling&avatarId=32024","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=maoling&avatarId=32024"},"displayName":"maoling","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-07-12T03:41:30.535+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312379","id":"12312379","name":"quorum","description":"Quorum determination for ZooKeeper"}],"timeoriginalestimate":null,"description":"We're using ZK 3.5.3-beta.\r\n\r\nWhen using literal IPv6 addresses in the zoo.cfg.dynamic file, ZK fails to come up with the connection to the peer ZKs keeps getting reset.\r\n\r\nzookeeper.log indicates a badly formed address is the cause.\r\n{noformat}\r\n<2018.03.01 15:14:30 163 -0500><E><sdn3></2001:db8:0:0:0:0:0:4:3888><org.apache.zookeeper.server.quorum.QuorumCnxManager> org.apache.zookeeper.server.quorum.QuorumCnxManager$InitialMessage$InitialMessageException: Badly formed address: 2001:db8:0:0:0:0:0:2:3888{noformat}\r\nOur zoo.cfg.dynamic uses literal IPv6 addresses which according to ZOOKEEPER-1460 is supported.\r\n{noformat}\r\nserver.1=[2001:db8::2]:2888:3888\r\nserver.2=[2001:db8::3]:2888:3888\r\nserver.3=[2001:db8::4]:2888:3888{noformat}\r\n \r\n\r\nDigging into QuorumCnxManager.java, InitialMessage.parse attemps to seperate the host portion from the port portion using \":\" as a delimeter, which is a problem for IPv6 IPs.  And there's this comment:\r\n{code:java}\r\n// FIXME: IPv6 is not supported. Using something like Guava's HostAndPort\r\n// parser would be good.{code}\r\nSo it looks like peers address:port is failing to be parsed if they are specified as literal IPv6 addresses.  To confirm a workaround, I replaced my zoo.cfg.dynamic with hostnames instead, and everything worked as expected.\r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\n ","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"2h 10m","remainingEstimateSeconds":0,"timeSpentSeconds":7800},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"IPv6 literal address causes problems for Quorum members","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rtrudeau","name":"rtrudeau","key":"rtrudeau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Trudeau","active":true,"timeZone":"America/Toronto"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rtrudeau","name":"rtrudeau","key":"rtrudeau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Trudeau","active":true,"timeZone":"America/Toronto"},"customfield_12310290":null,"aggregateprogress":{"progress":7800,"total":7800,"percent":100},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":7800,"total":7800,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/comment/16397544","id":"16397544","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user troodes opened a pull request:\n\n    https://github.com/apache/zookeeper/pull/489\n\n    ZOOKEEPER-2989: IPv6 literal address causes problems for Quorum members\n\n    Handle tokenizing of \"address:port\" when address is an IPv6 literal address.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/troodes/zookeeper ZOOKEEPER-2989\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/489.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #489\n    \n----\ncommit 9e31f3448b6d5a950ea70ae715f26a8a0ca456d0\nAuthor: Rick Trudeau <rick.trudeau@...>\nDate:   2018-03-13T19:41:43Z\n\n    ZOOKEEPER-2989: IPv6 literal address causes problems for Quorum members\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-03-13T19:48:58.691+0000","updated":"2018-03-13T19:48:58.691+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/comment/16417128","id":"16417128","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user maoling commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/489\n  \n    @troodes  can we move on ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-03-28T10:11:16.305+0000","updated":"2018-03-28T10:11:16.305+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/comment/16490492","id":"16490492","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1755//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1755//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1755//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2018-05-25T09:53:11.826+0000","updated":"2018-05-25T09:53:11.826+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/comment/16491499","id":"16491499","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1758//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1758//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1758//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2018-05-26T04:02:24.536+0000","updated":"2018-05-26T04:02:24.536+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2989/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":13,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/worklog/104186","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user phunt commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/489\n  \n    Can someone else take this on? Also it would be good to have some IPv6 tests included as well.\n","created":"2018-05-21T18:34:21.717+0000","updated":"2018-05-21T18:34:21.717+0000","started":"2018-05-21T18:34:21.717+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"104186","issueId":"13141901"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/worklog/105074","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user maoling commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/489\n  \n    @phunt \r\n    I will pick it up if @troodes feel free or no reaction within three days\n","created":"2018-05-23T11:53:22.570+0000","updated":"2018-05-23T11:53:22.570+0000","started":"2018-05-23T11:53:22.570+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"105074","issueId":"13141901"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/worklog/105089","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user troodes commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/489\n  \n    Yes thanks @maoling , greatly appreciated.\n","created":"2018-05-23T13:06:33.179+0000","updated":"2018-05-23T13:06:33.179+0000","started":"2018-05-23T13:06:33.179+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"105089","issueId":"13141901"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/worklog/105857","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user maoling opened a pull request:\n\n    https://github.com/apache/zookeeper/pull/533\n\n    ZOOKEEPER-2989:IPv6 literal address causes problems for Quorum members\n\n    More details in [ZOOKEEPER-2989]( https://issues.apache.org/jira/browse/ZOOKEEPER-2989)\r\n    Thanks for the old [PR-489](https://github.com/apache/zookeeper/pull/489)'s work\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/maoling/zookeeper ZOOKEEPER-2989\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/533.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #533\n    \n----\ncommit 622932941658a92a1948989f5baabb5dda6fb574\nAuthor: maoling <maoling199210191@...>\nDate:   2018-03-30T11:09:16Z\n\n    ZOOKEEPER-2989:IPv6 literal address causes problems for Quorum members\n\n----\n","created":"2018-05-25T09:36:13.239+0000","updated":"2018-05-25T09:36:13.239+0000","started":"2018-05-25T09:36:13.239+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"105857","issueId":"13141901"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/worklog/106113","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user maoling closed the pull request at:\n\n    https://github.com/apache/zookeeper/pull/533\n","created":"2018-05-26T03:40:22.846+0000","updated":"2018-05-26T03:40:22.846+0000","started":"2018-05-26T03:40:22.845+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"106113","issueId":"13141901"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/worklog/106115","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user maoling reopened a pull request:\n\n    https://github.com/apache/zookeeper/pull/533\n\n    ZOOKEEPER-2989:IPv6 literal address causes problems for Quorum members\n\n    More details in [ZOOKEEPER-2989]( https://issues.apache.org/jira/browse/ZOOKEEPER-2989)\r\n    Thanks for the old [PR-489](https://github.com/apache/zookeeper/pull/489)'s work\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/maoling/zookeeper ZOOKEEPER-2989\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/533.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #533\n    \n----\ncommit 622932941658a92a1948989f5baabb5dda6fb574\nAuthor: maoling <maoling199210191@...>\nDate:   2018-03-30T11:09:16Z\n\n    ZOOKEEPER-2989:IPv6 literal address causes problems for Quorum members\n\n----\n","created":"2018-05-26T03:43:19.812+0000","updated":"2018-05-26T03:43:19.812+0000","started":"2018-05-26T03:43:19.811+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"106115","issueId":"13141901"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/worklog/107082","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user maoling commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/533\n  \n    @anmolnar  **InitialMessage** is a inner-class of **QuorumCnxManager**. Is it necessary to a separate test file?\r\n    @phunt  @hanm What's your opinion? \n","created":"2018-05-30T09:34:09.559+0000","updated":"2018-05-30T09:34:09.559+0000","started":"2018-05-30T09:34:09.559+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"107082","issueId":"13141901"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/worklog/108489","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user nkalmar commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/533\n  \n    I agree with @anmolnar in that the methods are a little robust and test multiple things. Whether it should be refactored whenever we touch a unit test, that's a tough question. \r\n    \r\n    But I also agree with what @maoling  said about the inner class: generally, unit tests should not be separated when dealing with inner classes, as they only makes sense in the context of the outer class.\r\n    \r\n    Anyway, the change looks good to me! \n","created":"2018-06-04T10:11:56.610+0000","updated":"2018-06-04T10:11:56.610+0000","started":"2018-06-04T10:11:56.609+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"108489","issueId":"13141901"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/worklog/110393","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user lvfangmin commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/489#discussion_r194216407\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/quorum/QuorumCnxManager.java ---\n    @@ -222,15 +222,15 @@ static public InitialMessage parse(Long protocolVersion, DataInputStream din)\n                             num_read, remaining, sid);\n                 }\n     \n    -            // FIXME: IPv6 is not supported. Using something like Guava's HostAndPort\n    -            //        parser would be good.\n                 String addr = new String(b);\n    -            String[] host_port = addr.split(\":\");\n    -\n    -            if (host_port.length != 2) {\n    -                throw new InitialMessageException(\"Badly formed address: %s\", addr);\n    +            int pos = addr.lastIndexOf(\":\");\n    +           \n    +            if (pos == -1 || pos + 1  == (addr.length() )) {\n    --- End diff --\n    \n    I think the better way to do this is updating the initiateConnection function to pass in IPv6 literal address \"[%s]:%s\", and here we can use QuorumPeer.splitWithLeadingHostname to check and get IPv6 host and port.\n","created":"2018-06-09T06:18:02.589+0000","updated":"2018-06-09T06:18:02.589+0000","started":"2018-06-09T06:18:02.588+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"110393","issueId":"13141901"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/worklog/110458","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user maoling commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/489#discussion_r194247374\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/quorum/QuorumCnxManager.java ---\n    @@ -222,15 +222,15 @@ static public InitialMessage parse(Long protocolVersion, DataInputStream din)\n                             num_read, remaining, sid);\n                 }\n     \n    -            // FIXME: IPv6 is not supported. Using something like Guava's HostAndPort\n    -            //        parser would be good.\n                 String addr = new String(b);\n    -            String[] host_port = addr.split(\":\");\n    -\n    -            if (host_port.length != 2) {\n    -                throw new InitialMessageException(\"Badly formed address: %s\", addr);\n    +            int pos = addr.lastIndexOf(\":\");\n    +           \n    +            if (pos == -1 || pos + 1  == (addr.length() )) {\n    --- End diff --\n    \n    1. \"I think the better way to do this is updating the initiateConnection function to pass in IPv6 literal address \"[%s]:%s\" -----pardon me.I don't get your idea.\r\n    2.\"here we can use QuorumPeer.splitWithLeadingHostname to check and get IPv6 host and port.\"-----IMHO,we should have a common class in the org.apache.zookeeper.server.util package which just like (HostAndPort#getHostAndPortFromBracketedHost)[https://github.com/google/guava/blob/master/guava/src/com/google/common/net/HostAndPort.java] does,then QuorumPeer.splitWithLeadingHostname , QuorumCnxManager.InitialMessage.parse and others can reuse it.\n","created":"2018-06-10T06:47:16.610+0000","updated":"2018-06-10T06:47:16.610+0000","started":"2018-06-10T06:47:16.609+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"110458","issueId":"13141901"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/worklog/110460","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user maoling commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/533#discussion_r194247586\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/quorum/QuorumCnxManager.java ---\n    @@ -222,15 +222,15 @@ static public InitialMessage parse(Long protocolVersion, DataInputStream din)\n                             num_read, remaining, sid);\n                 }\n     \n    -            // FIXME: IPv6 is not supported. Using something like Guava's HostAndPort\n    -            //        parser would be good.\n                 String addr = new String(b);\n    -            String[] host_port = addr.split(\":\");\n    -\n    -            if (host_port.length != 2) {\n    -                throw new InitialMessageException(\"Badly formed address: %s\", addr);\n    +            int pos = addr.lastIndexOf(\":\");\n    +           \n    --- End diff --\n    \n    - look at this [SO](https://stackoverflow.com/questions/2345063/java-common-way-to-validate-and-convert-hostport-to-inetsocketaddress),I'm afraid something like `[2001:db8:85a3::8a2e:370:7334]:80` will fail\r\n    - I will test this patch in the real IPv6 production ENV in case of something I miss.\r\n\n","created":"2018-06-10T06:54:07.204+0000","updated":"2018-06-10T06:54:07.204+0000","started":"2018-06-10T06:54:07.203+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"110460","issueId":"13141901"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/worklog/112690","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user lvfangmin commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/489#discussion_r195968969\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/quorum/QuorumCnxManager.java ---\n    @@ -222,15 +222,15 @@ static public InitialMessage parse(Long protocolVersion, DataInputStream din)\n                             num_read, remaining, sid);\n                 }\n     \n    -            // FIXME: IPv6 is not supported. Using something like Guava's HostAndPort\n    -            //        parser would be good.\n                 String addr = new String(b);\n    -            String[] host_port = addr.split(\":\");\n    -\n    -            if (host_port.length != 2) {\n    -                throw new InitialMessageException(\"Badly formed address: %s\", addr);\n    +            int pos = addr.lastIndexOf(\":\");\n    +           \n    +            if (pos == -1 || pos + 1  == (addr.length() )) {\n    --- End diff --\n    \n    @maoling I was suggesting to change the ip address format passed in from din to be [xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx]:xxxx instead of the one without '[]', and reuse the splitWithLeadingHostname code.\n","created":"2018-06-18T05:44:05.033+0000","updated":"2018-06-18T05:44:05.033+0000","started":"2018-06-18T05:44:05.033+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"112690","issueId":"13141901"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13141901/worklog/122150","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user maoling closed the pull request at:\n\n    https://github.com/apache/zookeeper/pull/533\n","created":"2018-07-12T03:41:30.529+0000","updated":"2018-07-12T03:41:30.529+0000","started":"2018-07-12T03:41:30.529+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"122150","issueId":"13141901"}]},"customfield_12311820":"0|i3qrfr:"}}