{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13132316","self":"https://issues.apache.org/jira/rest/api/2/issue/13132316","key":"ZOOKEEPER-2969","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Jan 20 00:02:51 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2969/watchers","watchCount":1,"isWatching":false},"created":"2018-01-19T23:38:40.032+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12331981","id":"12331981","description":"Alpha release against 3.5 branch","name":"3.5.2","archived":false,"released":true,"releaseDate":"2016-07-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335444","id":"12335444","description":"Beta release against 3.5 branch","name":"3.5.3","archived":false,"released":true,"releaseDate":"2017-04-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326518","id":"12326518","name":"3.6.0","archived":false,"released":false}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-01-20T00:02:51.304+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"I have two zhandle_ts connected to two different ZK ensembles. Differentiating between log messages of the two is quite difficult, as the callback only gives you the message, with no reasonable way to grab connection that created it (the address of the handle is in the log message, but parsing this value seems rather error-prone). It would be nice if the log callback gave me the handle.\r\n  \r\n\r\nI attached a patch for a potential fix...it adds a few functions without breaking backwards compatibility:\r\n\r\n \r\n\r\n{{typedef void (*log_callback_ext_fn)(const zhandle_t *zh,}}\r\n {{    const void *log_context, ZooLogLevel level, const char *message);}}\r\n\r\n{{ZOOAPI void zoo_get_log_callback_ext(const zhandle_t *zh,}}\r\n {{    log_callback_ext_fn *callback, const void **context);}}\r\n\r\n{{ZOOAPI void zoo_set_log_callback_ext(zhandle_t *zh,}}\r\n {{    log_callback_ext_fn callback, const void *context);}}\r\n\r\n{{ZOOAPI zhandle_t *zookeeper_init3(const char *host, watcher_fn fn,}}\r\n {{  int recv_timeout, const clientid_t *clientid, void *context, int flags,}}\r\n {{  log_callback_ext_fn log_callback, const void *log_callback_context);}}\r\n\r\n \r\n\r\nThe fallback ordering is changed to: log_callback_ext_fn -> log_callback_fn -> global stream.\r\n\r\nLet me know if this is completely crazy.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12906905","id":"12906905","filename":"c_log_callback_ext.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tgockel","name":"tgockel","key":"tgockel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tgockel&avatarId=32592","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tgockel&avatarId=32592","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tgockel&avatarId=32592","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tgockel&avatarId=32592"},"displayName":"Travis Gockel","active":true,"timeZone":"America/Denver"},"created":"2018-01-19T23:28:29.681+0000","size":60353,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12906905/c_log_callback_ext.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"C API Log Callback Lacks Context","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tgockel","name":"tgockel","key":"tgockel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tgockel&avatarId=32592","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tgockel&avatarId=32592","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tgockel&avatarId=32592","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tgockel&avatarId=32592"},"displayName":"Travis Gockel","active":true,"timeZone":"America/Denver"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tgockel","name":"tgockel","key":"tgockel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tgockel&avatarId=32592","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tgockel&avatarId=32592","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tgockel&avatarId=32592","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tgockel&avatarId=32592"},"displayName":"Travis Gockel","active":true,"timeZone":"America/Denver"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13132316/comment/16333032","id":"16333032","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tgockel","name":"tgockel","key":"tgockel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tgockel&avatarId=32592","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tgockel&avatarId=32592","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tgockel&avatarId=32592","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tgockel&avatarId=32592"},"displayName":"Travis Gockel","active":true,"timeZone":"America/Denver"},"body":"Might also be worth noting I uploaded the change to GitHub https://github.com/tgockel/zookeeper/tree/ZOOKEEPER-2969/c-log-callback-ext","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tgockel","name":"tgockel","key":"tgockel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tgockel&avatarId=32592","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tgockel&avatarId=32592","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tgockel&avatarId=32592","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tgockel&avatarId=32592"},"displayName":"Travis Gockel","active":true,"timeZone":"America/Denver"},"created":"2018-01-20T00:02:51.304+0000","updated":"2018-01-20T00:02:51.304+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2969/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3p4zj:"}}