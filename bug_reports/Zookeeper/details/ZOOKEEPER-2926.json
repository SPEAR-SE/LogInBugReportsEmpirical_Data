{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13112727","self":"https://issues.apache.org/jira/rest/api/2/issue/13112727","key":"ZOOKEEPER-2926","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":11400,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326518","id":"12326518","name":"3.6.0","archived":false,"released":false}],"aggregatetimespent":11400,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2018-01-09T20:24:52.799+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Aug 08 07:22:15 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_24555528185_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-08-08T04:21:56.682+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2926/watchers","watchCount":6,"isWatching":false},"created":"2017-10-27T23:23:08.524+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":["pull-request-available"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335444","id":"12335444","description":"Beta release against 3.5 branch","name":"3.5.3","archived":false,"released":true,"releaseDate":"2017-04-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326518","id":"12326518","name":"3.6.0","archived":false,"released":false}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lvfangmin","name":"lvfangmin","key":"lvfangmin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lvfangmin&avatarId=24660","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lvfangmin&avatarId=24660","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lvfangmin&avatarId=24660","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lvfangmin&avatarId=24660"},"displayName":"Fangmin Lv","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-08-08T07:22:15.177+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"The local session upgrading feature will upgrade the session locally before receving a quorum commit of creating global session. It's possible that the server shutdown before the creating session request being sent to leader, if we retained the ZKDatabase or there is Snapshot happened just before shutdown, then only this server will have the global session. \r\n\r\nIf that server didn't become leader, then it will have more global sessions than others, and those global sessions won't expire as the leader doesn't know it's existence. If the server became leader, it will accept the client renew session request and the client is allowed to create ephemeral nodes, which means other servers only have ephemeral nodes but not that global session. If there is follower going to have SNAP sync with it, then it will also have the global session. If the server without that global session becomes new leader, it will check and delete those dangling ephemeral node before serving traffic. These could introduce the issues that the ephemeral node being exist on some servers but not others. \r\n\r\nThere is dangling global session issue even without local session feature, because on leader it will update the ZKDatabase when processing ConnectionRequest and in the PrepRequestProcessor before it's quorum committed, which also has this risk.","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"3h 10m","remainingEstimateSeconds":0,"timeSpentSeconds":11400},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Data inconsistency issue due to the flaw in the session management","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lvfangmin","name":"lvfangmin","key":"lvfangmin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lvfangmin&avatarId=24660","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lvfangmin&avatarId=24660","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lvfangmin&avatarId=24660","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lvfangmin&avatarId=24660"},"displayName":"Fangmin Lv","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lvfangmin","name":"lvfangmin","key":"lvfangmin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lvfangmin&avatarId=24660","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lvfangmin&avatarId=24660","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lvfangmin&avatarId=24660","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lvfangmin&avatarId=24660"},"displayName":"Fangmin Lv","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":11400,"total":11400,"percent":100},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":11400,"total":11400,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16319086","id":"16319086","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user lvfangmin opened a pull request:\n\n    https://github.com/apache/zookeeper/pull/447\n\n    [ZOOKEEPER-2926] Fix potential data consistency issue due to the session management bug\n\n    \n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/lvfangmin/zookeeper ZOOKEEPER-2926\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/447.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #447\n    \n----\ncommit 04ec15841c5d164f1212eea9cdfd02e10aa4478e\nAuthor: Fangmin Lyu <allenlyu@...>\nDate:   2018-01-09T06:58:32Z\n\n    fix potential data consistency issue due to global session added too early\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-09T20:24:52.799+0000","updated":"2018-01-09T20:24:52.799+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16319101","id":"16319101","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 26 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1403//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1403//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1403//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-09T20:41:24.407+0000","updated":"2018-01-09T20:41:24.407+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16322340","id":"16322340","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r160972325\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java ---\n    @@ -1187,13 +1187,8 @@ private ProcessTxnResult processTxn(Request request, TxnHeader hdr,\n             if (opCode == OpCode.createSession) {\n                 if (hdr != null && txn instanceof CreateSessionTxn) {\n                     CreateSessionTxn cst = (CreateSessionTxn) txn;\n    -                sessionTracker.addGlobalSession(sessionId, cst.getTimeOut());\n    -            } else if (request != null && request.isLocalSession()) {\n    -                request.request.rewind();\n    -                int timeout = request.request.getInt();\n    -                request.request.rewind();\n    -                sessionTracker.addSession(request.sessionId, timeout);\n    -            } else {\n    +                sessionTracker.commitSession(sessionId, cst.getTimeOut());\n    +            } else if (request == null || !request.isLocalSession()) {\n    --- End diff --\n    \n    Do you need this check here?\r\n    Basically you removed the part of requesting localSession creation, because it has already happened in PrepRequestProcessor and it's safe to leave the default 'else' handler as it was.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-11T14:39:55.104+0000","updated":"2018-01-11T14:39:55.104+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16322341","id":"16322341","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r160970304\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java ---\n    @@ -579,13 +579,8 @@ protected void pRequest2Txn(int type, long zxid, Request request,\n                     int to = request.request.getInt();\n                     request.setTxn(new CreateSessionTxn(to));\n                     request.request.rewind();\n    -                if (request.isLocalSession()) {\n    -                    // This will add to local session tracker if it is enabled\n    -                    zks.sessionTracker.addSession(request.sessionId, to);\n    -                } else {\n    -                    // Explicitly add to global session if the flag is not set\n    -                    zks.sessionTracker.addGlobalSession(request.sessionId, to);\n    -                }\n    +                // only add the global session tracker but not to ZKDb\n    +                zks.sessionTracker.addGlobalSession(request.sessionId, to);\n    --- End diff --\n    \n    You could remove this check safely, because effectively there was no difference between `addSession()` and `addGlobalSession()` calls.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-11T14:39:55.192+0000","updated":"2018-01-11T14:39:55.192+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16322342","id":"16322342","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r160971106\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/SessionTrackerImpl.java ---\n    @@ -280,6 +278,12 @@ public synchronized boolean addSession(long id, int sessionTimeout) {\n             return added;\n         }\n     \n    +    public synchronized boolean commitSession(long id, int sessionTimeout) {\n    --- End diff --\n    \n    `sessionsWithTimeout` is a Map within ZKdb, so adding sessions to it is equivalent to persisting them.\r\n    \r\n    I think you could also remove the `addGlobalSession()` method completely, because it doesn't do anything special than forwarding the call to `addSession()`.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-11T14:39:55.199+0000","updated":"2018-01-11T14:39:55.199+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16322343","id":"16322343","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r160976160\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/quorum/LearnerSessionTracker.java ---\n    @@ -102,32 +101,42 @@ public boolean isGlobalSession(long sessionId) {\n         }\n     \n         public boolean addGlobalSession(long sessionId, int sessionTimeout) {\n    +        // no global session tracker, do nothing\n    +        return false;\n    --- End diff --\n    \n    Is it possible to throw UnsupportedOperationException instead?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-11T14:39:55.201+0000","updated":"2018-01-11T14:39:55.201+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16324395","id":"16324395","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user lvfangmin commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r161296493\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java ---\n    @@ -579,13 +579,8 @@ protected void pRequest2Txn(int type, long zxid, Request request,\n                     int to = request.request.getInt();\n                     request.setTxn(new CreateSessionTxn(to));\n                     request.request.rewind();\n    -                if (request.isLocalSession()) {\n    -                    // This will add to local session tracker if it is enabled\n    -                    zks.sessionTracker.addSession(request.sessionId, to);\n    -                } else {\n    -                    // Explicitly add to global session if the flag is not set\n    -                    zks.sessionTracker.addGlobalSession(request.sessionId, to);\n    -                }\n    +                // only add the global session tracker but not to ZKDb\n    +                zks.sessionTracker.addGlobalSession(request.sessionId, to);\n    --- End diff --\n    \n    On LeaderSessionTracker, we need to differentiate add local session or global session, but since we only call createSession when add local session, I think I can simplify the interface more by removing addGlobalSession and rename addSession to trackSession.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-12T19:01:51.874+0000","updated":"2018-01-12T19:01:51.874+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16324396","id":"16324396","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user lvfangmin commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r161300774\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java ---\n    @@ -1187,13 +1187,8 @@ private ProcessTxnResult processTxn(Request request, TxnHeader hdr,\n             if (opCode == OpCode.createSession) {\n                 if (hdr != null && txn instanceof CreateSessionTxn) {\n                     CreateSessionTxn cst = (CreateSessionTxn) txn;\n    -                sessionTracker.addGlobalSession(sessionId, cst.getTimeOut());\n    -            } else if (request != null && request.isLocalSession()) {\n    -                request.request.rewind();\n    -                int timeout = request.request.getInt();\n    -                request.request.rewind();\n    -                sessionTracker.addSession(request.sessionId, timeout);\n    -            } else {\n    +                sessionTracker.commitSession(sessionId, cst.getTimeOut());\n    +            } else if (request == null || !request.isLocalSession()) {\n    --- End diff --\n    \n    Local session creation is happened in ZooKeeperServer when the when processing connection request, PrepRequestProcessor only deals with the global sessions.\r\n    \r\n    Local session creation will also send a createSession op into the processor pipeline, so if we remove the else check, a lot of warning log will show for local session createSession op, that's not what we wanted.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-12T19:01:51.896+0000","updated":"2018-01-12T19:01:51.896+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16324397","id":"16324397","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user lvfangmin commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r161296695\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/SessionTrackerImpl.java ---\n    @@ -280,6 +278,12 @@ public synchronized boolean addSession(long id, int sessionTimeout) {\n             return added;\n         }\n     \n    +    public synchronized boolean commitSession(long id, int sessionTimeout) {\n    --- End diff --\n    \n    Yes, that's kind of commit changes to ZkDB, like the usual txns commit to DataTree in ZkDB.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-12T19:01:52.000+0000","updated":"2018-01-12T19:01:52.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16324478","id":"16324478","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 26 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1411//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1411//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1411//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-12T19:57:50.615+0000","updated":"2018-01-12T19:57:50.615+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16324503","id":"16324503","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user anmolnar commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/447\n  \n    @lvfangmin Have you amended your commit?\r\n    I see a lot of changes since I last reviewed this PR.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-12T20:11:03.631+0000","updated":"2018-01-12T20:11:03.631+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16324707","id":"16324707","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user lvfangmin commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/447\n  \n    @anmolnar I changed the code based on your comments and did amend, is this the right process?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-12T23:09:17.786+0000","updated":"2018-01-12T23:09:17.786+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16325703","id":"16325703","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user anmolnar commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/447\n  \n    @lvfangmin Got it. Recently we talked about why multiple commits are better for review over squashing. Now I see why.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-14T18:14:38.534+0000","updated":"2018-01-14T18:14:38.534+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16325706","id":"16325706","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r161405611\n  \n    --- Diff: src/java/test/org/apache/zookeeper/test/SessionTrackerCheckTest.java ---\n    @@ -185,8 +182,8 @@ public void testLeaderSessionTracker() throws Exception {\n                     TICK_TIME, expirer.sid, false, testZKSListener());\n     \n             // Global session\n    -        sessionId = 0xdeadbeef;\n    -        tracker.addSession(sessionId, CONNECTION_TIMEOUT);\n    +        sessionId = 0xdeadbef0;\n    --- End diff --\n    \n    Why have you changed this? :)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-14T18:16:11.873+0000","updated":"2018-01-14T18:16:11.873+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16327596","id":"16327596","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user lvfangmin commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r161855408\n  \n    --- Diff: src/java/test/org/apache/zookeeper/test/SessionTrackerCheckTest.java ---\n    @@ -185,8 +182,8 @@ public void testLeaderSessionTracker() throws Exception {\n                     TICK_TIME, expirer.sid, false, testZKSListener());\n     \n             // Global session\n    -        sessionId = 0xdeadbeef;\n    -        tracker.addSession(sessionId, CONNECTION_TIMEOUT);\n    +        sessionId = 0xdeadbef0;\n    --- End diff --\n    \n    I think this is not changed by intention, might happen when merge patch, I'll get this fixed.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-16T19:05:08.676+0000","updated":"2018-01-16T19:05:08.676+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16327601","id":"16327601","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user lvfangmin commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/447\n  \n    @anmolnar I also find it's hard to track when using overwriting the commit, I'll use stack instead.\r\n    \r\n    For the tests, I need to inject some failure in the Quorum being set up, that's why I need the customized way I'm doing in my code, I think I prefer to create a separate test class.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-16T19:07:06.392+0000","updated":"2018-01-16T19:07:06.392+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16550299","id":"16550299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 20 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1974//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1974//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1974//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-20T06:47:59.485+0000","updated":"2018-07-20T06:47:59.485+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16572657","id":"16572657","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"Issue resolved by pull request 447\n[https://github.com/apache/zookeeper/pull/447]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2018-08-08T04:21:56.699+0000","updated":"2018-08-08T04:21:56.699+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/comment/16572791","id":"16572791","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Jenkins build ZooKeeper-trunk #143 (See [https://builds.apache.org/job/ZooKeeper-trunk/143/])\nZOOKEEPER-2926: Fix potential data consistency issue due to the session (hanm: rev cd209456b67cde5aba771b1a240ebe5607398459)\n* (edit) src/java/test/org/apache/zookeeper/test/ClientBase.java\n* (edit) src/java/main/org/apache/zookeeper/server/SessionTrackerImpl.java\n* (edit) src/java/test/org/apache/zookeeper/server/MockServerCnxn.java\n* (edit) src/java/main/org/apache/zookeeper/server/SessionTracker.java\n* (edit) src/java/main/org/apache/zookeeper/server/quorum/LearnerSessionTracker.java\n* (edit) src/java/test/org/apache/zookeeper/server/PrepRequestProcessorTest.java\n* (add) src/java/test/org/apache/zookeeper/server/quorum/SessionUpgradeQuorumTest.java\n* (edit) src/java/test/org/apache/zookeeper/test/QuorumBase.java\n* (edit) src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java\n* (edit) src/java/test/org/apache/zookeeper/server/SessionTrackerTest.java\n* (edit) src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java\n* (edit) src/java/test/org/apache/zookeeper/test/SessionTrackerCheckTest.java\n* (edit) src/java/main/org/apache/zookeeper/server/quorum/LocalSessionTracker.java\n* (edit) src/java/main/org/apache/zookeeper/server/ServerCnxn.java\n* (edit) src/java/main/org/apache/zookeeper/server/quorum/LeaderSessionTracker.java\n* (edit) src/java/main/org/apache/zookeeper/server/quorum/UpgradeableSessionTracker.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2018-08-08T07:22:15.177+0000","updated":"2018-08-08T07:22:15.177+0000"}],"maxResults":19,"total":19,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2926/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":30,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/125353","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user lvfangmin commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/447\n  \n    @anmolnar do you have time to revisit the code here?\n","created":"2018-07-20T06:27:45.705+0000","updated":"2018-07-20T06:27:45.705+0000","started":"2018-07-20T06:27:45.704+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"125353","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/125677","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user hanm commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/447\n  \n    I'll give it a review; I missed the original JIRA. \n","created":"2018-07-20T23:00:30.392+0000","updated":"2018-07-20T23:00:30.392+0000","started":"2018-07-20T23:00:30.392+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"125677","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/127126","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user lvfangmin commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/447\n  \n    Thanks @anmolnar for review.\r\n    \r\n    @hanm please take a look when you have time.\n","created":"2018-07-25T07:13:39.336+0000","updated":"2018-07-25T07:13:39.336+0000","started":"2018-07-25T07:13:39.335+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"127126","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/127661","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205340787\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/SessionTracker.java ---\n    @@ -47,21 +47,20 @@\n         long createSession(int sessionTimeout);\n     \n         /**\n    -     * Add a global session to those being tracked.\n    +     * Track the session expire, not add to ZkDb.\n          * @param id sessionId\n          * @param to sessionTimeout\n          * @return whether the session was newly added (if false, already existed)\n          */\n    -    boolean addGlobalSession(long id, int to);\n    +    boolean trackSession(long id, int to);\n     \n         /**\n    -     * Add a session to those being tracked. The session is added as a local\n    -     * session if they are enabled, otherwise as global.\n    +     * Add the session to the under layer storage.\n          * @param id sessionId\n          * @param to sessionTimeout\n          * @return whether the session was newly added (if false, already existed)\n    --- End diff --\n    \n    Similarly it'll be great if the comment on the return value here is updated.\n","created":"2018-07-26T06:12:11.035+0000","updated":"2018-07-26T06:12:11.035+0000","started":"2018-07-26T06:12:11.034+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"127661","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/127662","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205331482\n  \n    --- Diff: src/java/test/org/apache/zookeeper/test/QuorumBase.java ---\n    @@ -53,32 +53,32 @@\n         protected int port3;\n         protected int port4;\n         protected int port5;\n    -    \n    +\n         protected int portLE1;\n         protected int portLE2;\n         protected int portLE3;\n         protected int portLE4;\n         protected int portLE5;\n    -    \n    +\n         protected int portClient1;\n         protected int portClient2;\n         protected int portClient3;\n         protected int portClient4;\n         protected int portClient5;\n     \n    -    protected boolean localSessionsEnabled = false;\n    -    protected boolean localSessionsUpgradingEnabled = false;\n    +    public boolean localSessionsEnabled = false;\n    +    public boolean localSessionsUpgradingEnabled = false;\n    --- End diff --\n    \n    Not sure why this change is required. \n","created":"2018-07-26T06:12:11.044+0000","updated":"2018-07-26T06:12:11.044+0000","started":"2018-07-26T06:12:11.043+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"127662","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/127663","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205332227\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/quorum/UpgradeableSessionTracker.java ---\n    @@ -19,6 +19,8 @@\n     \n     import java.util.concurrent.ConcurrentHashMap;\n     import java.util.concurrent.ConcurrentMap;\n    +import java.util.Set;\n    +import java.util.HashSet;\n    --- End diff --\n    \n    Are both imports needed? I don't see any new data structure introduced. \n","created":"2018-07-26T06:12:11.048+0000","updated":"2018-07-26T06:12:11.048+0000","started":"2018-07-26T06:12:11.047+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"127663","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/127664","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205339992\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/SessionTracker.java ---\n    @@ -47,21 +47,20 @@\n         long createSession(int sessionTimeout);\n     \n         /**\n    -     * Add a global session to those being tracked.\n    +     * Track the session expire, not add to ZkDb.\n          * @param id sessionId\n          * @param to sessionTimeout\n          * @return whether the session was newly added (if false, already existed)\n    --- End diff --\n    \n    This comment should be updated now with the function name change.\n","created":"2018-07-26T06:12:11.065+0000","updated":"2018-07-26T06:12:11.065+0000","started":"2018-07-26T06:12:11.065+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"127664","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/127665","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205331145\n  \n    --- Diff: src/java/test/org/apache/zookeeper/test/ClientBase.java ---\n    @@ -72,7 +72,7 @@\n         static final File BASETEST =\n             new File(System.getProperty(\"build.test.dir\", \"build\"));\n     \n    -    protected String hostPort = \"127.0.0.1:\" + PortAssignment.unique();\n    +    public String hostPort = \"127.0.0.1:\" + PortAssignment.unique();\n    --- End diff --\n    \n    I am not sure why this change is required. \n","created":"2018-07-26T06:12:11.068+0000","updated":"2018-07-26T06:12:11.068+0000","started":"2018-07-26T06:12:11.067+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"127665","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/127666","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205340493\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/SessionTracker.java ---\n    @@ -47,21 +47,20 @@\n         long createSession(int sessionTimeout);\n     \n         /**\n    -     * Add a global session to those being tracked.\n    +     * Track the session expire, not add to ZkDb.\n          * @param id sessionId\n          * @param to sessionTimeout\n          * @return whether the session was newly added (if false, already existed)\n          */\n    -    boolean addGlobalSession(long id, int to);\n    +    boolean trackSession(long id, int to);\n     \n         /**\n    -     * Add a session to those being tracked. The session is added as a local\n    -     * session if they are enabled, otherwise as global.\n    +     * Add the session to the under layer storage.\n    --- End diff --\n    \n    I think the comment here is a little bit confusing. `commitSession`itself does not directly add session to storage, it's the snapshot that does this. I think the comment should mention that this function will add the session to the zkDB, this also maps to the `trackSession` comment (which does not modify zkDB.). It would be great if a reader can instantly get what `commit` means here by just reading the comment.\n","created":"2018-07-26T06:12:11.072+0000","updated":"2018-07-26T06:12:11.072+0000","started":"2018-07-26T06:12:11.071+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"127666","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/127982","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205636796\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/quorum/LearnerSessionTracker.java ---\n    @@ -101,33 +100,44 @@ public boolean isGlobalSession(long sessionId) {\n             return globalSessionsWithTimeouts.containsKey(sessionId);\n         }\n     \n    -    public boolean addGlobalSession(long sessionId, int sessionTimeout) {\n    +    public boolean trackSession(long sessionId, int sessionTimeout) {\n    +        // Learner doesn't track global session, do nothing here\n    +        return false;\n    +    }\n    +\n    +    /**\n    +     * Synchronized on this to avoid race condition of adding a local session\n    +     * after committed global session, which may cause the same session being\n    +     * tracked on this server and leader.\n    +     */\n    +    public synchronized boolean commitSession(\n    +            long sessionId, int sessionTimeout) {\n             boolean added =\n                 globalSessionsWithTimeouts.put(sessionId, sessionTimeout) == null;\n    -        if (localSessionsEnabled && added) {\n    +\n    +        if (added) {\n                 // Only do extra logging so we know what kind of session this is\n                 // if we're supporting both kinds of sessions\n    -            LOG.info(\"Adding global session 0x\" + Long.toHexString(sessionId));\n    +            LOG.info(\"Committing global session 0x\" + Long.toHexString(sessionId));\n             }\n    -        touchTable.get().put(sessionId, sessionTimeout);\n    -        return added;\n    -    }\n     \n    -    public boolean addSession(long sessionId, int sessionTimeout) {\n    --- End diff --\n    \n    Here a similar question as asked in `LeaderSessionTracker`: with this being removed how would `LearnerSessionTracker` track a local session? The `trackSession` here as commented, just return false and I don't see any way of adding a local session to `LearnerSessionTracker`.\n","created":"2018-07-27T00:08:49.200+0000","updated":"2018-07-27T00:08:49.200+0000","started":"2018-07-27T00:08:49.200+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"127982","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/127981","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205629046\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/quorum/LeaderSessionTracker.java ---\n    @@ -85,31 +85,43 @@ public boolean isGlobalSession(long sessionId) {\n             return globalSessionTracker.isTrackingSession(sessionId);\n         }\n     \n    -    public boolean addGlobalSession(long sessionId, int sessionTimeout) {\n    -        boolean added =\n    -            globalSessionTracker.addSession(sessionId, sessionTimeout);\n    -        if (localSessionsEnabled && added) {\n    +    public boolean trackSession(long sessionId, int sessionTimeout) {\n    +        boolean tracked =\n    +            globalSessionTracker.trackSession(sessionId, sessionTimeout);\n    +        if (localSessionsEnabled && tracked) {\n                 // Only do extra logging so we know what kind of session this is\n                 // if we're supporting both kinds of sessions\n    -            LOG.info(\"Adding global session 0x\" + Long.toHexString(sessionId));\n    +            LOG.info(\"Tracking global session 0x\" + Long.toHexString(sessionId));\n             }\n    -        return added;\n    +        return tracked;\n         }\n     \n    -    public boolean addSession(long sessionId, int sessionTimeout) {\n    -        boolean added;\n    -        if (localSessionsEnabled && !isGlobalSession(sessionId)) {\n    -            added = localSessionTracker.addSession(sessionId, sessionTimeout);\n    --- End diff --\n    \n    With this being removed, how would a `LeaderSessionTracker` now add (or track, with the new term) a new local session (when local session is enabled on Leader server)? The `LeaderSessionTracker.trackSession` does not track local session.\n","created":"2018-07-27T00:08:49.200+0000","updated":"2018-07-27T00:08:49.200+0000","started":"2018-07-27T00:08:49.200+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"127981","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/127983","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205630231\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/SessionTrackerImpl.java ---\n    @@ -280,6 +275,11 @@ public synchronized boolean addSession(long id, int sessionTimeout) {\n             return added;\n         }\n     \n    +    public synchronized boolean commitSession(long id, int sessionTimeout) {\n    +        sessionsWithTimeout.put(id, sessionTimeout);\n    +        return true;\n    --- End diff --\n    \n    Should we make this `void commitSession` given this always returns true?\n","created":"2018-07-27T00:08:49.204+0000","updated":"2018-07-27T00:08:49.204+0000","started":"2018-07-27T00:08:49.203+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"127983","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/127984","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205636550\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/SessionTracker.java ---\n    @@ -47,21 +47,20 @@\n         long createSession(int sessionTimeout);\n     \n         /**\n    -     * Add a global session to those being tracked.\n    +     * Track the session expire, not add to ZkDb.\n          * @param id sessionId\n          * @param to sessionTimeout\n          * @return whether the session was newly added (if false, already existed)\n          */\n    -    boolean addGlobalSession(long id, int to);\n    +    boolean trackSession(long id, int to);\n    --- End diff --\n    \n    Is `trackSession` now only tracking global sessions? \n","created":"2018-07-27T00:08:49.278+0000","updated":"2018-07-27T00:08:49.278+0000","started":"2018-07-27T00:08:49.278+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"127984","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/128347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user lvfangmin commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205921085\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/quorum/UpgradeableSessionTracker.java ---\n    @@ -19,6 +19,8 @@\n     \n     import java.util.concurrent.ConcurrentHashMap;\n     import java.util.concurrent.ConcurrentMap;\n    +import java.util.Set;\n    +import java.util.HashSet;\n    --- End diff --\n    \n    Yes, dangling import after implementation change, will remove. \n","created":"2018-07-27T23:42:13.081+0000","updated":"2018-07-27T23:42:13.081+0000","started":"2018-07-27T23:42:13.081+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"128347","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/128348","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user lvfangmin commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205921489\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/SessionTracker.java ---\n    @@ -47,21 +47,20 @@\n         long createSession(int sessionTimeout);\n     \n         /**\n    -     * Add a global session to those being tracked.\n    +     * Track the session expire, not add to ZkDb.\n          * @param id sessionId\n          * @param to sessionTimeout\n          * @return whether the session was newly added (if false, already existed)\n          */\n    -    boolean addGlobalSession(long id, int to);\n    +    boolean trackSession(long id, int to);\n     \n         /**\n    -     * Add a session to those being tracked. The session is added as a local\n    -     * session if they are enabled, otherwise as global.\n    +     * Add the session to the under layer storage.\n    --- End diff --\n    \n    In LocalSessionTracker, commitSession is used to update the in memory local session map, which is not in zkDB. How about change it to:\r\n    \r\n    \"Add the session to the local session map or global one in zkDB.\"\n","created":"2018-07-27T23:42:13.082+0000","updated":"2018-07-27T23:42:13.082+0000","started":"2018-07-27T23:42:13.082+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"128348","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/128349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user lvfangmin commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205921331\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/SessionTracker.java ---\n    @@ -47,21 +47,20 @@\n         long createSession(int sessionTimeout);\n     \n         /**\n    -     * Add a global session to those being tracked.\n    +     * Track the session expire, not add to ZkDb.\n          * @param id sessionId\n          * @param to sessionTimeout\n          * @return whether the session was newly added (if false, already existed)\n          */\n    -    boolean addGlobalSession(long id, int to);\n    +    boolean trackSession(long id, int to);\n    --- End diff --\n    \n    Local session tracker will start track session when create the session.\n","created":"2018-07-27T23:42:13.084+0000","updated":"2018-07-27T23:42:13.084+0000","started":"2018-07-27T23:42:13.084+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"128349","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/128350","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user lvfangmin commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205920948\n  \n    --- Diff: src/java/test/org/apache/zookeeper/test/QuorumBase.java ---\n    @@ -53,32 +53,32 @@\n         protected int port3;\n         protected int port4;\n         protected int port5;\n    -    \n    +\n         protected int portLE1;\n         protected int portLE2;\n         protected int portLE3;\n         protected int portLE4;\n         protected int portLE5;\n    -    \n    +\n         protected int portClient1;\n         protected int portClient2;\n         protected int portClient3;\n         protected int portClient4;\n         protected int portClient5;\n     \n    -    protected boolean localSessionsEnabled = false;\n    -    protected boolean localSessionsUpgradingEnabled = false;\n    +    public boolean localSessionsEnabled = false;\n    +    public boolean localSessionsUpgradingEnabled = false;\n    --- End diff --\n    \n    Same reason, will check and remove it if it's not required.\n","created":"2018-07-27T23:42:13.085+0000","updated":"2018-07-27T23:42:13.085+0000","started":"2018-07-27T23:42:13.085+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"128350","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/128351","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user lvfangmin commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205920893\n  \n    --- Diff: src/java/test/org/apache/zookeeper/test/ClientBase.java ---\n    @@ -72,7 +72,7 @@\n         static final File BASETEST =\n             new File(System.getProperty(\"build.test.dir\", \"build\"));\n     \n    -    protected String hostPort = \"127.0.0.1:\" + PortAssignment.unique();\n    +    public String hostPort = \"127.0.0.1:\" + PortAssignment.unique();\n    --- End diff --\n    \n    Was trying to change these settings to public so I can reference it in the SessionUpgradeQuorumTest.java, I guess I find a different way to to that and forgot to revert this change, will verify and remove this change if it's not necessary.\n","created":"2018-07-27T23:42:13.117+0000","updated":"2018-07-27T23:42:13.117+0000","started":"2018-07-27T23:42:13.116+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"128351","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/128352","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user lvfangmin commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205922234\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/quorum/LeaderSessionTracker.java ---\n    @@ -85,31 +85,43 @@ public boolean isGlobalSession(long sessionId) {\n             return globalSessionTracker.isTrackingSession(sessionId);\n         }\n     \n    -    public boolean addGlobalSession(long sessionId, int sessionTimeout) {\n    -        boolean added =\n    -            globalSessionTracker.addSession(sessionId, sessionTimeout);\n    -        if (localSessionsEnabled && added) {\n    +    public boolean trackSession(long sessionId, int sessionTimeout) {\n    +        boolean tracked =\n    +            globalSessionTracker.trackSession(sessionId, sessionTimeout);\n    +        if (localSessionsEnabled && tracked) {\n                 // Only do extra logging so we know what kind of session this is\n                 // if we're supporting both kinds of sessions\n    -            LOG.info(\"Adding global session 0x\" + Long.toHexString(sessionId));\n    +            LOG.info(\"Tracking global session 0x\" + Long.toHexString(sessionId));\n             }\n    -        return added;\n    +        return tracked;\n         }\n     \n    -    public boolean addSession(long sessionId, int sessionTimeout) {\n    -        boolean added;\n    -        if (localSessionsEnabled && !isGlobalSession(sessionId)) {\n    -            added = localSessionTracker.addSession(sessionId, sessionTimeout);\n    --- End diff --\n    \n    When local session feature is enabled, the createSession method in ZooKeeperServer will create, track and 'commit' (update the local session in memory map) the local session immediately.\n","created":"2018-07-27T23:42:13.118+0000","updated":"2018-07-27T23:42:13.118+0000","started":"2018-07-27T23:42:13.117+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"128352","issueId":"13112727"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13112727/worklog/128354","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user lvfangmin commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/447#discussion_r205922455\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/SessionTrackerImpl.java ---\n    @@ -280,6 +275,11 @@ public synchronized boolean addSession(long id, int sessionTimeout) {\n             return added;\n         }\n     \n    +    public synchronized boolean commitSession(long id, int sessionTimeout) {\n    +        sessionsWithTimeout.put(id, sessionTimeout);\n    +        return true;\n    --- End diff --\n    \n    The LeaderSessionTracker.commitSession will return whether it has successfully added the new session.\n","created":"2018-07-27T23:45:03.072+0000","updated":"2018-07-27T23:45:03.072+0000","started":"2018-07-27T23:45:03.071+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"128354","issueId":"13112727"}]},"customfield_12311820":"0|i3ltdr:"}}