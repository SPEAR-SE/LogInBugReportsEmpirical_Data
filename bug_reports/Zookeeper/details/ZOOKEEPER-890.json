{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12476748","self":"https://issues.apache.org/jira/rest/api/2/issue/12476748","key":"ZOOKEEPER-890","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2010-10-07T22:34:51.111+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Oct 13 17:11:33 UTC 2010","customfield_12310420":"214199","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_551867747_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-10-13T17:11:33.436+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-890/watchers","watchCount":0,"isWatching":false},"created":"2010-10-07T07:53:45.689+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314846","id":"12314846","description":"Fix release against 3.3 branch","name":"3.3.1","archived":false,"released":true,"releaseDate":"2010-05-17"}],"issuelinks":[{"id":"12334245","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12334245","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12476669","key":"ZOOKEEPER-888","self":"https://issues.apache.org/jira/rest/api/2/issue/12476669","fields":{"summary":"c-client / zkpython: Double free corruption on node watcher","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-10-13T17:11:33.419+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312380","id":"12312380","name":"c client","description":"The c client interface to ZooKeeper"}],"timeoriginalestimate":null,"description":"Code using the C client assumes that watcher callbacks are called exactly once. If the watcher is called more than once, the process will likely overwrite freed memory and/or crash.\n\ncollect_session_watchers (zk_hashtable.c) gathers watchers from active_node_watchers, active_exist_watchers, and active_child_watchers without removing them. This results in watchers being invoked more than once.\n\nTest code is attached that reproduces the bug, along with a proposed patch.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12456576","id":"12456576","filename":"watcher_twice.c","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=austin","name":"austin","key":"austin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Austin Shoemaker","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-07T07:54:04.063+0000","size":1474,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12456576/watcher_twice.c"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12456577","id":"12456577","filename":"ZOOKEEPER-890.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=austin","name":"austin","key":"austin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Austin Shoemaker","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-07T07:58:36.758+0000","size":611,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12456577/ZOOKEEPER-890.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"32824","customfield_12312823":null,"summary":"C client invokes watcher callbacks multiple times","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=austin","name":"austin","key":"austin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Austin Shoemaker","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=austin","name":"austin","key":"austin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Austin Shoemaker","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Mac OS X 10.6.5","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12476748/comment/12918815","id":"12918815","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=austin","name":"austin","key":"austin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Austin Shoemaker","active":true,"timeZone":"Etc/UTC"},"body":"Patch that clears active watcher sets when broadcasting a session event to all watchers.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=austin","name":"austin","key":"austin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Austin Shoemaker","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-07T07:58:36.831+0000","updated":"2010-10-07T07:58:36.831+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12476748/comment/12919087","id":"12919087","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaredc","name":"jaredc","key":"jaredc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jared Cantwell","active":true,"timeZone":"Etc/UTC"},"body":"I don't believe the C-client makes the guarantee that \"watcher callbacks are called exactly once.\"  Callbacks are called for different reasons, including:\n\n- connection lost event\n- connection reestablished event\n- session lost event\n- data changed event\n\nOnly the last two events make the guarantee about being called exactly once, but the first two connection events can be called numerous times until either one of the last two events happens.  I may be missing some events, but that's the general idea.  Bottom line is the callback can receive events of type ZOO_SESSION_EVENT multiple times.  I believe this was by design.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jaredc","name":"jaredc","key":"jaredc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jared Cantwell","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-07T22:34:51.111+0000","updated":"2010-10-07T22:34:51.111+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12476748/comment/12919094","id":"12919094","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=austin","name":"austin","key":"austin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Austin Shoemaker","active":true,"timeZone":"Etc/UTC"},"body":"That sounds like a good design. Perhaps it could be clarified in the documentation?\nhttp://hadoop.apache.org/zookeeper/docs/r3.3.1/zookeeperProgrammers.html#ch_zkWatches\n\nIf this is correct behavior then the Python client needs to be fixed to not delete the watcher on session events. Will file a separate bug on that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=austin","name":"austin","key":"austin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Austin Shoemaker","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-07T22:56:08.262+0000","updated":"2010-10-07T22:56:08.262+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12476748/comment/12920619","id":"12920619","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Should this issue be closed then? (also sounds like 2 other issues should be opened which were detailed in the comments - docs and python)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-10-13T15:57:08.064+0000","updated":"2010-10-13T15:57:08.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12476748/comment/12920662","id":"12920662","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=austin","name":"austin","key":"austin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Austin Shoemaker","active":true,"timeZone":"Etc/UTC"},"body":"Closing, C client works as intended. Submitted a patch in ZOOKEEPER-888 to handle this properly in zkpython.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=austin","name":"austin","key":"austin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Austin Shoemaker","active":true,"timeZone":"Etc/UTC"},"created":"2010-10-13T17:11:33.400+0000","updated":"2010-10-13T17:11:33.400+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-890/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i05zc7:"}}