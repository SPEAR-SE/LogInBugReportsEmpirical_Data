{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12921944","self":"https://issues.apache.org/jira/rest/api/2/issue/12921944","key":"ZOOKEEPER-2343","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326786","id":"12326786","description":"Alpha release against 3.5 branch","name":"3.5.1","archived":false,"released":true,"releaseDate":"2015-09-02"}],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-12-16T03:41:08.899+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Nov 30 09:27:11 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2343/watchers","watchCount":5,"isWatching":false},"created":"2015-12-15T11:06:54.148+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":"dynamic reconfiguration","customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326786","id":"12326786","description":"Alpha release against 3.5 branch","name":"3.5.1","archived":false,"released":true,"releaseDate":"2015-09-02"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-11-30T09:27:11.540+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312379","id":"12312379","name":"quorum","description":"Quorum determination for ZooKeeper"}],"timeoriginalestimate":null,"description":"I'd like to setup 3-nodes zookeeper cluster with version 3.5.1. Because the network model of kubernetes is that pod and service has different ip address.  In order to deploy it into kubernetes, I have to make zookeeper pods itself to be 0.0.0.0, so it can be started correctly. the configuration as below:\n\nzk1: zoo.cfg\n\n    standaloneEnabled=false\n    dynamicConfigFile=/opt/zookeeper/conf/zoo.cfg.dynamic\n\nzoo.cfg.dynamic\n\n    server.1=0.0.0.0:2888:3888:participant;2181\n    server.2=10.62.56.192:2888:3888:participant;2181\n    server.3=10.62.56.193:2888:3888:participant;2181\n\nzk2: zoo.cfg\n\n    standaloneEnabled=false\n    dynamicConfigFile=/opt/zookeeper/conf/zoo.cfg.dynamic\n\nzoo.cfg.dynamic\n\n    server.1=10.62.56.191:2888:3888:participant;2181\n    server.2=0.0.0.0:2888:3888:participant;2181\n    server.3=10.62.56.193:2888:3888:participant;2181\n\nzk3: zoo.cfg\n\n    standaloneEnabled=false\n    dynamicConfigFile=/opt/zookeeper/conf/zoo.cfg.dynamic\n\nzoo.cfg.dynamic\n\n   server.1=10.62.56.191:2888:3888:participant;2181\n   server.2=10.62.56.192:2888:3888:participant;2181\n   server.3=0.0.0.0:2888:3888:participant;218\n\nThe result is that:\n1. Looks like the election is successful. a new dynamic file is generated in every node:/opt/zookeeper/conf/zoo.cfg.dynamic.100000000\nlike below\nserver.1=10.62.56.191:2888:3888:participant;0.0.0.0:2181\nserver.2=0.0.0.0:2888:3888:participant;0.0.0.0:2181\nserver.3=10.62.56.193:2888:3888:participant;0.0.0.0:2181\n\n2. But the cluster doesn't really work, I saw the errors:\n\n0:0:2181)(secure=disabled):Learner@273] - Unexpected exception, tries=3, remaining init limit=16997, connecting to /0.0.0.0:2888\njava.net.ConnectException: Connection refused\n        at java.net.PlainSocketImpl.socketConnect(Native Method)\n        at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)\n        at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:204)\n        at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)\n        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\n        at java.net.Socket.connect(Socket.java:589)\n        at org.apache.zookeeper.server.quorum.Learner.sockConnect(Learner.java:227)\n        at org.apache.zookeeper.server.quorum.Learner.connectToLeader(Learner.java:256)\n        at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:74)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:1064)\n2015-12-15 04:35:00,403 [myid:1] - INFO  \n2015-12-15 04:35:00,585 [myid:1] - INFO  [QuorumPeer[myid=1](plain=/0:0:0:0:0:0:0:0:2181)(secure=disabled):Follower@198] - shutdown called\njava.lang.Exception: shutdown Follower\n        at org.apache.zookeeper.server.quorum.Follower.shutdown(Follower.java:198)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:1068)\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Zookeeper 3.5.1 failed to deploy into the kubernetes","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cheyang","name":"cheyang","key":"cheyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"cheyang","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cheyang","name":"cheyang","key":"cheyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"cheyang","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"CentOS Linux release 7.1.1503 (Core)\nopenjdk version \"1.8.0_65\"\nOpenJDK Runtime Environment (build 1.8.0_65-b17)\nOpenJDK 64-Bit Server VM (build 25.65-b01, mixed mode)\nzookeeper: 3.5.1-alpha-1693007","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10431","value":"Important","id":"10431"}],"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12921944/comment/15059445","id":"15059445","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=suda","name":"suda","key":"suda","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akihiro Suda","active":true,"timeZone":"Asia/Tokyo"},"body":"0.0.0.0 cannot be used as a destination IP address.\nSo I think it is not a bug. \n(Although validating such an address is effective improvement.)\n\n\nPerhaps it makes sense to use hostnames instead of IP addresses.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=suda","name":"suda","key":"suda","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akihiro Suda","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-12-16T03:41:08.899+0000","updated":"2015-12-16T03:41:08.899+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12921944/comment/15061644","id":"15061644","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cheyang","name":"cheyang","key":"cheyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"cheyang","active":true,"timeZone":"Etc/UTC"},"body":"0.0.0.0 can work in 3.4.6, that's why zookeeper 3.4.6 can work fine in kubernetes.\nsee this\n\nhttps://github.com/fabric8io/fabric8-zookeeper-docker/blob/master/config-and-run.sh\n\n if [ \"$SERVER_ID\" = \"$i\" ];then\n      echo \"server.$i=0.0.0.0:2888:3888\" >> /opt/zookeeper/conf/zoo.cfg\n    else\n      echo \"server.$i=zookeeper-$i:2888:3888\" >> /opt/zookeeper/conf/zoo.cfg\n    fi\n\nEven using hostname can't be acceptable in kubernetes, because Pod and service's hostname can't be the same.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cheyang","name":"cheyang","key":"cheyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"cheyang","active":true,"timeZone":"Etc/UTC"},"created":"2015-12-17T07:15:34.057+0000","updated":"2015-12-17T07:15:34.057+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12921944/comment/15159761","id":"15159761","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=crook42","name":"crook42","key":"crook42","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bill Crook","active":true,"timeZone":"Etc/UTC"},"body":"In docker, the magic sauce for me was to use externally addressable ip addresses in zoo.cfg.dynamic, then set {{quorumListenOnAllIPs=true}} in zoo.cfg.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=crook42","name":"crook42","key":"crook42","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bill Crook","active":true,"timeZone":"Etc/UTC"},"created":"2016-02-23T22:14:54.602+0000","updated":"2016-02-23T22:14:54.602+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12921944/comment/15211383","id":"15211383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"There's a good post on these issues from Tim Crowder ( [~timrc] ?)\nhttp://timmahnator.tumblr.com/post/115073121775/zoo-keepers-and-dock-workers","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-03-25T03:49:29.126+0000","updated":"2016-03-25T03:49:29.126+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12921944/comment/16265331","id":"16265331","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jchipmunk","name":"jchipmunk","key":"jchipmunk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jchipmunk&avatarId=31759","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jchipmunk&avatarId=31759","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jchipmunk&avatarId=31759","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jchipmunk&avatarId=31759"},"displayName":"Andrey Pustovetov","active":true,"timeZone":"Etc/UTC"},"body":"I tested the same configuration using ZooKeeper 3.5.4-beta-SNAPSHOT and the problem is not reproduced. \r\nZOOKEEPER-2819 introduced new behavior for {{reconfigEnabled}} flag and it allows to resolve your issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jchipmunk","name":"jchipmunk","key":"jchipmunk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jchipmunk&avatarId=31759","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jchipmunk&avatarId=31759","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jchipmunk&avatarId=31759","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jchipmunk&avatarId=31759"},"displayName":"Andrey Pustovetov","active":true,"timeZone":"Etc/UTC"},"created":"2017-11-24T14:29:43.508+0000","updated":"2017-11-24T14:29:43.508+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12921944/comment/16272428","id":"16272428","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christopher-johnson","name":"christopher-johnson","key":"christopher-johnson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christopher Johnson","active":true,"timeZone":"Etc/UTC"},"body":"I have just tested this with 3.6.0-SNAPSHOT and I can confirm that it works.  However, with 3 replicas, (on deployment in gcloud Kubernetes Engine), the first server pod to start will report \"This ZooKeeper instance is not currently serving requests\", but the second and third instance are able to create the quorum.  When the first instance is deleted, on recreation it can join the quorum and subsequently serve requests.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christopher-johnson","name":"christopher-johnson","key":"christopher-johnson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christopher Johnson","active":true,"timeZone":"Etc/UTC"},"created":"2017-11-30T09:27:11.540+0000","updated":"2017-11-30T09:27:11.540+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2343/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2pwlr:"}}