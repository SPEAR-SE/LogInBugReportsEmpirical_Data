{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12708364","self":"https://issues.apache.org/jira/rest/api/2/issue/12708364","key":"ZOOKEEPER-1912","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2014-04-15T09:15:27.044+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Feb 06 20:27:46 UTC 2016","customfield_12310420":"386687","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_57311918203_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2016-02-07T04:13:28.802+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1912/watchers","watchCount":4,"isWatching":false},"created":"2014-04-14T20:14:50.817+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323310","id":"12323310","description":"Fix release against 3.4 branch","name":"3.4.6","archived":false,"released":true,"releaseDate":"2014-03-10"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-02-07T04:13:29.009+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312378","id":"12312378","name":"leaderElection","description":"Leader election algorithm for ZooKeeper"}],"timeoriginalestimate":null,"description":"In 3-node cluster, when there are 2 nodes die and reboot during leader election, it might lead to the case that there are 2 leaders happen in the system. Eventually, a leader that does not has follower supports and quit being leader, but it makes us lose some availability.\n\nI am building a tools that can reorder messages and disk write, and also inject node crash to the system and found this bug.\nThese are the step of events that my tools execute in sequence that lead to 2 leaders at the end.\nMy zookeeper nodes have id = 0,1,2\n\npacketsend from=0 to=1 state=0 leader=0 zxid=0 electionEpoch=1 peerEpoch=0\npacketsend from=0 to=2 state=0 leader=0 zxid=0 electionEpoch=1 peerEpoch=0\npacketsend from=2 to=0 state=0 leader=2 zxid=0 electionEpoch=1 peerEpoch=0\npacketsend from=2 to=1 state=0 leader=2 zxid=0 electionEpoch=1 peerEpoch=0\npacketsend from=1 to=0 state=0 leader=1 zxid=0 electionEpoch=1 peerEpoch=0\npacketsend from=1 to=2 state=0 leader=1 zxid=0 electionEpoch=1 peerEpoch=0\npacketsend from=1 to=0 state=0 leader=2 zxid=0 electionEpoch=1 peerEpoch=0\npacketsend from=0 to=1 state=0 leader=2 zxid=0 electionEpoch=1 peerEpoch=0\npacketsend from=1 to=2 state=0 leader=2 zxid=0 electionEpoch=1 peerEpoch=0\npacketsend from=0 to=2 state=0 leader=2 zxid=0 electionEpoch=1 peerEpoch=0\ndiskwrite nodeId=0 write=currentEpoch\nnodecrash id=0\nnodecrash id=1\nnodestart id=0\nnodestart id=1\ndiskwrite nodeId=2 write=currentEpoch\npacketsend from=2 to=0 state=0 leader=2 zxid=0 electionEpoch=1 peerEpoch=0\npacketsend from=0 to=2 state=0 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=2 to=1 state=0 leader=2 zxid=0 electionEpoch=1 peerEpoch=0\npacketsend from=0 to=1 state=0 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=1 to=0 state=0 leader=1 zxid=0 electionEpoch=1 peerEpoch=0\npacketsend from=1 to=2 state=0 leader=1 zxid=0 electionEpoch=1 peerEpoch=0\npacketsend from=2 to=0 state=2 leader=2 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=1 to=0 state=0 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=2 to=1 state=2 leader=2 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=1 to=2 state=0 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=2 to=1 state=2 leader=2 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=1 to=0 state=0 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=1 to=2 state=0 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=0 to=1 state=2 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=2 to=1 state=2 leader=2 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=1 to=0 state=0 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=1 to=2 state=0 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=0 to=1 state=2 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=2 to=1 state=2 leader=2 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=1 to=0 state=0 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=1 to=2 state=0 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=0 to=1 state=2 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=2 to=0 state=0 leader=2 zxid=0 electionEpoch=2 peerEpoch=1\npacketsend from=2 to=1 state=0 leader=2 zxid=0 electionEpoch=2 peerEpoch=1\npacketsend from=0 to=2 state=2 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=2 to=0 state=0 leader=2 zxid=0 electionEpoch=2 peerEpoch=1\npacketsend from=1 to=0 state=0 leader=2 zxid=0 electionEpoch=2 peerEpoch=1\npacketsend from=1 to=2 state=0 leader=2 zxid=0 electionEpoch=2 peerEpoch=1\npacketsend from=2 to=1 state=0 leader=2 zxid=0 electionEpoch=2 peerEpoch=1\npacketsend from=0 to=2 state=2 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=2 to=0 state=0 leader=2 zxid=0 electionEpoch=2 peerEpoch=1\npacketsend from=0 to=1 state=2 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\npacketsend from=2 to=1 state=0 leader=2 zxid=0 electionEpoch=2 peerEpoch=1\npacketsend from=0 to=2 state=2 leader=0 zxid=0 electionEpoch=1 peerEpoch=1\ndiskwrite nodeId=2 write=currentEpoch\ndiskwrite nodeId=1 write=currentEpoch","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12640133","id":"12640133","filename":"conf.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tanakorn","name":"tanakorn","key":"tanakorn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tanakorn Leesatapornwongsa","active":true,"timeZone":"America/Chicago"},"created":"2014-04-14T20:16:38.042+0000","size":883,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12640133/conf.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12640134","id":"12640134","filename":"log.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tanakorn","name":"tanakorn","key":"tanakorn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tanakorn Leesatapornwongsa","active":true,"timeZone":"America/Chicago"},"created":"2014-04-14T20:16:38.048+0000","size":15176,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12640134/log.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"386951","customfield_12312823":null,"summary":"Leader election lets 2 leaders happen","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tanakorn","name":"tanakorn","key":"tanakorn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tanakorn Leesatapornwongsa","active":true,"timeZone":"America/Chicago"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tanakorn","name":"tanakorn","key":"tanakorn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tanakorn Leesatapornwongsa","active":true,"timeZone":"America/Chicago"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Ubuntu 12.04, OpenJDK 1.6","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12708364/comment/13968784","id":"13968784","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tanakorn","name":"tanakorn","key":"tanakorn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tanakorn Leesatapornwongsa","active":true,"timeZone":"America/Chicago"},"body":"Attach log files and config files","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tanakorn","name":"tanakorn","key":"tanakorn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tanakorn Leesatapornwongsa","active":true,"timeZone":"America/Chicago"},"created":"2014-04-14T20:16:38.051+0000","updated":"2014-04-14T20:16:38.051+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12708364/comment/13969360","id":"13969360","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Thanks for reporting this. Having two servers thinking they could be leaders is not really a bug. It is a bug if we have two servers leading and both having quorums of supporters concurrently, which your case doesn't seem to imply.\n\nIf you can find a way of reducing the amount of time we have concurrent leaders, then fine with me, but in my experience it doesn't happen often.\n\nYour tool sounds like a cool one!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2014-04-15T09:15:27.044+0000","updated":"2014-04-15T09:15:27.044+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12708364/comment/15135992","id":"15135992","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"[~fpj] can we close this one based on your feedback?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-02-06T20:27:46.847+0000","updated":"2016-02-06T20:27:46.847+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1912/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1um47:"}}