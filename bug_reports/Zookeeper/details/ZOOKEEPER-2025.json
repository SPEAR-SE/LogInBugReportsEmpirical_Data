{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12737906","self":"https://issues.apache.org/jira/rest/api/2/issue/12737906","key":"ZOOKEEPER-2025","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-08-30T00:14:35.463+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Oct 16 17:40:22 UTC 2014","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2025/watchers","watchCount":7,"isWatching":false},"created":"2014-08-29T20:21:33.877+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321883","id":"12321883","description":"Fix release against 3.4 branch","name":"3.4.5","archived":false,"released":true,"releaseDate":"2012-11-18"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-10-16T17:40:22.387+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312380","id":"12312380","name":"c client","description":"The c client interface to ZooKeeper"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"Description will be included in an attached PDF.\n\nThe two main questions we have are:\n1: What would be the cause of the \"Unreasonable Length\" error in our context, and how might we prevent it from occurring?\n2: What can we do to prevent the reconnection storm that led to the cluster becoming unresponsive?\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12665405","id":"12665405","filename":"zookeeper_issues.pdf","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tyree731","name":"tyree731","key":"tyree731","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Tyree","active":true,"timeZone":"America/New_York"},"created":"2014-08-29T20:22:22.320+0000","size":464811,"mimeType":"application/pdf","content":"https://issues.apache.org/jira/secure/attachment/12665405/zookeeper_issues.pdf"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Single-node ejection caused apparent reconnection storm, leading to cluster unresponsiveness","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tyree731","name":"tyree731","key":"tyree731","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Tyree","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tyree731","name":"tyree731","key":"tyree731","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Tyree","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12737906/comment/14115758","id":"14115758","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tyree731","name":"tyree731","key":"tyree731","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Tyree","active":true,"timeZone":"America/New_York"},"body":"Attached PDF describing the issues we observed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tyree731","name":"tyree731","key":"tyree731","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Tyree","active":true,"timeZone":"America/New_York"},"created":"2014-08-29T20:22:22.324+0000","updated":"2014-08-29T20:22:22.324+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12737906/comment/14116086","id":"14116086","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"Regarding the \"unreasonable length\", is it related to ZOOKEEPER-1513?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-30T00:14:35.463+0000","updated":"2014-08-30T00:14:35.463+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12737906/comment/14116504","id":"14116504","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tyree731","name":"tyree731","key":"tyree731","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Tyree","active":true,"timeZone":"America/New_York"},"body":"The error message is the same, but stack trace is very different. In https://issues.apache.org/jira/browse/ZOOKEEPER-1513, the stack trace appears to be during initialization, whereas in the stack trace we observed, it is during normal operation, presumably when a follower is forwarding a write to the leader. I'm not expert in the code though, so I could be misreading that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tyree731","name":"tyree731","key":"tyree731","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Tyree","active":true,"timeZone":"America/New_York"},"created":"2014-08-30T18:11:21.755+0000","updated":"2014-08-30T18:11:21.755+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12737906/comment/14119793","id":"14119793","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I wish everyone had reports like that when they create a jira. :-) \n\nLet me have a look at it...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2014-09-03T12:10:11.531+0000","updated":"2014-09-03T12:10:11.531+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12737906/comment/14120292","id":"14120292","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mkrysiak","name":"mkrysiak","key":"mkrysiak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Krysiak","active":true,"timeZone":"Etc/UTC"},"body":"While attempting to reproduce a connection storm with different zk clients (so the client behavior isn't exactly the same as in the original report), I straced the \"NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181\" thread, and noticed that time between accept() calls increased as the number of sockets to read() and write() to increased.  It would be in the milliseconds to even hundreds of milliseconds range, and on average I would see 20-40 accept() calls per second.  This was a short sample though, so I need to do more extensive testing, but at that rate, it would make sense why we see the accept queue filling and experiencing ListenOverflows along with syn cookies.\n\nI'm still trying to understand why socket and file descriptor usage skyrocketed to the 64,000 ulimit when there were very few ESTABLISHED connections.  My current theory is that connections would very rapidly become ESTABLISHED, then the client would timeout on a request, and leave the connection in a CLOSE_WAIT state.  Unfortunately we didn't capture the number of sockets in CLOSE_WAIT during the event, so I can't prove it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mkrysiak","name":"mkrysiak","key":"mkrysiak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Krysiak","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-03T19:22:27.483+0000","updated":"2014-09-03T19:22:27.483+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12737906/comment/14124468","id":"14124468","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsterner","name":"bsterner","key":"bsterner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Sterner","active":true,"timeZone":"Etc/UTC"},"body":"  I am reasonably certain I have identified the state that caused the large number of connection events.\n\n  1) A large packet in follower to leader communication evicted the follower from the cluster, causing a near instant 5,000 connection attempts to the remaining nodes. The large packet cause should be identified, but the resulting loss of a single follower node should be a tolerable event.\n\n  2) Every active client on the remaining nodes is moved into a throttled state by the server. The only operation the server is now interested in is connection events and every client is going to be reconnecting. Outstanding requests is not going to go down and we will not close old connections because doIO() is not being called. We hit over 100k outstanding requests. It is not desirable to 100% client throttling.\n\n  3) Eventually, the server node will be out of file handles and fail. The handling of the \"Too many files\" exception from accept() leads to a rebuild and shuffle of the set of events the server is interested in, but it is very likely that very near the top of the iteration of this set there will be another exception from accept() causing the rebuild and re-shuffle to trigger. It would be more desirable to continue iterating through the set of selected clients in hopes that one of them could close. Otherwise, severe failure is just a matter of time. Particularly in the condition where 100% of clients have been throttled, the set of selected clients will only contain reconnect attempts.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsterner","name":"bsterner","key":"bsterner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Sterner","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-06T13:37:46.537+0000","updated":"2014-09-06T13:37:46.537+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12737906/comment/14132297","id":"14132297","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdunning","name":"tdunning","key":"tdunning","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Dunning","active":true,"timeZone":"America/Los_Angeles"},"body":"Brett,\n\nThat is a pretty interesting scenario.\n\nFlavio,\n\nWhat do you think about that?\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdunning","name":"tdunning","key":"tdunning","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Dunning","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-12T23:28:17.013+0000","updated":"2014-09-12T23:28:17.013+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12737906/comment/14132569","id":"14132569","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~bsterner]. Thanks for sharing the ideas.\n\nOne question regarding 2).\nbq. Outstanding requests is not going to go down and we will not close old connections because doIO() is not being called. \nCould you clarify this?\n\nSo I see this problem has two parts:\n1. Client reconnect happens instantly in a short time. Back-off would be desired.\n2. equal nio.selector seems not proper design in a hind sight. Accepting clients and requests should be separated. And if clients couldn't be accepted any more, a pause would be desired without hindering processing new requests.\n\nWell. Another non-trivial change..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-13T06:24:09.564+0000","updated":"2014-09-13T06:24:09.564+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12737906/comment/14132681","id":"14132681","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsterner","name":"bsterner","key":"bsterner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Sterner","active":true,"timeZone":"Etc/UTC"},"body":"{quote}\nOutstanding requests is not going to go down and we will not close old connections because doIO() is not being called.\n{quote}\n\nUnless I am misunderstanding, after being throttled (interest for OP_READ removed from the SelectionKey), NIOServerCnxnFactory.run() won't select the client connection to call NIOServerCnxn:doIO(). doIO() is where decrementing outstanding requests and closing a connection starts.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bsterner","name":"bsterner","key":"bsterner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Sterner","active":true,"timeZone":"Etc/UTC"},"created":"2014-09-13T12:26:14.400+0000","updated":"2014-09-13T12:26:14.400+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12737906/comment/14133037","id":"14133037","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"body":"I believe that this has been fixed in ZOOKEEPER-1504.\nThis issue is duplicate to ZOOKEEPER-517.\nI have seen this patch in branch-3.5/trunk but not in branch-3.4.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hdeng","name":"hdeng","key":"hdeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongchao Deng","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-14T00:21:40.514+0000","updated":"2014-09-14T00:21:40.514+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12737906/comment/14135510","id":"14135510","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdunning","name":"tdunning","key":"tdunning","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Dunning","active":true,"timeZone":"America/Los_Angeles"},"body":"Hongchao,\n\nI don't see how that really addresses the problems here.  The throttling code is still very naive.  And the complete throttling of clients with no client back off is also not a great solution since there is no source quench under pretty reasonable scenarios.\n\nIt also doesn't address the question of why one server would send an unreasonably large packet to another.\n\nFlavio,\n\nHave you had a chance to look at this?\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdunning","name":"tdunning","key":"tdunning","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Dunning","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-16T14:20:08.718+0000","updated":"2014-09-16T14:20:08.718+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12737906/comment/14174009","id":"14174009","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdunning","name":"tdunning","key":"tdunning","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Dunning","active":true,"timeZone":"America/Los_Angeles"},"body":"\nHas anybody looked at this?\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdunning","name":"tdunning","key":"tdunning","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Dunning","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-10-16T17:40:22.387+0000","updated":"2014-10-16T17:40:22.387+0000"}],"maxResults":12,"total":12,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2025/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1zi5r:"}}