{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12842069","self":"https://issues.apache.org/jira/rest/api/2/issue/12842069","key":"ZOOKEEPER-2226","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2015-07-01 18:22:31.028","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2226/watchers","watchCount":1,"isWatching":false},"created":"2015-07-01T18:22:31.028+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321883","id":"12321883","description":"Fix release against 3.4 branch","name":"3.4.5","archived":false,"released":true,"releaseDate":"2012-11-18"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-07-01T18:22:31.028+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"I have the following code (in curator):\n\n{code}\nint id = extractId(client.create().creatingParentsIfNeeded().withMode(CreateMode.PERSISTENT_SEQUENTIAL).forPath(prefix,\ndata));\n{code}\n\nand\n\n{code}\nclient.create().creatingParentsIfNeeded().withMode(CreateMode.PERSISTENT).forPath(path(id),\ndata);\n{code}\n\nThe first part joins our cluster and gets a id from zookeeper.  The\nsecond call will create a znode that looks like a znode above.\n\nThe reason I do this is that I would like for ops to be able to define\nthe ids when they want and not always have to (other code will\n\"setData\" one of the paths defined above, leaving out since thats not\nhaving issues).\n\nI created a test case and the error thrown was not what I was expecing: Node Exists\n\nHere is the test:\n\ncreate 4 PERSISTENT znodes with ids 1, 2, 3, 4\ncreate 1 PERSISTENT_SEQUENTIAL znode (change id = 4, so conflicts with above)\n\nHere is the error I saw\n\nINFO 2015-07-01 10:46:46,349 [ProcessThread(sid:0 cport:-1):]\n[PrepRequestProcessor] [line 627] Got user-level KeeperException when\nprocessing sessionid:0x14e4aba4d490000 type:create cxid:0x25 zxid:0xe\ntxntype:-1 reqpath:n/a Error\nPath:/test/MembershipTest/replaceFourRegisterOne/member-0000000004\nError:KeeperErrorCode = NodeExists for\n/test/MembershipTest/replaceFourRegisterOne/member-0000000004\n\norg.apache.zookeeper.KeeperException$NodeExistsException:\nKeeperErrorCode = NodeExists for\n/test/MembershipTest/replaceFourRegisterOne/member-\n...\nCaused by: org.apache.zookeeper.KeeperException$NodeExistsException:\nKeeperErrorCode = NodeExists for\n/test/MembershipTest/replaceFourRegisterOne/member-\nat org.apache.zookeeper.KeeperException.create(KeeperException.java:119)\nat org.apache.zookeeper.KeeperException.create(KeeperException.java:51)\nat org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:783)\nat org.apache.curator.framework.imps.CreateBuilderImpl$11.call(CreateBuilderImpl.java:688)\nat org.apache.curator.framework.imps.CreateBuilderImpl$11.call(CreateBuilderImpl.java:672)\nat org.apache.curator.RetryLoop.callWithRetry(RetryLoop.java:107)\nat org.apache.curator.framework.imps.CreateBuilderImpl.pathInForeground(CreateBuilderImpl.java:668)\nat org.apache.curator.framework.imps.CreateBuilderImpl.protectedPathInForeground(CreateBuilderImpl.java:453)\nat org.apache.curator.framework.imps.CreateBuilderImpl.forPath(CreateBuilderImpl.java:443)\nat org.apache.curator.framework.imps.CreateBuilderImpl.forPath(CreateBuilderImpl.java:44)\n\n\nWhen using sequential nodes, its unexpected that they can fail because a node already exists.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Mixing sequential and non-sequential can throw NodeExists for sequential nodes","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dcapwell","name":"dcapwell","key":"dcapwell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Capwell","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dcapwell","name":"dcapwell","key":"dcapwell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Capwell","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2226/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2gr1j:"}}