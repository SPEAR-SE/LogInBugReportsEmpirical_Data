{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12670894","self":"https://issues.apache.org/jira/rest/api/2/issue/12670894","key":"ZOOKEEPER-1768","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326518","id":"12326518","name":"3.6.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12343268","id":"12343268","description":"Beta release against 3.5 branch","name":"3.5.5","archived":false,"released":false}],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-09-27T09:37:41.901+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Nov 13 12:57:37 UTC 2013","customfield_12310420":"350723","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1768/watchers","watchCount":2,"isWatching":false},"created":"2013-09-27T09:19:10.060+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321883","id":"12321883","description":"Fix release against 3.4 branch","name":"3.4.5","archived":false,"released":true,"releaseDate":"2012-11-18"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-05-10T20:09:16.735+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312378","id":"12312378","name":"leaderElection","description":"Leader election algorithm for ZooKeeper"}],"timeoriginalestimate":null,"description":"Hi, \nI have a five nodes cluster versioned 3.4.5 and now i find one node is offline.\nFirstly i restart the node but i find that \"Error contacting service. It is probably not running.\" and i find that the node always elect the leader and always sync the snapshot logs and the device will be full every ten mins. \nso could someone help meï¼Ÿ i will put the log and zoo.cfg in the attachment.\nThanks all.\nyyx,","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12605421","id":"12605421","filename":"zk_debug.log.2013-09-25.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fvn4edal","name":"fvn4edal","key":"fvn4edal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yuxin.yan","active":true,"timeZone":"Etc/UTC"},"created":"2013-09-27T09:20:54.450+0000","size":719958,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12605421/zk_debug.log.2013-09-25.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12605420","id":"12605420","filename":"zoo.cfg","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fvn4edal","name":"fvn4edal","key":"fvn4edal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yuxin.yan","active":true,"timeZone":"Etc/UTC"},"created":"2013-09-27T09:20:54.448+0000","size":1446,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12605420/zoo.cfg"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"351014","customfield_12312823":null,"summary":"Cluster fails election loop until the device is full","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fvn4edal","name":"fvn4edal","key":"fvn4edal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yuxin.yan","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fvn4edal","name":"fvn4edal","key":"fvn4edal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yuxin.yan","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670894/comment/13779794","id":"13779794","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Hi yuxin.yan, I'm not sure I understand this issue. The problem seems to be that you don't have enough disk space for the snapshot, so I'm not sure how we can help. Also, since this is question about the use of zookeeper rather a issue with the code base, it is best if you ask your question on the user mailing list.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2013-09-27T09:37:41.901+0000","updated":"2013-09-27T09:37:41.901+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670894/comment/13781196","id":"13781196","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fvn4edal","name":"fvn4edal","key":"fvn4edal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yuxin.yan","active":true,"timeZone":"Etc/UTC"},"body":"Firstly, thanks for your attention.  May be i haven't explained the problem clearly. The problem is like ZOOKEEPER-1115. I copy the log below:\n2013-09-27 15:18:43,172 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:FileSnap@83] - Reading snapshot /data/zookeeper/version-2/snapshot.200a74d3b\n2013-09-27 15:19:10,358 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:FastLeaderElection@740] - New election. My id =  4, proposed zxid=0x200a74d3b\n2013-09-27 15:19:10,359 - INFO  [WorkerReceiver[myid=4]:FastLeaderElection@542] - Notification: 4 (n.leader), 0x200a74d3b (n.zxid), 0x3 (n.round), LOOKING (n.state), 4 (n.sid), 0x2 (n.peerEPoch), LOOKING (my state)\n2013-09-27 15:19:10,359 - INFO  [WorkerReceiver[myid=4]:FastLeaderElection@542] - Notification: 2 (n.leader), 0x10015588a (n.zxid), 0x2 (n.round), LEADING (n.state), 2 (n.sid), 0x1 (n.peerEPoch), LOOKING (my state)\n2013-09-27 15:19:10,359 - INFO  [WorkerReceiver[myid=4]:FastLeaderElection@542] - Notification: 2 (n.leader), 0x10015588a (n.zxid), 0x2 (n.round), FOLLOWING (n.state), 3 (n.sid), 0x1 (n.peerEPoch), LOOKING (my state)\n2013-09-27 15:19:10,359 - INFO  [WorkerReceiver[myid=4]:FastLeaderElection@542] - Notification: 2 (n.leader), 0x10015588a (n.zxid), 0x2 (n.round), FOLLOWING (n.state), 5 (n.sid), 0x1 (n.peerEPoch), LOOKING (my state)\n2013-09-27 15:19:10,360 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:QuorumPeer@738] - FOLLOWING\n2013-09-27 15:19:10,360 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:ZooKeeperServer@162] - Created server with tickTime 2000 minSessionTimeout 4000 maxSessionTimeout 40000 datadir /data/zookeeper/version-2 snapdir /data/zookeeper/version-2\n2013-09-27 15:19:10,360 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:Follower@63] - FOLLOWING - LEADER ELECTION TOOK - 27191\n2013-09-27 15:19:10,363 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:Learner@322] - Getting a diff from the leader 0x200a74e6d\n2013-09-27 15:19:10,364 - WARN  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:Learner@373] - Got zxid 0x200a74d3c expected 0x1\n2013-09-27 15:19:10,376 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:FileTxnSnapLog@240] - Snapshotting: 0x200a74e6d to /data/zookeeper/version-2/snapshot.200a74e6d\n2013-09-27 15:19:13,935 - INFO  [WorkerReceiver[myid=4]:FastLeaderElection@542] - Notification: 1 (n.leader), 0x200a74d48 (n.zxid), 0x3 (n.round), LOOKING (n.state), 1 (n.sid), 0x2 (n.peerEPoch), FOLLOWING (my state)\n2013-09-27 15:19:35,856 - WARN  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:Follower@89] - Exception when following the leader\njava.io.EOFException\n        at java.io.DataInputStream.readInt(DataInputStream.java:375)\n        at org.apache.jute.BinaryInputArchive.readInt(BinaryInputArchive.java:63)\n        at org.apache.zookeeper.server.quorum.QuorumPacket.deserialize(QuorumPacket.java:83)\n        at org.apache.jute.BinaryInputArchive.readRecord(BinaryInputArchive.java:108)\n        at org.apache.zookeeper.server.quorum.Learner.readPacket(Learner.java:152)\n        at org.apache.zookeeper.server.quorum.Learner.syncWithLeader(Learner.java:366)\n        at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:82)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:740)\n2013-09-27 15:19:35,856 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:Follower@166] - shutdown called\njava.lang.Exception: shutdown Follower\n        at org.apache.zookeeper.server.quorum.Follower.shutdown(Follower.java:166)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:744)\n2013-09-27 15:19:35,857 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:FollowerZooKeeperServer@139] - Shutting down\n2013-09-27 15:19:35,857 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:ZooKeeperServer@419] - shutting down\n2013-09-27 15:19:35,857 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:QuorumPeer@670] - LOOKING\n2013-09-27 15:19:35,861 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:FileSnap@83] - Reading snapshot /data/zookeeper/version-2/snapshot.200a74e6d\n2013-09-27 15:19:42,387 - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxnFactory@197] - Accepted socket connection from /192.168.65.18:35227\n2013-09-27 15:19:42,457 - WARN  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxn@354] - Exception causing close of session 0x0 due to java.io.IOException: ZooKeeperServer not running\n2013-09-27 15:19:42,457 - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxn@1001] - Closed socket connection for client /192.168.65.18:35227 (no session established for client)\n2013-09-27 15:19:55,880 - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxnFactory@197] - Accepted socket connection from /192.168.65.16:39338\n2013-09-27 15:19:55,881 - WARN  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxn@354] - Exception causing close of session 0x0 due to java.io.IOException: ZooKeeperServer not running\n2013-09-27 15:19:55,881 - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxn@1001] - Closed socket connection for client /192.168.65.16:39338 (no session established for client)\n2013-09-27 15:19:57,588 - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxnFactory@197] - Accepted socket connection from /127.0.0.1:53888\n2013-09-27 15:19:57,589 - WARN  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxn@349] - caught end of stream exception\nEndOfStreamException: Unable to read additional data from client sessionid 0x0, likely client has closed socket\n        at org.apache.zookeeper.server.NIOServerCnxn.doIO(NIOServerCnxn.java:220)\n        at org.apache.zookeeper.server.NIOServerCnxnFactory.run(NIOServerCnxnFactory.java:208)\n        at java.lang.Thread.run(Thread.java:662)\n2013-09-27 15:19:57,589 - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxn@1001] - Closed socket connection for client /127.0.0.1:53888 (no session established for client)\n2013-09-27 15:20:02,939 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:FastLeaderElection@740] - New election. My id =  4, proposed zxid=0x200a74e6d\n2013-09-27 15:20:02,939 - INFO  [WorkerReceiver[myid=4]:FastLeaderElection@542] - Notification: 4 (n.leader), 0x200a74e6d (n.zxid), 0x3 (n.round), LOOKING (n.state), 4 (n.sid), 0x2 (n.peerEPoch), LOOKING (my state)\n2013-09-27 15:20:02,940 - INFO  [WorkerReceiver[myid=4]:FastLeaderElection@542] - Notification: 2 (n.leader), 0x10015588a (n.zxid), 0x2 (n.round), LEADING (n.state), 2 (n.sid), 0x1 (n.peerEPoch), LOOKING (my state)\n2013-09-27 15:20:02,940 - INFO  [WorkerReceiver[myid=4]:FastLeaderElection@542] - Notification: 2 (n.leader), 0x10015588a (n.zxid), 0x2 (n.round), FOLLOWING (n.state), 3 (n.sid), 0x1 (n.peerEPoch), LOOKING (my state)\n2013-09-27 15:20:02,940 - INFO  [WorkerReceiver[myid=4]:FastLeaderElection@542] - Notification: 2 (n.leader), 0x10015588a (n.zxid), 0x2 (n.round), FOLLOWING (n.state), 5 (n.sid), 0x1 (n.peerEPoch), LOOKING (my state)\n2013-09-27 15:20:02,940 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:QuorumPeer@738] - FOLLOWING\n2013-09-27 15:20:02,941 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:ZooKeeperServer@162] - Created server with tickTime 2000 minSessionTimeout 4000 maxSessionTimeout 40000 datadir /data/zookeeper/version-2 snapdir /data/zookeeper/version-2\n2013-09-27 15:20:02,941 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:Follower@63] - FOLLOWING - LEADER ELECTION TOOK - 27083\n2013-09-27 15:20:02,944 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:Learner@322] - Getting a diff from the leader 0x200a74f72\n2013-09-27 15:20:02,944 - WARN  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:Learner@373] - Got zxid 0x200a74e6e expected 0x1\n2013-09-27 15:20:02,956 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:FileTxnSnapLog@240] - Snapshotting: 0x200a74f72 to /data/zookeeper/version-2/snapshot.200a74f72\n2013-09-27 15:20:03,366 - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxnFactory@197] - Accepted socket connection from /192.168.65.16:39411\n2013-09-27 15:20:03,367 - WARN  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxn@349] - caught end of stream exception\nEndOfStreamException: Unable to read additional data from client sessionid 0x0, likely client has closed socket\n        at org.apache.zookeeper.server.NIOServerCnxn.doIO(NIOServerCnxn.java:220)\n        at org.apache.zookeeper.server.NIOServerCnxnFactory.run(NIOServerCnxnFactory.java:208)\n        at java.lang.Thread.run(Thread.java:662)\n2013-09-27 15:20:03,367 - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxn@1001] - Closed socket connection for client /192.168.65.16:39411 (no session established for client)\n2013-09-27 15:20:17,792 - INFO  [WorkerReceiver[myid=4]:FastLeaderElection@542] - Notification: 1 (n.leader), 0x200a74e7c (n.zxid), 0x3 (n.round), LOOKING (n.state), 1 (n.sid), 0x2 (n.peerEPoch), FOLLOWING (my state)\n2013-09-27 15:20:28,825 - WARN  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:Follower@89] - Exception when following the leader\njava.io.EOFException\n        at java.io.DataInputStream.readInt(DataInputStream.java:375)\n        at org.apache.jute.BinaryInputArchive.readInt(BinaryInputArchive.java:63)\n        at org.apache.zookeeper.server.quorum.QuorumPacket.deserialize(QuorumPacket.java:83)\n        at org.apache.jute.BinaryInputArchive.readRecord(BinaryInputArchive.java:108)\n        at org.apache.zookeeper.server.quorum.Learner.readPacket(Learner.java:152)\n        at org.apache.zookeeper.server.quorum.Learner.syncWithLeader(Learner.java:366)\n        at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:82)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:740)\n2013-09-27 15:20:28,826 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:Follower@166] - shutdown called\njava.lang.Exception: shutdown Follower\n        at org.apache.zookeeper.server.quorum.Follower.shutdown(Follower.java:166)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:744)\n2013-09-27 15:20:28,826 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:FollowerZooKeeperServer@139] - Shutting down\n2013-09-27 15:20:28,826 - INFO  [QuorumPeer[myid=4]/0:0:0:0:0:0:0:0:2181:ZooKeeperServer@419] - shutting down\n2013-09-27 15:2\n\nThat means the node always elect the leader and sync from the leader, and the number of node 's snapshots gets larger and larger, so the disk space is destined full. So now could you give me any help? Thanks!\nyyx,","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fvn4edal","name":"fvn4edal","key":"fvn4edal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yuxin.yan","active":true,"timeZone":"Etc/UTC"},"created":"2013-09-29T00:48:52.191+0000","updated":"2013-09-29T00:48:52.191+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670894/comment/13791720","id":"13791720","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"[~fpj] something we need to consider for 3.4.6?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-10-10T17:39:05.232+0000","updated":"2013-10-10T17:39:05.232+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670894/comment/13791971","id":"13791971","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"My interpretation of the problem is that syncing is taking too long. The one problem we could consider fixing here, if I understand the issue right, is that we delete the snapshot in the case the follower doesn't complete the sync. The follower seems to be accumulating incomplete snapshots on disk, which eventually makes the disk full.\n\nWe could consider it for 3.4.6, but it doesn't look like a blocker to me. Does anyone disagree?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2013-10-10T20:52:04.843+0000","updated":"2013-10-10T20:52:04.843+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670894/comment/13792184","id":"13792184","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fvn4edal","name":"fvn4edal","key":"fvn4edal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yuxin.yan","active":true,"timeZone":"Etc/UTC"},"body":"Flavio Junqueira, thank you for your explanation. I agree with you. Here is the detail after the node was dead: firstly, i found the disk is full the next day(is it important for my case?), then i just restarted the node, then i found that couse of \"\nautopurge.snapRetainCount=10\nautopurge.purgeInterval=24\n\" configuration in the zoo.cfg, the node removed the other snapshots and transaction logs, then it started failure(\"Error contacting service. It is probably not running.\"), means it always wanted to sync to leader and recreate new snapshots, then the disk was full again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fvn4edal","name":"fvn4edal","key":"fvn4edal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yuxin.yan","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-11T00:54:20.635+0000","updated":"2013-10-11T00:54:20.635+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670894/comment/13792189","id":"13792189","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fvn4edal","name":"fvn4edal","key":"fvn4edal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yuxin.yan","active":true,"timeZone":"Etc/UTC"},"body":"Flavio Junqueira, after you read that, can you give me some advices for this situation, what should i do after the node is dead? thanks :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fvn4edal","name":"fvn4edal","key":"fvn4edal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yuxin.yan","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-11T00:55:58.364+0000","updated":"2013-10-11T00:55:58.364+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670894/comment/13794244","id":"13794244","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"If it is what I think it is, then you need to increase the initLimit. I don't know of a way of changing the initLimit dynamically, though. Also, another problem seems to be that the autopurge feature is removing correct snapshots and leaving partial snapshots on disk. If we can't complete the write of the snapshot, then perhaps we should delete it write after learning it. Given the behavior you're describing, I believe this is not what we are doing. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2013-10-14T16:19:44.296+0000","updated":"2013-10-14T16:19:44.296+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670894/comment/13821283","id":"13821283","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I'm thinking about what to do with this issue. It is not entirely a bug, but the behavior is possibly not desirable. I'm not sure we will have time to fix this for 3.4.6, but we could try. I'll revisit this issue once we have all blockers in.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2013-11-13T12:57:37.103+0000","updated":"2013-11-13T12:57:37.103+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1768/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1ogzr:"}}