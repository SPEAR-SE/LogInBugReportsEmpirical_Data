{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12459532","self":"https://issues.apache.org/jira/rest/api/2/issue/12459532","key":"ZOOKEEPER-713","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2010-03-18T16:23:08.427+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Mar 19 15:49:19 UTC 2010","customfield_12310420":"214158","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_6489325_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-03-18T17:41:28.901+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-713/watchers","watchCount":0,"isWatching":false},"created":"2010-03-18T15:53:19.576+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"12.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314335","id":"12314335","description":"Fix release against 3.2 branch","name":"3.2.2","archived":false,"released":true,"releaseDate":"2009-12-14"}],"issuelinks":[{"id":"12330832","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12330832","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12459544","key":"ZOOKEEPER-714","self":"https://issues.apache.org/jira/rest/api/2/issue/12459544","fields":{"summary":"snapshotting doesn't handle runtime exceptions (like out of memory) well","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12330833","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12330833","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12459545","key":"ZOOKEEPER-715","self":"https://issues.apache.org/jira/rest/api/2/issue/12459545","fields":{"summary":"add better reporting for initLimit being reached","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-03-26T17:20:46.795+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Hi guys,\n\nThe following is not a bug report but rather a question - but as I am attaching large files I am posting it here rather than on mailinglist.\n\nToday we had major failure in our production environment. Machines in zookeeper cluster gone wild and all clients got disconnected.\nWe tried to restart whole zookeeper cluster but cluster got stuck in leader election phase.\n\nCalling stat command on any machine in the cluster resulted in 'ZooKeeperServer not running' message\nIn one of logs I noticed 'Invalid snapshot'  message which disturbed me a bit.\n\nWe did not manage to make cluster work again with data. We deleted all version-2 directories on all nodes and then cluster started up without problems.\nIs it possible that snapshot/log data got corrupted in a way which made cluster unable to start?\nFortunately we could rebuild data we store in zookeeper as we use it only for locks and most of nodes is ephemeral.\n\nI am attaching contents of version-2 directory from all nodes and server logs.\nSource problem occurred some time before 15. First cluster restart happened at 15:03.\nAt some point later we experimented with deleting version-2 directory so I would not look at following restart because they can be misleading due to our actions.\n\nI am also attaching zoo.cfg. Maybe something is wrong at this place. \nAs I know look into logs i see read timeout during initialization phase after 20secs (initLimit=10, tickTime=2000).\nMaybe all I have to do is increase one or other. which one? Are there any downsides of increasing tickTime.\n\nBest regards, ≈Åukasz Osipiuk\n\nPS. due to attachment size limit I used split. to untar use \ncat nodeX-version-2.tgz-* |tar -xz\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439176","id":"12439176","filename":"node1-version-2.tgz-aa","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T16:02:48.123+0000","size":9437184,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12439176/node1-version-2.tgz-aa"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439177","id":"12439177","filename":"node1-version-2.tgz-ab","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T16:03:06.512+0000","size":6515814,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12439177/node1-version-2.tgz-ab"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439173","id":"12439173","filename":"node1-zookeeper.log.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T15:54:20.978+0000","size":218433,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12439173/node1-zookeeper.log.gz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439180","id":"12439180","filename":"node2-version-2.tgz-aa","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T16:05:47.839+0000","size":9437184,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12439180/node2-version-2.tgz-aa"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439181","id":"12439181","filename":"node2-version-2.tgz-ab","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T16:06:07.710+0000","size":9437184,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12439181/node2-version-2.tgz-ab"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439182","id":"12439182","filename":"node2-version-2.tgz-ac","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T16:07:19.068+0000","size":5673819,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12439182/node2-version-2.tgz-ac"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439174","id":"12439174","filename":"node2-zookeeper.log.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T15:54:20.981+0000","size":242242,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12439174/node2-zookeeper.log.gz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439183","id":"12439183","filename":"node3-version-2.tgz-aa","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T16:08:00.805+0000","size":9437184,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12439183/node3-version-2.tgz-aa"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439184","id":"12439184","filename":"node3-version-2.tgz-ab","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T16:08:23.580+0000","size":9437184,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12439184/node3-version-2.tgz-ab"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439186","id":"12439186","filename":"node3-version-2.tgz-ac","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T16:11:58.218+0000","size":1834283,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12439186/node3-version-2.tgz-ac"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439175","id":"12439175","filename":"node3-zookeeper.log.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T15:54:53.624+0000","size":196374,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12439175/node3-zookeeper.log.gz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439172","id":"12439172","filename":"zoo.cfg","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T15:54:20.972+0000","size":523,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12439172/zoo.cfg"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"32908","customfield_12312823":null,"summary":"zookeeper fails to start - broken snapshot?","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"debian lenny; ia64; xen virtualization","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459532/comment/12846976","id":"12846976","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"hey, just for a sanity check: you aren't running out of disk space are you?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-18T16:23:08.427+0000","updated":"2010-03-18T16:23:08.427+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459532/comment/12846990","id":"12846990","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"body":"Nope - we have plenty of free space","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T16:43:45.694+0000","updated":"2010-03-18T16:43:45.694+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459532/comment/12847013","id":"12847013","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"lukasz thank you for reporting this problem and providing the details. we analyzed your logs and found the following problems:\n\n1) you are getting an OutOfMemoryError during the snapshot. that is why you are getting the invalid snapshot file. it turns out that the invalid file isn't really a problem since we can just use an older snapshot to recover from, but this may indicate that you are running very close to the limit and spending a lot of time in the GC. (this may aggravate the next issue.)\n\n2) the initLimit and ticktime in zoo.cfg may too low. how much data is stored in zookeeper? look at the snapshot filesize, you need to be able to transmit the snapshot within the initLimit*ticktime. as an experiment try scping the snapshots between the different servers and see how long it takes. ticktime should be increased on wan connections. you might try doubling the ticktime and initLimit. (if you really are overloading the GC it is going to be slowing things down.)\n\n3) we also noticed that it is taking a long time to read and write snapshots (~17 and ~40 seconds in some cases). do you have other things contending with the disk? this is going to affect how long it takes for the leader to respond to a client, and thus the initLimit.\n\n4) we noticed that the jvm version you are using is pretty old. you may try upgrading to the latest version, especially since you are using 64-bit linux.\n\n5) finally, it appears you are running under xen. some people have had issues running in virtualized environments. the main problems being memory and disk contention. if java ever starts swapping, the GC can hang the process while pages go on an off the disk for reference checking. disk contention will also slow down recovery and logging to disk during write operations.\n\nwe are opening a jira, ZOOKEEPER-714, related to 1) since we really should exit on OutOfMemoryErrors. in your specific case we recovered, but in general it doesn't seem wise to continue execution once you have gotten an OutOfMemoryError.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-18T17:40:19.749+0000","updated":"2010-03-18T17:40:19.749+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459532/comment/12847014","id":"12847014","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"btw, for 1) you may want to increase the amount of heap space assigned to avoid the OutOfMemory exception. (keep in mind the issues in 5). even without xen you still need to make sure that the amount of memory allocated to the JVM is less than physical memory.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-18T17:43:17.622+0000","updated":"2010-03-18T17:43:17.622+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459532/comment/12847016","id":"12847016","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"linking to ZOOKEEPER-715 - improve logging for initLimit being reached.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-18T17:44:42.036+0000","updated":"2010-03-18T17:44:42.036+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459532/comment/12847019","id":"12847019","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"also see the troubleshooting page http://bit.ly/5WwS44 for details on issues ppl have faced in the past that might help you","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-18T17:46:19.607+0000","updated":"2010-03-18T17:46:19.607+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459532/comment/12847124","id":"12847124","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for detailed answer.\n\n{quote}\nlukasz thank you for reporting this problem and providing the details. we analyzed your logs and found the following problems:\n\n1) you are getting an OutOfMemoryError during the snapshot. that is why you are getting the invalid snapshot file. it turns out that the invalid file isn't really a problem since we can just use an older snapshot to recover from, but this may indicate that you are running very close to the limit and spending a lot of time in the GC. (this may aggravate the next issue.)\n{quote}\n\nIt appears we did not adjust java heap size and we are running on 512M of memory. I will increase heap size tomorrow.\n\n{quote}\n2) the initLimit and ticktime in zoo.cfg may too low. how much data is stored in zookeeper? look at the snapshot filesize, you need to be able to transmit the snapshot within the initLimit*ticktime. as an experiment try scping the snapshots between the different servers and see how long it takes. ticktime should be increased on wan connections. you might try doubling the ticktime and initLimit. (if you really are overloading the GC it is going to be slowing things down.)\n{quote}\n\nOur snapshot is quite small. At time problem occured i had around 11M. I checked with scp and copying takes much less than a second.\nI guess JVM was swapping (as it was running out of memory) caused delays with file transfer. What do you think? Is it possible?\n\nOne more question - Is it normal that zookeeper consumed 0.5G of memory handling such small snapshot?\n\n{quote}\n3) we also noticed that it is taking a long time to read and write snapshots (~17 and ~40 seconds in some cases). do you have other things contending with the disk? this is going to affect how long it takes for the leader to respond to a client, and thus the initLimit.\n{quote}\n\nSame as above - maybe memory limit was the problem. Anyway I will move zookeeper guests to xenhosts which does not have any disk intensive guests - to limit disc contention. Hope this helps. On xenhosts on which zookeeper is run some mysqls are run too. They are not very intensively used but it still good to fix it.\n\n{quote}\n4) we noticed that the jvm version you are using is pretty old. you may try upgrading to the latest version, especially since you are using 64-bit linux.\n{quote}\n\nWell - debian stable and \"up to date\" does not work well together. I will consider building newer java deb package myself but I would rather \ntreat is a last resort. Do you really think newer java version could help?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T21:37:50.612+0000","updated":"2010-03-18T21:37:50.612+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459532/comment/12847156","id":"12847156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"> I guess JVM was swapping (as it was running out of memory) caused delays with file transfer. What do you think? Is it possible?\n\nWe did see cases in your logs where the init seemed to take very short amount of time, and some cases where it took a very long time. Could be this, could be virtualization, intermittent network problems? ... any sound possible.\n\n> One more question - Is it normal that zookeeper consumed 0.5G of memory handling such small snapshot?\n\nIf you look at that troubleshooting page you'll see a link to the latency overview http://bit.ly/4ekN8G Notice this used a heap size of 512m with 1.6.0_05 jvm. I was creating a large number of znodes and watches and it worked fine - with 20 client case I'm creating 200k znodes (20mb) and 1 million watches.\n\nI don't know what might be taking the memory in your case (not knowing the use cases, znode count, avg size, etc...) but you can get more insight using something like visualvm or jconsole. Try attaching to the running VM and take a look.\n\n> I will consider building newer java deb package myself but I would rather treat is a last resort. Do you really think newer java version could help?\n\nI wouldn't try that as a first option. It's something we noticed and wanted to mention in case it was easy to try.\n\nDo take a look at the troubleshooting page - adding some monitoring of the jvm might help to provide insight. Also monitoring of the parameters that ZooKeeper itself makes avail through the command port and JMX. Also some of the other issues there have been faced by more than one user and might be helpful.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-18T23:14:13.526+0000","updated":"2010-03-18T23:14:13.526+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459532/comment/12847251","id":"12847251","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"One other thing that I thought of. What are you using for client session timeout? You should probably go more on the 30sec timeout, rather than 5sec timeout given the timing that we're seeing on the server (such as 7 sec for session establishment). You can monitor the min/max/avg latency on your servers using the 'stat' command on the command port (4 letter word). Using this information you can get a good idea what would work (if latency exceeds the timeout then clients on that server would timeout) and tune appropriately.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-19T07:21:14.782+0000","updated":"2010-03-19T07:21:14.782+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459532/comment/12847273","id":"12847273","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"body":"We had timeout of 5 secs when this logs were written. I already increased it to 15 secs. Will if that is enough.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-19T08:35:09.232+0000","updated":"2010-03-19T08:35:09.232+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459532/comment/12847407","id":"12847407","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Given that you are addressing some of the other issues we identified 15 should be enough.  5 might even be enough once things are running more smoothly, you can get a better sense using the 'stat' command as I mentioned elsewhere.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-19T15:49:19.087+0000","updated":"2010-03-19T15:49:19.087+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-713/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i05zuv:"}}