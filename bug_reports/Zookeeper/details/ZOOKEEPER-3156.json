{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13187676","self":"https://issues.apache.org/jira/rest/api/2/issue/13187676","key":"ZOOKEEPER-3156","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":44400,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326518","id":"12326518","name":"3.6.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12343268","id":"12343268","description":"Beta release against 3.5 branch","name":"3.5.5","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12343587","id":"12343587","name":"3.4.14","archived":false,"released":false}],"aggregatetimespent":44400,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2018-09-26T18:55:37.555+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Nov 06 00:25:43 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_3460875332_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-11-05T18:42:05.743+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-3156/watchers","watchCount":5,"isWatching":false},"created":"2018-09-26T17:20:50.456+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":["pull-request-available"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326518","id":"12326518","name":"3.6.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12342973","id":"12342973","description":"Fix release against 3.4 branch","name":"3.4.13","archived":false,"released":true,"releaseDate":"2018-07-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12343268","id":"12343268","description":"Beta release against 3.5 branch","name":"3.5.5","archived":false,"released":false}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-11-06T14:31:29.934+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312381","id":"12312381","name":"java client","description":"The java client interface for ZooKeeper"}],"timeoriginalestimate":null,"description":"Prior to ZOOKEEPER-2184 the zookeeper client would canonicalize a configured host name before creating the SASL client which is used to create the principal name.  After ZOOKEEPER-2184 that canonicalization does not happen so the principal that the ZK client tries to use when it is configured to talk to a CName is different between 3.4.13 and all previous versions of ZK.\r\n\r\n \r\n\r\nFor example\r\n\r\n \r\n\r\nzk1.mycluster.mycompany.com maps to real-node.mycompany.com.\r\n\r\n \r\n\r\n3.4.13 will want the server to have [zookeeper/zk1.mycluster.com@KDC.MYCOMPANY.COM|mailto:zookeeper/zk1.mycluster.com@KDC.MYCOMPANY.COM]\r\n\r\n3.4.12 wants the server to have [zookeeper/real-node.mycompany.com@KDC.MYCOMPANY.COM|mailto:zookeeper/real-node.mycompany.com@KDC.MYCOMPANY.COM]\r\n\r\n \r\n\r\nThis makes 3.4.13 incompatible with many ZK setups currently in existence.  It would be nice to have that resolution be optional because in some cases it might be nice to have a single principal tied to the cname.","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"12h 20m","remainingEstimateSeconds":0,"timeSpentSeconds":44400},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"ZOOKEEPER-2184 causes kerberos principal to not have resolved host name","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"customfield_12310290":null,"aggregateprogress":{"progress":44400,"total":44400,"percent":100},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":44400,"total":44400,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/comment/16629274","id":"16629274","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eolivelli","name":"eolivelli","key":"eolivelli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Enrico Olivelli","active":true,"timeZone":"Europe/Rome"},"body":"I see the problem.\r\n\r\nDo you have already a patch?\r\n\r\nMaybe a good idea is to add a client configuration flag or system property.\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eolivelli","name":"eolivelli","key":"eolivelli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Enrico Olivelli","active":true,"timeZone":"Europe/Rome"},"created":"2018-09-26T18:55:37.555+0000","updated":"2018-09-26T19:01:15.514+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/comment/16629283","id":"16629283","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"I like the idea of having a configuration switch for that, because I'm not entirely sure what would be the right behaviour.\r\n\r\n[~revans2] Do you have a patch already?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-09-26T19:06:01.254+0000","updated":"2018-09-26T19:06:01.254+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/comment/16629288","id":"16629288","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"Is this the logic that we're talking about?\r\n{code:java}\r\nif (ZooKeeperSaslClient.isEnabled()) {\r\n    try {\r\n        String principalUserName = System.getProperty(\r\n                ZK_SASL_CLIENT_USERNAME, \"zookeeper\");\r\n        zooKeeperSaslClient =\r\n            new ZooKeeperSaslClient(\r\n                    principalUserName+\"/\"+addr.getHostName());\r\n...{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-09-26T19:15:13.324+0000","updated":"2018-09-26T19:15:13.324+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/comment/16629340","id":"16629340","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"We should use getCanonicalHostName() to force reverse ip lookup and get the FQDN of the server according to this javadoc:\r\nhttps://docs.oracle.com/javase/7/docs/api/java/net/InetAddress.html#getCanonicalHostName()\r\n\r\nIntroducing a switch to enable reverse dns lookups would be inline with Kerberos client behaviour:\r\nhttp://web.mit.edu/kerberos/krb5-current/doc/admin/princ_dns.html\r\n\r\nIn the krb5 client you can disable canonicalization with rdns=false setting.\r\n\r\nI can put together a patch tomorrow if needed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-09-26T20:12:39.666+0000","updated":"2018-09-26T20:13:13.760+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/comment/16631671","id":"16631671","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"[~revans2] Any thoughts?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-09-28T10:28:57.987+0000","updated":"2018-09-28T10:28:57.987+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/comment/16632211","id":"16632211","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"[~andorm],\r\n\r\nSorry I was on a plane all day yesterday so I didn't respond sooner.  I have been doing some debugging trying to get a patch, but I have not come up with one yet.  I originally wanted to see if I could match the behavior from before by moving the host name resolution code later in the process, but despite the data structures being the same it is not possible as some information is lost in the current process.  I think having a flag that would optionally call {{getCannicalHostName}} would be great. If someone else has a patch I am happy to test it out, otherwise I will put together a patch myself.\r\n\r\nBe aware though that a global flag is not 100% backwards compatible, and there is a very small possibility that a single process will want to talk to multiple different zookeeper ensembles, i.e. apache storm + older kafka client, which could run into an issue where each ensemble wants something different.  It is a small enough chance, and there are ways to work around it so I am fine with it, but it is possible.\r\n\r\n \r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2018-09-28T18:23:22.993+0000","updated":"2018-09-28T18:23:22.993+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/comment/16632380","id":"16632380","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"[~revans2] Thanks for looking into this. As long as you're the assignee of this Jira, I'm happy to wait for your pull request to review.\r\n\r\nRegarding backwards compatibility: \"...could run into an issue where each ensemble wants something different\"\r\nThis wasn't supported previously either: meaning that previous versions always did reverse IP lookups, so basically followed the behaviour that you mentioned as 3.4.12. Therefore I don't think the fix could cause backward compatibility issues as long as the default behaviour is the original (rnds=true).\r\n\r\nLet's try to wrap up what I think happened here:\r\n- Previous versions of ZooKeeper (up to 3.4.12) did DNS resolution upfront and returned the pure IP address to upper layers like the SASL client. The original implementation stripped the hostname from the InetSocketAddress after name resolution and created a new one with only IP address and port number,\r\n- This was fine for connecting the client to the server, because it only needs the IP address,\r\n- It forced the SASL client to do reverse DNS lookup by calling getHostName(),\r\n- The current behaviour, which I think is the right approach, creates new InetSocketAddress with the resolved IP address and the original hostname, so upper layers don't need to do reverse lookup.\r\n\r\nWith the new switch and using getCanonicalHostName() in the SASL client we can enforce the reverse lookup which is needed here. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-09-28T19:36:43.207+0000","updated":"2018-09-28T19:36:43.207+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/comment/16632482","id":"16632482","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"body":"OK I have a patch up for 3.4 and if it looks good I am happy to port it to all release lines.\r\n\r\n[https://github.com/apache/zookeeper/pull/648]\r\n\r\nI have a few questions though.\r\n # I have canonicalization on by default, is that what we want?\r\n # Is there some place that I can document the new System property that I added?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=revans2","name":"revans2","key":"revans2","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Joseph Evans","active":true,"timeZone":"America/Chicago"},"created":"2018-09-28T19:46:27.328+0000","updated":"2018-09-28T19:46:27.328+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/comment/16675577","id":"16675577","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"Issue resolved by pull request 652\n[https://github.com/apache/zookeeper/pull/652]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-11-05T18:42:05.769+0000","updated":"2018-11-05T18:42:05.769+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/comment/16675821","id":"16675821","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Jenkins build Zookeeper-trunk-single-thread #94 (See [https://builds.apache.org/job/Zookeeper-trunk-single-thread/94/])\nZOOKEEPER-3156: Add in option to canonicalize host name (andor: rev 83fd6e298dda420125f8be35fda68cb226b0ee05)\n* (add) zookeeper-server/src/main/java/org/apache/zookeeper/SaslServerPrincipal.java\n* (edit) zookeeper-server/src/main/java/org/apache/zookeeper/client/ZKClientConfig.java\n* (edit) zookeeper-server/src/main/java/org/apache/zookeeper/ClientCnxn.java\n* (add) zookeeper-server/src/test/java/org/apache/zookeeper/ClientCanonicalizeTest.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-05T22:19:14.179+0000","updated":"2018-11-05T22:19:14.179+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/comment/16675917","id":"16675917","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Jenkins build ZooKeeper-trunk #256 (See [https://builds.apache.org/job/ZooKeeper-trunk/256/])\nZOOKEEPER-3156: Add in option to canonicalize host name (andor: rev 83fd6e298dda420125f8be35fda68cb226b0ee05)\n* (edit) zookeeper-server/src/main/java/org/apache/zookeeper/client/ZKClientConfig.java\n* (edit) zookeeper-server/src/main/java/org/apache/zookeeper/ClientCnxn.java\n* (add) zookeeper-server/src/test/java/org/apache/zookeeper/ClientCanonicalizeTest.java\n* (add) zookeeper-server/src/main/java/org/apache/zookeeper/SaslServerPrincipal.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-06T00:25:43.298+0000","updated":"2018-11-06T00:25:43.298+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-3156/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":78,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/149438","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user revans2 opened a pull request:\n\n    https://github.com/apache/zookeeper/pull/648\n\n    ZOOKEEPER-3156: Add in option to canonicalize host name\n\n    \n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/revans2/zookeeper ZOOKEEPER-3156-3.4\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/648.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #648\n    \n----\ncommit 7ecd6c9151c0e7be749cfead5f141d673a8663f6\nAuthor: Robert Evans <evans@...>\nDate:   2018-09-26T20:40:26Z\n\n    ZOOKEEPER-3156: Add in option to canonicalize host name\n\n----\n","created":"2018-09-28T19:43:15.540+0000","updated":"2018-09-28T19:43:15.540+0000","started":"2018-09-28T19:43:15.539+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"149438","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/149452","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/648#discussion_r221367697\n  \n    --- Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java ---\n    @@ -990,6 +992,27 @@ private void sendPing() {\n             private boolean saslLoginFailed = false;\n     \n             private void startConnect(InetSocketAddress addr) throws IOException {\n    +            boolean canonicalize = true;\n    +            try {\n    +                canonicalize = Boolean.parseBoolean(System.getProperty(ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME, \"true\"));\n    +            } catch (IllegalArgumentException ea) {\n    +                //ignored ...\n    +            }\n    +\n    +            if (canonicalize) {\n    --- End diff --\n    \n    You only want to do this if SASL client is enabled. Hence the name of the switch contains `sasl.client`. \n","created":"2018-09-28T20:16:02.344+0000","updated":"2018-09-28T20:16:02.344+0000","started":"2018-09-28T20:16:02.343+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"149452","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/149453","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/648#discussion_r221367723\n  \n    --- Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java ---\n    @@ -990,6 +992,27 @@ private void sendPing() {\n             private boolean saslLoginFailed = false;\n     \n             private void startConnect(InetSocketAddress addr) throws IOException {\n    +            boolean canonicalize = true;\n    +            try {\n    +                canonicalize = Boolean.parseBoolean(System.getProperty(ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME, \"true\"));\n    +            } catch (IllegalArgumentException ea) {\n    +                //ignored ...\n    +            }\n    +\n    +            if (canonicalize) {\n    +                try {\n    +                    InetAddress ia = addr.getAddress();\n    +                    LOG.warn(\"ia {}\", ia);\n    --- End diff --\n    \n    Debugging?\n","created":"2018-09-28T20:16:02.388+0000","updated":"2018-09-28T20:16:02.388+0000","started":"2018-09-28T20:16:02.387+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"149453","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/149454","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/648#discussion_r221367991\n  \n    --- Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java ---\n    @@ -990,6 +992,27 @@ private void sendPing() {\n             private boolean saslLoginFailed = false;\n     \n             private void startConnect(InetSocketAddress addr) throws IOException {\n    +            boolean canonicalize = true;\n    +            try {\n    +                canonicalize = Boolean.parseBoolean(System.getProperty(ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME, \"true\"));\n    +            } catch (IllegalArgumentException ea) {\n    +                //ignored ...\n    +            }\n    +\n    +            if (canonicalize) {\n    +                try {\n    +                    InetAddress ia = addr.getAddress();\n    +                    LOG.warn(\"ia {}\", ia);\n    +                    if (ia == null) {\n    +                        ia = InetAddress.getByName(addr.getHostName());\n    --- End diff --\n    \n    If the original address is unresolved, you should throw exception immediately. That means HostProvider already tried to resolve the address, but failed. No point trying it again here.\n","created":"2018-09-28T20:16:02.437+0000","updated":"2018-09-28T20:16:02.437+0000","started":"2018-09-28T20:16:02.436+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"149454","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/149455","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/648#discussion_r221368841\n  \n    --- Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java ---\n    @@ -990,6 +992,27 @@ private void sendPing() {\n             private boolean saslLoginFailed = false;\n     \n             private void startConnect(InetSocketAddress addr) throws IOException {\n    +            boolean canonicalize = true;\n    +            try {\n    +                canonicalize = Boolean.parseBoolean(System.getProperty(ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME, \"true\"));\n    +            } catch (IllegalArgumentException ea) {\n    +                //ignored ...\n    +            }\n    +\n    +            if (canonicalize) {\n    +                try {\n    +                    InetAddress ia = addr.getAddress();\n    +                    LOG.warn(\"ia {}\", ia);\n    +                    if (ia == null) {\n    +                        ia = InetAddress.getByName(addr.getHostName());\n    +                    }\n    +                    String host = (ia != null) ? ia.getCanonicalHostName() : addr.getHostName();\n    +                    addr = new InetSocketAddress(InetAddress.getByAddress(host, ia.getAddress()), addr.getPort());\n    --- End diff --\n    \n    I'm thinking of how much value does it have to replace the address with the canonicalized version for the entire client. We might want to implement this strictly and only for `ZooKeeperSaslClient`.\r\n    \r\n    I'd rather move this logic to the creation of `ZooKeeperSaslClient`. \r\n    \r\n    Something like:\r\n    ```java\r\n    zooKeeperSaslClient =  new ZooKeeperSaslClient(principalUserName + \"/\" + canonicalize ? addr.getAddress().getCanonicalHostName() : addr.getHostName());\r\n    ```\n","created":"2018-09-28T20:16:03.597+0000","updated":"2018-09-28T20:16:03.597+0000","started":"2018-09-28T20:16:03.596+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"149455","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/149461","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/648\n  \n    \n    Refer to this link for build results (access rights to CI server needed): \n    https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2282/\n\n","created":"2018-09-28T20:19:56.143+0000","updated":"2018-09-28T20:19:56.143+0000","started":"2018-09-28T20:19:56.143+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"149461","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/149477","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/648#discussion_r221376870\n  \n    --- Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java ---\n    @@ -990,6 +992,27 @@ private void sendPing() {\n             private boolean saslLoginFailed = false;\n     \n             private void startConnect(InetSocketAddress addr) throws IOException {\n    +            boolean canonicalize = true;\n    +            try {\n    +                canonicalize = Boolean.parseBoolean(System.getProperty(ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME, \"true\"));\n    +            } catch (IllegalArgumentException ea) {\n    +                //ignored ...\n    +            }\n    +\n    +            if (canonicalize) {\n    +                try {\n    +                    InetAddress ia = addr.getAddress();\n    +                    LOG.warn(\"ia {}\", ia);\n    +                    if (ia == null) {\n    +                        ia = InetAddress.getByName(addr.getHostName());\n    +                    }\n    +                    String host = (ia != null) ? ia.getCanonicalHostName() : addr.getHostName();\n    +                    addr = new InetSocketAddress(InetAddress.getByAddress(host, ia.getAddress()), addr.getPort());\n    --- End diff --\n    \n    I put it here because there is a possible race.  The entire reason we have the setup we do is so that we can change the nodes in the cluster without changing the config on the client side.  If the code that establishes the connection uses a different address from the code that creates the principal there is the possibility, because of the magic of DNS caching, that the connection would be made to a different box from the one the SASL client is expecting.  If that happens, and we have the default Client section in the jaas conf, it will not result in an error.  Instead the ZK client logs something about SASL failed and still connects but is not authorized to do anything.  If it failed and retried a different node I would be happy to move it, but it does not and that failure would not be transparent to the end user.\n","created":"2018-09-28T20:45:23.582+0000","updated":"2018-09-28T20:45:23.582+0000","started":"2018-09-28T20:45:23.581+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"149477","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/149478","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/648#discussion_r221377101\n  \n    --- Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java ---\n    @@ -990,6 +992,27 @@ private void sendPing() {\n             private boolean saslLoginFailed = false;\n     \n             private void startConnect(InetSocketAddress addr) throws IOException {\n    +            boolean canonicalize = true;\n    +            try {\n    +                canonicalize = Boolean.parseBoolean(System.getProperty(ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME, \"true\"));\n    +            } catch (IllegalArgumentException ea) {\n    +                //ignored ...\n    +            }\n    +\n    +            if (canonicalize) {\n    +                try {\n    +                    InetAddress ia = addr.getAddress();\n    +                    LOG.warn(\"ia {}\", ia);\n    +                    if (ia == null) {\n    +                        ia = InetAddress.getByName(addr.getHostName());\n    +                    }\n    +                    String host = (ia != null) ? ia.getCanonicalHostName() : addr.getHostName();\n    +                    addr = new InetSocketAddress(InetAddress.getByAddress(host, ia.getAddress()), addr.getPort());\n    --- End diff --\n    \n    But you said that we already have the IP address, which is what it is going to use, so never mind, it should be fine.\n","created":"2018-09-28T20:46:28.733+0000","updated":"2018-09-28T20:46:28.733+0000","started":"2018-09-28T20:46:28.733+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"149478","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/149479","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/648\n  \n    @anmolnar I think I have addressed all of your comments.  Please have another look.\n","created":"2018-09-28T20:52:23.914+0000","updated":"2018-09-28T20:52:23.914+0000","started":"2018-09-28T20:52:23.913+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"149479","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/149490","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user asfgit commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/648\n  \n    \n    Refer to this link for build results (access rights to CI server needed): \n    https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/2284/\n\n","created":"2018-09-28T21:38:21.932+0000","updated":"2018-09-28T21:38:21.932+0000","started":"2018-09-28T21:38:21.932+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"149490","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/149496","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user eolivelli commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/648#discussion_r221389383\n  \n    --- Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java ---\n    @@ -997,12 +999,31 @@ private void startConnect(InetSocketAddress addr) throws IOException {\n                 setName(getName().replaceAll(\"\\\\(.*\\\\)\",\n                         \"(\" + addr.getHostName() + \":\" + addr.getPort() + \")\"));\n                 if (ZooKeeperSaslClient.isEnabled()) {\n    +                String hostName = addr.getHostName();\n    +\n    +                boolean canonicalize = true;\n    +                try {\n    +                    canonicalize = Boolean.parseBoolean(System.getProperty(ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME, \"true\"));\n    +                } catch (IllegalArgumentException ea) {\n    +                    //ignored ...\n    +                }\n    +\n    +                if (canonicalize) {\n    +                    InetAddress ia = addr.getAddress();\n    +                    if (ia == null) {\n    +                        throw new IllegalArgumentException(\"Connection address should have already been resolved by the HostProvider.\");\n    +                    }\n    +                    //Update the actual address so we are\n    +                    hostName = ia.getCanonicalHostName();\n    +                    LOG.debug(\"Canonicalized address to {}\", hostName);\n    --- End diff --\n    \n    Nit: if LOG.isDebugEnabled\n","created":"2018-09-28T21:51:00.520+0000","updated":"2018-09-28T21:51:00.520+0000","started":"2018-09-28T21:51:00.518+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"149496","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/150021","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user anmolnar commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/648\n  \n    @eolivelli I like your idea about the unit test.\n","created":"2018-10-01T12:53:16.787+0000","updated":"2018-10-01T12:53:16.787+0000","started":"2018-10-01T12:53:16.786+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"150021","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/150032","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/648#discussion_r221613169\n  \n    --- Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java ---\n    @@ -997,12 +999,31 @@ private void startConnect(InetSocketAddress addr) throws IOException {\n                 setName(getName().replaceAll(\"\\\\(.*\\\\)\",\n                         \"(\" + addr.getHostName() + \":\" + addr.getPort() + \")\"));\n                 if (ZooKeeperSaslClient.isEnabled()) {\n    +                String hostName = addr.getHostName();\n    +\n    +                boolean canonicalize = true;\n    +                try {\n    +                    canonicalize = Boolean.parseBoolean(System.getProperty(ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME, \"true\"));\n    +                } catch (IllegalArgumentException ea) {\n    +                    //ignored ...\n    +                }\n    +\n    +                if (canonicalize) {\n    +                    InetAddress ia = addr.getAddress();\n    +                    if (ia == null) {\n    +                        throw new IllegalArgumentException(\"Connection address should have already been resolved by the HostProvider.\");\n    +                    }\n    +                    //Update the actual address so we are\n    +                    hostName = ia.getCanonicalHostName();\n    --- End diff --\n    \n    You might want to do the following:\r\n    ```java\r\n    String canonicalHostName = ia.getCanonicalHostName();\r\n    if (!canonicalHostName.equals(ia.getHostAddress())) {\r\n        hostName = canonicalHostName;\r\n    }\r\n    ```\r\n    \r\n    In order to avoid using literal IP address when security check fails.\n","created":"2018-10-01T13:45:18.070+0000","updated":"2018-10-01T13:45:18.070+0000","started":"2018-10-01T13:45:18.067+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"150032","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/150033","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/648#discussion_r221612755\n  \n    --- Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java ---\n    @@ -997,12 +999,31 @@ private void startConnect(InetSocketAddress addr) throws IOException {\n                 setName(getName().replaceAll(\"\\\\(.*\\\\)\",\n                         \"(\" + addr.getHostName() + \":\" + addr.getPort() + \")\"));\n                 if (ZooKeeperSaslClient.isEnabled()) {\n    +                String hostName = addr.getHostName();\n    +\n    +                boolean canonicalize = true;\n    +                try {\n    +                    canonicalize = Boolean.parseBoolean(System.getProperty(ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME, \"true\"));\n    +                } catch (IllegalArgumentException ea) {\n    +                    //ignored ...\n    +                }\n    +\n    +                if (canonicalize) {\n    +                    InetAddress ia = addr.getAddress();\n    +                    if (ia == null) {\n    +                        throw new IllegalArgumentException(\"Connection address should have already been resolved by the HostProvider.\");\n    --- End diff --\n    \n    Would you please change this to something like 'Unable to canonicalize address {}, because it's not resolveable'?\n","created":"2018-10-01T13:45:18.076+0000","updated":"2018-10-01T13:45:18.076+0000","started":"2018-10-01T13:45:18.075+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"150033","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/150034","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/648#discussion_r221612869\n  \n    --- Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java ---\n    @@ -997,12 +999,31 @@ private void startConnect(InetSocketAddress addr) throws IOException {\n                 setName(getName().replaceAll(\"\\\\(.*\\\\)\",\n                         \"(\" + addr.getHostName() + \":\" + addr.getPort() + \")\"));\n                 if (ZooKeeperSaslClient.isEnabled()) {\n    +                String hostName = addr.getHostName();\n    +\n    +                boolean canonicalize = true;\n    +                try {\n    +                    canonicalize = Boolean.parseBoolean(System.getProperty(ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME, \"true\"));\n    +                } catch (IllegalArgumentException ea) {\n    +                    //ignored ...\n    +                }\n    +\n    +                if (canonicalize) {\n    +                    InetAddress ia = addr.getAddress();\n    +                    if (ia == null) {\n    +                        throw new IllegalArgumentException(\"Connection address should have already been resolved by the HostProvider.\");\n    +                    }\n    +                    //Update the actual address so we are\n    +                    hostName = ia.getCanonicalHostName();\n    +                    LOG.debug(\"Canonicalized address to {}\", hostName);\n    --- End diff --\n    \n    +1\n","created":"2018-10-01T13:45:18.080+0000","updated":"2018-10-01T13:45:18.080+0000","started":"2018-10-01T13:45:18.078+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"150034","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/150144","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/648\n  \n    I just addressed the review comments if things look good I am happy to squash commits.  I'll also put up pull requests to the other lines, now that it looks like we have the majority of the code worked out.\n","created":"2018-10-01T20:12:54.235+0000","updated":"2018-10-01T20:12:54.235+0000","started":"2018-10-01T20:12:54.234+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"150144","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/150151","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user eolivelli commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/648\n  \n    Overall looks good to me\r\n    \r\n    What about adding a test case ?\r\n\n","created":"2018-10-01T20:30:52.546+0000","updated":"2018-10-01T20:30:52.546+0000","started":"2018-10-01T20:30:52.546+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"150151","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/150152","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"GitHub user revans2 opened a pull request:\n\n    https://github.com/apache/zookeeper/pull/652\n\n    ZOOKEEPER-3156: Add in option to canonicalize host name\n\n    This is the master and 3.5 version of #648.  It should apply cleanly to both lines, but if you want a separate pull request for each I am happy to do it.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/revans2/zookeeper ZOOKEEPER-3156\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/652.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #652\n    \n----\ncommit 24aca04adf57d10df123e2d61f55e2eb1344c014\nAuthor: Robert Evans <evans@...>\nDate:   2018-09-26T20:40:26Z\n\n    ZOOKEEPER-3156: Add in option to canonicalize host name\n\n----\n","created":"2018-10-01T20:32:16.531+0000","updated":"2018-10-01T20:32:16.531+0000","started":"2018-10-01T20:32:16.530+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"150152","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/150154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user eolivelli commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/652#discussion_r221747922\n  \n    --- Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java ---\n    @@ -1102,7 +1103,32 @@ private void startConnect(InetSocketAddress addr) throws IOException {\n             private String getServerPrincipal(InetSocketAddress addr) {\n                 String principalUserName = clientConfig.getProperty(ZKClientConfig.ZK_SASL_CLIENT_USERNAME,\n                         ZKClientConfig.ZK_SASL_CLIENT_USERNAME_DEFAULT);\n    -            String serverPrincipal = principalUserName + \"/\" + addr.getHostString();\n    +            String hostName = addr.getHostName();\n    +\n    +            boolean canonicalize = true;\n    +            try {\n    +                canonicalize = Boolean.parseBoolean(System.getProperty(ZKClientConfig.ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME,\n    --- End diff --\n    \n    Isn't it clientConfig instead of System ?\n","created":"2018-10-01T20:35:58.738+0000","updated":"2018-10-01T20:35:58.738+0000","started":"2018-10-01T20:35:58.738+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"150154","issueId":"13187676"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13187676/worklog/150156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user revans2 commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/652#discussion_r221749153\n  \n    --- Diff: src/java/main/org/apache/zookeeper/ClientCnxn.java ---\n    @@ -1102,7 +1103,32 @@ private void startConnect(InetSocketAddress addr) throws IOException {\n             private String getServerPrincipal(InetSocketAddress addr) {\n                 String principalUserName = clientConfig.getProperty(ZKClientConfig.ZK_SASL_CLIENT_USERNAME,\n                         ZKClientConfig.ZK_SASL_CLIENT_USERNAME_DEFAULT);\n    -            String serverPrincipal = principalUserName + \"/\" + addr.getHostString();\n    +            String hostName = addr.getHostName();\n    +\n    +            boolean canonicalize = true;\n    +            try {\n    +                canonicalize = Boolean.parseBoolean(System.getProperty(ZKClientConfig.ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME,\n    --- End diff --\n    \n    Great point, missed that on the port.\n","created":"2018-10-01T20:39:58.871+0000","updated":"2018-10-01T20:39:58.871+0000","started":"2018-10-01T20:39:58.871+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"150156","issueId":"13187676"}]},"customfield_12311820":"0|i3yj5r:"}}