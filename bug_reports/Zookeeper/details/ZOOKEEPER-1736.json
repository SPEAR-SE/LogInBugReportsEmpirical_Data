{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12659992","self":"https://issues.apache.org/jira/rest/api/2/issue/12659992","key":"ZOOKEEPER-1736","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2013-07-26T22:52:31.644+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Oct 23 15:41:42 UTC 2017","customfield_12310420":"340184","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_6598995440_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-10-10T17:43:55.119+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1736/watchers","watchCount":5,"isWatching":false},"created":"2013-07-26T08:40:39.712+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-10-23T15:49:58.323+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"Hello.\nI have configured Zookeeper to provide SASL authentication, using ordinary username and password stored in the JAAS.conf as a DigestLoginModule\nI have created a simple jaas.conf file:\n\nServer {\n    org.apache.zookeeper.server.auth.DigestLoginModule required\n    user_admin=\"admin\";\n};\nClient {\n    org.apache.zookeeper.server.auth.DigestLoginModule required\n    username=\"admin\"\n    password=\"admin\";\n};\n\nI have the zoo.cfg correctly configured for security, adding the following:\nrequireClientAuthScheme=sasl\nauthProvider.1=org.apache.zookeeper.server.auth.SASLAuthenticationProvider\njaasLoginRenew=3600000\nzookeeper.allowSaslFailedClients=false\n\nAnd I also have the java.env file:\nexport JVMFLAGS=\"-Djava.security.auth.login.config=/etc/zookeeper/conf/jaas.conf -Dzookeeper.allowSaslFailedClients=false\"\n\n\nEverything looks good. If I put the right username and password I authenticate, otherwise not and I get an exception.\nThe problem is when I donâ€™t put any username and password at all, zookeeper allows me to go through.\nI tried different things but nothing stops anonymous users to log in.\nI was looking at the source code,  in particular the  ZookeeperServer.java, this method:\n\n    public void processPacket(ServerCnxn cnxn, ByteBuffer incomingBuffer) throws IOException {\n\nThe section below:\n\n} else {\n            if (h.getType() == OpCode.sasl) {\n                Record rsp = processSasl(incomingBuffer,cnxn);\n                ReplyHeader rh = new ReplyHeader(h.getXid(), 0, KeeperException.Code.OK.intValue());\n                cnxn.sendResponse(rh,rsp, \"response\"); // not sure about 3rd arg..what is it?\n            }\n            else {\n                Request si = new Request(cnxn, cnxn.getSessionId(), h.getXid(),\n                  h.getType(), incomingBuffer, cnxn.getAuthInfo());\n                si.setOwner(ServerCnxn.me);\n                submitRequest(si);\n            }\n        }\n\nThe else flow  appears to just forward any anonymous request  to the handler, without attempting any authentication.\n\nIs this a bug? Is there any way to stop anonymous users connecting to Zookeeper?\nThanks\n\nAntonio\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"340502","customfield_12312823":null,"summary":"Zookeeper SASL authentication allows anonymus users to log in","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bacco1977","name":"bacco1977","key":"bacco1977","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"AntonioS","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bacco1977","name":"bacco1977","key":"bacco1977","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"AntonioS","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Development","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12659992/comment/13721330","id":"13721330","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=apurtell","name":"apurtell","key":"apurtell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=apurtell&avatarId=20553","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=apurtell&avatarId=20553","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=apurtell&avatarId=20553","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=apurtell&avatarId=20553"},"displayName":"Andrew Purtell","active":true,"timeZone":"America/Los_Angeles"},"body":"Authentication is for establishing identity for the purpose of testing access to znodes protected by 'SASL:*' ACLs. Connections and requests are still allowed if authentication fails, the effect will be access to those ACLs will be denied to the unauthenticated or anonymous user.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=apurtell","name":"apurtell","key":"apurtell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=apurtell&avatarId=20553","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=apurtell&avatarId=20553","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=apurtell&avatarId=20553","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=apurtell&avatarId=20553"},"displayName":"Andrew Purtell","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-26T22:52:31.644+0000","updated":"2013-07-26T22:52:31.644+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12659992/comment/15834470","id":"15834470","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thms.hmm","name":"thms.hmm","key":"thms.hmm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Hamm","active":true,"timeZone":"Etc/UTC"},"body":"[~apurtell], I'm curious about if there is now a way to prevent anonymous users to connect to zk. Seems like a serious security issue to me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thms.hmm","name":"thms.hmm","key":"thms.hmm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Hamm","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-23T13:19:32.763+0000","updated":"2017-01-23T13:19:32.763+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12659992/comment/15835086","id":"15835086","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"[~thms.hmm] It is possible to enforce the security such that anonymous users are rejected from their connection requests. I have a pull request for this https://github.com/apache/zookeeper/pull/118. There are actually quite a few JIRA that's related to your concern: ZOOKEEPER-1634, ZOOKEEPER-2462, ZOOKEEPER-2526, ZOOKEEPER-2346","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2017-01-23T19:24:43.433+0000","updated":"2017-01-23T19:24:43.433+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12659992/comment/15835248","id":"15835248","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=apurtell","name":"apurtell","key":"apurtell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=apurtell&avatarId=20553","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=apurtell&avatarId=20553","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=apurtell&avatarId=20553","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=apurtell&avatarId=20553"},"displayName":"Andrew Purtell","active":true,"timeZone":"America/Los_Angeles"},"body":"Because ZK authentication is pluggable (therefore, SASL is only one possible option out of several) and auth method is specified per ACL, it is strictly speaking incorrect to reject connections that don't auth with SASL, because they might be able to auth with another method to access znodes that do not have \"sasl\" auth specified as auth method. This was the thinking when SASL integration for ZK was developed. Otherwise we would have wrapped the whole connection with SASL, not tunneled SASL auth inside the ZK protocol. \n\nSo this not a \"security issue\" as such - it is a deliberate design choice. \n\nOn the other hand, providing some additional configuration toggle to enforce SASL authentication exclusively can be done. If the ZK devs want to commit it. TLS authentication doesn't work this way. When you use TLS if you can't auth at connection setup it doesn't matter what auth methods are specified by ACLs. In this sense, security design in ZK is inconsistent. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=apurtell","name":"apurtell","key":"apurtell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=apurtell&avatarId=20553","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=apurtell&avatarId=20553","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=apurtell&avatarId=20553","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=apurtell&avatarId=20553"},"displayName":"Andrew Purtell","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-23T21:38:34.850+0000","updated":"2017-01-23T21:38:34.850+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12659992/comment/15836254","id":"15836254","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thms.hmm","name":"thms.hmm","key":"thms.hmm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Hamm","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for pointing this out to me. I'll watch the tickets.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thms.hmm","name":"thms.hmm","key":"thms.hmm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Hamm","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-24T16:03:13.819+0000","updated":"2017-01-24T16:03:13.819+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12659992/comment/16215318","id":"16215318","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ram_amb%40yahoo.com","name":"ram_amb@yahoo.com","key":"ram_amb@yahoo.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ramkumar","active":true,"timeZone":"Etc/UTC"},"body":"I am also curious to know why this is not an issue /defect. I am trying to protect zookeeper in kubernetes cluster from other users to access zookeeper. I tried to set up SASL  in zookeeper and set a user in /broker node in zookeeper so that Kafka reject the connections to zookeeper if they dont specify the right user. However I observed, Kafka still makes connection successfully if they dont have \"client\" configuration set up. This means anonymous connection is still allowed to connect and use the zookeeper. did I miss some thing to learn why this is not a bug?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ram_amb%40yahoo.com","name":"ram_amb@yahoo.com","key":"ram_amb@yahoo.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ramkumar","active":true,"timeZone":"Etc/UTC"},"created":"2017-10-23T15:41:42.113+0000","updated":"2017-10-23T15:49:58.312+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1736/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1mo8n:"}}