{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13056466","self":"https://issues.apache.org/jira/rest/api/2/issue/13056466","key":"ZOOKEEPER-2725","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12340141","id":"12340141","description":"Beta release against 3.5 branch","name":"3.5.4","archived":false,"released":true,"releaseDate":"2018-05-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326518","id":"12326518","name":"3.6.0","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-03-17T22:46:20.014+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Mar 21 17:29:49 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_497718814_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2017-03-21T16:50:14.488+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2725/watchers","watchCount":4,"isWatching":false},"created":"2017-03-15T22:34:55.720+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12331981","id":"12331981","description":"Alpha release against 3.5 branch","name":"3.5.2","archived":false,"released":true,"releaseDate":"2016-07-21"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nixon","name":"nixon","key":"nixon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Nixon","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-07-13T03:05:51.589+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"On an ensemble with local sessions enabled, when a client with a local session requests the creation of an ephemeral node within a multi-op, the client gets a session expired message.  The same multi-op works if the session is already global. This breaks the client's expectation of seamless promotion from local session to global session server-side. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Upgrading to a global session fails with a multiop","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nixon","name":"nixon","key":"nixon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Nixon","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nixon","name":"nixon","key":"nixon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Nixon","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15927211","id":"15927211","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nixon","name":"nixon","key":"nixon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Nixon","active":true,"timeZone":"Etc/UTC"},"body":"I messed up the name of the pull request - meant to link https://github.com/apache/zookeeper/pull/195 to this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nixon","name":"nixon","key":"nixon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Nixon","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-15T23:52:00.230+0000","updated":"2017-03-15T23:52:00.230+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15930851","id":"15930851","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user afine commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/195#discussion_r106757751\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java ---\n    @@ -0,0 +1,87 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +\n    +package org.apache.zookeeper.server;\n    +\n    +import org.apache.zookeeper.CreateMode;\n    +import org.apache.zookeeper.KeeperException;\n    +import org.apache.zookeeper.Op;\n    +import org.apache.zookeeper.OpResult;\n    +import org.apache.zookeeper.ZooDefs;\n    +import org.apache.zookeeper.ZooKeeper;\n    +import org.apache.zookeeper.test.ClientBase;\n    +import org.apache.zookeeper.test.QuorumBase;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +import org.slf4j.Logger;\n    +import org.slf4j.LoggerFactory;\n    +\n    +import java.io.IOException;\n    +import java.util.Arrays;\n    +import java.util.List;\n    +\n    +public class MultiOpSessionUpgradeTest extends QuorumBase {\n    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);\n    +\n    +    @Override\n    +    public void setUp() throws Exception {\n    +        localSessionsEnabled = true;\n    +        localSessionsUpgradingEnabled = true;\n    +        super.setUp();\n    +    }\n    +\n    +    @Test\n    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {\n    +        final ZooKeeper zk = createClient();\n    +        waitForClient(zk, ZooKeeper.States.CONNECTED);\n    +\n    +        String data = \"test\";\n    +        String path = \"/ephemeralcreatemultiop\";\n    +        zk.create(path, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n    +\n    +        List<OpResult> multi = null;\n    +        LOG.info(\"RUNNING MULTI-OP\");\n    --- End diff --\n    \n    nit: not sure we need all of this logging\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-17T22:46:20.014+0000","updated":"2017-03-17T22:46:20.014+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15930852","id":"15930852","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user afine commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/195#discussion_r106757640\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java ---\n    @@ -0,0 +1,87 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +\n    +package org.apache.zookeeper.server;\n    +\n    +import org.apache.zookeeper.CreateMode;\n    +import org.apache.zookeeper.KeeperException;\n    +import org.apache.zookeeper.Op;\n    +import org.apache.zookeeper.OpResult;\n    +import org.apache.zookeeper.ZooDefs;\n    +import org.apache.zookeeper.ZooKeeper;\n    +import org.apache.zookeeper.test.ClientBase;\n    +import org.apache.zookeeper.test.QuorumBase;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +import org.slf4j.Logger;\n    +import org.slf4j.LoggerFactory;\n    +\n    +import java.io.IOException;\n    +import java.util.Arrays;\n    +import java.util.List;\n    +\n    +public class MultiOpSessionUpgradeTest extends QuorumBase {\n    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);\n    +\n    +    @Override\n    +    public void setUp() throws Exception {\n    +        localSessionsEnabled = true;\n    +        localSessionsUpgradingEnabled = true;\n    +        super.setUp();\n    +    }\n    +\n    +    @Test\n    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {\n    +        final ZooKeeper zk = createClient();\n    +        waitForClient(zk, ZooKeeper.States.CONNECTED);\n    --- End diff --\n    \n    Not sure we need this. I don't think we need to do this in other tests.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-17T22:46:20.124+0000","updated":"2017-03-17T22:46:20.124+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15930853","id":"15930853","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user afine commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/195#discussion_r106759077\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java ---\n    @@ -0,0 +1,87 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +\n    +package org.apache.zookeeper.server;\n    +\n    +import org.apache.zookeeper.CreateMode;\n    +import org.apache.zookeeper.KeeperException;\n    +import org.apache.zookeeper.Op;\n    +import org.apache.zookeeper.OpResult;\n    +import org.apache.zookeeper.ZooDefs;\n    +import org.apache.zookeeper.ZooKeeper;\n    +import org.apache.zookeeper.test.ClientBase;\n    +import org.apache.zookeeper.test.QuorumBase;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +import org.slf4j.Logger;\n    +import org.slf4j.LoggerFactory;\n    +\n    +import java.io.IOException;\n    +import java.util.Arrays;\n    +import java.util.List;\n    +\n    +public class MultiOpSessionUpgradeTest extends QuorumBase {\n    --- End diff --\n    \n    Would it be possible to test `public Request checkUpgradeSession(Request request)` directly in addition to this integration style test?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-17T22:46:20.412+0000","updated":"2017-03-17T22:46:20.412+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15930915","id":"15930915","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 2 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/448//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/448//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/448//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-17T23:58:20.049+0000","updated":"2017-03-17T23:58:20.049+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15931547","id":"15931547","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/195#discussion_r106797306\n  \n    --- Diff: src/java/main/org/apache/zookeeper/server/quorum/QuorumZooKeeperServer.java ---\n    @@ -62,18 +64,40 @@ public Request checkUpgradeSession(Request request)\n             // This is called by the request processor thread (either follower\n             // or observer request processor), which is unique to a learner.\n             // So will not be called concurrently by two threads.\n    -        if (request.type != OpCode.create ||\n    +        if ((request.type != OpCode.create && request.type != OpCode.create2 && request.type != OpCode.multi) ||\n                 !upgradeableSessionTracker.isLocalSession(request.sessionId)) {\n                 return null;\n             }\n    -        CreateRequest createRequest = new CreateRequest();\n    -        request.request.rewind();\n    -        ByteBufferInputStream.byteBuffer2Record(request.request, createRequest);\n    -        request.request.rewind();\n    -        CreateMode createMode = CreateMode.fromFlag(createRequest.getFlags());\n    -        if (!createMode.isEphemeral()) {\n    -            return null;\n    +\n    +        if (OpCode.multi == request.type) {\n    +            MultiTransactionRecord multiTransactionRecord = new MultiTransactionRecord();\n    +            request.request.rewind();\n    +            ByteBufferInputStream.byteBuffer2Record(request.request, multiTransactionRecord);\n    +            request.request.rewind();\n    +            boolean containsEphemeralCreate = false;\n    +            for (Op op : multiTransactionRecord) {\n    +                if (op.getType() == OpCode.create || op.getType() == OpCode.create2) {\n    +                    CreateRequest createRequest = (CreateRequest)op.toRequestRecord();\n    +                    CreateMode createMode = CreateMode.fromFlag(createRequest.getFlags());\n    +                    if (createMode.isEphemeral()) {\n    +                        containsEphemeralCreate = true;\n    --- End diff --\n    \n    I think we can just return null here (or break the loop) - there is no need to check rest of ops because as long as there is an ephemeral / create we'd upgrade session?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-19T03:39:04.881+0000","updated":"2017-03-19T03:39:04.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15931548","id":"15931548","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/195#discussion_r106797340\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java ---\n    @@ -0,0 +1,87 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +\n    +package org.apache.zookeeper.server;\n    +\n    +import org.apache.zookeeper.CreateMode;\n    +import org.apache.zookeeper.KeeperException;\n    +import org.apache.zookeeper.Op;\n    +import org.apache.zookeeper.OpResult;\n    +import org.apache.zookeeper.ZooDefs;\n    +import org.apache.zookeeper.ZooKeeper;\n    +import org.apache.zookeeper.test.ClientBase;\n    +import org.apache.zookeeper.test.QuorumBase;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +import org.slf4j.Logger;\n    +import org.slf4j.LoggerFactory;\n    +\n    +import java.io.IOException;\n    +import java.util.Arrays;\n    +import java.util.List;\n    +\n    +public class MultiOpSessionUpgradeTest extends QuorumBase {\n    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);\n    +\n    +    @Override\n    +    public void setUp() throws Exception {\n    +        localSessionsEnabled = true;\n    +        localSessionsUpgradingEnabled = true;\n    +        super.setUp();\n    +    }\n    +\n    +    @Test\n    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {\n    +        final ZooKeeper zk = createClient();\n    +        waitForClient(zk, ZooKeeper.States.CONNECTED);\n    --- End diff --\n    \n    Right, there is no need for this check (which use polling which is not recommended.). createClient already ensures that zk is in connected state via watchers. The only benefit of additional check here might be that in case of flaky test environment, a zk might loss connection to server right after createClient, but in that case we might want to wrap the subsequent test code (i.e. create) using retry with timeout logic.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-19T03:41:45.209+0000","updated":"2017-03-19T03:41:45.209+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15931549","id":"15931549","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/195#discussion_r106797356\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java ---\n    @@ -0,0 +1,87 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +\n    +package org.apache.zookeeper.server;\n    +\n    +import org.apache.zookeeper.CreateMode;\n    +import org.apache.zookeeper.KeeperException;\n    +import org.apache.zookeeper.Op;\n    +import org.apache.zookeeper.OpResult;\n    +import org.apache.zookeeper.ZooDefs;\n    +import org.apache.zookeeper.ZooKeeper;\n    +import org.apache.zookeeper.test.ClientBase;\n    +import org.apache.zookeeper.test.QuorumBase;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +import org.slf4j.Logger;\n    +import org.slf4j.LoggerFactory;\n    +\n    +import java.io.IOException;\n    +import java.util.Arrays;\n    +import java.util.List;\n    +\n    +public class MultiOpSessionUpgradeTest extends QuorumBase {\n    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);\n    +\n    +    @Override\n    +    public void setUp() throws Exception {\n    +        localSessionsEnabled = true;\n    +        localSessionsUpgradingEnabled = true;\n    +        super.setUp();\n    +    }\n    +\n    +    @Test\n    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {\n    +        final ZooKeeper zk = createClient();\n    +        waitForClient(zk, ZooKeeper.States.CONNECTED);\n    +\n    +        String data = \"test\";\n    +        String path = \"/ephemeralcreatemultiop\";\n    +        zk.create(path, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n    +\n    +        List<OpResult> multi = null;\n    +        LOG.info(\"RUNNING MULTI-OP\");\n    +        try {\n    +            multi = zk.multi(Arrays.asList(\n    +                    Op.setData(path, data.getBytes(), 0),\n    +                    Op.create(path + \"/e\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL),\n    +                    Op.create(path + \"/p\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n    +                    Op.create(path + \"/q\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL)\n    +            ));\n    +        } catch (KeeperException.SessionExpiredException e) {\n    +            LOG.info(\"SESSION EXPIRED\", e);\n    --- End diff --\n    \n    We are not expected to get a SessionExpiredException here right with this patch, right? So might worth to put an assert here.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-19T03:42:49.526+0000","updated":"2017-03-19T03:42:49.526+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15931551","id":"15931551","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/195#discussion_r106797374\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java ---\n    @@ -0,0 +1,87 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +\n    +package org.apache.zookeeper.server;\n    +\n    +import org.apache.zookeeper.CreateMode;\n    +import org.apache.zookeeper.KeeperException;\n    +import org.apache.zookeeper.Op;\n    +import org.apache.zookeeper.OpResult;\n    +import org.apache.zookeeper.ZooDefs;\n    +import org.apache.zookeeper.ZooKeeper;\n    +import org.apache.zookeeper.test.ClientBase;\n    +import org.apache.zookeeper.test.QuorumBase;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +import org.slf4j.Logger;\n    +import org.slf4j.LoggerFactory;\n    +\n    +import java.io.IOException;\n    +import java.util.Arrays;\n    +import java.util.List;\n    +\n    +public class MultiOpSessionUpgradeTest extends QuorumBase {\n    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);\n    +\n    +    @Override\n    +    public void setUp() throws Exception {\n    +        localSessionsEnabled = true;\n    +        localSessionsUpgradingEnabled = true;\n    +        super.setUp();\n    +    }\n    +\n    +    @Test\n    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {\n    +        final ZooKeeper zk = createClient();\n    +        waitForClient(zk, ZooKeeper.States.CONNECTED);\n    +\n    +        String data = \"test\";\n    +        String path = \"/ephemeralcreatemultiop\";\n    +        zk.create(path, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n    +\n    +        List<OpResult> multi = null;\n    +        LOG.info(\"RUNNING MULTI-OP\");\n    +        try {\n    +            multi = zk.multi(Arrays.asList(\n    +                    Op.setData(path, data.getBytes(), 0),\n    +                    Op.create(path + \"/e\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL),\n    +                    Op.create(path + \"/p\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n    +                    Op.create(path + \"/q\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL)\n    +            ));\n    +        } catch (KeeperException.SessionExpiredException e) {\n    +            LOG.info(\"SESSION EXPIRED\", e);\n    +        }\n    +        LOG.info(\"TESTING RESULTS\");\n    +        Assert.assertNotNull(multi);\n    --- End diff --\n    \n    In addition to these tests, it might be helpful to verify that a session upgrade has actually happened. I think we can verify that by comparing the old session id retrieved from zk before the multi-op and the new session id?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-19T03:43:44.400+0000","updated":"2017-03-19T03:43:44.400+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15933263","id":"15933263","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user enixon commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/195\n  \n    Proposed changes sound good, addressed with additional commit\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-20T18:39:54.395+0000","updated":"2017-03-20T18:39:54.395+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15933878","id":"15933878","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/195#discussion_r107051170\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java ---\n    @@ -0,0 +1,135 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +\n    +package org.apache.zookeeper.server;\n    +\n    +import org.apache.jute.BinaryOutputArchive;\n    +import org.apache.zookeeper.CreateMode;\n    +import org.apache.zookeeper.KeeperException;\n    +import org.apache.zookeeper.Op;\n    +import org.apache.zookeeper.OpResult;\n    +import org.apache.zookeeper.ZooDefs;\n    +import org.apache.zookeeper.ZooKeeper;\n    +import org.apache.zookeeper.proto.CreateRequest;\n    +import org.apache.zookeeper.proto.GetDataRequest;\n    +import org.apache.zookeeper.server.quorum.QuorumPeer;\n    +import org.apache.zookeeper.server.quorum.QuorumZooKeeperServer;\n    +import org.apache.zookeeper.server.quorum.UpgradeableSessionTracker;\n    +import org.apache.zookeeper.test.QuorumBase;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +import org.slf4j.Logger;\n    +import org.slf4j.LoggerFactory;\n    +\n    +import java.io.ByteArrayOutputStream;\n    +import java.io.IOException;\n    +import java.nio.ByteBuffer;\n    +import java.util.ArrayList;\n    +import java.util.Arrays;\n    +import java.util.List;\n    +\n    +public class MultiOpSessionUpgradeTest extends QuorumBase {\n    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);\n    +\n    +    @Override\n    +    public void setUp() throws Exception {\n    +        localSessionsEnabled = true;\n    +        localSessionsUpgradingEnabled = true;\n    +        super.setUp();\n    +    }\n    +\n    +    @Test\n    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {\n    +        final ZooKeeper zk = createClient();\n    +\n    +        String data = \"test\";\n    +        String path = \"/ephemeralcreatemultiop\";\n    +        zk.create(path, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n    +\n    +        QuorumZooKeeperServer server = getConnectedServer(zk.getSessionId());\n    +        Assert.assertNotNull(\"unable to find server interlocutor\", server);\n    +        UpgradeableSessionTracker sessionTracker = (UpgradeableSessionTracker)server.getSessionTracker();\n    +        Assert.assertFalse(\"session already global\", sessionTracker.isGlobalSession(zk.getSessionId()));\n    +\n    +        List<OpResult> multi = null;\n    +        try {\n    +            multi = zk.multi(Arrays.asList(\n    +                    Op.setData(path, data.getBytes(), 0),\n    +                    Op.create(path + \"/e\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL),\n    +                    Op.create(path + \"/p\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n    +                    Op.create(path + \"/q\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL)\n    +            ));\n    +        } catch (KeeperException.SessionExpiredException e) {\n    +            // the scenario that inspired this unit test\n    +            Assert.fail(\"received session expired for a session promotion in a multi-op\");\n    +        }\n    +\n    +        Assert.assertNotNull(multi);\n    +        Assert.assertEquals(4, multi.size());\n    +        Assert.assertEquals(data, new String(zk.getData(path + \"/e\", false, null)));\n    +        Assert.assertEquals(data, new String(zk.getData(path + \"/p\", false, null)));\n    +        Assert.assertEquals(data, new String(zk.getData(path + \"/q\", false, null)));\n    +        Assert.assertTrue(\"session not promoted\", sessionTracker.isGlobalSession(zk.getSessionId()));\n    +    }\n    +\n    +    @Test\n    +    public void directCheckUpgradeSessionTest() throws IOException, InterruptedException, KeeperException {\n    +        final ZooKeeper zk = createClient();\n    +\n    +        String path = \"/directcheckupgradesession\";\n    +        zk.create(path, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n    +\n    +        QuorumZooKeeperServer server = getConnectedServer(zk.getSessionId());\n    +        Assert.assertNotNull(\"unable to find server interlocutor\", server);\n    +\n    +        Request readRequest = makeGetDataRequest(path, zk.getSessionId());\n    +        Request createRequest = makeCreateRequest(path + \"/e\", zk.getSessionId());\n    +        Assert.assertNull(\"tried to upgrade on a read\", server.checkUpgradeSession(readRequest));\n    +        Assert.assertNotNull(\"failed to upgrade on a create\", server.checkUpgradeSession(createRequest));\n    +        Assert.assertNull(\"tried to upgrade after successful promotion\",\n    +                server.checkUpgradeSession(createRequest));\n    +    }\n    +\n    +    private Request makeGetDataRequest(String path, long sessionId) throws IOException {\n    +        ByteArrayOutputStream boas = new ByteArrayOutputStream();\n    +        BinaryOutputArchive boa = BinaryOutputArchive.getArchive(boas);\n    +        GetDataRequest getDataRequest = new GetDataRequest(path, false);\n    +        getDataRequest.serialize(boa, \"request\");\n    +        ByteBuffer bb = ByteBuffer.wrap(boas.toByteArray());\n    +        return new Request(null, sessionId, 1, ZooDefs.OpCode.getData, bb, new ArrayList<>());\n    --- End diff --\n    \n    `new ArrayList<>()` would not work in JDK 7 (the compiler can't infer the type w/o explicitly specify the type parameter here). I think you are using JDK 8 so you don't see this. Suggest change this to 'new ArrayList<Id>()' so it works with both JDK 7 and 8. Pre-commit job also failed because of this:  https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/462/console\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-21T00:43:14.647+0000","updated":"2017-03-21T00:43:14.647+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15933879","id":"15933879","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user hanm commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/195#discussion_r107051228\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java ---\n    @@ -0,0 +1,135 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +\n    +package org.apache.zookeeper.server;\n    +\n    +import org.apache.jute.BinaryOutputArchive;\n    +import org.apache.zookeeper.CreateMode;\n    +import org.apache.zookeeper.KeeperException;\n    +import org.apache.zookeeper.Op;\n    +import org.apache.zookeeper.OpResult;\n    +import org.apache.zookeeper.ZooDefs;\n    +import org.apache.zookeeper.ZooKeeper;\n    +import org.apache.zookeeper.proto.CreateRequest;\n    +import org.apache.zookeeper.proto.GetDataRequest;\n    +import org.apache.zookeeper.server.quorum.QuorumPeer;\n    +import org.apache.zookeeper.server.quorum.QuorumZooKeeperServer;\n    +import org.apache.zookeeper.server.quorum.UpgradeableSessionTracker;\n    +import org.apache.zookeeper.test.QuorumBase;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +import org.slf4j.Logger;\n    +import org.slf4j.LoggerFactory;\n    +\n    +import java.io.ByteArrayOutputStream;\n    +import java.io.IOException;\n    +import java.nio.ByteBuffer;\n    +import java.util.ArrayList;\n    +import java.util.Arrays;\n    +import java.util.List;\n    +\n    +public class MultiOpSessionUpgradeTest extends QuorumBase {\n    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);\n    +\n    +    @Override\n    +    public void setUp() throws Exception {\n    +        localSessionsEnabled = true;\n    +        localSessionsUpgradingEnabled = true;\n    +        super.setUp();\n    +    }\n    +\n    +    @Test\n    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {\n    +        final ZooKeeper zk = createClient();\n    +\n    +        String data = \"test\";\n    +        String path = \"/ephemeralcreatemultiop\";\n    +        zk.create(path, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n    +\n    +        QuorumZooKeeperServer server = getConnectedServer(zk.getSessionId());\n    +        Assert.assertNotNull(\"unable to find server interlocutor\", server);\n    +        UpgradeableSessionTracker sessionTracker = (UpgradeableSessionTracker)server.getSessionTracker();\n    +        Assert.assertFalse(\"session already global\", sessionTracker.isGlobalSession(zk.getSessionId()));\n    +\n    +        List<OpResult> multi = null;\n    +        try {\n    +            multi = zk.multi(Arrays.asList(\n    +                    Op.setData(path, data.getBytes(), 0),\n    +                    Op.create(path + \"/e\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL),\n    +                    Op.create(path + \"/p\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n    +                    Op.create(path + \"/q\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL)\n    +            ));\n    +        } catch (KeeperException.SessionExpiredException e) {\n    +            // the scenario that inspired this unit test\n    +            Assert.fail(\"received session expired for a session promotion in a multi-op\");\n    +        }\n    +\n    +        Assert.assertNotNull(multi);\n    +        Assert.assertEquals(4, multi.size());\n    +        Assert.assertEquals(data, new String(zk.getData(path + \"/e\", false, null)));\n    +        Assert.assertEquals(data, new String(zk.getData(path + \"/p\", false, null)));\n    +        Assert.assertEquals(data, new String(zk.getData(path + \"/q\", false, null)));\n    +        Assert.assertTrue(\"session not promoted\", sessionTracker.isGlobalSession(zk.getSessionId()));\n    +    }\n    +\n    +    @Test\n    +    public void directCheckUpgradeSessionTest() throws IOException, InterruptedException, KeeperException {\n    +        final ZooKeeper zk = createClient();\n    +\n    +        String path = \"/directcheckupgradesession\";\n    +        zk.create(path, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n    +\n    +        QuorumZooKeeperServer server = getConnectedServer(zk.getSessionId());\n    +        Assert.assertNotNull(\"unable to find server interlocutor\", server);\n    +\n    +        Request readRequest = makeGetDataRequest(path, zk.getSessionId());\n    +        Request createRequest = makeCreateRequest(path + \"/e\", zk.getSessionId());\n    +        Assert.assertNull(\"tried to upgrade on a read\", server.checkUpgradeSession(readRequest));\n    +        Assert.assertNotNull(\"failed to upgrade on a create\", server.checkUpgradeSession(createRequest));\n    +        Assert.assertNull(\"tried to upgrade after successful promotion\",\n    +                server.checkUpgradeSession(createRequest));\n    +    }\n    +\n    +    private Request makeGetDataRequest(String path, long sessionId) throws IOException {\n    +        ByteArrayOutputStream boas = new ByteArrayOutputStream();\n    +        BinaryOutputArchive boa = BinaryOutputArchive.getArchive(boas);\n    +        GetDataRequest getDataRequest = new GetDataRequest(path, false);\n    +        getDataRequest.serialize(boa, \"request\");\n    +        ByteBuffer bb = ByteBuffer.wrap(boas.toByteArray());\n    +        return new Request(null, sessionId, 1, ZooDefs.OpCode.getData, bb, new ArrayList<>());\n    +    }\n    +\n    +    private Request makeCreateRequest(String path, long sessionId) throws IOException {\n    +        ByteArrayOutputStream boas = new ByteArrayOutputStream();\n    +        BinaryOutputArchive boa = BinaryOutputArchive.getArchive(boas);\n    +        CreateRequest createRequest = new CreateRequest(path,\n    +                \"data\".getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL.toFlag());\n    +        createRequest.serialize(boa, \"request\");\n    +        ByteBuffer bb = ByteBuffer.wrap(boas.toByteArray());\n    +        return new Request(null, sessionId, 1, ZooDefs.OpCode.create2, bb, new ArrayList<>());\n    --- End diff --\n    \n    Same here (`new ArrayList<>`)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-21T00:43:42.436+0000","updated":"2017-03-21T00:43:42.436+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15933882","id":"15933882","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user hanm commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/195\n  \n    LGTM, except it does not build with JDK 7. Will merge after the fix.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-21T00:44:21.342+0000","updated":"2017-03-21T00:44:21.342+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15934781","id":"15934781","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user enixon commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/195#discussion_r107191973\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java ---\n    @@ -0,0 +1,135 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +\n    +package org.apache.zookeeper.server;\n    +\n    +import org.apache.jute.BinaryOutputArchive;\n    +import org.apache.zookeeper.CreateMode;\n    +import org.apache.zookeeper.KeeperException;\n    +import org.apache.zookeeper.Op;\n    +import org.apache.zookeeper.OpResult;\n    +import org.apache.zookeeper.ZooDefs;\n    +import org.apache.zookeeper.ZooKeeper;\n    +import org.apache.zookeeper.proto.CreateRequest;\n    +import org.apache.zookeeper.proto.GetDataRequest;\n    +import org.apache.zookeeper.server.quorum.QuorumPeer;\n    +import org.apache.zookeeper.server.quorum.QuorumZooKeeperServer;\n    +import org.apache.zookeeper.server.quorum.UpgradeableSessionTracker;\n    +import org.apache.zookeeper.test.QuorumBase;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +import org.slf4j.Logger;\n    +import org.slf4j.LoggerFactory;\n    +\n    +import java.io.ByteArrayOutputStream;\n    +import java.io.IOException;\n    +import java.nio.ByteBuffer;\n    +import java.util.ArrayList;\n    +import java.util.Arrays;\n    +import java.util.List;\n    +\n    +public class MultiOpSessionUpgradeTest extends QuorumBase {\n    +    protected static final Logger LOG = LoggerFactory.getLogger(MultiOpSessionUpgradeTest.class);\n    +\n    +    @Override\n    +    public void setUp() throws Exception {\n    +        localSessionsEnabled = true;\n    +        localSessionsUpgradingEnabled = true;\n    +        super.setUp();\n    +    }\n    +\n    +    @Test\n    +    public void ephemeralCreateMultiOpTest() throws KeeperException, InterruptedException, IOException {\n    +        final ZooKeeper zk = createClient();\n    +\n    +        String data = \"test\";\n    +        String path = \"/ephemeralcreatemultiop\";\n    +        zk.create(path, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n    +\n    +        QuorumZooKeeperServer server = getConnectedServer(zk.getSessionId());\n    +        Assert.assertNotNull(\"unable to find server interlocutor\", server);\n    +        UpgradeableSessionTracker sessionTracker = (UpgradeableSessionTracker)server.getSessionTracker();\n    +        Assert.assertFalse(\"session already global\", sessionTracker.isGlobalSession(zk.getSessionId()));\n    +\n    +        List<OpResult> multi = null;\n    +        try {\n    +            multi = zk.multi(Arrays.asList(\n    +                    Op.setData(path, data.getBytes(), 0),\n    +                    Op.create(path + \"/e\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL),\n    +                    Op.create(path + \"/p\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n    +                    Op.create(path + \"/q\", data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL)\n    +            ));\n    +        } catch (KeeperException.SessionExpiredException e) {\n    +            // the scenario that inspired this unit test\n    +            Assert.fail(\"received session expired for a session promotion in a multi-op\");\n    +        }\n    +\n    +        Assert.assertNotNull(multi);\n    +        Assert.assertEquals(4, multi.size());\n    +        Assert.assertEquals(data, new String(zk.getData(path + \"/e\", false, null)));\n    +        Assert.assertEquals(data, new String(zk.getData(path + \"/p\", false, null)));\n    +        Assert.assertEquals(data, new String(zk.getData(path + \"/q\", false, null)));\n    +        Assert.assertTrue(\"session not promoted\", sessionTracker.isGlobalSession(zk.getSessionId()));\n    +    }\n    +\n    +    @Test\n    +    public void directCheckUpgradeSessionTest() throws IOException, InterruptedException, KeeperException {\n    +        final ZooKeeper zk = createClient();\n    +\n    +        String path = \"/directcheckupgradesession\";\n    +        zk.create(path, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n    +\n    +        QuorumZooKeeperServer server = getConnectedServer(zk.getSessionId());\n    +        Assert.assertNotNull(\"unable to find server interlocutor\", server);\n    +\n    +        Request readRequest = makeGetDataRequest(path, zk.getSessionId());\n    +        Request createRequest = makeCreateRequest(path + \"/e\", zk.getSessionId());\n    +        Assert.assertNull(\"tried to upgrade on a read\", server.checkUpgradeSession(readRequest));\n    +        Assert.assertNotNull(\"failed to upgrade on a create\", server.checkUpgradeSession(createRequest));\n    +        Assert.assertNull(\"tried to upgrade after successful promotion\",\n    +                server.checkUpgradeSession(createRequest));\n    +    }\n    +\n    +    private Request makeGetDataRequest(String path, long sessionId) throws IOException {\n    +        ByteArrayOutputStream boas = new ByteArrayOutputStream();\n    +        BinaryOutputArchive boa = BinaryOutputArchive.getArchive(boas);\n    +        GetDataRequest getDataRequest = new GetDataRequest(path, false);\n    +        getDataRequest.serialize(boa, \"request\");\n    +        ByteBuffer bb = ByteBuffer.wrap(boas.toByteArray());\n    +        return new Request(null, sessionId, 1, ZooDefs.OpCode.getData, bb, new ArrayList<>());\n    --- End diff --\n    \n    Can't believe I missed those - something about them was bothering me about those lines when I was preparing the commit too.\n    \n    Will fix.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-21T15:44:46.671+0000","updated":"2017-03-21T15:44:46.671+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15934805","id":"15934805","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 2 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/464//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/464//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/464//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-21T16:07:26.635+0000","updated":"2017-03-21T16:07:26.635+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15934871","id":"15934871","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"Issue resolved by pull request 195\n[https://github.com/apache/zookeeper/pull/195]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2017-03-21T16:50:14.519+0000","updated":"2017-03-21T16:50:14.519+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15934872","id":"15934872","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/zookeeper/pull/195\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-21T16:50:21.846+0000","updated":"2017-03-21T16:50:21.846+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15934881","id":"15934881","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"Merged to master, https://github.com/apache/zookeeper/commit/63577ba52a829391ded3ae11c62c0e996865b5c7, thanks [~nixon] for the patch!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2017-03-21T16:54:04.730+0000","updated":"2017-03-21T16:54:04.730+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13056466/comment/15934943","id":"15934943","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Jenkins build ZooKeeper-trunk #3325 (See [https://builds.apache.org/job/ZooKeeper-trunk/3325/])\nZOOKEEPER-2725: Promote local session to global when ephemeral created (hanm: rev 63577ba52a829391ded3ae11c62c0e996865b5c7)\n* (edit) src/java/main/org/apache/zookeeper/server/quorum/QuorumZooKeeperServer.java\n* (add) src/java/test/org/apache/zookeeper/server/MultiOpSessionUpgradeTest.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-21T17:29:49.726+0000","updated":"2017-03-21T17:29:49.726+0000"}],"maxResults":19,"total":19,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2725/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3cc13:"}}