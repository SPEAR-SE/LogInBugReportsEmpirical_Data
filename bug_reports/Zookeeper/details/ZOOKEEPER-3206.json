{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13202006","self":"https://issues.apache.org/jira/rest/api/2/issue/13202006","key":"ZOOKEEPER-3206","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2018-12-03 14:23:41.838","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-3206/watchers","watchCount":1,"isWatching":false},"created":"2018-12-03T14:23:41.838+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12342973","id":"12342973","description":"Fix release against 3.4 branch","name":"3.4.13","archived":false,"released":true,"releaseDate":"2018-07-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-12-03T14:24:20.086+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12329415","id":"12329415","name":"kerberos"}],"timeoriginalestimate":null,"description":"We're using Active Directory, and created service principals this way:\r\n\r\n{code}\r\nktpass -princ ZOOKEEPER/host-1@TEST -mapuser zookeeper -mapOp  add -Target TEST\r\nktpass -princ ZOOKEEPER/host-2@TEST -mapuser zookeeper -mapOp  add -Target TEST\r\nktpass -princ ZOOKEEPER/host-3@TEST -mapuser zookeeper -mapOp  add -Target TEST\r\n{code}\r\n\r\nUsing this format, one is not able to do {code}kinit ZOOKEEPER/host-1@TEST{code}, but one is able to do {code}kinit zookeeper@TEST -S ZOOKEEPER/host-1@TEST{code} to obtain a service ticket. \r\n\r\nIn the Kafka project, it is fine for the JAAS file to have {code}principal=\"kafka@TEST\"{code}, and automatically it seems it acquires the correct service ticket (I\"m not sure how).\r\n\r\nIn zookeeper, things fail when a client tries to connect, due to this line:\r\nhttps://github.com/apache/zookeeper/blob/master/zookeeper-server/src/main/java/org/apache/zookeeper/util/SecurityUtils.java#L170\r\n\r\nIt'd be great for Zookeeper server to have the same kind of mechanism as Kafka for accepting client connections. This would allow us to have {code}principal=\"zookeeper@TEST\"{code} in JAAS. Otherwise, maybe support a JAAS new option so we can explicitly name the service ?\r\n\r\nFYI - trying {code}principal=\"zookeeper/host-1@TEST\"{code} does not work as due to how Active Directory works, it complains that the credentials cannot be found in the database (as we try to authenticate using the service name, not the user name)\r\n\r\nI'm attaching some documentation I find relevant: https://serverfault.com/questions/682374/client-not-found-in-kerberos-database-while-getting-initial/683058#683058 \r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Can't use Active Directory for Kerberos Authentication","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stephane.maarek%40gmail.com","name":"stephane.maarek@gmail.com","key":"stephane.maarek@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stephane.maarek%40gmail.com&avatarId=31515","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stephane.maarek%40gmail.com&avatarId=31515","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stephane.maarek%40gmail.com&avatarId=31515","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stephane.maarek%40gmail.com&avatarId=31515"},"displayName":"Stephane Maarek","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stephane.maarek%40gmail.com","name":"stephane.maarek@gmail.com","key":"stephane.maarek@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stephane.maarek%40gmail.com&avatarId=31515","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stephane.maarek%40gmail.com&avatarId=31515","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stephane.maarek%40gmail.com&avatarId=31515","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stephane.maarek%40gmail.com&avatarId=31515"},"displayName":"Stephane Maarek","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-3206/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|s013wg:"}}