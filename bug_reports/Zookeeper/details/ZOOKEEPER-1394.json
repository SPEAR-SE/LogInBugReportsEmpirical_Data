{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12543484","self":"https://issues.apache.org/jira/rest/api/2/issue/12543484","key":"ZOOKEEPER-1394","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2013-06-18T15:01:03.098+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Oct 31 12:36:14 UTC 2016","customfield_12310420":"228730","customfield_12312320":null,"customfield_12310222":"1_*:*_2_*:*_148042667230_*|*_3_*:*_2_*:*_51249_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_3_*:*_7036847","customfield_12312321":null,"resolutiondate":"2016-10-31T02:22:52.536+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1394/watchers","watchCount":5,"isWatching":false},"created":"2012-02-21T13:26:57.988+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319196","id":"12319196","description":"Fix release against 3.4 branch.","name":"3.4.2","archived":false,"released":true,"releaseDate":"2011-12-29"}],"issuelinks":[{"id":"12484278","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12484278","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"13014265","key":"ZOOKEEPER-2618","self":"https://issues.apache.org/jira/rest/api/2/issue/13014265","fields":{"summary":"fix ClassNotFoundException on shutdown of client","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}},{"id":"12484759","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12484759","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12679495","key":"ZOOKEEPER-1816","self":"https://issues.apache.org/jira/rest/api/2/issue/12679495","fields":{"summary":"ClientCnxn.close() should block until threads have died","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12494572","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12494572","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13043637","key":"ZOOKEEPER-2697","self":"https://issues.apache.org/jira/rest/api/2/issue/13043637","fields":{"summary":"Handle graceful stop of ZookKeeper client","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-02-17T13:44:52.255+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312381","id":"12312381","name":"java client","description":"The java client interface for ZooKeeper"}],"timeoriginalestimate":null,"description":"When close() is called on the ZooKeeper instance from a ContextListener (contextDestroyed) there is no way to synchronize with the fact that the EventThread and SendThread have actually finished their work. The problem lies in the SendThread which makes a call to ZooTrace when it exits, but that class has not been loaded yet. Because the ContextListener could not synchronize with the death of the threads the classloader has already disappeared, resulting in a ClassNotFoundException.\nMy personal opinion is that the close() method should probably wait until the event and send thread have actually died.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12835341","id":"12835341","filename":"ZOOKEEPER-1394.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-10-26T14:18:05.941+0000","size":1398,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12835341/ZOOKEEPER-1394.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"32576","customfield_12312823":null,"summary":"ClassNotFoundException on shutdown of client","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=meerlol","name":"meerlol","key":"meerlol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Herman Meerlo","active":true,"timeZone":"Europe/Berlin"},"subtasks":[{"id":"13014265","key":"ZOOKEEPER-2618","self":"https://issues.apache.org/jira/rest/api/2/issue/13014265","fields":{"summary":"fix ClassNotFoundException on shutdown of client","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=meerlol","name":"meerlol","key":"meerlol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Herman Meerlo","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"OS X 10.7 java version \"1.6.0_29\"","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/13686804","id":"13686804","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmorelli","name":"cmorelli","key":"cmorelli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Colin Morelli","active":true,"timeZone":"America/New_York"},"body":"Can this call to ZooTrace be replaced with another logging call (since basically all other logging to ZooTrace has been removed anyway)? This is sort of an annoying thing to see in the logs during every shutdown of an application. In fact, a temporary \"fix\" has been put in place to make a call to ZooTrace before calling close() so that the class is actually loaded in memory. This works, but it's ugly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cmorelli","name":"cmorelli","key":"cmorelli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Colin Morelli","active":true,"timeZone":"America/New_York"},"created":"2013-06-18T15:01:03.098+0000","updated":"2013-06-18T15:01:03.098+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15608345","id":"15608345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12835316/ZOOKEEPER-1394.patch\n  against trunk revision f6349d16fcd5f04b560095417fd2a1813ac3e855.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3502//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3502//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3502//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2016-10-26T12:42:18.009+0000","updated":"2016-10-26T12:42:18.009+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15608591","id":"15608591","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"The patch is trivial and it simply replaces the call to {{ZooTrace}} with {{LOG.debug}}, but I'm not convinced that this is the right way to fix this issue. In fact, I'm not even sure I fully understand the issue. Is there a way to reliably reproduce it?\n\nI'm also thinking that {{ZooTrace}} is a bit abandoned, so we might want to make some fixes there.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-10-26T14:23:04.029+0000","updated":"2016-10-26T14:23:04.029+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15608595","id":"15608595","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Canceling patch until we converge.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-10-26T14:23:29.567+0000","updated":"2016-10-26T14:23:29.567+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15610360","id":"15610360","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"body":"Look here http://zookeeper-user.578899.n2.nabble.com/java-lang-NoClassDefFoundError-org-apache-zookeeper-server-ZooTrace-td7578739.html\n\nwhen using Zookeeper client API in tomcat and shut down tomcat.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-10-27T02:03:38.306+0000","updated":"2016-10-27T02:03:38.306+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15610385","id":"15610385","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"body":"\balso in  jboss\n\njBPMClusteredScheduler_$_brmsperf02.mw.lab.eng.bos.redhat.com1425567199094 shutdown complete.\n09:58:29,651 INFO  [org.jbpm.executor.impl.ExecutorImpl] (MSC service thread 1-6)  >>>>> Destroying Executor !!!\n09:58:29,733 ERROR [org.apache.zookeeper.ClientCnxn] (MSC service thread 1-6-SendThread(brmsperf03:2181)) from MSC service thread 1-6-SendThread(brmsperf03:2181): java.lang.NoClassDefFoundError: org/apache/zookeeper/server/ZooTrace\n\tat org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1223) [zookeeper-3.3.4.jar:3.3.3-1203054]\nCaused by: java.lang.ClassNotFoundException: org.apache.zookeeper.server.ZooTrace from [Module \"deployment.business-central.war:main\" from Service Module Loader]\n\tat org.jboss.modules.ModuleClassLoader.findClass(ModuleClassLoader.java:213) [jboss-modules.jar:1.3.6.Final-redhat-1]\n\tat org.jboss.modules.ConcurrentClassLoader.performLoadClassUnchecked(ConcurrentClassLoader.java:459) [jboss-modules.jar:1.3.6.Final-redhat-1]\n\tat org.jboss.modules.ConcurrentClassLoader.performLoadClassChecked(ConcurrentClassLoader.java:408) [jboss-modules.jar:1.3.6.Final-redhat-1]\n\tat org.jboss.modules.ConcurrentClassLoader.performLoadClass(ConcurrentClassLoader.java:389) [jboss-modules.jar:1.3.6.Final-redhat-1]\n\tat org.jboss.modules.ConcurrentClassLoader.loadClass(ConcurrentClassLoader.java:134) [jboss-modules.jar:1.3.6.Final-redhat-1]\n\t... 1 more\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-10-27T02:19:53.766+0000","updated":"2016-10-27T02:19:53.766+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15611715","id":"15611715","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Let me elaborate. I understand that folks are getting it with Tomcat and JBoss, but why would the class not be found? Is it because it is not loading the server package? Would it make any difference if {{ZooTrace}} were in a different package?\n\nIt is not a big deal to remove that {{ZooTrace}} call because it is really the only call to {{ZooTrace}} in the client currently, but I'd rather understand why it happens and fix the problem rather than remove the call if possible. Do you understand why this happens, [~wuwen]n? I read the explanation in the description, but I don't understand why the class isn't being loaded. Granted that I don't understand Tomcat and JBoss well enough to determine whether it is problem with those frameworks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-10-27T12:20:20.018+0000","updated":"2016-10-27T12:20:20.018+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15611729","id":"15611729","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eolivelli","name":"eolivelli","key":"eolivelli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Enrico Olivelli","active":true,"timeZone":"Europe/Rome"},"body":"I get regularly into this error. \nIMHO the problem is that the container closes  the Classloader and so no class can be loaded anymore.\nAnother fix is to make the client eagerly load the ZooTrace class by using it at boot or in other convenient place.\nA workaround can be to use the ZooTrace class in the WebApplication and so force the classloader to load it","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eolivelli","name":"eolivelli","key":"eolivelli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Enrico Olivelli","active":true,"timeZone":"Europe/Rome"},"created":"2016-10-27T12:27:19.133+0000","updated":"2016-10-27T12:27:19.133+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15611961","id":"15611961","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"body":"i think this is a class loading time problem,If ZooTrace.xxx()  has been used already before the application stopped, it can be loaded normally.\n\n{code:java}\nclass SendThread extends Thread {\n        //..igonre       \n        @Override\n        public void run() {\n          //..igonre\n\n            //*********for example， If ZooTrace is called here, the problem does not occur.*******\n            ZooTrace.logTraceMessage(LOG, ZooTrace.getTextTraceLevel(),\n                                     \"SendThread starting loop.\");\n\n            while (state.isAlive()) {\n                //..igonre\n                //there is loop\n\n            }\n\n            //...executing\n\n            /***At this time, may be this web application instance has been stopped already.**/\n        \n   /**java.lang.IllegalStateException: Illegal access: this web application instance has been stopped already. Could not         load [org.apache.zookeeper.server.ZooTrace]**/\n            //The container seems to think this is an illegal load\n            ZooTrace.logTraceMessage(LOG, ZooTrace.getTextTraceLevel(),\n                                     \"SendThread exitedloop.\");\n        }\n\n        void close() {\n            state = States.CLOSED;\n            clientCnxnSocket.wakeupCnxn();\n        }\n       \n    }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-10-27T13:55:00.294+0000","updated":"2016-10-27T13:55:00.294+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15617726","id":"15617726","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi [~fpj], I start to agree that this is not a problem, the problem is that the application does not have a graceful shutdown.\ni think zookeeper client should be closed before application shutdown, rather than rely on shutdownhook.\nDoes this \bissue need to be closed?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-10-29T08:34:31.615+0000","updated":"2016-10-29T08:34:31.615+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15617816","id":"15617816","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Hi [~wuwen], If we agree that it isn't an issue, then we do resolve this jira with \"Not a problem\". But, [~eolivelli] seems to be observing this problem as well, so I wonder if he agrees that shutting down zk before the application in his setting solves the problem. It sounds right to me, though.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2016-10-29T09:28:53.021+0000","updated":"2016-10-29T09:28:53.021+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15620987","id":"15620987","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi [~eolivelli] there are two solutions\n1. shutting down zk client before the application.\n2. to make the client eagerly load the ZooTrace class by using it at boot or in other convenient place.\n\nI think the problem is that the application does not have a graceful shutdown.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-10-31T02:19:11.484+0000","updated":"2016-10-31T10:10:35.990+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15620993","id":"15620993","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"body":"shutting down zk client before the application.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-10-31T02:22:53.039+0000","updated":"2016-10-31T10:11:00.447+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15621801","id":"15621801","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=meerlol","name":"meerlol","key":"meerlol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Herman Meerlo","active":true,"timeZone":"Europe/Berlin"},"body":"Ok, my 2 cents as the original filer of the issue (even though it was almost 5 years ago and I'm no longer working with ZooKeeper at the moment). The problem happened when trying to shut down zookeeper gracefully when the application is shut down. As the report mentions zookeeper was being stopped in the contextdestroyed (the only hook there is in an application container). So nothing was done wrong in my opinion.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=meerlol","name":"meerlol","key":"meerlol","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Herman Meerlo","active":true,"timeZone":"Europe/Berlin"},"created":"2016-10-31T10:16:53.298+0000","updated":"2016-10-31T10:16:53.298+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15622001","id":"15622001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eolivelli","name":"eolivelli","key":"eolivelli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Enrico Olivelli","active":true,"timeZone":"Europe/Rome"},"body":"In my case I use ZooKeeper.close() in contextDestroyed() method of my ServletContextListener\n\nI think that call does not wait for all the support threads to finish\n\nmaybe it is the same of ZOOKEEPER-1916\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eolivelli","name":"eolivelli","key":"eolivelli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Enrico Olivelli","active":true,"timeZone":"Europe/Rome"},"created":"2016-10-31T12:19:17.840+0000","updated":"2016-10-31T12:19:17.840+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543484/comment/15622033","id":"15622033","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"body":"You can try to use the {{@PreDestroy}}  annotation to close the zkclient.\n\nfor example\n{code:java}\n@PreDestroy\npublic void destroy() {\n       ZooKeeper.close();\n}\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wuwen","name":"wuwen","key":"wuwen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wu wen","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-10-31T12:36:14.495+0000","updated":"2016-10-31T12:36:14.495+0000"}],"maxResults":16,"total":16,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1394/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i05xt3:"}}