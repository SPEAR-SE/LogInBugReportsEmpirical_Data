{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12457960","self":"https://issues.apache.org/jira/rest/api/2/issue/12457960","key":"ZOOKEEPER-684","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313976","id":"12313976","description":"Improved manageability and simplified client development process.","name":"3.3.0","archived":false,"released":true,"releaseDate":"2010-03-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-03-05T22:50:43.117+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 10 02:01:10 UTC 2010","customfield_12310420":"47652","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_572980756_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-03-10T01:28:19.976+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-684/watchers","watchCount":1,"isWatching":false},"created":"2010-03-03T10:18:39.220+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12330671","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12330671","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12458604","key":"ZOOKEEPER-695","self":"https://issues.apache.org/jira/rest/api/2/issue/12458604","fields":{"summary":"Need to remove the lookForLeader duplicated code in LENonTerminateTest","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-03-26T17:25:11.278+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312378","id":"12312378","name":"leaderElection","description":"Leader election algorithm for ZooKeeper"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"testNonTermination failed during a Hudson run for ZOOKEEPER-59. After inspecting the output, it looks like server is electing 2 as a leader and leaving. Given that 2 is just a mock server, server 0 remains alone in leader election.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12438341","id":"12438341","filename":"ZOOKEEPER-684.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T23:03:09.934+0000","size":17843,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12438341/ZOOKEEPER-684.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12438336","id":"12438336","filename":"ZOOKEEPER-684.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T22:48:34.277+0000","size":17820,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12438336/ZOOKEEPER-684.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12438309","id":"12438309","filename":"ZOOKEEPER-684.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T19:08:25.227+0000","size":1465,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12438309/ZOOKEEPER-684.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12437730","id":"12437730","filename":"zookeeper-684-test-failure.rtf","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2010-03-03T10:20:11.017+0000","size":16813,"mimeType":"application/rtf","content":"https://issues.apache.org/jira/secure/attachment/12437730/zookeeper-684-test-failure.rtf"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"32925","customfield_12312823":null,"summary":"Race in LENonTerminateTest","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12840562","id":"12840562","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Uploading the output of the test from the Hudson run of ZOOKEEPER-59. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2010-03-03T10:20:11.083+0000","updated":"2010-03-03T10:20:11.083+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12842068","id":"12842068","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"The race we observe in the log attached should only happen if the socket times out after 200ms in LeaderElection.java. In regular runs, I wouldn't expect it to time out, but on a very slow machine it could happen. If we start observing it often, we might consider increasing the socket time out value to avoid false positives. \n\nFor now, my recommendation is that we don't fix it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2010-03-05T22:32:18.957+0000","updated":"2010-03-05T22:32:18.957+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12842083","id":"12842083","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Pushing to 3.4.0 per Flavio's comment.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-05T22:50:43.117+0000","updated":"2010-03-05T22:50:43.117+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843229","id":"12843229","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Sorry, Flavio is saying this is the issue, not ZOOKEEPER-675","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T18:36:50.953+0000","updated":"2010-03-09T18:36:50.953+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843232","id":"12843232","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Ben is saying the test fails every third time he runs the test.\n\nFlavio is saying we need to either rewrite the test  to elim race condition or address via his previous comment (incr timeout)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T18:40:54.839+0000","updated":"2010-03-09T18:40:54.839+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843241","id":"12843241","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"body":"According to the logs, it looks like the problem is that thread 1 is getting two votes for server 2. This happens because thread 0 votes for 2 rather than itself as it has already received a full complement of votes.\n\nThe race is therefore that thread 0 collects all its votes and updates its own vote before thread 1 is responded to. \n\nTo fix, I propose adding a CountdownLatch between lookForLeader and setCurrentVote to ensure that both thread 0 and thread 1 manage one round of voting before updating their choices. I can't recreate the error here, so I'll offer a patch for Ben to hopefully try.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T18:53:48.519+0000","updated":"2010-03-09T18:53:48.519+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843249","id":"12843249","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"body":"Here's a patch - Ben, can you try it and see if this does anything for the failures you're seeing? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T19:08:25.292+0000","updated":"2010-03-09T19:08:25.292+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843279","id":"12843279","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Henry, if I understand correctly your patch, in the case we have an execution like the one of the log attached in this issue, then the test would fail because the latch would never count down to zero. Is this correct? If so, I don't understand how it improves the test.\n\nMy understanding of the race is that in the first round, server 0 receives a vote from mock server 2, but server 1 does not receive a vote from 2 (udp socket times out while waiting to receive). In the second round, server 1 receives vote from 0 and from 2, both voting for 2, and consequently server 1 elects 2. I think this is what you observe too in your last comment. If the receive call is timing out too soon, don't we have to increase the time out value? I understand that this is not desirable because it increases election time, but if it the current value is not sufficient, then I don't see a better option.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2010-03-09T20:46:06.215+0000","updated":"2010-03-09T20:46:06.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843285","id":"12843285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"it failed on my machine with the patch. it looks identical:\n\n2010-03-09 12:55:28,703 - INFO  [Thread-1:LeaderElection@109] - 0       -> 1\n2010-03-09 12:55:28,704 - INFO  [Thread-1:LeaderElection@109] - 2       -> 1\n2010-03-09 12:55:28,704 - INFO  [Thread-1:LeaderElection@109] - 1       -> 1\n2010-03-09 12:55:28,704 - INFO  [Thread-2:LeaderElection@155] - Server address: /127.0.0.1:11221\n2010-03-09 12:55:28,705 - INFO  [Thread-2:LeaderElection@155] - Server address: /127.0.0.1:11223\n2010-03-09 12:55:28,706 - INFO  [Thread-2:LeaderElection@155] - Server address: /127.0.0.1:11225\n2010-03-09 12:55:28,706 - INFO  [Thread-2:LeaderElection@103] - Election tally:\n2010-03-09 12:55:28,707 - INFO  [Thread-2:LeaderElection@109] - 2       -> 2\n2010-03-09 12:55:28,707 - INFO  [Thread-2:LeaderElection@109] - 1       -> 1\n2010-03-09 12:55:28,708 - INFO  [Thread-2:LeaderElection@218] - Found leader: my type is: PARTICIPANT\n2010-03-09 12:55:29,705 - INFO  [Thread-1:LeaderElection@155] - Server address: /127.0.0.1:11221\n2010-03-09 12:55:29,706 - INFO  [Thread-1:LeaderElection@155] - Server address: /127.0.0.1:11223\n2010-03-09 12:55:29,710 - INFO  [Thread-1:LeaderElection@155] - Server address: /127.0.0.1:11225\n2010-03-09 12:55:29,911 - WARN  [Thread-1:LeaderElection@195] - Ignoring exception while looking for leader\njava.net.SocketTimeoutException: Receive timed out\n        at java.net.PlainDatagramSocketImpl.receive0(Native Method)\n        at java.net.PlainDatagramSocketImpl.receive(PlainDatagramSocketImpl.java:136)\n        at java.net.DatagramSocket.receive(DatagramSocket.java:712)\n        at org.apache.zookeeper.server.quorum.LeaderElection.lookForLeader(LeaderElection.java:171)\n        at org.apache.zookeeper.test.LENonTerminateTest$LEThread.run(LENonTerminateTest.java:87)\n2010-03-09 12:55:29,912 - INFO  [Thread-1:LeaderElection@103] - Election tally:\n2010-03-09 12:55:30,913 - INFO  [Thread-1:LeaderElection@155] - Server address: /127.0.0.1:11221\n2010-03-09 12:55:30,914 - INFO  [Thread-1:LeaderElection@155] - Server address: /127.0.0.1:11223\n2010-03-09 12:55:30,915 - INFO  [Thread-1:LeaderElection@155] - Server address: /127.0.0.1:11225\n2010-03-09 12:55:31,116 - WARN  [Thread-1:LeaderElection@195] - Ignoring exception while looking for leader\njava.net.SocketTimeoutException: Receive timed out\n        at java.net.PlainDatagramSocketImpl.receive0(Native Method)\n        at java.net.PlainDatagramSocketImpl.receive(PlainDatagramSocketImpl.java:136)\n        at java.net.DatagramSocket.receive(DatagramSocket.java:712)\n        at org.apache.zookeeper.server.quorum.LeaderElection.lookForLeader(LeaderElection.java:171)\n        at org.apache.zookeeper.test.LENonTerminateTest$LEThread.run(LENonTerminateTest.java:87)\n2010-03-09 12:55:31,117 - INFO  [Thread-1:LeaderElection@103] - Election tally:\n2010-03-09 12:55:31,118 - INFO  [Thread-1:LeaderElection@109] - 0       -> 1\n2010-03-09 12:55:32,119 - INFO  [Thread-1:LeaderElection@155] - Server address: /127.0.0.1:11221\n\nthe last part keeps repeating.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T20:58:15.300+0000","updated":"2010-03-09T20:58:15.300+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843286","id":"12843286","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"btw, i'm getting the failure on a coreduo laptop running ubuntu.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T20:58:42.146+0000","updated":"2010-03-09T20:58:42.146+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843292","id":"12843292","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm seeing this as well - coreduo with karmic 64bit\n\njava version \"1.6.0_15\"\nJava(TM) SE Runtime Environment (build 1.6.0_15-b03)\nJava HotSpot(TM) 64-Bit Server VM (build 14.1-b02, mixed mode)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T21:09:38.896+0000","updated":"2010-03-09T21:09:38.896+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843295","id":"12843295","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"body":"Flavio - \n\nLooking at this excerpt from round one: \n\n2010-03-03 04:56:54,630 - INFO  [Thread-0:LeaderElection@155] - Server address: 0.0.0.0/0.0.0.0:11223\n2010-03-03 04:56:54,631 - INFO  [Thread-0:LeaderElection@155] - Server address: 0.0.0.0/0.0.0.0:11225\n2010-03-03 04:56:54,630 - INFO  [Thread-1:LeaderElection@155] - Server address: 0.0.0.0/0.0.0.0:11221\n2010-03-03 04:56:54,632 - INFO  [Thread-0:LeaderElection@103] - Election tally: \n2010-03-03 04:56:54,632 - INFO  [Thread-0:LeaderElection@109] - 0\t-> 1\n2010-03-03 04:56:54,632 - INFO  [Thread-0:LeaderElection@109] - 2\t-> 1\n2010-03-03 04:56:54,632 - INFO  [Thread-0:LeaderElection@109] - 1\t-> 1\n2010-03-03 04:56:54,633 - INFO  [Thread-1:LeaderElection@155] - Server address: 0.0.0.0/0.0.0.0:11223\n2010-03-03 04:56:54,633 - INFO  [Thread-1:LeaderElection@155] - Server address: 0.0.0.0/0.0.0.0:11225\n2010-03-03 04:56:54,633 - INFO  [Thread-1:LeaderElection@103] - Election tally: \n2010-03-03 04:56:54,634 - INFO  [Thread-1:LeaderElection@109] - 2\t-> 2\n2010-03-03 04:56:54,634 - INFO  [Thread-1:LeaderElection@109] - 1\t-> 1\n2010-03-03 04:56:54,634 - INFO  [Thread-1:LeaderElection@218] - Found leader: my type is: PARTICIPANT\n\nThread 1 has received 2 votes for server 2 as the leader. It then exits, and this is the problem, I think. As a result, Thread 0 can never get a quorum. \n\nTherefore my thought was to put a barrier after all servers have done one round, but not updated their results. Unfortunately, it looks like line 212 in LeaderElection.java upsets this plan as the thread's current vote is set here. \n\nSo Thread 0 gets one vote for every server. It sets its vote to 2 and then replies to Thread 1 which therefore sees two votes for server 2. What we want to happen is Thread 0 gets one vote for every server, but replies to Thread 1 before it does so. I'm unclear on an easy way to mock up this interleaving - the LeaderElection code is hard to stub out. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T21:11:44.078+0000","updated":"2010-03-09T21:11:44.078+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843299","id":"12843299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"body":"I have a number of options here, would appreciate thoughts on the right one to go with:\n\n1. Write a tricky proxy that intercepts messages for Thread 0 and replies with the 'right' message for this interleaving. \n2. Subclass LeaderElection.java with a class that has an almost identical copy of lookForLeader, but puts the latch code just before the setCurrentVote call so that all threads have done one round simultaneously.\n3. Deactivate the test for 3.3.0\n\nI don't like 3, and 1 is too tricky. I'm going to go with 2 for now, although it is ugly, because it is correct and hopefully relatively quick to do. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T21:19:12.420+0000","updated":"2010-03-09T21:19:12.420+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843300","id":"12843300","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I agree with your observation: \"Thread 1 has received 2 votes for server 2 as the leader. It then exits, and this is the problem, I think. As a result, Thread 0 can never get a quorum.\" And, my interpretation is that it happens because server 1 is timing out before receiving the vote of server 2 in round 1. Server 1 then receives in the second round the vote of mock server 2 and the vote of server 0 (also supporting 2), which cause server 1 to leave prematurely.\n\nI also don't think your patch works because \"peer.getElectionAlg().lookForLeader()\" won't return until the election is over. That method is not called for each round.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2010-03-09T21:19:19.162+0000","updated":"2010-03-09T21:19:19.162+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843303","id":"12843303","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm not totally clear that thread 1 is timing out. In the trace attached to this JIRA, the first timeout is Thread-0 which is timing out when talking either to thread 1 or thread 2. In particular, Thread-1 seems to be getting three votes in its first round. Can you help me find the UDP timeout you're talking about?\n\n(you're right, the patch doesn't work for a number of reasons :))","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T21:28:17.358+0000","updated":"2010-03-09T21:28:17.358+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843316","id":"12843316","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"You might find more detail here, hudson trunk just failed with this error: \nhttp://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/724/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T21:54:32.726+0000","updated":"2010-03-09T21:54:32.726+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843340","id":"12843340","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"body":"This patch includes a fairly hacky mocking out of LeaderElection to fix the observed race, and another improvement to fix another race that cropped up (mockServer not starting in time, leading to a potential timeout like Flavio suggested).\n\nI could reproduce a failure before this patch was finished, and can't now, but please test yourselves. \n\nIn order to mock QuorumPeer and LeaderElection I made a number of member variables protected rather than private, and put 'running' behind a getter / setter interface. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T22:48:34.327+0000","updated":"2010-03-09T22:48:34.327+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843349","id":"12843349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"body":"Rebased patch off trunk (fix for new Factory constructor)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henryr","name":"henryr","key":"henryr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henry Robinson","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-09T23:03:09.938+0000","updated":"2010-03-09T23:03:09.938+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843376","id":"12843376","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"this addressed the problem on my system.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-10T00:20:20.209+0000","updated":"2010-03-10T00:20:20.209+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843387","id":"12843387","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 ok it works on my machine now and the code looks fine except for the copy of lookForLeader in the testcase. i support the commit if we open a related jira to fix it in the next release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-10T00:54:04.924+0000","updated":"2010-03-10T00:54:04.924+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843392","id":"12843392","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed revision 921201.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-10T01:28:19.972+0000","updated":"2010-03-10T01:28:19.972+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457960/comment/12843398","id":"12843398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in ZooKeeper-trunk #726 (See [http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/726/])\n    . Race in LENonTerminateTest\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-10T02:01:10.011+0000","updated":"2010-03-10T02:01:10.011+0000"}],"maxResults":22,"total":22,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-684/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i05zyn:"}}