{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12403150","self":"https://issues.apache.org/jira/rest/api/2/issue/12403150","key":"ZOOKEEPER-127","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313216","id":"12313216","description":"","name":"3.0.0","archived":false,"released":true,"releaseDate":"2008-10-27"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-08-27T13:25:05.013+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Oct 26 01:10:42 UTC 2008","customfield_12310420":"48039","customfield_12312320":null,"customfield_12310222":"10002_*:*_3_*:*_573274195_*|*_1_*:*_3_*:*_2434027171_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_2133026869","customfield_12312321":null,"resolutiondate":"2008-10-01T08:40:15.366+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-127/watchers","watchCount":2,"isWatching":false},"created":"2008-08-27T13:18:34.883+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"7.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313216","id":"12313216","description":"","name":"3.0.0","archived":false,"released":true,"releaseDate":"2008-10-27"}],"issuelinks":[{"id":"12321685","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12321685","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"inwardIssue":{"id":"12404291","key":"ZOOKEEPER-140","self":"https://issues.apache.org/jira/rest/api/2/issue/12404291","fields":{"summary":"Deadlock in QuorumCnxManager","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12327779","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12327779","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"outwardIssue":{"id":"12404370","key":"ZOOKEEPER-141","self":"https://issues.apache.org/jira/rest/api/2/issue/12404370","fields":{"summary":"Remove challenge on QuorumCnxManager","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-11-12T15:23:30.842+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312379","id":"12312379","name":"quorum","description":"Quorum determination for ZooKeeper"}],"timeoriginalestimate":null,"description":"In QuorumCnxManager.toSend there is a call to create a connection as follows:\n    channel = SocketChannel.open(new InetSocketAddress(addr, port));\n\nUnfortunately \"addr\" is the ip address of a remote server while \"port\" is the electionPort of *this* server.\nAs an example, given this configuration (taken from my zoo.cfg)\n  server.1=10.20.9.254:2881\n  server.2=10.20.9.9:2882\n  server.3=10.20.9.254:2883\nServer 3 was observed trying to make a connection to host 10.20.9.9 on port 2883 and obviously failing.\n\nIn tests where all machines use the same electionPort this bug would not manifest itself.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12389174","id":"12389174","filename":"mhPortChanges.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markh","name":"markh","key":"markh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Harwood","active":true,"timeZone":"Etc/UTC"},"created":"2008-08-29T14:59:58.181+0000","size":19700,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12389174/mhPortChanges.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12390908","id":"12390908","filename":"ZOOKEEPER-127.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-25T08:34:18.111+0000","size":96878,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12390908/ZOOKEEPER-127.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12390532","id":"12390532","filename":"ZOOKEEPER-127.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-19T20:06:07.851+0000","size":64781,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12390532/ZOOKEEPER-127.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12390398","id":"12390398","filename":"ZOOKEEPER-127.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-18T18:20:06.813+0000","size":53814,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12390398/ZOOKEEPER-127.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12390250","id":"12390250","filename":"ZOOKEEPER-127.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-17T09:35:37.885+0000","size":50722,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12390250/ZOOKEEPER-127.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12390229","id":"12390229","filename":"ZOOKEEPER-127.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-16T23:09:46.914+0000","size":50216,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12390229/ZOOKEEPER-127.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12390122","id":"12390122","filename":"ZOOKEEPER-127.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-15T17:04:04.458+0000","size":33906,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12390122/ZOOKEEPER-127.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"33220","customfield_12312823":null,"summary":"Use of non-standard election ports in config breaks services","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markh","name":"markh","key":"markh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Harwood","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markh","name":"markh","key":"markh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Harwood","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12626107","id":"12626107","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Thanks for pointing it out, Mark. If I recall correctly, electionPort is the port that all peers use for leader election, so in the currently implementation \"electionPort\" doesn't mean the port of this peer, but instead the port that all peers use for leader election. If we allow a different port for each peer, then we would need a line in the configuration file for each peer for leader election, right? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-08-27T13:25:05.013+0000","updated":"2008-08-27T13:25:05.013+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12626139","id":"12626139","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markh","name":"markh","key":"markh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Harwood","active":true,"timeZone":"Etc/UTC"},"body":"Thanks for the quick response, Flavio.\n\n>>If we allow a different port for each peer, then we would need a line in the configuration file for each peer for leader election, right?\n\nI currently do that. The config file allows you to specify an \"electionPort\" property which is read by QuorumPeerConfig. \nThe javadocs for QuorumPeer don't document this but my assumption was that this was a legitimate setting and I could choose different values for each server as long as they all tied up OK.\nThis worked out OK for me using the sourceforge 2.2.1 version.\n\nThe main reason for me wanting to mess around with ports in this way was to allow me to test Zookeeper services out on my single development machine where I could fire up and kill individual processes. I imagine it may not be uncommon for people starting with Zookeeper to want to do this so I would suggest doing one of the following:\n\n1) Documenting clearly that electionPorts must be the same on all machines (but this would disallow my scenario of single-machine testing of multiple QuorumPeerMain processes)\n2) Fixing the code to allow multiple electionPorts to be used.\n\nAm I understanding this correctly?\nThanks,\nMark\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markh","name":"markh","key":"markh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Harwood","active":true,"timeZone":"Etc/UTC"},"created":"2008-08-27T14:38:23.478+0000","updated":"2008-08-27T14:38:23.478+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12626243","id":"12626243","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"This needs to be fixed. I'm not sure how the tests are passing since all the peers are going to bind to the same port.\n\nI would propose removing the electionPort property and adding a port to the server configuration line:  server.X=addr:quorum_port:le_port\n\nso \n  server.1=10.20.9.254:2881\n  server.2=10.20.9.9:2882\n  server.3=10.20.9.254:2883\n\nbecomes\n  server.1=10.20.9.254:2881:3881\n  server.2=10.20.9.9:2882:3882\n  server.3=10.20.9.254:2883:3883\n\nfor example.\n\nIf the le_port isn't specified should we assume to le_port is one more than the quorum port? server.1=10.20.9.254:2881 is the same as server.1=10.20.9.254:2881:2882?\n\nThe first order of business should probably be to figure out why the test cases are not broken...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-08-27T18:45:20.850+0000","updated":"2008-08-27T18:45:20.850+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12626251","id":"12626251","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"Actually Pat showed me that the tests are passing because we don't use configuration files and instead instantiate QuorumPeers directly. It would probably be good to change the tests to use configuration files to get a more end-to-end test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-08-27T18:56:18.474+0000","updated":"2008-08-27T18:56:18.474+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12626635","id":"12626635","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markh","name":"markh","key":"markh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Harwood","active":true,"timeZone":"Etc/UTC"},"body":"Not good news on this I think.\nI got as far as changing the QuoromPeerConfig parsing code and replacing the \"addr\" property in QuorumServer with electionAddress and qourumAddress for use around the place.\n\nThe main issue I ran into is that the code in QuorumCnxManager seems to rely solely on ip address (without port) in many cases. As initially pointed out here, QuorumCnxManager uses its *own* choice of election port and combines it with IP address to talk to remote servers (a problem if they happen to use different election ports e.g. required when running on the same machine). \nTo address this I started off with the assumption that all existing references to INetAddress in this class should probably be substituted for INetSocketAddress to more correctly identify the references to each service.\n\nWhile I was able to change most code to use InetSocketAddress in place of INetAddress (e.g. in senderWorkerMap) I found that this was not possible in RecvWorker. In its constructor it is reliant on using the IP address of the connecting client to identify the caller and is therefore unaware of the electionPort that might be needed to differentiate between more than one QuorumPeer running on the same machine when calling back. To get around this the server id (from myid) is probably required to be passed as part of the communication protocols in order to authenticate different callers.\n\nIck!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markh","name":"markh","key":"markh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Harwood","active":true,"timeZone":"Etc/UTC"},"created":"2008-08-28T16:08:30.810+0000","updated":"2008-08-28T16:08:30.810+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12626935","id":"12626935","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Mark, It is excellent that you're working on this patch. Many thanks!\n\nNow, with respect to your comment, it seems to me just you just have to modify the calls to SocketChannel.open(), and it only appears in two places: receiveConnection and toSend. More concretely, you have to replace the variable port in the constructor of InetSocketAddress with the port value that you read from the configuration. \n\nWhat I had in mind is fairly simple. When we parse the configuration file, we could create another hashmap that maps server id to port, and we could simply replace the port variable in the constructor of InetSocketAddress with a call to get() on the hashmap.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-08-29T11:15:45.750+0000","updated":"2008-08-29T11:15:45.750+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12626939","id":"12626939","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markh","name":"markh","key":"markh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Harwood","active":true,"timeZone":"Etc/UTC"},"body":"Did you see my comment about RecvWorker in my last post?\nIt relies solely on INetAddress to identify the caller. This is stored in the Message class and subsequently used in toSend messages generated by WorkerReceiver when sending back notifications.\nUnfortunately RecvWorker currently is not in a position to uniquely identify which QuourumPeer is accessing it via the channel passed in it's constructor. It knows which *machine* is accessing it but has no idea which QuorumPeer of potentitally several running on that machine, and therefore which port that particular peer has chosen to use for its election port.\nAt least that's how it looks to me from a quick scan of the code....","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markh","name":"markh","key":"markh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Harwood","active":true,"timeZone":"Etc/UTC"},"created":"2008-08-29T11:36:58.364+0000","updated":"2008-08-29T11:36:58.364+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12626975","id":"12626975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"You're right, we need more changes. Here is what I think.\n\nWe'd have to change the type of +addr+ in +QuorumCnxManager.Message+ to +InetSocketAddress+, and all the comparisons of addresses that we make across +QuorumCnxManager+. For example, in +QuorumCnxManager.toSend+, we use an +InetAddress+ object to determine if there is a connection to a peer. Alternatively, we could try to map server id to connection, which sounds like a cleaner way of doing it. We would also have to change the type of +addr+ in +FastLeaderElection.Notification+ to +InetSocketAddress+. That's all I could pinpoint so far. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-08-29T13:58:48.957+0000","updated":"2008-08-29T13:58:48.957+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12626996","id":"12626996","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markh","name":"markh","key":"markh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Harwood","active":true,"timeZone":"Etc/UTC"},"body":"This is a snapshot of the changes I had been thinking of making.\n\nNote: this DOES NOT COMPILE!\n\nIf you apply the patch you can see the compile error at the point in RecvWorker where this ran out of steam. \nIt seems that in order to know which QourumPeer was talking to another you would need to pass \"myid\" as part of the comms protocol - there would be no other way of server A knowing if server B or server C had connected to it if we allow >1 Quorum peer per machine - the source IP address obtained from SocketChannel.socket().getInetAddress() is not sufficient to distinguish between them.\n\nThat seems like a much bigger change that I don't feel particularly well equipped to take on just yet.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markh","name":"markh","key":"markh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Harwood","active":true,"timeZone":"Etc/UTC"},"created":"2008-08-29T14:59:58.217+0000","updated":"2008-08-29T14:59:58.217+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12627075","id":"12627075","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"No worries, I'll work on it, but it'd be great to have your feedback once I have a patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-08-29T19:09:09.615+0000","updated":"2008-08-29T19:09:09.615+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12631070","id":"12631070","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"This patch removes the restriction of a single port for leader election. This patch changes the configuration file so that to specify a server, we have do as follows:\n\n\nserver.1=myserver:11111:3182\n\nNote that this patch changes the procedure to parse a configuration file on QuorumPeerConfig.java.\n\nOn QuorumCnxManager and FastLeaderElection/AuthFastLeaderElection, this patch replaces all references to InetAddress objects to server id values. That is, now we identify peers by their server id.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-15T17:04:04.499+0000","updated":"2008-09-15T17:04:04.499+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12631182","id":"12631182","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"body":"just reviewd the code here are my comments -- \n\n1) why is the server id Long and not Integer?\n\n2) we have two ways of specifying the quorum list now -- one is quorumserver arraylist and the other is the hashcode list -- can we combine these two and just keep the hash aary? Do we require these two to be different?\n\n3) I do not see nay changes to QuorumPeerMain class? Shouldnt this be changed now to create a new contructor for QuorumPeer with the hashmap?\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"created":"2008-09-15T23:18:10.436+0000","updated":"2008-09-15T23:18:10.436+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12631194","id":"12631194","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"body":"cancelling the patch for addressing review comments... ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"created":"2008-09-15T23:35:32.567+0000","updated":"2008-09-15T23:35:32.567+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12631319","id":"12631319","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Mahadev, thanks for reviewing the patch. Here are my answers to your points:\n\n1- Server ID has always been a long in QuorumPeer and QuorumPeerConfig, so it was not my choice, and I've only followed what was in place already. If you feel that there is a need to make server ID an integer all over, then I suggest that you open a JIRA to discuss it;\n2- We can combine if we create a new data structure to hold both the quorum address and the election address, so that we have either an array of this new data structure or a hashmap from server id to this new data structure. I prefer the way it is in the patch;\n3- That's a good point, I'll fix it. Also, the version I generated the patch agains is stale (QuorumPeer.java has changed), so I'll have to regenerate the patch anyway. :-(\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-16T10:15:11.122+0000","updated":"2008-09-16T10:15:11.122+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12631356","id":"12631356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Ok, I reviewed the code, and I think you meant to say for point 2 that I could just add another field to QuorumServer. I'll do it, but it implies changes across more files. Hopefully this is ok. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-16T12:10:29.831+0000","updated":"2008-09-16T12:10:29.831+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12631592","id":"12631592","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"This patch chenges the way we pass in the configuration file the port number used for leader election. It also changes the references to servers on QuorumCnxManager from InetAddress to their server ids. I have them changed the challenge mechanism to use the server id instead, simplifying the mechanism.\n\nI have also implemented some of the modifications proposed in JIRA 140.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-16T23:09:46.927+0000","updated":"2008-09-16T23:09:46.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12631707","id":"12631707","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"There is compilation problem with the previous patch I submitted, so consider this new one instead.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-17T09:35:37.929+0000","updated":"2008-09-17T09:35:37.929+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12631718","id":"12631718","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Cleanup code like this to use logging instead of printstacktrace.\n\n         try {\n             mySocket = new DatagramSocket(port);\n             // mySocket.setSoTimeout(20000);\n         } catch (SocketException e1) {\n             e1.printStackTrace();\n             throw new Runtime....\n\n(Thanks for pointing it out, Pat)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-17T10:02:18.824+0000","updated":"2008-09-17T10:02:18.824+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12632099","id":"12632099","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=austin","name":"austin","key":"austin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Austin Shoemaker","active":true,"timeZone":"Etc/UTC"},"body":"Applying the patch (from 9/17) to the latest trunk (r696563) now passes our leader election unit tests using algorithm 3. This is great.\n\nTwo minor issues I noticed:\n\n1. The default constructor for QuorumPeer should call setStatsProvider, rather than the attribute-passing constructor. Since QuorumPeerMain calls the default constructor, echo stat | nc ... requests are returning invalid data because no provider is set.\n\n2. In QuorumPeerConfig.java:105 where parts.length is checked the operator should be && instead of ||.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=austin","name":"austin","key":"austin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Austin Shoemaker","active":true,"timeZone":"Etc/UTC"},"created":"2008-09-18T05:51:31.673+0000","updated":"2008-09-18T05:51:31.673+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12632111","id":"12632111","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=austin","name":"austin","key":"austin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Austin Shoemaker","active":true,"timeZone":"Etc/UTC"},"body":"After several more runs of our unit test using the patched algorithm 3, the test hangs as the service repeatedly tries to reelect the killed leader. This behavior is similar to ZOOKEEPER-131 which we had experienced using algorithms 0 and 1.\n\nServer 10 is 10.50.65.40 and has been explicitly killed. The following log is from server 5, which mirrors logs on all the other servers.\n\nAny idea what's happening here?\n\n2008-09-18 00:28:20,029 - INFO  [QuorumPeer:QuorumPeer@394] - LOOKING\n2008-09-18 00:28:20,029 - WARN  [QuorumPeer:ZooKeeperServer@198] - unable to parse zxid string into long: txt\n2008-09-18 00:28:20,029 - WARN  [QuorumPeer:FastLeaderElection@493] - New election: 8589935405\n2008-09-18 00:28:20,031 - WARN  [WorkerSender Thread:QuorumCnxManager@381] - Cannot open channel to 10( java.net.ConnectException: Connection refused)\n2008-09-18 00:28:20,031 - INFO  [QuorumPeer:QuorumPeer@403] - FOLLOWING\n2008-09-18 00:28:20,031 - INFO  [QuorumPeer:ZooKeeperServer@166] - Created server with dataDir:/zookeeper_data/5_data dataLogDir:/zookeeper_data/5_data tickT\nime:2000\n2008-09-18 00:28:20,031 - INFO  [QuorumPeer:Follower@128] - Following /10.50.65.40:2888\n\n[[[ exception below repeats 5 times ]]]\n\n2008-09-18 00:28:20,032 - WARN  [QuorumPeer:Follower@145] - Unexpected exception\njava.net.ConnectException: Connection refused\n        at java.net.PlainSocketImpl.socketConnect(Native Method)\n        at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)\n        at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)\n        at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)\n        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)\n        at java.net.Socket.connect(Socket.java:519)\n        at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:137)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:405)\n\n[[[ then the follower is restarted ]]]\n\n2008-09-18 00:28:24,049 - ERROR [QuorumPeer:Follower@370] - FIXMSG\njava.lang.Exception: shutdown Follower\n        at org.apache.zookeeper.server.quorum.Follower.shutdown(Follower.java:370)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:409)\n\n[[[ at this point the log repeats from the beginning ]]]\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=austin","name":"austin","key":"austin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Austin Shoemaker","active":true,"timeZone":"Etc/UTC"},"created":"2008-09-18T06:31:42.321+0000","updated":"2008-09-18T06:36:08.318+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12632118","id":"12632118","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"body":"flavio, just a reminder, the patch should be generated against the trunk and also ^M characters (line delimiters in windows) should not be there in the patch... :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"created":"2008-09-18T06:58:06.634+0000","updated":"2008-09-18T06:58:06.634+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12632171","id":"12632171","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"It happens typically that a follower starts up its follower code before the leader is available as a leader, so we get this connection refused exception. However, getting it 5 times means that there has been 5 attempts and no success, so the follower gave up and started a new leader election.  \n\nBy design, the situation that happens with LE 0 should not happen with LEs 1, 2, or 3, since we use a logical clock to prevent a peer from using stale information on potential leaders.  In more detail, if a peer p1 starts a new leader election, and asks a peer p2 that believes that 10 is still the leader, then peer p1 shouldn't take p2's vote because it corresponds to the value decided in a previous election round. Moreover, because 10 is dead, we know that is can't vote, so the vote must come from another peer that believes that 10 is the leader. \n\nThere must be a bug in the leader election code then, so I'll check the code. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-18T11:18:00.360+0000","updated":"2008-09-18T11:18:00.360+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12632211","id":"12632211","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Austin, when you say \"our leader election unit tests\" is that something you could contribute back to the Apache ZK community? If so please create a new jira and attach a patch because I'd love to include them. Thanks.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-09-18T13:41:14.728+0000","updated":"2008-09-18T13:41:14.728+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12632325","id":"12632325","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"This new patch also addresses a race condition in FastLeaderElection. Without this patch, it is possible that one of the worker threads reads the value of either proposedLeader, proposedZxid, or logicalclock in an inconsistent fashion. I have created two synchronized methods and added one synchronized block to have threads reading consistent values.\n\nI have also addressed the points that Austin pointed out. Thanks, Austin!\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-18T18:20:06.854+0000","updated":"2008-09-18T18:20:06.854+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12632794","id":"12632794","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Because 131 was committed, I had to regenerate this patch. Also, it gave me time to write a unit test for FastLeaderElection. I used the one Ben wrote for the old leader election as a basis. \n\nThis patch:\n- Fixes issues with QuorumCnxManager, in particular, servers can have different ports for leader election, and QuorumCnxManager uses server id to identify peers instead of IP address;\n- Remove the challenge used in QuorumCnxManager. QuorumCnxManager uses a randomly generated challenge to decide whether to keep or not to keep a connection. This patch eliminates this challenge, and uses server id instead. As server id is supposed to be unique, it serves the same purpose, although it is simpler, and more reliable;\n- Does a general cleanup of QuorumCnxManager. I have tried to address the comments of Austin;\n- Changes the format of the ZooKeeper configuration file. Now we specify the leader election port as the third parameter of a server specification, as described in the initial description of this jira;\n- Fixes a bug in FastLeaderElection. Because it uses multiple threads, there is currently the possibility that a peer sends inconsistent information to other peers;\n- Adds a unit test to FastLeaderElection based on the one Ben wrote;\n- Finally, because of the patch of jira 131, it touch some other parts, like LETest.java to comply with my changes.\n\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-19T20:06:07.886+0000","updated":"2008-09-19T20:06:07.886+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12633875","id":"12633875","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Both the fle and le tests are failing on my machine:\n\n    [junit] Running org.apache.zookeeper.test.FLETest\n    [junit] Tests run: 1, Failures: 1, Errors: 0, Time elapsed: 62.084 sec\n    [junit] Test org.apache.zookeeper.test.FLETest FAILED\n    [junit] Running org.apache.zookeeper.test.LETest\n    [junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 0.397 sec\n    [junit] Test org.apache.zookeeper.test.LETest FAILED\n\n------------- Standard Error -----------------\nException in thread \"Thread-23\" java.lang.NullPointerException\n\tat org.apache.zookeeper.test.FLETest$LEThread.run(FLETest.java:55)\nException in thread \"Thread-1\" java.lang.NullPointerException\n\tat org.apache.zookeeper.test.FLETest$LEThread.run(FLETest.java:55)\nException in thread \"Thread-13\" java.lang.NullPointerException\n\tat org.apache.zookeeper.test.FLETest$LEThread.run(FLETest.java:55)\nException in thread \"Thread-3\" java.lang.NullPointerException\n\tat org.apache.zookeeper.test.FLETest$LEThread.run(FLETest.java:55)\n------------- ---------------- ---------------\n\nTestcase: testLE took 62.064 sec\n\tFAILED\nThreads didn't join\njunit.framework.AssertionFailedError: Threads didn't join\n\tat org.apache.zookeeper.test.FLETest.testLE(FLETest.java:121)\n\n\n\n\nLETEST\n\nTestcase: testLE took 0.377 sec\n\tCaused an ERROR\nAddress already in use\njava.net.BindException: Address already in use\n\tat sun.nio.ch.Net.bind(Native Method)\n\tat sun.nio.ch.ServerSocketChannelImpl.bind(ServerSocketChannelImpl.java:119)\n\tat sun.nio.ch.ServerSocketAdaptor.bind(ServerSocketAdaptor.java:59)\n\tat sun.nio.ch.ServerSocketAdaptor.bind(ServerSocketAdaptor.java:52)\n\tat org.apache.zookeeper.server.NIOServerCnxn$Factory.<init>(NIOServerCnxn.java:89)\n\tat org.apache.zookeeper.server.quorum.QuorumPeer.<init>(QuorumPeer.java:327)\n\tat org.apache.zookeeper.test.LETest.testLE(LETest.java:105)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-09-23T20:14:07.874+0000","updated":"2008-09-23T20:14:07.874+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12634410","id":"12634410","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"This last patch improves the FLE unit test, and deals with a couple of corner cases in the FastLeaderElection implementation. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-25T08:34:18.140+0000","updated":"2008-09-25T08:34:18.140+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12635022","id":"12635022","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Two minor changes. I have replaced an import on FLETest.java and LETest.java to comply with changes of JIRA 21. I have asked Pat to do it here, otherwise it would be more work to regenerate the patch. \n\n======\n \nI have actually removed this patch because I realized that the import is necessary in this patch, and the two unit tests do not compile without the imports","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-09-26T21:12:09.462+0000","updated":"2008-09-26T21:21:55.946+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12635974","id":"12635974","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 looks good","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-01T08:38:10.967+0000","updated":"2008-10-01T08:38:10.967+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12635976","id":"12635976","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed revision 700714.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-01T08:40:15.353+0000","updated":"2008-10-01T08:40:15.353+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12636325","id":"12636325","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in ZooKeeper-trunk #101 (See [http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/101/])\n    ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-02T10:46:01.339+0000","updated":"2008-10-02T10:46:01.339+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12636510","id":"12636510","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stuhood","name":"stuhood","key":"stuhood","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stuhood&avatarId=10049","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stuhood&avatarId=10049","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stuhood&avatarId=10049","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stuhood&avatarId=10049"},"displayName":"Stu Hood","active":true,"timeZone":"America/Los_Angeles"},"body":"This patch has been committed, but the changes are not documented at all. Servers will fail to start (with a NPE) if using the old config format with only 1 port per server.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stuhood","name":"stuhood","key":"stuhood","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stuhood&avatarId=10049","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stuhood&avatarId=10049","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stuhood&avatarId=10049","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stuhood&avatarId=10049"},"displayName":"Stu Hood","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-03T01:24:45.095+0000","updated":"2008-10-03T01:24:45.095+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12636511","id":"12636511","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"body":"ZOOKEEPER-151  has been created to fix that :)... we should change our example config file format at well.. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-03T01:29:44.595+0000","updated":"2008-10-03T01:29:44.595+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12636512","id":"12636512","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"body":"though failing with a NPE is obiously bad :) ... please create a jira for it \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-03T01:30:33.924+0000","updated":"2008-10-03T01:30:33.924+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12636632","id":"12636632","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"re stu's npe comment, is that true? I thought I had seen some code in the config processing that indicated that we allowed both host:port and host:port:port, does it npe if host:port is used?\n\nFlavio please look into this and also ensure that the documentation is updated to reflect.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-03T13:25:12.051+0000","updated":"2008-10-03T13:25:12.051+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12636633","id":"12636633","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"are there tests for these cases?\n\nhost:port and host:port:port? we should verify both cases (even if one is illegal - verify handled appropriately)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-03T13:26:08.824+0000","updated":"2008-10-03T13:26:08.824+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403150/comment/12642725","id":"12642725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"3.0.0 has been released, closing issues.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-26T01:10:42.233+0000","updated":"2008-10-26T01:10:42.233+0000"}],"maxResults":37,"total":37,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-127/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i061s7:"}}