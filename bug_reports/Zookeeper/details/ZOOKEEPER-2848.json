{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13088404","self":"https://issues.apache.org/jira/rest/api/2/issue/13088404","key":"ZOOKEEPER-2848","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/10004","id":"10004","description":"Not A Bug","name":"Not A Bug"},"customfield_12312322":null,"customfield_12310220":"2018-06-01T22:02:31.957+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jun 01 22:03:50 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_27418497201_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-06-01T22:03:50.607+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2848/watchers","watchCount":3,"isWatching":false},"created":"2017-07-19T13:48:53.440+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":["configuration"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326786","id":"12326786","description":"Alpha release against 3.5 branch","name":"3.5.1","archived":false,"released":true,"releaseDate":"2015-09-02"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-06-01T22:03:50.639+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"Hi\nI am seeing below error in ZK logs :\n \"Unexpected exception causing shutdown while sock still open java.io.EOFException\"\nand then  ZK server shuts down with \"shutdown Leader! reason: Not sufficient followers synced, only synced with sids: \" error.\n\nI am using zookeeper-3.5.1-alpha version.\nit is ensemble of 2 servers\nCould you please help me resolve this issue\nThanks\n \nconfig\n{code:java}\n\ninitLimit=10\nsyncLimit=5\nmaxClientCnxns=0\ntickTime=2000\nquorumListenOnAllIPs=true\ndataDir=/var/run/zookeeper/conf/default\nadmin.enableServer=false\nstandaloneEnabled=false\n\n{code}\n\nzookeeper server logs \n{code:java}\n\n114829 2017-06-22 11:24:18,182 [myid:2147483652] - INFO  [ProcessThread(sid:2147483652 cport:-1)::PrepRequestProcessor@649] - Processed session termination for sessionid:                  0x40000007cef003d\n114830 2017-06-22 11:24:18,182 [myid:2147483652] - INFO  [NIOWorkerThread-8:MBeanRegistry@119] - Unregister MBean [org.apache.ZooKeeperService:name0=ReplicatedServer_id2147483652,         name1=replica.2147483652,name2=Leader,name3=Connections,name4=128.0.0.5,name5=0x40000007cef003d]\n114831 2017-06-22 11:24:18,183 [myid:2147483652] - INFO  [NIOWorkerThread-8:NIOServerCnxn@606] - Closed socket connection for client /128.0.0.5:34651 which had sessionid                   0x40000007cef003d\n114832 2017-06-22 11:24:18,421 [myid:2147483652] - ERROR [LearnerHandler-/128.0.0.5:33610:LearnerHandler@604] - Unexpected exception causing shutdown while sock still open\n114833 java.io.EOFException\n114834     at java.io.DataInputStream.readInt(DataInputStream.java:403)\n114835     at org.apache.jute.BinaryInputArchive.readInt(BinaryInputArchive.java:63)\n114836     at org.apache.zookeeper.server.quorum.QuorumPacket.deserialize(QuorumPacket.java:83)\n114837     at org.apache.jute.BinaryInputArchive.readRecord(BinaryInputArchive.java:99)\n114838     at org.apache.zookeeper.server.quorum.LearnerHandler.run(LearnerHandler.java:515)\n114839 2017-06-22 11:24:18,422 [myid:2147483652] - WARN  [LearnerHandler-/128.0.0.5:33610:LearnerHandler@619] - ******* GOODBYE /128.0.0.5:33610 ********\n114840 2017-06-22 11:24:18,422 [myid:2147483652] - INFO  [NIOServerCxnFactory.AcceptThread:/0.0.0.0:61808:NIOServerCnxnFactory$AcceptThread@296] - Accepted socket connection from /        128.0.0.4:42854\n114841 2017-06-22 11:24:18,422 [myid:2147483652] - INFO  [NIOWorkerThread-4:ZooKeeperServer@969] - Client attempting to renew session 0x40000007cef0001 at /128.0.0.4:42854\n114842 2017-06-22 11:24:18,422 [myid:2147483652] - INFO  [NIOWorkerThread-4:ZooKeeperServer@678] - Established session 0x40000007cef0001 with negotiated timeout 20000 for client /         128.0.0.4:42854\n114843 2017-06-22 11:24:18,423 [myid:2147483652] - INFO  [NIOServerCxnFactory.AcceptThread:/0.0.0.0:61808:NIOServerCnxnFactory$AcceptThread@296] - Accepted socket connection from /        128.0.0.4:42862\n114844 2017-06-22 11:24:18,423 [myid:2147483652] - INFO  [NIOServerCxnFactory.AcceptThread:/0.0.0.0:61808:NIOSe\n \n{code}\n\n \n After some time ..\n\n{code:java}\n \n114851 2017-06-22 11:24:18,423 [myid:2147483652] - INFO  [NIOWorkerThread-12:ZooKeeperServer@678] - Established session 0x40000007cef0003 with negotiated timeout 20000 for client /        128.0.0.4:42866\n114852 2017-06-22 11:24:19,001 [myid:2147483652] - INFO  [NIOServerCxnFactory.AcceptThread:/0.0.0.0:61808:NIOServerCnxnFactory$AcceptThread@296] - Accepted socket connection from /        128.0.0.4:42892\n114853 2017-06-22 11:24:19,001 [myid:2147483652] - INFO  [NIOWorkerThread-13:ZooKeeperServer@964] - Client attempting to establish new session at /128.0.0.4:42892\n114854 2017-06-22 11:24:19,211 [myid:2147483652] - INFO  [SessionTracker:ZooKeeperServer@384] - Expiring session 0x40000007cef016c, timeout of 20000ms exceeded\n114855 2017-06-22 11:24:19,211 [myid:2147483652] - INFO  [SessionTracker:QuorumZooKeeperServer@132] - Submitting global closeSession request for session 0x40000007cef016c\n114856 2017-06-22 11:24:19,211 [myid:2147483652] - INFO  [SessionTracker:ZooKeeperServer@384] - Expiring session 0x40000007cef016d, timeout of 20000ms exceeded\n114857 2017-06-22 11:24:19,211 [myid:2147483652] - INFO  [ProcessThread(sid:2147483652 cport:-1)::PrepRequestProcessor@649] - Processed session termination for sessionid:                  0x40000007cef016c\n114858 2017-06-22 11:24:19,211 [myid:2147483652] - INFO  [SessionTracker:QuorumZooKeeperServer@132] - Submitting global closeSession request for session 0x40000007cef016d\n114859 2017-06-22 11:24:19,211 [myid:2147483652] - INFO  [ProcessThread(sid:2147483652 cport:-1)::PrepRequestProcessor@649] - Processed session termination for sessionid:                  0x40000007cef016d\n114860 2017-06-22 11:24:19,579 [myid:2147483652] - INFO  [QuorumPeer[myid=2147483652](plain=/0:0:0:0:0:0:0:0:61808)(secure=disabled):Leader@613] - Shutting down\n114861 2017-06-22 11:24:19,579 [myid:2147483652] - INFO  [QuorumPeer[myid=2147483652](plain=/0:0:0:0:0:0:0:0:61808)(secure=disabled):Leader@619] - Shutdown called\n114862 java.lang.Exception: shutdown Leader! reason: Not sufficient followers synced, only synced with sids: [ [2147483652] ]\n114863     at org.apache.zookeeper.server.quorum.Leader.shutdown(Leader.java:619)\n114864     at org.apache.zookeeper.server.quorum.Leader.lead(Leader.java:590)\n114865     at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:1077)\n114866 2017-06-22 11:24:19,579 [myid:2147483652] - INFO  [QuorumPeer[myid=2147483652](plain=/0:0:0:0:0:0:0:0:61808)(secure=disabled):MBeanRegistry@119] - Unregister MBean [org.            apache.ZooKeeperService:name0=ReplicatedServer_id2147483652,name1=replica.2147483652,name2=Leader,name3=Connections,name4=128.0.0.4,name5=0x40000007cef006b]\n114867 2017-06-22 11:24:19,579 [myid:2147483652] - INFO  [LearnerCnxAcceptor-0.0.0.0/0.0.0.0:61809:Leader$LearnerCnxAcceptor@373] - exception while shutting down acceptor: java.net.       SocketException: Socket closed\n114868 2017-06-22 11:24:19,581 [myid:2147483652] - INFO  [QuorumPeer[myid=2147483652](plain=/0:0:0:0:0:0:0:0:61808)(secure=disabled):NIOServerCnxn@606] - Closed socket connection          for client /128.0.0.4:41674 which had sessionid 0x40000007cef006b\n\n{code}\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Getting this error in ZK server logs : shutdown Leader! reason: Not sufficient followers synced, only synced with sids","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdprashanth","name":"cdprashanth","key":"cdprashanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"prashantkumar","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdprashanth","name":"cdprashanth","key":"cdprashanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"prashantkumar","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13088404/comment/16498629","id":"16498629","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"The log indicates that your leader can't talk with follower. It's not unusual, as it totally depends on your network condition and also your configuration. An immediate action to try is to increase the tickTime and syncLimit. \r\n\r\nUnless there is more evidence, I don't think this is a bug but more like a configuration issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2018-06-01T22:02:31.957+0000","updated":"2018-06-01T22:02:31.957+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13088404/comment/16498630","id":"16498630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"body":"Feel free to reopen the Jira with more evidence if this is a bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hanm","name":"hanm","key":"hanm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hanm&avatarId=26946","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hanm&avatarId=26946","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hanm&avatarId=26946","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hanm&avatarId=26946"},"displayName":"Michael Han","active":true,"timeZone":"America/Vancouver"},"created":"2018-06-01T22:03:50.636+0000","updated":"2018-06-01T22:03:50.636+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2848/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3hqm7:"}}