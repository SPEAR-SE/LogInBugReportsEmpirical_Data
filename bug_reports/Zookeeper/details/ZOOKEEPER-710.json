{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12459507","self":"https://issues.apache.org/jira/rest/api/2/issue/12459507","key":"ZOOKEEPER-710","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314847","id":"12314847","description":"Fix release against 3.2 branch","name":"3.2.3","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313976","id":"12313976","description":"Improved manageability and simplified client development process.","name":"3.3.0","archived":false,"released":true,"releaseDate":"2010-03-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-03-18T17:45:07.143+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Mar 20 20:09:25 UTC 2010","customfield_12310420":"47640","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_5190001_*|*_1_*:*_1_*:*_63660508_*|*_5_*:*_2_*:*_1714284_*|*_4_*:*_1_*:*_36242988","customfield_12312321":null,"resolutiondate":"2010-03-19T17:19:38.921+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-710/watchers","watchCount":2,"isWatching":false},"created":"2010-03-18T11:39:31.140+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"7.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314335","id":"12314335","description":"Fix release against 3.2 branch","name":"3.2.2","archived":false,"released":true,"releaseDate":"2009-12-14"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-03-26T17:25:12.009+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312382","id":"12312382","name":"server","description":"General issues with the ZooKeeper server."}],"timeoriginalestimate":null,"description":"Originally problem was described on Users mailing list starting with this [post|http://mail-archives.apache.org/mod_mbox/hadoop-zookeeper-user/201003.mbox/<3b910d891003160743k38e2e7c9y830b182d88396d55@mail.gmail.com>].\nBelow I restate it in more organized form.\n\nWe occasionally (few times a day) observe that our client application disconnects from Zookeeper cluster.\nApplication is written in C++ and we are using libzookeeper_mt library. In version 3.2.2.\n\nThe disconnects we are observing are probably related to some problems with our network infrastructure - we are observing periods with great packet loss between machines in our DC. \n\nSometimes after client application (i.e. zookeeper library) reconnects to zookeeper cluster we are observing that all subsequent requests return ZSESSIONMOVED error. Restarting client app helps - we always pass 0 as clientid to zookeeper_init function so old session is not reused.\n\nOn 16-03-2010 we observed few occurences of problem. Example ones:\n- 22:08; client IP 10.1.112.60 (app1); sessionID 0x22767e1c9630000\n- 14:21; client IP 10.1.112.61 (app2); sessionID 0x324dcc1ba580085\n\nI attach logs of cluster and application nodes (only stuff concerining zookeeper):\n- [^zookeeper-node1.log.2010-03-16.gz] - logs of zookeepr cluster node 1 10.1.112.62\n- [^zookeeper-node2.log.2010-03-16.gz] - logs of zookeepr cluster node 2 10.1.112.63\n- [^zookeeper-node3.log.2010-03-16.gz] - logs of zookeepr cluster node 3 10.1.112.64\n- [^app1.log.2010-03-16.gz] - application logs of app1 10.1.112.60\n- [^app2.log.2010-03-16.gz] - application logs of app2 10.1.112.61\n\nI also made some analysis of case at 22:08:\n- Network glitch which resulted in problem occurred at about 22:08.\n- From what I see since 17:48 node2 was the leader and it did not\nchange later yesterday.\n- Client was connected to node2 since 17:50\n- At around 22:09 client tried to connect to every node (1,2,3).\nConnections to node1 and node3 were closed\n with exception \"Exception causing close of session 0x22767e1c9630000\ndue to java.io.IOException: Read error\".\n Connection to node2 stood alive.\n- All subsequent operations were refused with ZSESSIONMOVED error.\nError visible both on client and on server side.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439150","id":"12439150","filename":"app1.log.2010-03-16.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T11:41:57.972+0000","size":180542,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12439150/app1.log.2010-03-16.gz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439151","id":"12439151","filename":"app2.log.2010-03-16.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T11:44:06.869+0000","size":12206,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12439151/app2.log.2010-03-16.gz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439242","id":"12439242","filename":"ZOOKEEPER-710_3.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-19T06:21:52.152+0000","size":10953,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12439242/ZOOKEEPER-710_3.2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439239","id":"12439239","filename":"ZOOKEEPER-710_3.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-19T05:20:16.255+0000","size":8697,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12439239/ZOOKEEPER-710_3.3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439147","id":"12439147","filename":"zookeeper-node1.log.2010-03-16.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T11:41:15.029+0000","size":182754,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12439147/zookeeper-node1.log.2010-03-16.gz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439148","id":"12439148","filename":"zookeeper-node2.log.2010-03-16.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T11:41:33.785+0000","size":616448,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12439148/zookeeper-node2.log.2010-03-16.gz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439149","id":"12439149","filename":"zookeeper-node3.log.2010-03-16.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T11:41:33.840+0000","size":220434,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12439149/zookeeper-node3.log.2010-03-16.gz"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"32909","customfield_12312823":null,"summary":"permanent ZSESSIONMOVED error after client app reconnects to zookeeper cluster","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"debian lenny; ia64; xen virtualization","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459507/comment/12846864","id":"12846864","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"body":"ZooKeeper::getChildren() path='/ggmboxlocks/16314'; callback error='session moved to another server, so operation is ignored' logs are printed using \nlog_error(logger, \"ZooKeeper::getChildren() path='%s'; callback error='%s'\", path.c_str(), zerror(retval)) where retval is rc code from callback.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T12:01:31.914+0000","updated":"2010-03-18T12:01:31.914+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459507/comment/12847017","id":"12847017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"body":"lukasz, can you elaborate on what this code is doing?\n\n{code}\nMar 16 14:21:49 XXXXXXXXXX-c1-mbox-2 XXXXXXXXXX_mbox[25112]: DEBUG: ZooKeeper: ZooKeeper::execWatch() executing watch\nMar 16 14:21:49 XXXXXXXXXX-c1-mbox-2 XXXXXXXXXX_mbox[25112]: INFO: ZooKeeper: ZooKeeper::watcherFunHandleSessionEvent() state change to 3\nMar 16 14:21:49 XXXXXXXXXX-c1-mbox-2 XXXXXXXXXX_mbox[25112]: INFO: ZooKeeper: ZooKeeper::fireAllWatchFunctions() calling all watches\n{code}\n\nwhich all watches are your firing?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T17:45:07.143+0000","updated":"2010-03-18T18:05:47.829+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459507/comment/12847080","id":"12847080","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"body":"This is application stuff.\n\nLets take exist function from our code which wraps zookeeper library as an example.\nIts declaration is:\n{noformat}\nZooKeeper::ErrorCode::Type ZooKeeper::exists(const std::string& path,\n                                             Stat &stat,\n                                             const WatchFunction& watchFunction,\n                                             WatchId& watchId,\n                                             apr_time_t timeout) \n{noformat}\n\nAs you see caller passes high level watchFunction to be called. \nOur wrapper maintains a map (node,operationtype)->watcherFunction. Internal watch function which is used in zoo_* calls\nis responsible for calling user provided watchFunctions stored in map in case of change concerning one of nodes.\n\nWhen client disconnects from zookeeper all watches are invalidated (at least AFAIK) so we are calling all user provided functions in such case.\nWe are doing this as soon client is reconnected to zookeeper. We simulate situation when change occured to all nodes application was interested in. That is what fireAllWatchFunctions function do.\n\nIs it somewhat clear?\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-18T19:37:29.665+0000","updated":"2010-03-18T19:37:29.665+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459507/comment/12847085","id":"12847085","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"lukasz thank you for the logs! they have really helped pinpoint the problem. it appears that message delays are the cause of the problem. it appears that what is happening is that the client is connecting to a follower that is running very slow. the follower is slow processing the reconnect request and forwarding it to the leader. for example, the following shows a case where it takes 7 seconds for the follower to process a reestablish connection request.\n\n{quote}\nzookeeper-node3.log.2010-03-16:2010-03-16 14:21:41,267 - INFO  [NIOServerCxn.Factory:2181:NIOServerCnxn@964] - Finished init of 0x224ea5675b4007b valid:true\nzookeeper-node3.log.2010-03-16:2010-03-16 14:21:48,937 - INFO  [NIOServerCxn.Factory:2181:NIOServerCnxn@612] - Renewing session 0x224ea5675b4007b\n{quote}\n\nthe problem is that within that 7 seconds a client can drop the connection to the follower and establish a connection to the leader. if the renew session request is delayed until after the client reestablishes the connection with the leader, the session will get marked as managed by the previous follower and all requests set to the leader will get MOVED error, which is what you are seeing.\n\nthe problem is that we consider the MOVED error to be a request error rather than a connection error. the leader needs to drop the connection when it sees the MOVED error so that the client can reestablish the session properly with another machine.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-18T19:53:47.319+0000","updated":"2010-03-18T19:53:47.319+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459507/comment/12847092","id":"12847092","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Marking this to fix for 3.3.0 and 3.2.3\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-18T20:18:59.455+0000","updated":"2010-03-18T20:18:59.455+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459507/comment/12847225","id":"12847225","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"fixes this session moved issue by closing the invalid connection","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-19T05:20:16.339+0000","updated":"2010-03-19T05:20:16.339+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459507/comment/12847230","id":"12847230","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 great work pat! and thanx Lukasz for identifying this failure condition.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-19T05:43:17.116+0000","updated":"2010-03-19T05:43:17.116+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459507/comment/12847231","id":"12847231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12439239/ZOOKEEPER-710_3.3.patch\n  against trunk revision 924942.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/143/testReport/\nFindbugs warnings: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/143/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/143/console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-19T05:44:21.614+0000","updated":"2010-03-19T05:44:21.614+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459507/comment/12847239","id":"12847239","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"this 3.2 patch is against the current 3.2 svn branch\n\nfixes the issue in my tests\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-19T06:21:52.156+0000","updated":"2010-03-19T06:21:52.156+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459507/comment/12847247","id":"12847247","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed revision 925104.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-19T06:47:01.630+0000","updated":"2010-03-19T06:47:01.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459507/comment/12847250","id":"12847250","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"body":"Lukasz feel free to try the attached 3.2 patch. It passes all tests on my system. You should be able to patch/compile against the 3.2 release (patch -p0 < patchfile) or svn 3.2 branch.\n\nIt would be great if you could try this out and verify that it fixes the issue you've been seeing with moved.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phunt","name":"phunt","key":"phunt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Hunt","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-19T07:16:36.916+0000","updated":"2010-03-19T07:16:36.916+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459507/comment/12847275","id":"12847275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"body":"I will build version with patch and deploy it on Monday. But as I will also tweak client timeout parameter and GC; and bug itself is not manually reproducable, it wont be best check if fix is working :)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=losipiuk","name":"losipiuk","key":"losipiuk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34047"},"displayName":"Lukasz Osipiuk","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-19T08:39:48.876+0000","updated":"2010-03-19T08:39:48.876+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459507/comment/12847456","id":"12847456","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"body":"I just committed this to 3.2 branch. thanks pat!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mahadev","name":"mahadev","key":"mahadev","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mahadev konar","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-19T17:19:38.917+0000","updated":"2010-03-19T17:19:38.917+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459507/comment/12847815","id":"12847815","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in ZooKeeper-trunk #763 (See [http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/763/])\n    . Forgot to run ant docs\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-20T20:09:25.935+0000","updated":"2010-03-20T20:09:25.935+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-710/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i05zv3:"}}