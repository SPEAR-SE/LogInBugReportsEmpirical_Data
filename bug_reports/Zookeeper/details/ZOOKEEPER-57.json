{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12399146","self":"https://issues.apache.org/jira/rest/api/2/issue/12399146","key":"ZOOKEEPER-57","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2008-06-27T19:06:31.686+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jan 16 06:19:36 UTC 2009","customfield_12310420":"214037","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_17532205892_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-01-16T06:19:36.892+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-57/watchers","watchCount":3,"isWatching":false},"created":"2008-06-27T08:16:11.890+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-01-16T08:44:50.817+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312381","id":"12312381","name":"java client","description":"The java client interface for ZooKeeper"}],"timeoriginalestimate":null,"description":"I have observed several connection timeouts with one single client, during periods of inactivity. From reports of other users, it seems that others are observing a similar issue. \n\nIn my case, tickTime is 2000, and the client sets session timeout to be 10000. Client and servers are on different sites. I suspect there is something wrong with the mechanism that issues ping messages.  ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"33247","customfield_12312823":null,"summary":"Connection times out when idle","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399146/comment/12608880","id":"12608880","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I have added some logging, and I've been able to figure out that there are consecutive calls to sendPing right before the client session gets expired, but there are no subsequent calls to doIO() to send the ping packet.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-06-27T18:46:45.827+0000","updated":"2008-06-27T18:46:45.827+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399146/comment/12608886","id":"12608886","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"body":"It would be interesting to see the state of the ready selector keys when the selector returns after calling sendPing. The only way I can see doIO getting skipped is if the OP_CONNECT is still set.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=breed","name":"breed","key":"breed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Reed","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-06-27T19:06:31.686+0000","updated":"2008-06-27T19:06:31.686+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399146/comment/12608888","id":"12608888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I'm trying to reproduce it with new log messages this time. The main issue is that it takes time to generate the problem. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-06-27T19:11:43.114+0000","updated":"2008-06-27T19:11:43.114+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399146/comment/12608991","id":"12608991","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I've been able to verify that in my setup doIO() is actually called fine after a call to sendPing. However, it seems that in doIO(), the call to sockKey.isReadable() is returning false, and pings are not being received. \n\nBecause doIO is called from SendThread.run(), the following predicate must be true:\n\n     ((k.readyOps() & (SelectionKey.OP_READ | SelectionKey.OP_WRITE)) != 0)\n\nbut because sockKey.isReadable() returns false, it seems that one of the two is  happening:\n\n   1- k != sockKey\n   2- (k.readyOps() & SelectionKey.OP_WRITE) != 0\n\nFrom the code, it doesn't look like we have \"1\", so it leaves us with \"2\". This is still not conclusive, so I'll keep investigating.\n   ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-06-28T09:49:17.701+0000","updated":"2008-06-28T10:15:41.474+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399146/comment/12609001","id":"12609001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"The socket is writable but not readable.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-06-28T11:43:59.737+0000","updated":"2008-06-28T11:43:59.737+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399146/comment/12609067","id":"12609067","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I have added messages to keep track of what is going on with the server the client is connected to:\n\n2008-06-28 21:02:44,406 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@269] - Doing IO\n2008-06-28 21:02:44,406 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@275] - Socket is readable\n2008-06-28 21:02:44,406 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@269] - Doing IO\n2008-06-28 21:02:44,406 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@275] - Socket is readable\n2008-06-28 21:02:44,406 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@269] - Doing IO\n2008-06-28 21:02:44,407 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@300] - Socket is writable\n2008-06-28 21:02:54,100 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@269] - Doing IO\n2008-06-28 21:02:54,100 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@275] - Socket is readable\n2008-06-28 21:02:54,100 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@269] - Doing IO\n2008-06-28 21:02:54,100 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@275] - Socket is readable\n2008-06-28 21:02:54,100 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@269] - Doing IO\n2008-06-28 21:02:54,100 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@275] - Socket is readable\n2008-06-28 21:02:54,100 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@269] - Doing IO\n2008-06-28 21:02:54,100 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@275] - Socket is readable\n2008-06-28 21:02:54,101 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@300] - Socket is writable\n2008-06-28 21:02:54,101 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@269] - Doing IO\n2008-06-28 21:02:54,101 - WARN  [NIOServerCxn.Factory:NIOServerCnxn@275] - Socket is readable\n\nIf we follow the timestamps, we see that there has been a gap of 10s between calls to doIO(). Before that,  the server was sending pings regularly every 3s. Also, from my client log messages, this corresponds to the time that the client times out, and so this gap is the cause of the time out on my client. Interestingly, once the client disconnects from the first server, it reconnects to another server, and the same happens a few minutes later:\n\n2008-06-28 21:06:32,110 -  WARN  - [NIOServerCxn.Factory:NIOServerCnxn@269] - Doing IO\n2008-06-28 21:06:32,110 -  WARN  - [NIOServerCxn.Factory:NIOServerCnxn@300] - Socket is writable\n2008-06-28 21:06:46,516 -  WARN  - [NIOServerCxn.Factory:NIOServerCnxn@269] - Doing IO\n2008-06-28 21:06:46,516 -  WARN  - [NIOServerCxn.Factory:NIOServerCnxn@275] - Socket is readable\n2008-06-28 21:06:46,516 -  WARN  - [NIOServerCxn.Factory:NIOServerCnxn@269] - Doing IO\n2008-06-28 21:06:46,517 -  WARN  - [NIOServerCxn.Factory:NIOServerCnxn@275] - Socket is readable\n\nNow the gap is roughly 14s, though.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-06-29T08:35:24.301+0000","updated":"2008-06-29T08:35:24.301+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399146/comment/12609829","id":"12609829","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oae","name":"oae","key":"oae","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johannes Zillmann","active":true,"timeZone":"Europe/Berlin"},"body":"Might be related, we're observing the following on the client side of a running zookeeper system:\n\n{noformat} \n2008-07-01 05:16:12,643 WARN com.yahoo.zookeeper.server.NIOServerCnxn: Creating new session 11ade8d31110000\n2008-07-01 05:16:12,686 WARN com.yahoo.zookeeper.server.NIOServerCnxn: Finished init of 11ade8d31110000: true\n2008-07-01 05:16:13,646 WARN com.yahoo.zookeeper.server.ZooKeeperServer: Trying to connect to hadoop.host/100.211.8.204:2181\n2008-07-01 05:16:13,647 WARN com.yahoo.zookeeper.server.ZooKeeperServer: Priming connection to java.nio.channels.SocketChannel[connected local=/100.211.8.204:40166 remote=hadoop.host/100.211.8.204:2181]\n2008-07-01 05:16:13,651 WARN com.yahoo.zookeeper.server.NIOServerCnxn: Connected to /100.211.8.204:40166 lastZxid 0\n2008-07-01 05:16:13,652 WARN com.yahoo.zookeeper.serhadoop.hostver.NIOServerCnxn: Creating new session 11ade8d31110001\n2008-07-01 05:16:13,665 WARN com.yahoo.zookeeper.server.NIOServerCnxn: Finished init of 11ade8d31110001: true\n2008-07-01 05:16:24,002 WARN com.yahoo.zookeeper.server.SessionTrackerImpl: Expiring 11ad84b6b650001\n2008-07-01 05:16:24,002 WARN com.yahoo.zookeeper.server.SessionTrackerImpl: Expiring 11ad84b6b650000\n2008-07-01 05:16:24,003 WARN com.yahoo.zookeeper.server.PrepRequestProcessor: Processed session termination request for id: 11ad84b6b650001\n2008-07-01 05:16:24,003 WARN com.yahoo.zookeeper.server.PrepRequestProcessor: Processed session termination request for id: 11ad84b6b650000\n2008-07-01 05:16:42,140 WARN com.yahoo.zookeeper.server.ZooKeeperServer: Trying to connect to hadoop.host/100.211.8.204:2181\n2008-07-01 05:16:42,160 WARN com.yahoo.zookeeper.server.ZooKeeperServer: Priming connection to java.nio.channels.SocketChannel[connected local=/100.211.8.204:45830 remote=hadoop.host/100.211.8.204:2181]\n2008-07-01 05:16:43,480 INFO org.apache.hadoop.ipc.metrics.RpcMetrics: Initializing RPC Metrics with hostName=Node, port=50000\n2008-07-01 05:16:46,953 INFO org.apache.hadoop.ipc.Server: IPC Server Responder: starting\n2008-07-01 05:16:46,955 INFO org.apache.hadoop.ipc.Server: IPC Server listener on 50000: starting\n2008-07-01 05:16:46,955 INFO org.apache.hadoop.ipc.Server: IPC Server handler 0 on 50000: starting\n2008-07-01 06:07:25,641 WARN com.yahoo.zookeeper.server.ZooKeeperServer: Closing:\njava.io.IOException: Read error rc = -1 java.nio.DirectByteBuffer[pos=0 lim=4 cap=4]\n        at com.yahoo.zookeeper.ClientCnxn$SendThread.doIO(ClientCnxn.java:484)\n        at com.yahoo.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:705)\n2008-07-01 06:07:27,775 WARN com.yahoo.zookeeper.server.ZooKeeperServer: Trying to connect to hadoop.host/100.211.8.204:2181\n2008-07-01 06:07:27,775 WARN com.yahoo.zookeeper.server.ZooKeeperServer: Priming connection to java.nio.channels.SocketChannel[connected local=/100.211.8.207:47535 remote=hadoop.host/100.211.8.204:2181]\n2008-07-01 06:07:27,776 WARN com.yahoo.zookeeper.server.ZooKeeperServer: Closing:\njava.io.IOException: Session Expired\n        at com.yahoo.zookeeper.ClientCnxn$SendThread.readConnectResult(ClientCnxn.java:406)\n        at com.yahoo.zookeeper.ClientCnxn$SendThread.doIO(ClientCnxn.java:492)\n        at com.yahoo.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:705)\n2008-07-01 06:07:33,294 ERROR com.yahoo.zookeeper.server.ZooKeeperServer: from EventThread\njava.lang.RuntimeException: Unable to re subscribe to child change notification for: /katta/node-to-shard/hadoop1.host:50000\n        at net.sf.katta.zk.ZKClient.process(ZKClient.java:364)\n        at com.yahoo.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:264)\nCaused by: com.yahoo.zookeeper.KeeperException: KeeperErrorCode = SessionExpired\n        at com.yahoo.zookeeper.ZooKeeper.getChildren(ZooKeeper.java:634)\n        at net.sf.katta.zk.ZKClient.process(ZKClient.java:359)\n        ... 1 more \n{noformat} \n\nAt the same time on the server side you can see:\n{noformat} \n2008-07-01 05:16:24,002 WARN com.yahoo.zookeeper.server.SessionTrackerImpl: Expiring 11ad84b6b650001\n2008-07-01 05:16:24,002 WARN com.yahoo.zookeeper.server.SessionTrackerImpl: Expiring 11ad84b6b650000\n2008-07-01 05:16:24,003 WARN com.yahoo.zookeeper.server.PrepRequestProcessor: Processed session termination request for id: 11ad84b6b650001\n2008-07-01 05:16:24,003 WARN com.yahoo.zookeeper.server.PrepRequestProcessor: Processed session termination request for id: 11ad84b6b650000\n{noformat} \n\nSome hours later this is in the server logs. Don't know if its related...\n{noformat} \n2008-07-01 15:52:59,798 WARN com.yahoo.zookeeper.server.ZooKeeperServer: Closing: \njava.io.IOException: TIMED OUT\n        at com.yahoo.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:666)\n2008-07-01 15:52:59,798 WARN com.yahoo.zookeeper.server.ZooKeeperServer: Closing: \njava.io.IOException: TIMED OUT\n        at com.yahoo.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:666)\n{noformat} \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oae","name":"oae","key":"oae","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johannes Zillmann","active":true,"timeZone":"Europe/Berlin"},"created":"2008-07-02T08:56:11.448+0000","updated":"2008-07-02T08:56:11.448+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399146/comment/12609868","id":"12609868","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"It seems to me that your logs are mixed. I can see some messages from a zookeeper server as well in the first snippet. Are you writing all your logs to the same shared device?\n\nBecause rc = -1 in one of the error messages, it looks like the server has shut down the socket. Are there any messages on the server logs around this time:\n\n     2008-07-01 06:07:25,641\n\nthat indicate why that happened?\n\nWhen you got those time out messages, was the client (or clients) idle? If possible, could describe a little more your setup?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2008-07-02T10:20:16.490+0000","updated":"2008-07-02T10:20:16.490+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399146/comment/12664414","id":"12664414","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"It seems that what was causing this problem to one of our users was some networking issue, and we couldn't point out to any problem with ZooKeeper, so I'm closing it for now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2009-01-16T06:19:36.873+0000","updated":"2009-01-16T08:44:50.787+0000"}],"maxResults":9,"total":9,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-57/votes","votes":3,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i061y7:"}}