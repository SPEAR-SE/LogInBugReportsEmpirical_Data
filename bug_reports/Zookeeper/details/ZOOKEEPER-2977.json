{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13137770","self":"https://issues.apache.org/jira/rest/api/2/issue/13137770","key":"ZOOKEEPER-2977","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":4200,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310801","id":"12310801","key":"ZOOKEEPER","name":"ZooKeeper","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10484","id":"10484","description":"Apache ZooKeeper related","name":"ZooKeeper"}},"fixVersions":[],"aggregatetimespent":4200,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-02-21T14:17:05.538+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jun 11 16:14:45 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2977/watchers","watchCount":5,"isWatching":false},"created":"2018-02-12T03:40:47.176+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":["pull-request-available"],"customfield_12312333":null,"customfield_12310230":"Quorum, shutdown","customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":0,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334700","id":"12334700","description":"Fix release against 3.4 branch","name":"3.4.9","archived":false,"released":true,"releaseDate":"2016-09-03"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sumitagrawal","name":"sumitagrawal","key":"sumitagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"sumit agrawal","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-06-22T04:49:03.733+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312379","id":"12312379","name":"quorum","description":"Quorum determination for ZooKeeper"}],"timeoriginalestimate":null,"description":"When client performs multiple times addAuth with different credential at follower concurrently, the communication between follower gets corrupt. This causes shutdown of Follower due to the failure.\r\n\r\nAnalysis:\r\n\r\nIn org.apache.zookeeper.server.quorum.QuorumPacket.serialize method,\r\n * call a_.startVector(authinfo,\"authinfo\"); which write the length of authinfo to packet (suppose it writes length 1)\r\n * get length of authinfo to write all details in loop (here gets length as 2)\r\n\r\n<-- Here in concurrency scenario, buffer gets corrupt having extra bytes in channel for additional authinfo.\r\n\r\n \r\n\r\nSo When Leader reads next quorum packet, it reads previous extra bytes (incorrect) and possibly identify greater size of message (as corrupt byte pattern) causes exception...\r\n\r\nCoordination > Unexpected exception causing shutdown while sock still open (LearnerHandler.java:633)\r\n java.io.IOException: Unreasonable length = 1885430131\r\n\r\n \r\n\r\n \r\n\r\nServerCnxn.getAuthInfo returns Unmodifiable list, but while addAuthInfo, there is no check. So this causes concurrency issue.\r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\n ","customfield_10010":null,"timetracking":{"remainingEstimate":"0h","timeSpent":"1h 10m","remainingEstimateSeconds":0,"timeSpentSeconds":4200},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12911964","id":"12911964","filename":"2977.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sumitagrawal","name":"sumitagrawal","key":"sumitagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"sumit agrawal","active":true,"timeZone":"Etc/UTC"},"created":"2018-02-25T19:03:53.532+0000","size":2222,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12911964/2977.patch"}],"aggregatetimeestimate":0,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Concurrency for addAuth corrupts quorum packets","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sumitagrawal","name":"sumitagrawal","key":"sumitagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"sumit agrawal","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sumitagrawal","name":"sumitagrawal","key":"sumitagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"sumit agrawal","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":4200,"total":4200,"percent":100},"customfield_12311024":null,"environment":"Affects all version in 3.4.x","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":4200,"total":4200,"percent":100},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/comment/16361680","id":"16361680","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sumitagrawal","name":"sumitagrawal","key":"sumitagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"sumit agrawal","active":true,"timeZone":"Etc/UTC"},"body":"To avoid this issue, below method can return copy of authinfo:\r\n\r\norg.apache.zookeeper.server.ServerCnxn.addAuthInfo(Id){\r\n\r\n    //return Collections.unmodifiableList(authInfo);\r\n\r\n    return Collections.unmodifiableList(new ArrayList(authInfo));\r\n\r\n}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sumitagrawal","name":"sumitagrawal","key":"sumitagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"sumit agrawal","active":true,"timeZone":"Etc/UTC"},"created":"2018-02-13T01:17:40.343+0000","updated":"2018-02-13T01:17:40.343+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/comment/16371462","id":"16371462","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"Hi [~sumitagrawal]\r\n\r\nI think this a great fix and it looks like it has been accidentally fixed in 3.5 and master branches by ZOOKEEPER-1525.\r\n\r\nWould you mind creating a Pull Request on GitHub and possibly put together a small unit test to validate the behaviour?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-02-21T14:17:05.538+0000","updated":"2018-02-21T14:17:05.538+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/comment/16376199","id":"16376199","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sumitagrawal","name":"sumitagrawal","key":"sumitagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"sumit agrawal","active":true,"timeZone":"Etc/UTC"},"body":"Hi [~andorm]\r\n\r\nAttached the patch with test case as similar to other test cases. Please suggest changes related to test case if needed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sumitagrawal","name":"sumitagrawal","key":"sumitagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"sumit agrawal","active":true,"timeZone":"Etc/UTC"},"created":"2018-02-25T19:07:25.229+0000","updated":"2018-02-25T19:07:25.229+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/comment/16376923","id":"16376923","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"body":"Thanks [~sumitagrawal]\r\n\r\nWould you please kindly create a pull request on github, so that more eyes of the community could see it?\r\n\r\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andorm","name":"andorm","key":"andorm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"},"displayName":"Andor Molnar","active":true,"timeZone":"Europe/Budapest"},"created":"2018-02-26T14:17:32.338+0000","updated":"2018-02-26T14:17:32.338+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/comment/16377073","id":"16377073","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user sumitagrawl opened a pull request:\n\n    https://github.com/apache/zookeeper/pull/474\n\n    ZOOKEEPER-2977: Concurrency for addAuth corrupts quorum packets\n\n    get copy of authInfo in ServerCnxn to avoid corrupt of quorum packets\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/sumitagrawl/zookeeper branch-3.4\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/zookeeper/pull/474.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #474\n    \n----\ncommit 870e2d98b1c5b8847b8f32c9d5f0a49ad696812c\nAuthor: sumitagrawal <sumit.jecrc@...>\nDate:   2018-02-26T15:52:46Z\n\n    ZOOKEEPER-2977: Concurrency for addAuth corrupts quorum packets\n    \n    get copy of authInfo in ServerCnxn\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-02-26T15:56:38.856+0000","updated":"2018-02-26T15:56:38.856+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/comment/16380063","id":"16380063","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sumitagrawal","name":"sumitagrawal","key":"sumitagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"sumit agrawal","active":true,"timeZone":"Etc/UTC"},"body":"Hi [~andorm],\r\n\r\nPlease help in getting reviewed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sumitagrawal","name":"sumitagrawal","key":"sumitagrawal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"sumit agrawal","active":true,"timeZone":"Etc/UTC"},"created":"2018-02-28T09:49:04.323+0000","updated":"2018-02-28T09:49:04.323+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/comment/16380932","id":"16380932","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user anmolnar commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/474\n  \n    @sumitagrawl Thanks for opening this pull request and thanks for the contribution.\r\n    This stuff with the test looks good to me.\r\n    Given that this is a fix in base class (ServerCnxn) rather than the NIO implementation, have you considered adding similar test to Netty as well?\r\n    It might be even better to have a separate test file for the common code, so we don't have to replicate tests every time we test something in here.\r\n    What do you think?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-02-28T19:42:05.995+0000","updated":"2018-02-28T19:42:05.995+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/comment/16381841","id":"16381841","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user rakeshadr commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/474\n  \n    @sumitagrawl Good analysis and fix. Few minor comments,\r\n    - Please take care indentation in the tests.  Presently, it uses tab.\r\n    - Please add comments in test as a quick reference to the issue to show the expectations and background of this test,  something like, https://github.com/apache/zookeeper/blob/master/src/java/test/org/apache/zookeeper/server/DataTreeTest.java#L70\r\n    - break; is not needed in loop, pls remove.\r\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-03-01T11:12:00.397+0000","updated":"2018-03-01T11:12:00.397+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/comment/16384268","id":"16384268","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user afine commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/474#discussion_r171980950\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/NIOServerCnxnTest.java ---\n    @@ -103,4 +105,22 @@ public void testValidSelectionKey() throws Exception {\n                 zk.close();\n             }\n         }\n    +\n    +    @Test(timeout = 30000)\n    +    public void testServerCnxnGetAuthInfoWithCopy() throws Exception {\n    +        final ZooKeeper zk = createZKClient(hostPort, 3000);\n    +        try {\n    +            Iterable<ServerCnxn> connections = serverFactory.getConnections();\n    +            for (ServerCnxn serverCnxn : connections) {\n    +            \tList<Id> authInfo = serverCnxn.getAuthInfo();\n    +            \tId id = new Id(\"testscheme\", \"test\");\n    +\t\t\t\tserverCnxn.addAuthInfo(id);\n    +\t\t\t\tAssert.assertTrue(!authInfo.contains(id));\n    --- End diff --\n    \n    nit: let's use assertFalse\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-03-02T22:44:31.068+0000","updated":"2018-03-02T22:44:31.068+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/comment/16391595","id":"16391595","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user sumitagrawl commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/474\n  \n    @rakeshadr @anmolnar @afine \r\n    Changes are done creating separate ServerCnxnTest.java for this purpose to avoid test duplicates. Also all above review comments are handled.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-03-08T17:43:08.294+0000","updated":"2018-03-08T17:43:08.294+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/comment/16391677","id":"16391677","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user afine commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/474#discussion_r173243505\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/ServerCnxnTest.java ---\n    @@ -0,0 +1,129 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +package org.apache.zookeeper.server;\n    +\n    +import java.io.IOException;\n    +import java.net.InetAddress;\n    +import java.net.InetSocketAddress;\n    +import java.nio.ByteBuffer;\n    +import java.util.List;\n    +\n    +import org.apache.jute.Record;\n    +import org.apache.zookeeper.WatchedEvent;\n    +import org.apache.zookeeper.ZKTestCase;\n    +import org.apache.zookeeper.data.Id;\n    +import org.apache.zookeeper.proto.ReplyHeader;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +\n    +public class ServerCnxnTest extends ZKTestCase {\n    +\n    +    /**\n    +     * Test getting a copy of authinfo to avoid parallel modification impact\n    +     */\n    +    @Test\n    +    public void testServerCnxnGetAuthInfoWithCopy() throws Exception {\n    +            MockServerCnxn serverCnxn = new MockServerCnxn();\n    +                List<Id> authInfo = serverCnxn.getAuthInfo();\n    --- End diff --\n    \n    nit: please fix this indentation\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-03-08T18:23:51.879+0000","updated":"2018-03-08T18:23:51.879+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/comment/16507991","id":"16507991","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12911964/2977.patch\n  against trunk revision a2623a625a4778720f7d5482d0a66e9b37ae556f.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    -1 patch.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3693//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2018-06-11T13:01:35.592+0000","updated":"2018-06-11T13:01:35.592+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/comment/16508281","id":"16508281","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  GitHub Pull Request  Build\n      \n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 2 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1823//testReport/\nFindbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1823//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nConsole output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/1823//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2018-06-11T16:14:45.106+0000","updated":"2018-06-11T16:14:45.106+0000"}],"maxResults":13,"total":13,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2977/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":7,"worklogs":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/worklog/110605","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user maoling commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/474\n  \n    @sumitagrawl  Can we move on?\n","created":"2018-06-11T12:58:41.316+0000","updated":"2018-06-11T12:58:41.316+0000","started":"2018-06-11T12:58:41.315+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"110605","issueId":"13137770"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/worklog/110675","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user sumitagrawl commented on the issue:\n\n    https://github.com/apache/zookeeper/pull/474\n  \n    @maoling @afine Comments are fixed, please check\n","created":"2018-06-11T16:28:36.992+0000","updated":"2018-06-11T16:28:36.992+0000","started":"2018-06-11T16:28:36.991+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"110675","issueId":"13137770"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/worklog/110752","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/474#discussion_r194529403\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/ServerCnxnTest.java ---\n    @@ -0,0 +1,130 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +package org.apache.zookeeper.server;\n    +\n    +import java.io.IOException;\n    +import java.net.InetAddress;\n    +import java.net.InetSocketAddress;\n    +import java.nio.ByteBuffer;\n    +import java.util.List;\n    +\n    +import org.apache.jute.Record;\n    +import org.apache.zookeeper.WatchedEvent;\n    +import org.apache.zookeeper.ZKTestCase;\n    +import org.apache.zookeeper.data.Id;\n    +import org.apache.zookeeper.proto.ReplyHeader;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +\n    +public class ServerCnxnTest extends ZKTestCase {\n    +\n    +    /**\n    +     * Test getting a copy of authinfo to avoid parallel modification impact\n    +     */\n    +    @Test\n    +    public void testServerCnxnGetAuthInfoWithCopy() throws Exception {\n    +        MockServerCnxn serverCnxn = new MockServerCnxn();\n    +        List<Id> authInfo = serverCnxn.getAuthInfo();\n    +        Id id = new Id(\"testscheme\", \"test\");\n    +        serverCnxn.addAuthInfo(id);\n    +        Assert.assertFalse(authInfo.contains(id));\n    +        Assert.assertTrue(serverCnxn.getAuthInfo().contains(id));\n    +    }\n    +    \n    +    /**\n    +     * Mock extension of ServerCnxn dummy to test for\n    +     * AuthInfo behavior (ZOOKEEPER-2977).\n    +     */\n    +    private static class MockServerCnxn extends ServerCnxn {\n    --- End diff --\n    \n    @sumitagrawl Can't you just use mockito to get the desired behaviour?\n","created":"2018-06-11T20:02:20.834+0000","updated":"2018-06-11T20:02:20.834+0000","started":"2018-06-11T20:02:20.834+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"110752","issueId":"13137770"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/worklog/111569","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user sumitagrawl commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/474#discussion_r195170907\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/ServerCnxnTest.java ---\n    @@ -0,0 +1,130 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +package org.apache.zookeeper.server;\n    +\n    +import java.io.IOException;\n    +import java.net.InetAddress;\n    +import java.net.InetSocketAddress;\n    +import java.nio.ByteBuffer;\n    +import java.util.List;\n    +\n    +import org.apache.jute.Record;\n    +import org.apache.zookeeper.WatchedEvent;\n    +import org.apache.zookeeper.ZKTestCase;\n    +import org.apache.zookeeper.data.Id;\n    +import org.apache.zookeeper.proto.ReplyHeader;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +\n    +public class ServerCnxnTest extends ZKTestCase {\n    +\n    +    /**\n    +     * Test getting a copy of authinfo to avoid parallel modification impact\n    +     */\n    +    @Test\n    +    public void testServerCnxnGetAuthInfoWithCopy() throws Exception {\n    +        MockServerCnxn serverCnxn = new MockServerCnxn();\n    +        List<Id> authInfo = serverCnxn.getAuthInfo();\n    +        Id id = new Id(\"testscheme\", \"test\");\n    +        serverCnxn.addAuthInfo(id);\n    +        Assert.assertFalse(authInfo.contains(id));\n    +        Assert.assertTrue(serverCnxn.getAuthInfo().contains(id));\n    +    }\n    +    \n    +    /**\n    +     * Mock extension of ServerCnxn dummy to test for\n    +     * AuthInfo behavior (ZOOKEEPER-2977).\n    +     */\n    +    private static class MockServerCnxn extends ServerCnxn {\n    --- End diff --\n    \n    Followed similar test case as MockNIOServerCnxn.java & NIOServerCnxnTest.java as present in same package, so should change this to use Mockito?\n","created":"2018-06-13T17:28:51.003+0000","updated":"2018-06-13T17:28:51.003+0000","started":"2018-06-13T17:28:51.003+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"111569","issueId":"13137770"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/worklog/111587","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/474#discussion_r195182437\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/ServerCnxnTest.java ---\n    @@ -0,0 +1,130 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +package org.apache.zookeeper.server;\n    +\n    +import java.io.IOException;\n    +import java.net.InetAddress;\n    +import java.net.InetSocketAddress;\n    +import java.nio.ByteBuffer;\n    +import java.util.List;\n    +\n    +import org.apache.jute.Record;\n    +import org.apache.zookeeper.WatchedEvent;\n    +import org.apache.zookeeper.ZKTestCase;\n    +import org.apache.zookeeper.data.Id;\n    +import org.apache.zookeeper.proto.ReplyHeader;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +\n    +public class ServerCnxnTest extends ZKTestCase {\n    +\n    +    /**\n    +     * Test getting a copy of authinfo to avoid parallel modification impact\n    +     */\n    +    @Test\n    +    public void testServerCnxnGetAuthInfoWithCopy() throws Exception {\n    +        MockServerCnxn serverCnxn = new MockServerCnxn();\n    +        List<Id> authInfo = serverCnxn.getAuthInfo();\n    +        Id id = new Id(\"testscheme\", \"test\");\n    +        serverCnxn.addAuthInfo(id);\n    +        Assert.assertFalse(authInfo.contains(id));\n    +        Assert.assertTrue(serverCnxn.getAuthInfo().contains(id));\n    +    }\n    +    \n    +    /**\n    +     * Mock extension of ServerCnxn dummy to test for\n    +     * AuthInfo behavior (ZOOKEEPER-2977).\n    +     */\n    +    private static class MockServerCnxn extends ServerCnxn {\n    --- End diff --\n    \n    Up to you. \r\n    \r\n    But, it's generally better to keep the scope of this patch for changes strictly related to the Jira and create separate one for other refactorings.\r\n    \r\n    I'm happy to commit both, but you need to do the paperwork.\n","created":"2018-06-13T18:04:08.703+0000","updated":"2018-06-13T18:04:08.703+0000","started":"2018-06-13T18:04:08.703+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"111587","issueId":"13137770"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/worklog/111733","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user sumitagrawl commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/474#discussion_r195275508\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/ServerCnxnTest.java ---\n    @@ -0,0 +1,130 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +package org.apache.zookeeper.server;\n    +\n    +import java.io.IOException;\n    +import java.net.InetAddress;\n    +import java.net.InetSocketAddress;\n    +import java.nio.ByteBuffer;\n    +import java.util.List;\n    +\n    +import org.apache.jute.Record;\n    +import org.apache.zookeeper.WatchedEvent;\n    +import org.apache.zookeeper.ZKTestCase;\n    +import org.apache.zookeeper.data.Id;\n    +import org.apache.zookeeper.proto.ReplyHeader;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +\n    +public class ServerCnxnTest extends ZKTestCase {\n    +\n    +    /**\n    +     * Test getting a copy of authinfo to avoid parallel modification impact\n    +     */\n    +    @Test\n    +    public void testServerCnxnGetAuthInfoWithCopy() throws Exception {\n    +        MockServerCnxn serverCnxn = new MockServerCnxn();\n    +        List<Id> authInfo = serverCnxn.getAuthInfo();\n    +        Id id = new Id(\"testscheme\", \"test\");\n    +        serverCnxn.addAuthInfo(id);\n    +        Assert.assertFalse(authInfo.contains(id));\n    +        Assert.assertTrue(serverCnxn.getAuthInfo().contains(id));\n    +    }\n    +    \n    +    /**\n    +     * Mock extension of ServerCnxn dummy to test for\n    +     * AuthInfo behavior (ZOOKEEPER-2977).\n    +     */\n    +    private static class MockServerCnxn extends ServerCnxn {\n    --- End diff --\n    \n    Ok, will change to Mockito.\r\n    Please share some details related to the paper work to be done.\n","created":"2018-06-14T00:39:14.482+0000","updated":"2018-06-14T00:39:14.482+0000","started":"2018-06-14T00:39:14.481+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"111733","issueId":"13137770"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137770/worklog/111767","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"comment":"Github user anmolnar commented on a diff in the pull request:\n\n    https://github.com/apache/zookeeper/pull/474#discussion_r195301371\n  \n    --- Diff: src/java/test/org/apache/zookeeper/server/ServerCnxnTest.java ---\n    @@ -0,0 +1,130 @@\n    +/**\n    + * Licensed to the Apache Software Foundation (ASF) under one\n    + * or more contributor license agreements.  See the NOTICE file\n    + * distributed with this work for additional information\n    + * regarding copyright ownership.  The ASF licenses this file\n    + * to you under the Apache License, Version 2.0 (the\n    + * \"License\"); you may not use this file except in compliance\n    + * with the License.  You may obtain a copy of the License at\n    + *\n    + *     http://www.apache.org/licenses/LICENSE-2.0\n    + *\n    + * Unless required by applicable law or agreed to in writing, software\n    + * distributed under the License is distributed on an \"AS IS\" BASIS,\n    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    + * See the License for the specific language governing permissions and\n    + * limitations under the License.\n    + */\n    +package org.apache.zookeeper.server;\n    +\n    +import java.io.IOException;\n    +import java.net.InetAddress;\n    +import java.net.InetSocketAddress;\n    +import java.nio.ByteBuffer;\n    +import java.util.List;\n    +\n    +import org.apache.jute.Record;\n    +import org.apache.zookeeper.WatchedEvent;\n    +import org.apache.zookeeper.ZKTestCase;\n    +import org.apache.zookeeper.data.Id;\n    +import org.apache.zookeeper.proto.ReplyHeader;\n    +import org.junit.Assert;\n    +import org.junit.Test;\n    +\n    +public class ServerCnxnTest extends ZKTestCase {\n    +\n    +    /**\n    +     * Test getting a copy of authinfo to avoid parallel modification impact\n    +     */\n    +    @Test\n    +    public void testServerCnxnGetAuthInfoWithCopy() throws Exception {\n    +        MockServerCnxn serverCnxn = new MockServerCnxn();\n    +        List<Id> authInfo = serverCnxn.getAuthInfo();\n    +        Id id = new Id(\"testscheme\", \"test\");\n    +        serverCnxn.addAuthInfo(id);\n    +        Assert.assertFalse(authInfo.contains(id));\n    +        Assert.assertTrue(serverCnxn.getAuthInfo().contains(id));\n    +    }\n    +    \n    +    /**\n    +     * Mock extension of ServerCnxn dummy to test for\n    +     * AuthInfo behavior (ZOOKEEPER-2977).\n    +     */\n    +    private static class MockServerCnxn extends ServerCnxn {\n    --- End diff --\n    \n    Cool, thanks @sumitagrawl \r\n    Sorry I was trying to kinda joking with \"paperwork\": you only need to create separate Jira and pull request for the refactoring. ;)\n","created":"2018-06-14T04:45:47.748+0000","updated":"2018-06-14T04:45:47.748+0000","started":"2018-06-14T04:45:47.747+0000","timeSpent":"10m","timeSpentSeconds":600,"id":"111767","issueId":"13137770"}]},"customfield_12311820":"0|i3q20f:"}}