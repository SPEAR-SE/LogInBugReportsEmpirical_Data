[Hi Ed,

It looks like [[:space:]]* is there to allow leading spaces, and it works on my box with GNU grep 2.10. What version of grep do you have?, The version of grep is whatever shipped with solaris 5.10 from all I can tell, as it doesn't even have a -V flag to check the version, man page looks just like this:

http://www.lehman.cuny.edu/cgi-bin/man-cgi?grep

I googled around a little, don't think the solaris grep is GNU grep, however GNU grep 2.5 is available in a strange path as /usr/sfw/bin/ggrep

I can confirm that using ggrep DOES work.  Not quite sure where that leaves this ticket though?, Maybe we can replace [:space:] with [ \t\r\n\v\f] or \s. They are equivalent to [:space:] in GNU grep I think. Could you try if either of these expression work on Solaris? If it does work, please go ahead and submit a patch, and I'll check it in.

Thanks!
--Michi, both

-bash-3.2$ grep "^[ \t\r\n\v\f]*dataDir" /fuse/zookeeper-3.4.6/bin/../conf/zoo.cfg
dataDir=/fuse/zookeeper_data

and

-bash-3.2$ grep "^[ \s]*dataDir" /fuse/zookeeper-3.4.6/bin/../conf/zoo.cfg
dataDir=/fuse/zookeeper_data

work with the ancient built in solaris grep with no leading space, a single leading space, and many leading spaces.

However... neither work if their is a tab character inserted before the dataDir variable....

They are supposed to recognize tab from what i've read, but they are not working.

I will see if I can play around and find any thing else that does work, unless you have some other suggestions?

Thanks,
Ed
, Thank you for trying these out Ed. I don't have any other suggestions, let me know if you find a pattern that works with tab characters. If not, we can still replace [:space:] with \s. At least that will fix the issue you are seeing, even if it doesn't work with leading tab characters. Would you like to go ahead and upload a patch?, Sure, I have never submitted a patch before, so it will take me a little bit to figure out the process.  But now is as good a time to learn as any :), I'm attaching a patch that does the following:
# On Solaris only, call /usr/xpg4/bin/grep.  This has the GNU grep semantics that the regex expects.
# On Solaris only, use a different incantation of /bin/echo to avoid echoing newline.

I tested this patch on both Solaris and CentOS.  I built a distro, started and stopped the server, and verified basic operations.
, +1, thanks [~cnauroth].

[~michim], [~rakeshr], [~hdeng]: it'd be nice to have this for 3.4.7, I'll merge once I get enough +1s. , -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12729720/ZOOKEEPER-1927.001.patch
  against trunk revision 1676359.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2665//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2665//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2665//console

This message is automatically generated., The patch looks good to me. Do we need this fix for trunk/3.5, or is it specific to 3.4?, Hi Michi.  This is a problem on both trunk and branch-3.4.  The patch file won't apply to branch-3.4, so I'll need to put together another patch file for branch-3.4.  Thanks for the review., I also noticed that the {{status}} command had some of the same problems with {{grep}} usage.  Here is patch v002 to add corrections for that.  After Jenkins runs this, I'll upload the branch-3.4 patch too., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12735388/ZOOKEEPER-1927.002.patch
  against trunk revision 1680994.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2713//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2713//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2713//console

This message is automatically generated., Here is the branch-3.4 patch., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12735401/ZOOKEEPER-1927-branch-3.4.002.patch
  against trunk revision 1680994.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2714//console

This message is automatically generated., Sorry for the delay here [~cnauroth]. Patches lgtm, merging. Thanks!, [~rgs], thank you!, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12735401/ZOOKEEPER-1927-branch-3.4.002.patch
  against trunk revision 1697227.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2840//console

This message is automatically generated., trunk: https://github.com/apache/zookeeper/commit/15bb2102467d44ac5b8914af59ecac83615b7f6e
3.4: https://github.com/apache/zookeeper/commit/87dcd61fccbb702affb5ae5e3d281a81c04673e6, FAILURE: Integrated in ZooKeeper-trunk #2793 (See [https://builds.apache.org/job/ZooKeeper-trunk/2793/])
ZOOKEEPER-1927: zkServer.sh fails to read dataDir (and others)
from zoo.cfg on Solaris 10 (grep issue, manifests as FAILED TO WRITE PID)
(Chris Nauroth via rgs) (rgs: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1697551)
* /zookeeper/trunk/CHANGES.txt
* /zookeeper/trunk/bin/zkServer.sh
, Oops -- forgot to merge for 3.5 (literally a year ago!):

https://github.com/apache/zookeeper/commit/ac26b96b61e116937239a15fb4dbcc4f17a4f818

(thanks [~phunt] for the heads-up) 
]