[I've just picked a similar one so I guess the problem is more generic and has to do with the way zkCli.sh handles exceptions (i.e., misses handling some of them). This time I misspelled the parameter of the connect command (I forgot the ":"):

Output:

connect localhost2181
2010-05-25 11:28:25,241 - INFO  [main:ZooKeeper@538] - Session: 0x128cec5e35f0014 closed
2010-05-25 11:28:25,242 - INFO  [main:ZooKeeper@373] - Initiating client connection, connectString=localhost2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@1bac748
Exception in thread "main" java.net.UnknownHostException: localhost2181
	at java.net.Inet6AddressImpl.lookupAllHostAddr(Native Method)
	at java.net.InetAddress$1.lookupAllHostAddr(InetAddress.java:849)
	at java.net.InetAddress.getAddressFromNameService(InetAddress.java:1200)
	at java.net.InetAddress.getAllByName0(InetAddress.java:1153)
	at java.net.InetAddress.getAllByName(InetAddress.java:1083)
	at java.net.InetAddress.getAllByName(InetAddress.java:1019)
	at org.apache.zookeeper.ClientCnxn.<init>(ClientCnxn.java:383)
	at org.apache.zookeeper.ClientCnxn.<init>(ClientCnxn.java:328)
	at org.apache.zookeeper.ZooKeeper.<init>(ZooKeeper.java:377)
	at org.apache.zookeeper.ZooKeeperMain.connectToZK(ZooKeeperMain.java:261)
	at org.apache.zookeeper.ZooKeeperMain.processZKCmd(ZooKeeperMain.java:648)
	at org.apache.zookeeper.ZooKeeperMain.processCmd(ZooKeeperMain.java:581)
	at org.apache.zookeeper.ZooKeeperMain.executeLine(ZooKeeperMain.java:353)
	at org.apache.zookeeper.ZooKeeperMain.run(ZooKeeperMain.java:311)
	at org.apache.zookeeper.ZooKeeperMain.main(ZooKeeperMain.java:270)
, If no data is provided for the new node when using the "create" zkCli.sh command assume an empty byte array. , -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12445820/ZOOKEEPER-780.patch
  against trunk revision 961026.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/95/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/95/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/95/console

This message is automatically generated., Andrei, this looks like a good fix, however Miguel has a point about the error handling. Perhaps you could address that in this patch as well? The main loop (interractive shell) should output the error information but continue rather than exiting the shell. no?, Added a generic exception handler for all kinds of unexpected errors. 

Output:

[zk: (CLOSED) 1] connect localhost2181
2010-07-29 15:13:32,364 [myid:] - INFO  [main:ZooKeeper@375] - Initiating client connection, connectString=localhost2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@209f4e
Command failes: java.net.UnknownHostException: localhost2181

This should make the CLI interface much more robust. , found a typo. will resubmit patch, Fixed typo failes -> failed. , -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12450816/ZOOKEEPER-780.patch
  against trunk revision 980576.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/102/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/102/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/102/console

This message is automatically generated., The failing test is not related to this patch: 

     [exec]      [exec] /grid/0/hudson/hudson-slave/workspace/Zookeeper-Patch-h7.grid.sp2.yahoo.net/trunk/src/c/tests/TestClient.cc:879: Assertion: assertion failed [Expression: ctx.waitForConnected(zk)]
     [exec]      [exec] Failures !!!

, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12450816/ZOOKEEPER-780.patch
  against trunk revision 980576.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/106/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/106/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/106/console

This message is automatically generated., I will take  a look tomorrow. Maybe the test failure is somehow related to my change even if I don't understand how. , retriggereing the patch build., re-submiting to hudson, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12450816/ZOOKEEPER-780.patch
  against trunk revision 1032885.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    -1 javac.  The patch appears to cause tar ant target to fail.

    -1 findbugs.  The patch appears to cause Findbugs to fail.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

    -1 system test framework.  The patch failed system test framework compile.

Test results: https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/4//testReport/
Console output: https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/4//console

This message is automatically generated., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12450816/ZOOKEEPER-780.patch
  against trunk revision 1033134.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    -1 findbugs.  The patch appears to introduce 1 new Findbugs warnings.

    -1 release audit.  The applied patch generated 24 release audit warnings (more than the trunk's current 0 warnings).

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

    -1 system test framework.  The patch failed system test framework compile.

Test results: https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/5//testReport/
Release audit warnings: https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/5//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt
Findbugs warnings: https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/5//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/5//console

This message is automatically generated., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12450816/ZOOKEEPER-780.patch
  against trunk revision 1033155.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/6//testReport/
Findbugs warnings: https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/6//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/6//console

This message is automatically generated., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12450816/ZOOKEEPER-780.patch
  against trunk revision 1033155.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/15//testReport/
Findbugs warnings: https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/15//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/15//console

This message is automatically generated., Andrei, this is a good fix, could you create a test for this? Thanks., I will create a new test class for testing {{ZooKeeperMain}}. There are no previous tests for this class. , Agreed (no prev tests) but really this highlights that there should be. Thanks!, Hi [~mahadev]  I've gone through trunk code and have seen ZOOKEEPER-271, which has refactored ZooKeeperMain command line processing logic. 
Now in trunk it would not enter into this(ArrayIndexOutOfBoundsException) case. Should we need to fix this issue in 3.4.6? If not, I feel we can just close this issue. Whats your opinion?, This is no longer an issue after https://issues.apache.org/jira/browse/ZOOKEEPER-271 got checked in.]