[it is also failing on 1.7.1. (i just wasn't letting it run long enough when i first tried it.), By removing the following line from the ivy-init task, it works:

{noformat}
      <!-- ensure that ivy taskdef is only run once, otw ant will error -->
      <property name="ivy.initialized" value="true"/>
{noformat}

I'm not really sure why this is necessary, so I'm just commenting out for now. If anyone has a strong reason not to remove, please say so., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12429545/ZOOKEEPER-637.patch
  against trunk revision 896144.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/99/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/99/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/99/console

This message is automatically generated., Committed revision 896551., iny.initialized needs to go back, otw "ant compile compile-test" type stuff will fail

this is due to the way ant handles multiple targets specified on the command line (it re-evaluates
all dependencies for each target specified" and ivy will then fail (loaded > 1 time)

You'll need to find another workaround. I don't understand from your description what the original
issue is. what is the problem? "ivy setttings don't persist" - i don't know what this means.
, Integrated in ZooKeeper-trunk #655 (See [http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/655/])
    . Trunk build is failing.
, Pat, If you check the error message we were getting before:

{noformat}
ZooKeepe doesn't reference an ivy:settings
{noformat}

and the piece of code that generates this message: 

http://www.java2s.com/Open-Source/Java-Document/Code-Analyzer/apache-ivy/org/apache/ivy/ant/IvyTask.java.htm

it seems that the following task has not been executed when we get the error message (it does seem that it has been executed before):

{noformat}
<ivy:settings id="${ant.project.name}" file="${ivysettings.xml}"/>
{noformat}

I believe my suspicion has been confirmed after I removed the the command above. , I believe the issue was with the taskdef, not ivy:settings

Can you try moving ivy:settings into it's own target that's always run, but taskdef only run if
ivy.initialized is not set? They try both use cases (yours and the one I mentioned).
, makes sure that taskdef is only run once., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12429574/ZOOKEEPER-632_2.patch
  against trunk revision 896551.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/31/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/31/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/31/console

This message is automatically generated., +1, I've run ant with a couple of different options, including test, and it looks good. I have just committed it, and I hope this issue is finally fixed. Thanks for all the help so far guys. (Committed revision 896800.), Integrated in ZooKeeper-trunk #656 (See [http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/656/])
    . Trunk build is failing - second patch (breed via fpj)
]