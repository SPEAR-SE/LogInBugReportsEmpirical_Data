[suggested path , delete the right watch  , -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12832348/ZOOKEEPER-2611.patch
  against trunk revision df5519ab9dac9940f35cc4b308b560f2603aec7f.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3473//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3473//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3473//console

This message is automatically generated., 
I checked with debug prints the the write watch is actually removed. 
The current unit-tests didn't caught this bug - because they tested cases when only 1 watch was on the list.



, [~Eyal.leshem] thanks for the patch! LGTM, do you think you could also  add a test case with > 1 watch?, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12832375/ZOOKEEPER-2611.patch
  against trunk revision df5519ab9dac9940f35cc4b308b560f2603aec7f.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3475//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3475//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3475//console

This message is automatically generated., The context parameter is in the wrong place (the last parameter is struct Stat \*stat, whereas the 4th param is void\* watcherCtx):

{code}
int zoo_wget(zhandle_t *zh, const char *path,
        watcher_fn watcher, void* watcherCtx,
        char *buffer, int* buffer_len, struct Stat *stat)
{code}, [~Eyal.leshem]: see my comment above, the ctxt parameter is in the wrong place. The tests logs are here:

https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3475//console, hope this time is better , +1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12832377/ZOOKEEPER-2611.patch
  against trunk revision df5519ab9dac9940f35cc4b308b560f2603aec7f.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3477//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3477//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3477//console

This message is automatically generated., Merged for master & 3.5:

https://git-wip-us.apache.org/repos/asf?p=zookeeper.git;a=commitdiff;h=f78061aafb19b102c37cb6d744ec6258d5f5b66e
https://git-wip-us.apache.org/repos/asf?p=zookeeper.git;a=commitdiff;h=d53501b090906a89bfa30cce582d18a06123e49c

Thanks [~Eyal.leshem]!, SUCCESS: Integrated in Jenkins build ZooKeeper-trunk #3113 (See [https://builds.apache.org/job/ZooKeeper-trunk/3113/])
ZOOKEEPER-2611: zoo_remove_watchers - can remove the wrong watch (Eyal (rgs: rev f78061aafb19b102c37cb6d744ec6258d5f5b66e)
* (edit) CHANGES.txt
* (edit) src/c/tests/TestClient.cc
* (edit) src/c/src/zk_hashtable.c
, [~rgs], I've added the fix version to the jira, please feel free to edit if needed.

[~fpj], could you please add [~Eyal.leshem] to the contributor list and assign the work to him. Thanks!]