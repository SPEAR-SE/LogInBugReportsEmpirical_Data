[GitHub user hanm opened a pull request:

    https://github.com/apache/zookeeper/pull/100

    ZOOKEEPER-2627:Remove ZRWSERVERFOUND from C client.

    JIRA: https://issues.apache.org/jira/browse/ZOOKEEPER-2627
    
    * Remove ZRWSERVERFOUND from C client to maintain consistency of error codes definition between Java / C client.
    * Make C client behavior more conforming with Java client in RO mode by having an explicit RW server address and use that address whenever it's available.


You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/hanm/zookeeper ZOOKEEPER-2627

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/zookeeper/pull/100.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #100
    
----
commit 81a0de2298efdce83061faf6f6a4b0b89e245b64
Author: Michael Han <hanm@cloudera.com>
Date:   2016-11-04T22:34:55Z

    ZOOKEEPER-2627:Remove ZRWSERVERFOUND from C client.

----
, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12837305/ZOOKEEPER-2627.patch
  against trunk revision bcb07a09b06c91243ed244f04a71b8daf629e286.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    -1 findbugs.  The patch appears to introduce 19 new Findbugs (version 3.0.1) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3520//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3520//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3520//console

This message is automatically generated., Github user rgs1 commented on a diff in the pull request:

    https://github.com/apache/zookeeper/pull/100#discussion_r86673221
  
    --- Diff: src/c/src/zookeeper.c ---
    @@ -1702,15 +1703,9 @@ static void handle_error(zhandle_t *zh,int rc)
         }
         cleanup_bufs(zh,1,rc);
         zh->fd = -1;
    -
    + 
    --- End diff --
    
    nit: drop the whitespace that was introduced
, Github user rgs1 commented on a diff in the pull request:

    https://github.com/apache/zookeeper/pull/100#discussion_r86673245
  
    --- Diff: src/c/src/zookeeper.c ---
    @@ -2072,6 +2076,11 @@ static int ping_rw_server(zhandle_t* zh)
     
     out:
         close(sock);
    +    if (!rc) {
    +        addr_rw_server = 0;
    +    } else {
    +        addr_rw_server = &zh->addr_rw_server;
    +    }
    --- End diff --
    
    nit:
    
    ```
    addr_rw_server = rc ? &zh->addr_rw_server : 0;
    ```
, Thanks for cleaning this up [~hanm]! Wonder what others thing of the ABI breakage; other than that lgtm, Github user hanm commented on the issue:

    https://github.com/apache/zookeeper/pull/100
  
    Thanks for the review, @rgs1. Patch and PR is updated.
, Github user rgs1 commented on the issue:

    https://github.com/apache/zookeeper/pull/100
  
    Thanks @hanm ! Lets wait until Monday to see what @breed thinks and then I am happy to merge this. What do you think?
, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12837642/ZOOKEEPER-2627.patch
  against trunk revision bcb07a09b06c91243ed244f04a71b8daf629e286.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    -1 findbugs.  The patch appears to introduce 19 new Findbugs (version 3.0.1) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3523//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3523//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3523//console

This message is automatically generated., Github user hanm commented on the issue:

    https://github.com/apache/zookeeper/pull/100
  
    @rgs1 Sure, no need to rush this in.
, Github user hanm commented on the issue:

    https://github.com/apache/zookeeper/pull/100
  
    @breed Wondering if you have time to look at this PR - in particular if breakage of ABI of C client library is a concern or not.
, Github user hanm commented on the issue:

    https://github.com/apache/zookeeper/pull/100
  
    @breed @rgs1 Gentle nudge: Is this PR good to merge? I have some other PR to be sent over that depends on this one. Would be good to get this in first.
, -1 overall.  GitHub Pull Request  Build
      

    +1 @author.  The patch does not contain any @author tags.

    +0 tests included.  The patch appears to be a documentation patch that doesn't require tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 3.0.1) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/92//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/92//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-github-pr-build/92//console

This message is automatically generated., Github user breed commented on the issue:

    https://github.com/apache/zookeeper/pull/100
  
    +1 everything looks good from our side. we don't use that error code.
, Github user hanm commented on the issue:

    https://github.com/apache/zookeeper/pull/100
  
    cool thanks @breed.
    @rgs1 Could you please merge & close this PR?
, Github user asfgit closed the pull request at:

    https://github.com/apache/zookeeper/pull/100
, Merged to trunk & branch-3.5, thanks [~hanm]!, FAILURE: Integrated in Jenkins build ZooKeeper-trunk #3180 (See [https://builds.apache.org/job/ZooKeeper-trunk/3180/])
ZOOKEEPER-2627: Remove ZRWSERVERFOUND from C client. (rgs: rev 73d6bf5353586e49740f77291d1fd98b07f916cc)
* (edit) src/c/src/zookeeper.c
* (edit) src/c/include/zookeeper.h
* (edit) src/c/src/zk_adaptor.h
]