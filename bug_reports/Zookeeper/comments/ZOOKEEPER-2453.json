[[~mthies] it does look like it is related to ZOOKEEPER-1374, are you interested in providing a patch for this?, [~mthies]: hmm, what compilers do we have to support? This could be useful:

https://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Atomic-Builtins.html, Seems to me this is the same issue as in 1374, just replacing the asm in fetch_and_add with __sync_fetch_and_add would work. ]