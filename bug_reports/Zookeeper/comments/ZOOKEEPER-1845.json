[I just noticed this is not a problem in trunk. It uses a set to keep track of who have joined, and it doesn't check whether the leader thread is alive or not., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12619007/ZOOKEEPER-1845-3.4.patch
  against trunk revision 1551366.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1842//console

This message is automatically generated., Shouldn't the last access to joinedThreads in line 317 also be in a synchronized block?
, It feels like I've seen this problem before. What's the jira that fixed this problem for trunk?, Here it is., Closing as a dup of ZOOKEEPER-1733. I'll reopen ZOOKEEPER-1733 and backport the patch to 3.4., I uploaded a new patch that addresses German's comment here:

https://issues.apache.org/jira/browse/ZOOKEEPER-1733, Closing issues after releasing 3.4.6.]