[This problem is because dynamicConfigFile path is written with single backward slash, \, in zoo.cfg file. Backward slash is ignored while loading the properties file which leads to invalid path for dynamicConfigFile.

To fix this we should always write dynamicConfigFile  path with / in zoo.cfg file. This will work on all the platforms
, Thanks [~arshad.mohammad] for reporting this. Just one quick suggestion. It seems {{ConfigBaseSystemTest}} has duplicate codes. How about extending {{ConfigBaseSystemTest extends BaseSysTest}} and override the necessary functions which needs for testing?, Thanks [~rakeshr] for your comments. Currently org.apache.zookeeper.test.system.BaseSysTest has few problems, I have created another jira  ZOOKEEPER-2245. I will extend BaseSysTest and submit patch after ZOOKEEPER-2245 is resolved, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12749828/ZOOKEEPER-2244-01.patch
  against trunk revision 1694317.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 9 new or modified tests.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2823//console

This message is automatically generated., Worked on the comments given by [~rakeshr]
Also now  this patch is overriding the problematic methods in {{org.apache.zookeeper.test.system.BaseSysTest}}. So this patch can be applied independently of ZOOKEEPER-2245., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12750066/ZOOKEEPER-2244-02.patch
  against trunk revision 1694317.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 9 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2828//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2828//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2828//console

This message is automatically generated., Test case failure {{ org.apache.zookeeper.test.StaticHostProviderTest.testTwoInvalidHostAddresses}} is not related to this patch, submitting new patch. Modified test case, used {org.apache.zookeeper.server.quorum.QuorumPeerTestBase} as base test case. , -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12753209/ZOOKEEPER-2244-03.patch
  against trunk revision 1698058.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 5 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2849//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2849//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2849//console

This message is automatically generated., No test case failure, one skipped test case is not related to this patch, I don't think it's very important but I would suggest using org.apache.zookeeper.common.PathUtils.normalizeFileSystemPath., This looks good overall.  I agree with the suggestion to use {{PathUtils#normalizeFileSystemPath}}.  Thank you, [~arshad.mohammad]!, Thanks [~benjamin.jaton] and [~cnauroth] for reviewing the patch. Handled the suggestion and submitted new patch ZOOKEEPER-2244-04.patch, +1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12756165/ZOOKEEPER-2244-04.patch
  against trunk revision 1702378.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 5 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2878//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2878//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2878//console

This message is automatically generated., +1 for patch v04.  I ran the new {{ZKServerRestartTest}} on Windows and confirmed that it fails before the fix in the product code, and then passes after applying the fix in the product code.

[~rakeshr], would you also please review v04?  Thank you!, Hi [~cnauroth], [~arshad.mohammad] - one question, why do we need another waitFor*Connected method in src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerTestBase.java: 

{code}
+    protected synchronized boolean waitForClientConnect(ZooKeeper zk, long timeout)
+            throws InterruptedException {
+        connected = (zk.getState() == States.CONNECTED);
+        long end = Time.currentElapsedTime() + timeout;
+        while (!connected && end > Time.currentElapsedTime()) {
+            wait(timeout);
+            connected = (zk.getState() == States.CONNECTED);
+        }
+        return connected;
+    }
{code}

We have a few of those already.. can't we reuse one of those?

Other than that, lgtm. Thanks!, Thanks [~rgs] for your review comments.
# Used {{org.apache.zookeeper.test.ClientBase.CountdownWatcher}} to ensure ZooKeeper client connected before use.
# I could not find any existing API which gives connection string, so adding {{org.apache.zookeeper.server.quorum.QuorumPeerTestBase.getCxnString(int[])}} new API

Submitted new patch ZOOKEEPER-2244-05.patch, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12763994/ZOOKEEPER-2244-05.patch
  against trunk revision 1705482.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2889//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2889//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2889//console

This message is automatically generated., Thanks [~arshad.mohammad] for taking care this.

bq. Used org.apache.zookeeper.test.ClientBase.CountdownWatcher to ensure ZooKeeper client connected before use.
Agreed. But I couldn't see unit test case in latest patch, is that missed?

bq.  I could not find any existing API which gives connection string, so adding org.apache.zookeeper.server.quorum.QuorumPeerTestBase.getCxnString(int[]) new API
Here, instead of passing full connection string, we can pass one of the client port as you are ensuring that all the servers are running before the ZooKeeper client creation, right?. Please refer [QuorumPeerMainTest.java#L100|https://github.com/apache/zookeeper/blob/trunk/src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java#L100] to see similar usage in existing tests., Thanks [~rakeshr] for your suggestion.
Submitting new patch ZOOKEEPER-2244-06.patch, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12764027/ZOOKEEPER-2244-06.patch
  against trunk revision 1705482.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 2 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2892//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2892//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2892//console

This message is automatically generated., Thanks [~arshad.mohammad].

Just one last comment, I failed to identify this point in my previous reviews:(. For me this unit test case looks like a backward compatibility testing for the reconfiguration module. I could see there is a similar unit test in [ReconfigLegacyTest.java#L54|https://github.com/apache/zookeeper/blob/trunk/src/java/test/org/apache/zookeeper/server/quorum/ReconfigLegacyTest.java#L54]. Can we move the newly added unit test case into {{ReconfigLegacyTest#testRestartZooKeeperServer}} test class?

Apart from this +1 from me., Thanks once again [~rakeshr]. Submitting  ZOOKEEPER-2244-07.patch :-), +1 from me again on patch v07, pending a fresh pre-commit run.  I confirmed once again that the test fails on Windows before applying the product code fix, and then it passes after applying the fix.

[~arshad.mohammad], thank you for fixing this!

[~rgs] and [~rakeshr], thank you for the help on code review and pointing out some test improvements., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12764076/ZOOKEEPER-2244-07.patch
  against trunk revision 1705482.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2895//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2895//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2895//console

This message is automatically generated., Test failure is not related to this patch, +1 I'll commit this shortly.

Thanks [~arshad.mohammad] for the contribution!
Thanks [~cnauroth], [~rgs], [~benjamin.jaton] for the reviews!, I've modified the test name to {{#testRestartZooKeeperServer}} and attached the committed patch to the jira.

Committed to trunk : http://svn.apache.org/viewvc?view=revision&revision=1705795
Committed to br3.5 : http://svn.apache.org/viewvc?view=revision&revision=1705796, FAILURE: Integrated in ZooKeeper-trunk #2801 (See [https://builds.apache.org/job/ZooKeeper-trunk/2801/])
ZOOKEEPER-2244: On Windows zookeeper fails to restart (Arshad Mohammad via rakeshr) (rakeshr: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1705794)
* /zookeeper/trunk/CHANGES.txt
* /zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java
* /zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/ReconfigLegacyTest.java
, Thanks [~cnauroth], [~rgs], [~benjamin.jaton] for the reviews
Thanks [~rakeshr] for reviews and commit :-)]