[Moving to 3.0.0, Moved disconnect() into ZooKeeperStub class which I added to test package. Also removed the "describeCNXN()" method from ZooKeeper since this seems like a test method rather than a public api method (we should have include it as part of zk.toString() if it's interesting for debugging purposes)., canceling pending some changes I have in mind to remove processwatchevent from public exposure in the zk client api, This is the same as the last patch + it has a change to remove the processWatchEvent(event) from the public api of ZooKeeper.java client class.

Basically I have a (private) nested class that implements the
Watcher.process(event) method and I provide an instance of that class to the client cnxn.

ZooKeeper client public intf is very clean at this point.
, +1 I do have some nits: I don't really like the name ZooKeeperStub, since stub usually refers to a non functional implementation. ZooKeeperStub is fully functional but also allows disconnection. Perhaps DisconnectableZooKeeper maybe? You trade having disconnect on ZooKeeper with making ClientCnxn public, which also pollutes the public API. Perhaps ZooKeeperStub should go into src/java/test/org/apache/zookeeper/ZooKeeperStub. That way you get package visibility for ClientCnxn, but you still keep ZooKeeperStub out of the main tree.

Both are just nits, and I support committing the change if you don't want to fix it., renamed zkstub per ben's suggestion, Committed revision 692534., Integrated in ZooKeeper-trunk #76 (See [http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/76/]), 3.0.0 has been released, closing issues.]