[Attaching patch., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12754255/ZOOKEEPER-2253.patch
  against trunk revision 1698058.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2855//console

This message is automatically generated., Thanks for the patch [~cchen]! Though, it's not applying:

{code}
     [exec] patching file src/c/src/zookeeper.c
     [exec] Hunk #1 succeeded at 1617 (offset 105 lines).
     [exec] Hunk #2 FAILED at 1877.
     [exec] Hunk #3 succeeded at 2740 (offset 259 lines).
     [exec] Hunk #4 succeeded at 2852 (offset 259 lines).
     [exec] Hunk #5 FAILED at 2664.
     [exec] 2 out of 5 hunks FAILED -- saving rejects to file src/c/src/zookeeper.c.rej
     [exec] patching file src/c/tests/TestOperations.cc
     [exec] PATCH APPLICATION FAILED
{code}

Do you have a fresh checkout?, Hmm, I am not sure about this:

{code}
-            if (hdr.xid != PING_XID && hdr.zxid > 0) {
+            if (hdr.zxid > 0) {
                 // Update last_zxid only when it is a request response
                 zh->last_zxid = hdr.zxid;
             }
{code}

Does the Java implementation update last_zxid on pings as well? How is this related to out of order pings?, Updated patch against HEAD., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12754535/ZOOKEEPER-2253.patch
  against trunk revision 1701505.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2858//console

This message is automatically generated., There is no last_zxid check since the zxid is -1 for pings right?

This here is a test because in the C client the ping replies are "in order" but if this check wasn't there the C client would set the last zxid to -1.

With this patch (hdr.xid != PING_XID) is guaranteed to be false, so., There is no last_zxid check since the zxid is -1 for pings right?

This here is a test because in the C client the ping replies are "in order" but if this check wasn't there the C client would set the last zxid to -1.

With this patch (hdr.xid != PING_XID) is guaranteed to be false, so., Arrgh patchy., +1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12754536/ZOOKEEPER-2253.patch
  against trunk revision 1701505.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2859//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2859//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2859//console

This message is automatically generated., Added patch for 3.4 branch., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12754676/zookeeper-2253-3.4.patch
  against trunk revision 1701505.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2864//console

This message is automatically generated., wait, we are mixing things.

xid != zxid

xid --> id used to pair each request with its reply.
zxid --> the last transaction id seen by the quorum.

which one are you referring to?, Yes, sorry, I meant to say

The conditional check here is for a reply packet to update the last seen zxid. Because we match for a ping packet in another block that check is now superfluous., [~rgs] lemme know if you have any questions, Ah, you right. Thanks or clarifying. , Merged:

trunk - https://github.com/apache/zookeeper/commit/bd9a1448f9b29859092e6bdca93da121ec166b7a
3.5 - https://github.com/apache/zookeeper/commit/1fab0ada53d7de36d5825625d548f0ac90085910

Thanks [~cchen]!, FAILURE: Integrated in ZooKeeper-trunk #2800 (See [https://builds.apache.org/job/ZooKeeper-trunk/2800/])
ZOOKEEPER-2253: C asserts ordering of ping requests, while Java client does not
(Chris Chen via rgs) (rgs: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1705482)
* /zookeeper/trunk/CHANGES.txt
* /zookeeper/trunk/src/c/src/zookeeper.c
* /zookeeper/trunk/src/c/tests/TestOperations.cc
, Oops, forgot about 3.4: https://github.com/apache/zookeeper/commit/ff4ea0cff2cf2eab25406897f2097e6e2916d21c]