[This patch adds a test case that reproduces the problem and a fix (that passes the test).

The fix simply removes votes for hosts that a peer has not heard from before the vote is counted., +1 for the patch. The only suggestion I have is to replace e.printStackTrace() statements with LOG("msg", e) statements. I received this comment on another patch, so I'm just passing the message along. :-) , This patch appears to solve the problem for algorithm 0- our unit test completed successfully 16 times., here is a patch that changes e.printstacktrace to log.err.... other than that the patch looks good. +1, forgot to add the test file., I just committed this. Thanks Ben., Integrated in ZooKeeper-trunk #89 (See [http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/89/]), 3.0.0 has been released, closing issues.]