[GitHub user rakeshadr opened a pull request:

    https://github.com/apache/zookeeper/pull/170

    ZOOKEEPER-2689: Fix Kerberos Authentication related test cases

    Presently 'MiniKdc.java' uses Apache Kerby which has a build requirement of jdk1.7+, http://directory.apache.org/kerby/developer-guide.html]. Since branch-3.4.x support Java 1.6 or higher, Apache Kerby binding is causing trouble.
    
    I've tried an attempt to rewrite MiniKdc.java test using old way of Kerberos implementation provided by Apache Directory Server project, org.apache.directory.* packages. Please refer MiniKdc implementation of Hadoop, trunk branch git hash revision 42e3a805117ff7cb054c2442f7b0e0cc54be63ad

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/rakeshadr/zookeeper-1 ZK-2689

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/zookeeper/pull/170.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #170
    
----
commit fd96cb96ed6b5974b9c6360fb6991a32744a4b34
Author: Rakesh Radhakrishnan <rakeshr@apache.org>
Date:   2017-02-10T17:02:15Z

    ZOOKEEPER-2689: Fix Kerberos Authentication related test cases

----
, Hi [~hanm], [~arshad.mohammad], [~eribeiro] would be great to see your feedback on the proposed changes. Thanks!, Github user arshadmohammad commented on a diff in the pull request:

    https://github.com/apache/zookeeper/pull/170#discussion_r100673430
  
    --- Diff: ivy.xml ---
    @@ -78,30 +78,38 @@
         <dependency org="commons-io" name="commons-io" rev="2.4"
                     conf="test->default"/>
     
    -    <dependency org="org.apache.kerby" name="kerb-simplekdc" rev="1.0.0-RC2"
    -                conf="test->default"/>
    -    <dependency org="org.apache.kerby" name="kerby-config" rev="1.0.0-RC2"
    -                conf="test->default"/>
    -    <dependency org="org.apache.kerby" name="kerb-core" rev="1.0.0-RC2"
    -                conf="test->default"/>
    -    <dependency org="org.apache.kerby" name="kerb-server" rev="1.0.0-RC2"
    -                conf="test->default"/>
    -    <dependency org="org.apache.kerby" name="kerb-common" rev="1.0.0-RC2"
    -                conf="test->default"/>
    -    <dependency org="org.apache.kerby" name="kerb-admin" rev="1.0.0-RC2"
    -                conf="test->default"/>
    -    <dependency org="org.apache.kerby" name="kerb-identity" rev="1.0.0-RC2"
    -                conf="test->default"/>
    -    <dependency org="org.apache.kerby" name="kerb-client" rev="1.0.0-RC2"
    -                conf="test->default"/>
    -    <dependency org="org.apache.kerby" name="kerb-util" rev="1.0.0-RC2"
    -                conf="test->default"/>
    -    <dependency org="org.apache.kerby" name="kerb-crypto" rev="1.0.0-RC2"
    -                conf="test->default"/>
    -    <dependency org="org.apache.kerby" name="kerby-util" rev="1.0.0-RC2"
    -                conf="test->default"/>
    -    <dependency org="org.apache.kerby" name="kerby-asn1" rev="1.0.0-RC2"
    -                conf="test->default"/>
    +
    +    <!-- Apache directory server project, org.apache.directory.* packages for miniKdc tests -->
    +    <dependency org="org.apache.directory.server" name="apacheds-core-api" rev="2.0.0-M15">
    --- End diff --
    
    dependency scope(conf="test->default".) is missing,  Because of this when zookeeper is build its lib directory contains lot of extra jars which are not required.
, Github user arshadmohammad commented on a diff in the pull request:

    https://github.com/apache/zookeeper/pull/170#discussion_r100673515
  
    --- Diff: src/java/test/org/apache/zookeeper/server/quorum/auth/MiniKdcTest.java ---
    @@ -18,8 +18,8 @@
     
     package org.apache.zookeeper.server.quorum.auth;
     
    -import org.apache.kerby.kerberos.kerb.keytab.Keytab;
    -import org.apache.kerby.kerberos.kerb.type.base.PrincipalName;
    +import org.apache.directory.server.kerberos.shared.keytab.Keytab;
    +import org.apache.directory.server.kerberos.shared.keytab.KeytabEntry;
     import org.junit.Assert;
     import org.junit.Test;
    --- End diff --
    
    import java.util.List; is unused now. delete it. It is not listed here but is part of this class imports
, Github user rakeshadr commented on a diff in the pull request:

    https://github.com/apache/zookeeper/pull/170#discussion_r100700701
  
    --- Diff: src/java/test/org/apache/zookeeper/server/quorum/auth/MiniKdcTest.java ---
    @@ -18,8 +18,8 @@
     
     package org.apache.zookeeper.server.quorum.auth;
     
    -import org.apache.kerby.kerberos.kerb.keytab.Keytab;
    -import org.apache.kerby.kerberos.kerb.type.base.PrincipalName;
    +import org.apache.directory.server.kerberos.shared.keytab.Keytab;
    +import org.apache.directory.server.kerberos.shared.keytab.KeytabEntry;
     import org.junit.Assert;
     import org.junit.Test;
    --- End diff --
    
    Thanks @arshadmohammad  for the useful comments. Done another commit addressing your comments.
, Github user arshadmohammad commented on the issue:

    https://github.com/apache/zookeeper/pull/170
  
    +1, LGTM
    I will commit this PR today if no more review comments.
, Github user eribeiro commented on the issue:

    https://github.com/apache/zookeeper/pull/170
  
    I didn't catch anything worth comment. :+1: 
, Issue resolved by pull request 170
[https://github.com/apache/zookeeper/pull/170], Github user arshadmohammad commented on the issue:

    https://github.com/apache/zookeeper/pull/170
  
    Thanks @eribeiro for  the review, 
    Sorry, I saw you comment just now after committing this PR, missed you in the reviewers list.
, Thanks [~rakeshr] for the fix. 
Thanks [~eribeiro] for reviewing the fix.
Committed to branch-3.4: https://git-wip-us.apache.org/repos/asf?p=zookeeper.git;a=commit;h=e8247eec1103e387e02bbb1e8859b4d468688f48, Github user rakeshadr closed the pull request at:

    https://github.com/apache/zookeeper/pull/170
]