[    synchronized private SaslClient createSaslClient(final String servicePrincipal,
                                                     final String loginContext) throws LoginException {
        try {
            if (login == null) {
                if (LOG.isDebugEnabled()) {
                    LOG.debug("JAAS loginContext is: " + loginContext);
                }
                // note that the login object is static: it's shared amongst all zookeeper-related connections.
                // createSaslClient() must be declared synchronized so that login is initialized only once.
                login = new Login(loginContext, new ClientCallbackHandler(null));
                login.startThreadIfNeeded();
            }

this synchronize just for lock it's own object,it's can't prevent other ZooKeeperSaslClient instance access static variable login,because of the login object is static,if one ZooKeeperSaslClient instance had new Login but not call the login.startThreadIfNeeded(),at same time,the other ZooKeeperSaslClient instance also new Login object for static variable login,then  login.startThreadIfNeeded() will be execute twice for one login object., Can any one check this issue and  patchï¼ŒI would be very grateful, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12790077/ZOOKEEPER-2375_01.patch
  against trunk revision 1729259.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3051//console

This message is automatically generated., The scene:when we use spark to access hbase,it maybe cause this problem,Each task(thread) in executor process will create a zkClient to obtain meta info for access hbase,so it will match this problem, Thanks [~yuemeng] for the patch, its good catch.

[~rakeshr] and [~arshad.mohammad], can you review .., Thanks [~yuemeng] for the patch! +1.

[~rakeshr], [~arshad.mohammad]: mind giving it a look? I'll merge after I get a 2nd +1., I think the old patch will be better,because of the new i synchronize the ZooKeeperSaslClient class,it may be slow the jvm, Good catch [~yuemeng]. Patch looks good, just few comments. I'll be +1 after addressing these two.
# Since we made the logic using synchronized block we don't need another synchronization at {{synchronized private SaslClient createSaslClient}} method level. Could you please remove this.
# Also, it would be great if you could correct the java comment.
{code}
 // note that the login object is static: it's shared amongst all zookeeper-related connections.
 // createSaslClient() must be declared synchronized so that login is initialized only once.
{code}, How about using a "Double Checked Locking mechanism" to avoid obtaining the lock every time the code is executed ?
{code}
if (login == null) {
     synchronized (ZooKeeperSaslClient.class) {
          if (login == null) {
{code}, ok,thanks a lot ,i will do it , ok,thanks a lot ,i will do it , yes,it good advise,i got, Raul Gutierrez Segales,Rakesh R and  Arshad Mohammad can u review the new patch(ZOOKEEPER-2375_02.patch),  can you review the new patch(ZOOKEEPER-2375_02.patch), [~rgs],[~rakesh_r],[~arshad.mohammad],can you review the new patch(ZOOKEEPER-2375_02.patch),thanks all, Thanks [~yuemeng], +1 latest patch looks good., Good work [~yuemeng]
 +1 (non-binding) for patch ZOOKEEPER-2375_02.patch, hi,[~rgs],would you mind merge the latest patch to trunk ,thanks a lot, Thanks [~yuemeng] for reporting and fixing this issue. 
Thanks [~rgs], [~arshad.mohammad] for the reviews.

I have committed this patch to,
trunk: http://svn.apache.org/viewvc?view=revision&revision=1733223
branch-3.5: http://svn.apache.org/viewvc?view=revision&revision=1733222
branch-3.4: http://svn.apache.org/viewvc?view=revision&revision=1733221, Hi PMCs, could someone please assign this issue to [~yuemeng]. Thanks!, SUCCESS: Integrated in ZooKeeper-trunk #2834 (See [https://builds.apache.org/job/ZooKeeper-trunk/2834/])
ZOOKEEPER-2375: Prevent multiple initialization of login object in each ZooKeeperSaslClient instance (yuemeng via rakeshr) (rakeshr: [http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1733221])
* trunk/CHANGES.txt
* trunk/src/java/main/org/apache/zookeeper/client/ZooKeeperSaslClient.java
]