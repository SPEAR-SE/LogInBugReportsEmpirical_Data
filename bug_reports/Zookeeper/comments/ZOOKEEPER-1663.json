[Needs to be tested on other platforms..., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12573347/fix_spaces_in_paths.patch
  against trunk revision 1455387.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1429//console

This message is automatically generated., Amichai, seems the patch is not applying cleanly, can you create against trunk as well as (assuming) a branch? (probably branch-3.4). Thanks., The patch applies cleanly on the 3.4.5 branch., Added updated patch that applies against trunk as well., I tried this patch and it looks good to me, +1. What do you say, Pat?, Uploading the trunk patch again so that jenkins picks the right file., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12583766/ZOOKEEPER-1663.trunk.patch
  against trunk revision 1483440.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1486//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1486//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1486//console

This message is automatically generated., This looks good +1. I'll check it in., Committed to trunk but does not apply to 3.4.6. Can you submit a patch that applies to 3.4?, I submitted two patches, one with the .trunk.patch extension which applies against trunk, and one with only .patch extension which applies against 3.4.5 and also (I just tried it) the 3.4 branch.

btw I just found another bug, both in the original script and updated one (on both trunk and branch) - in zkEnv.sh line ~94, both

{noformat} if [ -e "${ZOOKEEPER_PREFIX}/share/zookeeper/zookeeper-*.jar" ]; then {noformat}

and

{noformat} if [ -e "${ZOOKEEPER_PREFIX}"/share/zookeeper/zookeeper-*.jar ]; then {noformat}

don't work correctly - the former doesn't expand the wildcard, and the latter expands to multiple arguments which causes test to fail.
The correct way to do this appears to be

{noformat} if ls "${ZOOKEEPER_PREFIX}"/share/zookeeper/zookeeper-*.jar > /dev/null 2>&1; then {noformat}
, Integrated in ZooKeeper-trunk #1932 (See [https://builds.apache.org/job/ZooKeeper-trunk/1932/])
    ZOOKEEPER-1663. scripts don't work when path contains spaces (Amichai Rothman via camille) (Revision 1484355)

     Result = FAILURE
camille : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1484355
Files : 
* /zookeeper/trunk/CHANGES.txt
* /zookeeper/trunk/bin/zkCleanup.sh
* /zookeeper/trunk/bin/zkCli.sh
* /zookeeper/trunk/bin/zkEnv.sh
* /zookeeper/trunk/bin/zkServer-initialize.sh
* /zookeeper/trunk/bin/zkServer.sh
, If you want to fix that issue you just discovered and submit a patch asap I will check it in on this ticket otherwise we'll have to make another ticket. , Attached the ls fix patch against trunk (in addition to the previous patch, not instead of it)., Great, commited all fixes to trunk and patch to 3.4. , -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12583852/ZOOKEEPER-1663-ls.trunk.patch
  against trunk revision 1484357.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1488//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1488//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1488//console

This message is automatically generated., Integrated in ZooKeeper-trunk #1934 (See [https://builds.apache.org/job/ZooKeeper-trunk/1934/])
    ZOOKEEPER-1663. scripts don't work when path contains spaces (Amichai Rothman via camille) (Revision 1484527)

     Result = FAILURE
camille : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1484527
Files : 
* /zookeeper/trunk/bin/zkEnv.sh
, This fix is incorrect. It assumes the shell is bash since it uses bash array construction, e.g.:

{code}
96 LIBPATH=("${ZOOKEEPER_PREFIX}"/share/zookeeper/*.jar)
{code}

This does NOT work if /bin/sh points to /bin/dash as it does on Ubuntu.

It fails as so:

{quote}
zkEnv.sh: 96: zkEnv.sh: Syntax error: "(" unexpected (expecting "fi")
{quote}

If I change the shebang at the top to use "/bin/bash" instead of "/bin/sh" it works as expected. I don't know the full details of why using a bash array was chosen as the solution but I don't think it is the right way to deal with spaces in these paths...

I opened a separate jira (ZOOKEEPER-1719)., The array was used in order for that glob expression to expand properly into multiple paths where each can contain a space (e.g. if ZOOKEEPER_PREFIX contains a space), so they can be passed on as such - as opposed to a single string with spaces in it (losing the individual paths) or multiple strings with no space in them (cutting the individual paths in the middle where they contain spaces), which is what the simpler syntax achieves. Both alternatives would fail when passed as arguments to a command later on. An array is the only way I found to do this, but if there is a better way, by all means use it., OK, that makes sense.

I think the best option here is to change the shebang at the top to explicitly use bash like we are in zkServer.sh, as in:

{code}
#!/usr/bin/env bash
{code}, Integrated in ZooKeeper-trunk #1975 (See [https://builds.apache.org/job/ZooKeeper-trunk/1975/])
    ZOOKEEPER-1719. zkCli.sh, zkServer.sh and zkEnv.sh regression caused by ZOOKEEPER-1663
  (Marshall McMullen via camille) (Revision 1497830)

     Result = FAILURE
camille : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1497830
Files : 
* /zookeeper/trunk/CHANGES.txt
* /zookeeper/trunk/bin/zkCleanup.sh
* /zookeeper/trunk/bin/zkCli.sh
* /zookeeper/trunk/bin/zkEnv.sh
, Closing issues after releasing 3.4.6., SUCCESS: Integrated in ZooKeeper-trunk #2347 (See [https://builds.apache.org/job/ZooKeeper-trunk/2347/])
ZOOKEEPER-1945. deb - zkCli.sh, zkServer.sh and zkEnv.sh regression caused by ZOOKEEPER-1663 (Mark Flickinger via fpj) (fpj: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1605391)
* /zookeeper/trunk/CHANGES.txt
* /zookeeper/trunk/src/packages/deb/init.d/zookeeper
]