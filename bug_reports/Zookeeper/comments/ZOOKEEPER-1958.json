[A second submission, without the extraneous #define bars]