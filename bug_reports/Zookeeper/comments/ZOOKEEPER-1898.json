[Thank you for reporting this Srinath. Would you be up for fixing this?, One approach to resolve this is to change [here|https://github.com/apache/zookeeper/blob/e78a7036db46fb4d507bff40384f0dcd31457323/src/java/main/org/apache/zookeeper/ZooKeeperMain.java#L359] in ZooKeeperMain.java to
{code}
…
             if (!processCmd(cl))
                System.exit(1);
…
(code}
But looking at the {{cli}} classes the {{exec()}} methods all return {{false}} and in some cases return the boolean value for whether the option for watcher was made in the request. For e.g [CloseCommand.exec()|https://github.com/apache/zookeeper/blob/e78a7036db46fb4d507bff40384f0dcd31457323/src/java/main/org/apache/zookeeper/cli/CloseCommand.java#L43] returns {{false}} while [LsCommand.java|https://github.com/apache/zookeeper/blob/e78a7036db46fb4d507bff40384f0dcd31457323/src/java/main/org/apache/zookeeper/cli/LsCommand.java#L83] returns whether option "w" was passed in the request if the {{ls}} command is successful. If the return values from these cli command classes reflect whether the actual execution result of the commands executed the proposed change will work. It would be good to understand why these cli classes are returning {{false}}. [~phunt] any pointers you can provide here will be helpful. , -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12810889/ZOOKEEPER-1898.patch
  against trunk revision 1748608.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3187//console

This message is automatically generated., Hi Abe, please see the how to contribute guide
https://cwiki.apache.org/confluence/display/ZOOKEEPER/HowToContribute
in particular the section on git based patches (you need to add "--no-prefix" in order for qa bot to correctly apply the patch). Thanks!, +1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12810902/ZOOKEEPER-1898.patch
  against trunk revision 1748608.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3188//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3188//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3188//console

This message is automatically generated., [~abrahamfine] one thing I noticed off the bat is that you modified KeeperException - that's not a great idea because KeeperException is really part of the interface that the server publishes to the client. It's a public interface of the service. Whereas the cli is more like a utility (I realize we do a terrible job of making this clear from the code structure, but it is what it is - debt from the early days). I'd recommend adding your own exception(s) rather than extending KeeperException., [~phunt] reuploaded the patch with a new exception class., +1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12811439/ZOOKEEPER-1898.patch
  against trunk revision 1748630.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3190//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3190//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3190//console

This message is automatically generated., +1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12812952/ZOOKEEPER-1898.patch
  against trunk revision 1750025.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 3 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3249//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3249//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3249//console

This message is automatically generated., +1 - my review is upstream on https://reviews.apache.org/r/49112/, Committed to 3.5.3 and trunk. Thanks Abe!, FAILURE: Integrated in ZooKeeper-trunk #3009 (See [https://builds.apache.org/job/ZooKeeper-trunk/3009/])
ZOOKEEPER-1898: ZooKeeper Java cli shell always returns 0 as exit code (Abraham Fine via phunt) (phunt: [http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1754188])
* trunk/CHANGES.txt
* trunk/src/java/main/org/apache/zookeeper/ZooKeeperMain.java
* trunk/src/java/main/org/apache/zookeeper/cli/AddAuthCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/CliCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/CliException.java
* trunk/src/java/main/org/apache/zookeeper/cli/CliParseException.java
* trunk/src/java/main/org/apache/zookeeper/cli/CliWrapperException.java
* trunk/src/java/main/org/apache/zookeeper/cli/CloseCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/CommandNotFoundException.java
* trunk/src/java/main/org/apache/zookeeper/cli/CreateCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/DelQuotaCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/DeleteAllCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/DeleteCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/GetAclCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/GetCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/GetConfigCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/ListQuotaCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/Ls2Command.java
* trunk/src/java/main/org/apache/zookeeper/cli/LsCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/MalformedCommandException.java
* trunk/src/java/main/org/apache/zookeeper/cli/ReconfigCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/RemoveWatchesCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/SetAclCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/SetCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/SetQuotaCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/StatCommand.java
* trunk/src/java/main/org/apache/zookeeper/cli/SyncCommand.java
* trunk/src/java/test/org/apache/zookeeper/ZooKeeperTest.java
]