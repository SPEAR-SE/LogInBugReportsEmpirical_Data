[Attached: jstack result while server is blocked., Attached: patch file generated using Git according to instructions here: https://cwiki.apache.org/confluence/display/ZOOKEEPER/HowToContribute, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12674807/ZOOKEEPER-2060.patch
  against trunk revision 1631280.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2389//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2389//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2389//console

This message is automatically generated., After having a second look, it doesn't look like there is a deadlock. Constructing the debug string is taking longer and longer because the size of the queuedBuffer is growing when throttled. Also, if we turn debug on, then we should see the problem again, and I was thinking that we should make this message trace level rather than debug. 

These days we use string formatting like in:

{noformat}
LOG.warn("Unable to truncate {}", itr.logFile);
{noformat}

to avoid the unnecessary string construction. In this case, by checking if debug/trace is enabled, we avoid the call to hexDump compared to doing the string formatting, so I think it is a plus to do it this way.  
, It seems this statement is indeed the odd one out regarding debug vs. trace, so let's switch it to trace like the rest., Switch this statement to trace logging, Switch the log statement to trace logging, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12674864/ZOOKEEPER-2060.patch
  against trunk revision 1631280.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2390//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2390//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2390//console

This message is automatically generated., I haven't checked if it applies to all branches. Otw, lgtm, +1., +1, thanks Ian.

3.4: Committed revision 1640637.
3.5: Committed revision 1640636.
Trunk: Committed revision 1640635., SUCCESS: Integrated in ZooKeeper-trunk #2507 (See [https://builds.apache.org/job/ZooKeeper-trunk/2507/])
ZOOKEEPER-2060 Trace bug in NettyServerCnxnFactory (Ian via fpj) (fpj: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1640635)
* /zookeeper/trunk/CHANGES.txt
* /zookeeper/trunk/src/java/main/org/apache/zookeeper/server/NettyServerCnxnFactory.java
, Commit to correct CHANGES.txt in trunk. Committed revision 1642444., SUCCESS: Integrated in ZooKeeper-trunk #2517 (See [https://builds.apache.org/job/ZooKeeper-trunk/2517/])
ZOOKEEPER-2060 Trace bug in NettyServerCnxnFactory (Ian via fpj)
This commit is just to correct CHANGES.txt,the entry was in the
wrong section. (fpj: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1642444)
* /zookeeper/trunk/CHANGES.txt
]