[GitHub user sugartxy opened a pull request:

    https://github.com/apache/zookeeper/pull/36

    #ZOOKEEPER-2218 Close IO Streams in finally block

    Place the close method in the finally clause, so we can ensure it always runs regardless of how the method exits.

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/sugartxy/zookeeper CloseRightly

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/zookeeper/pull/36.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #36
    
----
commit 90745d7476504630c1d68772c26546b28639ba91
Author: sugartxy <tgttxy@163.com>
Date:   2015-06-23T02:36:11Z

    #ZOOKEEPER-2218 Close IO Streams in finally block
    
    Place the close method in the finally clause, so we can ensure it always
    runs regardless of how the method exits.

----
, Issue resolved by pull request https://github.com/apache/zookeeper/pull/36, Thanks for the patch [~tgttxy]! Lets reopen the issue though, since it hasn't been merged yet. , oops! still learning, sorry for the mistake!, could you please upload the patch here as well and hit the `submit patch` button? if you are creating the patch with git you can use:

{code}
git diff --no-prefix HEAD~1.. > ZOOKEEPER-2218.patch
{code}

thanks!

(i'll comment in the github pull request as well, but we need the patch uploaded here & tests to pass in order to be able to merge it). , Thanks a lot. 
It's finished according to your advice. Please check it., Thanks a lot. 
It's finished according to your advice. Please check it., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12742468/ZOOKEEPER-2218.patch
  against trunk revision 1688041.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 120 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    -1 javac.  The patch appears to cause tar ant target to fail.

    -1 findbugs.  The patch appears to cause Findbugs (version 2.0.3) to fail.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2785//testReport/
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2785//console

This message is automatically generated., The patch fails compilation, see: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2785//console. Is this working locally for you when you run ant test-core-java and such?, i.e.: there are errors like:

{code}
   [exec]     [javac]   location: class JRecord
     [exec]     [javac] /home/jenkins/jenkins-slave/workspace/PreCommit-ZOOKEEPER-Build/trunk/src/java/main/org/apache/jute/compiler/JRecord.java:749: error: cannot find symbol
     [exec]     [javac]             cs.close();
{code}

Please test locally before submitting the patch. , -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12742708/ZOOKEEPER-2218.patch
  against trunk revision 1688041.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 120 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    -1 javac.  The patch appears to cause tar ant target to fail.

    -1 findbugs.  The patch appears to cause Findbugs (version 2.0.3) to fail.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2787//testReport/
Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2787//console

This message is automatically generated., Thank you for the patch Tang! I have 2 comments:

- Please replace tabs with spaces.
- It's probably cleaner to use try-with-resources: https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12742733/ZOOKEEPER-2218.patch
  against trunk revision 1688041.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2791//console

This message is automatically generated., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12742746/ZOOKEEPER-2218.patch
  against trunk revision 1688041.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2792//console

This message is automatically generated., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12742751/ZOOKEEPER-2218.patch
  against trunk revision 1688041.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2793//console

This message is automatically generated., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12742761/ZOOKEEPER-2218.patch
  against trunk revision 1688041.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2794//console

This message is automatically generated., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12742761/ZOOKEEPER-2218.patch
  against trunk revision 1748630.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3226//console

This message is automatically generated., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12742761/ZOOKEEPER-2218.patch
  against trunk revision 1759735.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/3399//console

This message is automatically generated., [~tgttxy] - the patch cannot be applied (see the link to the console output in the comment for qabot)

     [exec] patch unexpectedly ends in middle of line
     [exec] PATCH APPLICATION FAILED

can  you address this and resubmit? I'm canceling the patch for now, so be sure to re-submit when you update. Thanks.]