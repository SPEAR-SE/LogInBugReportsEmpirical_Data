{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935"
            },
            "displayName": "Andor Molnar",
            "key": "andorm",
            "name": "andorm",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=andorm",
            "timeZone": "Europe/Budapest"
        },
        "components": [{
            "description": "Data marshalling code generator for ZooKeeper",
            "id": "12312385",
            "name": "jute",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12312385"
        }],
        "created": "2015-01-04T10:13:32.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Liu Shaohui",
            "key": "liushaohui",
            "name": "liushaohui",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=liushaohui",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310191": null,
        "customfield_12310192": null,
        "customfield_12310220": "2015-01-05T05:29:59.789+0000",
        "customfield_12310222": "1_*:*_2_*:*_13468824398_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_88235822300",
        "customfield_12310230": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "9.0",
        "customfield_12310420": "9223372036854775807",
        "customfield_12310920": "9223372036854775807",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i23xkn:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Mon Mar 26 13:30:45 UTC 2018",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "*Problem*\nFor multi operation, PrepRequestProcessor may produce a large transaction whose size may be larger than the max buffer size of jute. There is check of buffer size in readBuffer method  of BinaryInputArchive, but no check in writeBuffer method  of BinaryOutputArchive, which will cause that \n\n1, Leader can sync transaction to txn log and send the large transaction to the followers, but the followers failed to read the transaction and can't sync with leader.\n{code}\n2015-01-04,12:42:26,474 WARN org.apache.zookeeper.server.quorum.Learner: [myid:2] Exception when following the leader\njava.io.IOException: Unreasonable length = 2054758\n        at org.apache.jute.BinaryInputArchive.readBuffer(BinaryInputArchive.java:100)\n        at org.apache.zookeeper.server.quorum.QuorumPacket.deserialize(QuorumPacket.java:85)\n        at org.apache.jute.BinaryInputArchive.readRecord(BinaryInputArchive.java:108)\n        at org.apache.zookeeper.server.quorum.Learner.readPacket(Learner.java:152)\n        at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:85)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:740)\n2015-01-04,12:42:26,475 INFO org.apache.zookeeper.server.quorum.Learner: [myid:2] shutdown called\njava.lang.Exception: shutdown Follower\n        at org.apache.zookeeper.server.quorum.Follower.shutdown(Follower.java:166)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:744)\n{code}\n\n2, The leader lose all followers, which trigger the leader election. The old leader will become leader again for it has up-to-date data.\n{code}\n2015-01-04,12:42:28,502 INFO org.apache.zookeeper.server.quorum.Leader: [myid:3] Shutting down\n2015-01-04,12:42:28,502 INFO org.apache.zookeeper.server.quorum.Leader: [myid:3] Shutdown called\njava.lang.Exception: shutdown Leader! reason: Only 1 followers, need 2\n        at org.apache.zookeeper.server.quorum.Leader.shutdown(Leader.java:496)\n        at org.apache.zookeeper.server.quorum.Leader.lead(Leader.java:471)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:753)\n{code}\n3, The leader can not load the transaction from the txn log for the length of data is larger than the max buffer of jute.\n{code}\n\n2015-01-04,12:42:31,282 ERROR org.apache.zookeeper.server.quorum.QuorumPeer: [myid:3] Unable to load database on disk\njava.io.IOException: Unreasonable length = 2054758\n        at org.apache.jute.BinaryInputArchive.readBuffer(BinaryInputArchive.java:100)\n        at org.apache.zookeeper.server.persistence.Util.readTxnBytes(Util.java:233)\n        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.next(FileTxnLog.java:602)\n        at org.apache.zookeeper.server.persistence.FileTxnSnapLog.restore(FileTxnSnapLog.java:157)\n        at org.apache.zookeeper.server.ZKDatabase.loadDataBase(ZKDatabase.java:223)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.loadDataBase(QuorumPeer.java:417)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.getLastLoggedZxid(QuorumPeer.java:546)\n        at org.apache.zookeeper.server.quorum.FastLeaderElection.getInitLastLoggedZxid(FastLeaderElection.java:690)\n        at org.apache.zookeeper.server.quorum.FastLeaderElection.lookForLeader(FastLeaderElection.java:737)\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:716)\n{code}\n\nThe zookeeper service will be unavailable until we enlarge the jute.maxbuffer and restart zookeeper hbase cluster.\n\n*Solution*\nAdd buffer size check in BinaryOutputArchive to avoid large transaction be written to log and sent to followers.\n\nBut I am not sure if there are side-effects of throwing an IOException in BinaryOutputArchive  and RequestProcessors\n",
        "duedate": null,
        "environment": null,
        "fixVersions": [
            {
                "archived": false,
                "description": "Beta release against 3.5 branch",
                "id": "12340141",
                "name": "3.5.4",
                "releaseDate": "2018-05-17",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12340141"
            },
            {
                "archived": false,
                "id": "12326518",
                "name": "3.6.0",
                "released": false,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12326518"
            }
        ],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011"
            },
            "id": "12310801",
            "key": "ZOOKEEPER",
            "name": "ZooKeeper",
            "projectCategory": {
                "description": "Apache ZooKeeper related",
                "id": "10484",
                "name": "ZooKeeper",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10484"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12310801"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Liu Shaohui",
            "key": "liushaohui",
            "name": "liushaohui",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=liushaohui",
            "timeZone": "Etc/UTC"
        },
        "resolution": {
            "description": "All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.",
            "id": "5",
            "name": "Cannot Reproduce",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/5"
        },
        "resolutiondate": "2018-03-26T13:30:59.000+0000",
        "status": {
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "id": "5",
            "name": "Resolved",
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "Transaction larger than max buffer of jute makes zookeeper unavailable",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2018-03-26T13:30:59.000+0000",
        "versions": [{
            "archived": false,
            "description": "Fix release against 3.4 branch.",
            "id": "12319841",
            "name": "3.4.4",
            "releaseDate": "2012-09-23",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12319841"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2101/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-2101/watchers",
            "watchCount": 13
        },
        "workratio": -1
    },
    "id": "12764775",
    "key": "ZOOKEEPER-2101",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12764775"
}