{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "yynil",
            "key": "yynil",
            "name": "yynil",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yynil",
            "timeZone": "Etc/UTC"
        },
        "components": [{
            "description": "recipes implementations that reside in src/recipes. also could be used for recipe docs",
            "id": "12313246",
            "name": "recipes",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12313246"
        }],
        "created": "2011-07-19T16:49:56.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "yynil",
            "key": "yynil",
            "name": "yynil",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yynil",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310191": null,
        "customfield_12310192": null,
        "customfield_12310220": "2011-07-22T08:35:43.929+0000",
        "customfield_12310222": "1_*:*_1_*:*_721866509_*|*_5_*:*_1_*:*_0",
        "customfield_12310230": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "1.0",
        "customfield_12310420": "3988",
        "customfield_12310920": "32704",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i05ylj:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Thu Jul 28 06:53:07 UTC 2011",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "http://zookeeper.apache.org/doc/trunk/recipes.html\nThe current recipe for Lock has the wrong process.\nSpecifically, for the \n\"4. The client calls exists( ) with the watch flag set on the path in the lock directory with the next lowest sequence number.\"\nIt shouldn't be the \"the next lowest sequence number\". It should be the \"current lowest path\". \n\nIf you're gonna use \"the next lowest sequence number\", you'll never wait for the lock possession.\n\nThe following is the test code:\n\n{code:title=LockTest.java|borderStyle=solid}\n        ACL acl = new ACL(Perms.ALL, new Id(\"10.0.0.0/8\", \"1\"));\n        List<ACL> acls = new ArrayList<ACL>();\n        acls.add(acl);\n        String connectStr = \"localhost:2181\";\n        final Semaphore sem = new Semaphore(0);\n        ZooKeeper zooKeeper = new ZooKeeper(connectStr, 1000 * 30, new Watcher() {\n\n            @Override\n            public void process(WatchedEvent event) {\n                System.out.println(\"eventType:\" + event.getType());\n                System.out.println(\"keeperState:\" + event.getState());\n                if (event.getType() == Event.EventType.None) {\n                    if (event.getState() == Event.KeeperState.SyncConnected) {\n                        sem.release();\n                    }\n                }\n            }\n        });\n        System.out.println(\"state:\" + zooKeeper.getState());\n        System.out.println(\"Waiting for the state to be connected\");\n        try {\n            sem.acquire();\n        } catch (InterruptedException ex) {\n            ex.printStackTrace();\n        }\n        System.out.println(\"Now state:\" + zooKeeper.getState());\n\n        String directory = \"/_locknode_\";\n        Stat stat = zooKeeper.exists(directory, false);\n        if (stat == null) {\n            zooKeeper.create(directory, new byte[]{}, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n        }\n        String prefix = directory + \"/lock-\";\n        String path = zooKeeper.create(prefix, new byte[]{}, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);\n        System.out.println(\"Create the path for \" + path);\n        while (true) {\n            List<String> children = zooKeeper.getChildren(directory, false);\n            Collections.sort(children);\n            System.out.println(\"The whole lock size is \" + children.size());\n            String lowestPath = children.get(0);\n            DecimalFormat df = new DecimalFormat(\"0000000000\");\n            String currentSuffix = lowestPath.substring(\"lock-\".length());\n            System.out.println(\"CurrentSuffix is \" + currentSuffix);\n            int intIndex = Integer.parseInt(currentSuffix);\n\n            if (path.equals(directory + \"/\" + lowestPath)) {\n                //I've got the lock and release it\n                System.out.println(\"I've got the lock at \" + new Date());\n                System.out.println(\"next index is \" + intIndex);\n                Thread.sleep(10000);\n                System.out.println(\"After sleep 3 seconds, I'm gonna release the lock\");\n                zooKeeper.delete(path, -1);\n                break;\n            }\n            final Semaphore wakeupSem = new Semaphore(0);\n            stat = zooKeeper.exists(directory + \"/\" + lowestPath, new Watcher() {\n\n                @Override\n                public void process(WatchedEvent event) {\n                    System.out.println(\"Event is \" + event.getType());\n                    System.out.println(\"State is \" + event.getState());\n                    if (event.getType() == Event.EventType.NodeDeleted) {\n                        wakeupSem.release();\n                    }\n                }\n            });\n            if (stat != null) {\n                System.out.println(\"Waiting for the delete of \");\n                wakeupSem.acquire();\n            } else {\n                System.out.println(\"Continue to seek\");\n            }\n        }\n{code} ",
        "duedate": null,
        "environment": null,
        "fixVersions": [],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011"
            },
            "id": "12310801",
            "key": "ZOOKEEPER",
            "name": "ZooKeeper",
            "projectCategory": {
                "description": "Apache ZooKeeper related",
                "id": "10484",
                "name": "ZooKeeper",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10484"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12310801"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "yynil",
            "key": "yynil",
            "name": "yynil",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yynil",
            "timeZone": "Etc/UTC"
        },
        "resolution": {
            "description": "A fix for this issue is checked into the tree and tested.",
            "id": "1",
            "name": "Fixed",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1"
        },
        "resolutiondate": "2011-07-28T01:21:03.000+0000",
        "status": {
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "id": "5",
            "name": "Resolved",
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "Recipe wrong for Lock process.",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2016-03-03T01:35:29.000+0000",
        "versions": [{
            "archived": false,
            "description": "Fix release against 3.3 branch",
            "id": "12315482",
            "name": "3.3.3",
            "releaseDate": "2011-02-27",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12315482"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1128/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-1128/watchers",
            "watchCount": 1
        },
        "workratio": -1
    },
    "id": "12514611",
    "key": "ZOOKEEPER-1128",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12514611"
}