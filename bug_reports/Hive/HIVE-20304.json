{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bigrey&avatarId=37646",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bigrey&avatarId=37646",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bigrey&avatarId=37646",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bigrey&avatarId=37646"
            },
            "displayName": "Hui Huang",
            "key": "bigrey",
            "name": "BIGrey",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=BIGrey",
            "timeZone": "Etc/UTC"
        },
        "components": [{
            "description": "Command-line interpreter for Hive.\n",
            "id": "12313604",
            "name": "CLI",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12313604"
        }],
        "created": "2018-08-03T09:21:02.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bigrey&avatarId=37646",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bigrey&avatarId=37646",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bigrey&avatarId=37646",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bigrey&avatarId=37646"
            },
            "displayName": "Hui Huang",
            "key": "bigrey",
            "name": "BIGrey",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=BIGrey",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310191": null,
        "customfield_12310192": null,
        "customfield_12310220": "2018-08-03T13:22:46.914+0000",
        "customfield_12310222": "1_*:*_2_*:*_1496316_*|*_3_*:*_1_*:*_213710_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_3_*:*_9091958866",
        "customfield_12310230": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "3.0",
        "customfield_12310320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12310920": "9223372036854775807",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i3wnmn:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Nov 06 20:46:22 UTC 2018",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "`When hive.optimize.skewjoin and hive.auto.convert.join are both set to true, and the execution engine is set to mr, same stage of a query may launch twice due to the wrong generated plan. If hive.exec.parallel is also true, the same stage will launch at the same time and the job will failed due to the first completed stage clear the map.xml/reduce.xml file stored in the hdfs.\r\n\r\nuse following sql to reproduce the issue:\r\n{code:java}\r\nCREATE TABLE `tbl1`(\r\n  `fence` string);\r\n\r\nCREATE TABLE `tbl2`(\r\n  `order_id` string,\r\n  `phone` string,\r\n  `search_id` string\r\n)\r\nPARTITIONED BY (\r\n  `dt` string);\r\n\r\n\r\nCREATE TABLE `tbl3`(\r\n  `order_id` string,\r\n  `platform` string)\r\nPARTITIONED BY (\r\n  `dt` string);\r\n\r\n\r\nCREATE TABLE `tbl4`(\r\n  `groupname` string,\r\n  `phone` string)\r\nPARTITIONED BY (\r\n  `dt` string);\r\n\r\n\r\nCREATE TABLE `tbl5`(\r\n  `search_id` string,\r\n  `fence` string)\r\nPARTITIONED BY (\r\n  `dt` string);\r\n\r\nSET hive.exec.parallel = TRUE;\r\n\r\nSET hive.auto.convert.join = TRUE;\r\n\r\nSET hive.optimize.skewjoin = TRUE;\r\n\r\n\r\nSELECT dt,\r\n               platform,\r\n               groupname,\r\n               count(1) as cnt\r\n        FROM\r\n        (SELECT dt,\r\n                platform,\r\n                groupname\r\n         FROM\r\n         (SELECT fence\r\n          FROM tbl1)ta\r\n           JOIN\r\n           (SELECT a0.dt,\r\n                   a1.platform,\r\n                   a2.groupname,\r\n                   a3.fence\r\n            FROM\r\n            (SELECT dt,\r\n                    order_id,\r\n                    phone,\r\n                    search_id\r\n             FROM tbl2\r\n             WHERE dt =20180703 )a0\r\n              JOIN\r\n              (SELECT order_id,\r\n                      platform,\r\n                      dt\r\n               FROM tbl3\r\n               WHERE dt =20180703 )a1 ON a0.order_id = a1.order_id\r\n              INNER JOIN\r\n              (SELECT groupname,\r\n                      phone,\r\n                      dt\r\n               FROM tbl4\r\n               WHERE dt =20180703 )a2 ON a0.phone = a2.phone\r\n              LEFT JOIN\r\n              (SELECT search_id,\r\n                      fence,\r\n                      dt\r\n               FROM tbl5\r\n               WHERE dt =20180703)a3 ON a0.search_id = a3.search_id)t0 ON ta.fence = t0.fence)t11\r\n        GROUP BY dt,\r\n                 platform,\r\n                 groupname;\r\n\r\nDROP TABLE tbl1;\r\nDROP TABLE tbl2;\r\nDROP TABLE tbl3;\r\nDROP TABLE tbl4;\r\nDROP TABLE tbl5;\r\n\r\n{code}\r\nWe will get some error message like this:\r\n\r\nExamining task ID: task_1531284442065_3637_m_000000 (and more) from job job_1531284442065_3637\r\n\r\nTask with the most failures(4):\r\n----\r\nTask ID:\r\n task_1531284442065_3637_m_000000\r\n\r\nURL:\r\n [http://0.0.0.0:8088/taskdetails.jsp?jobid=job_1531284442065_3637&tipid=task_1531284442065_3637_m_000000]\r\n----\r\nDiagnostic Messages for this Task:\r\n File does not exist: hdfs://test/tmp/hive-hadoop/hadoop/fe5efa94-abb1-420f-b6ba-ec782e7b79ad/hive_2018-08-03_17-00-17_707_592882314975289971-5/-mr-10045/757eb1f7-7a37-4a7e-abc0-4a3b8b06510c/reduce.xml\r\n java.io.FileNotFoundException: File does not exist: hdfs://test/tmp/hive-hadoop/hadoop/fe5efa94-abb1-420f-b6ba-ec782e7b79ad/hive_2018-08-03_17-00-17_707_592882314975289971-5/-mr-10045/757eb1f7-7a37-4a7e-abc0-4a3b8b06510c/reduce.xml\r\n\r\nLooking into the plan by executing explain, I found that the Stage-4 and Stage-5 can reached from multi root tasks.\r\n{code:java}\r\nExplain\r\nSTAGE DEPENDENCIES:\r\n  Stage-21 is a root stage , consists of Stage-34, Stage-5\r\n  Stage-34 has a backup stage: Stage-5\r\n  Stage-20 depends on stages: Stage-34\r\n  Stage-17 depends on stages: Stage-5, Stage-18, Stage-20 , consists of Stage-32, Stage-33, Stage-1\r\n  Stage-32 has a backup stage: Stage-1\r\n  Stage-15 depends on stages: Stage-32\r\n  Stage-10 depends on stages: Stage-1, Stage-15, Stage-16 , consists of Stage-31, Stage-2\r\n  Stage-31\r\n  Stage-9 depends on stages: Stage-31\r\n  Stage-2 depends on stages: Stage-9\r\n  Stage-33 has a backup stage: Stage-1\r\n  Stage-16 depends on stages: Stage-33\r\n  Stage-1\r\n  Stage-5\r\n  Stage-27 is a root stage , consists of Stage-37, Stage-38, Stage-4\r\n  Stage-37 has a backup stage: Stage-4\r\n  Stage-25 depends on stages: Stage-37\r\n  Stage-12 depends on stages: Stage-4, Stage-22, Stage-23, Stage-25, Stage-26 , consists of Stage-36, Stage-5\r\n  Stage-36\r\n  Stage-11 depends on stages: Stage-36\r\n  Stage-19 depends on stages: Stage-11 , consists of Stage-35, Stage-5\r\n  Stage-35 has a backup stage: Stage-5\r\n  Stage-18 depends on stages: Stage-35\r\n  Stage-38 has a backup stage: Stage-4\r\n  Stage-26 depends on stages: Stage-38\r\n  Stage-4\r\n  Stage-30 is a root stage , consists of Stage-42, Stage-43, Stage-3\r\n  Stage-42 has a backup stage: Stage-3\r\n  Stage-28 depends on stages: Stage-42\r\n  Stage-14 depends on stages: Stage-3, Stage-28, Stage-29 , consists of Stage-41, Stage-4\r\n  Stage-41\r\n  Stage-13 depends on stages: Stage-41\r\n  Stage-24 depends on stages: Stage-13 , consists of Stage-39, Stage-40, Stage-4\r\n  Stage-39 has a backup stage: Stage-4\r\n  Stage-22 depends on stages: Stage-39\r\n  Stage-40 has a backup stage: Stage-4\r\n  Stage-23 depends on stages: Stage-40\r\n  Stage-43 has a backup stage: Stage-3\r\n  Stage-29 depends on stages: Stage-43\r\n  Stage-3\r\n  Stage-0 depends on stages: Stage-2\r\n{code}\r\nAfter skewjoin optimization, the processed node is added into the listTasks of ConditionalTask and the parentTask of the processed node is removed and during the commonJoin optimization of listTasks of ConditionalTask, the new generated condTask will be added into root task list due to parentTask is null.\r\n\r\nworkaround: do not set hive.optimize.skewjoin and hive.auto.convert.join to true at the same time.",
        "duedate": null,
        "environment": null,
        "fixVersions": [
            {
                "archived": false,
                "id": "12332384",
                "name": "1.2.1",
                "releaseDate": "2015-06-26",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12332384"
            },
            {
                "archived": false,
                "id": "12343343",
                "name": "4.0.0",
                "released": false,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12343343"
            }
        ],
        "issuelinks": [{
            "id": "12548325",
            "outwardIssue": {
                "fields": {
                    "issuetype": {
                        "avatarId": 21133,
                        "description": "A problem which impairs or prevents the functions of the product.",
                        "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                        "id": "1",
                        "name": "Bug",
                        "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                        "subtask": false
                    },
                    "priority": {
                        "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                        "id": "3",
                        "name": "Major",
                        "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
                    },
                    "status": {
                        "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                        "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                        "id": "5",
                        "name": "Resolved",
                        "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                        "statusCategory": {
                            "colorName": "green",
                            "id": 3,
                            "key": "done",
                            "name": "Done",
                            "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
                        }
                    },
                    "summary": "Nullpointer When both SkewJoin  and Mapjoin Enabled"
                },
                "id": "12997908",
                "key": "HIVE-14557",
                "self": "https://issues.apache.org/jira/rest/api/2/issue/12997908"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12548325",
            "type": {
                "id": "12310000",
                "inward": "is duplicated by",
                "name": "Duplicate",
                "outward": "duplicates",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"
            }
        }],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935"
            },
            "id": "12310843",
            "key": "HIVE",
            "name": "Hive",
            "projectCategory": {
                "description": "Scalable Distributed Computing",
                "id": "10292",
                "name": "Hadoop",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10292"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12310843"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bigrey&avatarId=37646",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bigrey&avatarId=37646",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bigrey&avatarId=37646",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bigrey&avatarId=37646"
            },
            "displayName": "Hui Huang",
            "key": "bigrey",
            "name": "BIGrey",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=BIGrey",
            "timeZone": "Etc/UTC"
        },
        "resolution": {
            "description": "The problem is a duplicate of an existing issue.",
            "id": "3",
            "name": "Duplicate",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/3"
        },
        "resolutiondate": "2018-11-16T15:22:11.000+0000",
        "status": {
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "id": "5",
            "name": "Resolved",
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "When hive.optimize.skewjoin and hive.auto.convert.join are both set to true, and the execution engine is mr, same stage may launch twice due to the wrong generated plan",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2018-11-16T15:22:11.000+0000",
        "versions": [
            {
                "archived": false,
                "id": "12332384",
                "name": "1.2.1",
                "releaseDate": "2015-06-26",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12332384"
            },
            {
                "archived": false,
                "id": "12342162",
                "name": "2.3.3",
                "releaseDate": "2018-04-03",
                "released": false,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12342162"
            }
        ],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-20304/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-20304/watchers",
            "watchCount": 4
        },
        "workratio": -1
    },
    "id": "13176667",
    "key": "HIVE-20304",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13176667"
}