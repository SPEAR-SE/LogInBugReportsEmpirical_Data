{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sushanth&avatarId=26812",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sushanth&avatarId=26812",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sushanth&avatarId=26812",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=sushanth&avatarId=26812"
            },
            "displayName": "Sushanth Sowmyan",
            "key": "sushanth",
            "name": "sushanth",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=sushanth",
            "timeZone": "America/Los_Angeles"
        },
        "components": [{
            "description": "Tracks issues related to the HCatalog",
            "id": "12320409",
            "name": "HCatalog",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12320409"
        }],
        "created": "2013-08-07T20:46:47.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sushanth&avatarId=26812",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sushanth&avatarId=26812",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sushanth&avatarId=26812",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=sushanth&avatarId=26812"
            },
            "displayName": "Sushanth Sowmyan",
            "key": "sushanth",
            "name": "sushanth",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=sushanth",
            "timeZone": "America/Los_Angeles"
        },
        "customfield_10010": null,
        "customfield_12310191": null,
        "customfield_12310192": null,
        "customfield_12310220": "2013-08-07T20:52:46.127+0000",
        "customfield_12310222": null,
        "customfield_12310230": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "0.0",
        "customfield_12310320": null,
        "customfield_12310420": "342493",
        "customfield_12310920": "342798",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i1n2dz:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Jul 02 23:32:06 UTC 2014",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "Currently, if someone has a null key in a map, HCatInputFormat will terminate with an NPE while trying to read it.\n\n{noformat}\njava.lang.NullPointerException\nat java.lang.String.compareTo(String.java:1167)\nat java.lang.String.compareTo(String.java:92)\nat java.util.TreeMap.put(TreeMap.java:545)\nat org.apache.hcatalog.data.HCatRecordSerDe.serializeMap(HCatRecordSerDe.java:222)\nat org.apache.hcatalog.data.HCatRecordSerDe.serializeField(HCatRecordSerDe.java:198)\nat org.apache.hcatalog.data.LazyHCatRecord.get(LazyHCatRecord.java:53)\nat org.apache.hcatalog.data.LazyHCatRecord.get(LazyHCatRecord.java:97)\nat org.apache.hcatalog.mapreduce.HCatRecordReader.nextKeyValue(HCatRecordReader.java:203)\n{noformat}\n\nThis is because we use a TreeMap to preserve order of elements in the map when reading from the underlying storage/serde.\n\nThis problem is easily fixed in a number of ways:\n\na) Switch to HashMap, which allows null keys. That does not preserve order of keys, which should not be important for map fields, but if we desire that, we have a solution for that too - LinkedHashMap, which would both retain order and allow us to insert null keys into the map.\n\nb) Ignore null keyed entries - check if the field we read is null, and if it is, then ignore that item in the record altogether. This way, HCat is robust in what it does - it does not terminate with an NPE, and it does not allow null keys in maps that might be problematic to layers above us that are not used to seeing nulls as keys in maps.\n\nWhy do I bring up the second fix? First, I bring it up because of the way we discovered this bug. When reading from an RCFile, we do not notice this bug. If the same query that produced the RCFile instead produces an Orcfile, and we try reading from it, we see this problem.\n\nRCFile seems to be quietly stripping any null key entries, whereas Orc retains them. This is why we didn't notice this problem for a long while, and suddenly, now, we are. Now, if we fix our code to allow nulls in map keys through to layers above, we expose layers above to this change, which may then cause them to break. (Technically, this is stretching the case because we already break now if they care) More importantly, though, we have a case now, where the same data will be exposed differently if it were stored as orc or if it were stored as rcfile. And as a layer that is supposed to make storage invisible to the end user, HCat should attempt to provide some consistency in how data behaves to the end user.\n\nSecondly, whether or not nulls should be supported as keys in Maps seems to be almost a religious view. Some people see it from a perspective of a \"mapping\", which lends itself to a \"Sure, if we encounter a null, we map to this other value\" kind of a view, whereas other people view it from a \"lookup index\" kind of view, which lends itself to a \"null as a key makes no sense - What kind of lookup do you expect to perform?\" kind of view. Both views have their points, and it makes sense to see if we need to support it.\n\nThat said...\n\nThere is another important concern at hand here: nulls in map keys might be due to bad data(corruption or loading error), and by stripping them, we might be silently hiding that from the user. So \"silent stripping\" is bad. This is an important point that does steer me towards the former approach, of passing it on to layers above, and standardize on an understanding that null keys in maps are acceptable data that layers above us have to handle. After that, it could be taken on as a further consistency fix, to fix RCFile so that it allows nulls in map keys.\n\nHaving gone through this discussion of standardization, another important question is whether or not there is actually a use-case for null keys in maps in data. If there isn't, maybe we shouldn't allow writing that in the first place, and both orc and rcfile must simply error out to the end user if they try to write a  null map key? Well, it is true that it is possible that data errors lead to null keys, but it's also possible that the user wants to store a mapping for value transformations, and they might have a transformation for null as well. In the case I encountered it, they were writing out an intermediate table after having read from a sparse table using a custom input format that generated an arbitrary number of columns, and were using the map to store column name mappings that would eventually be written out to another table. That seems a valid use, and we shouldn't prevent users from this sort of usage.\n\nAnother reason for not allowing null keys from a java perspective is locking and concurrency concerns, where locking on a null is a pain, per disagreements between Joshua Bloch and Doug Lea in the design of HashMap and ConcurrentHashMap. However, given that HCatalog reads are happening in a thread on a drone where there should be no parallel access of that record, and more importantly, this should strictly be used in a read-only kind of usage, we should not have to worry about that.\n\nIncreasingly, my preference is to change to LinkedHashMaps to allow null keys, and for consistency's sake, after this is tackled, to see if we should be fixing RCFile to allow null keys(this might be trickier since RCFile has a lot of other users that are probably currently working.)\n\nAnother option is to change to LinkedHashMap, but also add a conf key to hcat to allow the user to specify whether or not we want to strip nulls. That way, a user can specify what behaviour they like. That's more cruft though, and I don't want to go down that path unless there is a user that explicitly wants/needs that.\n\nAnyone have any other thoughts on the matter?",
        "duedate": null,
        "environment": null,
        "fixVersions": [],
        "issuelinks": [
            {
                "id": "12390807",
                "outwardIssue": {
                    "fields": {
                        "issuetype": {
                            "avatarId": 21133,
                            "description": "A problem which impairs or prevents the functions of the product.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                            "id": "1",
                            "name": "Bug",
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                            "subtask": false
                        },
                        "priority": {
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "id": "3",
                            "name": "Major",
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
                        },
                        "status": {
                            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
                            "id": "6",
                            "name": "Closed",
                            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
                            "statusCategory": {
                                "colorName": "green",
                                "id": 3,
                                "key": "done",
                                "name": "Done",
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
                            }
                        },
                        "summary": "HCatLoader fail to load Orc map with null key"
                    },
                    "id": "12723477",
                    "key": "HIVE-7282",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/12723477"
                },
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12390807",
                "type": {
                    "id": "10030",
                    "inward": "is related to",
                    "name": "Reference",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                }
            },
            {
                "id": "12447209",
                "inwardIssue": {
                    "fields": {
                        "issuetype": {
                            "avatarId": 21146,
                            "description": "The sub-task of the issue",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype",
                            "id": "7",
                            "name": "Sub-task",
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/7",
                            "subtask": true
                        },
                        "priority": {
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "id": "3",
                            "name": "Major",
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
                        },
                        "status": {
                            "description": "The issue is open and ready for the assignee to start work on it.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
                            "id": "1",
                            "name": "Open",
                            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
                            "statusCategory": {
                                "colorName": "blue-gray",
                                "id": 2,
                                "key": "new",
                                "name": "To Do",
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2"
                            }
                        },
                        "summary": "Map instances with null keys are not properly handled for Parquet tables"
                    },
                    "id": "12858212",
                    "key": "HIVE-11625",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/12858212"
                },
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12447209",
                "type": {
                    "id": "10030",
                    "inward": "is related to",
                    "name": "Reference",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                }
            },
            {
                "id": "12447208",
                "inwardIssue": {
                    "fields": {
                        "issuetype": {
                            "avatarId": 21133,
                            "description": "A problem which impairs or prevents the functions of the product.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                            "id": "1",
                            "name": "Bug",
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                            "subtask": false
                        },
                        "priority": {
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "id": "3",
                            "name": "Major",
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
                        },
                        "status": {
                            "description": "The issue is open and ready for the assignee to start work on it.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
                            "id": "1",
                            "name": "Open",
                            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
                            "statusCategory": {
                                "colorName": "blue-gray",
                                "id": 2,
                                "key": "new",
                                "name": "To Do",
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2"
                            }
                        },
                        "summary": "Map instances with null keys are not written unless table file format is ORC. "
                    },
                    "id": "12861155",
                    "key": "HIVE-11713",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/12861155"
                },
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12447208",
                "type": {
                    "id": "10030",
                    "inward": "is related to",
                    "name": "Reference",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                }
            },
            {
                "id": "12390518",
                "inwardIssue": {
                    "fields": {
                        "issuetype": {
                            "avatarId": 21133,
                            "description": "A problem which impairs or prevents the functions of the product.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                            "id": "1",
                            "name": "Bug",
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                            "subtask": false
                        },
                        "priority": {
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "id": "3",
                            "name": "Major",
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
                        },
                        "status": {
                            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
                            "id": "6",
                            "name": "Closed",
                            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
                            "statusCategory": {
                                "colorName": "green",
                                "id": 3,
                                "key": "done",
                                "name": "Done",
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
                            }
                        },
                        "summary": "HCatLoader fail to load Orc map with null key"
                    },
                    "id": "12723477",
                    "key": "HIVE-7282",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/12723477"
                },
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12390518",
                "type": {
                    "id": "10030",
                    "inward": "is related to",
                    "name": "Reference",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                }
            }
        ],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935"
            },
            "id": "12310843",
            "key": "HIVE",
            "name": "Hive",
            "projectCategory": {
                "description": "Scalable Distributed Computing",
                "id": "10292",
                "name": "Hadoop",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10292"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12310843"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sushanth&avatarId=26812",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sushanth&avatarId=26812",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sushanth&avatarId=26812",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=sushanth&avatarId=26812"
            },
            "displayName": "Sushanth Sowmyan",
            "key": "sushanth",
            "name": "sushanth",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=sushanth",
            "timeZone": "America/Los_Angeles"
        },
        "resolution": null,
        "resolutiondate": null,
        "status": {
            "description": "The issue is open and ready for the assignee to start work on it.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
            "id": "1",
            "name": "Open",
            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
            "statusCategory": {
                "colorName": "blue-gray",
                "id": 2,
                "key": "new",
                "name": "To Do",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2"
            }
        },
        "subtasks": [],
        "summary": "HCat reading null-key map entries causes NPE",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2015-10-27T20:35:46.000+0000",
        "versions": [],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-5020/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-5020/watchers",
            "watchCount": 6
        },
        "workratio": -1
    },
    "id": "12662490",
    "key": "HIVE-5020",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12662490"
}