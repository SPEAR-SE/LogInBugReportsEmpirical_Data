{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sushanth&avatarId=26812",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sushanth&avatarId=26812",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sushanth&avatarId=26812",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=sushanth&avatarId=26812"
            },
            "displayName": "Sushanth Sowmyan",
            "key": "sushanth",
            "name": "sushanth",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=sushanth",
            "timeZone": "America/Los_Angeles"
        },
        "components": [{
            "description": "Security Subcomponent",
            "id": "12317301",
            "name": "Authentication",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12317301"
        }],
        "created": "2016-02-05T23:40:09.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10438"
            },
            "displayName": "Takahiko Saito",
            "key": "taksaito",
            "name": "taksaito",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=taksaito",
            "timeZone": "America/Los_Angeles"
        },
        "customfield_10010": null,
        "customfield_12310191": null,
        "customfield_12310192": null,
        "customfield_12310220": "2016-02-06T19:11:30.484+0000",
        "customfield_12310222": "1_*:*_1_*:*_411452744_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_177043555",
        "customfield_12310230": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "3.0",
        "customfield_12310320": [
            {
                "archived": false,
                "description": "branch-1.2 HEAD",
                "id": "12332952",
                "name": "1.2.2",
                "releaseDate": "2017-04-06",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12332952"
            },
            {
                "archived": false,
                "id": "12334255",
                "name": "2.1.0",
                "releaseDate": "2016-06-20",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12334255"
            }
        ],
        "customfield_12310420": "9223372036854775807",
        "customfield_12310920": "9223372036854775807",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i2si5b:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Fri Mar 17 20:20:56 UTC 2017",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "The following query fails, when Azure Filesystem is used as default file system, and HDFS is used for intermediate data.\n\n{noformat}\n>>>  create temporary table s10k stored as orc as select * from studenttab10k;\n>>>  create temporary table v10k as select * from votertab10k;\n>>>  select registration \nfrom s10k s join v10k v \non (s.name = v.name) join studentparttab30k p \non (p.name = v.name) \nwhere s.age < 25 and v.age < 25 and p.age < 25;\nERROR : Execution failed with exit status: 2\nERROR : Obtaining error information\nERROR : \nTask failed!\nTask ID:\n  Stage-5\n\nLogs:\n\nERROR : /var/log/hive/hiveServer2.log\nError: Error while processing statement: FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapredLocalTask (state=08S01,code=2)\nAborting command set because \"force\" is false and command failed: \"select registration \nfrom s10k s join v10k v \non (s.name = v.name) join studentparttab30k p \non (p.name = v.name) \nwhere s.age < 25 and v.age < 25 and p.age < 25;\"\nClosing: 0: jdbc:hive2://zk2-hs21-h.hdinsight.net:2181/;serviceDiscoveryMode=zooKeeper;zooKeeperNamespace=hiveserver2;principal=hive/_HOST@HDINSIGHT.NET;transportMode=http;httpPath=cliservice\nhiveServer2.log shows:\n2016-02-02 18:04:34,182 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogBegin(135)) - <PERFLOG method=Driver.run from=org.apache.hadoop.hive.ql.Driver>\n2016-02-02 18:04:34,199 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogBegin(135)) - <PERFLOG method=TimeToSubmit from=org.apache.hadoop.hive.ql.Driver>\n2016-02-02 18:04:34,212 INFO  [HiveServer2-HttpHandler-Pool: Thread-55]: thrift.ThriftHttpServlet (ThriftHttpServlet.java:doPost(127)) - Could not validate cookie sent, will try to generate a new cookie\n2016-02-02 18:04:34,213 INFO  [HiveServer2-Background-Pool: Thread-517]: ql.Driver (Driver.java:checkConcurrency(168)) - Concurrency mode is disabled, not creating a lock manager\n2016-02-02 18:04:34,219 INFO  [HiveServer2-HttpHandler-Pool: Thread-55]: thrift.ThriftHttpServlet (ThriftHttpServlet.java:doKerberosAuth(352)) - Failed to authenticate with http/_HOST kerberos principal, trying with hive/_HOST kerberos principal\n2016-02-02 18:04:34,219 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogBegin(135)) - <PERFLOG method=Driver.execute from=org.apache.hadoop.hive.ql.Driver>\n2016-02-02 18:04:34,225 INFO  [HiveServer2-Background-Pool: Thread-517]: ql.Driver (Driver.java:execute(1390)) - Setting caller context to query id hive_20160202180429_7ffff6ab-64d6-4c89-88b0-6355cc5acbd0\n2016-02-02 18:04:34,226 INFO  [HiveServer2-Background-Pool: Thread-517]: ql.Driver (Driver.java:execute(1393)) - Starting command(queryId=hive_20160202180429_7ffff6ab-64d6-4c89-88b0-6355cc5acbd0): select registration\nfrom s10k s join v10k v\non (s.name = v.name) join studentparttab30k p\non (p.name = v.name)\nwhere s.age < 25 and v.age < 25 and p.age < 25\n2016-02-02 18:04:34,228 INFO  [HiveServer2-Background-Pool: Thread-517]: hooks.ATSHook (ATSHook.java:<init>(90)) - Created ATS Hook\n2016-02-02 18:04:34,229 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogBegin(135)) - <PERFLOG method=PreHook.org.apache.hadoop.hive.ql.hooks.ATSHook from=org.apache.hadoop.hive.ql.Driver>\n2016-02-02 18:04:34,237 INFO  [HiveServer2-HttpHandler-Pool: Thread-55]: thrift.ThriftHttpServlet (ThriftHttpServlet.java:doPost(169)) - Cookie added for clientUserName hrt_qa\n2016-02-02 18:04:34,238 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogEnd(162)) - <\/PERFLOG method=PreHook.org.apache.hadoop.hive.ql.hooks.ATSHook start=1454436274229 end=1454436274238 duration=9 from=org.apache.hadoop.hive.ql.Driver>\n2016-02-02 18:04:34,239 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogBegin(135)) - <PERFLOG method=PreHook.org.apache.hadoop.hive.ql.security.authorization.plugin.DisallowTransformHook from=org.apache.hadoop.hive.ql.Driver>\n2016-02-02 18:04:34,240 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogEnd(162)) - <\/PERFLOG method=PreHook.org.apache.hadoop.hive.ql.security.authorization.plugin.DisallowTransformHook start=1454436274239 end=1454436274240 duration=1 from=org.apache.hadoop.hive.ql.Driver>\nQuery ID = hive_20160202180429_7ffff6ab-64d6-4c89-88b0-6355cc5acbd0\n2016-02-02 18:04:34,242 INFO  [HiveServer2-Background-Pool: Thread-517]: ql.Driver (SessionState.java:printInfo(923)) - Query ID = hive_20160202180429_7ffff6ab-64d6-4c89-88b0-6355cc5acbd0\nTotal jobs = 1\n2016-02-02 18:04:34,243 INFO  [HiveServer2-Background-Pool: Thread-517]: ql.Driver (SessionState.java:printInfo(923)) - Total jobs = 1\n2016-02-02 18:04:34,245 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogEnd(162)) - <\/PERFLOG method=TimeToSubmit start=1454436274199 end=1454436274245 duration=46 from=org.apache.hadoop.hive.ql.Driver>\n2016-02-02 18:04:34,246 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogBegin(135)) - <PERFLOG method=runTasks from=org.apache.hadoop.hive.ql.Driver>\n2016-02-02 18:04:34,247 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogBegin(135)) - <PERFLOG method=task.MAPREDLOCAL.Stage-5 from=org.apache.hadoop.hive.ql.Driver>\n2016-02-02 18:04:34,258 INFO  [HiveServer2-Background-Pool: Thread-517]: ql.Driver (Driver.java:launchTask(1718)) - Starting task [Stage-5:MAPREDLOCAL] in serial mode\n2016-02-02 18:04:34,280 INFO  [HiveServer2-Background-Pool: Thread-517]: mr.MapredLocalTask (MapredLocalTask.java:executeInChildVM(158)) - Generating plan file file:/tmp/hive/916e3dbb-a10d-4888-a063-52fb058ea421/hive_2016-02-02_18-04-29_153_625340340820843828-4/-local-10006/plan.xml\n2016-02-02 18:04:34,288 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogBegin(135)) - <PERFLOG method=serializePlan from=org.apache.hadoop.hive.ql.exec.Utilities>\n2016-02-02 18:04:34,289 INFO  [HiveServer2-Background-Pool: Thread-517]: exec.Utilities (Utilities.java:serializePlan(1028)) - Serializing MapredLocalWork via kryo\n2016-02-02 18:04:34,290 INFO  [ATS Logger 0]: hooks.ATSHook (ATSHook.java:createPreHookEvent(158)) - Received pre-hook notification for :hive_20160202180429_7ffff6ab-64d6-4c89-88b0-6355cc5acbd0\n2016-02-02 18:04:34,358 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogEnd(162)) - <\/PERFLOG method=serializePlan start=1454436274288 end=1454436274358 duration=70 from=org.apache.hadoop.hive.ql.exec.Utilities>\n2016-02-02 18:04:34,737 INFO  [HiveServer2-Background-Pool: Thread-517]: mr.MapredLocalTask (MapredLocalTask.java:executeInChildVM(287)) - Executing: /usr/hdp/2.4.1.0-170/hadoop/bin/hadoop jar /usr/hdp/2.4.1.0-170/hive/lib/hive-common-1.2.1000.2.4.1.0-170.jar org.apache.hadoop.hive.ql.exec.mr.ExecDriver -localtask -plan file:/tmp/hive/916e3dbb-a10d-4888-a063-52fb058ea421/hive_2016-02-02_18-04-29_153_625340340820843828-4/-local-10006/plan.xml   -jobconffile file:/tmp/hive/916e3dbb-a10d-4888-a063-52fb058ea421/hive_2016-02-02_18-04-29_153_625340340820843828-4/-local-10007/jobconf.xml\nWARNING: Use \"yarn jar\" to launch YARN applications.\n2016-02-02 18:04:37,450 INFO  [org.apache.ranger.audit.queue.AuditBatchQueue0]: provider.BaseAuditHandler (BaseAuditHandler.java:logStatus(312)) - Audit Status Log: name=hiveServer2.async.summary.batch.solr, interval=01:21.012 minutes, events=2, succcessCount=2, totalEvents=4, totalSuccessCount=4\nExecution log at: /tmp/hive/hive_20160202180429_7ffff6ab-64d6-4c89-88b0-6355cc5acbd0.log\n2016-02-02 18:04:39,248 INFO  [HiveServer2-HttpHandler-Pool: Thread-55]: thrift.ThriftHttpServlet (ThriftHttpServlet.java:doPost(127)) - Could not validate cookie sent, will try to generate a new cookie\n2016-02-02 18:04:39,254 INFO  [HiveServer2-HttpHandler-Pool: Thread-55]: thrift.ThriftHttpServlet (ThriftHttpServlet.java:doKerberosAuth(352)) - Failed to authenticate with http/_HOST kerberos principal, trying with hive/_HOST kerberos principal\n2016-02-02 18:04:39,261 INFO  [HiveServer2-HttpHandler-Pool: Thread-55]: thrift.ThriftHttpServlet (ThriftHttpServlet.java:doPost(169)) - Cookie added for clientUserName hrt_qa\n2016-02-02 18:04:40     Starting to launch local task to process map join;      maximum memory = 477102080\nExecution failed with exit status: 2\n2016-02-02 18:04:43,728 ERROR [HiveServer2-Background-Pool: Thread-517]: exec.Task (SessionState.java:printError(932)) - Execution failed with exit status: 2\nObtaining error information\n2016-02-02 18:04:43,730 ERROR [HiveServer2-Background-Pool: Thread-517]: exec.Task (SessionState.java:printError(932)) - Obtaining error information\n\nTask failed!\nTask ID:\n  Stage-5\n\nLogs:\n\n2016-02-02 18:04:43,730 ERROR [HiveServer2-Background-Pool: Thread-517]: exec.Task (SessionState.java:printError(932)) -\nTask failed!\nTask ID:\n  Stage-5\n\nLogs:\n\n/var/log/hive/hiveServer2.log\n2016-02-02 18:04:43,732 ERROR [HiveServer2-Background-Pool: Thread-517]: exec.Task (SessionState.java:printError(932)) - /var/log/hive/hiveServer2.log\n2016-02-02 18:04:43,732 ERROR [HiveServer2-Background-Pool: Thread-517]: mr.MapredLocalTask (MapredLocalTask.java:executeInChildVM(307)) - Execution failed with exit status: 2\n2016-02-02 18:04:43,733 INFO  [HiveServer2-Background-Pool: Thread-517]: hooks.ATSHook (ATSHook.java:<init>(90)) - Created ATS Hook\n2016-02-02 18:04:43,734 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogBegin(135)) - <PERFLOG method=FailureHook.org.apache.hadoop.hive.ql.hooks.ATSHook from=org.apache.hadoop.hive.ql.Driver>\n2016-02-02 18:04:43,736 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogEnd(162)) - <\/PERFLOG method=FailureHook.org.apache.hadoop.hive.ql.hooks.ATSHook start=1454436283734 end=1454436283736 duration=2 from=org.apache.hadoop.hive.ql.Driver>\n2016-02-02 18:04:43,736 INFO  [ATS Logger 0]: hooks.ATSHook (ATSHook.java:createPostHookEvent(193)) - Received post-hook notification for :hive_20160202180429_7ffff6ab-64d6-4c89-88b0-6355cc5acbd0\nFAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapredLocalTask\n2016-02-02 18:04:43,757 ERROR [HiveServer2-Background-Pool: Thread-517]: ql.Driver (SessionState.java:printError(932)) - FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapredLocalTask\n2016-02-02 18:04:43,758 INFO  [HiveServer2-Background-Pool: Thread-517]: ql.Driver (Driver.java:execute(1621)) - Resetting the caller context to HIVE_SSN_ID:916e3dbb-a10d-4888-a063-52fb058ea421\n2016-02-02 18:04:43,759 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogEnd(162)) - <\/PERFLOG method=Driver.execute start=1454436274219 end=1454436283759 duration=9540 from=org.apache.hadoop.hive.ql.Driver>\n2016-02-02 18:04:43,760 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogBegin(135)) - <PERFLOG method=releaseLocks from=org.apache.hadoop.hive.ql.Driver>\n2016-02-02 18:04:43,761 INFO  [HiveServer2-Background-Pool: Thread-517]: log.PerfLogger (PerfLogger.java:PerfLogEnd(162)) - <\/PERFLOG method=releaseLocks start=1454436283760 end=1454436283761 duration=1 from=org.apache.hadoop.hive.ql.Driver>\n2016-02-02 18:04:43,766 ERROR [HiveServer2-Background-Pool: Thread-517]: operation.Operation (SQLOperation.java:run(209)) - Error running hive query:\norg.apache.hive.service.cli.HiveSQLException: Error while processing statement: FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapredLocalTask\n        at org.apache.hive.service.cli.operation.Operation.toSQLException(Operation.java:315)\n        at org.apache.hive.service.cli.operation.SQLOperation.runQuery(SQLOperation.java:156)\n        at org.apache.hive.service.cli.operation.SQLOperation.access$100(SQLOperation.java:71)\n        at org.apache.hive.service.cli.operation.SQLOperation$1$1.run(SQLOperation.java:206)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:415)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1657)\n        at org.apache.hive.service.cli.operation.SQLOperation$1.run(SQLOperation.java:218)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:262)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nhive Configs can be viewed from http://qelog.hortonworks.com/log/hs21-hbs24-1454382123/artifacts/tmpModifyConfDir_1454394513592/\nAttachments\nDrop files to attach, or browse.\nAdd LinkIssue Links\nrelates to\nBug - A problem which impairs or prevents the functions of the product. HIVE-739 webhcat tests failing in HDInsight secure cluster throwing NullPointerException\t Blocker - Blocks development and/or testing work, production could not run. RESOLVED\nActivity\nAll\nComments\nWork Log\nHistory\nActivity\nAscending order - Click to sort in descending order\nPermalink Edit Delete \ntsaito Takahiko Saito added a comment - 3 days ago\nThe test passes via hive CLI and explain shows:\n0: jdbc:hive2://zk2-hs21-h.hdinsight.net:2181> explain select registration\n0: jdbc:hive2://zk2-hs21-h.hdinsight.net:2181> from s10k s join v10k v\n0: jdbc:hive2://zk2-hs21-h.hdinsight.net:2181> on (s.name = v.name) join studentparttab30k p\n0: jdbc:hive2://zk2-hs21-h.hdinsight.net:2181> on (p.name = v.name)\n0: jdbc:hive2://zk2-hs21-h.hdinsight.net:2181> where s.age < 25 and v.age < 25 and p.age < 25;\n+--------------------------------------------------------------------------------------------------------------+--+\n|                                                   Explain                                                    |\n+--------------------------------------------------------------------------------------------------------------+--+\n| STAGE DEPENDENCIES:                                                                                          |\n|   Stage-5 is a root stage                                                                                    |\n|   Stage-4 depends on stages: Stage-5                                                                         |\n|   Stage-0 depends on stages: Stage-4                                                                         |\n|                                                                                                              |\n| STAGE PLANS:                                                                                                 |\n|   Stage: Stage-5                                                                                             |\n|     Map Reduce Local Work                                                                                    |\n|       Alias -> Map Local Tables:                                                                             |\n|         s                                                                                                    |\n|           Fetch Operator                                                                                     |\n|             limit: -1                                                                                        |\n|         v                                                                                                    |\n|           Fetch Operator                                                                                     |\n|             limit: -1                                                                                        |\n|       Alias -> Map Local Operator Tree:                                                                      |\n|         s                                                                                                    |\n|           TableScan                                                                                          |\n|             alias: s                                                                                         |\n|             filterExpr: (name is not null and (age < 25)) (type: boolean)                                    |\n|             Statistics: Num rows: 459 Data size: 47777 Basic stats: COMPLETE Column stats: NONE              |\n|             Filter Operator                                                                                  |\n|               predicate: (name is not null and (age < 25)) (type: boolean)                                   |\n|               Statistics: Num rows: 76 Data size: 7910 Basic stats: COMPLETE Column stats: NONE              |\n|               HashTable Sink Operator                                                                        |\n|                 keys:                                                                                        |\n|                   0 name (type: string)                                                                      |\n|                   1 name (type: string)                                                                      |\n|                   2 name (type: string)                                                                      |\n|         v                                                                                                    |\n|           TableScan                                                                                          |\n|             alias: v                                                                                         |\n|             filterExpr: (name is not null and (age < 25)) (type: boolean)                                    |\n|             Statistics: Num rows: 1653 Data size: 337233 Basic stats: COMPLETE Column stats: NONE            |\n|             Filter Operator                                                                                  |\n|               predicate: (name is not null and (age < 25)) (type: boolean)                                   |\n|               Statistics: Num rows: 275 Data size: 56103 Basic stats: COMPLETE Column stats: NONE            |\n|               HashTable Sink Operator                                                                        |\n|                 keys:                                                                                        |\n|                   0 name (type: string)                                                                      |\n|                   1 name (type: string)                                                                      |\n|                   2 name (type: string)                                                                      |\n|                                                                                                              |\n|   Stage: Stage-4                                                                                             |\n|     Map Reduce                                                                                               |\n|       Map Operator Tree:                                                                                     |\n|           TableScan                                                                                          |\n|             alias: p                                                                                         |\n|             filterExpr: (name is not null and (age < 25)) (type: boolean)                                    |\n|             Statistics: Num rows: 30000 Data size: 627520 Basic stats: COMPLETE Column stats: COMPLETE       |\n|             Filter Operator                                                                                  |\n|               predicate: (name is not null and (age < 25)) (type: boolean)                                   |\n|               Statistics: Num rows: 10000 Data size: 1010000 Basic stats: COMPLETE Column stats: COMPLETE    |\n|               Map Join Operator                                                                              |\n|                 condition map:                                                                               |\n|                      Inner Join 0 to 1                                                                       |\n|                      Inner Join 1 to 2                                                                       |\n|                 keys:                                                                                        |\n|                   0 name (type: string)                                                                      |\n|                   1 name (type: string)                                                                      |\n|                   2 name (type: string)                                                                      |\n|                 outputColumnNames: _col8                                                                     |\n|                 Statistics: Num rows: 22000 Data size: 2222000 Basic stats: COMPLETE Column stats: NONE      |\n|                 Select Operator                                                                              |\n|                   expressions: _col8 (type: string)                                                          |\n|                   outputColumnNames: _col0                                                                   |\n|                   Statistics: Num rows: 22000 Data size: 2222000 Basic stats: COMPLETE Column stats: NONE    |\n|                   File Output Operator                                                                       |\n|                     compressed: false                                                                        |\n|                     Statistics: Num rows: 22000 Data size: 2222000 Basic stats: COMPLETE Column stats: NONE  |\n|                     table:                                                                                   |\n|                         input format: org.apache.hadoop.mapred.TextInputFormat                               |\n|                         output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat            |\n|                         serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe                            |\n|       Local Work:                                                                                            |\n|         Map Reduce Local Work                                                                                |\n|                                                                                                              |\n|   Stage: Stage-0                                                                                             |\n|     Fetch Operator                                                                                           |\n|       limit: -1                                                                                              |\n|       Processor Tree:                                                                                        |\n|         ListSink                                                                                             |\n|                                                                                                              |\n+--------------------------------------------------------------------------------------------------------------+--+\n83 rows selected (2.473 seconds)\nPermalink Edit Delete \ntsaito Takahiko Saito added a comment - 3 days ago\nemptablemisc_8 also fails with the same error:\n>>>  create temporary table temp1 as select * from votertab10k;\n>>>  select * \nfrom studenttab10k s \nwhere s.name not in \n(select name from temp1);\nINFO  : Number of reduce tasks determined at compile time: 1\nINFO  : In order to change the average load for a reducer (in bytes):\nINFO  :   set hive.exec.reducers.bytes.per.reducer=<number>\nINFO  : In order to limit the maximum number of reducers:\nINFO  :   set hive.exec.reducers.max=<number>\nINFO  : In order to set a constant number of reducers:\nINFO  :   set mapreduce.job.reduces=<number>\nINFO  : number of splits:1\nINFO  : Submitting tokens for job: job_1454394534358_0164\nINFO  : Kind: HDFS_DELEGATION_TOKEN, Service: 10.0.0.36:8020, Ident: (HDFS_DELEGATION_TOKEN token 246 for hrt_qa)\nINFO  : The url to track the job: http://hn0-hs21-h.hdinsight.net:8088/proxy/application_1454394534358_0164/\nINFO  : Starting Job = job_1454394534358_0164, Tracking URL = http://hn0-hs21-h.hdinsight.net:8088/proxy/application_1454394534358_0164/\nINFO  : Kill Command = /usr/hdp/2.4.1.0-170/hadoop/bin/hadoop job  -kill job_1454394534358_0164\nINFO  : Hadoop job information for Stage-4: number of mappers: 1; number of reducers: 1\nINFO  : 2016-02-02 10:11:02,367 Stage-4 map = 0%,  reduce = 0%\nINFO  : 2016-02-02 10:11:26,060 Stage-4 map = 100%,  reduce = 0%, Cumulative CPU 5.48 sec\nINFO  : 2016-02-02 10:11:39,024 Stage-4 map = 100%,  reduce = 100%, Cumulative CPU 11.18 sec\nINFO  : MapReduce Total cumulative CPU time: 11 seconds 180 msec\nINFO  : Ended Job = job_1454394534358_0164\nINFO  : Stage-9 is selected by condition resolver.\nINFO  : Stage-1 is filtered out by condition resolver.\nERROR : Execution failed with exit status: 2\nERROR : Obtaining error information\nERROR : \nTask failed!\nTask ID:\n  Stage-9\n\nLogs:\n\nERROR : /var/log/hive/hiveServer2.log\nINFO  : Number of reduce tasks determined at compile time: 1\nINFO  : In order to change the average load for a reducer (in bytes):\nINFO  :   set hive.exec.reducers.bytes.per.reducer=<number>\nINFO  : In order to limit the maximum number of reducers:\nINFO  :   set hive.exec.reducers.max=<number>\nINFO  : In order to set a constant number of reducers:\nINFO  :   set mapreduce.job.reduces=<number>\nINFO  : number of splits:2\nINFO  : Submitting tokens for job: job_1454394534358_0169\nINFO  : Kind: HDFS_DELEGATION_TOKEN, Service: 10.0.0.36:8020, Ident: (HDFS_DELEGATION_TOKEN token 252 for hrt_qa)\nINFO  : The url to track the job: http://hn0-hs21-h.hdinsight.net:8088/proxy/application_1454394534358_0169/\nINFO  : Starting Job = job_1454394534358_0169, Tracking URL = http://hn0-hs21-h.hdinsight.net:8088/proxy/application_1454394534358_0169/\nINFO  : Kill Command = /usr/hdp/2.4.1.0-170/hadoop/bin/hadoop job  -kill job_1454394534358_0169\nINFO  : Hadoop job information for Stage-1: number of mappers: 2; number of reducers: 1\nINFO  : 2016-02-02 10:16:38,027 Stage-1 map = 0%,  reduce = 0%\nINFO  : 2016-02-02 10:16:52,498 Stage-1 map = 50%,  reduce = 0%, Cumulative CPU 3.8 sec\nINFO  : 2016-02-02 10:16:53,566 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 9.94 sec\nINFO  : 2016-02-02 10:17:16,202 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 17.04 sec\nINFO  : MapReduce Total cumulative CPU time: 17 seconds 40 msec\nINFO  : Ended Job = job_1454394534358_0169\nERROR : Execution failed with exit status: 2\nERROR : Obtaining error information\nERROR : \nTask failed!\nTask ID:\n  Stage-8\n\nLogs:\n\nERROR : /var/log/hive/hiveServer2.log\nError: Error while processing statement: FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapredLocalTask (state=08S01,code=2)\nAborting command set because \"force\" is false and command failed: \"select * \nfrom studenttab10k s \nwhere s.name not in \n(select name from temp1);\"\nClosing: 0: jdbc:hive2://zk2-hs21-h.hdinsight.net:2181/;serviceDiscoveryMode=zooKeeper;zooKeeperNamespace=hiveserver2;principal=hive/_HOST@HDINSIGHT.NET;transportMode=http;httpPath=cliservice\nIts app log can be viewed at http://qelog.hortonworks.com/log/hs21-hbs24-1454382123/app-logs/application_1454394534358_0169.log\nPermalink Edit Delete \ntsaito Takahiko Saito added a comment - 3 days ago\nThe query works without 'temporary table':\n0: jdbc:hive2://zk2-hs21-h.hdinsight.net:2181> select registration from studenttab10k s join votertab10k v\n0: jdbc:hive2://zk2-hs21-h.hdinsight.net:2181> on (s.name = v.name) join studentparttab30k p\n0: jdbc:hive2://zk2-hs21-h.hdinsight.net:2181> on (p.name = v.name)\n0: jdbc:hive2://zk2-hs21-h.hdinsight.net:2181> where s.age < 25 and v.age < 25 and p.age < 25;\nPermalink Edit Delete \ntsaito Takahiko Saito added a comment - 3 days ago\nMore info about temporary table:\n0: jdbc:hive2://zk2-hs21-h.hdinsight.net:2181> describe formatted s10k;\n+-------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+--+\n|           col_name            |                                                                  data_type                                                                  |        comment        |\n+-------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+--+\n| # col_name                    | data_type                                                                                                                                   | comment               |\n|                               | NULL                                                                                                                                        | NULL                  |\n| name                          | string                                                                                                                                      |                       |\n| age                           | int                                                                                                                                         |                       |\n| gpa                           | double                                                                                                                                      |                       |\n|                               | NULL                                                                                                                                        | NULL                  |\n| # Detailed Table Information  | NULL                                                                                                                                        | NULL                  |\n| Database:                     | default                                                                                                                                     | NULL                  |\n| Owner:                        | hrt_qa                                                                                                                                      | NULL                  |\n| CreateTime:                   | Tue Feb 02 23:02:31 UTC 2016                                                                                                                | NULL                  |\n| LastAccessTime:               | UNKNOWN                                                                                                                                     | NULL                  |\n| Protect Mode:                 | None                                                                                                                                        | NULL                  |\n| Retention:                    | 0                                                                                                                                           | NULL                  |\n| Location:                     | hdfs://hn0-hs21-h.hdinsight.net:8020/tmp/hive/hive/de2667ea-5bc1-4548-a4c4-97e46d6081f8/_tmp_space.db/8e8482c9-a2a4-4e8c-ad0f-2cd6e8fcdb4c  | NULL                  |\n| Table Type:                   | MANAGED_TABLE                                                                                                                               | NULL                  |\n|                               | NULL                                                                                                                                        | NULL                  |\n| # Storage Information         | NULL                                                                                                                                        | NULL                  |\n| SerDe Library:                | org.apache.hadoop.hive.ql.io.orc.OrcSerde                                                                                                   | NULL                  |\n| InputFormat:                  | org.apache.hadoop.hive.ql.io.orc.OrcInputFormat                                                                                             | NULL                  |\n| OutputFormat:                 | org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat                                                                                            | NULL                  |\n| Compressed:                   | No                                                                                                                                          | NULL                  |\n| Num Buckets:                  | -1                                                                                                                                          | NULL                  |\n| Bucket Columns:               | []                                                                                                                                          | NULL                  |\n| Sort Columns:                 | []                                                                                                                                          | NULL                  |\n| Storage Desc Params:          | NULL                                                                                                                                        | NULL                  |\n|                               | serialization.format                                                                                                                        | 1                     |\n+-------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+--+\n26 rows selected (0.22 seconds)\n0: jdbc:hive2://zk2-hs21-h.hdinsight.net:2181> set hive.server2.enable.doAs;\n+---------------------------------+--+\n|               set               |\n+---------------------------------+--+\n| hive.server2.enable.doAs=false  |\n+---------------------------------+--+\nPermalink Edit Delete \ntsaito Takahiko Saito added a comment - 3 days ago\nhdfs dir of temporary table is owned by hive as expected since hive.server2.enable.doAs=false:\nhdfs@hn0-hs21-h:~$ hdfs dfs -ls hdfs://hn0-hs21-h.hdinsight.net:8020/tmp/hive/hive/de2667ea-5bc1-4548-a4c4-97e46d6081f8/_tmp_space.db/8e8482c9-a2a4-4e8c-ad0f-2cd6e8fcdb4c\nFound 1 items\n-rwx------   3 hive hdfs      47777 2016-02-02 23:02 hdfs://hn0-hs21-h.hdinsight.net:8020/tmp/hive/hive/de2667ea-5bc1-4548-a4c4-97e46d6081f8/_tmp_space.db/8e8482c9-a2a4-4e8c-ad0f-2cd6e8fcdb4c/000000_0\nNot sure if it's related to the JIRA, but one thing I noticed was that dfs cmd throws error via beeline:\n0: jdbc:hive2://zk2-hs21-h.hdinsight.net:2181> dfs -ls hdfs://hn0-hs21-h.hdinsight.net:8020/tmp/hive/hive/de2667ea-5bc1-4548-a4c4-97e46d6081f8/_tmp_space.db/8e8482c9-a2a4-4e8c-ad0f-2cd6e8fcdb4c;\nError: Error while processing statement: Permission denied: user [hrt_qa] does not have privilege for [DFS] command (state=,code=1)\nPermalink Edit \nthejas Thejas Nair added a comment - 5 hours ago - edited\nTakahiko Saito \nThe above DFS error would be from Ranger of SQL standard authorization. It is not related to the test failure.\nBut you are right that it looks like a permission issue.\nThe issue seen in HIVE-739 also exists in this part of Hive. Hive in MR mode launches a new child process to process the small table and create a hash table. This child process needs credentials from HDFS. However, in this setup, azure fs is the default file system. We should also get delegation token from all FS URIs listed under mapreduce.job.hdfs-servers config.\nThere are hueristics around when map-join gets used. That is why you don't see it unless temp table is used (that uses ORC format and might have stats as well, while the original table is probaly text format).\nhttps://github.com/hortonworks/hive/blob/2.4-maint/ql/src/java/org/apache/hadoop/hive/ql/exec/SecureCmdDoAs.java needs change similar to webhcat change in HIVE-739\nPermalink Edit \nsush Sushanth Sowmyan added a comment - 7 minutes ago\nTakahiko Saito, we should file an apache jira for this as well. Would you like to do so, so the bug report has attribution to you?\nPermalink Edit Delete \ntsaito Takahiko Saito added a comment - 4 minutes ago\nSushanth Sowmyan I will file one and update with that JIRA.\n Comment\t\nPeople\nAssignee:\t sush Sushanth Sowmyan\nAssign to me\nReporter:\t tsaito Takahiko Saito\nQEAssignee:\tTakahiko Saito\nVotes:\t0\nWatchers:\t3 Stop watching this issue \nDates\nCreated:\t3 days ago\nUpdated:\t4 minutes ago\nWho's Looking?\n\nAgile\nView on Board\n{noformat}\n\nhivesever2 log shows:\n{noformat}\n2016-02-02 18:04:43,766 ERROR [HiveServer2-Background-Pool: Thread-517]: operation.Operation (SQLOperation.java:run(209)) - Error running hive query:\norg.apache.hive.service.cli.HiveSQLException: Error while processing statement: FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapredLocalTask\n        at org.apache.hive.service.cli.operation.Operation.toSQLException(Operation.java:315)\n        at org.apache.hive.service.cli.operation.SQLOperation.runQuery(SQLOperation.java:156)\n        at org.apache.hive.service.cli.operation.SQLOperation.access$100(SQLOperation.java:71)\n        at org.apache.hive.service.cli.operation.SQLOperation$1$1.run(SQLOperation.java:206)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:415)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1657)\n        at org.apache.hive.service.cli.operation.SQLOperation$1.run(SQLOperation.java:218)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:262)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\n{noformat}",
        "duedate": null,
        "environment": "Secure ",
        "fixVersions": [{
            "archived": false,
            "id": "12334255",
            "name": "2.1.0",
            "releaseDate": "2016-06-20",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12334255"
        }],
        "issuelinks": [{
            "id": "12491576",
            "inwardIssue": {
                "fields": {
                    "issuetype": {
                        "avatarId": 21133,
                        "description": "A problem which impairs or prevents the functions of the product.",
                        "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                        "id": "1",
                        "name": "Bug",
                        "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                        "subtask": false
                    },
                    "priority": {
                        "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                        "id": "3",
                        "name": "Major",
                        "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
                    },
                    "status": {
                        "description": "This issue is being actively worked on at the moment by the assignee.",
                        "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/inprogress.png",
                        "id": "3",
                        "name": "In Progress",
                        "self": "https://issues.apache.org/jira/rest/api/2/status/3",
                        "statusCategory": {
                            "colorName": "yellow",
                            "id": 4,
                            "key": "indeterminate",
                            "name": "In Progress",
                            "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/4"
                        }
                    },
                    "summary": "Hbase table query execution fails in secured cluster when hive.exec.mode.local.auto is set to true"
                },
                "id": "12904570",
                "key": "HIVE-12160",
                "self": "https://issues.apache.org/jira/rest/api/2/issue/12904570"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12491576",
            "type": {
                "id": "10030",
                "inward": "is related to",
                "name": "Reference",
                "outward": "relates to",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
            }
        }],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935"
            },
            "id": "12310843",
            "key": "HIVE",
            "name": "Hive",
            "projectCategory": {
                "description": "Scalable Distributed Computing",
                "id": "10292",
                "name": "Hadoop",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10292"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12310843"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10438"
            },
            "displayName": "Takahiko Saito",
            "key": "taksaito",
            "name": "taksaito",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=taksaito",
            "timeZone": "America/Los_Angeles"
        },
        "resolution": {
            "description": "A fix for this issue is checked into the tree and tested.",
            "id": "1",
            "name": "Fixed",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1"
        },
        "resolutiondate": "2016-02-12T19:08:25.000+0000",
        "status": {
            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
            "id": "6",
            "name": "Closed",
            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "Child process of HiveServer2 fails to get delegation token from non default FileSystem",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2017-03-17T20:20:56.000+0000",
        "versions": [{
            "archived": false,
            "id": "12332384",
            "name": "1.2.1",
            "releaseDate": "2015-06-26",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12332384"
        }],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-13017/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-13017/watchers",
            "watchCount": 5
        },
        "workratio": -1
    },
    "id": "12937197",
    "key": "HIVE-13017",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12937197"
}