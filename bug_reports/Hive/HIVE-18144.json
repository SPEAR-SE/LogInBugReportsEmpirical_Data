{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Wang Haihua",
            "key": "wanghaihua",
            "name": "wanghaihua",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=wanghaihua",
            "timeZone": "Etc/UTC"
        },
        "components": [{
            "id": "12324798",
            "name": "Query Planning",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12324798"
        }],
        "created": "2017-11-24T17:50:02.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Wang Haihua",
            "key": "wanghaihua",
            "name": "wanghaihua",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=wanghaihua",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310191": null,
        "customfield_12310192": null,
        "customfield_12310220": "2017-11-24T21:15:16.746+0000",
        "customfield_12310222": null,
        "customfield_12310230": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "3.0",
        "customfield_12310320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12310920": "9223372036854775807",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i3n69r:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Sun Apr 29 00:53:38 UTC 2018",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "Union operation with three or more table, which has different column types, may cause type inference error when Task execution.\r\n\r\nE.g, e.g. t1(with column int) union all t2(with column int) union all t3(with column bigint), finally should be {{bigint}},\r\n\r\nRowSchema of union t1 with t2, we call {{leftOp}}, should be int, then leftOp union t3 should finally be bigint.\r\n\r\nThis mean RowSchema of leftOp would be {{bigint}} instead of {{int}}\r\n\r\nHowever we see in {{SemanticAnalyzer.java}}, leftOp RowSchema is finally {{int}} which was wrong: \r\n{code}\r\n(_col0: int|{t01-subquery1}diff_long_type,_col1: int|{t01-subquery1}id2,_col2: bigint|{t01-subquery1}id3)}}\r\n{code}\r\n\r\nImpacted code  in SemanticAnalyzer.java:\r\n\r\n{code}\r\n\r\n      if(!(leftOp instanceof UnionOperator)) {\r\n        Operator oldChild = leftOp;\r\n        leftOp = (Operator) leftOp.getParentOperators().get(0);\r\n        leftOp.removeChildAndAdoptItsChildren(oldChild);\r\n      }\r\n\r\n      // make left a child of right\r\n      List<Operator<? extends OperatorDesc>> child =\r\n          new ArrayList<Operator<? extends OperatorDesc>>();\r\n      child.add(leftOp);\r\n      rightOp.setChildOperators(child);\r\n\r\n      List<Operator<? extends OperatorDesc>> parent = leftOp\r\n          .getParentOperators();\r\n      parent.add(rightOp);\r\n\r\n      UnionDesc uDesc = ((UnionOperator) leftOp).getConf();\r\n      // Here we should set RowSchema of leftOp to unionoutRR's, or else the RowSchema of leftOp is wrong.\r\n      // leftOp.setSchema(new RowSchema(unionoutRR.getColumnInfos()));\r\n      uDesc.setNumInputs(uDesc.getNumInputs() + 1);\r\n      return putOpInsertMap(leftOp, unionoutRR);\r\n\r\n{code}\r\n\r\nOperation for reproduceï¼š\r\n\r\n{code}\r\ncreate table test_union_different_type(id bigint, id2 bigint, id3 bigint, name string);\r\nset hive.auto.convert.join=true;\r\ninsert overwrite table test_union_different_type select 1, 2, 3, \"test_union_different_type\";\r\nselect\r\n  t01.diff_long_type as diff_long_type,\r\n  t01.id2 as id2,\r\n  t00.id as id,\r\n  t01.id3 as id3\r\nfrom test_union_different_type t00\r\nleft join\r\n  (\r\n    select 1 as diff_long_type, 30 as id2, id3 from test_union_different_type\r\n    union ALL\r\n    select 2 as diff_long_type, 20 as id2, id3 from test_union_different_type\r\n    union ALL\r\n    select id as diff_long_type, id2, 30 as id3 from test_union_different_type\r\n  ) t01\r\non t00.id = t01.diff_long_type\r\n;\r\n\r\n{code}\r\n\r\nStack trace:\r\n\r\n{code}\r\n\r\nDiagnostic Messages for this Task:\r\nError: java.lang.RuntimeException: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row {\"id\":1,\"id2\":null,\"id3\":null,\"name\":null}\r\n  at org.apache.hadoop.hive.ql.exec.mr.ExecMapper.map(ExecMapper.java:169)\r\n  at org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:54)\r\n  at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:453)\r\n  at org.apache.hadoop.mapred.MapTask.run(MapTask.java:343)\r\n  at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:164)\r\n  at java.security.AccessController.doPrivileged(Native Method)\r\n  at javax.security.auth.Subject.doAs(Subject.java:415)\r\n  at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1693)\r\n  at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)\r\nCaused by: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row {\"id\":1,\"id2\":null,\"id3\":null,\"name\":null}\r\n  at org.apache.hadoop.hive.ql.exec.MapOperator.process(MapOperator.java:499)\r\n  at org.apache.hadoop.hive.ql.exec.mr.ExecMapper.map(ExecMapper.java:160)\r\n  ... 8 more\r\nCaused by: org.apache.hadoop.hive.ql.metadata.HiveException: Unexpected exception from MapJoinOperator : org.apache.hadoop.io.LongWritable cannot be cast to org.apache.hadoop.io.IntWritable\r\n  at org.apache.hadoop.hive.ql.exec.MapJoinOperator.process(MapJoinOperator.java:465)\r\n  at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:879)\r\n  at org.apache.hadoop.hive.ql.exec.TableScanOperator.process(TableScanOperator.java:130)\r\n  at org.apache.hadoop.hive.ql.exec.MapOperator$MapOpCtx.forward(MapOperator.java:149)\r\n  at org.apache.hadoop.hive.ql.exec.MapOperator.process(MapOperator.java:489)\r\n  ... 9 more\r\nCaused by: java.lang.ClassCastException: org.apache.hadoop.io.LongWritable cannot be cast to org.apache.hadoop.io.IntWritable\r\n  at org.apache.hadoop.hive.serde2.objectinspector.primitive.WritableIntObjectInspector.get(WritableIntObjectInspector.java:36)\r\n  at org.apache.hadoop.hive.serde2.lazy.LazyUtils.writePrimitiveUTF8(LazyUtils.java:239)\r\n  at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.serialize(LazySimpleSerDe.java:292)\r\n  at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.serializeField(LazySimpleSerDe.java:247)\r\n  at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.doSerialize(LazySimpleSerDe.java:231)\r\n  at org.apache.hadoop.hive.serde2.AbstractEncodingAwareSerDe.serialize(AbstractEncodingAwareSerDe.java:55)\r\n  at org.apache.hadoop.hive.ql.exec.FileSinkOperator.process(FileSinkOperator.java:714)\r\n  at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:879)\r\n  at org.apache.hadoop.hive.ql.exec.SelectOperator.process(SelectOperator.java:95)\r\n  at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:879)\r\n  at org.apache.hadoop.hive.ql.exec.CommonJoinOperator.internalForward(CommonJoinOperator.java:647)\r\n  at org.apache.hadoop.hive.ql.exec.CommonJoinOperator.genUniqueJoinObject(CommonJoinOperator.java:660)\r\n  at org.apache.hadoop.hive.ql.exec.CommonJoinOperator.genUniqueJoinObject(CommonJoinOperator.java:663)\r\n  at org.apache.hadoop.hive.ql.exec.CommonJoinOperator.checkAndGenObject(CommonJoinOperator.java:759)\r\n  at org.apache.hadoop.hive.ql.exec.MapJoinOperator.process(MapJoinOperator.java:452)\r\n  ... 13 more\r\n\r\n{code}",
        "duedate": null,
        "environment": null,
        "fixVersions": [],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935"
            },
            "id": "12310843",
            "key": "HIVE",
            "name": "Hive",
            "projectCategory": {
                "description": "Scalable Distributed Computing",
                "id": "10292",
                "name": "Hadoop",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10292"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12310843"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Wang Haihua",
            "key": "wanghaihua",
            "name": "wanghaihua",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=wanghaihua",
            "timeZone": "Etc/UTC"
        },
        "resolution": null,
        "resolutiondate": null,
        "status": {
            "description": "A patch for this issue has been uploaded to JIRA by a contributor.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/document.png",
            "id": "10002",
            "name": "Patch Available",
            "self": "https://issues.apache.org/jira/rest/api/2/status/10002",
            "statusCategory": {
                "colorName": "yellow",
                "id": 4,
                "key": "indeterminate",
                "name": "In Progress",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/4"
            }
        },
        "subtasks": [],
        "summary": "Runtime type inference error when join three table for different column type ",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2018-04-29T00:53:38.000+0000",
        "versions": [
            {
                "archived": false,
                "description": "Maintenance branch for 2.1 ",
                "id": "12335838",
                "name": "2.1.1",
                "releaseDate": "2016-12-08",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12335838"
            },
            {
                "archived": false,
                "id": "12335837",
                "name": "2.2.0",
                "releaseDate": "2017-07-25",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12335837"
            }
        ],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-18144/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-18144/watchers",
            "watchCount": 3
        },
        "workratio": -1
    },
    "id": "13120668",
    "key": "HIVE-18144",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13120668"
}