[[~jpullokkaran] - can you address this?, [~brocknoland] In this specific case exception is caught and thrown up as runtime exception. I am guessing thats what you mean by CBO eating exceptions.

HiveException gets propagated through Calcite as a runtime exception; Without changing a lot of plumbing in Calcite it would be difficult to explicitly throw HiveException.

, bq. In this specific case exception is caught and thrown up as runtime exception. I am guessing thats what you mean by CBO eating exceptions.

No, I am talking about how the code below does not nest the stack trace in addition to not logging the stack trace or even the message. That is to say, this code:

{noformat}
        } catch (HiveException e) {
          String logMsg = "Collecting stats failed.";
          LOG.error(logMsg);
          throw new RuntimeException(logMsg);
        }
{noformat}

Should be:

{noformat}
        } catch (HiveException e) {
          String logMsg = "Collecting stats failed: " + e;
          LOG.error(logMsg, e);
          throw new RuntimeException(logMsg, e);
        }
{noformat}

This code includes the exception class name and message in a single line which is useful for operators who are often grepping large amount of logs:
{noformat}
          String logMsg = "Collecting stats failed: " + e;
{noformat}

This message logs the stack trace in addition to the message:
{noformat}
          LOG.error(logMsg, e);
{noformat}

This line nests the exception so the stack trace can be use at a higher level where ever it's caught:
{noformat}
          throw new RuntimeException(logMsg, e);
{noformat}

Alternatively since the exception should be logged at a higher level, you could write as follows:
{noformat}
        } catch (HiveException e) {
          String msg = "Collecting stats failed: " + e;
          throw new RuntimeException(msg, e);
        }
{noformat}, Thx Navis, +1, 

{color:green}Overall{color}: +1 all checks pass

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12690708/HIVE-9242.1.patch.txt

{color:green}SUCCESS:{color} +1 6739 tests passed

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2298/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2298/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2298/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12690708 - PreCommit-HIVE-TRUNK-Build, Committed to trunk. Thanks Brock.]