[So after add x-frame-options as the filter, the pages has different levels of protection from being framed by other sites? The value defined by templeton.frame.options.filter for webhcat. , [~ychena] Yes. You are right. , Should you use  ALLOW-FROM url in your description? , patch-2: minor change to update the description to address Yongzhi's comment., PATCH-2 looks good.  +1, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12890202/HIVE-17679.2.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 11 failed/errored test(s), 11193 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestAccumuloCliDriver.testCliDriver[accumulo_predicate_pushdown] (batchId=232)
org.apache.hadoop.hive.cli.TestAccumuloCliDriver.testCliDriver[accumulo_single_sourced_multi_insert] (batchId=232)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[unionDistinct_1] (batchId=144)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[optimize_nullscan] (batchId=162)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[union_fast_stats] (batchId=157)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_explainuser_1] (batchId=171)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=101)
org.apache.hadoop.hive.cli.TestTezPerfCliDriver.testCliDriver[query14] (batchId=240)
org.apache.hadoop.hive.cli.TestTezPerfCliDriver.testCliDriver[query23] (batchId=240)
org.apache.hadoop.hive.cli.control.TestDanglingQOuts.checkDanglingQOut (batchId=203)
org.apache.hive.jdbc.TestJdbcDriver2.testSelectExecAsync2 (batchId=227)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/7097/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/7097/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-7097/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 11 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12890202 - PreCommit-HIVE-Build, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12890202/HIVE-17679.2.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 8 failed/errored test(s), 11194 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestAccumuloCliDriver.testCliDriver[accumulo_predicate_pushdown] (batchId=232)
org.apache.hadoop.hive.cli.TestAccumuloCliDriver.testCliDriver[accumulo_single_sourced_multi_insert] (batchId=232)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[unionDistinct_1] (batchId=144)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[optimize_nullscan] (batchId=162)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[union_fast_stats] (batchId=157)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_explainuser_1] (batchId=171)
org.apache.hadoop.hive.cli.TestTezPerfCliDriver.testCliDriver[query14] (batchId=240)
org.apache.hadoop.hive.cli.control.TestDanglingQOuts.checkDanglingQOut (batchId=203)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/7099/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/7099/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-7099/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 8 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12890202 - PreCommit-HIVE-Build, Pushed to master. Thanks Yongzhi for reviewing., FYI , HIVE-13853 adds ability to introduce X-XSRF-Header through config option for both HS2 (thrift http requests) and webhcat. If that is enabled, then requests from UI (browser) cannot be sent as they can't add this custom header to the requests.
, This change doesn't seem to prevent XSRF, unlike HIVE-13853. Is that right ?
I beleive HIVE-13853 would prevent both XSRF and click jacking.
, [~thejas] This change doesn't prevent XSRF, but I don't think HIVE-13853 would fix click jacking issue though. Hadoop has the jira HADOOP-12964 to fix click jacking issue.  XSRF and click jacking seem to be different issues. See https://stackoverflow.com/questions/17013150/does-csrf-defense-also-defend-against-clickjacking. , This adds a WebHCat configuration variable, *templeton.frame.options.filter*, which is documented in the wiki here:

* [WebHCat Configuration -- Configuration Variables | https://cwiki.apache.org/confluence/display/Hive/WebHCat+Configure#WebHCatConfigure-ConfigurationVariables]

Thanks for doing the doc, [~aihuaxu]., [~aihuaxu]
That response in stackoverlow is flawed/doesn't answer the question in that post.
I agree that XSRF and click jacking are different issues. But if you add this requirement of a custom header (X-XSRF-Header ) that HIVE-13853 does, you can't use click jacking either. Any requests via click jacking also won't have that custom header.
, What this patch enables is to avoid click jacking without preventing the HTTP api use in UI.
ie, the change in this patch can be useful for such use cases., This jira is resolved and released with Hive 3.0 If you find an issue with it, please create a new jira.]