[I attached a patch that makes Hive to use Derby 10.9.1.0, which is the latest official release in March 29, 2013. ( http://db.apache.org/derby/derby_downloads.html ), If you get "java.lang.SecurityException: sealing violation" message, please remove derby-10.4.2.0.jar file from your target directories. (build/ivy/lib/default/, build/ivy/lib/compile/, build/ivy/lib/test/), +1 running tests., Review request at https://reviews.apache.org/r/10215, Thank you for your review, [~ashutoshc]., running test, Build failed with various exceptions,
{noformat}
    [junit] Caused by: java.lang.RuntimeException: Unable to instantiate org.apache.hadoop.hive.metastore.HiveMetaStoreClient
    [junit]     at org.apache.hadoop.hive.metastore.MetaStoreUtils.newInstance(MetaStoreUtils.java:1212)
    [junit]     at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.<init>(RetryingMetaStoreClient.java:51)
    [junit]     at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.getProxy(RetryingMetaStoreClient.java:61)
    [junit]     at org.apache.hadoop.hive.ql.metadata.Hive.createMetaStoreClient(Hive.java:2286)
    [junit]     at org.apache.hadoop.hive.ql.metadata.Hive.getMSC(Hive.java:2297)
    [junit]     at org.apache.hadoop.hive.ql.metadata.Hive.dropTable(Hive.java:868)
    [junit]     ... 8 more
    [junit] Caused by: java.lang.reflect.InvocationTargetException
    [junit]     at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
    [junit]     at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
    [junit]     at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
    [junit]     at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
    [junit]     at org.apache.hadoop.hive.metastore.MetaStoreUtils.newInstance(MetaStoreUtils.java:1210)
    [junit]     ... 13 more
    [junit] Caused by: javax.jdo.JDOFatalInternalException: Error creating transactional connection factory
    [junit] NestedThrowables:
    [junit] java.lang.reflect.InvocationTargetException
    [junit]     at org.datanucleus.jdo.NucleusJDOHelper.getJDOExceptionForNucleusException(NucleusJDOHelper.java:425)
    [junit]     at org.datanucleus.jdo.JDOPersistenceManagerFactory.freezeConfiguration(JDOPersistenceManagerFactory.java:601)
    [junit]     at org.datanucleus.jdo.JDOPersistenceManagerFactory.createPersistenceManagerFactory(JDOPersistenceManagerFactory.java:286)
    [junit]     at org.datanucleus.jdo.JDOPersistenceManagerFactory.getPersistenceManagerFactory(JDOPersistenceManagerFactory.java:182)
    [junit]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    [junit]     at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    [junit]     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    [junit]     at java.lang.reflect.Method.invoke(Method.java:597)
    [junit]     at javax.jdo.JDOHelper$16.run(JDOHelper.java:1958)
    [junit]     at java.security.AccessController.doPrivileged(Native Method)
    [junit]     at javax.jdo.JDOHelper.invoke(JDOHelper.java:1953)
    [junit]     at javax.jdo.JDOHelper.invokeGetPersistenceManagerFactoryOnImplementation(JDOHelper.java:1159)
    [junit]     at javax.jdo.JDOHelper.getPersistenceManagerFactory(JDOHelper.java:803)
    [junit]     at javax.jdo.JDOHelper.getPersistenceManagerFactory(JDOHelper.java:698)
    [junit]     at org.apache.hadoop.hive.metastore.ObjectStore.getPMF(ObjectStore.java:263)
    [junit]     at org.apache.hadoop.hive.metastore.ObjectStore.getPersistenceManager(ObjectStore.java:292)
    [junit]     at org.apache.hadoop.hive.metastore.ObjectStore.initialize(ObjectStore.java:225)
    [junit]     at org.apache.hadoop.hive.metastore.ObjectStore.setConf(ObjectStore.java:200)
    [junit]     at org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:62)
    [junit]     at org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:117)
    [junit]     at org.apache.hadoop.hive.metastore.RetryingRawStore.<init>(RetryingRawStore.java:62)
    [junit]     at org.apache.hadoop.hive.metastore.RetryingRawStore.getProxy(RetryingRawStore.java:71)
    [junit]     at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.newRawStore(HiveMetaStore.java:414)
    [junit]     at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.getMS(HiveMetaStore.java:402)
    [junit]     at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.createDefaultDB(HiveMetaStore.java:440)
    [junit]     at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.init(HiveMetaStore.java:326)
    [junit]     at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.<init>(HiveMetaStore.java:286)
    [junit]     at org.apache.hadoop.hive.metastore.RetryingHMSHandler.<init>(RetryingHMSHandler.java:53)
    [junit]     at org.apache.hadoop.hive.metastore.RetryingHMSHandler.getProxy(RetryingHMSHandler.java:58)
    [junit]     at org.apache.hadoop.hive.metastore.HiveMetaStore.newHMSHandler(HiveMetaStore.java:4183)
    [junit]     at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.<init>(HiveMetaStoreClient.java:121)
    [junit]     ... 18 more
    [junit] Caused by: java.lang.reflect.InvocationTargetException
    [junit]     at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
    [junit]     at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
    [junit]     at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
    [junit]     at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
    [junit]     at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
    [junit]     at org.datanucleus.plugin.NonManagedPluginRegistry.createExecutableExtension(NonManagedPluginRegistry.java:588)
    [junit]     at org.datanucleus.plugin.PluginManager.createExecutableExtension(PluginManager.java:324)
    [junit]     at org.datanucleus.store.AbstractStoreManager.registerConnectionFactory(AbstractStoreManager.java:215)
    [junit]     at org.datanucleus.store.AbstractStoreManager.<init>(AbstractStoreManager.java:190)
    [junit]     at org.datanucleus.store.mapped.MappedStoreManager.<init>(MappedStoreManager.java:137)
    [junit]     at org.datanucleus.store.rdbms.RDBMSStoreManager.<init>(RDBMSStoreManager.java:253)
    [junit]     at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
    [junit]     at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
    [junit]     at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
    [junit]     at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
    [junit]     at org.datanucleus.plugin.NonManagedPluginRegistry.createExecutableExtension(NonManagedPluginRegistry.java:588)
    [junit]     at org.datanucleus.plugin.PluginManager.createExecutableExtension(PluginManager.java:300)
    [junit]     at org.datanucleus.ObjectManagerFactoryImpl.initialiseStoreManager(ObjectManagerFactoryImpl.java:161)
    [junit]     at org.datanucleus.jdo.JDOPersistenceManagerFactory.freezeConfiguration(JDOPersistenceManagerFactory.java:583)
    [junit]     ... 47 more
    [junit] Caused by: java.lang.ExceptionInInitializerError
    [junit]     at java.lang.Class.forName0(Native Method)
    [junit]     at java.lang.Class.forName(Class.java:171)
    [junit]     at org.datanucleus.store.rdbms.datasource.dbcp.DBCPDataSourceFactory.makePooledDataSource(DBCPDataSourceFactory.java:69)
    [junit]     at org.datanucleus.store.rdbms.ConnectionFactoryImpl.initDataSourceTx(ConnectionFactoryImpl.java:144)
    [junit]     at org.datanucleus.store.rdbms.ConnectionFactoryImpl.<init>(ConnectionFactoryImpl.java:84)
    [junit]     ... 65 more
    [junit] Caused by: java.lang.SecurityException: sealing violation: package org.apache.derby.impl.jdbc.authentication is sealed
    [junit]     at java.net.URLClassLoader.defineClass(URLClassLoader.java:234)
    [junit]     at java.net.URLClassLoader.access$000(URLClassLoader.java:58)
    [junit]     at java.net.URLClassLoader$1.run(URLClassLoader.java:197)
    [junit]     at java.security.AccessController.doPrivileged(Native Method)
    [junit]     at java.net.URLClassLoader.findClass(URLClassLoader.java:190)
    [junit]     at java.lang.ClassLoader.loadClass(ClassLoader.java:306)
    [junit]     at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301)
    [junit]     at java.lang.ClassLoader.loadClass(ClassLoader.java:247)
    [junit]     at java.lang.Class.forName0(Native Method)
    [junit]     at java.lang.Class.forName(Class.java:171)
    [junit]     at org.apache.derby.impl.services.monitor.BaseMonitor.getImplementations(Unknown Source)
    [junit]     at org.apache.derby.impl.services.monitor.BaseMonitor.getDefaultImplementations(Unknown Source)
    [junit]     at org.apache.derby.impl.services.monitor.BaseMonitor.runWithState(Unknown Source)
    [junit]     at org.apache.derby.impl.services.monitor.FileMonitor.<init>(Unknown Source)
    [junit]     at org.apache.derby.iapi.services.monitor.Monitor.startMonitor(Unknown Source)
    [junit]     at org.apache.derby.iapi.jdbc.JDBCBoot.boot(Unknown Source)
    [junit]     at org.apache.derby.jdbc.EmbeddedDriver.boot(Unknown Source)
    [junit]     at org.apache.derby.jdbc.EmbeddedDriver.<clinit>(Unknown Source)
    [junit]     ... 70 more
    [junit] Test org.apache.hadoop.hive.cli.TestCliDriver FAILED
{noformat}, [~teddy.choi] Would you like to rebase this patch on trunk? Lets have Hive QA run on this., Recent release of Derby is 10.10.1.1. Let's try with that., 

{color:green}Overall{color}: +1 all checks pass

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12620794/HIVE-4257.2.patch.txt

{color:green}SUCCESS:{color} +1 4818 tests passed

Test results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/768/testReport
Console output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/768/console

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12620794, +1
, Committed to trunk. Thanks for tracking this issue Teddy!]