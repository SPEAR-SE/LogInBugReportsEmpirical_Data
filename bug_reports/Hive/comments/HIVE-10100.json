[I committed an addendum patch for HADOOP-11257 to redirect this warning to stderr so that it won't get misinterpreted as part of Hive query results., Thank you [~cnauroth]! Lowering priority. Will keep open to switch from "hadoop jar" to "yarn jar" to get rid of the warning over time., [~gopalv]/[~sseth] Can someone please review this patch?, {code}if [ "$USE_YARN_LAUNCHER" = true ] ; then{code}
Why is this snippet used in some files, but not others ?

{code}export YARN_USER_CLASSPATH_FIRST="$HADOOP_USER_CLASSPATH_FIRST"{code}
Along with this, we also need to handle YARN_CLASSPATH.
Both YARN_CLASSPATH and HADOOP_CLASSPATH can be set at the same time. How do we order them ?
For HADOOP_CLASSPATH_FIRST and YARN_CLASSPATH_FIRST - should we use the value set in HADOOP_CLASSPATH_FIRST or the one used in YARN_CLASSPATH_FIRST ?

Out of scope here, but wonder if there's a simpler (and faster) way to launch commands - instead of RunJar. The CLI, and other commands are quite slow to start up at the moment., bq. Why is this snippet used in some files, but not others ?

Some scripts explicitly modifies the variables after hive script sets it up to append service specific info. Example: beeline seems to be doing some ordering of classpath and metastore appends its own java opts which might not be required otherwise.

I can't find YARN_CLASSPATH in yarn script. I think after some version YARN_CLASSPATH is renamed to YARN_USER_CLASSPATH. So I added HADOOP_CLASSPATH to YARN_USER_CLASSPATH in the next patch.

Yes. Hive script is slow for 2 reasons
1) Automatic initialization of logging (when trying to run hadoop or hbase commands entire classpath is searched to look for log4j2.properties file)
2) hbase mapredcp takes time

There is some info here HIVE-12497. Regardless we should bring down the time., bq.For HADOOP_CLASSPATH_FIRST and YARN_CLASSPATH_FIRST - should we use the value set in HADOOP_CLASSPATH_FIRST or the one used in YARN_CLASSPATH_FIRST ?

I think we need this to be always true for proper initialization of log4j2 and jline., YARN_USER_CLASSPATH needs to be set in a couple more scripts - beeline, hplsql, hwi.
Other than that, looks good to me.

Don't really know why hadoop jar was deprecated in favor of yarn jar, and what the difference between the two is. , [~prasanth_j] there's other places we use "hadoop jar". We use it in local tasks and map joins etc. See yarn_bin.patch. I haven't tested the changes, but seems to me we should change that too, no?, hadoop jar from within Java code (instead of using the programatic API) ? - I'm sure there's a good reason to do this :), Why is this critical? - due to the confusion caused by the error message printed.
It may be worth asking for a way to suppress this specific message rather than trying to change Hive code all over the place.

'yarn jar metastore' <- what does this mean ?, [~sseth] we can ask, but the warning  has been around for a long time. My guess eventually the idea is to get rid of it. So might as well change these places., [~hagleitn] Thanks for the patch. Incorporated your changes into the new patch.

Addressed [~sseth]'s comments as well.

Also made 2 minors changes
1) hive-log4j2.properties seems to have be repeated in HADOOP_CLIENT_OPTS. Removed the duplicate.
2) When running beeline hive-log4j2.properties file will be replaced with beeline-log4j2.properties (earlier it will just append to env).

[~sseth] Can you plz take another look?, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12815803/HIVE-10100.3.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 28 failed/errored test(s), 10287 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter_merge_stats_orc
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_archive_excludeHadoop20
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_auto_sortmerge_join_8
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_fetch_aggregation
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_nonmr_fetch
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_orc_analyze
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_sample10
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_sample_islocalmode_hook
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_sample_islocalmode_hook_use_metadata
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_vectorized_parquet
org.apache.hadoop.hive.cli.TestContribCliDriver.testCliDriver_dboutput
org.apache.hadoop.hive.cli.TestContribNegativeCliDriver.testNegativeCliDriver_case_with_row_sequence
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_tez_join_hash
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_all
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_join
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_tez_join_hash
org.apache.hadoop.hive.ql.TestMTQueries.testMTQueries1
org.apache.hadoop.hive.ql.exec.TestExecDriver.testMapPlan1
org.apache.hadoop.hive.ql.exec.TestExecDriver.testMapPlan2
org.apache.hadoop.hive.ql.exec.TestExecDriver.testMapRedPlan1
org.apache.hadoop.hive.ql.exec.TestExecDriver.testMapRedPlan2
org.apache.hadoop.hive.ql.exec.TestExecDriver.testMapRedPlan3
org.apache.hadoop.hive.ql.exec.TestExecDriver.testMapRedPlan4
org.apache.hadoop.hive.ql.exec.TestExecDriver.testMapRedPlan5
org.apache.hadoop.hive.ql.exec.TestExecDriver.testMapRedPlan6
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/349/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/349/console
Test logs: http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-349/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 28 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12815803 - PreCommit-HIVE-MASTER-Build, The test failures look related. I will look at it shortly. ]