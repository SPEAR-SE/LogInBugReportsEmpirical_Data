[Is it the case that you get different results in different runs? Can you post output of explain when you get wrong results?, it always gives wrong result. , Can you add explain output?, hive> explain INSERT INTO TABLE test SELECT * from src UNION ALL SELECT * from src;
OK
Plan not optimized by CBO.

Vertex dependency in root stage
Map 1 <- Union 2 (CONTAINS)
Map 3 <- Union 2 (CONTAINS)

Stage-4
   Stats-Aggr Operator
      Stage-0
         Move Operator
            table:{"serde:":"org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe","name:":"jluo.test","input format:":"org.apache.hadoop.mapred.TextInputFormat","output format:":"org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat"}
            Stage-2
               Dependency Collection{}
                  Stage-1
                     Union 2
                     |<-Map 1 [CONTAINS]
                     |  File Output Operator [FS_6]
                     |     compressed:false
                     |     Statistics:Num rows: 2 Data size: 2 Basic stats: COMPLETE Column stats: NONE
                     |     table:{"serde:":"org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe","name:":"jluo.test","input format:":"org.apache.hadoop.mapred.TextInputFormat","output format:":"org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat"}
                     |     Select Operator [SEL_1]
                     |        outputColumnNames:["_col0"]
                     |        Statistics:Num rows: 1 Data size: 1 Basic stats: COMPLETE Column stats: NONE
                     |        TableScan [TS_0]
                     |           alias:src
                     |           Statistics:Num rows: 1 Data size: 1 Basic stats: COMPLETE Column stats: NONE
                     |<-Map 3 [CONTAINS]
                        File Output Operator [FS_6]
                           compressed:false
                           Statistics:Num rows: 2 Data size: 2 Basic stats: COMPLETE Column stats: NONE
                           table:{"serde:":"org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe","name:":"jluo.test","input format:":"org.apache.hadoop.mapred.TextInputFormat","output format:":"org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat"}
                           Select Operator [SEL_3]
                              outputColumnNames:["_col0"]
                              Statistics:Num rows: 1 Data size: 1 Basic stats: COMPLETE Column stats: NONE
                              TableScan [TS_2]
                                 alias:src
                                 Statistics:Num rows: 1 Data size: 1 Basic stats: COMPLETE Column stats: NONE
Stage-3
   Stats-Aggr Operator
       Please refer to the previous Stage-0

Time taken: 0.088 seconds, Fetched: 41 row(s)

hive> explain SELECT count(*)  FROM test;
OK
Plan not optimized by CBO.

Stage-0
   Fetch Operator
      limit:1

Time taken: 0.037 seconds, Fetched: 6 row(s)
, forgot to mention I was using TEZ on Hive. , StatsOptimizer is throwing query off. Try turning it off:
{code}
set hive.compute.query.using.stats=false;
{code}, turning stats off gives correct result. So it is a bug in StatsOptimizer?

On Thu, May 26, 2016 at 11:04 AM, Ashutosh Chauhan (JIRA) <jira@apache.org>

, yes. There are lots of improvements to address this issue:  HIVE-13334]