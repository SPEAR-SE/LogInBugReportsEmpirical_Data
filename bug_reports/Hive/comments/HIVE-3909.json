[navis requested code review of "HIVE-3909 [jira] Wrong data due to HIVE-2820".
Reviewers: JIRA

  Consider the query:

  ~/hive/hive1$ more ql/src/test/queries/clientpositive/join_reorder4.q
  CREATE TABLE T1(key1 STRING, val1 STRING) STORED AS TEXTFILE;
  CREATE TABLE T2(key2 STRING, val2 STRING) STORED AS TEXTFILE;
  CREATE TABLE T3(key3 STRING, val3 STRING) STORED AS TEXTFILE;

  LOAD DATA LOCAL INPATH '../data/files/T1.txt' INTO TABLE T1;
  LOAD DATA LOCAL INPATH '../data/files/T2.txt' INTO TABLE T2;
  LOAD DATA LOCAL INPATH '../data/files/T3.txt' INTO TABLE T3;

  set hive.auto.convert.join=true;

  explain select /+ STREAMTABLE(a) */ a., b., c. from T1 a join T2 b on a.key1=b.key2 join T3 c on a.key1=c.key3;
  select /+ STREAMTABLE(a) */ a., b., c. from T1 a join T2 b on a.key1=b.key2 join T3 c on a.key1=c.key3;

  explain select /+ STREAMTABLE(b) */ a., b., c. from T1 a join T2 b on a.key1=b.key2 join T3 c on a.key1=c.key3;
  select /+ STREAMTABLE(b) */ a., b., c. from T1 a join T2 b on a.key1=b.key2 join T3 c on a.key1=c.key3;

  explain select /+ STREAMTABLE(c) */ a., b., c. from T1 a join T2 b on a.key1=b.key2 join T3 c on a.key1=c.key3;
  select /+ STREAMTABLE(c) */ a., b., c. from T1 a join T2 b on a.key1=b.key2 join T3 c on a.key1=c.key3;

  select /+ STREAMTABLE(b) */ a., b., c. from T1 a join T2 b on a.key1=b.key2 join T3 c on a.key1=c.key3;

  returns:
  2	12	2	12	2	22

TEST PLAN
  EMPTY

REVISION DETAIL
  https://reviews.facebook.net/D8013

AFFECTED FILES
  ql/src/java/org/apache/hadoop/hive/ql/exec/AbstractMapJoinOperator.java
  ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java
  ql/src/java/org/apache/hadoop/hive/ql/exec/ConditionalTask.java
  ql/src/java/org/apache/hadoop/hive/ql/exec/MapJoinOperator.java
  ql/src/java/org/apache/hadoop/hive/ql/exec/SMBMapJoinOperator.java
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/LocalMapJoinProcFactory.java
  ql/src/java/org/apache/hadoop/hive/ql/plan/JoinDesc.java
  ql/src/test/queries/clientpositive/join_reorder4.q
  ql/src/test/results/clientpositive/join_reorder4.q.out

MANAGE HERALD DIFFERENTIAL RULES
  https://reviews.facebook.net/herald/view/differential/

WHY DID I GET THIS EMAIL?
  https://reviews.facebook.net/herald/transcript/19341/

To: JIRA, navis
, navis has commented on the revision "HIVE-3909 [jira] Wrong data due to HIVE-2820".

  Removed all of the confusing order mapping from mapjoins.

REVISION DETAIL
  https://reviews.facebook.net/D8013

To: JIRA, navis
, njain has accepted the revision "HIVE-3909 [jira] Wrong data due to HIVE-2820".

REVISION DETAIL
  https://reviews.facebook.net/D8013

BRANCH
  DPAL-1965

To: JIRA, njain, navis
, Committed. Thanks Navis, Integrated in hive-trunk-hadoop1 #25 (See [https://builds.apache.org/job/hive-trunk-hadoop1/25/])
    HIVE-3909 Wrong data due to HIVE-2820
(Navis via namit) (Revision 1435281)

     Result = ABORTED
namit : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1435281
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/AbstractMapJoinOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ConditionalTask.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MapJoinOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/SMBMapJoinOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/LocalMapJoinProcFactory.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/JoinDesc.java
* /hive/trunk/ql/src/test/queries/clientpositive/join_reorder4.q
* /hive/trunk/ql/src/test/results/clientpositive/join_reorder4.q.out
, Integrated in Hive-trunk-hadoop2 #73 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/73/])
    HIVE-3909 Wrong data due to HIVE-2820
(Navis via namit) (Revision 1435281)

     Result = FAILURE
namit : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1435281
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/AbstractMapJoinOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ConditionalTask.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MapJoinOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/SMBMapJoinOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/LocalMapJoinProcFactory.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/JoinDesc.java
* /hive/trunk/ql/src/test/queries/clientpositive/join_reorder4.q
* /hive/trunk/ql/src/test/results/clientpositive/join_reorder4.q.out
, Integrated in Hive-trunk-h0.21 #1922 (See [https://builds.apache.org/job/Hive-trunk-h0.21/1922/])
    HIVE-3909 Wrong data due to HIVE-2820
(Navis via namit) (Revision 1435281)

     Result = FAILURE
namit : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1435281
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/AbstractMapJoinOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ConditionalTask.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MapJoinOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/SMBMapJoinOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/LocalMapJoinProcFactory.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/JoinDesc.java
* /hive/trunk/ql/src/test/queries/clientpositive/join_reorder4.q
* /hive/trunk/ql/src/test/results/clientpositive/join_reorder4.q.out
]