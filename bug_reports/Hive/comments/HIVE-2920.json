[I have seen intermittent failures in TestStatsPublisherEnhanced with the following stack:

{noformat}
java.lang.NullPointerException
	at org.apache.hadoop.hive.ql.exec.Utilities.prepareWithRetry(Utilities.java:2176)
	at org.apache.hadoop.hive.ql.stats.jdbc.JDBCStatsAggregator.cleanUp(JDBCStatsAggregator.java:215)
	at org.apache.hadoop.hive.ql.exec.TestStatsPublisherEnhanced.setUp(TestStatsPublisherEnhanced.java:60)
	at junit.framework.TestCase.runBare(TestCase.java:132)
	at junit.framework.TestResult$1.protect(TestResult.java:110)
	at junit.framework.TestResult.runProtected(TestResult.java:128)
	at junit.framework.TestResult.run(TestResult.java:113)
	at junit.framework.TestCase.run(TestCase.java:124)
	at junit.framework.TestSuite.runTest(TestSuite.java:243)
	at junit.framework.TestSuite.run(TestSuite.java:238)
	at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83)
	at junit.framework.JUnit4TestAdapter.run(JUnit4TestAdapter.java:39)
	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:420)
	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:911)
	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:768)
{noformat}, cwsteinbach requested code review of "HIVE-2920 [jira] TestStatsPublisherEnhanced throws NPE on JDBC connection failure".
Reviewers: JIRA

  HIVE-2920. TestStatsPublisherEnhanced throws NPE on JDBC connection failure

TEST PLAN
  NONE

REVISION DETAIL
  https://reviews.facebook.net/D2577

AFFECTED FILES
  ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisherEnhanced.java

MANAGE HERALD DIFFERENTIAL RULES
  https://reviews.facebook.net/herald/view/differential/

WHY DID I GET THIS EMAIL?
  https://reviews.facebook.net/herald/transcript/5847/

Tip: use the X-Herald-Rules header to filter Herald messages in your client.
, This patch moves the StatsAggregator cleanup code from the setUp() method to the tearDown() method in order to insure that it gets called *after* StatsPublisher.init() (which creates some tables that StatsAggregator.connect() depends on). I also added some assert statements to the tearDown() code., zhenxiao has commented on the revision "HIVE-2920 [jira] TestStatsPublisherEnhanced throws NPE on JDBC connection failure".

  + 1

REVISION DETAIL
  https://reviews.facebook.net/D2577
, Committed to trunk. Thanks, Carl!, Integrated in Hive-trunk-h0.21 #1349 (See [https://builds.apache.org/job/Hive-trunk-h0.21/1349/])
    HIVE-2920 : TestStatsPublisherEnhanced throws NPE on JDBC connection failure (Carl Steinbach via Ashutosh Chauhan) (Revision 1308731)

     Result = SUCCESS
hashutosh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1308731
Files : 
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisherEnhanced.java
, This issue is closed now. It was released with the fix in 0.9.0. If there is a problem, please open a new jira and link this one with that., Integrated in Hive-trunk-hadoop2 #54 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/54/])
    HIVE-2920 : TestStatsPublisherEnhanced throws NPE on JDBC connection failure (Carl Steinbach via Ashutosh Chauhan) (Revision 1308731)

     Result = ABORTED
hashutosh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1308731
Files : 
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TestStatsPublisherEnhanced.java
]