[[~spena], thanks for working on this. I'm wondering if you mind giving some description of the problem and your proposed solution. It helps others understand w/o going to the code change. Thanks., When doing the merge of the two {{MoveTasks}} we should probably assert that the destination of the first {{MoveTask}} = the source of the second {{MoveTask}}. If not then the optimization should be dropped. Looking at the code, we should never hit a case where this condition returns false, but it would make the code safer., Sorry. The issue is happening only on S3 due to HIVE-15114.

I will update the description and add a comment about the solution., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12841786/HIVE-15361.1.patch

{color:green}SUCCESS:{color} +1 due to 5 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 177 failed/errored test(s), 10762 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestAccumuloCliDriver.testCliDriver[accumulo_single_sourced_multi_insert] (batchId=216)
org.apache.hadoop.hive.cli.TestCliDriver.org.apache.hadoop.hive.cli.TestCliDriver (batchId=50)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[annotate_stats_table] (batchId=19)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[autoColumnStats_5] (batchId=37)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[autoColumnStats_6] (batchId=59)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[binary_output_format] (batchId=78)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[bucketmapjoin5] (batchId=76)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[bucketmapjoin_negative2] (batchId=62)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[bucketmapjoin_negative] (batchId=21)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[case_sensitivity] (batchId=61)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cast1] (batchId=68)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[constprog_dp] (batchId=17)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[constprog_type] (batchId=1)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ctas_colname] (batchId=53)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ctas_uses_database_location] (batchId=31)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cte_3] (batchId=31)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cte_mat_3] (batchId=22)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cte_mat_4] (batchId=5)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cte_mat_5] (batchId=2)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[dynamic_rdd_cache] (batchId=49)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[explain_ddl] (batchId=43)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[groupby_sort_1_23] (batchId=71)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[groupby_sort_3] (batchId=73)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[groupby_sort_5] (batchId=41)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[groupby_sort_7] (batchId=69)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[groupby_sort_skew_1_23] (batchId=8)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[groupby_sort_test_1] (batchId=7)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[index_auto] (batchId=41)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[index_auto_file_format] (batchId=50)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[index_auto_mult_tables_compact] (batchId=32)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[index_auto_multiple] (batchId=31)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[index_auto_partitioned] (batchId=10)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[index_auto_update] (batchId=67)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[index_compression] (batchId=9)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[index_serde] (batchId=15)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[index_skewtable] (batchId=73)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input11] (batchId=49)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input12] (batchId=68)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input13] (batchId=68)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input34] (batchId=17)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input35] (batchId=53)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input36] (batchId=13)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input38] (batchId=12)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input6] (batchId=80)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input7] (batchId=67)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input8] (batchId=8)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input9] (batchId=54)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input_dynamicserde] (batchId=78)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input_part1] (batchId=7)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input_part2] (batchId=43)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input_part5] (batchId=35)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input_testsequencefile] (batchId=78)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input_testxpath2] (batchId=34)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input_testxpath] (batchId=28)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert1] (batchId=22)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_into1] (batchId=20)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_into4] (batchId=16)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_into5] (batchId=29)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_into6] (batchId=65)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[join25] (batchId=5)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[join26] (batchId=17)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[join27] (batchId=37)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[join36] (batchId=78)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[join37] (batchId=53)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[join39] (batchId=48)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[join_map_ppr] (batchId=68)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[lineage1] (batchId=51)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[list_bucket_dml_4] (batchId=14)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[list_bucket_dml_6] (batchId=29)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[list_bucket_dml_7] (batchId=49)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[list_bucket_dml_9] (batchId=75)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[load_dyn_part14] (batchId=80)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[load_dyn_part1] (batchId=75)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[merge1] (batchId=50)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[merge2] (batchId=2)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[merge3] (batchId=53)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[merge4] (batchId=11)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[merge_dynamic_partition2] (batchId=15)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[merge_dynamic_partition3] (batchId=63)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[merge_dynamic_partition4] (batchId=31)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[merge_dynamic_partition5] (batchId=30)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[merge_dynamic_partition] (batchId=38)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[multi_insert_move_tasks_share_dependencies] (batchId=50)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[nullformatCTAS] (batchId=36)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[orc_createas1] (batchId=78)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[orc_merge10] (batchId=58)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[orc_merge1] (batchId=18)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[orc_merge2] (batchId=80)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[orc_merge3] (batchId=25)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[orc_merge4] (batchId=59)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[orc_merge5] (batchId=51)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[orc_merge6] (batchId=31)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[orc_merge_diff_fs] (batchId=1)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[pcr] (batchId=54)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ppd_constant_expr] (batchId=52)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[quote1] (batchId=22)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[rand_partitionpruner2] (batchId=49)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample1] (batchId=12)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample2] (batchId=5)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample4] (batchId=15)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample5] (batchId=51)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample6] (batchId=61)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample7] (batchId=60)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample9] (batchId=38)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[smb_mapjoin9] (batchId=37)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[smb_mapjoin_7] (batchId=52)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[special_character_in_tabnames_2] (batchId=48)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[stats0] (batchId=51)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[stats4] (batchId=72)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[stats_empty_dyn_part] (batchId=30)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[subq] (batchId=40)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[subquery_alias] (batchId=22)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udf1] (batchId=76)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udf_10_trims] (batchId=63)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udf_length] (batchId=31)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udf_reverse] (batchId=79)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union10] (batchId=10)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union12] (batchId=5)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union18] (batchId=15)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union28] (batchId=40)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union29] (batchId=50)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union30] (batchId=70)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union33] (batchId=23)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union4] (batchId=67)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union6] (batchId=28)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union] (batchId=4)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_remove_10] (batchId=22)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_remove_11] (batchId=18)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_remove_12] (batchId=39)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_remove_13] (batchId=78)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_remove_14] (batchId=12)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_remove_16] (batchId=66)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_remove_4] (batchId=7)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_remove_5] (batchId=55)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_remove_9] (batchId=65)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_stats] (batchId=21)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_char_4] (batchId=80)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_multi_insert] (batchId=78)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_tablesample_rows] (batchId=46)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_varchar_4] (batchId=27)
org.apache.hadoop.hive.cli.TestContribCliDriver.testCliDriver[serde_typedbytes2] (batchId=219)
org.apache.hadoop.hive.cli.TestContribCliDriver.testCliDriver[serde_typedbytes3] (batchId=219)
org.apache.hadoop.hive.cli.TestContribCliDriver.testCliDriver[serde_typedbytes5] (batchId=219)
org.apache.hadoop.hive.cli.TestContribCliDriver.testCliDriver[serde_typedbytes] (batchId=219)
org.apache.hadoop.hive.cli.TestHBaseCliDriver.testCliDriver[hbase_single_sourced_multi_insert] (batchId=89)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[bucket5] (batchId=135)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[orc_merge10] (batchId=135)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[orc_merge1] (batchId=132)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[orc_merge_diff_fs] (batchId=132)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=134)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[orc_merge5] (batchId=147)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[orc_merge6] (batchId=143)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[orc_merge7] (batchId=152)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[orc_merge1] (batchId=157)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[orc_merge2] (batchId=159)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[orc_merge3] (batchId=157)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[orc_merge4] (batchId=158)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[orc_merge5] (batchId=158)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[orc_merge6] (batchId=157)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[orc_merge7] (batchId=159)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[orc_merge_diff_fs] (batchId=157)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_1] (batchId=91)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_3] (batchId=91)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainuser_3] (batchId=91)
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver[infer_bucket_sort_dyn_part] (batchId=82)
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver[infer_bucket_sort_map_operators] (batchId=82)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[merge1] (batchId=116)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[merge2] (batchId=93)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[union_remove_10] (batchId=103)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[union_remove_11] (batchId=101)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[union_remove_12] (batchId=111)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[union_remove_13] (batchId=130)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[union_remove_14] (batchId=98)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[union_remove_16] (batchId=124)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[union_remove_4] (batchId=97)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[union_remove_5] (batchId=118)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[union_remove_9] (batchId=124)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/2419/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/2419/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2419/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 177 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12841786 - PreCommit-HIVE-Build, Could you please post results of tests from itests/hive-blobstore package?, Attaching a link to the RB., What results do you need? I attached the RB link, and mentioned all tests run successfully. The patch contains some updates on them btw. 

I also added a couple of new tests:
- insert_into_dynamic_partitions.q
- insert_overwrite_dynamic_partitions.q, Thank you! I'll take a look., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12841820/HIVE-15361.2.patch

{color:green}SUCCESS:{color} +1 due to 5 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 9 failed/errored test(s), 10768 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample2] (batchId=5)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample4] (batchId=15)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample6] (batchId=61)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample7] (batchId=60)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample9] (batchId=38)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[orc_ppd_schema_evol_3a] (batchId=134)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=134)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[stats_based_fetch_decision] (batchId=150)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=92)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/2427/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/2427/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2427/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 9 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12841820 - PreCommit-HIVE-Build, Addressed Illya comments from RB., The latest update to CR looks good to me., [~xuefuz] [~mohitsabharwal] Would you help me review this patch? It was reviewed already by [~yalovyyi], I just need your approval to commit it (after tests pass)., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12842019/HIVE-15361.3.patch

{color:red}ERROR:{color} -1 due to build exiting with an error

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/2451/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/2451/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2451/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Tests exited with: NonZeroExitCodeException
Command 'bash /data/hiveptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ date '+%Y-%m-%d %T.%3N'
2016-12-06 22:37:48.770
+ [[ -n /usr/lib/jvm/java-8-openjdk-amd64 ]]
+ export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ export PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m '
+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m '
+ export 'MAVEN_OPTS=-Xmx1g '
+ MAVEN_OPTS='-Xmx1g '
+ cd /data/hiveptest/working/
+ tee /data/hiveptest/logs/PreCommit-HIVE-Build-2451/source-prep.txt
+ [[ false == \t\r\u\e ]]
+ mkdir -p maven ivy
+ [[ git = \s\v\n ]]
+ [[ git = \g\i\t ]]
+ [[ -z master ]]
+ [[ -d apache-github-source-source ]]
+ [[ ! -d apache-github-source-source/.git ]]
+ [[ ! -d apache-github-source-source ]]
+ date '+%Y-%m-%d %T.%3N'
2016-12-06 22:37:48.773
+ cd apache-github-source-source
+ git fetch origin
From https://github.com/apache/hive
   f317d73..c42bb86  master     -> origin/master
+ git reset --hard HEAD
HEAD is now at f317d73 HIVE-15363: Execute hive-blobstore tests using ProxyLocalFileSystem (Sergio Pena, reviewed by Mohit Sabharwal)
+ git clean -f -d
+ git checkout master
Already on 'master'
Your branch is behind 'origin/master' by 1 commit, and can be fast-forwarded.
  (use "git pull" to update your local branch)
+ git reset --hard origin/master
HEAD is now at c42bb86 HIVE-15341: Get work path instead of attempted task path in HiveHFileOutputFormat (Chaoyu Tang, reviewed by Mohit Sabharwal)
+ git merge --ff-only origin/master
Already up-to-date.
+ date '+%Y-%m-%d %T.%3N'
2016-12-06 22:37:50.085
+ patchCommandPath=/data/hiveptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hiveptest/working/scratch/build.patch
+ [[ -f /data/hiveptest/working/scratch/build.patch ]]
+ chmod +x /data/hiveptest/working/scratch/smart-apply-patch.sh
+ /data/hiveptest/working/scratch/smart-apply-patch.sh /data/hiveptest/working/scratch/build.patch
error: a/itests/hive-blobstore/src/test/queries/clientpositive/insert_into_table.q: No such file or directory
error: a/itests/hive-blobstore/src/test/queries/clientpositive/insert_overwrite_table.q: No such file or directory
error: a/itests/hive-blobstore/src/test/results/clientpositive/insert_into_table.q.out: No such file or directory
error: a/itests/hive-blobstore/src/test/results/clientpositive/insert_overwrite_directory.q.out: No such file or directory
error: a/itests/hive-blobstore/src/test/results/clientpositive/insert_overwrite_table.q.out: No such file or directory
error: a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java: No such file or directory
error: a/ql/src/java/org/apache/hadoop/hive/ql/plan/LoadDesc.java: No such file or directory
error: a/ql/src/java/org/apache/hadoop/hive/ql/plan/LoadFileDesc.java: No such file or directory
error: a/ql/src/java/org/apache/hadoop/hive/ql/plan/LoadTableDesc.java: No such file or directory
error: a/ql/src/java/org/apache/hadoop/hive/ql/plan/MoveWork.java: No such file or directory
error: a/ql/src/test/org/apache/hadoop/hive/ql/optimizer/TestGenMapRedUtilsCreateConditionalTask.java: No such file or directory
The patch does not appear to apply with p0, p1, or p2
+ exit 1
'
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12842019 - PreCommit-HIVE-Build, Attaching rebased patch., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12842044/HIVE-15361.4.patch

{color:green}SUCCESS:{color} +1 due to 5 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 9 failed/errored test(s), 10781 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_sortmerge_join_2] (batchId=44)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[dbtxnmgr_showlocks] (batchId=71)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample2] (batchId=5)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample4] (batchId=15)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample6] (batchId=61)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample7] (batchId=60)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample9] (batchId=38)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=134)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[stats_based_fetch_decision] (batchId=150)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/2457/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/2457/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2457/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 9 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12842044 - PreCommit-HIVE-Build, Attaching this file that removes this code was left unnecessary. 

    try {
      Hive hive = Hive.get(conf);
    } catch (HiveException e) {
    }

No tests need to run again., LGTM, +1, Thanks [~yalovyyi] [~mohitsabharwal] for the review. I committed to master.]