[[~daijy], it seems HIVE-19161 broke the integration with JDBC pushdown from Calcite side. Can you comment on this patch?

[~msydoron], I did not see any test related to what was broken. Can you add tests to the patch? In addition, HIVE-19299 still needs to be addressed. Without proper testing coverage, this situation will continue repeating itself., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
|| || || || {color:brown} master Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  1m 46s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  6m 21s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  1m 16s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 46s{color} | {color:green} master passed {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  3m 54s{color} | {color:blue} ql in master has 2287 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 21s{color} | {color:blue} jdbc-handler in master has 8 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m  6s{color} | {color:green} master passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 23s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  1m 37s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  1m 15s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  1m 15s{color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red}  0m  9s{color} | {color:red} jdbc-handler: The patch generated 30 new + 17 unchanged - 2 fixed = 47 total (was 19) {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red}  0m 30s{color} | {color:red} jdbc-handler generated 3 new + 8 unchanged - 0 fixed = 11 total (was 8) {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m  5s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 12s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 26m  3s{color} | {color:black} {color} |
\\
\\
|| Reason || Tests ||
| FindBugs | module:jdbc-handler |
|  |  Exception is caught when Exception is not thrown in org.apache.hive.storage.jdbc.JdbcSerDe.initialize(Configuration, Properties)  At JdbcSerDe.java:is not thrown in org.apache.hive.storage.jdbc.JdbcSerDe.initialize(Configuration, Properties)  At JdbcSerDe.java:[line 111] |
|  |  org.apache.hive.storage.jdbc.dao.GenericJdbcDatabaseAccessor.getColumnTypes(Configuration) may fail to clean up java.sql.ResultSet  Obligation to clean up resource created at GenericJdbcDatabaseAccessor.java:up java.sql.ResultSet  Obligation to clean up resource created at GenericJdbcDatabaseAccessor.java:[line 115] is not discharged |
|  |  org.apache.hive.storage.jdbc.dao.GenericJdbcDatabaseAccessor.getColumnTypes(Configuration) may fail to clean up java.sql.Statement  Obligation to clean up resource created at GenericJdbcDatabaseAccessor.java:up java.sql.Statement  Obligation to clean up resource created at GenericJdbcDatabaseAccessor.java:[line 114] is not discharged |
\\
\\
|| Subsystem || Report/Notes ||
| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  |
| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u1 (2016-09-03) x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /data/hiveptest/working/yetus_PreCommit-HIVE-Build-12416/dev-support/hive-personality.sh |
| git revision | master / ef53d69 |
| Default Java | 1.8.0_111 |
| findbugs | v3.0.0 |
| checkstyle | http://104.198.109.242/logs//PreCommit-HIVE-Build-12416/yetus/diff-checkstyle-jdbc-handler.txt |
| findbugs | http://104.198.109.242/logs//PreCommit-HIVE-Build-12416/yetus/new-findbugs-jdbc-handler.html |
| modules | C: ql jdbc-handler U: . |
| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-12416/yetus.txt |
| Powered by | Apache Yetus    http://yetus.apache.org |


This message was automatically generated.

, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12930404/HIVE-20095.1.patch

{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 6 failed/errored test(s), 14642 tests executed
*Failed tests:*
{noformat}
TestAutoPurgeTables - did not produce a TEST-*.xml file (likely timed out) (batchId=240)
TestClearDanglingScratchDir - did not produce a TEST-*.xml file (likely timed out) (batchId=240)
TestLocationQueries - did not produce a TEST-*.xml file (likely timed out) (batchId=240)
TestSemanticAnalyzerHookLoading - did not produce a TEST-*.xml file (likely timed out) (batchId=240)
TestSparkStatistics - did not produce a TEST-*.xml file (likely timed out) (batchId=240)
org.apache.hadoop.hive.cli.TestBlobstoreCliDriver.testCliDriver[ptf_parquetfile] (batchId=264)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/12416/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/12416/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-12416/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.YetusPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12930404 - PreCommit-HIVE-Build, [~daijy] Can you also please explain your change in JdbcRecordIterator.java? 

I think that this change can cause many troubles when the columnTypes member is set. what was missing it the old code?

 

[~jcamachorodriguez] Please take a look., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
|| || || || {color:brown} master Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  1m 45s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  6m 32s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  1m 19s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 47s{color} | {color:green} master passed {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  3m 56s{color} | {color:blue} ql in master has 2287 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 24s{color} | {color:blue} jdbc-handler in master has 8 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m  9s{color} | {color:green} master passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 25s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  1m 39s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  1m 17s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  1m 17s{color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red}  0m  9s{color} | {color:red} jdbc-handler: The patch generated 31 new + 23 unchanged - 2 fixed = 54 total (was 25) {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red}  0m 30s{color} | {color:red} jdbc-handler generated 3 new + 8 unchanged - 0 fixed = 11 total (was 8) {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m  4s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 12s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 26m 35s{color} | {color:black} {color} |
\\
\\
|| Reason || Tests ||
| FindBugs | module:jdbc-handler |
|  |  Exception is caught when Exception is not thrown in org.apache.hive.storage.jdbc.JdbcSerDe.initialize(Configuration, Properties)  At JdbcSerDe.java:is not thrown in org.apache.hive.storage.jdbc.JdbcSerDe.initialize(Configuration, Properties)  At JdbcSerDe.java:[line 111] |
|  |  org.apache.hive.storage.jdbc.dao.GenericJdbcDatabaseAccessor.getColumnTypes(Configuration) may fail to clean up java.sql.ResultSet  Obligation to clean up resource created at GenericJdbcDatabaseAccessor.java:up java.sql.ResultSet  Obligation to clean up resource created at GenericJdbcDatabaseAccessor.java:[line 115] is not discharged |
|  |  org.apache.hive.storage.jdbc.dao.GenericJdbcDatabaseAccessor.getColumnTypes(Configuration) may fail to clean up java.sql.Statement  Obligation to clean up resource created at GenericJdbcDatabaseAccessor.java:up java.sql.Statement  Obligation to clean up resource created at GenericJdbcDatabaseAccessor.java:[line 114] is not discharged |
\\
\\
|| Subsystem || Report/Notes ||
| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  |
| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u1 (2016-09-03) x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /data/hiveptest/working/yetus_PreCommit-HIVE-Build-12512/dev-support/hive-personality.sh |
| git revision | master / 18fb1b3 |
| Default Java | 1.8.0_111 |
| findbugs | v3.0.0 |
| checkstyle | http://104.198.109.242/logs//PreCommit-HIVE-Build-12512/yetus/diff-checkstyle-jdbc-handler.txt |
| findbugs | http://104.198.109.242/logs//PreCommit-HIVE-Build-12512/yetus/new-findbugs-jdbc-handler.html |
| modules | C: ql jdbc-handler itests U: . |
| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-12512/yetus.txt |
| Powered by | Apache Yetus    http://yetus.apache.org |


This message was automatically generated.

, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12930997/HIVE-20095.2.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 14623 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[external_jdbc_table] (batchId=9)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[resourceplan] (batchId=168)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[strict_managed_tables_sysdb] (batchId=169)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/12512/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/12512/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-12512/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.YetusPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12930997 - PreCommit-HIVE-Build, | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
|| || || || {color:brown} master Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  1m 47s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  6m 21s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  1m 16s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 45s{color} | {color:green} master passed {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  3m 54s{color} | {color:blue} ql in master has 2287 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 22s{color} | {color:blue} jdbc-handler in master has 8 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m  6s{color} | {color:green} master passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 25s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  1m 32s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  1m 15s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  1m 15s{color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red}  0m 10s{color} | {color:red} jdbc-handler: The patch generated 30 new + 23 unchanged - 2 fixed = 53 total (was 25) {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red}  0m 30s{color} | {color:red} jdbc-handler generated 3 new + 8 unchanged - 0 fixed = 11 total (was 8) {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m  5s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 12s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 25m 58s{color} | {color:black} {color} |
\\
\\
|| Reason || Tests ||
| FindBugs | module:jdbc-handler |
|  |  Exception is caught when Exception is not thrown in org.apache.hive.storage.jdbc.JdbcSerDe.initialize(Configuration, Properties)  At JdbcSerDe.java:is not thrown in org.apache.hive.storage.jdbc.JdbcSerDe.initialize(Configuration, Properties)  At JdbcSerDe.java:[line 111] |
|  |  org.apache.hive.storage.jdbc.dao.GenericJdbcDatabaseAccessor.getColumnTypes(Configuration) may fail to clean up java.sql.ResultSet  Obligation to clean up resource created at GenericJdbcDatabaseAccessor.java:up java.sql.ResultSet  Obligation to clean up resource created at GenericJdbcDatabaseAccessor.java:[line 115] is not discharged |
|  |  org.apache.hive.storage.jdbc.dao.GenericJdbcDatabaseAccessor.getColumnTypes(Configuration) may fail to clean up java.sql.Statement  Obligation to clean up resource created at GenericJdbcDatabaseAccessor.java:up java.sql.Statement  Obligation to clean up resource created at GenericJdbcDatabaseAccessor.java:[line 114] is not discharged |
\\
\\
|| Subsystem || Report/Notes ||
| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  |
| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u1 (2016-09-03) x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /data/hiveptest/working/yetus_PreCommit-HIVE-Build-12542/dev-support/hive-personality.sh |
| git revision | master / 19c2ec4 |
| Default Java | 1.8.0_111 |
| findbugs | v3.0.0 |
| checkstyle | http://104.198.109.242/logs//PreCommit-HIVE-Build-12542/yetus/diff-checkstyle-jdbc-handler.txt |
| findbugs | http://104.198.109.242/logs//PreCommit-HIVE-Build-12542/yetus/new-findbugs-jdbc-handler.html |
| modules | C: ql jdbc-handler itests U: . |
| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-12542/yetus.txt |
| Powered by | Apache Yetus    http://yetus.apache.org |


This message was automatically generated.

, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12931132/HIVE-20095.3.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 14629 tests executed
*Failed tests:*
{noformat}
TestMiniTezCliDriver - did not produce a TEST-*.xml file (likely timed out) (batchId=105)
	[update_orig_table.q,explainanalyze_3.q,orc_vectorization_ppd.q,vector_non_string_partition.q,multi_count_distinct.q,explainanalyze_1.q,explainuser_3.q,explainanalyze_4.q,hybridgrace_hashjoin_1.q,delete_orig_table.q,hybridgrace_hashjoin_2.q,tez-tag.q,orc_merge12.q,explainanalyze_5.q,vector_join_part_col_char.q]
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[resourceplan] (batchId=168)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[strict_managed_tables_sysdb] (batchId=169)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/12542/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/12542/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-12542/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.YetusPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12931132 - PreCommit-HIVE-Build, Haven't read through the patch but the motivation of the change in HIVE-19161 is to rely on table schema rather than ResultSet to determine the object type of the results. Same sql expression could be interpreted as different datatype in ResultSet for different databases, thus the result for the same expression could be different datatype for different database. Rely on table schema is more reliable. I don't remember a concrete example out of my head but there must be one inside hive-schema-3.1.0.hive.sql. I can find it if needed. I am not sure how this breaks PPD, is that "hiveQueryExecution" part in JdbcSerDe? If we can fix it and keep relying on table schema for result type, that should be fine for me., [~daijy], the motivation for that is that currently we can generate complex SQL statement for the part of the query that we push to the storage handler automatically from Calcite. Hence, the types for that TableScan should be coming from the output of that query rather than from the Table schema. I think an easy fix would be that if query has been generated by Hive, then we could use ResultSet to determine the schema; otherwise we fallback to using table schema, which is what [~msydoron] did.
Since the number of dialects supported from Calcite will be limited, this means we should also include a map for the types in those databases towards Hive. We can do that later on. Does it make sense?

[~msydoron], there seem to be be some test failures still., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12931692/HIVE-20095.4.patch

{color:red}ERROR:{color} -1 due to build exiting with an error

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/12622/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/12622/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-12622/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Tests exited with: NonZeroExitCodeException
Command 'bash /data/hiveptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ date '+%Y-%m-%d %T.%3N'
2018-07-15 09:04:54.430
+ [[ -n /usr/lib/jvm/java-8-openjdk-amd64 ]]
+ export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ export PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m '
+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m '
+ export 'MAVEN_OPTS=-Xmx1g '
+ MAVEN_OPTS='-Xmx1g '
+ cd /data/hiveptest/working/
+ tee /data/hiveptest/logs/PreCommit-HIVE-Build-12622/source-prep.txt
+ [[ false == \t\r\u\e ]]
+ mkdir -p maven ivy
+ [[ git = \s\v\n ]]
+ [[ git = \g\i\t ]]
+ [[ -z master ]]
+ [[ -d apache-github-source-source ]]
+ [[ ! -d apache-github-source-source/.git ]]
+ [[ ! -d apache-github-source-source ]]
+ date '+%Y-%m-%d %T.%3N'
2018-07-15 09:04:54.433
+ cd apache-github-source-source
+ git fetch origin
+ git reset --hard HEAD
HEAD is now at 1b5903b HIVE-20006: Make materializations invalidation cache work with multiple active remote metastores (Jesus Camacho Rodriguez, reviewed by Ashutosh Chauhan)
+ git clean -f -d
+ git checkout master
Already on 'master'
Your branch is up-to-date with 'origin/master'.
+ git reset --hard origin/master
HEAD is now at 1b5903b HIVE-20006: Make materializations invalidation cache work with multiple active remote metastores (Jesus Camacho Rodriguez, reviewed by Ashutosh Chauhan)
+ git merge --ff-only origin/master
Already up-to-date.
+ date '+%Y-%m-%d %T.%3N'
2018-07-15 09:04:55.581
+ rm -rf ../yetus_PreCommit-HIVE-Build-12622
+ mkdir ../yetus_PreCommit-HIVE-Build-12622
+ git gc
+ cp -R . ../yetus_PreCommit-HIVE-Build-12622
+ mkdir /data/hiveptest/logs/PreCommit-HIVE-Build-12622/yetus
+ patchCommandPath=/data/hiveptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hiveptest/working/scratch/build.patch
+ [[ -f /data/hiveptest/working/scratch/build.patch ]]
+ chmod +x /data/hiveptest/working/scratch/smart-apply-patch.sh
+ /data/hiveptest/working/scratch/smart-apply-patch.sh /data/hiveptest/working/scratch/build.patch
fatal: patch with only garbage at line 1325
fatal: git diff header lacks filename information when removing 1 leading pathname component (line 427)
fatal: git diff header lacks filename information when removing 2 leading pathname components (line 427)
The patch does not appear to apply with p0, p1, or p2
+ result=1
+ '[' 1 -ne 0 ']'
+ rm -rf yetus_PreCommit-HIVE-Build-12622
+ exit 1
'
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12931692 - PreCommit-HIVE-Build, [~jcamachorodriguez] [~daijy]

Those 2 tests are failing exactly due to the changes that has been done in JdbcRecordIterator.java.

 +

Using getLong/getDouble will return wrong results, as those API's will not return null values!, [~jcamachorodriguez]

I am afraid that your commit for HIVE-20007 also broke the timestamp consuming from external table, as JavaTimestampObjectInspector now expect  org.apache.hadoop.hive.common.type.Timestamp instead of java.sql.Timestamp which the jdbc generates., [~msydoron], we need to fix those two test failures before committing this patch. What is the error that we are getting?

After checking the code in more detail.
For the existing failures, I think your new code in JdbcRecordIterator is the right way to go, but we should modify the {{deserialize}} method in JDBCSerde to create the right type requested for Hive (the deserialize method in DruidSerDe may serve as an example https://github.com/apache/hive/blob/master/druid-handler/src/java/org/apache/hadoop/hive/druid/serde/DruidSerDe.java#L387 ). JDBCSerde always has information for the columnTypes derived either from from metadata query or from conf depending on the existence of {{Constants.HIVE_JDBC_QUERY}}, hence it should be straightforward. At the same time, issue for nulls and timestamp would be fixed this way. What do you think?
]