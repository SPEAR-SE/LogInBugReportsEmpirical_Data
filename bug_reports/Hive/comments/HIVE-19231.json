[[~aihuaxu] Could you please review this when you have a chance? Thanks, ? for TTY means the process is not attached to any TTY (terminal interface). Probably similar to something like daemon. Seems we should add such check for background process. I also notice some platform on mac may show as "??". The script works for both case, right?

Probably you can try out cron job calling beeline to simulate this. 

 , [~aihuaxu] Running a beeline command using a cron job seems to be resulting in similar output that we were seeing that caused this issue.
{code:java}
  PID          S TTY          TIME COMMAND
22756 ?        S ?        00:00:00 bash /usr/lib/hive/bin/beeline -u jdbc:hive2://localhost:10000 -n hive -p hive -e select * from sample_08 where salary > 50000
Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=512M; support was removed in 8.0
Java HotSpot(TM) 64-Bit Server VM warning: Using incremental CMS is deprecated and will likely be removed in a future release
Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=512M; support was removed in 8.0
scan complete in 2ms
Connecting to jdbc:hive2://localhost:10000
Connected to: Apache Hive (version 1.1.0-cdh5.14.3-SNAPSHOT)
Driver: Hive JDBC (version 1.1.0-cdh5.14.3-SNAPSHOT)
Transaction isolation: TRANSACTION_REPEATABLE_READ
INFO  : Compiling command(queryId=hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0): select * from sample_08 where salary > 50000
INFO  : Semantic Analysis Completed
INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:sample_08.code, type:string, comment:null), FieldSchema(name:sample_08.description, type:string, comment:null), FieldSchema(name:samp
le_08.total_emp, type:int, comment:null), FieldSchema(name:sample_08.salary, type:int, comment:null)], properties:null)
INFO  : Completed compiling command(queryId=hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0); Time taken: 0.123 seconds
INFO  : Executing command(queryId=hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0): select * from sample_08 where salary > 50000
INFO  : Query ID = hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0
INFO  : Total jobs = 1
INFO  : Launching Job 1 out of 1
INFO  : Starting task [Stage-1:MAPRED] in serial mode
INFO  : Number of reduce tasks is set to 0 since there's no reduce operator
INFO  : number of splits:1
INFO  : Submitting tokens for job: job_1525165852892_0012
INFO  : The url to track the job: http://<SNIPPED>:8088/proxy/application_1525165852892_0012/
INFO  : Starting Job = job_1525165852892_0012, Tracking URL = http://<SNIPPED>:8088/proxy/application_1525165852892_0012/
INFO  : Kill Command = /usr/lib/hadoop/bin/hadoop job  -kill job_1525165852892_0012
INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 0
INFO  : 2018-05-01 10:05:10,966 Stage-1 map = 0%,  reduce = 0%
INFO  : 2018-05-01 10:05:18,294 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 3.89 sec
INFO  : MapReduce Total cumulative CPU time: 3 seconds 890 msec
INFO  : Ended Job = job_1525165852892_0012
INFO  : MapReduce Jobs Launched:
INFO  : Stage-Stage-1: Map: 1   Cumulative CPU: 3.89 sec   HDFS Read: 50608 HDFS Write: 16567 SUCCESS
INFO  : Total MapReduce CPU Time Spent: 3 seconds 890 msec
INFO  : Completed executing command(queryId=hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0); Time taken: 13.981 seconds
INFO  : OK
{code}

However, running as a cron job with or without the fix does not seem to reproduce the issue whether running the script runs beeline in background or foreground (I suspect the way cron is run, it can never be run as a foreground process). So it appears we are good for this usecase as well.

Do you have additional concerns? Thanks, Sounds good. +1., Fix has been pushed to master and branch-3. Thank you for the review [~aihuaxu], This jira is resolved and released with Hive 3.0 If you find an issue with it, please create a new jira.]