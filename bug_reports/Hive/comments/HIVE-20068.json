[This is solved in Hive 3.1 and Hive 4.0 via HIVE-12192 and HIVE-20007, respectively.

I have created a clone HIVE-20073 to push the example in the description as a test to master and branch-3. I will leave this one open in case someone wants to tackle issue in 2.x line.]