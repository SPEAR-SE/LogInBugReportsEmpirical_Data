[I've also found a bug in the thrift PHP TSocket.php implementation. See THRIFT-347,  I have now included the necessary php files from the thrift distribution and applied the patch that Gary provided to THRIFT-347. After applying this patch, ant package will create the thrift root in build/dist/lib/php. Thanks to Gary for the steps to get php access to the hive thrift server., Hi Raghotham,

It's not quite right. Here's what my packages/ directory looks like:

[root@ip-10-250-154-176 packages]# find . -type f
./hive_service/ThriftHive.php
./hive_service/hive_service_types.php
./hive_metastore/hive_metastore_constants.php
./hive_metastore/ThriftHiveMetastore.php
./hive_metastore/ThriftMetaStore.php
./hive_metastore/hive_metastore_types.php
./fb303/FacebookBase.php


You're missing the hive_service stuff. Plus they should be separated into their respective directories.

In my opinion, you should distribute:

[root@ip-10-250-154-176 packages]# find . -type f
./hive_service/ThriftHive.php
./hive_service/hive_service_types.php
./hive_metastore/hive_metastore_constants.php
./hive_metastore/ThriftHiveMetastore.php
./hive_metastore/ThriftMetaStore.php
./hive_metastore/hive_metastore_types.php

and the instructions for getting the PHP libs to work would be something like:

Copy the contents of build/dist/lib/php to your THRIFT_ROOT/packages directory. If you don't already have a THRIFT_ROOT, you need to get the base files from the thrift distribution, as well as the fb303 package., Are you sure you did ant package? Once you do that you should have the following in build/dist/lib/php

$ find . -type f
./autoload.php
./ext/thrift_protocol/config.m4
./ext/thrift_protocol/php_thrift_protocol.cpp
./ext/thrift_protocol/php_thrift_protocol.h
./ext/thrift_protocol/tags/1.0.0/config.m4
./ext/thrift_protocol/tags/1.0.0/php_thrift_protocol.cpp
./ext/thrift_protocol/tags/1.0.0/php_thrift_protocol.h
./packages/fb303/FacebookService.php
./packages/fb303/fb303_types.php
./packages/hive_metastore/hive_metastore_constants.php
./packages/hive_metastore/hive_metastore_types.php
./packages/hive_metastore/ThriftHiveMetastore.php
./packages/hive_metastore/ThriftMetaStore.php
./packages/hive_service/hive_service_types.php
./packages/hive_service/ThriftHive.php
./packages/serde/serde_constants.php
./packages/serde/serde_types.php
./protocol/TBinaryProtocol.php
./protocol/TProtocol.php
./Thrift.php
./transport/TBufferedTransport.php
./transport/TFramedTransport.php
./transport/THttpClient.php
./transport/TMemoryBuffer.php
./transport/TNullTransport.php
./transport/TPhpStream.php
./transport/TSocket.php
./transport/TSocketPool.php
./transport/TTransport.php


Note that this is the complete thrift root. It includes all the basic thrift php files - Thrift.php, protocol/, transport/, ext/, autoload.php
And in packages, there are fb303/, hive_metastore/, hive_service/, serde/

So, you dont need the thrift distribution. , Hey,

Found the problem: I didn't see the patch the first time through... 

I had to manually create the service/lib/php directory to make the build run. Possibly some files were missing from the diff:

package:
     [echo] Deploying Hive jars to /root/hive/build/dist
    [mkdir] Created dir: /root/hive/build/dist
    [mkdir] Created dir: /root/hive/build/dist/lib
    [mkdir] Created dir: /root/hive/build/dist/conf
    [mkdir] Created dir: /root/hive/build/dist/bin
    [mkdir] Created dir: /root/hive/build/dist/examples
    [mkdir] Created dir: /root/hive/build/dist/examples/files
    [mkdir] Created dir: /root/hive/build/dist/examples/queries
    [mkdir] Created dir: /root/hive/build/dist/lib/py
    [mkdir] Created dir: /root/hive/build/dist/lib/php
     [copy] Copying 1 file to /root/hive/build/dist/bin
     [copy] Copying 5 files to /root/hive/build/dist/bin/ext
     [copy] Copying 1 file to /root/hive/build/dist/bin
     [copy] Copying 1 file to /root/hive/build/dist/conf
     [copy] Copying 1 file to /root/hive/build/dist/conf
     [copy] Copying 1 file to /root/hive/build/dist/conf

BUILD FAILED
/root/hive/build.xml:179: /root/hive/service/lib/php not found.

Total time: 15 seconds

When I manually created the directory, it goes through, but a bunch of files are missing. For example, fb303_types.php., Committed revision 758859. Thanks Raghu!]