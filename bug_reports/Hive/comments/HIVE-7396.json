[This is not just a simple NULL check missing.

I made modifications to test this out

{code}
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/BucketingSortingReduceSinkOptimizer.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/BucketingSortingReduceSinkOptimizer.java
@@ -498,7 +498,7 @@ public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
 
             if (srcTable.isPartitioned()) {
               PrunedPartitionList prunedParts = pGraphContext.getOpToPartList().get(ts);
-              List<Partition> partitions = prunedParts.getNotDeniedPartns();
+              List<Partition> partitions = (prunedParts != null ) ? prunedParts.getNotDeniedPartns() : null;
 
               // Support for dynamic partitions can be added later
               // The following is not optimized:
{code}

But then it generates a scan on only one partition instead of a full-table scan., My bad, 

{color:green}Overall{color}: +1 all checks pass

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12655367/HIVE-7396.1.patch.txt

{color:green}SUCCESS:{color} +1 5719 tests passed

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/760/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/760/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-Build-760/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12655367, +1, Committed to trunk. Thanks, Navis!, This has been fixed in 0.14 release. Please open new jira if you see any issues.
]