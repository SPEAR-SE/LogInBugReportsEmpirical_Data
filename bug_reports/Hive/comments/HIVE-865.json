[The mem leak turns out to be caused by the MRU cache manager in JDBM. Currently Hive caches 25000 rows in JDBM through MapJoin by default. I changed it to 1 and it seems works fine. I'll looking into MRU., This patch added solves the Out-of-memory exception thrown by MapJoinOperator. The changes include:
1) make the persistent hashtable HTree non-transactional. (this is not the cause of out-of-memory error, but it may improve performance)
2) commit the RecordManager for every 100 record insertion. (this is the main cause of OOM issue)., Can you fix the comments etc. which you added for debugging ?


+        // turn off caching to see if it causes the mem leak

, Cleaned up the comments in HIVE-865_2.patch, +1

looks good - will commit if the tests pass, Committed. Thanks Ning]