[mbautin requested code review of "[jira] [HIVE-3809] Concurrency issue in RCFile: multiple threads can use the same decompressor".
Reviewers: kevinwilfong, njain, ashutoshc, cwsteinbach, edwardcapriolo, JIRA

  Making sure that decompressors are only returned to the pool once when readers are closed in RCFile. Otherwise the same decompressor can end up in the pool multiple times, and multiple threads would pick it up and try to use it concurrently.

TEST PLAN
  Unit tests

REVISION DETAIL
  https://reviews.facebook.net/D7419

AFFECTED FILES
  ql/src/java/org/apache/hadoop/hive/ql/io/RCFile.java

MANAGE HERALD DIFFERENTIAL RULES
  https://reviews.facebook.net/herald/view/differential/

WHY DID I GET THIS EMAIL?
  https://reviews.facebook.net/herald/transcript/17709/

To: kevinwilfong, njain, ashutoshc, cwsteinbach, edwardcapriolo, JIRA, mbautin
, Attaching a manually generated patch., +1, Committed to trunk. Thanks, Mikhail!, Integrated in Hive-trunk-h0.21 #1884 (See [https://builds.apache.org/job/Hive-trunk-h0.21/1884/])
    HIVE-3809 : Concurrency issue in RCFile: multiple threads can use the same decompressor (Mikhail Bautin via Ashutosh Chauhan) (Revision 1426524)

     Result = SUCCESS
hashutosh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1426524
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/io/RCFile.java
, [~ashutoshc]: thank you for committing this to trunk. Could you please also commit this to branch 0.9?

Patch for branch 0.9: https://issues.apache.org/jira/secure/attachment/12562623/0001-HIVE-3809-Concurrency-issue-in-RCFile-multiple-threa.patch, Integrated in Hive-trunk-hadoop2 #54 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/54/])
    HIVE-3809 : Concurrency issue in RCFile: multiple threads can use the same decompressor (Mikhail Bautin via Ashutosh Chauhan) (Revision 1426524)

     Result = ABORTED
hashutosh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1426524
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/io/RCFile.java
, [~ashutoshc]: any chance this fix could be committed to branch 0.9 as well, if this is not too difficult? Thanks!

Patch for 0.9:
https://issues.apache.org/jira/secure/attachment/12562623/0001-HIVE-3809-Concurrency-issue-in-RCFile-multiple-threa.patch]