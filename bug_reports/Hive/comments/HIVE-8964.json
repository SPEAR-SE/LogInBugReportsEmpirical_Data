[HIVE-8965 should catch when these are introduced., FYI [~hagleitn] [~thejas], The only thing I noted in the logs was two "connection reset by peer" errors and:

{noformat}
2014-11-25 01:15:37,975 DEBUG security.UserGroupInformation (UserGroupInformation.java:doAs(1618)) - PrivilegedActionException as:hiveptest (auth:SIMPLE) cause:org.apache.hadoop.hdfs.server.namenode.LeaseExpiredException: No lease on /home/hiveptest/54.227.92.185-hiveptest-0/apache-svn-trunk-source/itests/qtest/target/tmp/scratchdir/hiveptest/_tez_session_dir/5c3bba9c-9090-46de-81bd-93367d97f2ce/.tez/application_1416906780994_0001/recovery/1/summary (inode 16430): File does not exist. Holder DFSClient_NONMAPREDUCE_248168316_1 does not have any open files.
2014-11-25 01:15:37,976 DEBUG security.UserGroupInformation (UserGroupInformation.java:logPrivilegedAction(1638)) - PrivilegedAction as:hiveptest (auth:SIMPLE) from:org.apache.hadoop.ipc.Server$Handler.run(Server.java:2007)
2014-11-25 01:15:37,976 INFO  ipc.Server (Server.java:run(2027)) - IPC Server handler 8 on 37902, call org.apache.hadoop.hdfs.protocol.ClientProtocol.complete from 127.0.0.1:41635 Call#467 Retry#0: org.apache.hadoop.hdfs.server.namenode.LeaseExpiredException: No lease on /home/hiveptest/54.227.92.185-hiveptest-0/apache-svn-trunk-source/itests/qtest/target/tmp/scratchdir/hiveptest/_tez_session_dir/5c3bba9c-9090-46de-81bd-93367d97f2ce/.tez/application_1416906780994_0001/recovery/1/summary (inode 16430): File does not exist. Holder DFSClient_NONMAPREDUCE_248168316_1 does not have any open files.
{noformat}, I'll take a look., I am pretty sure this is {{lvj_mapjoin.q}} which was added in HIVE-8888. I've excluded that test on the PTest side. We'll see if that helps., Yes, it's definitely lvj_mapjoin.q. I can repro the hang - no idea why yet., Happens with tez 0.6.0 also. Same as [~brocknoland] only Exception I see is:

{noformat}
org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdfs.server.namenode.LeaseExpiredException): No lease on /Users/ghagleitner/Projects/hive-trunk2/itests/qtest/target/tmp/scratchdir/ghagleitner/_tez_session_dir/dc4fca20-4a39-4452-9\
75a-467bda4947ca/.tez/application_1417137410462_0001/recovery/1/summary (inode 16430): File does not exist. Holder DFSClient_NONMAPREDUCE_1900574341_1 does not have any open files.                                                          
  at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.checkLease(FSNamesystem.java:3083)                                                                                                                                                   
  at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.completeFileInternal(FSNamesystem.java:3170)                                                                                                                                         
  at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.completeFile(FSNamesystem.java:3140)                                                                                                                                                 
  at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.complete(NameNodeRpcServer.java:665)                                                                                                                                            
  at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.complete(ClientNamenodeProtocolServerSideTranslatorPB.java:499)                                                                                           
  at org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java)                                                                                        
  at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:585)                                                                                                                                       
  at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:928)                                                                                                                                                                                      
  at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:2013)                                                                                                                                                                             
  at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:2009)                                                                                                                                                                             
  at java.security.AccessController.doPrivileged(Native Method)                                                                                                                                                                               
  at javax.security.auth.Subject.doAs(Subject.java:394)                                                                                                                                                                                       
  at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1614)                                                                                                                                                     
  at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2007)                                                                                                                                                                               
                                                                                                                                                                                                                                              
  at org.apache.hadoop.ipc.Client.call(Client.java:1411)                                                                                                                                                                                      
  at org.apache.hadoop.ipc.Client.call(Client.java:1364)                                                                                                                                                                                      
  at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:206)                                                                                                                                                       
  at com.sun.proxy.$Proxy14.complete(Unknown Source)                                                                                                                                                                                          
  at sun.reflect.GeneratedMethodAccessor50.invoke(Unknown Source)                                                                                                                                                                             
  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)                                                                                                                                                    
  at java.lang.reflect.Method.invoke(Method.java:597)                                                                                                                                                                                         
  at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:187)                                                                                                                                          
  at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:102)                                                                                                                                                
  at com.sun.proxy.$Proxy14.complete(Unknown Source)                                                                                                                                                                                          
  at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolTranslatorPB.complete(ClientNamenodeProtocolTranslatorPB.java:412)                                                                                                               
  at org.apache.hadoop.hdfs.DFSOutputStream.completeFile(DFSOutputStream.java:2135)                                                                                                                                                           
  at org.apache.hadoop.hdfs.DFSOutputStream.close(DFSOutputStream.java:2119)                                                                                                                                                                  
  at org.apache.hadoop.fs.FSDataOutputStream$PositionCache.close(FSDataOutputStream.java:72)                                                                                                                                                  
  at org.apache.hadoop.fs.FSDataOutputStream.close(FSDataOutputStream.java:106)                                                                                                                                                               
  at org.apache.tez.dag.history.recovery.RecoveryService.serviceStop(RecoveryService.java:201)                                                                                                                                                
  at org.apache.hadoop.service.AbstractService.stop(AbstractService.java:221)                                                                                                                                                                 
  at org.apache.hadoop.service.ServiceOperations.stop(ServiceOperations.java:52)                                                                                                                                                              
  at org.apache.hadoop.service.ServiceOperations.stopQuietly(ServiceOperations.java:80)                                                                                                                                                       
  at org.apache.hadoop.service.CompositeService.stop(CompositeService.java:157)                                                                                                                                                               
  at org.apache.hadoop.service.CompositeService.serviceStop(CompositeService.java:131)                                                                                                                                                        
  at org.apache.tez.dag.history.HistoryEventHandler.serviceStop(HistoryEventHandler.java:80)                                                                                                                                                  
  at org.apache.hadoop.service.AbstractService.stop(AbstractService.java:221)                                                                                                                                                                 
  at org.apache.hadoop.service.ServiceOperations.stop(ServiceOperations.java:52)                                                                                                                                                              
  at org.apache.hadoop.service.ServiceOperations.stopQuietly(ServiceOperations.java:80)                                                                                                                                                       
  at org.apache.tez.dag.app.DAGAppMaster.stopServices(DAGAppMaster.java:1504)                                                                                                                                                                 
  at org.apache.tez.dag.app.DAGAppMaster.serviceStop(DAGAppMaster.java:1643)                                                                                                                                                                  
  at org.apache.hadoop.service.AbstractService.stop(AbstractService.java:221)                                                                                                                                                                 
  at org.apache.tez.dag.app.DAGAppMaster$DAGAppMasterShutdownHandler$AMShutdownRunnable.run(DAGAppMaster.java:698)                                                                                                                            
  at java.lang.Thread.run(Thread.java:695)  
{noformat}

Will open tez bug to see if they can help., Alright with the Tez guys' help figured out that the planner was producing a cyclic graph. I've re-opened HIVE-8888 and added a new patch. [~brocknoland] when the new patch in HIVE-8888, can you re-enable the test on the build machine? (or did you disable in the source somewhere?), I disabled it in some properties files on the build host. Really need to get those in svn. I'll try that today.

I will continue the discussion on how to test the patch in HIVE-8888 over there., We fixed this instance but this is happening again. I'll resolve this and open a new JIRA., Jira tracking new issue is here: HIVE-9406]