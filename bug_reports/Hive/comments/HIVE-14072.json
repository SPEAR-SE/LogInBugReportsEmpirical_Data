[[~sseth] can you take a look?, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12812914/HIVE-14072.patch

{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 4 failed/errored test(s), 10265 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_all
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_join
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/249/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/249/console
Test logs: http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-249/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12812914 - PreCommit-HIVE-MASTER-Build, [~sershe] - the changes seem reasonable to me - resetting the queryState between each run. Tested it locally on TestMiniLlapCluster - and the duplicate IDs for different queries are gone. (Duplicates exist for queries which are split across multiple jobs, but that should be ok).
That said, I'd be far more comfortable if someone who knows this code better takes a look at it. cc [~ashutoshc], [~ashutoshc] ping?, [~thejas] [~vgumashta] knows more about this area. They will be betters suited to review this., The main change here is the call in CommandProcessorFactory. , +1, Committed to master and branch-2.1. Thanks for the review.]