[The correct syntax for subquery in from clause is:
{code}
select col_list from (subquery) as alias;
{code}
For example, the following query works for me:
{code}
select name from (select name, value from dec) as A;
{code}
If I miss "as A", then I got some exception other than NPE:
{code}
select name from (select name, value from dec);
NoViableAltException(-1@[207:51: ( KW_AS )?])
	at org.antlr.runtime.DFA.noViableAlt(DFA.java:158)
...
{code}
Your query is more complicated, but in either case, we should get meaningful error messages instead of exceptions.
, Thanks [~xuefuz] for the explanation!, Hi Chao,

   The subquery inside IN clause does not have from clause. The correct query is below,

{noformat}
select p.p_partkey, li.suppkey
from (select distinct partkey as p_partkey from lineitem) p join lineitem li on p.p_partkey = li.partkey
where li.l_linenumber = 1 and
 li.l_orderkey in (select l_orderkey from lineitem where l_linenumber = li.l_linenumber);
{noformat}, [~Prabhu Joseph] Thanks! You're right, I forgot the "from lineitem" in the subquery. But in any case, I was expecting a more helpful error message, perhaps like "Parsing Error: missing the "FROM" keyword at line 4 ...", or something similar., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12687671/HIVE-9113.1.patch.txt

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 6714 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_optimize_nullscan
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2107/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2107/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2107/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12687671 - PreCommit-HIVE-TRUNK-Build, +1 patch looks reasonable to me.  Thanks for adding the test., Committed to trunk. Thanks, Szehon!]