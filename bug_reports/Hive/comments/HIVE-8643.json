[[~thejas], could you review?, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12677841/HIVE-8643.patch

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 6588 tests executed
*Failed tests:*
{noformat}
org.apache.hive.minikdc.TestJdbcWithMiniKdc.testNegativeTokenAuth
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1527/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1527/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1527/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12677841 - PreCommit-HIVE-TRUNK-Build, testNegativeTokenAuth has been failing for past 57 builds so it's not related

[~hagleitn], it would be very useful to have this in 0.14.  W/o it DDL ops via WebHCat with doAs (Hue, Knox, etc) will suffer., Yup - this should go into .14. +1 for that., This issue was surfaced by HIVE-6847 which ensured that scratch  dir permissions are sensible., [~ekoifman] I think we should make this change in ShimLoader.getHadoopShims().getUGIForConf(conf).
As you had pointed out to me (offline), we have had to fix this issue earlier in another place - HIVE-5542 . If we make this change in ShimLoader.getHadoopShims().getUGIForConf(conf) , we can eventually get rid of ProxyUserAuthenticator .
, [~ekoifman] Did you try building the username from the delegation token? Was curious if it's even possible and provides better security than propagating username via the environment variable., I did, but unsuccessfully., HIVE-8643.2.patch to address [~thejas]' comments, Can you also add a comment to ProxyUserAuthenticator saying that it is no longer necessary to use it with webhcat (0.14 release onwards).
Also, the comment block can you use the oracle java style (the IDE should be able to do it for you)  -

{code}
/*
 * Here is a block comment.
 */
{code}
http://www.oracle.com/technetwork/java/javase/documentation/codeconventions-141999.html#385
, +1, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12677986/HIVE-8643.2.patch

{color:red}ERROR:{color} -1 due to 2 failed/errored test(s), 6589 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_optimize_nullscan
org.apache.hive.minikdc.TestJdbcWithMiniKdc.testNegativeTokenAuth
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1535/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1535/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1535/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12677986 - PreCommit-HIVE-TRUNK-Build, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12678002/HIVE-8643.3.patch

{color:red}ERROR:{color} -1 due to 2 failed/errored test(s), 6588 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_optimize_nullscan
org.apache.hive.minikdc.TestJdbcWithMiniKdc.testNegativeTokenAuth
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1537/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1537/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1537/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12678002 - PreCommit-HIVE-TRUNK-Build, testCliDriver_optimize_nullscan fails in other (i.e. ones w/o this patch) bot runs so it's not related., committed to 0.14 and 0.15, Thanks [~thejas] for the review, This has been fixed in 0.14 release. Please open new jira if you see any issues.
]