[

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12736404/HIVE-10874.patch

{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 8976 tests executed
*Failed tests:*
{noformat}
TestCliDriver-auto_sortmerge_join_13.q-alter_partition_clusterby_sortby.q-udf_repeat.q-and-12-more - did not produce a TEST-*.xml file
TestUtil - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_fold_case
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4116/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4116/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4116/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12736404 - PreCommit-HIVE-TRUNK-Build, [~jpullokkaran], [~ashutoshc], could you take a look? Fail is not related to the patch. Thanks, [~jcamachorodriguez] Could you explain why are we deriving row type differently?
Is it to accommodate the groupings col differences between calcite & hive?, [~jpullokkaran], this problem is not only in Hive, the patch should go into Calcite too, and once the next release is out, we could remove it from here.

In this case, the condition is risen because we have the following plan:
{noformat}
Aggregate (f_1, sum(f_1)) 
  Union
    Aggregate (x, sum(x)) ...
    Aggregate (x, sum(x))  ...
{noformat}
where f1 is the column with the result of sum(x).

The problem is that Calcite derives the row schema for the aggregation column sum(f1) automatically. The generated name is f_1 ('f' of function, 1 of the position in the tuple), which is the same one that the first column has; however, Calcite was not verifying if the autogenerated name was already in the tuple or not. This patch checks if the name already exists, and while it does, it generates a new column name.

, +1 conditional on test failures.
Please update if test failures are unrelated?

, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12737077/HIVE-10874.01.patch

{color:red}ERROR:{color} -1 due to 2 failed/errored test(s), 8992 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_autogen_colalias
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udf_nondeterministic
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4153/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4153/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4153/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12737077 - PreCommit-HIVE-TRUNK-Build, [~jcamachorodriguez] Could you address the failures?, [~jpullokkaran], those two fails are unrelated to this patch; they have been failing in the last builds. Thanks, Committed to trunk, 1.2 branch.]