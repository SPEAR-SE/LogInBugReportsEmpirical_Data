[[~vgumashta] / [~thejas] Can you please review patch 1.  Please let me know if you think if there is a better way of telling the user that they entered a bad URL.

Thanks
Hari, Several non hive config parameters can also be set through the url. This includes tez/mr parameters. This check will disallow that.

There are two issues here.
1. It is hard for the user to figure out why the connection attempt failed. I think we can do something simple like printing the transport mode and other settings for connection that are getting used (transport mode, sasl, ssl ).
2. The failure is an OOM. Is it possible to not OOM and probably given an error about wrong transport mode ? 
These two issues can be talked as part of different jiras if necessary.

, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12733904/HIVE-10753.1.patch

{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 8946 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_insert_partition_static
org.apache.hive.jdbc.TestJdbcDriver2.testSetOnConnection
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3947/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3947/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3947/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12733904 - PreCommit-HIVE-TRUNK-Build, [~thejas] Thanks for the review, I noticed that OOM does not happen with master branch and it happens only with 0.14.0, most likely the OOM error was resolved with HIVE-6468.  However, I still get a connection error message like this :

{code}
localhost:bin hsubramaniyan$ ./beeline --verbose=true
Beeline version 1.3.0-SNAPSHOT by Apache Hive
beeline> !connect jdbc:hive2://localhost:10001/default?httpPath=/;transportMode=http
Connecting to jdbc:hive2://localhost:10001/default?httpPath=/;transportMode=http
Enter username for jdbc:hive2://localhost:10001/default?httpPath=/;transportMode=http: scott
Enter password for jdbc:hive2://localhost:10001/default?httpPath=/;transportMode=http: *****
Error: Could not open client transport with JDBC Uri: jdbc:hive2://localhost:10001/default?httpPath=/;transportMode=http: Invalid status 72 (state=08S01,code=0)
java.sql.SQLException: Could not open client transport with JDBC Uri: jdbc:hive2://localhost:10001/default?httpPath=/;transportMode=http: Invalid status 72
	at org.apache.hive.jdbc.HiveConnection.openTransport(HiveConnection.java:228)
	at org.apache.hive.jdbc.HiveConnection.<init>(HiveConnection.java:175)
	at org.apache.hive.jdbc.HiveDriver.connect(HiveDriver.java:105)
	at java.sql.DriverManager.getConnection(DriverManager.java:571)
	at java.sql.DriverManager.getConnection(DriverManager.java:187)
	at org.apache.hive.beeline.DatabaseConnection.connect(DatabaseConnection.java:142)
	at org.apache.hive.beeline.DatabaseConnection.getConnection(DatabaseConnection.java:207)
	at org.apache.hive.beeline.Commands.connect(Commands.java:1139)
	at org.apache.hive.beeline.Commands.connect(Commands.java:1060)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.apache.hive.beeline.ReflectiveCommandHandler.execute(ReflectiveCommandHandler.java:52)
	at org.apache.hive.beeline.BeeLine.dispatch(BeeLine.java:976)
	at org.apache.hive.beeline.BeeLine.execute(BeeLine.java:815)
	at org.apache.hive.beeline.BeeLine.begin(BeeLine.java:772)
	at org.apache.hive.beeline.BeeLine.mainWithInputRedirection(BeeLine.java:485)
	at org.apache.hive.beeline.BeeLine.main(BeeLine.java:468)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.apache.hadoop.util.RunJar.run(RunJar.java:221)
	at org.apache.hadoop.util.RunJar.main(RunJar.java:136)
Caused by: org.apache.thrift.transport.TTransportException: Invalid status 72
	at org.apache.thrift.transport.TSaslTransport.sendAndThrowMessage(TSaslTransport.java:232)
	at org.apache.thrift.transport.TSaslTransport.receiveSaslMessage(TSaslTransport.java:184)
	at org.apache.thrift.transport.TSaslTransport.open(TSaslTransport.java:307)
	at org.apache.thrift.transport.TSaslClientTransport.open(TSaslClientTransport.java:37)
	at org.apache.hive.jdbc.HiveConnection.openTransport(HiveConnection.java:203)
	... 24 more
{code}

I will upload a new patch which improves the error message i.e. the point 1 you mentioned above.

Thanks
Hari, [~thejas]  I have added some logging information which will give the end user a clue as to why the JDBC connection failed in such scenarios. Please let me know if there are any other parameters that might be helpful if logged.

Thanks
Hari, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12734951/HIVE-10753.2.patch

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 8967 tests executed
*Failed tests:*
{noformat}
TestContribNegativeCliDriver - did not produce a TEST-*.xml file
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4018/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4018/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4018/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12734951 - PreCommit-HIVE-TRUNK-Build, +1, [~thejas] Thanks for the review, TestContribNegativeCliDriver passes in my machine locally.

Thanks
Hari, Committed to master and branch-1.2. Thanks [~thejas] for reviewing the change.]