[There's a fix in HIVE-18571 , I think I should have committed to the master the fix for this issue so that there would be no conflict. 
Found that the fix is included at HIVE-18052.15.patch, which is created on Jan 4, 2018]