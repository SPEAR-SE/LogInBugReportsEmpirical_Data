[cc [~sershe] for review., +1 as a quick fix... however
1) it would be better to add field to the protocol promising single AM (or not, as in case with external interface); relying on external flag itself is hacky since, potentially, other clients could use external record reader from a single "AM", allowing them to utilize the UGI pool.
2) also, the comment might not be correct w.r.t. it being temporary; even if Spark thing uses a single port per instance, it can still have multiple spark tasks for the same query as far as I understand. That would make this solution permanent :) , True. Multiple across hosts would need to be handled. The client needs to stop creating an umbilical per fragment., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12870164/HIVE-16777.01.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 10788 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[create_merge_compressed] (batchId=237)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[subquery_scalar] (batchId=152)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=145)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/5453/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/5453/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-5453/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12870164 - PreCommit-HIVE-Build, Test failures are not related. Committing. Created HIVE-16781 to track improvements., Hive 3.0.0 has been released so closing this jira.]