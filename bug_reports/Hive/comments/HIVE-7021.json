[The uncommitted fix for HIVE-4629 introduces a memory leak. This fix is DEPENDENT on the fix from HIVE-4629. The initial implementation, submitted as a patch, for HIVE-4629 does not appear to be final and will likely undergo some changes soon. Hence this fix is subject to change based on the final implementation for HIVE-4629. This patch will NOT compile on the trunk because it depends on the fix for HIVE-4629. 

I will revise this fix when the final implementation for HIVE-4629 is complete. Thanks, I am also attaching the full patch that contains the fixes from both HIVE-4629 + HIVE-7021 build from the trunk today., Even without HIVE-4629,HiveServer2 can leak OperationHandle on failed queries.
When a JDBCClient runs queries like "select * from table_not_exists",
HiveServer2 fail this query duiring compile,but leaves an OperationHandle in memory (due to  async mode) without pass it back to client side .
Shall I fire a new jira for this? Or would you fix it in this patch?, [~ngangam] In Hive 0.14 release notes. they mentioned this issue(Hive-7021)..  Is above fix merged with Hive main branch(0.14) ? ....If not why ?
, I filed this issue for leaks observed for specific set of classes as reported by a customer using a preliminary patch for HIVE-4629. If there are other leaks, I think it makes sense to make this sort of an umbrella bug and track each leak separately in a jira but link them to this jira. So we would have one place to find all relevant leaks.
The reason this fix was not committed back when I uploaded the patch was because HIVE-4629 had not been committed then. It was built on a patch made available and I had to hold off on committing this dependent fix until HIVE-4629 re-work was complete.
If you could please add your testcases that cause memory leak, it would help in investigating the issue. Thanks]