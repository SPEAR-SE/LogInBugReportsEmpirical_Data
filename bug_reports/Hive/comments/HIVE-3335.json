[[~showyou] Your analysis seems correct. Mind submitting a patch for it?, A patch of this issue, I'm sorry to too late. I attach a patch for this issue., Couple of comments:
* In finally block, instead of {{reader.close();}} better is to do {{org.apache.hadoop.io.IOUtils.closeStream(reader);}} since reader could be either null or can throw IOException in close(). IOUtils handles both of those cases.
* Same problem exists even in unit test code of this class, where reader.close() is never invoked, resulting in socket leak. In both tests testAccuracy1() and testAccuracy2() can you add {{reader.close()}} I don't think we need to do full try-catch-block in testcases, since there as soon as exception occurs we want to start unwinding the stack., This was fixed via HIVE-3480]