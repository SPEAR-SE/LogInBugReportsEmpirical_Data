[hi,ransom
problem also exist in my environment. and i use explain statement and find that the second sql's ppd has error.
TableScan
            alias: t2
            Filter Operator
              predicate:
                  expr: (c1 = 1)
                  type: boolean

the ppd optimizer push the filter c1='1' to table t1 and t2.
but correct thing is table t1, not t2.
, @Lianhui Wang
yes, this must be PredicatePushDown optimizer problem., navis requested code review of "HIVE-4365 [jira] wrong result in left semi join".

Reviewers: JIRA

HIVE-4365 wrong result in left semi join

wrong result in left semi join while hive.optimize.ppd=true
for example:
1、create table
   create table t1(c1 int,c2 int, c3 int, c4 int, c5 double,c6 int,c7 string)   row format DELIMITED FIELDS TERMINATED BY '|';
   create table t2(c1 int) ;
2、load data
load data local inpath '/home/test/t1.txt' OVERWRITE into table t1;
load data local inpath '/home/test/t2.txt' OVERWRITE into table t2;
t1 data:
1|3|10003|52|781.96|555|201203
1|3|10003|39|782.96|555|201203
1|3|10003|87|783.96|555|201203
2|5|10004|24|789.96|555|201203
2|5|10004|58|788.96|555|201203
t2 data:
555
3、excute Query
select t1.c1,t1.c2,t1.c3,t1.c4,t1.c5,t1.c6,t1.c7  from t1 left semi join t2 on t1.c6 = t2.c1 and  t1.c1 =  '1' and t1.c7 = '201203' ;
can got result.
select t1.c1,t1.c2,t1.c3,t1.c4,t1.c5,t1.c6,t1.c7  from t1 left semi join t2 on t1.c6 = t2.c1 where t1.c1 =  '1' and t1.c7 = '201203' ;
can't got result.

TEST PLAN
  EMPTY

REVISION DETAIL
  https://reviews.facebook.net/D10341

AFFECTED FILES
  ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
  ql/src/java/org/apache/hadoop/hive/ql/ppd/OpProcFactory.java
  ql/src/test/queries/clientpositive/semijoin.q
  ql/src/test/results/clientpositive/semijoin.q.out

MANAGE HERALD RULES
  https://reviews.facebook.net/herald/view/differential/

WHY DID I GET THIS EMAIL?
  https://reviews.facebook.net/herald/transcript/24771/

To: JIRA, navis
, Yes, it was a PPD problem in RS. Right alias of left semi join takes all predicates., navis updated the revision "HIVE-4365 [jira] wrong result in left semi join".

  Fixed test result & passed all tests

Reviewers: JIRA

REVISION DETAIL
  https://reviews.facebook.net/D10341

CHANGE SINCE LAST DIFF
  https://reviews.facebook.net/D10341?vs=32361&id=32505#toc

AFFECTED FILES
  ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
  ql/src/java/org/apache/hadoop/hive/ql/ppd/OpProcFactory.java
  ql/src/test/queries/clientpositive/semijoin.q
  ql/src/test/results/clientpositive/semijoin.q.out
  ql/src/test/results/compiler/plan/join1.q.xml
  ql/src/test/results/compiler/plan/join2.q.xml
  ql/src/test/results/compiler/plan/join3.q.xml
  ql/src/test/results/compiler/plan/join4.q.xml
  ql/src/test/results/compiler/plan/join5.q.xml
  ql/src/test/results/compiler/plan/join6.q.xml
  ql/src/test/results/compiler/plan/join7.q.xml
  ql/src/test/results/compiler/plan/join8.q.xml

To: JIRA, navis
, ashutoshc has accepted the revision "HIVE-4365 [jira] wrong result in left semi join".

  +1 will commit if tests pass.

REVISION DETAIL
  https://reviews.facebook.net/D10341

BRANCH
  HIVE-4365

ARCANIST PROJECT
  hive

To: JIRA, ashutoshc, navis
, Committed to trunk. Thanks, Navis!, Integrated in Hive-trunk-hadoop2 #170 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/170/])
    HIVE-4365 : wrong result in left semi join (Navis via Ashutosh Chauhan) (Revision 1470575)

     Result = FAILURE
hashutosh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1470575
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/ppd/OpProcFactory.java
* /hive/trunk/ql/src/test/queries/clientpositive/semijoin.q
* /hive/trunk/ql/src/test/results/clientpositive/semijoin.q.out
* /hive/trunk/ql/src/test/results/compiler/plan/join1.q.xml
* /hive/trunk/ql/src/test/results/compiler/plan/join2.q.xml
* /hive/trunk/ql/src/test/results/compiler/plan/join3.q.xml
* /hive/trunk/ql/src/test/results/compiler/plan/join4.q.xml
* /hive/trunk/ql/src/test/results/compiler/plan/join5.q.xml
* /hive/trunk/ql/src/test/results/compiler/plan/join6.q.xml
* /hive/trunk/ql/src/test/results/compiler/plan/join7.q.xml
* /hive/trunk/ql/src/test/results/compiler/plan/join8.q.xml
, Integrated in Hive-trunk-h0.21 #2075 (See [https://builds.apache.org/job/Hive-trunk-h0.21/2075/])
    HIVE-4365 : wrong result in left semi join (Navis via Ashutosh Chauhan) (Revision 1470575)

     Result = FAILURE
hashutosh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1470575
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/ppd/OpProcFactory.java
* /hive/trunk/ql/src/test/queries/clientpositive/semijoin.q
* /hive/trunk/ql/src/test/results/clientpositive/semijoin.q.out
* /hive/trunk/ql/src/test/results/compiler/plan/join1.q.xml
* /hive/trunk/ql/src/test/results/compiler/plan/join2.q.xml
* /hive/trunk/ql/src/test/results/compiler/plan/join3.q.xml
* /hive/trunk/ql/src/test/results/compiler/plan/join4.q.xml
* /hive/trunk/ql/src/test/results/compiler/plan/join5.q.xml
* /hive/trunk/ql/src/test/results/compiler/plan/join6.q.xml
* /hive/trunk/ql/src/test/results/compiler/plan/join7.q.xml
* /hive/trunk/ql/src/test/results/compiler/plan/join8.q.xml
]