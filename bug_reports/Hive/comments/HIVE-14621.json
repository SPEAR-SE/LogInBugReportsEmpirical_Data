[The reason is that the code relies on cache for refcount increment; no cache means no refcount
[~prasanth_j] can you take a look?, Mostly looks good. 

{code}
LowLevelCacheImpl cacheImpl = new LowLevelCacheImpl(cacheMetrics, cachePolicy, allocator, true);
cacheImpl.init();
{code}

can we do init() inside ctor? so that we can avoid {code}cache = cacheImpl;{code}. 

Also can you add a test case for this?, Impl is still needed for other interfaces that it implements as we pass it on to other object. Renamed the call to startThreads for clarity... do you think we should start threads in ctor?

As for tests, we don't have any for this mode now. IO is initialized during driver init, so we'd need a separate CliDriver.

Btw, I was going to combine the interfaces for buffermanager and cache, since in both cases one object is used for both, but I couldn't come up with a name better than "CacheAndBufferManager", so I didn't do that., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12825358/HIVE-14621.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 8 failed/errored test(s), 10461 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.org.apache.hadoop.hive.cli.TestCliDriver
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[acid_mapjoin]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ctas]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_join_part_col_char]
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[acid_bucket_pruning]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainuser_3]
org.apache.hive.jdbc.TestJdbcWithMiniHS2.testAddJarConstructorUnCaching
org.apache.hive.service.cli.operation.TestOperationLoggingLayout.testSwitchLogLayout
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/978/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/978/console
Test logs: http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-978/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 8 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12825358 - PreCommit-HIVE-MASTER-Build, Test failures appear unrelated (mostly the usual stats/hashtable order changes), 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12825380/HIVE-14621.01.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 7 failed/errored test(s), 10461 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.org.apache.hadoop.hive.cli.TestCliDriver
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[acid_mapjoin]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ctas]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_join_part_col_char]
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[acid_bucket_pruning]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainuser_3]
org.apache.hive.service.cli.operation.TestOperationLoggingLayout.testSwitchLogLayout
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/984/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/984/console
Test logs: http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-984/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12825380 - PreCommit-HIVE-MASTER-Build, +1, Committed. Thanks for the review!
, Doc note:  This removes the "allocator" value from *hive.llap.io.memory.mode* and revises its description accordingly, so the wiki needs to be updated for the change in 2.1.1.

* [Configuration Properties -- hive.llap.io.memory.mode | https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.llap.io.memory.mode]

Added a TODOC2.1.1 label.]