[[~daijy] Can you please take a look at this change?, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12883582/HIVE-17385.3.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 4 failed/errored test(s), 11001 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vectorized_date_funcs] (batchId=73)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=235)
org.apache.hadoop.hive.ql.parse.TestExport.shouldExportImportATemporaryTable (batchId=218)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/6527/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/6527/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6527/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12883582 - PreCommit-HIVE-Build, Fixing the TestExport.shouldExportImportATemporaryTable failure., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12883866/HIVE-17385.4.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 5 failed/errored test(s), 11009 tests executed
*Failed tests:*
{noformat}
TestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=100)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=234)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/6557/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/6557/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6557/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12883866 - PreCommit-HIVE-Build, Test results looks good now., Yes, we shall use the same logic for both bootstrap and incremental dump, nice catch. However, shall we simply skip non-native table instead of throw exception? Also why do we do null check on ImportSemanticAnalyzer? Do you see a case we load a null table?, [~daijy] Regarding the exception, I am sticking with the old logic, i.e. throwing if replicationSpec.isInReplicationScope() is false and tableHandle.isNonNative() is true. We do skip the non-native silently if replicationSpec.isInReplicationScope() is true, which is the case in our incremental dump scenario.

We do the null check on ImportSemanticAnalyzer because we do run into the null table case after making the above dump change. Also a null check is a good practice/convention., Talked with [~taoli-hwx] off line, we'd better not dump tables which are marked "should not export", rather than dump it and skip on load side. [~taoli-hwx] is checking if it is easy to fix., [~daijy] For the CreateTableHandler, we can avoid dumping the table by early checking if it needs to be dumped. Please refer to latest patch. For the other repl scenarios, we can optimize them in a separate task., +1 pending test. Can you create a separate Jira to track the bootstrap optimization?, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12884770/HIVE-17385.5.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 7 failed/errored test(s), 11020 tests executed
*Failed tests:*
{noformat}
TestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=234)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=234)
org.apache.hadoop.hive.ql.parse.TestExport.shouldExportImportATemporaryTable (batchId=218)
org.apache.hive.hcatalog.api.repl.commands.TestCommands.testNoopReplEximCommands (batchId=180)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/6623/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/6623/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6623/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12884770 - PreCommit-HIVE-Build, Created HIVE-17422 as followup task.

The latest unit test result is not reflecting the latest change. Just re-submitted the patch and hopefully we will have another test run., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12884781/HIVE-17385.7.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 6 failed/errored test(s), 11022 tests executed
*Failed tests:*
{noformat}
TestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)
org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[smb_mapjoin_16] (batchId=239)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=234)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=234)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/6626/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/6626/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6626/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12884781 - PreCommit-HIVE-Build, Test result looks good. cc [~daijy], Patch pushed to master., Thanks [~daijy], This jira is resolved and released with Hive 3.0 If you find an issue with it, please create a new jira.]