[[~pxiong] can you take a look?
[~sushanth] ok for 1.2?, LGTM. Thanks!, [~pxiong] do you know why it would request stats with 0 columns?, I have no idea but I would start from the query that request stats with 0 columns. And if I remembered correctly, I remembered that [~ashutoshc] committed a patch to deal with a similar issue (empty partition or empty columns) several weeks ago. He may have a better answer. Thanks., 

{color:red}Overall{color}: -1 no tests executed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12738419/HIVE-10965.patch

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4217/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4217/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4217/

Messages:
{noformat}
**** This message was trimmed, see log for full details ****
[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ hive-hwi ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory /data/hive-ptest/working/apache-github-source-source/hwi/src/test/resources
[INFO] Copying 3 resources
[INFO] 
[INFO] --- maven-antrun-plugin:1.7:run (setup-test-dirs) @ hive-hwi ---
[INFO] Executing tasks

main:
   [delete] Deleting directory /data/hive-ptest/working/apache-github-source-source/hwi/target/tmp
   [delete] Deleting directory /data/hive-ptest/working/apache-github-source-source/hwi/target/warehouse
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/hwi/target/tmp
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/hwi/target/warehouse
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/hwi/target/tmp/conf
     [copy] Copying 11 files to /data/hive-ptest/working/apache-github-source-source/hwi/target/tmp/conf
[INFO] Executed tasks
[INFO] 
[INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ hive-hwi ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-surefire-plugin:2.16:test (default-test) @ hive-hwi ---
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Hive ODBC 2.0.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-enforcer-plugin:1.3.1:enforce (enforce-no-snapshots) @ hive-odbc ---
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.5:process (default) @ hive-odbc ---
[INFO] 
[INFO] --- maven-antrun-plugin:1.7:run (define-classpath) @ hive-odbc ---
[INFO] Executing tasks

main:
[INFO] Executed tasks
[INFO] 
[INFO] --- maven-antrun-plugin:1.7:run (setup-test-dirs) @ hive-odbc ---
[INFO] Executing tasks

main:
   [delete] Deleting directory /data/hive-ptest/working/apache-github-source-source/odbc/target/tmp
   [delete] Deleting directory /data/hive-ptest/working/apache-github-source-source/odbc/target/warehouse
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/odbc/target/tmp
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/odbc/target/warehouse
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/odbc/target/tmp/conf
     [copy] Copying 11 files to /data/hive-ptest/working/apache-github-source-source/odbc/target/tmp/conf
[INFO] Executed tasks
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Hive Shims Aggregator 2.0.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-enforcer-plugin:1.3.1:enforce (enforce-no-snapshots) @ hive-shims-aggregator ---
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.5:process (default) @ hive-shims-aggregator ---
[INFO] 
[INFO] --- maven-antrun-plugin:1.7:run (define-classpath) @ hive-shims-aggregator ---
[INFO] Executing tasks

main:
[INFO] Executed tasks
[INFO] 
[INFO] --- maven-antrun-plugin:1.7:run (setup-test-dirs) @ hive-shims-aggregator ---
[INFO] Executing tasks

main:
   [delete] Deleting directory /data/hive-ptest/working/apache-github-source-source/shims/target/tmp
   [delete] Deleting directory /data/hive-ptest/working/apache-github-source-source/shims/target/warehouse
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/shims/target/tmp
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/shims/target/warehouse
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/shims/target/tmp/conf
     [copy] Copying 11 files to /data/hive-ptest/working/apache-github-source-source/shims/target/tmp/conf
[INFO] Executed tasks
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Hive TestUtils 2.0.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-enforcer-plugin:1.3.1:enforce (enforce-no-snapshots) @ hive-testutils ---
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.5:process (default) @ hive-testutils ---
[INFO] 
[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hive-testutils ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory /data/hive-ptest/working/apache-github-source-source/testutils/src/main/resources
[INFO] Copying 3 resources
[INFO] 
[INFO] --- maven-antrun-plugin:1.7:run (define-classpath) @ hive-testutils ---
[INFO] Executing tasks

main:
[INFO] Executed tasks
[INFO] 
[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hive-testutils ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ hive-testutils ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory /data/hive-ptest/working/apache-github-source-source/testutils/src/test/resources
[INFO] Copying 3 resources
[INFO] 
[INFO] --- maven-antrun-plugin:1.7:run (setup-test-dirs) @ hive-testutils ---
[INFO] Executing tasks

main:
   [delete] Deleting directory /data/hive-ptest/working/apache-github-source-source/testutils/target/tmp
   [delete] Deleting directory /data/hive-ptest/working/apache-github-source-source/testutils/target/warehouse
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/testutils/target/tmp
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/testutils/target/warehouse
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/testutils/target/tmp/conf
     [copy] Copying 11 files to /data/hive-ptest/working/apache-github-source-source/testutils/target/tmp/conf
[INFO] Executed tasks
[INFO] 
[INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ hive-testutils ---
[INFO] No sources to compile
[INFO] 
[INFO] --- maven-surefire-plugin:2.16:test (default-test) @ hive-testutils ---
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Hive Packaging 2.0.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-enforcer-plugin:1.3.1:enforce (enforce-no-snapshots) @ hive-packaging ---
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.5:process (default) @ hive-packaging ---
[INFO] 
[INFO] --- maven-antrun-plugin:1.7:run (define-classpath) @ hive-packaging ---
[INFO] Executing tasks

main:
[INFO] Executed tasks
[INFO] 
[INFO] --- maven-antrun-plugin:1.7:run (setup-test-dirs) @ hive-packaging ---
[INFO] Executing tasks

main:
   [delete] Deleting directory /data/hive-ptest/working/apache-github-source-source/packaging/target/tmp
   [delete] Deleting directory /data/hive-ptest/working/apache-github-source-source/packaging/target/warehouse
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/packaging/target/tmp
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/packaging/target/warehouse
    [mkdir] Created dir: /data/hive-ptest/working/apache-github-source-source/packaging/target/tmp/conf
     [copy] Copying 11 files to /data/hive-ptest/working/apache-github-source-source/packaging/target/tmp/conf
[INFO] Executed tasks
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary:
[INFO] 
[INFO] Hive .............................................. SUCCESS [9.862s]
[INFO] Hive Shims Common ................................. SUCCESS [7.892s]
[INFO] Hive Shims 0.20S .................................. SUCCESS [2.531s]
[INFO] Hive Shims 0.23 ................................... SUCCESS [7.885s]
[INFO] Hive Shims Scheduler .............................. SUCCESS [1.840s]
[INFO] Hive Shims ........................................ SUCCESS [2.613s]
[INFO] Hive Common ....................................... SUCCESS [6.660s]
[INFO] Hive Serde ........................................ SUCCESS [4.302s]
[INFO] Hive Metastore .................................... SUCCESS [11.997s]
[INFO] Hive Ant Utilities ................................ SUCCESS [1.337s]
[INFO] Spark Remote Client ............................... SUCCESS [19.112s]
[INFO] Hive Query Language ............................... SUCCESS [37.280s]
[INFO] Hive Service ...................................... SUCCESS [4.761s]
[INFO] Hive Accumulo Handler ............................. SUCCESS [4.193s]
[INFO] Hive JDBC ......................................... SUCCESS [1.395s]
[INFO] Hive Beeline ...................................... SUCCESS [2.807s]
[INFO] Hive CLI .......................................... SUCCESS [3.470s]
[INFO] Hive Contrib ...................................... SUCCESS [3.245s]
[INFO] Hive HBase Handler ................................ SUCCESS [6.626s]
[INFO] Hive HCatalog ..................................... SUCCESS [0.829s]
[INFO] Hive HCatalog Core ................................ SUCCESS [1.615s]
[INFO] Hive HCatalog Pig Adapter ......................... SUCCESS [3.137s]
[INFO] Hive HCatalog Server Extensions ................... SUCCESS [3.043s]
[INFO] Hive HCatalog Webhcat Java Client ................. SUCCESS [1.487s]
[INFO] Hive HCatalog Webhcat ............................. SUCCESS [12.102s]
[INFO] Hive HCatalog Streaming ........................... SUCCESS [3.613s]
[INFO] Hive HWI .......................................... SUCCESS [2.431s]
[INFO] Hive ODBC ......................................... SUCCESS [1.683s]
[INFO] Hive Shims Aggregator ............................. SUCCESS [0.130s]
[INFO] Hive TestUtils .................................... SUCCESS [0.225s]
[INFO] Hive Packaging .................................... SUCCESS [1.650s]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2:54.431s
[INFO] Finished at: Mon Jun 08 18:01:46 EDT 2015
[INFO] Final Memory: 89M/260M
[INFO] ------------------------------------------------------------------------
+ cd itests
+ mvn -B clean install -DskipTests -Dmaven.repo.local=/data/hive-ptest/working/maven -Phadoop-2
[INFO] Scanning for projects...
[ERROR] The build could not read 1 project -> [Help 1]
[ERROR]   
[ERROR]   The project org.apache.hive:hive-it-qfile-accumulo:1.3.0-SNAPSHOT (/data/hive-ptest/working/apache-github-source-source/itests/qtest-accumulo/pom.xml) has 1 error
[ERROR]     Non-resolvable parent POM: Could not find artifact org.apache.hive:hive-it:pom:1.3.0-SNAPSHOT and 'parent.relativePath' points at wrong local POM @ line 20, column 11 -> [Help 2]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/ProjectBuildingException
[ERROR] [Help 2] http://cwiki.apache.org/confluence/display/MAVEN/UnresolvableModelException
+ exit 1
'
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12738419 - PreCommit-HIVE-TRUNK-Build, Patch looks good.  I will also suggest to add this check on client side too, i.e., HiveMetaStorClient::getAggrColStatsFor() so that we dont do a trip to metastore in such cases just to get a null object., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12738677/HIVE-10965.01.patch

{color:red}ERROR:{color} -1 due to 6 failed/errored test(s), 9006 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_annotate_stats_part
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_cbo_stats
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_cbo_stats
org.apache.hive.beeline.TestSchemaTool.testSchemaInit
org.apache.hive.beeline.TestSchemaTool.testSchemaUpgrade
org.apache.hive.hcatalog.streaming.TestStreaming.testTransactionBatchEmptyCommit
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4233/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4233/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4233/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12738677 - PreCommit-HIVE-TRUNK-Build, Update to fix one more code path, You can go ahead and commit to branch-1.2 after you commit to branch-1 and master. The branch is still open as long as you add it to the wiki : https://cwiki.apache.org/confluence/display/Hive/Hive+1.2+Release+Status, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12738896/HIVE-10965.02.patch

{color:red}ERROR:{color} -1 due to 2 failed/errored test(s), 9007 tests executed
*Failed tests:*
{noformat}
org.apache.hive.beeline.TestSchemaTool.testSchemaInit
org.apache.hive.beeline.TestSchemaTool.testSchemaUpgrade
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4238/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4238/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4238/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12738896 - PreCommit-HIVE-TRUNK-Build, committed to master, branch-1 and branch-1.2
, This was also committed to branch-1.0 (for release 1.0.2).  Shouldn't 1.0.2 be listed in Fix Version/s so it will get picked up for the release notes?

See commit 0b511cad47b61236da48e2b9768b3e6e8148b4e1., Thanks for catching that [~leftylev]!
[~pxiong] was back porting some critical fixes to 1.0 line. I had an offline discussion with him now clarifying the process to him, he is going to update the fix version for couple of other jiras that were backported.
, Thanks, I wasn't sure if I should change the fix version myself, but this is better., Note, this fix introduces a bug that is fixed by https://issues.apache.org/jira/browse/HIVE-12083 , and thus, that patch must be present on all branches this was patched with., Well, this patch by itself covers many cases and doesn't cause a regression (the case that is broken in this patch is also broken before it).]