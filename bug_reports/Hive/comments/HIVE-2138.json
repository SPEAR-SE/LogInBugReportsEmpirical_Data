[Attached test file (index_auto_test_if_used) that should test whether indexes are used., Syed, if you get time to look into this one, it's a good one to fix for getting automatic index usage production-ready.
, fix + testcase, 
-----------------------------------------------------------
This is an automatically generated e-mail. To reply, visit:
https://reviews.apache.org/r/1255/
-----------------------------------------------------------

Review request for hive, John Sichi and Yongqiang He.


Summary
-------

return an empty array of input splits when we get back no results from the hiveIndexResult


This addresses bug HIVE-2138.
    https://issues.apache.org/jira/browse/HIVE-2138


Diffs
-----

  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java 1a1ecd7 
  ql/src/test/queries/clientpositive/index_auto_test_if_used.q PRE-CREATION 
  ql/src/test/results/clientpositive/index_auto_test_if_used.q.out PRE-CREATION 

Diff: https://reviews.apache.org/r/1255/diff


Testing
-------

added index_auto_test_if_used.q to the test suite


Thanks,

Syed

, A few comments added in Review Board.
, 
-----------------------------------------------------------
This is an automatically generated e-mail. To reply, visit:
https://reviews.apache.org/r/1255/#review1265
-----------------------------------------------------------



ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java
<https://reviews.apache.org/r/1255/#comment2898>

    We're not actually generating a dummy file now...



ql/src/test/queries/clientpositive/index_auto_test_if_used.q
<https://reviews.apache.org/r/1255/#comment2900>

    Could you add a note that this test relies on the fact that we currently attempt to use indexes even when they are out of date, and that once we fix that by detecting stale indexes, we'll need another way to verify that the index actually had an effect?
    



ql/src/test/queries/clientpositive/index_auto_test_if_used.q
<https://reviews.apache.org/r/1255/#comment2899>

    Reissue query to demonstrate that results are returned after index lookup is disabled.


- John


On 2011-08-02 02:35:11, Syed Albiz wrote:
bq.  
bq.  -----------------------------------------------------------
bq.  This is an automatically generated e-mail. To reply, visit:
bq.  https://reviews.apache.org/r/1255/
bq.  -----------------------------------------------------------
bq.  
bq.  (Updated 2011-08-02 02:35:11)
bq.  
bq.  
bq.  Review request for hive, John Sichi and Yongqiang He.
bq.  
bq.  
bq.  Summary
bq.  -------
bq.  
bq.  return an empty array of input splits when we get back no results from the hiveIndexResult
bq.  
bq.  
bq.  This addresses bug HIVE-2138.
bq.      https://issues.apache.org/jira/browse/HIVE-2138
bq.  
bq.  
bq.  Diffs
bq.  -----
bq.  
bq.    ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java 1a1ecd7 
bq.    ql/src/test/queries/clientpositive/index_auto_test_if_used.q PRE-CREATION 
bq.    ql/src/test/results/clientpositive/index_auto_test_if_used.q.out PRE-CREATION 
bq.  
bq.  Diff: https://reviews.apache.org/r/1255/diff
bq.  
bq.  
bq.  Testing
bq.  -------
bq.  
bq.  added index_auto_test_if_used.q to the test suite
bq.  
bq.  
bq.  Thanks,
bq.  
bq.  Syed
bq.  
bq.

, 
-----------------------------------------------------------
This is an automatically generated e-mail. To reply, visit:
https://reviews.apache.org/r/1255/
-----------------------------------------------------------

(Updated 2011-08-02 18:48:23.995744)


Review request for hive, John Sichi and Yongqiang He.


Changes
-------

addressed comments


Summary
-------

return an empty array of input splits when we get back no results from the hiveIndexResult


This addresses bug HIVE-2138.
    https://issues.apache.org/jira/browse/HIVE-2138


Diffs (updated)
-----

  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java 1a1ecd7 
  ql/src/test/queries/clientpositive/index_auto_test_if_used.q PRE-CREATION 
  ql/src/test/results/clientpositive/index_auto_test_if_used.q.out PRE-CREATION 

Diff: https://reviews.apache.org/r/1255/diff


Testing
-------

added index_auto_test_if_used.q to the test suite


Thanks,

Syed

, +1, will commit when tests pass.
, replace testcase with a robust testcase to check for empty splits, 
-----------------------------------------------------------
This is an automatically generated e-mail. To reply, visit:
https://reviews.apache.org/r/1255/
-----------------------------------------------------------

(Updated 2011-08-02 23:44:30.658334)


Review request for hive, John Sichi and Yongqiang He.


Changes
-------

replace test case with something more robust


Summary
-------

return an empty array of input splits when we get back no results from the hiveIndexResult


This addresses bug HIVE-2138.
    https://issues.apache.org/jira/browse/HIVE-2138


Diffs (updated)
-----

  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java 1a1ecd7 
  ql/src/test/queries/clientpositive/index_auto_empty.q PRE-CREATION 
  ql/src/test/queries/clientpositive/index_auto_test_if_used.q PRE-CREATION 
  ql/src/test/results/clientpositive/index_auto_empty.q.out PRE-CREATION 

Diff: https://reviews.apache.org/r/1255/diff


Testing
-------

added index_auto_test_if_used.q to the test suite


Thanks,

Syed

, index_auto_test_if_used.q should not be in this patch., removed old testcase, 
-----------------------------------------------------------
This is an automatically generated e-mail. To reply, visit:
https://reviews.apache.org/r/1255/
-----------------------------------------------------------

(Updated 2011-08-04 21:56:31.633797)


Review request for hive, John Sichi and Yongqiang He.


Changes
-------

removed stale testcase


Summary
-------

return an empty array of input splits when we get back no results from the hiveIndexResult


This addresses bug HIVE-2138.
    https://issues.apache.org/jira/browse/HIVE-2138


Diffs (updated)
-----

  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java 1a1ecd7 
  ql/src/test/queries/clientpositive/index_auto_empty.q PRE-CREATION 
  ql/src/test/results/clientpositive/index_auto_empty.q.out PRE-CREATION 

Diff: https://reviews.apache.org/r/1255/diff


Testing
-------

added index_auto_test_if_used.q to the test suite


Thanks,

Syed

, index_auto_empty needs its log updated:

    [junit] < PREHOOK: type: ALTERINDEX_REBUILD
    [junit] ---
    [junit] > PREHOOK: type: QUERY
    [junit] 23c23
    [junit] < POSTHOOK: type: ALTERINDEX_REBUILD
    [junit] ---
, regenerated patch with updated testcase output, 
-----------------------------------------------------------
This is an automatically generated e-mail. To reply, visit:
https://reviews.apache.org/r/1255/
-----------------------------------------------------------

(Updated 2011-08-05 19:05:05.682867)


Review request for hive, John Sichi and Yongqiang He.


Changes
-------

updated testcases with new output


Summary
-------

return an empty array of input splits when we get back no results from the hiveIndexResult


This addresses bug HIVE-2138.
    https://issues.apache.org/jira/browse/HIVE-2138


Diffs (updated)
-----

  ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java 1a1ecd7 
  ql/src/test/queries/clientpositive/index_auto_empty.q PRE-CREATION 
  ql/src/test/results/clientpositive/index_auto_empty.q.out PRE-CREATION 

Diff: https://reviews.apache.org/r/1255/diff


Testing
-------

added index_auto_test_if_used.q to the test suite


Thanks,

Syed

, Giving it another go now.
, Committed.  Thanks Syed!
, Integrated in Hive-trunk-h0.21 #881 (See [https://builds.apache.org/job/Hive-trunk-h0.21/881/])
    HIVE-2138. Exception when no splits returned from index.
(Syed Albiz via jvs)

jvs : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1155059
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/index/HiveIndexedInputFormat.java
* /hive/trunk/ql/src/test/results/clientpositive/index_auto_empty.q.out
* /hive/trunk/ql/src/test/queries/clientpositive/index_auto_empty.q
]