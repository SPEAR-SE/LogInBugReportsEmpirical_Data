[cc: [~thejas] [~ajisakaa], bq. the goal of the test is to check that hive doesn't let user1 to create a table with a location under an unowned path.
AFAIK, now the goal is invalid. HIVE-12408 enabled a user to create a table with a location under the path where the user has read and write privileges. Ownership is not related now., Then we shall just delete this test. Seems like it has served its purpose., Thanks [~ashutoshc] for the comment. Attaching a patch to remove the test., [~ajisakaa] I thinked read/write when I've written ownership - sorry; so the user doesn't have write privileges - the original buglet people do ctas with arbitrary locations; this test is added to ensure that create table doesn't get broken later.

I've left out the current SemanticException's message:
{code}
FAILED: SemanticException [Error 10043]: Either list of columns or a custom serializer should be specified
{code}

I don't entirely agree with the removal of the test; because it seems to me that the previously working sql statements became unsupported somehow; maybe the test needs updating?

I've made a small change to the test; there was an interesting statement {{create table foo1 location 'hdfs:///tmp/ct_noperm_loc/foo1'}} which have missed the column definitions....

the test now errors out with the following exception: {{FAILED: HiveAccessControlException Permission denied: Principal [name=user1, type=USER] does not have following privileges for operation CREATETABLE [[INSERT, DELETE] on Object [type=DFS_URI, name=hdfs://localhost:34855/tmp/ct_noperm_loc/foo1]]}} which is good

patch to keep test: https://hastebin.com/natotejahu.diff, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12896826/HIVE-18012.001.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 10 failed/errored test(s), 11371 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[dbtxnmgr_showlocks] (batchId=77)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=62)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[unionDistinct_1] (batchId=146)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[llap_acid_fast] (batchId=157)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[sysdb] (batchId=156)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=102)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[subquery_multi] (batchId=111)
org.apache.hadoop.hive.cli.TestSparkPerfCliDriver.testCliDriver[query39] (batchId=245)
org.apache.hadoop.hive.cli.control.TestDanglingQOuts.checkDanglingQOut (batchId=206)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testConstraints (batchId=223)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/7739/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/7739/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-7739/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 10 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12896826 - PreCommit-HIVE-Build, Thanks!
bq. I don't entirely agree with the removal of the test; because it seems to me that the previously working sql statements became unsupported somehow; maybe the test needs updating?
Yes. It's better to update the test instead of deleting it. I'll review your patch., thanks [~ajisakaa], originally I was just worried about that we are making something accidentally unsupported. I think the {{create table}} statment without the column definition was bad that it have been accepted earlier., +1, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12897063/HIVE-18012.02.patch

{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 9 failed/errored test(s), 11374 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[dbtxnmgr_showlocks] (batchId=77)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[unionDistinct_1] (batchId=146)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=162)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[llap_acid_fast] (batchId=157)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[sysdb] (batchId=156)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[subquery_multi] (batchId=111)
org.apache.hadoop.hive.cli.control.TestDanglingQOuts.checkDanglingQOut (batchId=206)
org.apache.hadoop.hive.ql.exec.tez.TestWorkloadManager.testApplyPlanQpChanges (batchId=281)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testConstraints (batchId=223)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/7766/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/7766/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-7766/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 9 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12897063 - PreCommit-HIVE-Build, Here are two questions:
1. When runnning the test by {{mvn test -Dtest=TestNegativeCliDriver -Dqfile=ct_noperm_loc.q}}, the test was skipped. I had to modify testconfiguration.properties to run the test. Is it correct?
2. After modifying the testconfiguration.properties, the test fails when creating {{hdfs:///tmp/ct_noperm_loc}}.

{noformat:title=ct_noperm_loc.q.out.orig}
Command -mkdir -p hdfs:///tmp/ct_noperm_loc failed with exit code = 1
Query returned non-zero code: 1, cause: null
{noformat}

Am I missing something?, unfortunately it's run by: {{TestNegativeMinimrCliDriver}} ; I think it could be executed fine: https://travis-ci.org/kgyrtkirk/hive/builds/301432026#L920

because I also suffer from the testconfiguration.properties problems ; I usually use a different command to re-execute a pre-existing qtest:
{code}
mvn install -Pitests '-Dtest=Test*CliDriver#*[ct_noperm_loc]'
{code}, Thank you for the information! It worked. +1 (non-binding)., Pushed to master. Thanks, Zoltan!, This jira is resolved and released with Hive 3.0 If you find an issue with it, please create a new jira.]