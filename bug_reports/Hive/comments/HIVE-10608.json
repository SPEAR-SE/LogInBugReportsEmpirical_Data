[[~apivovarov] The line "if (e.getMessage().matches("(?s).*(IO|TTransport)Exception.*"));" should be a comment. The caught MetaException should either be thrown out from reloginExpiringKeytabUser or base.reconnect() which wrap only the IOException or TTransportException at this moment, so there is no need to check the wrapped exception since these two situations need retrying regardless. , reconnect() will throw MetaException which does not wrap any other Exceptions in case of localMetaStore=true (HiveMetaStoreClient line 308)
{code}
  @Override
  public void reconnect() throws MetaException {
    if (localMetaStore) {
      // For direct DB connections we don't yet support reestablishing connections.
      throw new MetaException("For direct MetaStore DB connections, we don't support retries" +
          " at the client level.");
    } 
{code}

Should we just fix the bug like this
{code}
  } catch (MetaException e) {
    if (e.getMessage().matches("(?s).*(IO|TTransport)Exception.*")) {
      caughtException = e;
    }
  }
{code}, [~apivovarov] Yeah, error out immediately for this local HMS mode will be more efficient.  +1 (non-binding), [~apivovarov] If so, I think the block should be like following by re-throwing MetaException e for reasons rather than IOException and TTransportException:
{code}
  } catch (MetaException e) {
    if (e.getMessage().matches("(?s).*(IO|TTransport)Exception.*")) {
      caughtException = e;
    } else {
     throw e;
    }
  }
{code}, patch #1, +1 (non-binding), +1, patch #1, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12731023/HIVE-10608.1.patch

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 8916 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.thrift.TestHadoop20SAuthBridge.testSaslWithHiveMetaStore
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3799/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3799/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3799/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12731023 - PreCommit-HIVE-TRUNK-Build, Committed to trunk, thanks Alex for patch and Chaoyu for additional review.]