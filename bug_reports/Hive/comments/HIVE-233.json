[Marking this as a blocker for 0.3 as we need to understand this better and see if there is a workaround., CREATE TABLE dest1(key INT, value STRING, key1 INT, value1 STRING) partitioned by (ds string\
, hour string) STORED AS TEXTFILE;

FROM (
  FROM src
  SELECT TRANSFORM(src.key, src.value, src.key, src.value)
         USING '/bin/cat' AS (tkey, tvalue, tkey1, tvalue1)
  CLUSTER BY tkey
) tmap
INSERT OVERWRITE TABLE dest1 PARTITION (ds='2009-03-10', hour='2') SELECT tmap.tkey, tmap.tv\
alue, tmap.tkey1, tmap.tvalue1 WHERE tmap.tkey < 100;

SELECT dest1.* FROM dest1;


The above testcase works fine.

Josh, can you give more details ? data in activities table, your mapper script., Sadly due to this issue I have changed the way I write and execute all my queries so I don't really have any of the queries or setup around for doing it anymore. If your test cases work then maybe I was just doing something wrong. I may have another case in the future where I make a query sort of like this one again but it won't be for a while.

Maybe this issue should just be marked as something else for now. 

my activities table looks like this:

CREATE TABLE activities 
(occurred_at INT, actor_id STRING, actee_id STRING, properties MAP<STRING, STRING>) 
PARTITIONED BY (account STRING, application STRING, dataset STRING, hour INT) 
CLUSTERED BY (actor_id, actee_id) INTO 32 BUCKETS 
ROW FORMAT DELIMITED 
COLLECTION ITEMS TERMINATED BY '44'
MAP KEYS TERMINATED BY '58'
STORED AS TEXTFILE;

The script can output anything in the proper format and the results are the same., Closing it for now since it could not be reproduced]