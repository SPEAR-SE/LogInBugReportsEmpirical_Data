[hi [~dmtolpeko]. i reproduce this problem. i will try to fix it., this problem is fixed in HIVE-13540
it occurs because closeQuery using wrong connection which is exec.conf.defaultConnection, but it is not executed connection
commits for HIVE-13540 had changed the wrong connetion to the right one , hi, [~dkozlovdaisy]. you can try the latest master version to resolve it.
[~dmtolpeko] this problem can be closed ?, Hi Fei Hui, Thanks for your comments. Could you, please, share instructions how to apply the patch.
, hi [~dkozlovdaisy]  in HIVE-13540's commit. it contians as below

hplsql/src/main/java/org/apache/hive/hplsql/Select.java 
hplsql/src/main/java/org/apache/hive/hplsql/Stmt.java

change exec.conf.defaultConnection to conn;

diff --git hplsql/src/main/java/org/apache/hive/hplsql/Select.java hplsql/src/main/java/org/apache/hive/hplsql/Select.java
index 589e984..403810c 100644
--- hplsql/src/main/java/org/apache/hive/hplsql/Select.java
+++ hplsql/src/main/java/org/apache/hive/hplsql/Select.java
@@ -147,10 +147,10 @@ else if (ctx.parent instanceof HplsqlParser.StmtContext) {
     }
......
-      exec.closeQuery(query, exec.conf.defaultConnection);
+      exec.closeQuery(query, conn);

       return 1;
     }

-    exec.closeQuery(query, exec.conf.defaultConnection);
+    exec.closeQuery(query, conn);

     return 0;
   }



diff --git hplsql/src/main/java/org/apache/hive/hplsql/Stmt.java hplsql/src/main/java/org/apache/hive/hplsql/Stmt.java
index 17d2195..c044616 100644
--- hplsql/src/main/java/org/apache/hive/hplsql/Stmt.java
+++ hplsql/src/main/java/org/apache/hive/hplsql/Stmt.java
......
@@ -793,7 +803,7 @@ else if (type == Conn.Type.HIVE && conf.insertValues == Conf.InsertValues.SELECT
       return 1;
     }
     exec.setSqlSuccess();
-    exec.closeQuery(query, exec.conf.defaultConnection);
+    exec.closeQuery(query, conn);
     return 0;
   }

you can patch it, patch for branch-2.0 & branch-2.1
master branch had fixed this problem., update patch
remove 'No newline at end of file', 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12841001/HIVE-14804.1-branch-2.1.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 10 failed/errored test(s), 10474 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit (batchId=51)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12 (batchId=87)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_order_null (batchId=35)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket (batchId=118)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union_fast_stats (batchId=89)
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJarWithoutAddDriverClazz[0] (batchId=286)
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJar[0] (batchId=286)
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJar[1] (batchId=286)
org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler.org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler (batchId=514)
org.apache.hive.jdbc.TestJdbcWithMiniLlap.testLlapInputFormatEndToEnd (batchId=487)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/2339/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/2339/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2339/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 10 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12841001 - PreCommit-HIVE-Build, hi [~dmtolpeko]
upload the patch for branch-2.0 & branch-2.1 to fix this problem
could you please give suggestions and review it ?
failed cases are not related, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12841006/HIVE-14804.2-branch-2.1.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 10 failed/errored test(s), 10476 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit (batchId=51)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12 (batchId=87)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_13 (batchId=44)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_order_null (batchId=35)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket (batchId=118)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union_fast_stats (batchId=89)
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJarWithoutAddDriverClazz[0] (batchId=286)
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJar[0] (batchId=286)
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJar[1] (batchId=286)
org.apache.hive.jdbc.TestJdbcWithMiniLlap.testLlapInputFormatEndToEnd (batchId=487)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/2340/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/2340/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2340/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 10 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12841006 - PreCommit-HIVE-Build, hi [~Ferd]
could you please give suggestions and review it ?, Checked patch 2 into branches 2.0 and 2.1.  Thank Fei for the patch and for your patience., [~alangates] thanks for review and commit, [~alangates], the commits have typos in the JIRA number:  they say HIVE-14084 instead of HIVE-14804.

Please update errata.txt for commits a27ccaaafc71cea2780506134ee38808c3a7a46a and b45e4010842c19de32c97872ade165a371ff299b.  Thanks.

Example of updating errata.txt:  HIVE-11876.]