[Another query that can show this problem more clearly is:
{code:sql}
select t.col from ( 
    select transform(col) using 'cat' as (COL string) from transform3_t1
) t;
{code}

It fails with below error:
{noformat}
FAILED: SemanticException [Error 10002]: Line 1:9 Invalid column reference 'col'
{noformat}

Changing {{as (COL string)}} to {{as (col string)}} makes the query run properly., Attach a patch, [~Yibing], you should include the test result file in the patch too. (transform3.q.out), [~Yibing], I generate another patch to include the output and also change a little on the test to make it more relevant to the fix. 
In order to attach it, I have to temporary change the assignee of the bug, then change back to you.  , Thank you, [~ychena]!, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12867633/HIVE-16646.2.patch

{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 5 failed/errored test(s), 10688 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[orc_merge_incompat2] (batchId=79)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[columnstats_part_coltype] (batchId=156)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_join30] (batchId=149)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_3] (batchId=97)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainuser_3] (batchId=97)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/5206/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/5206/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-5206/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12867633 - PreCommit-HIVE-Build, The failures are not related. 
Following two tests passed in my local machine:
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[orc_merge_incompat2] (batchId=79)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[columnstats_part_coltype] (batchId=156)
The rest failures aged more than 2.


, The patch LGTM +1, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12867633/HIVE-16646.2.patch

{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 5 failed/errored test(s), 10688 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[mapjoin2] (batchId=236)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=144)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_join30] (batchId=149)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_3] (batchId=97)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainuser_3] (batchId=97)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/5212/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/5212/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-5212/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12867633 - PreCommit-HIVE-Build, These errors seem irrelevant. Could you please have a look as well [~ychena]?
, The failures are not related., Committed to master, Thanks [~Yibing] for your contribution!, [~ychena], you committed this to branch-2 as well as master so the fix version should be 2.4.0.  (3.0.0 can also be listed, but it isn't necessary.)

See commit 43f1d7791ed22411c701f4973316f49eaf004bf8., Thanks [~leftylev], just added 2.4 to the fix version., Hive 3.0.0 has been released so closing this jira.]