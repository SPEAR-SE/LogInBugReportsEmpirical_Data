[Patch 1 adds configuration parameters *hive.server2.read.socket.timeout* and *hive.server2.tcp.keepalive* to HiveConf.java and hive-default.xml.template.

(This comment is a search aid and a reminder to document them in the wiki after the patch is committed.), 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12652339/HIVE-6679.1.patch.txt

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 5669 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_root_dir_external_table
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/587/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/587/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-Build-587/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12652339, 

{color:green}Overall{color}: +1 all checks pass

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12666680/HIVE-6679.2.patch.txt

{color:green}SUCCESS:{color} +1 6171 tests passed

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/658/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/658/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-658/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12666680, Patch will need some rebasing. , Patch rebased on trunk. [~thejas] This will be a good addition to 14.1. What do you think?, The 3.patch does not have the http transport changes that were there in 2.patch. Is that intentional ?
I think enabling this by default makes sense, instead of having users set this if they run into issues. A timeout of around couple of minutes might be reasonable default.


, [~thejas] Yes, that was intentional since we already have a max idle time config for http mode. Let me enable the keepalive config by default. 
Regarding the timeout, do you think couple of minutes should be fine? I think we should keep the default pretty high since we don't want the server to throw {{SocketTimeoutException}} prematurely (note that the timeout doesn't close the socket, it just throws an exception in hitting the timeout on blocking calls).  , Patch .4 sets keepAlive to true by default for TCP sockets., +1, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12687288/HIVE-6679.3.patch

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 6703 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_schemeAuthority
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2080/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2080/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2080/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12687288 - PreCommit-HIVE-TRUNK-Build, [~vgumashta] Apache Thrift has added support for keep alive (THRIFT-2788). The trunk is already upgraded to use Thrift 0.9.2 which has that patch.
, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12687301/HIVE-6679.4.patch

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 6703 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udaf_covar_pop
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2081/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2081/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2081/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12687301 - PreCommit-HIVE-TRUNK-Build, Test failure not related., Thanks for pointing out [~prasadm]. I'll limit the scope of this one to 14.1 in that case.  , Doc note:  Patch 4 adds two configuration parameters (which are different from the two in patch 1):  *hive.server2.tcp.socket.blocking.timeout* and *hive.server2.tcp.socket.keepalive*.

Code review:  The time specification for *hive.server2.tcp.socket.blocking.timeout* could be done with a TimeValidator like others in HiveConf.java since 0.14.0, for example:

{code}
    METASTORE_CLIENT_CONNECT_RETRY_DELAY("hive.metastore.client.connect.retry.delay", "1s",
        new TimeValidator(TimeUnit.SECONDS),
{code}, [~leftylev] Patch 5 addresses review comments., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12687857/HIVE-6679.5.patch

{color:red}ERROR:{color} -1 due to 5 failed/errored test(s), 6713 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby3_map
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby3_map_multi_distinct
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_optimize_nullscan
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_schemeAuthority
org.apache.hive.hcatalog.streaming.TestStreaming.testTransactionBatchEmptyCommit
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2117/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2117/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2117/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12687857 - PreCommit-HIVE-TRUNK-Build, The socket timeout part of this still relevant for trunk. I think we should commit that part in trunk.
, HiveConf.java parameter definitions look good.

+1 (for configuration parameters only), Committed to branch 14. [~thejas] I'll create a new patch for trunk with just the socket timeout code., bq.  I'll create a new patch for trunk with just the socket timeout code.

Does this mean *hive.server2.tcp.socket.keepalive* will only exist in 0.14.1, not in 0.15?, [~leftylev] Yes, as of now. I'll add a patch for 15 shortly., [~thejas] V6 for 1.1.0 & trunk, 

{color:green}Overall{color}: +1 all checks pass

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12696010/HIVE-6679.6.patch

{color:green}SUCCESS:{color} +1 7421 tests passed

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2623/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2623/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2623/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12696010 - PreCommit-HIVE-TRUNK-Build, Currently this shows status Patch Available and resolution Unresolved because there's a patch for 1.1.0, although the 1.0.0 patch was committed and it is included in the release.  (I checked HiveConf.java for *hive.server2.tcp.socket.blocking.timeout* and *hive.server2.tcp.socket.keepalive* but didn't check other patch changes.)

Unfortunately the 1.0.0 release notes linked to the downloads page don't include this issue.  There may be other JIRA issues that were fixed in 1.0.0 but fell off the back of the cart when 0.15 was changed to 1.1 and then to 1.1.0.

* [1.0.0 release notes | https://issues.apache.org/jira/secure/ReleaseNote.jspa?version=12329278&styleName=Text&projectId=12310843], +1 .
Just a minor comment. Can you also update the description of HIVE_SERVER2_TCP_SOCKET_BLOCKING_TIMEOUT to say that its applicable only in binary mode, and for http mode, the equivalent is hive.server2.thrift.http.max.idle.time?, Deferring this to 1.3 since it'll need some testing., Per discussion with Vaibhav, confirming deferring out of branch-1.2]