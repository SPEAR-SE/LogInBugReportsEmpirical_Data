[Seems I misunderstood the problem. It assumes that table is sorted by group by key. So it works as expected.]