[Lenni, I am curious if you had the configuration decribed here https://issues.apache.org/jira/browse/HIVE-4762?focusedCommentId=13688852&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13688852 in your hive-site?

I don't think that is a catch all fix for our concurrency issues I am just curious if that would help resolve this specific issue., This is with an old version of DataNucleus, yet Hive upgraded a while ago (before this was raised). Using current DataNucleus there are zero reported concurrency problems, particularly if using either an auto-start mechanism or persistence.xml with datanucleus.persistenceUnitLoadClasses=true, [~andy]

We ran into the same issue with Hive-13. It happened from get_partitions_by_filter() and get_partition_names_ps() API, although while getting the table object. We use datanucleus versions 3.0.x. In our case, we run multiple MetaStore servers behind load balancer. We also have datanucleus.autoStartMechanism=SchemaTable since our backend is Oracle. In our case, until the server was restarted, the two Thrift APIs mentioned above kept failing which caused a lot of workflows to fail. This has happened twice in the last month. Any ideas/suggestions?

2015-03-20 06:16:07,652 INFO  [pool-2-thread-165] metastore.HiveMetaStore (HiveMetaStore.java:logInfo(637)) - 67: get_partitions_by_filter db=<db> tbl=<tbl> filter=[dt="2015032001"]
2015-03-20 06:16:07,715 ERROR [pool-2-thread-165] metastore.ObjectStore (ObjectStore.java:run(2681)) -
Invalid index 1 for DataStoreMapping.
org.datanucleus.exceptions.NucleusException: Invalid index 1 for DataStoreMapping.
        at org.datanucleus.store.mapped.mapping.PersistableMapping.getDatastoreMapping(PersistableMapping.java:309)
        at org.datanucleus.store.rdbms.scostore.BackingStoreHelper.appendWhereClauseForMapping(BackingStoreHelper.java:513)
        at org.datanucleus.store.rdbms.scostore.ElementContainerStore.getSizeStmt(ElementContainerStore.java:765)
        at org.datanucleus.store.rdbms.scostore.ElementContainerStore.getSize(ElementContainerStore.java:624)
        at org.datanucleus.store.rdbms.scostore.ElementContainerStore.size(ElementContainerStore.java:453)
        at org.datanucleus.store.types.sco.backed.List.size(List.java:542)
        at org.apache.hadoop.hive.metastore.ObjectStore.convertToSkewedValues(ObjectStore.java:1195)
        at org.apache.hadoop.hive.metastore.ObjectStore.convertToStorageDescriptor(ObjectStore.java:1173)
        at org.apache.hadoop.hive.metastore.ObjectStore.convertToStorageDescriptor(ObjectStore.java:1183)
        at org.apache.hadoop.hive.metastore.ObjectStore.convertToTable(ObjectStore.java:1040)
        at org.apache.hadoop.hive.metastore.ObjectStore.ensureGetTable(ObjectStore.java:2823)
        at org.apache.hadoop.hive.metastore.ObjectStore.access$1200(ObjectStore.java:153)
        at org.apache.hadoop.hive.metastore.ObjectStore$GetHelper.start(ObjectStore.java:2692)
        at org.apache.hadoop.hive.metastore.ObjectStore$GetHelper.run(ObjectStore.java:2664)
        at org.apache.hadoop.hive.metastore.ObjectStore.getPartitionsByFilterInternal(ObjectStore.java:2781)
        at org.apache.hadoop.hive.metastore.ObjectStore.getPartitionsByFilter(ObjectStore.java:2624)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:601)
        at org.apache.hadoop.hive.metastore.RawStoreProxy.invoke(RawStoreProxy.java:108)
        at $Proxy8.getPartitionsByFilter(Unknown Source)
        at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.get_partitions_by_filter(HiveMetaStore.java:4326)
        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Processor$get_partitions_by_filter.getResult(ThriftHiveMetastore.java:9356)
        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Processor$get_partitions_by_filter.getResult(ThriftHiveMetastore.java:9340)
        at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39)
        at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39)
        at org.apache.hadoop.hive.thrift.HadoopThriftAuthBridge20S$Server$TUGIAssumingProcessor$2.run(HadoopThriftAuthBridge20S.java:706)
        at org.apache.hadoop.hive.thrift.HadoopThriftAuthBridge20S$Server$TUGIAssumingProcessor$2.run(HadoopThriftAuthBridge20S.java:702)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:415)
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1694)
        at org.apache.hadoop.hive.thrift.HadoopThriftAuthBridge20S$Server$TUGIAssumingProcessor.process(HadoopThriftAuthBridge20S.java:702)
        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run_aroundBody0(TThreadPoolServer.java:207)
        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run_aroundBody1$advice(TThreadPoolServer.java:101)
        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:1)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
        at java.lang.Thread.run(Thread.java:722), hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., hi! Did you resolve this problem? It happend when we use hue to execute hql. And we set datanucleus.autoStartMechanism= SchemaTabler refered in fixed 4762,but it helpless., We hit this problem also in our Hive 0.11 HMS.  The problem continues to be there (and fails a lot of workflows) until we restart the metaserver.
, This patch will kill metastore on such error.  It's *not* a proper fix, but is going to be used in production in our environment to make sure that the failing MetastoreServer does not continue to fail our workflows.
, Canceling patch available status since this is not a patch we'll commit.  ]