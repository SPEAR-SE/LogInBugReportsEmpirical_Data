[This also happens with all usages of NumericHistogram (udaf histogram_numeric() too). This algorithm deals with double and the order in which inputs goes to the algorithm matter. If the order is different (as in this case), the results will be different. In Hadoop 20.x, the inputs goto the UDAF as it is in the table. But in Hadoop-23, the input order is reversed and the final output also is different. I have uploaded a patch which works fine for histogram_numeric() but fails with a small difference for udaf_percentile_approx. If there is way to tune this in Hadoop-23 that should help., The problem is actually with java. The double precision differs based on the order in which the numbers are summed up. https://issues.apache.org/jira/browse/PIG-2484?focusedCommentId=13430431&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13430431, Attaching HIVE-3911_branch10.patch. This should make it consistent. I have just removed the queries that cause changes and fails this test.]