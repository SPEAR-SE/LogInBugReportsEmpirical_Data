[kevinwilfong requested code review of "HIVE-2762 [jira] Alter Table Partition Concatenate Fails On Certain Characters".
Reviewers: JIRA

  https://issues.apache.org/jira/browse/HIVE-2762

  Changed the way the URI is created for a partition file as part of alter table partition concatenate queries.  This seems to resolve the issue.

  Also added a new test which checks alter table partition concsatenate queries on partitions containing most ASCII characters.

  Alter table partition concatenate creates a Java URI object for the location of a partition.  If the partition name contains certain characters, such as } or space ' ', the object constructor fails, causing the query to fail.

TEST PLAN
  EMPTY

REVISION DETAIL
  https://reviews.facebook.net/D1533

AFFECTED FILES
  ql/src/test/results/clientpositive/escape2.q.out
  ql/src/test/queries/clientpositive/escape2.q

MANAGE HERALD DIFFERENTIAL RULES
  https://reviews.facebook.net/herald/view/differential/

WHY DID I GET THIS EMAIL?
  https://reviews.facebook.net/herald/transcript/3201/

Tip: use the X-Herald-Rules header to filter Herald messages in your client.
, kevinwilfong updated the revision "HIVE-2762 [jira] Alter Table Partition Concatenate Fails On Certain Characters".
Reviewers: JIRA

  Missed a file in the last diff.

REVISION DETAIL
  https://reviews.facebook.net/D1533

AFFECTED FILES
  ql/src/test/results/clientpositive/escape2.q.out
  ql/src/test/queries/clientpositive/escape2.q
  ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java
, kevinwilfong has commented on the revision "HIVE-2762 [jira] Alter Table Partition Concatenate Fails On Certain Characters".

  I'm not sure why escape2.q.out was considered a binary file by arcanist, but I attached a patch to the JIRA which includes the contents of that file.

REVISION DETAIL
  https://reviews.facebook.net/D1533
, njain has commented on the revision "HIVE-2762 [jira] Alter Table Partition Concatenate Fails On Certain Characters".

INLINE COMMENTS
  ql/src/test/queries/clientpositive/escape2.q:47 Why are you running the same command multiple times ?

REVISION DETAIL
  https://reviews.facebook.net/D1533
, kevinwilfong updated the revision "HIVE-2762 [jira] Alter Table Partition Concatenate Fails On Certain Characters".
Reviewers: JIRA, njain

  Those commands are not the same, they contain unprintable characters in this format.  I updated the test with comments indicating which ASCII characters those represent, and which ASCII characters are not represented in the test.  Those cases are already being escaped in the metastore, I just included them for the sake of completeness, or something close to it.

REVISION DETAIL
  https://reviews.facebook.net/D1533

AFFECTED FILES
  ql/src/test/results/clientpositive/escape2.q.out
  ql/src/test/queries/clientpositive/escape2.q
  ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java
, kevinwilfong has commented on the revision "HIVE-2762 [jira] Alter Table Partition Concatenate Fails On Certain Characters".

  If you open the patch in an editor that supports displaying those unprintable characters, you can see them in the file.

REVISION DETAIL
  https://reviews.facebook.net/D1533
, +1

Running tests, Committed. Thanks Kevin, Integrated in Hive-trunk-h0.21 #1240 (See [https://builds.apache.org/job/Hive-trunk-h0.21/1240/])
    HIVE-2762 Alter Table Partition Concatenate Fails On Certain Characters
(Kevin Wilfong via namit)

namit : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1239754
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java
* /hive/trunk/ql/src/test/queries/clientpositive/escape2.q
* /hive/trunk/ql/src/test/results/clientpositive/escape2.q.out
, This issue is closed now. It was released with the fix in 0.9.0. If there is a problem, please open a new jira and link this one with that., Integrated in Hive-trunk-hadoop2 #54 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/54/])
    HIVE-2762 Alter Table Partition Concatenate Fails On Certain Characters
(Kevin Wilfong via namit) (Revision 1239754)

     Result = ABORTED
namit : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1239754
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java
* /hive/trunk/ql/src/test/queries/clientpositive/escape2.q
* /hive/trunk/ql/src/test/results/clientpositive/escape2.q.out
]