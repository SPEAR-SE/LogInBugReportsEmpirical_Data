[https://reviews.facebook.net/D3063, njain requested code review of "HIVE-3000 [jira] Potential infinite loop / log spew in ZookeeperHiveLockManager".
Reviewers: JIRA

  https://issues.apache.org/jira/browse/HIVE-3000

  HIVE-3000 infinite loop in ZooKeeperHiveLockManager

  See ZookeeperHiveLockManger.lock()

  If Zookeeper is in a bad state, it's possible to get an exception (e.g. org.apache.zookeeper.KeeperException$SessionExpiredException) when we call lockPrimitive(). There is a bug in the exception handler where the loop does not exit because the break in the switch statement gets out the switch, not the do..while loop. Because tryNum was not incremented due to the exception, lockPrimitive() will be called in an infinite loop, as fast as possible. Since the exception is printed for each call, Hive will produce significant log spew.

TEST PLAN
  EMPTY

REVISION DETAIL
  https://reviews.facebook.net/D3063

AFFECTED FILES
  ql/src/java/org/apache/hadoop/hive/ql/lockmgr/zookeeper/ZooKeeperHiveLockManager.java

MANAGE HERALD DIFFERENTIAL RULES
  https://reviews.facebook.net/herald/view/differential/

WHY DID I GET THIS EMAIL?
  https://reviews.facebook.net/herald/transcript/6963/

Tip: use the X-Herald-Rules header to filter Herald messages in your client.
, kevinwilfong has accepted the revision "HIVE-3000 [jira] Potential infinite loop / log spew in ZookeeperHiveLockManager".

  +1 Looks good, running tests.

REVISION DETAIL
  https://reviews.facebook.net/D3063

BRANCH
  svn
, Committed, thanks Namit., Integrated in Hive-trunk-h0.21 #1417 (See [https://builds.apache.org/job/Hive-trunk-h0.21/1417/])
    HIVE-3000 Potential infinite loop / log spew in ZookeeperHiveLockManager (njain via kevinwilfong) (Revision 1335106)

     Result = FAILURE
kevinwilfong : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1335106
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/lockmgr/zookeeper/ZooKeeperHiveLockManager.java
, Integrated in Hive-trunk-hadoop2 #54 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/54/])
    HIVE-3000 Potential infinite loop / log spew in ZookeeperHiveLockManager (njain via kevinwilfong) (Revision 1335106)

     Result = ABORTED
kevinwilfong : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1335106
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/lockmgr/zookeeper/ZooKeeperHiveLockManager.java
, This issue is fixed and released as part of 0.10.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.]