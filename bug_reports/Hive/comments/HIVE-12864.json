[

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12782113/HIVE-12864.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 108 failed/errored test(s), 10018 tests executed
*Failed tests:*
{noformat}
TestHWISessionManager - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_lineage2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_lineage3
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_tez_union
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.ql.exec.spark.session.TestSparkSessionManagerImpl.testMultiSessionMultipleUse
org.apache.hadoop.hive.ql.exec.spark.session.TestSparkSessionManagerImpl.testSingleSessionMultipleUse
org.apache.hadoop.hive.ql.parse.TestIUD.testDeleteNoWhere
org.apache.hadoop.hive.ql.parse.TestIUD.testDeleteWithWhere
org.apache.hadoop.hive.ql.parse.TestIUD.testInsertIntoTableAsSelectFromNamedVirtTable
org.apache.hadoop.hive.ql.parse.TestIUD.testInsertIntoTableAsSelectFromNamedVirtTableNamedCol
org.apache.hadoop.hive.ql.parse.TestIUD.testInsertIntoTableFromAnonymousTable
org.apache.hadoop.hive.ql.parse.TestIUD.testInsertIntoTableFromAnonymousTable1Row
org.apache.hadoop.hive.ql.parse.TestIUD.testInsertIntoTableFromAnonymousTable1RowNamedCol
org.apache.hadoop.hive.ql.parse.TestIUD.testMultiInsert
org.apache.hadoop.hive.ql.parse.TestIUD.testSelectStarFromVirtTable1Row
org.apache.hadoop.hive.ql.parse.TestIUD.testSelectStarFromVirtTable2Row
org.apache.hadoop.hive.ql.parse.TestIUD.testSelectStarFromVirtTable2RowNamedProjections
org.apache.hadoop.hive.ql.parse.TestIUD.testStandardInsertIntoTable
org.apache.hadoop.hive.ql.parse.TestIUD.testUpdateNoWhereMultiSet
org.apache.hadoop.hive.ql.parse.TestIUD.testUpdateNoWhereSingleSet
org.apache.hadoop.hive.ql.parse.TestIUD.testUpdateWithWhereMultiSet
org.apache.hadoop.hive.ql.parse.TestIUD.testUpdateWithWhereSingleSet
org.apache.hadoop.hive.ql.parse.TestIUD.testUpdateWithWhereSingleSetExpr
org.apache.hadoop.hive.ql.parse.TestQBSubQuery.testExtractConjuncts
org.apache.hadoop.hive.ql.parse.TestQBSubQuery.testExtractSubQueries
org.apache.hadoop.hive.ql.parse.TestQBSubQuery.testRewriteOuterQueryWhere
org.apache.hadoop.hive.ql.parse.TestQBSubQuery.testRewriteOuterQueryWhere2
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_ALL
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_ALTER
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_ARRAY
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_AS
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_AUTHORIZATION
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_BETWEEN
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_BIGINT
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_BINARY
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_BOOLEAN
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_BOTH
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_BY
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_CREATE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_CUBE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_CURRENT_DATE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_CURRENT_TIMESTAMP
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_CURSOR
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_DATE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_DECIMAL
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_DELETE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_DESCRIBE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_DOUBLE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_DROP
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_EXISTS
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_EXTERNAL
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_FALSE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_FETCH
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_FLOAT
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_FOR
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_FULL
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_GRANT
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_GROUP
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_GROUPING
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_IMPORT
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_IN
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_INNER
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_INSERT
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_INT
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_INTERSECT
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_INTO
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_IS
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_LATERAL
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_LEFT
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_LIKE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_LOCAL
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_NONE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_NULL
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_OF
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_ORDER
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_OUT
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_OUTER
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_PARTITION
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_PERCENT
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_PROCEDURE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_RANGE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_READS
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_REGEXP
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_REVOKE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_RIGHT
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_RLIKE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_ROLLUP
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_ROW
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_ROWS
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_SET
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_SMALLINT
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_TABLE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_TIMESTAMP
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_TO
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_TRIGGER
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_TRUE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_TRUNCATE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_UNION
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_UPDATE
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_USER
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_USING
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_VALUES
org.apache.hadoop.hive.ql.parse.TestSQL11ReservedKeyWordsPositive.testSQL11ReservedKeyWords_WITH
org.apache.hadoop.hive.ql.parse.positive.TestTransactionStatement.testAutoCommit
org.apache.hadoop.hive.ql.parse.positive.TestTransactionStatement.testTxnCommitRollback
org.apache.hadoop.hive.ql.parse.positive.TestTransactionStatement.testTxnStart
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6615/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6615/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6615/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 108 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12782113 - PreCommit-HIVE-TRUNK-Build, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12782246/HIVE-12864.01.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 6 failed/errored test(s), 10018 tests executed
*Failed tests:*
{noformat}
TestHWISessionManager - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_tez_union
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.ql.exec.spark.session.TestSparkSessionManagerImpl.testMultiSessionMultipleUse
org.apache.hadoop.hive.ql.exec.spark.session.TestSparkSessionManagerImpl.testSingleSessionMultipleUse
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6625/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6625/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6625/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12782246 - PreCommit-HIVE-TRUNK-Build, Clean QA. [~ashutoshc]/[~jpullokkaran], could you take a look? Thanks, [~jcamachorodriguez], could you please add a test case (a small one but illustrative enough) so that it can help walk through your algorithm? Thanks!, [~pxiong], thanks for checking on this. 

The original five methods are tree traversals implemented recursively.
The new ones in the patch are similar to the original ones, but I rewrote each of them to be iterative -using stacks-. This avoid the StackOverflowError.
Concretely:
* setUnknownTokenBoundaries(): post-order
* dump(StringBuilder sb): pre- and post-order
* toStringTree(ASTNode rootNode): pre- and post-order
* processPositionAlias(ASTNode ast): pre-order
* findSubQueries(ASTNode node, List<ASTNode> subQueries): pre-order

These algorithms are part of the parsing logic, so you can pick any query in the q files (e.g. lineage2.q, lineage3.q, subquery_in.q) to walk through each of the algorithms., +1, Pushed to master, branch-2.0. Thanks for the review [~pxiong]!]