[https://reviews.facebook.net/D5535, Comments in Phabricator, I haven't looked at the patch in detail. But can you please explain why are you moving retrial logic to HMSHandler from RawStore. How is it going to help retrial within a transaction? Is this patch part of series of patches or this patch alone is sufficient? Just trying to understand the goals here., We have seen in the past errors where the connection to MySQL will be lost and hence the transaction is broken, but the RetryingRawStore happily retries the command to the RawStore, in which the connection is reestablished and the command succeeds, and continues with the rest of the commands.  These commands are performed outside a transaction and ultimately the command fails because the number of transactions the metastore tries to close at the end does not match the number of open transactions., There are classes of errors that would be suitable to retry at the raw store level (in which the transaction is maintained open) and classes of errors that should be retried at the Hander level (in which the transaction is rolled back/lost).

It's up to Jean how much she wants to accomplish in this JIRA, but when I suggested she work on this task, I was hoping for at least an implementation of something which could retry outside of transactions, determining those classes of errors that should be handled in either the raw store or the handler could be done here or as part of another JIRA., https://reviews.facebook.net/D5535
, Looks good for the most part, a couple small comments on the diff., https://reviews.facebook.net/D5535, +1 This looks good to me., Committed, thanks Jean., Integrated in Hive-trunk-h0.21 #1714 (See [https://builds.apache.org/job/Hive-trunk-h0.21/1714/])
    HIVE-3484. RetryingRawStore logic needs to be significantly reworked to support retries within transactions (Jean Xu via kevinwilfong) (Revision 1392491)

     Result = FAILURE
kevinwilfong : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1392491
Files : 
* /hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java
* /hive/trunk/conf/hive-default.xml.template
* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java
* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java
* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IHMSHandler.java
* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreInit.java
* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RetryingHMSHandler.java
* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RetryingRawStore.java
, Integrated in Hive-trunk-hadoop2 #54 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/54/])
    HIVE-3484. RetryingRawStore logic needs to be significantly reworked to support retries within transactions (Jean Xu via kevinwilfong) (Revision 1392491)

     Result = ABORTED
kevinwilfong : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1392491
Files : 
* /hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java
* /hive/trunk/conf/hive-default.xml.template
* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java
* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java
* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/IHMSHandler.java
* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreInit.java
* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RetryingHMSHandler.java
* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/RetryingRawStore.java
, This issue is fixed and released as part of 0.10.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira., Doc note:  This adds three configuration parameters (*hive.hmshandler.retry.attempts*, *hive.hmshandler.retry.interval*, and *hive.hmshandler.force.reload.conf*) which need to be documented in the wiki:

* [Configuration Properties -- MetaStore | https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-MetaStore]

The patch is here:  https://reviews.facebook.net/D5535.]