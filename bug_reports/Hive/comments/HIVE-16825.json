[Part of HIVE-16323 that is not committed yet]