[[~mmccline]: LGTM, +1 tests pending.

I don't think the following golden file change is a problem, but it would be good to clarify on this JIRA how the 3 turns into 25?

{code}
                         Group By Operator
                           aggregations: count(1)
                           Group By Vectorization:
-                              aggregators: VectorUDAFCount(ConstantVectorExpression(val 1) -> 3:long) -> bigint
+                              aggregators: VectorUDAFCount(ConstantVectorExpression(val 1) -> 25:long) -> bigint
{code}

Is that the column id # in lieu of a constant key like 0?, It is ok.  It has a Native Vector MapJoin parent.  Normally, regular Vector MapJoin creates a new output batch and so the column numbers are lower.  But the Native parent is taking the original input batch and adding scratch columns.  Thanks for noticing, but not a problem., [~mmccline] - thankyou for working on the patch to fix the test.
The test used to run in less than 2 minutes, and ends up timing out after running for 40 minutes. Will the change mentioned here have that kind of impact?, Build #1 failed due to infrastructure., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12833623/HIVE-14981.01.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 10 failed/errored test(s), 10563 tests executed
*Failed tests:*
{noformat}
TestBeelineWithHS2ConnectionFile - did not produce a TEST-*.xml file (likely timed out) (batchId=197)
TestMiniLlapLocalCliDriver - did not produce a TEST-*.xml file (likely timed out) (batchId=143)
	[orc_llap.q,vectorization_pushdown.q,correlationoptimizer2.q,cbo_gby_empty.q,vectorization_short_regress.q,identity_project_remove_skip.q,auto_sortmerge_join_1.q,lineage3.q,cross_product_check_1.q,cbo_join.q,vector_struct_in.q,correlationoptimizer6.q,union_remove_26.q,vectorization_13.q,union2.q,groupby2.q,schema_evol_text_vec_table.q,dynpart_sort_opt_vectorization.q,exchgpartition2lel.q,multiMapJoin1.q,sample10.q,vectorized_timestamp_ints_casts.q,vector_char_simple.q,dynpart_sort_optimization_acid.q,auto_sortmerge_join_2.q,bucketizedhiveinputformat.q,leftsemijoin.q,special_character_in_tabnames_1.q,cte_mat_2.q,vectorization_8.q]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[acid_globallimit] (batchId=27)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[order_null] (batchId=18)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_fast_stats] (batchId=46)
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJarWithoutAddDriverClazz[0] (batchId=155)
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJar[0] (batchId=155)
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJar[1] (batchId=155)
org.apache.hive.jdbc.authorization.TestJdbcWithSQLAuthorization.testBlackListedUdfUsage (batchId=204)
org.apache.hive.minikdc.TestJdbcWithDBTokenStore.testNegativeTokenAuth (batchId=217)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/1599/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/1599/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-1599/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 10 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12833623 - PreCommit-HIVE-Build, Still have a problem., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12833777/HIVE-14981.02.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 10 failed/errored test(s), 10564 tests executed
*Failed tests:*
{noformat}
TestBeelineWithHS2ConnectionFile - did not produce a TEST-*.xml file (likely timed out) (batchId=197)
TestMiniLlapLocalCliDriver - did not produce a TEST-*.xml file (likely timed out) (batchId=143)
	[orc_llap.q,vectorization_pushdown.q,correlationoptimizer2.q,cbo_gby_empty.q,vectorization_short_regress.q,identity_project_remove_skip.q,auto_sortmerge_join_1.q,lineage3.q,cross_product_check_1.q,cbo_join.q,vector_struct_in.q,correlationoptimizer6.q,union_remove_26.q,vectorization_13.q,union2.q,groupby2.q,schema_evol_text_vec_table.q,dynpart_sort_opt_vectorization.q,exchgpartition2lel.q,multiMapJoin1.q,sample10.q,vectorized_timestamp_ints_casts.q,vector_char_simple.q,dynpart_sort_optimization_acid.q,auto_sortmerge_join_2.q,bucketizedhiveinputformat.q,leftsemijoin.q,special_character_in_tabnames_1.q,cte_mat_2.q,vectorization_8.q]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[acid_globallimit] (batchId=27)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[order_null] (batchId=18)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_fast_stats] (batchId=46)
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJarWithoutAddDriverClazz[0] (batchId=155)
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJar[0] (batchId=155)
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJar[1] (batchId=155)
org.apache.hive.jdbc.authorization.TestJdbcWithSQLAuthorization.testBlackListedUdfUsage (batchId=204)
org.apache.hive.spark.client.TestSparkClient.testJobSubmission (batchId=263)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/1600/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/1600/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-1600/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 10 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12833777 - PreCommit-HIVE-Build, Deferring this to 3.1.0 since the branch for 3.0.0 has been cut off. Please update the JIRA if you would like to get your patch in 3.0.0., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12833777/HIVE-14981.02.patch

{color:red}ERROR:{color} -1 due to build exiting with an error

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/10123/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/10123/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-10123/

Messages:
{noformat}
**** This message was trimmed, see log for full details ****
Falling back to three-way merge...
Applied patch to 'ql/src/java/org/apache/hadoop/hive/ql/plan/VectorMapJoinDesc.java' cleanly.
error: patch failed: ql/src/test/results/clientpositive/llap/vector_between_columns.q.out:115
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vector_between_columns.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/llap/vector_binary_join_groupby.q.out:461
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vector_binary_join_groupby.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/llap/vector_char_mapjoin1.q.out:179
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vector_char_mapjoin1.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/llap/vector_decimal_mapjoin.q.out:126
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vector_decimal_mapjoin.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/llap/vector_include_no_sel.q.out:250
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vector_include_no_sel.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/llap/vector_inner_join.q.out:88
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vector_inner_join.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/llap/vector_interval_mapjoin.q.out:229
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vector_interval_mapjoin.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/llap/vector_left_outer_join2.q.out:318
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vector_left_outer_join2.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/llap/vector_leftsemi_mapjoin.q.out:3365
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vector_leftsemi_mapjoin.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/llap/vector_mapjoin_reduce.q.out:155
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vector_mapjoin_reduce.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/llap/vector_nullsafe_join.q.out:87
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vector_nullsafe_join.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/llap/vector_outer_join0.q.out:113
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vector_outer_join0.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/llap/vector_outer_join1.q.out:273
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vector_outer_join1.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/llap/vector_outer_join2.q.out:289
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vector_outer_join2.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/llap/vectorized_mapjoin.q.out:59
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/llap/vectorized_mapjoin.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/spark/vector_decimal_mapjoin.q.out:170
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/spark/vector_decimal_mapjoin.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/spark/vector_inner_join.q.out:138
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/spark/vector_inner_join.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/spark/vector_outer_join0.q.out:155
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/spark/vector_outer_join0.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/spark/vector_outer_join1.q.out:315
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/spark/vector_outer_join1.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/spark/vector_outer_join2.q.out:371
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/spark/vector_outer_join2.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/spark/vectorized_mapjoin.q.out:104
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/spark/vectorized_mapjoin.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/vector_between_columns.q.out:133
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vector_between_columns.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/vector_binary_join_groupby.q.out:429
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vector_binary_join_groupby.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/vector_char_mapjoin1.q.out:196
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vector_char_mapjoin1.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/vector_decimal_mapjoin.q.out:144
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vector_decimal_mapjoin.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/vector_include_no_sel.q.out:236
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vector_include_no_sel.q.out' with conflicts.
error: ql/src/test/results/clientpositive/vector_inner_join.q.out: does not exist in index
error: patch failed: ql/src/test/results/clientpositive/vector_interval_mapjoin.q.out:247
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vector_interval_mapjoin.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/vector_left_outer_join2.q.out:334
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vector_left_outer_join2.q.out' with conflicts.
error: ql/src/test/results/clientpositive/vector_nullsafe_join.q.out: does not exist in index
error: patch failed: ql/src/test/results/clientpositive/vector_outer_join0.q.out:124
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vector_outer_join0.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/vector_outer_join1.q.out:284
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vector_outer_join1.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/vector_outer_join2.q.out:315
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vector_outer_join2.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/vector_outer_join3.q.out:244
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vector_outer_join3.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/vector_outer_join4.q.out:258
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vector_outer_join4.q.out' with conflicts.
error: ql/src/test/results/clientpositive/vector_outer_join5.q.out: does not exist in index
error: patch failed: ql/src/test/results/clientpositive/vector_outer_join6.q.out:134
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vector_outer_join6.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/vectorized_mapjoin.q.out:76
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vectorized_mapjoin.q.out' with conflicts.
error: patch failed: ql/src/test/results/clientpositive/vectorized_mapjoin2.q.out:104
Falling back to three-way merge...
Applied patch to 'ql/src/test/results/clientpositive/vectorized_mapjoin2.q.out' with conflicts.
error: src/java/org/apache/hadoop/hive/ql/optimizer/physical/Vectorizer.java: does not exist in index
error: src/java/org/apache/hadoop/hive/ql/plan/MapJoinDesc.java: does not exist in index
error: src/java/org/apache/hadoop/hive/ql/plan/VectorMapJoinDesc.java: does not exist in index
error: src/test/results/clientpositive/llap/vector_between_columns.q.out: does not exist in index
error: src/test/results/clientpositive/llap/vector_binary_join_groupby.q.out: does not exist in index
error: src/test/results/clientpositive/llap/vector_char_mapjoin1.q.out: does not exist in index
error: src/test/results/clientpositive/llap/vector_decimal_mapjoin.q.out: does not exist in index
error: src/test/results/clientpositive/llap/vector_include_no_sel.q.out: does not exist in index
error: src/test/results/clientpositive/llap/vector_inner_join.q.out: does not exist in index
error: src/test/results/clientpositive/llap/vector_interval_mapjoin.q.out: does not exist in index
error: src/test/results/clientpositive/llap/vector_left_outer_join2.q.out: does not exist in index
error: src/test/results/clientpositive/llap/vector_leftsemi_mapjoin.q.out: does not exist in index
error: src/test/results/clientpositive/llap/vector_mapjoin_reduce.q.out: does not exist in index
error: src/test/results/clientpositive/llap/vector_nullsafe_join.q.out: does not exist in index
error: src/test/results/clientpositive/llap/vector_outer_join0.q.out: does not exist in index
error: src/test/results/clientpositive/llap/vector_outer_join1.q.out: does not exist in index
error: src/test/results/clientpositive/llap/vector_outer_join2.q.out: does not exist in index
error: src/test/results/clientpositive/llap/vectorized_mapjoin.q.out: does not exist in index
error: src/test/results/clientpositive/spark/vector_decimal_mapjoin.q.out: does not exist in index
error: src/test/results/clientpositive/spark/vector_inner_join.q.out: does not exist in index
error: src/test/results/clientpositive/spark/vector_outer_join0.q.out: does not exist in index
error: src/test/results/clientpositive/spark/vector_outer_join1.q.out: does not exist in index
error: src/test/results/clientpositive/spark/vector_outer_join2.q.out: does not exist in index
error: src/test/results/clientpositive/spark/vectorized_mapjoin.q.out: does not exist in index
error: src/test/results/clientpositive/vector_between_columns.q.out: does not exist in index
error: src/test/results/clientpositive/vector_binary_join_groupby.q.out: does not exist in index
error: src/test/results/clientpositive/vector_char_mapjoin1.q.out: does not exist in index
error: src/test/results/clientpositive/vector_decimal_mapjoin.q.out: does not exist in index
error: src/test/results/clientpositive/vector_include_no_sel.q.out: does not exist in index
error: src/test/results/clientpositive/vector_inner_join.q.out: does not exist in index
error: src/test/results/clientpositive/vector_interval_mapjoin.q.out: does not exist in index
error: src/test/results/clientpositive/vector_left_outer_join2.q.out: does not exist in index
error: src/test/results/clientpositive/vector_nullsafe_join.q.out: does not exist in index
error: src/test/results/clientpositive/vector_outer_join0.q.out: does not exist in index
error: src/test/results/clientpositive/vector_outer_join1.q.out: does not exist in index
error: src/test/results/clientpositive/vector_outer_join2.q.out: does not exist in index
error: src/test/results/clientpositive/vector_outer_join3.q.out: does not exist in index
error: src/test/results/clientpositive/vector_outer_join4.q.out: does not exist in index
error: src/test/results/clientpositive/vector_outer_join5.q.out: does not exist in index
error: src/test/results/clientpositive/vector_outer_join6.q.out: does not exist in index
error: src/test/results/clientpositive/vectorized_mapjoin.q.out: does not exist in index
error: src/test/results/clientpositive/vectorized_mapjoin2.q.out: does not exist in index
error: java/org/apache/hadoop/hive/ql/optimizer/physical/Vectorizer.java: does not exist in index
error: java/org/apache/hadoop/hive/ql/plan/MapJoinDesc.java: does not exist in index
error: java/org/apache/hadoop/hive/ql/plan/VectorMapJoinDesc.java: does not exist in index
error: test/results/clientpositive/llap/vector_between_columns.q.out: does not exist in index
error: test/results/clientpositive/llap/vector_binary_join_groupby.q.out: does not exist in index
error: test/results/clientpositive/llap/vector_char_mapjoin1.q.out: does not exist in index
error: test/results/clientpositive/llap/vector_decimal_mapjoin.q.out: does not exist in index
error: test/results/clientpositive/llap/vector_include_no_sel.q.out: does not exist in index
error: test/results/clientpositive/llap/vector_inner_join.q.out: does not exist in index
error: test/results/clientpositive/llap/vector_interval_mapjoin.q.out: does not exist in index
error: test/results/clientpositive/llap/vector_left_outer_join2.q.out: does not exist in index
error: test/results/clientpositive/llap/vector_leftsemi_mapjoin.q.out: does not exist in index
error: test/results/clientpositive/llap/vector_mapjoin_reduce.q.out: does not exist in index
error: test/results/clientpositive/llap/vector_nullsafe_join.q.out: does not exist in index
error: test/results/clientpositive/llap/vector_outer_join0.q.out: does not exist in index
error: test/results/clientpositive/llap/vector_outer_join1.q.out: does not exist in index
error: test/results/clientpositive/llap/vector_outer_join2.q.out: does not exist in index
error: test/results/clientpositive/llap/vectorized_mapjoin.q.out: does not exist in index
error: test/results/clientpositive/spark/vector_decimal_mapjoin.q.out: does not exist in index
error: test/results/clientpositive/spark/vector_inner_join.q.out: does not exist in index
error: test/results/clientpositive/spark/vector_outer_join0.q.out: does not exist in index
error: test/results/clientpositive/spark/vector_outer_join1.q.out: does not exist in index
error: test/results/clientpositive/spark/vector_outer_join2.q.out: does not exist in index
error: test/results/clientpositive/spark/vectorized_mapjoin.q.out: does not exist in index
error: test/results/clientpositive/vector_between_columns.q.out: does not exist in index
error: test/results/clientpositive/vector_binary_join_groupby.q.out: does not exist in index
error: test/results/clientpositive/vector_char_mapjoin1.q.out: does not exist in index
error: test/results/clientpositive/vector_decimal_mapjoin.q.out: does not exist in index
error: test/results/clientpositive/vector_include_no_sel.q.out: does not exist in index
error: test/results/clientpositive/vector_inner_join.q.out: does not exist in index
error: test/results/clientpositive/vector_interval_mapjoin.q.out: does not exist in index
error: test/results/clientpositive/vector_left_outer_join2.q.out: does not exist in index
error: test/results/clientpositive/vector_nullsafe_join.q.out: does not exist in index
error: test/results/clientpositive/vector_outer_join0.q.out: does not exist in index
error: test/results/clientpositive/vector_outer_join1.q.out: does not exist in index
error: test/results/clientpositive/vector_outer_join2.q.out: does not exist in index
error: test/results/clientpositive/vector_outer_join3.q.out: does not exist in index
error: test/results/clientpositive/vector_outer_join4.q.out: does not exist in index
error: test/results/clientpositive/vector_outer_join5.q.out: does not exist in index
error: test/results/clientpositive/vector_outer_join6.q.out: does not exist in index
error: test/results/clientpositive/vectorized_mapjoin.q.out: does not exist in index
error: test/results/clientpositive/vectorized_mapjoin2.q.out: does not exist in index
The patch does not appear to apply with p0, p1, or p2
+ exit 1
'
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12833777 - PreCommit-HIVE-Build]