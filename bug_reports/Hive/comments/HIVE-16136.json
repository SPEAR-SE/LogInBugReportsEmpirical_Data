[bq. There is no clean way to trap SIGKILL in java.

The shell scripts are probably where we can trap signals and dump /proc/<pid>/smaps & /proc/<pid>/stat ?

Bash has a "trap" feature for this.

bq. One option is to increase the time between kill and kill -9 in YARN

This is pretty easy to increase, but is cluster wide config., bq. The shell scripts are probably where we can trap signals and dump /proc/<pid>/smaps & /proc/<pid>/stat ? Bash has a "trap" feature for this.

Yeah. We could get these as well. But I think this can only be triggered under OOM on error hook or other jvm fatal error (although I was not able to make this work with OnError hook + stack overflow exception). This won't work for SIGTERM or SIGKILL. 

bq. This is pretty easy to increase, but is cluster wide config.

If cluster wide config, then having shorter intervals will not be enough for full heap dump. We could add separate shutdown hooks to collect jstack, jmx, /proc/* etc. and let HeapDumpOnOOM handle heap dump. We can probably have a web endpoint for manual heapdump if it's useful. 

, I am deferring this to Hive 3.0 as we are going to cut the first RC and it is not marked as blocker. Please feel free to commit to the branch if this can be resolved before the release.]