[

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12764825/HIVE-12021.01.patch

{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 9640 tests executed
*Failed tests:*
{noformat}
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5523/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5523/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5523/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12764825 - PreCommit-HIVE-TRUNK-Build, [~jpullokkaran], fail is unrelated. Could you take a look at the patch? Thanks, I uploaded a new patch that removes an unnecessary if clause. Waiting for new QA., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12764935/HIVE-12021.02.patch

{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 2 failed/errored test(s), 9640 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_mult_tables_compact
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5529/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5529/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5529/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12764935 - PreCommit-HIVE-TRUNK-Build, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12764957/HIVE-12021.02.patch

{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 4 failed/errored test(s), 9613 tests executed
*Failed tests:*
{noformat}
TestEncryptedHDFSCliDriver - did not produce a TEST-*.xml file
TestMarkPartition - did not produce a TEST-*.xml file
TestMiniTezCliDriver-vectorized_parquet.q-vector_char_mapjoin1.q-tez_insert_overwrite_local_directory_1.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5530/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5530/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5530/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12764957 - PreCommit-HIVE-TRUNK-Build, [~jcamachorodriguez] The logic of traversing expressions (ExtractCommonOperands) is not recursive and misses many of the use cases. I think it can be changed to traverse recursively. Also check for comparison need to take in to account functions (ex: ((x+y)=10 and z=1) or ((x+y)=10 and z=2) )., [~jpullokkaran], IMO we could solve the correctness issue in this JIRA case, and check it in 2.0, 1.3, and 1.2.2 asap.
The rule, as it stands with the fix, will cover the same use cases that it originally covered.

Then I could open another JIRA to extend the rule to cover more cases., [~jpullokkaran], IMO we could solve the correctness issue in this JIRA case, and check it in 2.0, 1.3, and 1.2.2 asap.
The rule, as it stands with the fix, will cover the same use cases that it originally covered.

Then I could open another JIRA to extend the rule to cover more cases., [~jcamachorodriguez] Because of the comparison restrictions I am not sure if this issue ever get exposed.
You will have to explicitly specify the type of literal or it has to be comparisons on multiple cols.

But its ok to separate these in to two different issues., [~jpullokkaran], I created HIVE-12044 to follow up with the extensions.

Can this patch be +1 and go in?, The multi map should also get pruned.
Consider the following case:
(x=f(y) and x=10 and expr1) or (x=10 and expr2)

The multi-map "reductionCondition" will contain both 1) "x=10" and 2) x=f(y)

However x=f(y) is not present in all DNF elements.

One may argue transitive effects (i.e x=f(y) should also be right since we have x=10); i think its brittle to leave multi map entries unchanged., [~jpullokkaran], I do not understand the case above.

1) x=f\(y) would not be picked, as f\(y) is not a literal constant. We would bail out of the rule for safety (lines 180, 181). In follow-up HIVE-12044, we could study if/how we could extend the rule for these cases.

2) If we have the following predicate:
(x=2 and x=10 and expr1) or (x=10 and expr2)
we can infer the condition (x=2 or x=10), even if x=2 is not in both disjuncts; what matters is that x is in both CNF disjuncts., Ok My Bad; i get it. It is a disjunctive clause.

+1, Pushed to master, branch-1, and branch-1.2.

Thanks [~jpullokkaran] for the review.]