[

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12775354/HIVE-12568.0-spark.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 5 failed/errored test(s), 9866 tests executed
*Failed tests:*
{noformat}
TestHWISessionManager - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.metastore.TestHiveMetaStorePartitionSpecs.testGetPartitionSpecs_WithAndWithoutPartitionGrouping
org.apache.hive.jdbc.TestSSL.testSSLVersion
org.apache.hive.jdbc.miniHS2.TestHs2Metrics.testMetrics
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/1018/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/1018/console
Test logs: http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-SPARK-Build-1018/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12775354 - PreCommit-HIVE-SPARK-Build, Patch 1 reverted a file that contained no code changes. Test result shouldn't change. [~jxiang], [~vanzin], would you mind checking if the patch looks okay? Thanks., The thrift server bind host is usually the external network interface. Remote driver usually connects to the internal network interface, if there are multiple network interfaces?, Yeah. I'm not really sure of that or whether it's a common practice. However, current implementation is to pick (randomly) any possible interface to bind, which can lead to problem. On the other hand, making such a change does require that HS2 can be reached by the NM nodes. Maybe we should give an option to overwrite this? Any thoughts to share, [~vanzin]?, So, with the old code, couldn't you just set "hive.spark.client.server.address" in hive-conf.xml and that would set the hostname being used? It's fine to use "HIVE_SERVER2_THRIFT_BIND_HOST" as a fallback, but didn't the old config option work? Shoudn't that be fixed instead?

A different way of fixing it (that would require more code) would be to send all possible addresses to the RemoteDriver and let it try which one works., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12775413/HIVE-12568.1-spark.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 6 failed/errored test(s), 9866 tests executed
*Failed tests:*
{noformat}
TestHWISessionManager - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.metastore.TestHiveMetaStorePartitionSpecs.testFetchingPartitionsWithDifferentSchemas
org.apache.hadoop.hive.metastore.TestHiveMetaStorePartitionSpecs.testGetPartitionSpecs_WithAndWithoutPartitionGrouping
org.apache.hive.jdbc.TestSSL.testSSLVersion
org.apache.hive.jdbc.miniHS2.TestHs2Metrics.testMetrics
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/1019/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/1019/console
Test logs: http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-SPARK-Build-1019/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12775413 - PreCommit-HIVE-SPARK-Build, Yeah. I initially thought that we can just expose that param and later I figured it's safe and most common to assume the same interface as HS2 service. Maybe we should go back to the idea and using HS2 hostname as a fallback. That way should be more comprehensive. I will update the patch., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12775875/HIVE-12568.2-spark.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 43 failed/errored test(s), 9295 tests executed
*Failed tests:*
{noformat}
TestCliDriver-alter_table_not_sorted.q-cbo_udf_max.q-groupby4_map.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-auto_sortmerge_join_7.q-exim_04_evolved_parts.q-query_with_semi.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-compute_stats_string.q-skewjoin_union_remove_2.q-avro_nullable_fields.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-create_func1.q-enforce_order.q-interval_comparison.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-groupby_grouping_id2.q-insert_values_nonascii.q-vectorization_13.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-groupby_sort_7.q-vector_decimal_10_0.q-partition_vs_table_metadata.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-input19.q-index_auth.q-input16.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-interval_udf.q-tez_schema_evolution.q-metadataonly1.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-join_cond_pushdown_unqual4.q-udf_var_samp.q-load_dyn_part2.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-join_filters.q-groupby8_map.q-exim_14_managed_location_over_existing.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-orc_split_elimination.q-udf_xpath_string.q-partition_wise_fileformat.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-partition_coltype_literals.q-index_auto_partitioned.q-udf_hash.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-ppd_join4.q-union27.q-show_indexes_edge_cases.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-ppd_union.q-udf_round_3.q-groupby12.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-push_or.q-infer_bucket_sort_list_bucket.q-vector_interval_2.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-show_conf.q-udaf_covar_samp.q-udf_md5.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-skewjoin_mapjoin4.q-groupby6_map.q-cbo_rp_union.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-skewjoinopt15.q-fileformat_text.q-load_dyn_part12.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-smb_mapjoin_15.q-mapreduce1.q-ppd_udf_case.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-sort_merge_join_desc_3.q-join2.q-vector_data_types.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-stats12.q-unionall_unbalancedppd.q-insert_overwrite_local_directory_1.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-tez_joins_explain.q-rename_column.q-index_compact.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-udf_explode.q-avro_add_column.q-bucketmapjoin_negative.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-union36.q-acid_join.q-part_inherit_tbl_props_empty.q-and-6-more - did not produce a TEST-*.xml file
TestHWISessionManager - did not produce a TEST-*.xml file
TestMiniTezCliDriver-auto_join30.q-vector_decimal_10_0.q-schema_evol_orc_acidvec_mapwork_part.q-and-12-more - did not produce a TEST-*.xml file
TestMiniTezCliDriver-cbo_windowing.q-tez_join.q-bucket_map_join_tez1.q-and-12-more - did not produce a TEST-*.xml file
TestMiniTezCliDriver-update_orig_table.q-update_after_multiple_inserts.q-unionDistinct_2.q-and-12-more - did not produce a TEST-*.xml file
TestMiniTezCliDriver-vector_interval_2.q-constprog_dpp.q-dynamic_partition_pruning.q-and-12-more - did not produce a TEST-*.xml file
TestMiniTezCliDriver-vectorization_13.q-tez_bmj_schema_evolution.q-bucket3.q-and-12-more - did not produce a TEST-*.xml file
TestParseNegative - did not produce a TEST-*.xml file
TestSparkCliDriver-bucketsortoptimize_insert_7.q-skewjoin_noskew.q-sample2.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-groupby_complex_types.q-auto_join9.q-groupby_map_ppr.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-join_casesensitive.q-decimal_join.q-mapjoin_addjar.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-ppd_join4.q-skewjoinopt3.q-union27.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-runtime_skewjoin_mapjoin_spark.q-union_remove_9.q-ppd_multi_insert.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-stats12.q-skewjoinopt19.q-groupby10.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-stats13.q-stats2.q-ppd_gby_join.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-vectorization_10.q-list_bucket_dml_2.q-scriptfile1.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.metastore.TestHiveMetaStorePartitionSpecs.testGetPartitionSpecs_WithAndWithoutPartitionGrouping
org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler.org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/1020/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/1020/console
Test logs: http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-SPARK-Build-1020/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 43 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12775875 - PreCommit-HIVE-SPARK-Build, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12775905/HIVE-12568.2-spark.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 6 failed/errored test(s), 9836 tests executed
*Failed tests:*
{noformat}
TestHWISessionManager - did not produce a TEST-*.xml file
TestMiniTezCliDriver-script_pipe.q-vectorized_parquet.q-vector_decimal_aggregate.q-and-12-more - did not produce a TEST-*.xml file
TestMiniTezCliDriver-update_orig_table.q-update_after_multiple_inserts.q-unionDistinct_2.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.metastore.TestHiveMetaStorePartitionSpecs.testGetPartitionSpecs_WithAndWithoutPartitionGrouping
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/1021/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/1021/console
Test logs: http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-SPARK-Build-1021/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12775905 - PreCommit-HIVE-SPARK-Build, These test failures doesn't seem related., +1, Committed to Spark branch. Thanks for the review, Jimmy., Doc note:  When this gets merged to master, *hive.spark.client.rpc.server.address* will need to be documented in the Spark section of Configuration Properties.  For now, it has a TODOC-SPARK label.

Should *hive.spark.client.rpc.server.address* also be mentioned in Hive on Spark: Getting Started?

* Hive on Spark: Getting Started
** [Configuring Spark | https://cwiki.apache.org/confluence/display/Hive/Hive+on+Spark%3A+Getting+Started#HiveonSpark:GettingStarted-ConfiguringSpark]
** [Recommended Configuration | https://cwiki.apache.org/confluence/display/Hive/Hive+on+Spark%3A+Getting+Started#HiveonSpark:GettingStarted-RecommendedConfiguration]
* [Configuration Properties -- Spark | https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-Spark]

By the way, the parameter description doesn't have any line breaks (\n).  Perhaps that could be corrected when another Spark parameter gets added., HIVE-12940 merged this to master for release 2.1.0, so I added a TODOC2.1 label.

Ping for the doc question:  Should *hive.spark.client.rpc.server.address* be mentioned in Hive on Spark: Getting Started?, Added to the wiki.]