[HIVE-902.1.patch:

I remember there is a hadoop version 0.17.2.1. It seems the patch does not handle this case.
Can you change the regex to work for that?
Also, please print out the hadoop version in the error message in case we cannot detect hadoop version, to make it easier to debug.

Can you also help try it out on earlier versions of bash (bash 3.00 for example)?
, - Adjusted regex to handle version numbers like "0.17.2.1"
- On error, now prints out string returned by 'hadoop version'.
- Verified that this works on Bash 3.2.17
, +1. Will commit after test passes.
, Committed. Thanks Carl!, Carl, it turns out bash 3.00 is complaining:
{code}
hive/bin/ext/cli.sh: line 19: syntax error in conditional expression: unexpected token `('
hive/bin/ext/cli.sh: line 19: syntax error near `^(['
hive/bin/ext/cli.sh: line 19: `  if [[ $version =~ ^([[:digit:]]+)\.([[:digit:]]+)\.([[:digit:]]+).*$ ]]; then'
hive/bin/hive: line 173: cli: command not found
{code}

I tried both:
{code}
if [[ $version =~ "^([0-9]+)\.([[:digit:]]+)\.([[:digit:]]+).*$" ]]; then
  major_ver=${BASH_REMATCH[1]};
  minor_ver=${BASH_REMATCH[2]};
  patch_ver=${BASH_REMATCH[3]};
  echo $major_ver $minor_ver $patch_ver;
fi
{code}

and
{code}
if [[ "$version" =~ ^"([0-9]+)\.([[:digit:]]+)\.([[:digit:]]+).*"$ ]]; then
  major_ver=${BASH_REMATCH[1]};
  minor_ver=${BASH_REMATCH[2]};
  patch_ver=${BASH_REMATCH[3]};
  echo $major_ver $minor_ver $patch_ver;
fi
{code}

Both of these worked on bash 3.00.

Can you try these out on bash 4.00? Once it works, can you post another patch on top of the first one (since the first one is already committed..
, Please replace [0-9]+ with [[:digit:]]+ in the previous comment - that was for debugging., By the way, we also want to make it compatible with internal versions like "0.20". Can you make the third argument (patch var) optional in the regex?
, Carl, can you help test HIVE-902.repair.patch on bash 4.00?, - HIVE-902.repair.patch does not work on Bash 4.0.33

- Underlying issue is described here: http://stackoverflow.com/questions/218156/bash-regex-with-quotes

- Tested HIVE-902.repair.2.patch on Bash 4.0.33 and 3.2.17, Zheng, can you test the updated patch on Bash 3.1? I can't get 3.1 to build because of readline problems. Thanks., - Fix version comparison logic.]