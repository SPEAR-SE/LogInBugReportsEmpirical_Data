[The attached patch fixes this for both 0.10 branch and trunk., New patch uploaded with .q test, Just tried your patch and it kind of works for me, however I'm running into a possibly related problem. I have a table called {{clicks}} that uses the avro serde, it has a column called {{url}} which is an avro record containing a field called {{domain}}. I'd like to index my {{clicks}} table on {{url.domain}} with:
{code}
CREATE INDEX domainIndex
ON TABLE clicks(url.domain)
AS 'org.apache.hadoop.hive.ql.index.compact.CompactIndexHandler'
WITH DEFERRED REBUILD;
{code}
And I get:
{code}
FAILED: ParseException line 2:19 mismatched input '.' expecting ) near 'url' in create index statement
{code}

I also tried using {{`url`.domain}} and {{`url.domain`}} but those don't work either. I then tried making an index on the full {{url}} field. But then I just get the following error in the MR job:

{code}
java.lang.RuntimeException: Hash code on complex types not supported yet.
{code}

Any ideas?, Hi Steven,

Indexing on the field of a record/struct isn't supported yet. That's also the case for other metadata like cluster, sort, and skew columns. I've been taking a look at that recently, and will open up a JIRA to discuss/track. I tried your second case and got the same issue as you. It seems to be an unrelated issue that is preventing group by using a struct as a key. These are both issues that affect all storage formats though, so we should discuss them in their own JIRAs.

Can you confirm that you're able to create indices on top level primitive columns of Avro tables with this patch?

Thanks,
Mark, +1, Committed to trunk. Thanks, Mark!, Integrated in Hive-trunk-hadoop1-ptest #41 (See [https://builds.apache.org/job/Hive-trunk-hadoop1-ptest/41/])
    HIVE-4251 : Indices can't be built on tables whose schema info comes from SerDe (Mark Wagner via Ashutosh Chauhan) (Revision 1500452)

     Result = FAILURE
hashutosh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1500452
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java
* /hive/trunk/ql/src/test/queries/clientpositive/index_serde.q
* /hive/trunk/ql/src/test/results/clientpositive/index_serde.q.out
, Integrated in Hive-trunk-h0.21 #2185 (See [https://builds.apache.org/job/Hive-trunk-h0.21/2185/])
    HIVE-4251 : Indices can't be built on tables whose schema info comes from SerDe (Mark Wagner via Ashutosh Chauhan) (Revision 1500452)

     Result = FAILURE
hashutosh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1500452
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java
* /hive/trunk/ql/src/test/queries/clientpositive/index_serde.q
* /hive/trunk/ql/src/test/results/clientpositive/index_serde.q.out
, Integrated in Hive-trunk-hadoop2 #276 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/276/])
    HIVE-4251 : Indices can't be built on tables whose schema info comes from SerDe (Mark Wagner via Ashutosh Chauhan) (Revision 1500452)

     Result = FAILURE
hashutosh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1500452
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java
* /hive/trunk/ql/src/test/queries/clientpositive/index_serde.q
* /hive/trunk/ql/src/test/results/clientpositive/index_serde.q.out
, FAILURE: Integrated in Hive-trunk-hadoop2-ptest #14 (See [https://builds.apache.org/job/Hive-trunk-hadoop2-ptest/14/])
HIVE-4251 : Indices can't be built on tables whose schema info comes from SerDe (Mark Wagner via Ashutosh Chauhan) (hashutosh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1500452)
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java
* /hive/trunk/ql/src/test/queries/clientpositive/index_serde.q
* /hive/trunk/ql/src/test/results/clientpositive/index_serde.q.out
, This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.]