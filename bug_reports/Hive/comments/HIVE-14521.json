[[~szehon] fyi, So there is a method 'SessionState.getPerfLogger().cleanupPerfLogMetrics();' that i introduced in the driver return path for success or failure case that should take care of the error handling in theory.

As per multi threading, the scopes are Thread local, but they are opened at [https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/Driver.java#L348] and closed [https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/Driver.java#L559] so i believe this should be on the same thread.

I did a search and noticed that the PerfLogger.COMPILE scope is also used in TezJobMonitor, that might cause a conflict as its different thread.  Is it possible to rename that one?, Sorry never mind, read access by TezJobMonitor should be ok as it doesnt create a scope, hm.., Actually, there aren't Gbs of these errors, there are just a few thousand... still, that's a lot. I'll file a separate bug for Gbs ;), Looks like false alarm. The logs were from an older build which did not have HIVE-13410. Closing as dup.]