[When the query is re-written to properly put the / 10.0 after the OVER, it fails with:

{code}
NoViableAltException(15@[129:7: ( ( ( KW_AS )? identifier ) | ( KW_AS LPAREN identifier ( COMMA identifier )* RPAREN ) )?])
{code}, The behavior today is similar to UDAF evaluation and group by:
- the UDAF is evaluated in the PTFOp
- the non UDAF parts of an expression are evaluated in the child Select Operator.
- the over clause is associated with all UDAFs in the Select Clause.
- So you can express things like (see are test cases from windowing_expressions.q)
{noformat}
select p_mfgr, p_retailprice, p_size,
round(sum(p_retailprice),2) = round((sum(lag(p_retailprice,1)) - first_value(p_retailprice)) + last_value(p_retailprice),2)  over(distribute by p_mfgr sort by p_retailprice),
max(p_retailprice) - min(p_retailprice) = last_value(p_retailprice) - first_value(p_retailprice)
  over(distribute by p_mfgr sort by p_retailprice)
from part;

select p_mfgr, p_retailprice, p_size,
rank() over (distribute by p_mfgr sort by p_retailprice) as r,
sum(p_retailprice) over (distribute by p_mfgr sort by p_retailprice rows between unbounded preceding and current row) as s2,
sum(p_retailprice) - 5 over (distribute by p_mfgr sort by p_retailprice rows between unbounded preceding and current row) as s1
from part;
{noformat}

- Can you post what output you are expecting for the first query you posted?
- Have to look at whether we can switch the second form you posted. This will make the first e.g. much more cumbersome
  to write., https://reviews.facebook.net/D12375, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12598862/HIVE-4214.patch

{color:red}ERROR:{color} -1 due to 2 failed/errored test(s), 2886 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_correlationoptimizer12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ctas_colname
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/481/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/481/console

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 2 tests failed
{noformat}

This message is automatically generated., Updated patch to fix failing tests., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12598902/HIVE-4214.3.patch

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 2887 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_infer_bucket_sort_reducers_power_two
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/486/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/486/console

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated., +1, Committed to trunk. Thanks, Harish for the review!, FAILURE: Integrated in Hive-trunk-hadoop2-ptest #67 (See [https://builds.apache.org/job/Hive-trunk-hadoop2-ptest/67/])
HIVE-4214 : OVER accepts general expression instead of just function (Ashutosh Chauhan Reviewed by Harish Butani) (hashutosh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1516180)
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/ErrorMsg.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/IdentifiersParser.g
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SelectClauseParser.g
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_HavingLeadWithNoGBYNoWindowing.q
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_HavingLeadWithPTF.q
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_InvalidValueBoundary.q
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_WhereWithRankCond.q
* /hive/trunk/ql/src/test/queries/clientnegative/windowing_leadlag_in_udaf.q
* /hive/trunk/ql/src/test/queries/clientnegative/windowing_ll_no_over.q
* /hive/trunk/ql/src/test/queries/clientpositive/ctas_colname.q
* /hive/trunk/ql/src/test/queries/clientpositive/ptf.q
* /hive/trunk/ql/src/test/queries/clientpositive/windowing.q
* /hive/trunk/ql/src/test/queries/clientpositive/windowing_expressions.q
* /hive/trunk/ql/src/test/queries/clientpositive/windowing_windowspec.q
* /hive/trunk/ql/src/test/results/clientnegative/ptf_negative_HavingLeadWithNoGBYNoWindowing.q.out
* /hive/trunk/ql/src/test/results/clientnegative/ptf_negative_WhereWithRankCond.q.out
* /hive/trunk/ql/src/test/results/clientnegative/windowing_leadlag_in_udaf.q.out
* /hive/trunk/ql/src/test/results/clientnegative/windowing_ll_no_over.q.out
* /hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer12.q.out
* /hive/trunk/ql/src/test/results/clientpositive/ctas_colname.q.out
* /hive/trunk/ql/src/test/results/clientpositive/ptf.q.out
* /hive/trunk/ql/src/test/results/clientpositive/windowing.q.out
* /hive/trunk/ql/src/test/results/clientpositive/windowing_expressions.q.out
* /hive/trunk/ql/src/test/results/clientpositive/windowing_windowspec.q.out
, SUCCESS: Integrated in Hive-trunk-hadoop1-ptest #135 (See [https://builds.apache.org/job/Hive-trunk-hadoop1-ptest/135/])
HIVE-4214 : OVER accepts general expression instead of just function (Ashutosh Chauhan Reviewed by Harish Butani) (hashutosh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1516180)
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/ErrorMsg.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/IdentifiersParser.g
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SelectClauseParser.g
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_HavingLeadWithNoGBYNoWindowing.q
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_HavingLeadWithPTF.q
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_InvalidValueBoundary.q
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_WhereWithRankCond.q
* /hive/trunk/ql/src/test/queries/clientnegative/windowing_leadlag_in_udaf.q
* /hive/trunk/ql/src/test/queries/clientnegative/windowing_ll_no_over.q
* /hive/trunk/ql/src/test/queries/clientpositive/ctas_colname.q
* /hive/trunk/ql/src/test/queries/clientpositive/ptf.q
* /hive/trunk/ql/src/test/queries/clientpositive/windowing.q
* /hive/trunk/ql/src/test/queries/clientpositive/windowing_expressions.q
* /hive/trunk/ql/src/test/queries/clientpositive/windowing_windowspec.q
* /hive/trunk/ql/src/test/results/clientnegative/ptf_negative_HavingLeadWithNoGBYNoWindowing.q.out
* /hive/trunk/ql/src/test/results/clientnegative/ptf_negative_WhereWithRankCond.q.out
* /hive/trunk/ql/src/test/results/clientnegative/windowing_leadlag_in_udaf.q.out
* /hive/trunk/ql/src/test/results/clientnegative/windowing_ll_no_over.q.out
* /hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer12.q.out
* /hive/trunk/ql/src/test/results/clientpositive/ctas_colname.q.out
* /hive/trunk/ql/src/test/results/clientpositive/ptf.q.out
* /hive/trunk/ql/src/test/results/clientpositive/windowing.q.out
* /hive/trunk/ql/src/test/results/clientpositive/windowing_expressions.q.out
* /hive/trunk/ql/src/test/results/clientpositive/windowing_windowspec.q.out
, FAILURE: Integrated in Hive-trunk-h0.21 #2282 (See [https://builds.apache.org/job/Hive-trunk-h0.21/2282/])
HIVE-4214 : OVER accepts general expression instead of just function (Ashutosh Chauhan Reviewed by Harish Butani) (hashutosh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1516180)
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/ErrorMsg.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/IdentifiersParser.g
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SelectClauseParser.g
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_HavingLeadWithNoGBYNoWindowing.q
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_HavingLeadWithPTF.q
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_InvalidValueBoundary.q
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_WhereWithRankCond.q
* /hive/trunk/ql/src/test/queries/clientnegative/windowing_leadlag_in_udaf.q
* /hive/trunk/ql/src/test/queries/clientnegative/windowing_ll_no_over.q
* /hive/trunk/ql/src/test/queries/clientpositive/ctas_colname.q
* /hive/trunk/ql/src/test/queries/clientpositive/ptf.q
* /hive/trunk/ql/src/test/queries/clientpositive/windowing.q
* /hive/trunk/ql/src/test/queries/clientpositive/windowing_expressions.q
* /hive/trunk/ql/src/test/queries/clientpositive/windowing_windowspec.q
* /hive/trunk/ql/src/test/results/clientnegative/ptf_negative_HavingLeadWithNoGBYNoWindowing.q.out
* /hive/trunk/ql/src/test/results/clientnegative/ptf_negative_WhereWithRankCond.q.out
* /hive/trunk/ql/src/test/results/clientnegative/windowing_leadlag_in_udaf.q.out
* /hive/trunk/ql/src/test/results/clientnegative/windowing_ll_no_over.q.out
* /hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer12.q.out
* /hive/trunk/ql/src/test/results/clientpositive/ctas_colname.q.out
* /hive/trunk/ql/src/test/results/clientpositive/ptf.q.out
* /hive/trunk/ql/src/test/results/clientpositive/windowing.q.out
* /hive/trunk/ql/src/test/results/clientpositive/windowing_expressions.q.out
* /hive/trunk/ql/src/test/results/clientpositive/windowing_windowspec.q.out
, ABORTED: Integrated in Hive-trunk-hadoop2 #374 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/374/])
HIVE-4214 : OVER accepts general expression instead of just function (Ashutosh Chauhan Reviewed by Harish Butani) (hashutosh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1516180)
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/ErrorMsg.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/IdentifiersParser.g
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SelectClauseParser.g
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_HavingLeadWithNoGBYNoWindowing.q
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_HavingLeadWithPTF.q
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_InvalidValueBoundary.q
* /hive/trunk/ql/src/test/queries/clientnegative/ptf_negative_WhereWithRankCond.q
* /hive/trunk/ql/src/test/queries/clientnegative/windowing_leadlag_in_udaf.q
* /hive/trunk/ql/src/test/queries/clientnegative/windowing_ll_no_over.q
* /hive/trunk/ql/src/test/queries/clientpositive/ctas_colname.q
* /hive/trunk/ql/src/test/queries/clientpositive/ptf.q
* /hive/trunk/ql/src/test/queries/clientpositive/windowing.q
* /hive/trunk/ql/src/test/queries/clientpositive/windowing_expressions.q
* /hive/trunk/ql/src/test/queries/clientpositive/windowing_windowspec.q
* /hive/trunk/ql/src/test/results/clientnegative/ptf_negative_HavingLeadWithNoGBYNoWindowing.q.out
* /hive/trunk/ql/src/test/results/clientnegative/ptf_negative_WhereWithRankCond.q.out
* /hive/trunk/ql/src/test/results/clientnegative/windowing_leadlag_in_udaf.q.out
* /hive/trunk/ql/src/test/results/clientnegative/windowing_ll_no_over.q.out
* /hive/trunk/ql/src/test/results/clientpositive/correlationoptimizer12.q.out
* /hive/trunk/ql/src/test/results/clientpositive/ctas_colname.q.out
* /hive/trunk/ql/src/test/results/clientpositive/ptf.q.out
* /hive/trunk/ql/src/test/results/clientpositive/windowing.q.out
* /hive/trunk/ql/src/test/results/clientpositive/windowing_expressions.q.out
* /hive/trunk/ql/src/test/results/clientpositive/windowing_windowspec.q.out
, This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.]