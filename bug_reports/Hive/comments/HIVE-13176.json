[There's several issues here, and two cases being looked at.

In the first case, there's a lot of failed queries. Driver instances are retained by the Shutdownhook - 35K of them. Looking at the code, I couldn't see any direct leaks - and can only attribute this to failed queries / connections - where the client may have failed to close the connection.

In the second case, there's two main culprits. DataNucleus PluginManager seems to be retaining a large chunk of the heap. The second is a single FileSystem object which is over 100MB. This is caused by retention of FSStatistics objects - and has been fixed in a Hadoop jira - we should look at adding a workaround for this, i.e. consume the statistics instance as part of the close. The second reason is a large number of entities registered in the deleteOnExit tracker within FileSystem. That, I believe, is something that Hive will need to look at., This is targeting 2.0.1 but has no patch. Should it be moved out to 2.1.0?, Removing 2.1.0 target. Please feel free to commit to branch-2.1 anyway and fix for 2.1.0 if this happens before the release., Hello, I am deferring this to Hive 3.0 as we are going to cut the first RC and it is not marked as blocker. Please feel free to commit to the branch if this can be resolved before the release.]