[I can't uploadthe hive.log but its here:
http://104.198.109.242/logs/PreCommit-HIVE-Build-14499/failed/155-TestMiniLlapCliDriver-orc_ppd_schema_evol_3a.q-import_exported_table.q-tez_union_dynamic_partition.q-and-12-more/logs/, the derby.log is interesting...it seems like derby have started "again" during the test (uploaded derby.log)
the failing query is transactional related; but I doubt that the query is the cause of this.... cc: [~ekoifman], no it seems like derby.log usually looks like this...a bunch of duplicate propery messages...a couple of 0x00 chars...and then the booting/etc....last line usually is:
Database Class Loader started - derby.database.classpath='', we seem to be using a pretty recent derby...10.14.1.0 - 10.14.2.0 doesn't seem to bring any bug fixes relating to this..., derby can't handle concurrent threads.   In the past I've mostly seen it get wedged.
The hearbeater thread is normally started automatically by the client (DbTxnManager) to let the system know the txn is alive.
By default, the txn timeout is 5min and the 1st hearbeat for a given query should happen after 2.5 minutes.
So if your query is running longer than that (which is unusual in UTs), it's possible that the heartbeater is the 2nd thread...]