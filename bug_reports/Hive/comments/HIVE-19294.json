[Sounds like a bug in Hive's constant folding rule. a can either be 'all' or null after grouping set inner query so outer query case statement folding to  CASE WHEN (true) THEN ('x') is incorrect.]