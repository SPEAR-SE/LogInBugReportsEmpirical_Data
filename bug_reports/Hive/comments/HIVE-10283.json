[[~xuefuz] && [~szehon], could you find someone who know this part well work on the issue. Currently, in upstream master code , number of buckets is not respected even with insert overwrite. (insert overwrite only create 1 bucket file while the table definition is 2. 
Reproduce:
{noformat}
create table buckettest (data string) partitioned by (state string) clustered by (data) into 2 buckets;
set hive.enforce.bucketing = true;
insert overwrite table buckettest partition(state='MA') select code from jsmall limit 10;
set hive.auto.convert.sortmerge.join=true;
set hive.optimize.bucketmapjoin = true; 
set hive.optimize.bucketmapjoin.sortedmerge = true;
0: jdbc:hive2://localhost:10000> select * from buckettest a join buckettestoutput2 b on (a.data=b.data);
select * from buckettest a join buckettestoutpu 
t2 b on (a.data=b.data);
Error: Error while compiling statement: FAILED: SemanticException [Error 10141]: Bucketed table metadata is not correct. Fix the metadata or don't use bucketed mapjoin, by setting hive.enforce.bucketmapjoin to false. The number of buckets for table buckettest partition state=MA is 2, whereas the number of files is 1 (state=42000,code=10141)
{noformat}
, If this is the case, then it's a serious issue. My guess is that the number of reducer isn't set correctly. This seems to be a different issue than this JIRA. Could you please create a new JIRA. If this also happens to 1.2 release, then we need to mark it as a blocker for 1.2.1 release as well.]