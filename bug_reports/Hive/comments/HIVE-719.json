[This patch fixes the problem., This patch fixes the problem and adds a test., The changes look fine - I will commit them after 487 , Committed. Thanks Zheng]