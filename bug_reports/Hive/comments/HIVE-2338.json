[
-----------------------------------------------------------
This is an automatically generated e-mail. To reply, visit:
https://reviews.apache.org/r/1276/
-----------------------------------------------------------

Review request for hive and Paul Yang.


Summary
-------

Every failure in an alter table function always return a MetaException. When altering tables and catching exceptions, we throw a MetaException in the "finally" part of a try-catch-finally block, which overrides any other exceptions thrown.

This patch moves the code to throw an error on a commit failure outside of the try-catch-finally block.  So any errors within the try block are thrown properly.  Only when success == false will we throw a MetaException.


This addresses bug HIVE-2338.
    https://issues.apache.org/jira/browse/HIVE-2338


Diffs
-----

  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java 1152020 

Diff: https://reviews.apache.org/r/1276/diff


Testing
-------

Tested failing alter table metastore commands; they threw InvalidOperationExceptions as they should, instead of meaningless MetaExceptions.


Thanks,

Sohan

, +1 with the nit that the comment about that code being reached only if the try-catch-finally isn't triggered isn't particularly helpful since it describes the obvious path through the code and won't be interesting once this patch goes in., 
-----------------------------------------------------------
This is an automatically generated e-mail. To reply, visit:
https://reviews.apache.org/r/1276/
-----------------------------------------------------------

(Updated 2011-08-03 23:59:06.774216)


Review request for hive and Paul Yang.


Changes
-------

-remove unecessary comment


Summary
-------

Every failure in an alter table function always return a MetaException. When altering tables and catching exceptions, we throw a MetaException in the "finally" part of a try-catch-finally block, which overrides any other exceptions thrown.

This patch moves the code to throw an error on a commit failure outside of the try-catch-finally block.  So any errors within the try block are thrown properly.  Only when success == false will we throw a MetaException.


This addresses bug HIVE-2338.
    https://issues.apache.org/jira/browse/HIVE-2338


Diffs (updated)
-----

  trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java 1152020 

Diff: https://reviews.apache.org/r/1276/diff


Testing
-------

Tested failing alter table metastore commands; they threw InvalidOperationExceptions as they should, instead of meaningless MetaExceptions.


Thanks,

Sohan

, Committed to trunk. Thanks Sohan!, Integrated in Hive-trunk-h0.21 #910 (See [https://builds.apache.org/job/Hive-trunk-h0.21/910/])
    HIVE-2338. Alter table always throws an unhelpful error on failure (Sohan Jain via cws)

cws : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1160551
Files : 
* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java
]