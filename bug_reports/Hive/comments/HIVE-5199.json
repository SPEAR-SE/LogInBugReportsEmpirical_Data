[Adding code changes to avoid nested structures within complex datatypes to throw exception, Hari,

Thanks for the contribution! On small suggestion, in this JIRA project we discuss the Apache Hive project, not a distribution, therefore it's useful to discuss a regression in 0.9., 0.10, or 0.11 which caused this., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12601447/HIVE-5199.patch.txt

{color:red}ERROR:{color} -1 due to 24 failed/errored test(s), 2909 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_sort_11
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_vs_table_metadata
org.apache.hcatalog.mapreduce.TestHCatPartitioned.testHCatPartitionedTable
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_metadataonly1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat9
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_decimal_precision
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat11
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_serde_format
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat16
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_date2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_fileformat_mix
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat10
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_neg_float
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partInit
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat8
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat14
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_combine3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_date
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat15
org.apache.hcatalog.mapreduce.TestHCatExternalPartitioned.testHCatPartitionedTable
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/615/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/615/console

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 24 tests failed
{noformat}

This message is automatically generated., While testing, we need to move CustomSerDes.jar to data/files, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12601543/HIVE-5199.2.patch.txt

{color:red}ERROR:{color} -1 due to 2 failed/errored test(s), 2910 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat17
org.apache.hive.hcatalog.mapreduce.TestHCatExternalPartitioned.testHCatPartitionedTable
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/626/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/626/console

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 2 tests failed
{noformat}

This message is automatically generated., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12601543/HIVE-5199.2.patch.txt

{color:red}ERROR:{color} -1 due to 6 failed/errored test(s), 2910 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat17
org.apache.hive.hcatalog.mapreduce.TestSequenceFileReadWrite.testSequenceTableWriteRead
org.apache.hive.hcatalog.mapreduce.TestHCatExternalPartitioned.testHCatPartitionedTable
org.apache.hive.hcatalog.mapreduce.TestSequenceFileReadWrite.testTextTableWriteRead
org.apache.hive.hcatalog.mapreduce.TestSequenceFileReadWrite.testSequenceTableWriteReadMR
org.apache.hive.hcatalog.mapreduce.TestSequenceFileReadWrite.testTextTableWriteReadMR
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/629/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/629/console

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 6 tests failed
{noformat}

This message is automatically generated., [~hsubramaniyan] Can you create a phabricator or RB link for this patch?, Created RB link : https://reviews.apache.org/r/14008/, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12601756/HIVE-5199.3.patch.txt

{color:red}ERROR:{color} -1 due to 10 failed/errored test(s), 3085 tests executed
*Failed tests:*
{noformat}
org.apache.hive.hcatalog.fileformats.TestOrcDynamicPartitioned.testHCatDynamicPartitionedTableMultipleTask
org.apache.hive.hcatalog.pig.TestHCatLoaderComplexSchema.testSyntheticComplexSchema
org.apache.hive.hcatalog.fileformats.TestOrcDynamicPartitioned.testHCatDynamicPartitionedTable
org.apache.hive.hcatalog.mapreduce.TestHCatExternalDynamicPartitioned.testHCatDynamicPartitionedTable
org.apache.hive.hcatalog.mapreduce.TestSequenceFileReadWrite.testSequenceTableWriteRead
org.apache.hive.hcatalog.mapreduce.TestHCatExternalPartitioned.testHCatPartitionedTable
org.apache.hive.hcatalog.mapreduce.TestSequenceFileReadWrite.testTextTableWriteRead
org.apache.hive.hcatalog.mapreduce.TestSequenceFileReadWrite.testSequenceTableWriteReadMR
org.apache.hive.hcatalog.mapreduce.TestSequenceFileReadWrite.testTextTableWriteReadMR
org.apache.hcatalog.pig.TestHCatStorer.testDynamicPartitioningMultiPartColsInDataNoSpec
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/648/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/648/console

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 10 tests failed
{noformat}

This message is automatically generated., Looks good overall. Can you also add a similar test for unpartitioned table? Also test which result in MR job (select a,b from T) for both scenarios., Uploaded test cases for cast exceptions which can happen via MapOperator as well as the FetchOperator. I ran all the failed tests from the previous iterations locally and these complete without any failures. I looked at the stack trace. The failures do not look relevant to the changes I made. Can you please confirm.
-Hari
, +1, Committed to trunk. Thanks, Hari!, FAILURE: Integrated in Hive-trunk-hadoop2-ptest #89 (See [https://builds.apache.org/job/Hive-trunk-hadoop2-ptest/89/])
HIVE-5199 : Custom SerDe containing a nonSettable complex data type row object inspector throws cast exception with HIVE 0.11 (Hari Sankar via Ashutosh Chauhan) (hashutosh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1521155)
* /hive/trunk/build-common.xml
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/FetchOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MapOperator.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomNonSettableListObjectInspector1.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomNonSettableStructObjectInspector1.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomSerDe1.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomSerDe2.java
* /hive/trunk/ql/src/test/queries/clientpositive/partition_wise_fileformat17.q
* /hive/trunk/ql/src/test/results/clientpositive/partition_wise_fileformat17.q.out
* /hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/ObjectInspectorConverters.java
, FAILURE: Integrated in Hive-trunk-hadoop1-ptest #157 (See [https://builds.apache.org/job/Hive-trunk-hadoop1-ptest/157/])
HIVE-5199 : Custom SerDe containing a nonSettable complex data type row object inspector throws cast exception with HIVE 0.11 (Hari Sankar via Ashutosh Chauhan) (hashutosh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1521155)
* /hive/trunk/build-common.xml
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/FetchOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MapOperator.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomNonSettableListObjectInspector1.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomNonSettableStructObjectInspector1.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomSerDe1.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomSerDe2.java
* /hive/trunk/ql/src/test/queries/clientpositive/partition_wise_fileformat17.q
* /hive/trunk/ql/src/test/results/clientpositive/partition_wise_fileformat17.q.out
* /hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/ObjectInspectorConverters.java
, Ashutosh Chauhan Thanks for committing the changes. I see that data/files/pw17.txt is missing from the commit. Can you please make sure this is added to the trunk, otherwise the testcase partition_wise_fileformat17 will fail., [~ashutoshc] Please add data/files/pw17.txt  to the trunk. Otherwise, partition_wise_fileformat17 will fail.
Hari, Fixed via HIVE-5249, FAILURE: Integrated in Hive-trunk-h0.21 #2322 (See [https://builds.apache.org/job/Hive-trunk-h0.21/2322/])
HIVE-5199 : Custom SerDe containing a nonSettable complex data type row object inspector throws cast exception with HIVE 0.11 (Hari Sankar via Ashutosh Chauhan) (hashutosh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1521155)
* /hive/trunk/build-common.xml
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/FetchOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MapOperator.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomNonSettableListObjectInspector1.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomNonSettableStructObjectInspector1.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomSerDe1.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomSerDe2.java
* /hive/trunk/ql/src/test/queries/clientpositive/partition_wise_fileformat17.q
* /hive/trunk/ql/src/test/results/clientpositive/partition_wise_fileformat17.q.out
* /hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/ObjectInspectorConverters.java
, ABORTED: Integrated in Hive-trunk-hadoop2 #419 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/419/])
HIVE-5199 : Custom SerDe containing a nonSettable complex data type row object inspector throws cast exception with HIVE 0.11 (Hari Sankar via Ashutosh Chauhan) (hashutosh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1521155)
* /hive/trunk/build-common.xml
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/FetchOperator.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MapOperator.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomNonSettableListObjectInspector1.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomNonSettableStructObjectInspector1.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomSerDe1.java
* /hive/trunk/ql/src/test/org/apache/hadoop/hive/serde2/CustomSerDe2.java
* /hive/trunk/ql/src/test/queries/clientpositive/partition_wise_fileformat17.q
* /hive/trunk/ql/src/test/results/clientpositive/partition_wise_fileformat17.q.out
* /hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/ObjectInspectorConverters.java
, Patch committed to 0.12 branch., Applying these changes in the 0.12 branch stomped some changes in HIVE-5206 since they touch some of the same code.  Attaching a fix for the conflict. , Thanks Jason! Committed the conflict fix to 0.12 branch., This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.]