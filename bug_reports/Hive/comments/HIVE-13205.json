[Hi,

I am running following query to fill all null with the last known value in the column:
Select price,time, id,last_value(price,true) over (partition by id order by time) as LatestPrice from table;

For few record, the query is running successfully. Buy for large number of records (2 Bn), the query keep running forever., If you are using Tez, can you run the query with a few million rows and post the summary output (set hive.tez.exec.print.summary=true; to enable).

, Gopal, I have tried the same with tez as well, but the reducer is still running forever. Also, The query works fine if each partition have number of records less than 30,000.

, Actually, that is not a fix - that's something that lets us get closer to the problem.

I think this query had a streaming rewrite which works similar to 

{{Select price,time, id, first_value(price,true) over (partition by id order by time desc) as LatestPrice from table;}}, I have tried many thing, but not able to solve the issue. In the mean while can you please suggest some other method to fill all null with the last known value in the same column. Can we achieve this using lag()., Doesn't first_value with descending sort do that?, Nope, I have tried this with 1 M record. Keep running. I am running this on 226 node hadoop cluster with hive-.14., I thought the bottleneck which was there earlier was fixed in HIVE-7344 (hive-1.0?), but the shuffle still moves all rows at least once.

So your shuffle operation will end up being the bottleneck if id has a low nDV.

Best to print out the summary on a lower run and see if it is running 1 reducer forever or not.]