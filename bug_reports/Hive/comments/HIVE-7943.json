[

{color:green}Overall{color}: +1 all checks pass

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12666082/HIVE-7943.1.patch

{color:green}SUCCESS:{color} +1 6142 tests passed

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/611/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/611/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-611/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12666082, [~thejas] Can you  have a look at this?, This patch does not add the owner grants into table metadata. That is the purpose of this configuration flag. Instead it is adding the privileges at runtime during the checks.

Looking at the current code again, I don't see a bug there wrt to the privileges getting set at table creation. I wonder if the problem is that "ALL" privileges are not getting correctly interpreted as including the the Drop privilege.

In the example that you have in description. Can you paste the output of 'show grant on table temp_table' ?
, Is that the purpose of the configuration flag? I thought the reason for separating owner grants from user grants was that the owner grants are dynamically applied at the time of authorization to the current owner (if there would be a way to change the owner). If they are persisted in metadata, the grants need to be changed when the owner changes or when the configuration property changes. (E.g. From ALL to SELECT, DROP etc.)

"show grant on temp_table" gives me empty results unless I explicitly do a 'grant all on temp_table to user testuser' . The problem is not observed only with "ALL" privileges. Same problem is encountered when I change the configuration property to DROP instead of ALL., The description of the configuration also mentions the purpose - "the privileges automatically granted to the owner whenever a table gets created." This is also the case with use grants configuration.
The purpose hasn't been changed intentionally.

The reason for separating user grants and owner grants was so that the owner user is set correctly, when the owner is changed within a session (for ease of testing).
, You can try tracing through the calls made from Hive.createTable to CreateTableAutomaticGrant.getUserGrants where it adds the grants to table object.
 , Okay, I understand the rationale behind the separation. But I am confused between the two cases:

1. Owner grants are tightly bound to the user who creates the table.
2. Owner grants are tightly bound only to the table (in metadata) but apply only to the current owner.

If case 1 is true, we can just append owner privileges to user privs at table creation time.
If case 2 is true, we need some place to store owner privileges in the metadata at table creation time and merge them with current user privileges (if he is the owner) at the time of authorization., Case 2 is not relevant right now, because there is no syntax support for altering table owner.
, But if case 2 were to be supported, we would need to add support for setting privileges for new owner.
, [~THEcreationist] can you check if the attached patch HIVE-7943.2.patch fixes the issue ?
, 

{color:green}Overall{color}: +1 all checks pass

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12666428/HIVE-7943.2.patch

{color:green}SUCCESS:{color} +1 6142 tests passed

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/634/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/634/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-634/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12666428, [~thejas] I just verified that it works., We would need a test case before it can be committed. Will you be able to help add a test case for this ?
, Thanks for verifying the patch Ashu!
, Yeah sure, I will update the patch with a test case., You can look at one of the .q file based authorization tests such as ql/src/test/queries/clientpositive/authorization_1.q for a template.

, One test case seems sufficient for the change. Just checking whether appropriate grants are present after table creation., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12666638/HIVE-7943.3.patch

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 6140 tests executed
*Failed tests:*
{noformat}
org.apache.hive.jdbc.miniHS2.TestHiveServer2.testConnection
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/652/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/652/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-652/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12666638, +1, Patch committed to trunk.
Thanks for the contribution [~THEcreationist] ! Looking forward to many more!
, This has been fixed in 0.14 release. Please open new jira if you see any issues.
, HIVE-7943.013.stdauth.patch - A reference patch that could be used by anyone wishing to apply this fix and additional change to have hive cli create tables that work with SQL std auth privileges.
, bq.  "A reference patch that could be used by anyone wishing to apply this fix and additional change ..."

I guess this doesn't need to be documented, but a message to user@hive would boost visibility.]