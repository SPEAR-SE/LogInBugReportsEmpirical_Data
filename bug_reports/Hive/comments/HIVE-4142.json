[hbutani requested code review of "HIVE-4142 [jira] Remove inferring partition specification behavior".

Reviewers: JIRA, ashutoshc

remove behavior that infers partitioning

Remove behavior that:

	implicitly sets the partition specification of a UDAF

this interferes with:

	the user wanting to apply a UDAF on the entire dataset
	is ambiguous once we support multiple partitions in 1 query.

TEST PLAN
  updated tests

REVISION DETAIL
  https://reviews.facebook.net/D9285

AFFECTED FILES
  data/files/flights_tiny.txt
  data/files/part.rc
  data/files/part.seq
  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
  ql/src/java/org/apache/hadoop/hive/ql/parse/WindowingSpec.java
  ql/src/test/queries/clientpositive/leadlag.q
  ql/src/test/queries/clientpositive/leadlag_queries.q
  ql/src/test/queries/clientpositive/ptf.q
  ql/src/test/queries/clientpositive/ptf_general_queries.q
  ql/src/test/queries/clientpositive/ptf_rcfile.q
  ql/src/test/queries/clientpositive/ptf_seqfile.q
  ql/src/test/queries/clientpositive/windowing.q
  ql/src/test/queries/clientpositive/windowing_columnPruning.q
  ql/src/test/queries/clientpositive/windowing_expressions.q
  ql/src/test/results/clientpositive/leadlag.q.out
  ql/src/test/results/clientpositive/leadlag_queries.q.out
  ql/src/test/results/clientpositive/ptf.q.out
  ql/src/test/results/clientpositive/ptf_general_queries.q.out
  ql/src/test/results/clientpositive/ptf_rcfile.q.out
  ql/src/test/results/clientpositive/ptf_seqfile.q.out
  ql/src/test/results/clientpositive/windowing.q.out
  ql/src/test/results/clientpositive/windowing_columnPruning.q.out
  ql/src/test/results/clientpositive/windowing_expressions.q.out

MANAGE HERALD RULES
  https://reviews.facebook.net/herald/view/differential/

WHY DID I GET THIS EMAIL?
  https://reviews.facebook.net/herald/transcript/22359/

To: JIRA, ashutoshc, hbutani
, Ashutosh, Prajakta, Brock: please take a look.
Had to revise a good portion of the tests.
All the tests have the same result, except 2: ptf.q: q11 and windowing.q q10
Both these have to do with support for having with windowing.
Now that a Window Function has to explicitly have a Window Spec (unless it is the partition by constant case) it is harder to associate a fn invocation in having with a UDAF with an over clause. You cannot say:
{noformat}
having rank() over(..) > 5
{noformat}
Will address this in another Jira; probably remove the code that tries to associate a having clause with a WindowingSpec., Good idea to do it in a separate jira. I am not sure if other systems support windowing function in having clause either. Will also look at sql spec to see if standard says something about that. , Thinking more about it, I think we should just outright remove support for this. No other systems supports this. And this is one of the cases where we are adding semantics (allowing having without a group-by) which will be a deviation from a standard. Further, we are not getting it for free and have to write and maintain more code for it., You have already removed functions moveaggregationExprsToWindowingSpec(), ensureWindowingSpecOnQB() etc., so as far as I see support has already been removed. Is there anything more we need to do here?

Patch looks good. +1 , Ashutosh, thanks for reviewing.
Will add a Jira to remove the having behavior., All the +ve test cases passed. But following negative test cases failed:
ptf_negative_NoSortNoDistByClause.q
ptf_negative_IncompatibleSortClause.q
ptf_negative_AggrFuncsWithNoGBYNoPartDef.q

Looks like need to update .q.out files for these., hbutani updated the revision "HIVE-4142 [jira] Remove inferring partition specification behavior".

    - Merge branch 'ptf' into HIVE-4142
    - Merge branch 'ptf' into HIVE-4142

Reviewers: JIRA, ashutoshc

REVISION DETAIL
  https://reviews.facebook.net/D9285

CHANGE SINCE LAST DIFF
  https://reviews.facebook.net/D9285?vs=29547&id=29619#toc

AFFECTED FILES
  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
  ql/src/java/org/apache/hadoop/hive/ql/parse/WindowingSpec.java
  ql/src/test/queries/clientnegative/ptf_negative_IncompatibleSortClause.q
  ql/src/test/queries/clientnegative/ptf_negative_NoSortNoDistByClause.q
  ql/src/test/queries/clientpositive/leadlag.q
  ql/src/test/queries/clientpositive/leadlag_queries.q
  ql/src/test/queries/clientpositive/ptf.q
  ql/src/test/queries/clientpositive/ptf_general_queries.q
  ql/src/test/queries/clientpositive/ptf_rcfile.q
  ql/src/test/queries/clientpositive/ptf_seqfile.q
  ql/src/test/queries/clientpositive/windowing.q
  ql/src/test/queries/clientpositive/windowing_columnPruning.q
  ql/src/test/queries/clientpositive/windowing_expressions.q
  ql/src/test/results/clientnegative/ptf_negative_AggrFuncsWithNoGBYNoPartDef.q.out
  ql/src/test/results/clientnegative/ptf_negative_NoSortNoDistByClause.q.out
  ql/src/test/results/clientpositive/leadlag.q.out
  ql/src/test/results/clientpositive/leadlag_queries.q.out
  ql/src/test/results/clientpositive/ptf.q.out
  ql/src/test/results/clientpositive/ptf_general_queries.q.out
  ql/src/test/results/clientpositive/ptf_rcfile.q.out
  ql/src/test/results/clientpositive/ptf_seqfile.q.out
  ql/src/test/results/clientpositive/windowing.q.out
  ql/src/test/results/clientpositive/windowing_columnPruning.q.out
  ql/src/test/results/clientpositive/windowing_expressions.q.out

To: JIRA, ashutoshc, hbutani
, removed ptf_negative_NoSortNoDistByClause.q because this is a valid query now., Committed to branch. Thanks, Harish!, ashutoshc has accepted the revision "HIVE-4142 [jira] Remove inferring partition specification behavior".

  +1

REVISION DETAIL
  https://reviews.facebook.net/D9285

BRANCH
  HIVE-4142

ARCANIST PROJECT
  hive

To: JIRA, ashutoshc, hbutani
]