[Ideally, the group by can be much simpler and use that.
But, minimally it should not give wrong results., https://reviews.facebook.net/D9255, Tests passed, +1, Committed, thanks Namit., Integrated in Hive-trunk-h0.21 #2013 (See [https://builds.apache.org/job/Hive-trunk-h0.21/2013/])
    HIVE-4096. problem in hive.map.groupby.sorted with distincts. (njain via kevinwilfong) (Revision 1455650)

     Result = ABORTED
kevinwilfong : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1455650
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GroupByOptimizer.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/GroupByDesc.java
* /hive/trunk/ql/src/test/queries/clientpositive/groupby_sort_8.q
* /hive/trunk/ql/src/test/results/clientpositive/groupby_sort_8.q.out
, Integrated in Hive-trunk-hadoop2 #138 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/138/])
    HIVE-4096. problem in hive.map.groupby.sorted with distincts. (njain via kevinwilfong) (Revision 1455650)

     Result = FAILURE
kevinwilfong : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1455650
Files : 
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GroupByOptimizer.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/GroupByDesc.java
* /hive/trunk/ql/src/test/queries/clientpositive/groupby_sort_8.q
* /hive/trunk/ql/src/test/results/clientpositive/groupby_sort_8.q.out
]