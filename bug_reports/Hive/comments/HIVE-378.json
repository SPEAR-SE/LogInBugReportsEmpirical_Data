[want to add comments for unit tests in my HIVE-278 patch so made this quick patch., It might be better to remove comments in the parser, since its easier to deal with quoted strings containing '--'. Your change will convert a comment-less query like the following:

select '--test--', * from src

into an invalid query: select ', Only those lines that end in a new line will be removed. That should be enough since the probability of a string literal spanning multiple lines is low.

Correct way would be to make all non-query commands (such as dfs, !, set etc) go through parser.]