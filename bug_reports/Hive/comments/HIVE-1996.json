[This is very closely related to, but not the same as, HIVE-307. That bug specifically pertains to {{LOCAL}} files., After file name got changed it is trying to load with the old name because of this load is failed. 
Now we have changed the code like,  load with the changed filename  for that introduced a map it will maintain  the old name and changed filename as  key  value pair  and  while loading need to use this map., I tried running the test, but it fails for me.  I looked in hive.log and found

{noformat}
2011-07-07 14:45:34,359 ERROR hive.log (MetaStoreUtils.java:logAndThrowMetaException(778)) - java.io.FileNotFoundException: File file:/tmp1/load2_overwrite2 does not exist.
{noformat}
, This scenario will work if load from local but it will fail if loading from File-system. To replicate this scenarios i have used this queries "create table load_overwrite2 (key string, value string) stored as textfile location 'file:/tmp1/load2_overwrite2';" so as part of this query execution it should create this "file:/tmp1/load2_overwrite2". I have verified this in my environment it is working without fail. Pls let me know if any issues., 
-----------------------------------------------------------
This is an automatically generated e-mail. To reply, visit:
https://reviews.apache.org/r/1610/
-----------------------------------------------------------

Review request for hive, Carl Steinbach and John Sichi.


Summary
-------

"LOAD DATA INPATH" fails when the table already contains a file of the same name. If any name confilcts occurs it will rename the file, After file name got changed it is trying to load with the old name because of this load is failed. Now we have changed the code like, load with the changed filename for that introduced a map it will maintain the old name and changed filename as key value pair and while loading need to use this map.


This addresses bug HIVE-1996.
    https://issues.apache.org/jira/browse/HIVE-1996


Diffs
-----

  trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java 1160102 
  trunk/ql/src/test/queries/clientpositive/input44.q PRE-CREATION 
  trunk/ql/src/test/results/clientpositive/input44.q.out PRE-CREATION 

Diff: https://reviews.apache.org/r/1610/diff


Testing
-------

Added a test case for this scenario.


Thanks,

chinna

, For this, we need to make the rename optional, and by default disabled. If disabled rename, should throw an error to user., Agreed, I will update the patch with configuration., Hi He Yongqiang,
Here these 2 scenarios need to consider
1)If rename disabled  load one data folder that contains 10 files like 1.txt,2.txt...,10.txt   here in the table already one file present with same name 5.txt. While loading 5.txt it will throw the  exception and operation will fail but here already loaded file(1.txt,2.txt....4.txt) will present...

 1.txt,2.txt...,10.txt   here in the table already one file present with same name 6.txt. While loading 6.txt it will throw the  exception and operation will fail but here already loaded file(1.txt,2.txt....4.txt,5.txt ) will present...

	So its mainly dependent on the order and can cause inconsistencies.

2)In the current implementation also "org.apache.hadoop.hive.ql.metadata.Hive.copyFiles(Path, Path, FileSystem)"  if any of the file it is unable to rename it will throw exception but for the same operation some file will be loaded.

Proposed Sol:  While loading if any exception comes note that file as unloaded file and continue the load with remaining files  and operation will fail with the exception and unloaded file information  so user can retry loading the unloaded files alone. Here there is no inconsistent data.

Pls give u r inputs, 
-----------------------------------------------------------
This is an automatically generated e-mail. To reply, visit:
https://reviews.apache.org/r/1610/
-----------------------------------------------------------

(Updated 2011-11-09 16:44:55.708392)


Review request for hive, Carl Steinbach and John Sichi.


Changes
-------

Load rename made it configurable.


Summary
-------

"LOAD DATA INPATH" fails when the table already contains a file of the same name. If any name confilcts occurs it will rename the file, After file name got changed it is trying to load with the old name because of this load is failed. Now we have changed the code like, load with the changed filename for that introduced a map it will maintain the old name and changed filename as key value pair and while loading need to use this map.


This addresses bug HIVE-1996.
    https://issues.apache.org/jira/browse/HIVE-1996


Diffs (updated)
-----

  trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1198626 
  trunk/conf/hive-default.xml 1198626 
  trunk/data/conf/hive-site.xml 1198626 
  trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java 1198626 
  trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Table.java 1198626 
  trunk/ql/src/test/queries/clientpositive/input47.q PRE-CREATION 
  trunk/ql/src/test/results/clientpositive/input47.q.out PRE-CREATION 

Diff: https://reviews.apache.org/r/1610/diff


Testing
-------

Added a test case for this scenario.


Thanks,

chinna

, Yongqiang, can you take a look ?, Is this bug solved in hive-0.10.0_cdh4.2.0_20130411_1129?
I'm having this behavior in this version.
Regards, 

{color:red}Overall{color}: -1 no tests executed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12503097/HIVE-1996.2.Patch

Test results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/772/testReport
Console output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/772/console

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Tests exited with: NonZeroExitCodeException
Command 'bash /data/hive-ptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ [[ -n '' ]]
+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m '
+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m '
+ export 'M2_OPTS=-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128'
+ M2_OPTS='-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128'
+ cd /data/hive-ptest/working/
+ tee /data/hive-ptest/logs/PreCommit-HIVE-Build-772/source-prep.txt
+ [[ false == \t\r\u\e ]]
+ mkdir -p maven ivy
+ [[ svn = \s\v\n ]]
+ [[ -n '' ]]
+ [[ -d apache-svn-trunk-source ]]
+ [[ ! -d apache-svn-trunk-source/.svn ]]
+ [[ ! -d apache-svn-trunk-source ]]
+ cd apache-svn-trunk-source
+ svn revert -R .
Reverted 'ql/src/java/org/apache/hadoop/hive/ql/DriverContext.java'
Reverted 'ql/src/java/org/apache/hadoop/hive/ql/exec/TaskRunner.java'
Reverted 'ql/src/java/org/apache/hadoop/hive/ql/Driver.java'
++ awk '{print $2}'
++ egrep -v '^X|^Performing status on external'
++ svn status --no-ignore
+ rm -rf target datanucleus.log ant/target shims/target shims/0.20/target shims/0.20S/target shims/0.23/target shims/aggregator/target shims/common/target shims/common-secure/target packaging/target hbase-handler/target testutils/target jdbc/target metastore/target itests/target itests/hcatalog-unit/target itests/test-serde/target itests/qtest/target itests/hive-unit/target itests/custom-serde/target itests/util/target hcatalog/target hcatalog/storage-handlers/hbase/target hcatalog/server-extensions/target hcatalog/core/target hcatalog/webhcat/svr/target hcatalog/webhcat/java-client/target hcatalog/hcatalog-pig-adapter/target hwi/target common/target common/src/gen contrib/target service/target serde/target beeline/target odbc/target cli/target ql/dependency-reduced-pom.xml ql/target
+ svn update
U    hbase-handler/src/java/org/apache/hadoop/hive/hbase/HiveHBaseTableInputFormat.java

Fetching external item into 'hcatalog/src/test/e2e/harness'
Updated external to revision 1554298.

Updated to revision 1554298.
+ patchCommandPath=/data/hive-ptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hive-ptest/working/scratch/build.patch
+ [[ -f /data/hive-ptest/working/scratch/build.patch ]]
+ chmod +x /data/hive-ptest/working/scratch/smart-apply-patch.sh
+ /data/hive-ptest/working/scratch/smart-apply-patch.sh /data/hive-ptest/working/scratch/build.patch
The patch does not appear to apply with p0, p1, or p2
+ exit 1
'
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12503097, This issue is solved as part of HIVE-3300]