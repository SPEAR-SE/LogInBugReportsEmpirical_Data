[navis requested code review of "HIVE-3589 [jira] describe/show partition/show tblproperties command should accept database name".
Reviewers: JIRA

  DPAL-1916 describe/show partition/show tblproperties command should accept database name

  describe command not giving the details when called as describe dbname.tablename.

  Throwing the error "Table dbname not found".

  Ex: hive -e "describe masterdb.table1" will throw error
  "Table masterdb not found"

TEST PLAN
  EMPTY

REVISION DETAIL
  https://reviews.facebook.net/D6075

AFFECTED FILES
  ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java
  ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java
  ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g
  ql/src/java/org/apache/hadoop/hive/ql/plan/DescTableDesc.java
  ql/src/java/org/apache/hadoop/hive/ql/plan/ShowPartitionsDesc.java
  ql/src/java/org/apache/hadoop/hive/ql/plan/ShowTblPropertiesDesc.java
  ql/src/test/queries/clientpositive/describe_table.q
  ql/src/test/queries/clientpositive/show_partitions.q
  ql/src/test/queries/clientpositive/show_tblproperties.q
  ql/src/test/results/clientpositive/describe_table.q.out
  ql/src/test/results/clientpositive/show_partitions.q.out
  ql/src/test/results/clientpositive/show_tblproperties.q.out

MANAGE HERALD DIFFERENTIAL RULES
  https://reviews.facebook.net/herald/view/differential/

WHY DID I GET THIS EMAIL?
  https://reviews.facebook.net/herald/transcript/14523/

To: JIRA, navis
, @Navis: I added some comments on phabricator. Thanks., cwsteinbach has requested changes to the revision "HIVE-3589 [jira] describe/show partition/show tblproperties command should accept database name".

INLINE COMMENTS
  ql/src/test/queries/clientpositive/describe_table.q:5 Please demonstrate that this also works from another db/schema, e.g:

  CREATE DATABASE db1;
  USE db1;
  DESCRIBE default.srcpart;
  ...

  This same request also applies to the other tests that this patch modifies.
  ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java:1802 Formatting.
  ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java:1407 It looks likes this method either returns true or throws a SemanticException. I think it should either return true or false, and either never throw an exception, or only throw an exception when the db name is not valid for syntactic reasons.
  ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java:1472 There's some logic in DDLSemanticAnalyzer (see QualifiedNameUtil) that looks pretty similar. It would be nice to pull QualifiedNameUtil out into its own class in hive-common and reference that code from here and DDLSemanticAnalyzer.

  Also, "parseExpression" is a little generic. Maybe change the name to "parseTableName"?
  ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java:1474 I think it would be a bit cleaner to use StringUtils.split(), e.g:

  String[] names = StringUtils.split(tableName, ".");
  switch (names.length) {
    ...
  }
  ql/src/java/org/apache/hadoop/hive/ql/plan/DescTableDesc.java:112 If expression[0] == null, does that always imply that we're using the default db? If so can we return "default." + expression[1] in that case? And if we do that, then we should probably just enforce that expression[0] != null in the constructor.
  ql/src/java/org/apache/hadoop/hive/ql/plan/DescTableDesc.java:38 Please add a note explaining that DescTableDesc is overloaded to handle both describe column and describe table, and what this parameter is expected to contain in each case.
  ql/src/java/org/apache/hadoop/hive/ql/plan/ShowTblPropertiesDesc.java:34 "expression" is too generic in this case. Please change the name to "qualifiedTableName".
  ql/src/java/org/apache/hadoop/hive/ql/plan/ShowPartitionsDesc.java:64 s/expression/qualifiedTableName/

REVISION DETAIL
  https://reviews.facebook.net/D6075

BRANCH
  DPAL-1916

To: JIRA, cwsteinbach, navis
, navis has commented on the revision "HIVE-3589 [jira] describe/show partition/show tblproperties command should accept database name".

INLINE COMMENTS
  ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java:1802 fixed.
  ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java:1407 I just split original method to two. Exception seemed for handling thrift errors and should be re-thrown to user.
  ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java:1472 agreed. I'll do it.
  ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java:1474 I always thought splitting with regex pattern for this kind of simple string is a bit too much. But if it's cleaner, I'll do it.
  ql/src/java/org/apache/hadoop/hive/ql/plan/DescTableDesc.java:38 ok.
  ql/src/java/org/apache/hadoop/hive/ql/plan/DescTableDesc.java:112 I'll check on that.
  ql/src/java/org/apache/hadoop/hive/ql/plan/ShowPartitionsDesc.java:64 ok.
  ql/src/java/org/apache/hadoop/hive/ql/plan/ShowTblPropertiesDesc.java:34 ok.
  ql/src/test/queries/clientpositive/describe_table.q:5 Yes, it was HIVE-3676. I'll add the test.

REVISION DETAIL
  https://reviews.facebook.net/D6075

BRANCH
  DPAL-1916

To: JIRA, cwsteinbach, navis
, navis updated the revision "HIVE-3589 [jira] describe/show partition/show tblproperties command should accept database name".
Reviewers: JIRA, cwsteinbach

  addressed comments and rebased to trunk


REVISION DETAIL
  https://reviews.facebook.net/D6075

AFFECTED FILES
  ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java
  ql/src/java/org/apache/hadoop/hive/ql/parse/DDLSemanticAnalyzer.java
  ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g
  ql/src/java/org/apache/hadoop/hive/ql/parse/QualifiedNameUtil.java
  ql/src/java/org/apache/hadoop/hive/ql/plan/DescTableDesc.java
  ql/src/java/org/apache/hadoop/hive/ql/plan/ShowPartitionsDesc.java
  ql/src/java/org/apache/hadoop/hive/ql/plan/ShowTblPropertiesDesc.java
  ql/src/java/org/apache/hadoop/hive/ql/plan/TableDDLDesc.java
  ql/src/test/queries/clientnegative/desc_failure3.q
  ql/src/test/queries/clientpositive/describe_syntax.q
  ql/src/test/queries/clientpositive/describe_table.q
  ql/src/test/queries/clientpositive/describe_xpath.q
  ql/src/test/queries/clientpositive/show_partitions.q
  ql/src/test/queries/clientpositive/show_tblproperties.q
  ql/src/test/results/clientnegative/desc_failure3.q.out
  ql/src/test/results/clientpositive/describe_syntax.q.out
  ql/src/test/results/clientpositive/describe_table.q.out
  ql/src/test/results/clientpositive/describe_xpath.q.out
  ql/src/test/results/clientpositive/input1.q.out
  ql/src/test/results/clientpositive/input10.q.out
  ql/src/test/results/clientpositive/inputddl6.q.out
  ql/src/test/results/clientpositive/show_partitions.q.out
  ql/src/test/results/clientpositive/show_tblproperties.q.out
  ql/src/test/results/clientpositive/showparts.q.out

To: JIRA, cwsteinbach, navis
, Hi [~navis]
desc statements had been fixed in trunk.
But 'show partition ' and 'show tblproperties' statements have not been fixed yet .
I find simpley modify HiveParser.g file will fix this issue.
Please have a look at this rb:
https://reviews.apache.org/r/11753/
thank you, 

{color:red}Overall{color}: -1 no tests executed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12554436/HIVE-3589.D6075.2.patch

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/865/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/865/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-Build-865/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Tests exited with: NonZeroExitCodeException
Command 'bash /data/hive-ptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ [[ -n /usr/java/jdk1.7.0_45-cloudera ]]
+ export JAVA_HOME=/usr/java/jdk1.7.0_45-cloudera
+ JAVA_HOME=/usr/java/jdk1.7.0_45-cloudera
+ export PATH=/usr/java/jdk1.7.0_45-cloudera/bin/:/usr/java/jdk1.6.0_34/bin:/usr/local/apache-maven-3.0.5/bin:/usr/local/apache-maven-3.0.5/bin:/usr/java/jdk1.6.0_34/bin:/usr/local/apache-ant-1.9.1/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/hiveptest/bin
+ PATH=/usr/java/jdk1.7.0_45-cloudera/bin/:/usr/java/jdk1.6.0_34/bin:/usr/local/apache-maven-3.0.5/bin:/usr/local/apache-maven-3.0.5/bin:/usr/java/jdk1.6.0_34/bin:/usr/local/apache-ant-1.9.1/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/hiveptest/bin
+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m '
+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m '
+ export 'M2_OPTS=-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128'
+ M2_OPTS='-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128'
+ cd /data/hive-ptest/working/
+ tee /data/hive-ptest/logs/PreCommit-HIVE-Build-865/source-prep.txt
+ [[ false == \t\r\u\e ]]
+ mkdir -p maven ivy
+ [[ svn = \s\v\n ]]
+ [[ -n '' ]]
+ [[ -d apache-svn-trunk-source ]]
+ [[ ! -d apache-svn-trunk-source/.svn ]]
+ [[ ! -d apache-svn-trunk-source ]]
+ cd apache-svn-trunk-source
+ svn revert -R .
Reverted 'conf/hive-default.xml.template'
Reverted 'itests/qtest/testconfiguration.properties'
Reverted 'ql/src/test/org/apache/hadoop/hive/ql/exec/vector/TestVectorizedRowBatchCtx.java'
Reverted 'ql/src/java/org/apache/hadoop/hive/ql/optimizer/physical/Vectorizer.java'
Reverted 'ql/src/java/org/apache/hadoop/hive/ql/exec/vector/VectorizedColumnarSerDe.java'
Reverted 'ql/src/java/org/apache/hadoop/hive/ql/exec/vector/VectorizedBatchUtil.java'
Reverted 'ql/src/java/org/apache/hadoop/hive/ql/exec/vector/VectorizedRowBatchCtx.java'
Reverted 'ql/src/java/org/apache/hadoop/hive/ql/io/orc/RecordReaderImpl.java'
++ egrep -v '^X|^Performing status on external'
++ awk '{print $2}'
++ svn status --no-ignore
+ rm -rf target datanucleus.log ant/target shims/target shims/0.20/target shims/0.20S/target shims/0.23/target shims/aggregator/target shims/common/target shims/common-secure/target packaging/target hbase-handler/target testutils/target jdbc/target metastore/target itests/target itests/hcatalog-unit/target itests/test-serde/target itests/qtest/target itests/hive-unit-hadoop2/target itests/hive-minikdc/target itests/hive-unit/target itests/custom-serde/target itests/util/target hcatalog/target hcatalog/core/target hcatalog/streaming/target hcatalog/server-extensions/target hcatalog/hcatalog-pig-adapter/target hcatalog/webhcat/svr/target hcatalog/webhcat/java-client/target hwi/target common/target common/src/gen contrib/target service/target serde/target beeline/target odbc/target cli/target ql/dependency-reduced-pom.xml ql/target ql/src/test/results/clientpositive/vector_data_types.q.out ql/src/test/results/clientpositive/tez/vector_data_types.q.out ql/src/test/queries/clientpositive/vector_data_types.q
+ svn update

Fetching external item into 'hcatalog/src/test/e2e/harness'
External at revision 1612038.

At revision 1612038.
+ patchCommandPath=/data/hive-ptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hive-ptest/working/scratch/build.patch
+ [[ -f /data/hive-ptest/working/scratch/build.patch ]]
+ chmod +x /data/hive-ptest/working/scratch/smart-apply-patch.sh
+ /data/hive-ptest/working/scratch/smart-apply-patch.sh /data/hive-ptest/working/scratch/build.patch
The patch does not appear to apply with p0, p1, or p2
+ exit 1
'
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12554436, [~caofangkun] Thanks for your interest. I'm doing this in HIVE-4064, including alter partitions, table privileges, msck, dest/show columns/properties, etc. ]