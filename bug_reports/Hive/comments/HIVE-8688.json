[In Utilities, MapRedTask, MapredLocalTask:
- add null check for out, in the finally clauses. Or does IOStream.closeStream() already check if the stream is null or not?

, IOUtils.closeStream checks for null (in both 1.x and 2.x branches).
, Ok, +1 if tests pass., I found this issue while trying to find the cause of the failure. I am not sure if this fixes the following issue, because its hard to reproduce.

{code}
Error: java.lang.RuntimeException: org.apache.hive.com.esotericsoftware.kryo.KryoException: Buffer underflow.
	at org.apache.hadoop.hive.ql.exec.Utilities.getBaseWork(Utilities.java:422)
	at org.apache.hadoop.hive.ql.exec.Utilities.getMapWork(Utilities.java:285)
	at org.apache.hadoop.hive.ql.io.HiveInputFormat.init(HiveInputFormat.java:263)
	at org.apache.hadoop.hive.ql.io.HiveInputFormat.pushProjectionsAndFilters(HiveInputFormat.java:475)
	at org.apache.hadoop.hive.ql.io.HiveInputFormat.pushProjectionsAndFilters(HiveInputFormat.java:468)
	at org.apache.hadoop.hive.ql.io.CombineHiveInputFormat.getRecordReader(CombineHiveInputFormat.java:648)
	at org.apache.hadoop.mapred.MapTask$TrackedRecordReader.<init>(MapTask.java:169)
	at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:429)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:343)
	at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:163)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:415)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1614)
	at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)
Caused by: org.apache.hive.com.esotericsoftware.kryo.KryoException: Buffer underflow.
	at org.apache.hive.com.esotericsoftware.kryo.io.Input.require(Input.java:181)
	at org.apache.hive.com.esotericsoftware.kryo.io.Input.readVarInt(Input.java:355)
	at org.apache.hive.com.esotericsoftware.kryo.Kryo.readReferenceOrNull(Kryo.java:809)
	at org.apache.hive.com.esotericsoftware.kryo.Kryo.readObject(Kryo.java:670)
	at org.apache.hadoop.hive.ql.exec.Utilities.deserializeObjectByKryo(Utilities.java:1023)
	at org.apache.hadoop.hive.ql.exec.Utilities.deserializePlan(Utilities.java:931)
	at org.apache.hadoop.hive.ql.exec.Utilities.deserializePlan(Utilities.java:945)
	at org.apache.hadoop.hive.ql.exec.Utilities.getBaseWork(Utilities.java:389)
	... 13 more
{code}, [~hagleitn] This is a simple bug fix. It might help avoid issues like above stack trace. I think its useful for 0.14

, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12678590/HIVE-8688.1.patch

{color:red}ERROR:{color} -1 due to 2 failed/errored test(s), 6609 tests executed
*Failed tests:*
{noformat}
org.apache.hive.hcatalog.streaming.TestStreaming.testEndpointConnection
org.apache.hive.minikdc.TestJdbcWithMiniKdc.testNegativeTokenAuth
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1593/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1593/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1593/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12678590 - PreCommit-HIVE-TRUNK-Build, +1 for hive.14, Patch committed to trunk and 0.14 branch.
Thanks for the review Jason and Gunther!
, This has been fixed in 0.14 release. Please open new jira if you see any issues.
]