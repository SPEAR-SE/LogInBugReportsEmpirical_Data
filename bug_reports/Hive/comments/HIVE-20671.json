[I think it is better to move LockComponentBuilder to metastore-common, I tried this and it now compiles fine. Let me know if you need my patch., I agree it's a better solution [~akolb], feel free to assign the ticket to yourself., Transfered to me., Do we need the {{hive-standalone-metastore-server}} test dependency in the hive-streaming pom?, Looks like it isn't needed and we can remove it. Since this is a test-only dependency it doesn't matter so much if it is there or not., I still get a similar error with your patch [~akolb], I tried running 

 
{code:java}
mvn -DskipTests -Pitests clean test-compile 
{code}

and it works for me. Are you seeing the same error?, The 03 patch also removes test dependency on metastore-server from hive-streaming., [~akolb], could you reproduce this on master?, | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
|| || || || {color:brown} master Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 45s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  7m 44s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  1m 14s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 25s{color} | {color:green} master passed {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  2m 32s{color} | {color:blue} standalone-metastore/metastore-common in master has 28 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  1m  9s{color} | {color:blue} standalone-metastore/metastore-server in master has 182 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 25s{color} | {color:blue} streaming in master has 2 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m 26s{color} | {color:green} master passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 10s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  1m 21s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  1m 14s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  1m 14s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 26s{color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} whitespace {color} | {color:red}  0m  0s{color} | {color:red} The patch has 1 line(s) that end in whitespace. Use git apply --whitespace=fix <<patch_file>>. Refer https://git-scm.com/docs/git-apply {color} |
| {color:green}+1{color} | {color:green} xml {color} | {color:green}  0m  1s{color} | {color:green} The patch has no ill-formed XML file. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  4m 25s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m 22s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 14s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 25m 47s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  xml  |
| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u1 (2016-09-03) x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /data/hiveptest/working/yetus_PreCommit-HIVE-Build-14196/dev-support/hive-personality.sh |
| git revision | master / a06a370 |
| Default Java | 1.8.0_111 |
| findbugs | v3.0.0 |
| whitespace | http://104.198.109.242/logs//PreCommit-HIVE-Build-14196/yetus/whitespace-eol.txt |
| modules | C: standalone-metastore/metastore-common standalone-metastore/metastore-server streaming U: . |
| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-14196/yetus.txt |
| Powered by | Apache Yetus    http://yetus.apache.org |


This message was automatically generated.

, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12942205/HIVE-20671.03.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 42 failed/errored test(s), 15010 tests executed
*Failed tests:*
{noformat}
org.apache.hive.streaming.TestStreaming.testAddPartition (batchId=323)
org.apache.hive.streaming.TestStreaming.testAllTypesDelimitedWriter (batchId=323)
org.apache.hive.streaming.TestStreaming.testAllTypesDelimitedWriterInputStream (batchId=323)
org.apache.hive.streaming.TestStreaming.testAutoRollTransactionBatch (batchId=323)
org.apache.hive.streaming.TestStreaming.testBucketing (batchId=323)
org.apache.hive.streaming.TestStreaming.testBucketingWhereBucketColIsNotFirstCol (batchId=323)
org.apache.hive.streaming.TestStreaming.testConcurrentTransactionBatchCommits (batchId=323)
org.apache.hive.streaming.TestStreaming.testEndpointConnection (batchId=323)
org.apache.hive.streaming.TestStreaming.testErrorHandling (batchId=323)
org.apache.hive.streaming.TestStreaming.testFileDump (batchId=323)
org.apache.hive.streaming.TestStreaming.testFileDumpCorruptDataFiles (batchId=323)
org.apache.hive.streaming.TestStreaming.testFileDumpCorruptSideFiles (batchId=323)
org.apache.hive.streaming.TestStreaming.testFileDumpDeltaFilesWithStreamingOptimizations (batchId=323)
org.apache.hive.streaming.TestStreaming.testFileDumpDeltaFilesWithoutStreamingOptimizations (batchId=323)
org.apache.hive.streaming.TestStreaming.testHeartbeat (batchId=323)
org.apache.hive.streaming.TestStreaming.testInterleavedTransactionBatchCommits (batchId=323)
org.apache.hive.streaming.TestStreaming.testJsonInputStream (batchId=323)
org.apache.hive.streaming.TestStreaming.testMultipleTransactionBatchCommits (batchId=323)
org.apache.hive.streaming.TestStreaming.testNoBuckets (batchId=323)
org.apache.hive.streaming.TestStreaming.testRegexInputStream (batchId=323)
org.apache.hive.streaming.TestStreaming.testRemainingTransactions (batchId=323)
org.apache.hive.streaming.TestStreaming.testStreamBucketingMatchesRegularBucketing (batchId=323)
org.apache.hive.streaming.TestStreaming.testTableValidation (batchId=323)
org.apache.hive.streaming.TestStreaming.testTimeOutReaper (batchId=323)
org.apache.hive.streaming.TestStreaming.testTransactionBatchAbort (batchId=323)
org.apache.hive.streaming.TestStreaming.testTransactionBatchAbortAndCommit (batchId=323)
org.apache.hive.streaming.TestStreaming.testTransactionBatchCommitDelimited (batchId=323)
org.apache.hive.streaming.TestStreaming.testTransactionBatchCommitJson (batchId=323)
org.apache.hive.streaming.TestStreaming.testTransactionBatchCommitRegex (batchId=323)
org.apache.hive.streaming.TestStreaming.testTransactionBatchEmptyAbort (batchId=323)
org.apache.hive.streaming.TestStreaming.testTransactionBatchEmptyCommit (batchId=323)
org.apache.hive.streaming.TestStreamingDynamicPartitioning.testDPStreamBucketingMatchesRegularBucketing (batchId=323)
org.apache.hive.streaming.TestStreamingDynamicPartitioning.testDPTwoLevel (batchId=323)
org.apache.hive.streaming.TestStreamingDynamicPartitioning.testDPTwoLevelMissingPartitionValues (batchId=323)
org.apache.hive.streaming.TestStreamingDynamicPartitioning.testDPTwoLevelNonStringPartitionColumns (batchId=323)
org.apache.hive.streaming.TestStreamingDynamicPartitioning.testDynamicPartitioning (batchId=323)
org.apache.hive.streaming.TestStreamingDynamicPartitioning.testJsonInputStreamDP (batchId=323)
org.apache.hive.streaming.TestStreamingDynamicPartitioning.testRegexInputStreamDP (batchId=323)
org.apache.hive.streaming.TestStreamingDynamicPartitioning.testTableValidation (batchId=323)
org.apache.hive.streaming.TestStreamingDynamicPartitioning.testWriteAfterAbort (batchId=323)
org.apache.hive.streaming.TestStreamingDynamicPartitioning.testWriteAfterClose (batchId=323)
org.apache.hive.streaming.TestStreamingDynamicPartitioning.testWriteBeforeBegin (batchId=323)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/14196/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/14196/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-14196/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.YetusPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 42 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12942205 - PreCommit-HIVE-Build, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12942205/HIVE-20671.03.patch

{color:red}ERROR:{color} -1 due to build exiting with an error

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/14197/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/14197/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-14197/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Tests exited with: Exception: Patch URL https://issues.apache.org/jira/secure/attachment/12942205/HIVE-20671.03.patch was found in seen patch url's cache and a test was probably run already on it. Aborting...
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12942205 - PreCommit-HIVE-Build, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12942205/HIVE-20671.03.patch

{color:red}ERROR:{color} -1 due to build exiting with an error

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/14200/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/14200/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-14200/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Tests exited with: Exception: Patch URL https://issues.apache.org/jira/secure/attachment/12942205/HIVE-20671.03.patch was found in seen patch url's cache and a test was probably run already on it. Aborting...
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12942205 - PreCommit-HIVE-Build, [~jmarhuen] I was able to reproduce the original problem and don't see it with the patch., Interesting - looks like now the streaming tests compile and run but are broken!, [~akolb] they seem to be running fine in master so it must be something specific of this patch., Looks like it was caused by pom.xml changes - I am reverting them. Tests now run fine for me locally., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
|| || || || {color:brown} master Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 29s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  8m 23s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 55s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 15s{color} | {color:green} master passed {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  2m 28s{color} | {color:blue} standalone-metastore/metastore-common in master has 28 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  1m  8s{color} | {color:blue} standalone-metastore/metastore-server in master has 183 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m 10s{color} | {color:green} master passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m  6s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 58s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 52s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  0m 52s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 14s{color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} whitespace {color} | {color:red}  0m  0s{color} | {color:red} The patch has 1 line(s) that end in whitespace. Use git apply --whitespace=fix <<patch_file>>. Refer https://git-scm.com/docs/git-apply {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  3m 56s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m 11s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 13s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 23m  4s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  |
| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u1 (2016-09-03) x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /data/hiveptest/working/yetus_PreCommit-HIVE-Build-14253/dev-support/hive-personality.sh |
| git revision | master / f0434c5 |
| Default Java | 1.8.0_111 |
| findbugs | v3.0.0 |
| whitespace | http://104.198.109.242/logs//PreCommit-HIVE-Build-14253/yetus/whitespace-eol.txt |
| modules | C: standalone-metastore/metastore-common standalone-metastore/metastore-server U: standalone-metastore |
| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-14253/yetus.txt |
| Powered by | Apache Yetus    http://yetus.apache.org |


This message was automatically generated.

, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12942477/HIVE-20671.04.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:green}SUCCESS:{color} +1 due to 15025 tests passed

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/14253/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/14253/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-14253/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.YetusPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12942477 - PreCommit-HIVE-Build, [~vihangk1] Can you review and commit the change? It is a single file moved from metastore-server to metastore-common., LGTM +1, I was testing this patch before merging it in and I saw that it fails with the below error when you run {{mvn -DskipTests -Pitests clean test-compile -DskipTests=true}} as described in the JIRA

{noformat}
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 03:16 min
[INFO] Finished at: 2018-10-05T13:15:54-07:00
[INFO] Final Memory: 380M/1676M
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.6.1:compile (default-compile) on project hive-streaming: Compilation failure
[ERROR] hive/streaming/src/java/org/apache/hive/streaming/HiveStreamingConnection.java:[45,40] cannot find symbol
[ERROR] symbol:   class LockRequestBuilder
[ERROR] location: package org.apache.hadoop.hive.metastore
[ERROR] -> [Help 1]
[ERROR]
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR]
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException
[ERROR]
[ERROR] After correcting the problems, you can resume the build with the command
[ERROR]   mvn <goals> -rf :hive-streaming
{noformat}, LockRequestBuilder should be moved as well., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
|| || || || {color:brown} master Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 28s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  7m 58s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 57s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 14s{color} | {color:green} master passed {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  2m 26s{color} | {color:blue} standalone-metastore/metastore-common in master has 28 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  1m  6s{color} | {color:blue} standalone-metastore/metastore-server in master has 183 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m 11s{color} | {color:green} master passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m  7s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  1m  1s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 57s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  0m 57s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 14s{color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} whitespace {color} | {color:red}  0m  0s{color} | {color:red} The patch has 2 line(s) that end in whitespace. Use git apply --whitespace=fix <<patch_file>>. Refer https://git-scm.com/docs/git-apply {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  3m 58s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 52s{color} | {color:green} standalone-metastore_metastore-common generated 0 new + 17 unchanged - 2 fixed = 17 total (was 19) {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 19s{color} | {color:green} metastore-server in the patch passed. {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:red}-1{color} | {color:red} asflicense {color} | {color:red}  0m 14s{color} | {color:red} The patch generated 1 ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 22m 42s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  |
| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u1 (2016-09-03) x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /data/hiveptest/working/yetus_PreCommit-HIVE-Build-14276/dev-support/hive-personality.sh |
| git revision | master / f122e25 |
| Default Java | 1.8.0_111 |
| findbugs | v3.0.0 |
| whitespace | http://104.198.109.242/logs//PreCommit-HIVE-Build-14276/yetus/whitespace-eol.txt |
| asflicense | http://104.198.109.242/logs//PreCommit-HIVE-Build-14276/yetus/patch-asflicense-problems.txt |
| modules | C: standalone-metastore/metastore-common standalone-metastore/metastore-server U: standalone-metastore |
| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-14276/yetus.txt |
| Powered by | Apache Yetus    http://yetus.apache.org |


This message was automatically generated.

, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12942631/HIVE-20671.05.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:green}SUCCESS:{color} +1 due to 15027 tests passed

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/14276/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/14276/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-14276/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.YetusPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12942631 - PreCommit-HIVE-Build, [~vihangk1] patch 5 should compile tests cleanly., Patch merged into master. Thanks for the fix [~akolb]]