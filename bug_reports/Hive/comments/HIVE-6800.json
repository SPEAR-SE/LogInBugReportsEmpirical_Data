[cc [~thejas] [~prasadm]

[~rhbutani] Bug for 13!

Thanks!, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12637963/HIVE-6800.1.patch

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 5513 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_infer_bucket_sort_dyn_part
{noformat}

Test results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2059/testReport
Console output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2059/console

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12637963, [~vaibhavgumashta] Thanks for fixing the issue. Looks fine to me.
+1
, [~prasadm] Thanks for taking a look. The failure looks unrelated., There is a thread safety issue here,  ProxyUsers uses HashMap internally, and refreshSuperUserGroupsConfiguration updates the hashmaps. If it gets updated from two places, it could result in issues like getting stuck in an infinite loop.
Also, when one thread is calling ProxyUsers.authorize, another thread might clear the hashmap entries as it enters ProxyUsers.refreshSuperUserGroupsConfiguration.
refreshSuperUserGroupsConfiguration also looks like an expensive operation. I think we would be better to do it just once from HadoopShimsSecure .
, Sorry, I take that back, refreshSuperUserGroupsConfiguration and authorize are actually synchronized methods. 
Patch looks good to me.

I think we should look at doing the refreshSuperUserGroupsConfiguration only once, but that can be part of a follow up jira.
, Patch committed to trunk and 0.13 branch.
Thanks for the contribution Vaibhav, and thanks for the review Prasad!
, Created HIVE-6851 for the optimization suggested above.
]