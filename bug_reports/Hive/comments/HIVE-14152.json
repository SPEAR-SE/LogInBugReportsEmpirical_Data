[We already have safety checks in the form of hive.metastore.schema.verification, which are more advanced as it checks for schema *compatibility* instead of *exact match* .
This makes sense in case of upgrade-downgrade scenarios of hive, as newer versions of schema are compatible with older ones, and schema doesn't need to be downgraded on a downgrade of hive version.
This also allows for running of two versions of hive against same instance of metastore rdbms.
 , In the patch, I also set "hive.metastore.schema.verification.record.version" to false since we don't want to rewrite the db schema version with the binary version., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12816138/HIVE-14152.1.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 29 failed/errored test(s), 9958 tests executed
*Failed tests:*
{noformat}
TestCliDriver-bool_literal.q-authorization_cli_createtab.q-explain_ddl.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-cbo_rp_join1.q-union_top_level.q-insert_update_delete.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-create_func1.q-bucketmapjoin3.q-enforce_order.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-describe_xpath.q-autogen_colalias.q-udf_named_struct.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-encryption_join_with_different_encryption_keys.q-bucketcontext_3.q-udf_smallint.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-groupby4.q-convert_enum_to_string.q-mapjoin_filter_on_outerjoin.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-index_compact.q-merge_dynamic_partition2.q-cbo_rp_subq_exists.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-nullscript.q-vector_char_mapjoin1.q-load_dyn_part3.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-parquet_ppd_decimal.q-cluster.q-groupby_sort_6.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-ptf_general_queries.q-unionDistinct_1.q-udf_version.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-sample_islocalmode_hook_use_metadata.q-cbo_rp_semijoin.q-udf_when.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-schema_evol_text_vec_mapwork_part_all_complex.q-metadataonly1.q-deleteAnalyze.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-skewjoinopt3.q-rcfile_merge1.q-multigroupby_singlemr.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-stats13.q-join_parse.q-sort_merge_join_desc_2.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-stats_publisher_error_1.q-auto_join1.q-cast_to_int.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-tez_joins_explain.q-rename_column.q-varchar_serde.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-udf_double.q-join11.q-join18.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-udf_locate.q-join32_lessSize.q-correlationoptimizer8.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-udf_to_float.q-decimal_precision2.q-ppd_gby_join.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-unicode_notation.q-gen_udf_example_add10.q-ppd_join4.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-vector_complex_join.q-interval_udf.q-udf_classloader_dynamic_dependency_resolution.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-vector_distinct_2.q-cte_mat_1.q-update_after_multiple_inserts_special_characters.q-and-12-more - did not produce a TEST-*.xml file
TestCliDriver-vector_partition_diff_num_cols.q-stats2.q-union11.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_all
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_join
org.apache.hadoop.hive.metastore.TestMetastoreVersion.testMetastoreVersion
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/368/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/368/console
Test logs: http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-368/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 29 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12816138 - PreCommit-HIVE-MASTER-Build, 2.patch - setting the autostartmechanism in ObjectStore to prevent cases where old config has set it to incorrect value.
, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12817053/HIVE-14152.2.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 11 failed/errored test(s), 10282 tests executed
*Failed tests:*
{noformat}
TestMiniTezCliDriver-auto_sortmerge_join_7.q-cbo_windowing.q-vector_interval_2.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_all
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_join
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestMinimrCliDriver.org.apache.hadoop.hive.cli.TestMinimrCliDriver
org.apache.hadoop.hive.llap.tezplugins.TestLlapTaskSchedulerService.testDelayedLocalityNodeCommErrorImmediateAllocation
org.apache.hadoop.hive.metastore.TestMetastoreVersion.testMetastoreVersion
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/461/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/461/console
Test logs: http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-461/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 11 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12817053 - PreCommit-HIVE-MASTER-Build, 3.patch  - fix test case, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12817080/HIVE-14152.3.patch

{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 7 failed/errored test(s), 10304 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_all
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_join
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestMinimrCliDriver.org.apache.hadoop.hive.cli.TestMinimrCliDriver
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/465/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/465/console
Test logs: http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-465/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12817080 - PreCommit-HIVE-MASTER-Build, [~sushanth] Can you please review this change ?
, The test failures are unrelated, they happen in runs with other jiras as well.

, +1., addendum.patch- patch for missing commit for tez/hive-site.xml
Commiting it to master, branch-2.1
, Doc note:  This changes the description of *datanucleus.schema.autoCreateAll*, changes the default value and description of *hive.metastore.schema.verification*, changes the default value of *hive.metastore.schema.verification.record.version*, and removes *datanucleus.autoStartMechanismMode*.  The changes need to be documented in the wiki for releases 2.1.1 and 2.2.0.

Here are the doc links:

* [Configuration Properties -- datanucleus.schema.autoCreateAll | https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-datanucleus.schema.autoCreateAll]
* [Configuration Properties -- hive.metastore.schema.verification | https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.metastore.schema.verification]
* [Configuration Properties -- hive.metastore.schema.verification.record.version | https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.metastore.schema.verification.record.version]  (_not documented yet for HIVE-9749 but when it is, this link will work_)
* [Configuration Properties -- datanucleus.autoStartMechanismMode | https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-datanucleus.autoStartMechanismMode]

Added TODOC2.1.1 and TODOC2.2 labels.

Typo alert:  The new description of *hive.metastore.schema.verification* omits the word "metastore" --

bq.  Verify that version information stored in is compatible with one from Hive jars.

The original was --

bq.  Verify that version information stored in metastore matches with one from Hive jars., This patch uses the wrong configuration string. See HIVE-17872 for more information., I was wrong and the {{datanucleus.autoStartMechanismMode}} is correct one.]