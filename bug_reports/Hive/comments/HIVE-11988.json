[Patch attached., [~thejas], could you please have a look?, +1
Thats a neat extension to the SQLStdHiveAuthorizationValidatorForTest class!
I also learned about some new guava library tricks! :)
, I suspect few additional import .q tests might need update for their q.out files as this adds the db writeentity.
, Oh! True. I remember thinking that I needed to update that, but somehow thought it was part of my previous plan for how I wanted to have a separate *ForTest class. I'll update it., Updated patch with the remainder of the .q.out files., One more patch update, I realized that we accidentally increased the scope of permissions required on the db for the old non-sqlstdauth cases, restoring that behaviour., Update also looks good.
, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12769087/HIVE-11988.3.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 7 failed/errored test(s), 9712 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_authorization_reset
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_import_exported_table
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_import_exported_table
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.hwi.TestHWISessionManager.testHiveDriver
org.apache.hadoop.hive.ql.io.orc.TestJsonFileDump.testJsonDump
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5818/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5818/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5818/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12769087 - PreCommit-HIVE-TRUNK-Build, Ugh, looks like I missed updating 3 tests:

 * TestMinimrCliDriver.testCliDriver_import_exported_table
 * TestMiniSparkOnYarnCliDriver.testCliDriver_import_exported_table
 * TestCliDriver.testCliDriver_authorization_reset

And a fourth test, which I thought I had updated is failing, but not for the extra PREHOOK/POSTHOOK : 
 * TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import

I'll look into these and post an update tonight., Updated patch to cover the previous failures., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12769416/HIVE-11988.4.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 4 failed/errored test(s), 9733 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestHBaseCliDriver.testCliDriver_hbase_queries
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.hwi.TestHWISessionManager.testHiveDriver
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5846/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5846/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5846/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12769416 - PreCommit-HIVE-TRUNK-Build, Is there still an issue with authorization_uri_import  test?
, Looks like I applied my patch twice to the authorization_uri_import.q.out file. New patch uploaded.

Thejas, does your +1 still hold for this update? i.e. since it is only a single minor .q.out update, can we commit without rerunning the entire gamut of tests again?

I'm uploading my singular test run output for authorization_uri_import.q and the hive.log file associated

, As this is just a single .q.out file update and you have verified it locally, I think it is good to go. Not worth running full test suite for that.
, Committed to master., Committed to branch-1 and branch-1.2 as well. Thanks, Thejas!, While testing [the Ranger patch|https://reviews.apache.org/r/41067/] I submitted to mimic these changes (RANGER-772), I see that the {{checkPrivilages}} call for IMPORT when import would create a table does not include the table name in it.  [~madhan.neethiraj], one of the reviewers of that patch observed that this could lead to following two potential usability issues:
# In Ranger a user's access privileges can be specified using wildcards. Say, a user in finance department has been given create privileges at the database level for any table that starts with fin, i.e. {{fin*}}. If such a user attempts to import a table named, say, {{fintemp}} then that operation would fail since we currently require database level privilege.
# Ranger audits various user actions. Since table name isn't specified we can't record which table was got created. In some cases this could be inferred from the command string passed that is into the {{checkPrivilages}} (which we store off in our audit). However, when {{IMPORT}} does not specify the table name then in that case that information may not be readily available to user., [~aloklal99], that's a good point. I will create a new bug to track this issue. It does look like on a plain CREATE-TABLE, the new table being created also is created as a WriteEntity. I will create a new bug to do so.]