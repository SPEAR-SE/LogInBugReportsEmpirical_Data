[
-----------------------------------------------------------
This is an automatically generated e-mail. To reply, visit:
https://reviews.apache.org/r/1731/
-----------------------------------------------------------

Review request for hive, Scott Chen and Ning Zhang.


Summary
-------

Added the -archives flag to the command run when a map reduce task is run locally.  It runs essentially exactly as it does for the -files flag.


This addresses bug HIVE-2428.
    https://issues.apache.org/jira/browse/HIVE-2428


Diffs
-----

  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MapRedTask.java 1164711 

Diff: https://reviews.apache.org/r/1731/diff


Testing
-------

I run the unit test queries to verify nothing was broken.

I also ran the query specified in the issues description and verified that information was returned for both files and archives in both local and non-local mode.


Thanks,

Kevin

, kevinwilfong requested code review of "HIVE-2428 [jira] ADD ARCHIVE has no effect when query runs in local mode".
Reviewers: JIRA

  https://issues.apache.org/jira/browse/HIVE-2428

  Added the -archives flag to the command run when a map reduce task is run locally. It runs essentially exactly as it does for the -files flag.  This fixes the issue, I have added a test to verify that.

  When you ADD ARCHIVE a file and the query runs in local mode, the file is not available at all.

  For example running the commands

  echo '#!/bin/bash\nls -l 1>&2;read' > foo.sh

  hive -e 'ADD FILE foo.sh; ADD ARCHIVE /tmp/mapreduce_test.zip; SELECT TRANSFORM USING "sh foo.sh" FROM src'

  when the query is allowed to run in local mode, only information for foo.sh is returned.

  However, if the query is not allowed to run in local mode, information for both foo.sh and mapreduce_test.zip is returned.

TEST PLAN
  EMPTY

REVISION DETAIL
  https://reviews.facebook.net/D2121

AFFECTED FILES
  data/files/add_archive_local.zip
  data/scripts/add_archive_local_script
  ql/src/test/results/clientpositive/add_archive_local.q.out
  ql/src/test/queries/clientpositive/add_archive_local.q
  ql/src/java/org/apache/hadoop/hive/ql/exec/MapRedTask.java

MANAGE HERALD DIFFERENTIAL RULES
  https://reviews.facebook.net/herald/view/differential/

WHY DID I GET THIS EMAIL?
  https://reviews.facebook.net/herald/transcript/4599/

Tip: use the X-Herald-Rules header to filter Herald messages in your client.
, kevinwilfong has commented on the revision "HIVE-2428 [jira] ADD ARCHIVE has no effect when query runs in local mode".

  Attached the zip file used by the test to the JIRA.

  Before this fix was committed, add_archive_local.zip would not appear in the output when the test q file is run.

REVISION DETAIL
  https://reviews.facebook.net/D2121
, kevinwilfong updated the revision "HIVE-2428 [jira] ADD ARCHIVE has no effect when query runs in local mode".
Reviewers: JIRA, njain, ashutoshc

  Modified add_archive_local_script to make it deterministic.

REVISION DETAIL
  https://reviews.facebook.net/D2121

AFFECTED FILES
  data/files/add_archive_local.zip
  data/scripts/add_archive_local_script
  ql/src/test/results/clientpositive/add_archive_local.q.out
  ql/src/test/queries/clientpositive/add_archive_local.q
  ql/src/java/org/apache/hadoop/hive/ql/exec/MapRedTask.java

To: JIRA, njain, ashutoshc, kevinwilfong
, +1 will commit if tests pass, Can you please rebase? Tx]