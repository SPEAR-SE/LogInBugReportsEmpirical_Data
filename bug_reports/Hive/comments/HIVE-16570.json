[[~gopalv] this restores the ctx to be stored not in the key (I just took the patch from the original JIRA and merged with what is in master to preserve other differences like the local variable, feel free to put it in e.g. the batch if that seems better.
Also got rid of arraycopy., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12866076/HIVE-16570.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 10638 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestAccumuloCliDriver.testCliDriver[accumulo_index] (batchId=225)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=143)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_join30] (batchId=148)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/5012/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/5012/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-5012/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12866076 - PreCommit-HIVE-Build, Waiting for more accurate profiles from earlier patch - so far the "could be faster" has not be identified as being related to this patch., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12866076/HIVE-16570.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 2 failed/errored test(s), 10638 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestAccumuloCliDriver.testCliDriver[accumulo_index] (batchId=225)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=143)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/5014/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/5014/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-5014/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12866076 - PreCommit-HIVE-Build]