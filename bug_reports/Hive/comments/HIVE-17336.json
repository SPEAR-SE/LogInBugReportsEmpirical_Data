[patch-1: Hive on spark is incorrectly adding jar from conf (tmpjar is empty) rather than the copied jobConf. With this change, HoS is able to add required hbase jars., [~xuefuz] Can you take a look the simple change? Also, I'm wondering why we are making a copy of the JobConf here. Seems we can directly work on original conf object.

{noformat}
    JobConf jobConf = new JobConf(conf);
    jobConf.set(MR_JAR_PROPERTY, "");
    for (BaseWork work : sparkWork.getAllWork()) {
      work.configureJobConf(jobConf);
    }
    addJars(jobConf.get(MR_JAR_PROPERTY)); 
{noformat}, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12882177/HIVE-17336.1.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 7 failed/errored test(s), 10977 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_dynamic_partition_pruning] (batchId=169)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_dynamic_partition_pruning_mapjoin_only] (batchId=170)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=235)
org.apache.hive.hcatalog.api.TestHCatClient.testPartitionRegistrationWithCustomSchema (batchId=180)
org.apache.hive.hcatalog.api.TestHCatClient.testPartitionSpecRegistrationWithCustomSchema (batchId=180)
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation (batchId=180)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/6427/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/6427/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6427/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12882177 - PreCommit-HIVE-Build, LGTM +1 thanks for the change [~aihuaxu], Committed to master. Thanks Vihang for reviewing., Sorry for getting to this late. Thanks for fixing this, [~aihuaxu]. I think making a copy of jobconf is a conscious decision, though I forgot the reason. maybe you can find out from the change history., Hive 3.0.0 has been released so closing this jira.]