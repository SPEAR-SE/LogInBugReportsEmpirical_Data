[[~ashutoshc], can you take a look? This is an issue that is happening when grouping function is used with plain group by (a case that is trivial but apparently valid, and that was not covered in the original implementation). Thanks, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12853714/HIVE-15994.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 60 failed/errored test(s), 10251 tests executed
*Failed tests:*
{noformat}
TestDerbyConnector - did not produce a TEST-*.xml file (likely timed out) (batchId=235)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cbo_rp_auto_join1] (batchId=3)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[create_view] (batchId=37)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[infer_bucket_sort] (batchId=75)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[join31] (batchId=81)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[join_filters_overlap] (batchId=32)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[lateral_view_cp] (batchId=79)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[lateral_view_explode2] (batchId=77)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[lateral_view_noalias] (batchId=34)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[lateral_view_onview] (batchId=53)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[lateral_view_outer] (batchId=39)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[lateral_view_ppd] (batchId=80)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[limit_pushdown_negative] (batchId=37)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[load_dyn_part15] (batchId=37)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[nested_column_pruning] (batchId=31)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[nonmr_fetch] (batchId=19)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ppd_field_garbage] (batchId=64)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[skewjoin_mapjoin6] (batchId=55)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[skewjoinopt10] (batchId=19)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udf_explode] (batchId=40)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udf_inline] (batchId=53)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udf_sort_array_by] (batchId=58)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udtf_explode] (batchId=47)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udtf_json_tuple] (batchId=72)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udtf_parse_url_tuple] (batchId=67)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udtf_posexplode] (batchId=64)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udtf_stack] (batchId=35)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union26] (batchId=61)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_lateralview] (batchId=23)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[unionall_unbalancedppd] (batchId=2)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vectorized_distinct_gby] (batchId=68)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[windowing_navfn] (batchId=62)
org.apache.hadoop.hive.cli.TestContribCliDriver.testCliDriver[lateral_view_explode2] (batchId=222)
org.apache.hadoop.hive.cli.TestContribCliDriver.testCliDriver[udtf_output_on_close] (batchId=222)
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_join_with_different_encryption_keys] (batchId=159)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[unionDistinct_1] (batchId=136)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[cbo_rp_windowing_2] (batchId=143)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[lateral_view] (batchId=153)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[lineage2] (batchId=149)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[lvj_mapjoin] (batchId=142)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[multiMapJoin2] (batchId=152)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[multi_insert_lateral_view] (batchId=148)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vectorized_distinct_gby] (batchId=152)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[windowing] (batchId=149)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_3] (batchId=93)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainuser_3] (batchId=93)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[lateral_view_alias] (batchId=86)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[udf_assert_true2] (batchId=86)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[udf_assert_true] (batchId=86)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=223)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[join31] (batchId=133)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[join_filters_overlap] (batchId=110)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[lateral_view_explode2] (batchId=131)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[load_dyn_part15] (batchId=112)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[multi_insert_lateral_view] (batchId=117)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[skewjoinopt10] (batchId=104)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[union26] (batchId=123)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[union_lateralview] (batchId=106)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[windowing] (batchId=117)
org.apache.hive.service.server.TestHS2HttpServer.testContextRootUrlRewrite (batchId=186)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/3668/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/3668/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-3668/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 60 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12853714 - PreCommit-HIVE-Build, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12853750/HIVE-15994.01.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 7 failed/errored test(s), 10251 tests executed
*Failed tests:*
{noformat}
TestDerbyConnector - did not produce a TEST-*.xml file (likely timed out) (batchId=235)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cbo_rp_auto_join1] (batchId=3)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[join31] (batchId=81)
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_join_with_different_encryption_keys] (batchId=159)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[multiMapJoin2] (batchId=152)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=223)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[join31] (batchId=133)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/3669/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/3669/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-3669/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12853750 - PreCommit-HIVE-Build, [~ashutoshc], I have uploaded a new patch addressing your comment. Thanks!, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12854657/HIVE-15994.02.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 10259 tests executed
*Failed tests:*
{noformat}
TestDerbyConnector - did not produce a TEST-*.xml file (likely timed out) (batchId=235)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=223)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=223)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/3786/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/3786/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-3786/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12854657 - PreCommit-HIVE-Build, +1, Pushed to master, thanks for reviewing [~ashutoshc]!]