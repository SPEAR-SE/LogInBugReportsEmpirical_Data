[Initial patch to compute benefit based on the selectivity of the semijoin attribute's ndv vs the combined cardinality of the join key attributes from both sides of the join, and the table size of the table being filtered., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12856982/HIVE-16154.1.patch

{color:green}SUCCESS:{color} +1 due to 4 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 8 failed/errored test(s), 10335 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join_without_localtask] (batchId=96)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_sortmerge_join_3] (batchId=96)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[date_join1] (batchId=96)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[groupby6_noskew] (batchId=96)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[mapjoin_test_outer] (batchId=96)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[merge2] (batchId=96)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[smb_mapjoin_11] (batchId=96)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[vectorization_9] (batchId=96)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/4050/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/4050/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-4050/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 8 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12856982 - PreCommit-HIVE-Build, Few changes to the patch:
- Do cost/benefit check of semijoin optimizations first, and cycle detection last
- Change cost/benefit to be in terms of rows, per [~gopalv]'s suggestion
- Compute benefit in terms of the FilterOperator following the TableScan, rather than the TableScan
- Fix findColumnOrigin to work in the case of multiple parents, RB at https://reviews.apache.org/r/57829/, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12859872/HIVE-16154.2.patch

{color:green}SUCCESS:{color} +1 due to 4 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 4 failed/errored test(s), 10496 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[comments] (batchId=35)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=141)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_3] (batchId=94)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainuser_3] (batchId=94)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/4288/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/4288/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-4288/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12859872 - PreCommit-HIVE-Build, Needed to update golden file for the explain* tests in MiniTez, LGTM +1., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12860050/HIVE-16154.3.patch

{color:green}SUCCESS:{color} +1 due to 4 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 10509 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[comments] (batchId=35)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/4306/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/4306/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-4306/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12860050 - PreCommit-HIVE-Build, Rebasing patch after HIVE-16260, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12860115/HIVE-16154.4.patch

{color:green}SUCCESS:{color} +1 due to 4 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 10510 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[comments] (batchId=35)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/4315/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/4315/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-4315/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12860115 - PreCommit-HIVE-Build, Committed to master, Doc note:  This adds *hive.tez.dynamic.semijoin.reduction.threshold* to HiveConf.java, so it needs to be documented in the wiki.

* [Configuration Properties -- Tez | https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-Tez]

Added a TODOC2.2 label.]