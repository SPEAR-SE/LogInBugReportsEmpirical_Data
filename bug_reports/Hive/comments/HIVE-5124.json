[Would you please provide a repro case?, The sql is :
SELECT channeled,
       max(VV)AS vv,
       max(FUV) AS FUV,
       max(PV) AS PV,
       max(UV) AS UV
FROM
    (
SELECT  channeled,
            sum(CASE WHEN TYPE = 1 THEN a else cast( 0 as bigint) END) AS VV,
            sum(CASE WHEN TYPE = 1 THEN b else cast( 0 as bigint) END) AS FUV,
            sum(CASE WHEN TYPE = 2 THEN a else cast (0 as bigint) END) AS PV,
            sum(CASE WHEN TYPE = 2 THEN b else cast (0 as bigint) END) AS UV
     FROM
         (SELECT count(uid) AS a, count(DISTINCT uid) AS b, TYPE, channeled
          FROM
              (SELECT uid,
                     channeled,
                      TYPE
          FROM
              (SELECT uid,
                      parse_url(url,'QUERY','channeled') as channeled,
                      1 AS TYPE
               FROM t_html5_vv
               WHERE  p_day = ${idate}
               UNION ALL 
               SELECT uid,
                                 parse_url(url,'QUERY','channeled') as channeled,
                                2 AS TYPE
               FROM t_html5_pv
               WHERE  p_day = ${idate}
               )tmp
               where channeled is not null  and channeled <> ''
            ) tmp2
     GROUP BY channeled,TYPE
)tmp3
GROUP BY channeled)tmp4
GROUP BY channeled

I want to get uv and fuv from different table,t_html5_vv and t_html5_pv ,and combine the result in one row. The default  hive.map.aggr argument in hive-site.xml is setted to true,and the sql goes prefect.But  the exception is thrown when i set hive.map.aggr= false.]