[Clearly, somehow, your credentials aren't getting picked up. One problem here is that the S3A code can't log what's going on in any detail for security reasons (logging secrets is considered harmful), so not sure what could be done here., I faced with the same issue because of the mismatching of aws-java-sdk, joda-time and java version.In my case Hive used joda-time 2.5 but this version doesn't work with java8 and aws-java-sdk-1.7.15.  We should use at least the joda-time version 2.8.1., good point

Everyone: look at the S3A troubleshooting docs before filing bugreps, thanks: [http://hadoop.apache.org/docs/r2.8.0/hadoop-aws/tools/hadoop-aws/index.html#Troubleshooting_S3A], The solution is to update joda-time version from 2.5 to 2.9.9, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12876365/HIVE-16983-branch-2.1.patch

{color:red}ERROR:{color} -1 due to build exiting with an error

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/5927/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/5927/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-5927/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Tests exited with: NonZeroExitCodeException
Command 'bash /data/hiveptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ date '+%Y-%m-%d %T.%3N'
2017-07-10 06:21:54.491
+ [[ -n /usr/lib/jvm/java-8-openjdk-amd64 ]]
+ export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ export PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m '
+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m '
+ export 'MAVEN_OPTS=-Xmx1g '
+ MAVEN_OPTS='-Xmx1g '
+ cd /data/hiveptest/working/
+ tee /data/hiveptest/logs/PreCommit-HIVE-Build-5927/source-prep.txt
+ [[ false == \t\r\u\e ]]
+ mkdir -p maven ivy
+ [[ git = \s\v\n ]]
+ [[ git = \g\i\t ]]
+ [[ -z branch-2.1 ]]
+ [[ -d apache-github-branch-2.1-source ]]
+ [[ ! -d apache-github-branch-2.1-source/.git ]]
+ [[ ! -d apache-github-branch-2.1-source ]]
+ date '+%Y-%m-%d %T.%3N'
2017-07-10 06:21:54.494
+ cd apache-github-branch-2.1-source
+ git fetch origin
From https://github.com/apache/hive
   a27ccaa..5a62503  branch-2.1 -> origin/branch-2.1
   1a9ed41..07522ad  branch-1   -> origin/branch-1
   a3f718f..18ddf46  branch-1.2 -> origin/branch-1.2
   48f6e30..6a63742  branch-2   -> origin/branch-2
   b45e401..f24b76f  branch-2.0 -> origin/branch-2.0
   f31f749..61867c7  branch-2.2 -> origin/branch-2.2
 * [new branch]      branch-2.3 -> origin/branch-2.3
   ccea0d6..81853c1  hive-14535 -> origin/hive-14535
   5814c11..7f5460d  master     -> origin/master
 * [new branch]      storage-branch-2.3 -> origin/storage-branch-2.3
 * [new branch]      storage-branch-2.4 -> origin/storage-branch-2.4
 * [new tag]         storage-release-2.4.0rc0 -> storage-release-2.4.0rc0
 * [new tag]         rel/release-1.2.2 -> rel/release-1.2.2
 * [new tag]         rel/storage-release-2.3.0 -> rel/storage-release-2.3.0
 * [new tag]         rel/storage-release-2.3.1 -> rel/storage-release-2.3.1
 * [new tag]         release-2.3.0-rc0 -> release-2.3.0-rc0
 * [new tag]         storage-release-2.3.0rc0 -> storage-release-2.3.0rc0
+ git reset --hard HEAD
HEAD is now at a27ccaa HIVE-14084 HPLSQL multiple db connection does not switch back to Hive (Fei Hui via Alan Gates)
+ git clean -f -d
+ git checkout branch-2.1
Already on 'branch-2.1'
Your branch is behind 'origin/branch-2.1' by 2 commits, and can be fast-forwarded.
  (use "git pull" to update your local branch)
+ git reset --hard origin/branch-2.1
HEAD is now at 5a62503 HIVE-16683. Backport of ORC-125 to fix incorrect handling of future
+ git merge --ff-only origin/branch-2.1
Already up-to-date.
+ date '+%Y-%m-%d %T.%3N'
2017-07-10 06:22:05.047
+ patchCommandPath=/data/hiveptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hiveptest/working/scratch/build.patch
+ [[ -f /data/hiveptest/working/scratch/build.patch ]]
+ chmod +x /data/hiveptest/working/scratch/smart-apply-patch.sh
+ /data/hiveptest/working/scratch/smart-apply-patch.sh /data/hiveptest/working/scratch/build.patch
error: a/pom.xml: No such file or directory
The patch does not appear to apply with p0, p1, or p2
+ exit 1
'
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12876365 - PreCommit-HIVE-Build, Patch itself LGTM from an S3a perspective

one thing for Hive to consider is: adding some explicit tests against S3, run iff its set up with credentials. That's how I do all my s3 and azure integration tests, I've been working this case with Alex, and can tell you that the same permissions, credentials, etc. all work correctly and as expected with s3n:// and s3://. They do not work with s3a://, despite setting the properties in core-site.xml that in code and doc are expected. 

We went through the troubleshooting docs but they did not provide any insight or guidance to fix this problem. 

Vlad, you're on to something, we will test with joda 2.9.9, we have been using 2.8.1. 

, If we solve this, I propose we add the solution to the troubleshooting section. , Well I've tested this one with s3a://, using Impala and Hive (storing keys in core-site.xml). Also tested using hadoop commands by directly passing keys to command., * The joda time update will be mandatory for S3A to auth
* even there, it won't like v4 endpoints. Which version are you up against.

Like I said, we're somewhat constrained by the requirement of "don't log secrets". Sometimes putting up a debugger and setting a breakpoint on the auth pipeline is the tactic. For hadoop 2.8, thats {{org.apache.hadoop.fs.s3a.BasicAWSCredentialsProvider.getCredentials()}} ., Maybe it is reasonable to leave version 2.8.1 as is. I haven't seen that master branch already has 2.8.1 version of joda time. My fault. I thought it's still 2.5]