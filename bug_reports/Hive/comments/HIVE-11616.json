[

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12762638/HIVE-11616.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 5 failed/errored test(s), 9675 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.thrift.TestDBTokenStore.testDBTokenStore
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler.org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler
org.apache.hive.jdbc.TestSSL.testSSLVersion
org.apache.hive.minikdc.TestHiveAuthFactory.testStartTokenManagerForDBTokenStore
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5633/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5633/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5633/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12762638 - PreCommit-HIVE-TRUNK-Build, There's another path like that in HiveAuthFactory now. The patch makes sense to me., Updated the patch, Looks like HIVE-12248 duplicates this JIRA. 
[~sershe] When HS2 works with a local HMS, it is OK to pass HiveMetaStore.HMSHandler to DBTokenStore and use RawStore to access DB from HS2 directly. But if HS2 works with a remote HMS, will it be better that DBTokenStore uses HiveMetaStoreClient instead of HMSHandler to get delegation/key information from HMS?, I am not familiar with DB token store. How does it work presently? Is it running on HS2 and creating local metastore even when HS2 is working with remote metastore? I assumed from the code modified in this patch that it runs inside metastore. Otherwise yeah it sounds like it should be changed. Should that be done in a separate JIRA though?, I was looking into the DBTokenStore and as I understand, it has not been supported in HS2 delegation token. DBTokenStore was initially introduced by HIVE-3255 in Hive-0.12 and it is mainly for HMS delegation token. Later in Hive-0.13, the HS2 delegation token support was introduced by HIVE-5155 but it used MemoryTokenStore as token store. HIVE-9622 should not be considered as to add the DBTokenStore support in HS2., [~sershe] I filed a separate JIRA HIVE-12270 to track DBTokenStore support in HS2., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12768825/HIVE-11616.01.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 4 failed/errored test(s), 9709 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.hwi.TestHWISessionManager.testHiveDriver
org.apache.hadoop.hive.ql.io.orc.TestJsonFileDump.testJsonDump
org.apache.hadoop.hive.thrift.TestDBTokenStore.testDBTokenStore
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5808/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5808/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5808/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12768825 - PreCommit-HIVE-TRUNK-Build, Fixing the test, very simple fix., Could we update the affects version, and after the fix goes in, fix version please? the current ones are confusing., What is the convention for affected versions? It's kind of a PITA to put all affected versions and trace the original commit thru the branch tree. I was always assuming you can just put correct fixed versions, and then if someone hits a bug they can see that they are affected because their version is lower than fixed., Agreed for users hit the bug, but for preventive measures, it's good to know for a user to know if their version is affected and they might want to move to the newer version or backport the fix.

I understand sometimes it's hard to list all the affected versions. Sometimes we do, when we know when a piece of the code or feature is introduced. In that case, it doesn't take much to do so. I guess backtracking last few release is reasonable., thanks your warmly joining to update the patch [~sershe] aslo thanks to [~ctang.ma] and [~xuefuz] 's attention on this, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12769385/HIVE-11616.02.patch

{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 9732 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestHBaseCliDriver.testCliDriver_hbase_queries
org.apache.hadoop.hive.hwi.TestHWISessionManager.testHiveDriver
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5843/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5843/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5843/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12769385 - PreCommit-HIVE-TRUNK-Build, Test failures unrelated. [~xuefuz] [~ctang.ma] can you take a look?, +1, Committed to master., Should this issue be backported to branch-1? It looks like a bug., [~sershe], yes it should be, Committed to branch-1]