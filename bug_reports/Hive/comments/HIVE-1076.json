[The reason why this is occurring is due to a custom pre-execute hook (which is in use by facebook) that was calling alterTable to the metastore to set a flag. The pre-execute hook would get information about what values to set for the partition through the WriteEntity object generated by SemanticAnalyzer:genFileSinkPlan(). The partition information (stored in the Partition object) for the WriteEntity object is populated by the tableSpec class in BaseSemantic analyzer.

When creating the Partition object, tableSpec does not query the metastore and instead just creates the Partition object using the constructor. Consequently, create time is initialized to the default value of 0. For cases where the partition did not exist before, there is no problem as there is nothing to alter when the pre-execute hook runs. However, for partitions that already exist, the alter partition call in the pre-execute hook would overwrite the partition info with creation time = 0.

To fix this, the patch queries the metastore in tableSpec to get the correct partition information.

Currently, it's difficult to create a test for this issue because DESCRIBE EXTENDED will print out a single line for the partition attributes. Because the line probably contains 'file:/', diff will ignore the whole line.

Zheng - how quickly do you need the fix? Fixing that, plus adding a test case will take some additional time. A quick solution would be to stop using that pre-execution hook., Agree. The code looks good. Let me commit this fix first.

Let's open a new JIRA to pretty-print the Detailed Partition/Table Information. Once that gets done, let's add a test for this one.
, Committed to trunk and branch-0.5. Thanks Paul!, When I commit, the "svn commit" message was set to HIVE-1072 by mistake.
So please look for HIVE-1072 when looking for svn log or CHANGES.txt.

]