[For more details, visit: https://www.zybuluo.com/Spongcer/note/61369
, Or see the attachment: Fix-Hive-ParseException-of-Grouping-Sets.htm, 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12691869/HIVE-9336.1.patch

{color:red}ERROR:{color} -1 due to 10 failed/errored test(s), 7311 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_index_bitmap_auto
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_optimize_nullscan
org.apache.hadoop.hive.ql.TestMTQueries.testMTQueries1
org.apache.hive.spark.client.TestSparkClient.testAddJarsAndFiles
org.apache.hive.spark.client.TestSparkClient.testCounters
org.apache.hive.spark.client.TestSparkClient.testErrorJob
org.apache.hive.spark.client.TestSparkClient.testJobSubmission
org.apache.hive.spark.client.TestSparkClient.testMetricsCollection
org.apache.hive.spark.client.TestSparkClient.testRemoteClient
org.apache.hive.spark.client.TestSparkClient.testSimpleSparkJob
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2356/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2356/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2356/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 10 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12691869 - PreCommit-HIVE-TRUNK-Build, @Prasad Mujumdar 

I rerun the unit tests through the following commands and all report success without any errors, So I guess that there are some 
differences between my local environment and Hive QA's, or we do not use the same options to mvn when compile and run unit tests, or anything else, Could you help me to find what happened?

cd itests

mvn test -Dtest=rg.apache.hadoop.hive.cli.TestMinimrCliDriver -Dqfile=index_bitmap_auto.q -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hadoop.hive.cli.TestMinimrCliDriver#testCliDriver_index_bitmap_auto -Dtest.silent=false -Phadoop-2

mvn test -Dtest=org.apache.hadoop.hive.cli.TestSparkCliDriver -Dqfile=optimize_nullscan.q  -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hadoop.hive.cli.TestSparkCliDriver#testCliDriver_optimize_nullscan -Dtest.silent=false -Phadoop-2

mvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testRemoteClient -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testCounters -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testAddJarsAndFiles -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testSimpleSparkJob -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testErrorJob -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testJobSubmission -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testMetricsCollection -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hadoop.hive.ql.TestMTQueries#testMTQueries1 -Dtest.silent=false -Phadoop-2, [~xuefuz]

I build Hive with the following comands:

mvn clean install -DskipTests -Phadoop-2 | tee logs/mvn.logs
cd itests
mvn clean install -DskipTests -Phadoop-2 | tee logs/mvn.logs

and after that, I rerun the unit tests through the following commands and all report successed without any errors, So I guess that there are some 
differences between my local environment and Hive QA's, or we do not pass the same options to mvn when compile and run unit tests, or anything else, Could you help me to find what happened?

cd itests

mvn test -Dtest=rg.apache.hadoop.hive.cli.TestMinimrCliDriver -Dqfile=index_bitmap_auto.q -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hadoop.hive.cli.TestMinimrCliDriver#testCliDriver_index_bitmap_auto -Dtest.silent=false -Phadoop-2

mvn test -Dtest=org.apache.hadoop.hive.cli.TestSparkCliDriver -Dqfile=optimize_nullscan.q  -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hadoop.hive.cli.TestSparkCliDriver#testCliDriver_optimize_nullscan -Dtest.silent=false -Phadoop-2

mvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testRemoteClient -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testCounters -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testAddJarsAndFiles -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testSimpleSparkJob -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testErrorJob -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testJobSubmission -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testMetricsCollection -Dtest.silent=false -Phadoop-2
mvn test -Dtest=org.apache.hadoop.hive.ql.TestMTQueries#testMTQueries1 -Dtest.silent=false -Phadoop-2, +1 Having the same issue.

Though, there is a workaround for it:
We can write:

{code}
    explain select test.tc1, test.tc2 from test group by null, test.tc1, test.tc2 grouping sets(null, test.tc1, (test.tc1, test.tc2));
    explain select tc1+tc2, tc2 from test group by null, tc1+tc2, tc2 grouping sets(null, tc2, (tc1 + tc2, tc2));
{code}
Instead of:

{code}
    explain select test.tc1, test.tc2 from test group by test.tc1, test.tc2 grouping sets(test.tc1, (test.tc1, test.tc2));
    explain select tc1+tc2, tc2 from test group by tc1+tc2, tc2 grouping sets(tc2, (tc1 + tc2, tc2));
{code}, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12691869/HIVE-9336.1.patch

{color:red}ERROR:{color} -1 due to build exiting with an error

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/2888/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/2888/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2888/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Tests exited with: NonZeroExitCodeException
Command 'bash /data/hiveptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ date '+%Y-%m-%d %T.%3N'
2017-01-11 17:08:44.860
+ [[ -n /usr/lib/jvm/java-8-openjdk-amd64 ]]
+ export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ export PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m '
+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m '
+ export 'MAVEN_OPTS=-Xmx1g '
+ MAVEN_OPTS='-Xmx1g '
+ cd /data/hiveptest/working/
+ tee /data/hiveptest/logs/PreCommit-HIVE-Build-2888/source-prep.txt
+ [[ false == \t\r\u\e ]]
+ mkdir -p maven ivy
+ [[ git = \s\v\n ]]
+ [[ git = \g\i\t ]]
+ [[ -z master ]]
+ [[ -d apache-github-source-source ]]
+ [[ ! -d apache-github-source-source/.git ]]
+ [[ ! -d apache-github-source-source ]]
+ date '+%Y-%m-%d %T.%3N'
2017-01-11 17:08:44.863
+ cd apache-github-source-source
+ git fetch origin
+ git reset --hard HEAD
HEAD is now at cb771bb HIVE-15563: Ignore Illegal Operation state transition exception in SQLOperation.runQuery to expose real exception (Zhihai Xu via Jimmy Xiang)
+ git clean -f -d
+ git checkout master
Already on 'master'
Your branch is up-to-date with 'origin/master'.
+ git reset --hard origin/master
HEAD is now at cb771bb HIVE-15563: Ignore Illegal Operation state transition exception in SQLOperation.runQuery to expose real exception (Zhihai Xu via Jimmy Xiang)
+ git merge --ff-only origin/master
Already up-to-date.
+ date '+%Y-%m-%d %T.%3N'
2017-01-11 17:08:45.877
+ patchCommandPath=/data/hiveptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hiveptest/working/scratch/build.patch
+ [[ -f /data/hiveptest/working/scratch/build.patch ]]
+ chmod +x /data/hiveptest/working/scratch/smart-apply-patch.sh
+ /data/hiveptest/working/scratch/smart-apply-patch.sh /data/hiveptest/working/scratch/build.patch
error: patch failed: ql/src/java/org/apache/hadoop/hive/ql/parse/IdentifiersParser.g:66
error: ql/src/java/org/apache/hadoop/hive/ql/parse/IdentifiersParser.g: patch does not apply
The patch does not appear to apply with p0, p1, or p2
+ exit 1
'
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12691869 - PreCommit-HIVE-Build]