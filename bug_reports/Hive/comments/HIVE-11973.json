[I can reproduce the issue in master branch., The in statement thinks string can not convert to date for
FunctionRegistry.getPrimitiveCommonCategory(TypeInfo, TypeInfo) return null for the two types. For string can be converted to Date and implicitly converted to Date. So the PrimitiveCommonCategory for the two should be Date. 

{noformat}
FunctionRegistry.getPrimitiveCommonCategory(TypeInfo, TypeInfo) line: 772 	
FunctionRegistry.getCommonClass(TypeInfo, TypeInfo) line: 810 
GenericUDFUtils$ReturnObjectInspectorResolver.update(ObjectInspector, boolean) line: 165 	
GenericUDFUtils$ReturnObjectInspectorResolver.update(ObjectInspector) line: 103 	
GenericUDFIn.initialize(ObjectInspector[]) line: 89 	
GenericUDFIn(GenericUDF).initializeAndFoldConstants(ObjectInspector[]) line: 139 	
ExprNodeGenericFuncDesc.newInstance(GenericUDF, String, List<ExprNodeDesc>) line: 234
{noformat}, Not sure why this patch is not in the waiting list of pre-commit build. Re-attach it., Posting on behalf of HiveQA which was locked out:

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12764251/HIVE-11973.1.patch

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 9642 tests executed
*Failed tests:*
{noformat}
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5483/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5483/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5483/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}, The 1 failure is not related. The age is more than 300., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12764590/HIVE-11973.1.patch

{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 2 failed/errored test(s), 9629 tests executed
*Failed tests:*
{noformat}
TestMiniTezCliDriver-vector_partitioned_date_time.q-vector_non_string_partition.q-tez_union.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5508/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5508/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5508/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12764590 - PreCommit-HIVE-TRUNK-Build, The two failures are not related. The patch used in this pre-commit build is the same as the first pre-commit build. , [~spena], [~jxiang], could you review the change? Thanks, With the patch, it means the common type of date and string is date, which seems not right.
IN is handled differently from comparison. That's why the behavior is like in this jira description., IN use ReturnObjectInspectorResolver.update which end up use FunctionRegistry.getCommonClass method. This method is too strict. The elem in (val1, val2...) more like union all style of type conversion. (For types in elem, val1, val2... can be used in union all).  I will try the approach to let IN UDF use conversionHelper.updateForUnionAll., It seems to me that x IN (val1, val2, ..., valn) should be equivalent to x = val1 OR x = val2 ... OR x = valn. Could we check how "WHERE d_date   = '2000-03-22'" works and apply the same logic here? Maybe, we should just need to add an implicit cast when the type doesn't match., [~xuefuz], the equal one has this stacktrace, it uses getCommonClassForComparison if need convert:

FunctionRegistry.implicitConvertible(PrimitiveObjectInspector$PrimitiveCategory, PrimitiveObjectInspector$PrimitiveCategory) line: 890	
FunctionRegistry.getCommonClassForComparison(TypeInfo, TypeInfo) line: 763	
GenericUDFOPEqual(GenericUDFBaseCompare).initialize(ObjectInspector[]) line: 138	
GenericUDFOPEqual(GenericUDF).initializeAndFoldConstants(ObjectInspector[]) line: 139	
ExprNodeGenericFuncDesc.newInstance(GenericUDF, String, List<ExprNodeDesc>) line: 234	
TypeCheckProcFactory$DefaultExprProcessor.getXpathOrFuncExprNodeDesc(ASTNode, boolean, ArrayList<ExprNodeDesc>, TypeCheckCtx) line: 1082	
TypeCheckProcFactory$DefaultExprProcessor.process(Node, Stack<Node>, NodeProcessorCtx, Object...) line: 1301	
DefaultRuleDispatcher.dispatch(Node, Stack<Node>, Object...) line: 90	

The logic of getCommonClassForComparison very similar to getCommonClassForUnionAll.

What I am trying to say in the previous comment is: When only consider type conversion, x will need compare each value, that means it can unionall with each value too. The ReturnObjectInspectorResolver.update is just to find out which type will be used for the conversion that x can compare with each value in the set. , 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12767937/HIVE-11973.2.patch

{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 5 failed/errored test(s), 9699 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_orc_ppd_decimal
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_parquet_ppd_decimal
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_structin
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5737/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5737/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5737/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12767937 - PreCommit-HIVE-TRUNK-Build, The three new test failures show use getCommonClassByUnionAll is not a good choice for it does not consider numeric accuracy when choose converting type. 
So I will switch back to use update and the getCommonClass.
For in the getPrimitiveCommonCategory method, the common category for any numeric type and string type will be string. So I think Date and Timestamp should be the same. The common category with Date with String will be String.
How do you think [~jxiang] ?, bq. The common category with Date with String will be String.
That sounds ok.

For the test, can you add some data to the table and check if the query works as expected?  Thanks., Remove old patch 3 and replace it with a new one. The new patch insert 4 rows and select will return 2 rows. , 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12768188/HIVE-11973.3.patch

{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 4 failed/errored test(s), 9702 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.ql.io.orc.TestColumnStatistics.testHasNull
org.apache.hadoop.hive.ql.io.orc.TestJsonFileDump.testJsonDump
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5751/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5751/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5751/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12768188 - PreCommit-HIVE-TRUNK-Build, The four failures are not related. The ages are 9 and more. , Use String type is better than any type in string group. , +1 pending on test, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12768720/HIVE-11973.4.patch

{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 4 failed/errored test(s), 9709 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.ql.io.orc.TestColumnStatistics.testHasNull
org.apache.hadoop.hive.ql.io.orc.TestJsonFileDump.testJsonDump
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5798/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5798/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5798/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12768720 - PreCommit-HIVE-TRUNK-Build, The four failures are not related. Their ages are 9 or more. , Thanks [~jxiang] for reviewing the code. , Integrated into trunk. Thanks Yongzhi for the patch., Should this issue be backported to branch-1? It looks like a bug., [~ychena], is the patch good for branch-1?]