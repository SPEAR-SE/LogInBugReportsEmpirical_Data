[We can rewrite NVL into a vectorized COALESCE?, Hi [~sershe], [~gopalv]
Thank you for creating this jira. I'd like to work on it. Please could you assign it to me?

I agree with [~gopalv]. COALESCE is a generalization of the NVL function. Thanks., [~tasanuma0829]: assigned. 

You can follow the codepath of VectorCoalesce and guide yourself to the implementation of NVL.

I also think adding test-cases would be good. VectorCoalesce (& NVL) might need some test-coverage with COALESCE(a, b), where both columns are null., [~gopalv]
Thanks for the assignment and kind advice., Sorry for late. Please could you confirm my plan?
- implement VectorNVL like VectorCoalesce.
- modify Vectorizer and VectorizationContext for VectorNVL.
- add some unit tests and qtests as Gopal said., This approach makes sense. 
, I uploaded an initial patch for vectorized NVL. This patch also includes qtests for NVL and Coalesce. Please could you review it?

While reading the codes, I realized we can completely reuse VectorCoalesce for vectorized NVL. So I didn't write VectorNvl in this patch. I think there are not many overheads even if we use VectorCoalesce as VectorNvl. What do you think?, [~tasanuma0829]: The patch looks good - +1 tests pending., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12765582/HIVE-11822.1.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 9657 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_coalesce
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5586/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5586/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5586/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12765582 - PreCommit-HIVE-TRUNK-Build, [~tasanuma0829] looks like you need to update vector_coalesce output for minitez. You can run it the same way as regular but TestMiniTezCliDriver is the test name, [~gopalv], [~sershe]
Thanks for reviewing. I fixed the patch for minitez qtest., Resubmit patch to trigger QA, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12766291/HIVE-11822.2.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 9683 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_coalesce
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5634/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5634/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5634/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12766291 - PreCommit-HIVE-TRUNK-Build, I don't know why the difference happened...
{{mvn test -Dtest=TestMiniTezCliDriver -Dqfile=vector_coalesce.q -Phadoop-2}} was passed in my laptop computer., That could be related to java version difference (sorting for hashtable is different, so the line with Execution mode is output in a different place). You can just c/p the diff from test results and apply it., Thanks, Sergey. I updated the patch. Does this problem often occur? Should I set the same java version on my laptop computer?, I'll take a look. IIRC it runs java 7 on Jenkins. I will update patch if it fails again, 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12766726/HIVE-11822.3.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 2 failed/errored test(s), 9695 tests executed
*Failed tests:*
{noformat}
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.jdbc.TestSSL.testSSLVersion
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5672/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5672/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5672/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12766726 - PreCommit-HIVE-TRUNK-Build, committed to master. Thanks for the patch and review!
, [~sershe], [~gopalv]
Thank you for all your support!]