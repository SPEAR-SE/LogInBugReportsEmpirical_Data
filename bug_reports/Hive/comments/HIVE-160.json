[Adding to "Query Processor" component., I think this one has been resolved by Raghu or Namit?, Sampling within a sub-query does not seem to prune the input. A filter is added and the result seems correct., So it's resolved right? Will you close this issue?, No, the problem is that input pruning does not work well when done over parse structures (QB). We should do it over the operator tree. The current patch is a temporary fix for this bug. It always adds a sampling predicate to the where clause irrespective of whether there was input pruning or not. The final fix will be modeled after the partition pruning code that Ashish is fixing.

I also modified the tests so that srcbucket has an integer key. This allows for better testing of the case where a predicate is added to the where clause. 'Bucket 1 out of 2' will return keys which are even and bucket 2 out of 2 will return keys which are odd., +1


The code changes look good - will commit if the tests look good and they pass, Filed HIVE-638 to fix sampling in subqueries properly, Committed. Thanks Raghu]