[[~sseth] [~prasanth_j] can you please take a look, nit: MIN_SIZE. minimum of what? arena or io memory? rename accordingly.
nit: '(not recommended)' in exception msg. can we not suggest if we don't recommend it? Options confuse users :)

Otherwise, +1

Orthogonal issue, can we make all these sizes derivable from 1 config? For example: If IO is enabled, derive the size from -Xmx in 'auto' mode. 10% Xmx = IO memory.  10% IO memory = min allocation, 40% IO memory = max allocation, Min(1GB, 25% IO memory) = Arena size etc. , Deriving IO memory is not a good idea as it depends on user preferences and executor size and count.
Arena size is already derived.
Min allocation/max allocation are assumed to be pretty much hardcoded, there's rarely reason to change them (min allocation apparently impacts perf a bit so maybe some people will lower it). The reason we saw issues is that people were setting cache size to small values, like 4Mb, the MIN_SIZE prevents that now, so the only way they can be in error is if someone configures them manually., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12801514/HIVE-13653.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 14 failed/errored test(s), 10049 tests executed
*Failed tests:*
{noformat}
TestHWISessionManager - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_cbo_join
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_explainuser_4
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_mapreduce2
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_orc_merge_diff_fs
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vectorization_5
org.apache.hadoop.hive.llap.tezplugins.TestLlapTaskCommunicator.testFinishableStateUpdateFailure
org.apache.hadoop.hive.metastore.TestHiveMetaStoreGetMetaConf.testGetMetaConfDefault
org.apache.hadoop.hive.ql.security.TestExtendedAcls.org.apache.hadoop.hive.ql.security.TestExtendedAcls
org.apache.hadoop.hive.thrift.TestHadoopAuthBridge23.testDelegationTokenSharedStore
org.apache.hadoop.hive.thrift.TestHadoopAuthBridge23.testMetastoreProxyUser
org.apache.hadoop.hive.thrift.TestHadoopAuthBridge23.testSaslWithHiveMetaStore
org.apache.hive.service.cli.session.TestHiveSessionImpl.testLeakOperationHandle
{noformat}

Test results: http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/164/testReport
Console output: http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/164/console
Test logs: http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-164/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 14 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12801514 - PreCommit-HIVE-MASTER-Build, The tez tests pass for me, the other appear to be already broken or caused by metastore issues. I will update the patch, Updated the patch, Committed to master, didn't notice there was a +1 above :)]