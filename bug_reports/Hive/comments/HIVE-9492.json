[Thanks for working on this. The patch looks good. Could you please provide an RB entry if it's ready? On a high level, I don't think we need a configuration for this., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12695730/HIVE-9492.1-spark.patch

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 7361 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_join_with_different_encryption_keys
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/701/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/701/console
Test logs: http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-SPARK-Build-701/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12695730 - PreCommit-HIVE-SPARK-Build, Attached patch v2 that added some unit tests., Has some problem to put it on RB now, will try again later. As to the configuration parameter, it is for the purpose to disable the caching to avoid the overhead if it doesn't help., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12695848/HIVE-9492.2-spark.patch

{color:red}ERROR:{color} -1 due to 2 failed/errored test(s), 7363 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_join_with_different_encryption_keys
org.apache.hive.hcatalog.streaming.TestStreaming.testEndpointConnection
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/702/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/702/console
Test logs: http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-SPARK-Build-702/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12695848 - PreCommit-HIVE-SPARK-Build, Doc review:  Please capitalize Hive and Spark in the parameter description, and change initial "If" to "Whether".  And shouldn't "mapinput" be "MapInput"?

{code}
+    HIVE_CACHE_MAPINPUT("hive.exec.cache.mapinput", false,
+        "Whether Hive (in Spark mode only) should cache MapInput if it applies."),
{code}, Thanks a lot for the review. Will address it in the next patch., V2 is uploaded to RB: https://reviews.apache.org/r/30502/]