[Hi [~romainr], do you plan to work on this? If not, I can give it a try. Thanks. , Feel free to take it, thanks!, Any update?, Hi [~romainr] Does the comment here give you satisfactory solution?

https://issues.apache.org/jira/browse/HIVE-3682?focusedCommentId=13831773&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13831773
, We would also need to create the table columns manually, and delete the table afterward, which is not trivial.

I think for now we will probably pull everything from the resultset and insert manually the separator. We will see how scalable it is (main worries)., Such a workaround as noted in that comment is painful as explained by Amareshwari at https://issues.apache.org/jira/browse/HIVE-6410 (schema knowledge requirement). We can mark either one as dupe but we do need this feature., [~xuefuz] Can hive support this feature on later version? , [~jianbginglover] As far as I know, this is not supported yet in Hive. Please feel free to work on this if you like. Thanks., Can anyone please tell me if this works in Hive 0.13? It is referred here: https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML#LanguageManualDML-Writingdataintothefilesystemfromqueries

but when I tried it still doesn't support it in non-local directory. Also, lines terminated by is only supported for '\n'. Is this true even for the latest version. Thank you so much for your help., Uploading a patch that mainly comes from hive-6410.
The test result part is removed., 

{color:red}Overall{color}: -1 no tests executed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12704117/HIVE-5672.1.patch

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3019/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3019/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3019/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Tests exited with: NonZeroExitCodeException
Command 'bash /data/hive-ptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ [[ -n /usr/java/jdk1.7.0_45-cloudera ]]
+ export JAVA_HOME=/usr/java/jdk1.7.0_45-cloudera
+ JAVA_HOME=/usr/java/jdk1.7.0_45-cloudera
+ export PATH=/usr/java/jdk1.7.0_45-cloudera/bin/:/usr/local/apache-maven-3.0.5/bin:/usr/java/jdk1.7.0_45-cloudera/bin:/usr/local/apache-ant-1.9.1/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/hiveptest/bin
+ PATH=/usr/java/jdk1.7.0_45-cloudera/bin/:/usr/local/apache-maven-3.0.5/bin:/usr/java/jdk1.7.0_45-cloudera/bin:/usr/local/apache-ant-1.9.1/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/hiveptest/bin
+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m '
+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m '
+ export 'M2_OPTS=-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128'
+ M2_OPTS='-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128'
+ cd /data/hive-ptest/working/
+ tee /data/hive-ptest/logs/PreCommit-HIVE-TRUNK-Build-3019/source-prep.txt
+ [[ false == \t\r\u\e ]]
+ mkdir -p maven ivy
+ [[ svn = \s\v\n ]]
+ [[ -n '' ]]
+ [[ -d apache-svn-trunk-source ]]
+ [[ ! -d apache-svn-trunk-source/.svn ]]
+ [[ ! -d apache-svn-trunk-source ]]
+ cd apache-svn-trunk-source
+ svn revert -R .
Reverted 'metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreUtils.java'
Reverted 'metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java'
++ awk '{print $2}'
++ egrep -v '^X|^Performing status on external'
++ svn status --no-ignore
+ rm -rf target datanucleus.log ant/target shims/target shims/0.20S/target shims/0.23/target shims/aggregator/target shims/common/target shims/scheduler/target packaging/target hbase-handler/target testutils/target jdbc/target metastore/target metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreUtils.java.orig itests/target itests/thirdparty itests/hcatalog-unit/target itests/test-serde/target itests/qtest/target itests/hive-unit-hadoop2/target itests/hive-minikdc/target itests/hive-jmh/target itests/hive-unit/target itests/custom-serde/target itests/util/target itests/qtest-spark/target hcatalog/target hcatalog/core/target hcatalog/streaming/target hcatalog/server-extensions/target hcatalog/hcatalog-pig-adapter/target hcatalog/webhcat/svr/target hcatalog/webhcat/java-client/target accumulo-handler/target hwi/target common/target common/src/gen spark-client/target contrib/target service/target serde/target beeline/target odbc/target cli/target ql/dependency-reduced-pom.xml ql/target ql/src/test/results/clientpositive/alter_table_invalidate_column_stats.q.out ql/src/test/queries/clientpositive/alter_table_invalidate_column_stats.q
+ svn update

Fetching external item into 'hcatalog/src/test/e2e/harness'
External at revision 1666279.

At revision 1666279.
+ patchCommandPath=/data/hive-ptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hive-ptest/working/scratch/build.patch
+ [[ -f /data/hive-ptest/working/scratch/build.patch ]]
+ chmod +x /data/hive-ptest/working/scratch/smart-apply-patch.sh
+ /data/hive-ptest/working/scratch/smart-apply-patch.sh /data/hive-ptest/working/scratch/build.patch
patch: **** malformed patch at line 337:  

patch: **** malformed patch at line 337:  

patch: **** malformed patch at line 337:  

The patch does not appear to apply with p0, p1, or p2
+ exit 1
'
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12704117 - PreCommit-HIVE-TRUNK-Build, Uploading a new patch  that contains test result., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12704457/HIVE-5672.2.patch

{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 7765 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udaf_context_ngrams
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3036/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3036/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3036/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12704457 - PreCommit-HIVE-TRUNK-Build, Adding additional doc note here : https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML#LanguageManualDML-Writingdataintothefilesystemfromqueries needs to be updated to note that delimiters are not currently supported for non-LOCAL writes, and once this patch goes in, we should note which version fixed that in that doc., How's this?

{quote}
As of Hive 0.11.0 the separator used can be specified, in earlier versions it was always the ^A character (\001). However, custom separators are currently only supported for LOCAL writes; this is a bug that will be fixed by HIVE-5672﻿.
{quote}

* [DML -- Writing data into the filesystem from queries -- Notes | https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML#LanguageManualDML-Notes.2], (Setting to patch-available for tests), Re base the patch.
the .out file will be added later., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12727622/HIVE-5672.5.patch

{color:red}ERROR:{color} -1 due to 13 failed/errored test(s), 8729 tests executed
*Failed tests:*
{noformat}
TestMinimrCliDriver-bucketmapjoin6.q-constprog_partitioner.q-infer_bucket_sort_dyn_part.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-external_table_with_space_in_location_path.q-infer_bucket_sort_merge.q-auto_sortmerge_join_16.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-groupby2.q-import_exported_table.q-bucketizedhiveinputformat.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-index_bitmap3.q-stats_counter_partitioned.q-temp_table_external.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-infer_bucket_sort_map_operators.q-join1.q-bucketmapjoin7.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-infer_bucket_sort_num_buckets.q-disable_merge_for_bucketing.q-uber_reduce.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-infer_bucket_sort_reducers_power_two.q-scriptfile1.q-scriptfile1_win.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-leftsemijoin_mr.q-load_hdfs_file_with_space_in_the_name.q-root_dir_external_table.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-list_bucket_dml_10.q-bucket_num_reducers.q-bucket6.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-load_fs2.q-file_with_header_footer.q-ql_rewrite_gbtoidx_cbo_1.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-parallel_orderby.q-reduce_deduplicate.q-ql_rewrite_gbtoidx_cbo_2.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-ql_rewrite_gbtoidx.q-smb_mapjoin_8.q - did not produce a TEST-*.xml file
TestMinimrCliDriver-schemeAuthority2.q-bucket4.q-input16_cc.q-and-1-more - did not produce a TEST-*.xml file
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3545/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3545/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3545/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 13 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12727622 - PreCommit-HIVE-TRUNK-Build, Looking at the patch, I'm not sure if I understand the changes correctly. I can see that we modified the grammar to make "local" optional and the rest is about refactoring. I'm not sure if this is sufficient. Did I miss anything?

Also, instead of adding a new grammar rule, we should combine it with the old one. We just need to make KW_LOCAL optional., Agree with Xuefu - the grammar might be simplified by simply making KW_LOCAL optional, since there is no other place in hive code that seems to be making use of TOK_LOCAL_DIR.

To wit, we could have :

{code}
KW_LOCAL? KW_DIRECTORY StringLiteral tableRowFormat? tableFileFormat? -> ^(TOK_DIR StringLiteral tableRowFormat? tableFileFormat?)
{code}

This does mean that if at some point, we do still want to have a differentiation between local and non-local writes, we have to go back to Nemon's approach, and his approach is definitely the "least damage done" approach of not trying to remove something that already exists, so his patch makes sense from that point-of-view.

We have two approaches here, and I'm +1 on both:

a) Nemon's approach
b) Xuefu's suggestion : to make KW_LOCAL optional, and then emiting a TOK_DIR instead of a TOK_LOCAL_DIR for that line, and removing any other occurrences of TOK_LOCAL_DIR. We might eventually add it back because we want it, but it's duplicate code pruning in the meanwhile., Uploading a new patch using a simplified grammar .
{quote}
     (temp=KW_LOCAL)? KW_DIRECTORY StringLiteral tableRowFormat? tableFileFormat?
     ->{$temp != null}? ^(TOK_LOCAL_DIR StringLiteral tableRowFormat? tableFileFormat?)
     ->                 ^(TOK_DIR StringLiteral tableRowFormat? tableFileFormat?)
{quote}
The TOK_LOCAL_DIR has to be kept,because SemanticAnalyzer using this token to decide FileSystem type.
{code:java}
          qb.getMetaData().setDestForAlias(name, fname,
              (ast.getToken().getType() == HiveParser.TOK_DIR));
{code}
at line 1794 of SemanticAnalyzer.java
, This patch only adds the grammar support and does some code reflact.And it works as expected.Hive can write to hdfs directory after applying this patch., Here is what I have about the combined grammar:
{code}
      (local = KW_LOCAL)? KW_DIRECTORY StringLiteral tableRowFormat? tableFileFormat?
        -> ^(TOK_DIR StringLiteral $local? tableRowFormat? tableFileFormat?)
{code}

With this, I'm sure SemanticAnalyzer has the information about whether the directory is local.

, I have tried both Sushanth's and  Xuefu 's  solution of simplified grammar ,they both treated local directory wrongly as DFS directory.
Some analysis from SemanticAnalyzer.java：
The genFileSinkPlan method use dest_type from QBMetaData to determine the destination of final output.
{code}
    QBMetaData qbm = qb.getMetaData();
    Integer dest_type = qbm.getDestTypeForAlias(dest);
    switch (dest_type.intValue()) {
    case QBMetaData.DEST_TABLE: {
    ...  
    }
    case QBMetaData.DEST_PARTITION:{
   ... 
   }
case QBMetaData.DEST_LOCAL_FILE:
      isLocal = true;
      // fall through
    case QBMetaData.DEST_DFS_FILE: {
      ...
      if (isLocal) {
        ...
      } else {
        ...
    }
 default:
      throw new SemanticException("Unknown destination type: " + dest_type);
{code}

The dest_type from QBMetaData is determined by this method :
{code}
  qb.getMetaData().setDestForAlias(name, fname,
              (ast.getToken().getType() == HiveParser.TOK_DIR));
{code}

The code for setDestForAlias is this :
{code}
   public void setDestForAlias(String alias, String fname, boolean isDfsFile) {
    nameToDestType.put(alias, isDfsFile ? Integer.valueOf(DEST_DFS_FILE)
        : Integer.valueOf(DEST_LOCAL_FILE));
    nameToDestFile.put(alias, fname);
  }
{code}
The simplified grammar proposed by  Sushanth or Xuefu can not tell which kind of directory is used (DEST_DFS_FILE or DEST_LOCAL_FILE).
Maybe i understood something wrong,please correct me. :), [~nemon], I think you need to change semantic analyzer in addition to the grammar in order to make it work. Since the grammar changes, the AST generated will also change. Thus, semantic analyzer that processes the AST will need to change accordingly in order to get the correct information such as hdfs vs local.

Specifically, you need to change the following code block:
{code}
          qb.getMetaData().setDestForAlias(name, fname,
              (ast.getToken().getType() == HiveParser.TOK_DIR));

          CreateTableDesc localDirectoryDesc = new CreateTableDesc();
          boolean localDirectoryDescIsSet = false;
          int numCh = ast.getChildCount();
          for (int num = 1; num < numCh ; num++){
            ASTNode child = (ASTNode) ast.getChild(num);
            if (child != null) {
              if (storageFormat.fillStorageFormat(child)) {
                localDirectoryDesc.setOutputFormat(storageFormat.getOutputFormat());
                localDirectoryDesc.setSerName(storageFormat.getSerde());
                localDirectoryDescIsSet = true;
                continue;
              }
              switch (child.getToken().getType()) {
                case HiveParser.TOK_TABLEROWFORMAT:
                  rowFormatParams.analyzeRowFormat(child);
                  localDirectoryDesc.setFieldDelim(rowFormatParams.fieldDelim);
                  localDirectoryDesc.setLineDelim(rowFormatParams.lineDelim);
                  localDirectoryDesc.setCollItemDelim(rowFormatParams.collItemDelim);
                  localDirectoryDesc.setMapKeyDelim(rowFormatParams.mapKeyDelim);
                  localDirectoryDesc.setFieldEscape(rowFormatParams.fieldEscape);
                  localDirectoryDesc.setNullFormat(rowFormatParams.nullFormat);
                  localDirectoryDescIsSet=true;
                  break;
                case HiveParser.TOK_TABLESERIALIZER:
                  ASTNode serdeChild = (ASTNode) child.getChild(0);
                  storageFormat.setSerde(unescapeSQLString(serdeChild.getChild(0).getText()));
                  localDirectoryDesc.setSerName(storageFormat.getSerde());
                  localDirectoryDescIsSet=true;
                  break;
              }
            }
          }
{code}
You need to remove this line:
{code}
          qb.getMetaData().setDestForAlias(name, fname,
              (ast.getToken().getType() == HiveParser.TOK_DIR));
{code}
and you need to change the for loop after that because child count is different. The child at index 1 tells whether directory is local, and children at index 2 and 3 tells you the output format and storage serde. 
, Two major change:
1,simplified grammar 
{quote}
     (local = KW_LOCAL)? KW_DIRECTORY StringLiteral tableRowFormat? tableFileFormat?
       -> ^(TOK_DIR StringLiteral $local? tableRowFormat? tableFileFormat?)
{quote}
2,semantic analyzer changes that check "local"
{code:java}
          boolean isDfsFile =true;
          if (ast.getChildCount() >= 2 && ast.getChild(1).getText().toLowerCase().equals("local")) {
            isDfsFile = false;
          }
          qb.getMetaData().setDestForAlias(name, fname, isDfsFile);
{code}
, The query plan for local directory is simple:
{quote}
explain insert overwrite local directory '/tmp/xxx' select * from src;
+-----------------------------------------------------------------------------------------------------------------------+
|                                                        Explain                                                        |
+-----------------------------------------------------------------------------------------------------------------------+
| STAGE DEPENDENCIES:                                                                                                   |
|   Stage-1 is a root stage                                                                                             |
|   Stage-0 depends on stages: Stage-1                                                                                  |
|                                                                                                                       |
| STAGE PLANS:                                                                                                          |
|   Stage: Stage-1                                                                                                      |
|     Map Reduce                                                                                                        |
|       Map Operator Tree:                                                                                              |
|           TableScan                                                                                                   |
|             alias: src                                                                                                |
|             Statistics: Num rows: 38 Data size: 11900 Basic stats: COMPLETE Column stats: NONE                        |
|             Select Operator                                                                                           |
|               expressions: id (type: string), starttime (type: bigint), callerno (type: string), note (type: string)  |
|               outputColumnNames: _col0, _col1, _col2, _col3                                                           |
|               Statistics: Num rows: 38 Data size: 11900 Basic stats: COMPLETE Column stats: NONE                      |
|               File Output Operator                                                                                    |
|                 compressed: false                                                                                     |
|                 Statistics: Num rows: 38 Data size: 11900 Basic stats: COMPLETE Column stats: NONE                    |
|                 table:                                                                                                |
|                     input format: org.apache.hadoop.mapred.TextInputFormat                                            |
|                     output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat                         |
|                     serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe                                         |
|                                                                                                                       |
|   Stage: Stage-0                                                                                                      |
|     Move Operator                                                                                                     |
|       files:                                                                                                          |
|           hdfs directory: false                                                                                       |
|           destination: /tmp/xxx                                                                                       |
|                                                                                                                       |
+-----------------------------------------------------------------------------------------------------------------------+
29 rows selected (5.957 seconds)
{quote}

While the query plan for DFS directory is complicated：
{quote}
explain insert overwrite directory '/tmp/xxx' select * from src;
+-------------------------------------------------------------------------------------------------------------------------+
|                                                         Explain                                                         |
+-------------------------------------------------------------------------------------------------------------------------+
| STAGE DEPENDENCIES:                                                                                                     |
|   Stage-1 is a root stage                                                                                               |
|   Stage-6 depends on stages: Stage-1 , consists of Stage-3, Stage-2, Stage-4                                            |
|   Stage-3                                                                                                               |
|   Stage-0 depends on stages: Stage-3, Stage-2, Stage-5                                                                  |
|   Stage-2                                                                                                               |
|   Stage-4                                                                                                               |
|   Stage-5 depends on stages: Stage-4                                                                                    |
|                                                                                                                         |
| STAGE PLANS:                                                                                                            |
|   Stage: Stage-1                                                                                                        |
|     Map Reduce                                                                                                          |
|       Map Operator Tree:                                                                                                |
|           TableScan                                                                                                     |
|             alias: src                                                                                                  |
|             Statistics: Num rows: 38 Data size: 11900 Basic stats: COMPLETE Column stats: NONE                          |
|             Select Operator                                                                                             |
|               expressions: id (type: string), starttime (type: bigint), callerno (type: string), note (type: string)    |
|               outputColumnNames: _col0, _col1, _col2, _col3                                                             |
|               Statistics: Num rows: 38 Data size: 11900 Basic stats: COMPLETE Column stats: NONE                        |
|               File Output Operator                                                                                      |
|                 compressed: false                                                                                       |
|                 Statistics: Num rows: 38 Data size: 11900 Basic stats: COMPLETE Column stats: NONE                      |
|                 table:                                                                                                  |
|                     input format: org.apache.hadoop.mapred.TextInputFormat                                              |
|                     output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat                           |
|                     serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe                                           |
|                                                                                                                         |
|   Stage: Stage-6                                                                                                        |
|     Conditional Operator                                                                                                |
|                                                                                                                         |
|   Stage: Stage-3                                                                                                        |
|     Move Operator                                                                                                       |
|       files:                                                                                                            |
|           hdfs directory: true                                                                                          |
|           destination: hdfs://hacluster/tmp/hive-scratch/hive_2015-04-28_20-49-24_582_7448801537099184702-2/-ext-10000  |
|                                                                                                                         |
|   Stage: Stage-0                                                                                                        |
|     Move Operator                                                                                                       |
|       files:                                                                                                            |
|           hdfs directory: true                                                                                          |
|           destination: /tmp/xxx                                                                                         |
|                                                                                                                         |
|   Stage: Stage-2                                                                                                        |
|     Map Reduce                                                                                                          |
|       Map Operator Tree:                                                                                                |
|           TableScan                                                                                                     |
|             File Output Operator                                                                                        |
|               compressed: false                                                                                         |
|               table:                                                                                                    |
|                   input format: org.apache.hadoop.mapred.TextInputFormat                                                |
|                   output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat                             |
|                   serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe                                             |
|                                                                                                                         |
|   Stage: Stage-4                                                                                                        |
|     Map Reduce                                                                                                          |
|       Map Operator Tree:                                                                                                |
|           TableScan                                                                                                     |
|             File Output Operator                                                                                        |
|               compressed: false                                                                                         |
|               table:                                                                                                    |
|                   input format: org.apache.hadoop.mapred.TextInputFormat                                                |
|                   output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat                             |
|                   serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe                                             |
|                                                                                                                         |
|   Stage: Stage-5                                                                                                        |
|     Move Operator                                                                                                       |
|       files:                                                                                                            |
|           hdfs directory: true                                                                                          |
|           destination: hdfs://hacluster/tmp/hive-scratch/hive_2015-04-28_20-49-24_582_7448801537099184702-2/-ext-10000  |
|                                                                                                                         |
+-------------------------------------------------------------------------------------------------------------------------+
71 rows selected (3.911 seconds)
{quote}, +1 pending on test., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12728808/HIVE-5672.7.patch

{color:red}ERROR:{color} -1 due to 15 failed/errored test(s), 8826 tests executed
*Failed tests:*
{noformat}
TestMinimrCliDriver-bucketmapjoin6.q-constprog_partitioner.q-infer_bucket_sort_dyn_part.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-external_table_with_space_in_location_path.q-infer_bucket_sort_merge.q-auto_sortmerge_join_16.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-groupby2.q-import_exported_table.q-bucketizedhiveinputformat.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-index_bitmap3.q-stats_counter_partitioned.q-temp_table_external.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-infer_bucket_sort_map_operators.q-join1.q-bucketmapjoin7.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-infer_bucket_sort_num_buckets.q-disable_merge_for_bucketing.q-uber_reduce.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-infer_bucket_sort_reducers_power_two.q-scriptfile1.q-scriptfile1_win.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-leftsemijoin_mr.q-load_hdfs_file_with_space_in_the_name.q-root_dir_external_table.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-list_bucket_dml_10.q-bucket_num_reducers.q-bucket6.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-load_fs2.q-file_with_header_footer.q-ql_rewrite_gbtoidx_cbo_1.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-parallel_orderby.q-reduce_deduplicate.q-ql_rewrite_gbtoidx_cbo_2.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-ql_rewrite_gbtoidx.q-smb_mapjoin_8.q - did not produce a TEST-*.xml file
TestMinimrCliDriver-schemeAuthority2.q-bucket4.q-input16_cc.q-and-1-more - did not produce a TEST-*.xml file
org.apache.hive.hcatalog.streaming.TestStreaming.testTransactionBatchEmptyCommit
org.apache.hive.jdbc.TestSSL.testSSLConnectionWithProperty
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3634/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3634/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3634/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 15 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12728808 - PreCommit-HIVE-TRUNK-Build, Thanks to Xuefu and Sushanth for you review.
There is one more thing that i need to update :
removing occurrences of TOK_LOCAL_DIR.As you mentioned above.
Will update soon., 

{color:red}Overall{color}: -1 at least one tests failed

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12729190/HIVE-5672.8.patch

{color:red}ERROR:{color} -1 due to 16 failed/errored test(s), 8827 tests executed
*Failed tests:*
{noformat}
TestCustomAuthentication - did not produce a TEST-*.xml file
TestMinimrCliDriver-bucketmapjoin6.q-constprog_partitioner.q-infer_bucket_sort_dyn_part.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-external_table_with_space_in_location_path.q-infer_bucket_sort_merge.q-auto_sortmerge_join_16.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-groupby2.q-import_exported_table.q-bucketizedhiveinputformat.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-index_bitmap3.q-stats_counter_partitioned.q-temp_table_external.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-infer_bucket_sort_map_operators.q-join1.q-bucketmapjoin7.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-infer_bucket_sort_num_buckets.q-disable_merge_for_bucketing.q-uber_reduce.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-infer_bucket_sort_reducers_power_two.q-scriptfile1.q-scriptfile1_win.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-leftsemijoin_mr.q-load_hdfs_file_with_space_in_the_name.q-root_dir_external_table.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-list_bucket_dml_10.q-bucket_num_reducers.q-bucket6.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-load_fs2.q-file_with_header_footer.q-ql_rewrite_gbtoidx_cbo_1.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-parallel_orderby.q-reduce_deduplicate.q-ql_rewrite_gbtoidx_cbo_2.q-and-1-more - did not produce a TEST-*.xml file
TestMinimrCliDriver-ql_rewrite_gbtoidx.q-smb_mapjoin_8.q - did not produce a TEST-*.xml file
TestMinimrCliDriver-schemeAuthority2.q-bucket4.q-input16_cc.q-and-1-more - did not produce a TEST-*.xml file
org.apache.hive.hcatalog.streaming.TestStreaming.testTransactionBatchEmptyCommit
org.apache.hive.jdbc.TestSSL.testSSLConnectionWithProperty
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3658/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3658/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3658/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 16 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12729190 - PreCommit-HIVE-TRUNK-Build, I see that the .8.patch has both the changes, and has passed all the tests. I'm +1 on .8.patch., Committed to 1.2 and master. Thanks Nemon & Xuefu!, Doc note:  Please review the updated note about custom separators in the DML doc.  (If it's okay, remove the TODOC1.2 label.)

* [DML -- Writing data into the filesystem from queries -- Notes | https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML#LanguageManualDML-Notes.2], Looks good, Lefty. Thanks!

Removing the label., This issue has been fixed and released as part of the 1.2.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira., I see that the commit for this jira(https://github.com/apache/hive/commit/f3a23dce083decc565447b7438527d7aec434b29#diff-f21e965d5c189c7d150fa1e8686eb294) removes TOK_LOCAL_DIR altogether. Can someone elaborate why that is?]