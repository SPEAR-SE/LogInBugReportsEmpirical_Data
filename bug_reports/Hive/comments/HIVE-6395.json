[Attaching review board for review.

[~navis] can you also review too , as you had done some fixes for ppd optimizer., Actually, I just saw your fix for HIVE-4293, is it a more complete fix for the same situation ?, [~szehon] The patch looks good to me. However, just one thing to consider: your patch would make PPD off in the given case, which has performance implications. However, if we push down ( state == 1 || state == 2 ) in the test case while keeping the filter at the filter, wouldn't that work? However, I'm not sure if this is possible or have covets. What you think?, I think HIVE-4293 indeed fixes this and is more complete. [~rhbutani] / [~navis] Can you verify ?, Thanks Xuefu, its not possible unless I'm misunderstanding the question, the entire FilterOp is pushed down, the predicate is just a part of it.  Navis's patch also seems to remove the candidate if its multi-insert case, as its not implemented yet in ppd.  (see OpProcFactory.getChildWalkerInfo).

Although I am curious why this is duplicated in HIVE-4293 which is about subquery + udtf, I wonder if its a part of the main fix, or just an additional fix that got added?, {quote}
Although I am curious why this is duplicated in HIVE-4293 which is about subquery + udtf, I wonder if its a part of the main fix, or just an additional fix that got added?
{quote}

I didn't read the patch in HIVE-4293, but from Hive's perspective, UDTF is very similar to TRANSFORM() except that the former is is done via UDTF's java code, and the later in external script via streaming. For this reason, the problem here might be a sub-problem of HIVE-4293. This is just my guess., Tested the test case in patch on trunk which now has HIVE-4293. It now passes. Feel free to reopen if you can still repro in some other form.]