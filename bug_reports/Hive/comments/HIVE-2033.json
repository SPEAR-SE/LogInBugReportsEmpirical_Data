[Preliminary patch. Test cases being added., Do you want close this in favor of HIVE-1537?, Addressing it as part of HIVE-1537.]