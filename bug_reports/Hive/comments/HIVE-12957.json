[According to [~sseth]:

2016-01-27 15:31:48,132 [INFO] [AMRM Callback Handler Thread] |rm.YarnTaskSchedulerService|: App total resource memory: -3168 cpu: 13 taskAllocations: 0
YARN is reporting available memory as -3168 - This causes the numSplits calculation to go wrong.
This looks to be a bug in the FairScheduler
HiveSplitGenerator (and a part of Tez which is not involved here) should be a little more defensive - and check for such negative values and normalizing to 0, or throwing a more usable error.
I don't think there's any simple workaround here., Add logic to avoid passing negative numSplits values to getSplits(), I don't think it's a good idea to hide the underlying issue. Rather we should throw a meaningful error if available slots are returned as negative number., Throwing a meaningful error would be ideal. However, a negative values comes directly from the YARN scheduler. In the past, getting certain parameters like headroom right on the YARN schedulers has required multiple iterations - and may still have corner cases which have not been explored. If a value like this comes in - we'd end up in a situation where jobs would fail randomly - until the issue is fixed by YARN.
Also, given that the number of splits is determined by available capacity - there's other cases where we ask for a single split - e.g. when the cluster is fully occupied and available capacity is 0. That scenario is almost as bad.
Requesting 1 split from FileInputFormat does not mean it returns only 1 split - it would still return 1 split per block.

The biggest problem with masking this is that we will not be able to report these issues so that they eventually get fixed., Cancelling patch based on comments, Patch v2 - throw error for negative memory values from scheduler., 

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12785238/HIVE-12957.2.patch

{color:red}ERROR:{color} -1 due to no test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 5 failed/errored test(s), 10033 tests executed
*Failed tests:*
{noformat}
TestMiniTezCliDriver-update_orig_table.q-mapreduce2.q-load_dyn_part3.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ivyDownload
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hive.jdbc.TestSSL.testSSLVersion
org.apache.hive.service.cli.TestEmbeddedThriftBinaryCLIService.testExecuteStatementAsync
{noformat}

Test results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6837/testReport
Console output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6837/console
Test logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6837/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12785238 - PreCommit-HIVE-TRUNK-Build]