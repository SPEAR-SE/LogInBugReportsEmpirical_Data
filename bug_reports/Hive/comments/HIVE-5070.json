[This is the intended implementation of listLocatedStatus() method. 

However, I think we need to put ProxyFileSystem into specific shim folder - 0.20, 0.20S and 0.23. And only ProxyFileSystem in 0.23 folder should implement the new method.

Waiting for more experienced Hive developer to give advice., V2 of the patch uploaded. To minimize code replication, I created ProxyFileSystemBase class where all the 0.20, 0.20S and 0.23 shims reuse where 0.23 shim override the listLocatedStatus() method., [~shanyu] If the patch is ready, can you please make it patch available and upload the patch to reviewboard or phabricator for review ?, So it looks like ProxyFileSystem is used by ProxyLocalFileSystem:

<code>
    fs = new ProxyFileSystem(localFs, URI.create(proxyUriString));
</code>

Given that ProxyFileSystem in this case can be one of 3 different implementations (20/20S/23), should we be using a Shim to get the appropriate ProxyFileSystem implementation?, [~jdere]Thanks a lot for your suggestion! This is a good idea. I will modify the patch to use a shim to get appropriate ProxyFileSystem implementation., Upload patch v3 that uses a shim to get ProxyFileSystem. , Just looking at this a bit closer, and it appears that listLocatedStatus() was added in hadoop-0.22.0.  It's only hadoop-2.1.1 that MapReduce has been using this method which is breaking the unit tests.  So really I think it would be ok for this method to be overridden in 20/20S/23 - I think the original patch v1 should be sufficient, sorry for the extra work Shanyu! Does anyone else agree that the v1 patch should be fine to fix this issue, without having to resort to a new shim method?, Spoke too soon, apparently this may not work for 20, so the shims approach should be fine. , Thanks for the review [~jdere]. 
+1 LGTM. 
I will also try building against different mr.rev versions.
, Uploading HIVE-5070-v3.patch with name that works with the precommit test format - HIVE-5070.3.patch.
pre commit test doc - https://cwiki.apache.org/confluence/display/Hive/Hive+PreCommit+Patch+Testing , The patch does not apply on trunk anymore. Shanyu, can you please rebase on latest trunk and upload the new patch ?
, This is a v4 of the patch rebased on trunk., Re-uploading v4 with the correct name., 

{color:green}Overall{color}: +1 all checks pass

Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12609000/HIVE-5070.4.patch

{color:green}SUCCESS:{color} +1 4427 tests passed

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/1167/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/1167/console

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
{noformat}

This message is automatically generated., +1, Thank you for the contribution shanyu! I have committed this to trunk!, FAILURE: Integrated in Hive-trunk-hadoop2-ptest #146 (See [https://builds.apache.org/job/Hive-trunk-hadoop2-ptest/146/])
HIVE-5070 - Implement listLocatedStatus() in ProxyFileSystem for 0.23 shim (shanyu zhao via Brock Noland) (brock: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1534240)
* /hive/trunk/shims/src/0.20/java/org/apache/hadoop/hive/shims/Hadoop20Shims.java
* /hive/trunk/shims/src/0.20S/java/org/apache/hadoop/hive/shims/Hadoop20SShims.java
* /hive/trunk/shims/src/0.23/java/org/apache/hadoop/hive/shims/Hadoop23Shims.java
* /hive/trunk/shims/src/common-secure/java/org/apache/hadoop/hive/shims/HadoopShimsSecure.java
* /hive/trunk/shims/src/common/java/org/apache/hadoop/fs/ProxyFileSystem.java
* /hive/trunk/shims/src/common/java/org/apache/hadoop/fs/ProxyLocalFileSystem.java
* /hive/trunk/shims/src/common/java/org/apache/hadoop/hive/shims/HadoopShims.java
, FAILURE: Integrated in Hive-trunk-h0.21 #2412 (See [https://builds.apache.org/job/Hive-trunk-h0.21/2412/])
HIVE-5070 - Implement listLocatedStatus() in ProxyFileSystem for 0.23 shim (shanyu zhao via Brock Noland) (brock: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1534240)
* /hive/trunk/shims/src/0.20/java/org/apache/hadoop/hive/shims/Hadoop20Shims.java
* /hive/trunk/shims/src/0.20S/java/org/apache/hadoop/hive/shims/Hadoop20SShims.java
* /hive/trunk/shims/src/0.23/java/org/apache/hadoop/hive/shims/Hadoop23Shims.java
* /hive/trunk/shims/src/common-secure/java/org/apache/hadoop/hive/shims/HadoopShimsSecure.java
* /hive/trunk/shims/src/common/java/org/apache/hadoop/fs/ProxyFileSystem.java
* /hive/trunk/shims/src/common/java/org/apache/hadoop/fs/ProxyLocalFileSystem.java
* /hive/trunk/shims/src/common/java/org/apache/hadoop/hive/shims/HadoopShims.java
, FAILURE: Integrated in Hive-trunk-hadoop1-ptest #209 (See [https://builds.apache.org/job/Hive-trunk-hadoop1-ptest/209/])
HIVE-5070 - Implement listLocatedStatus() in ProxyFileSystem for 0.23 shim (shanyu zhao via Brock Noland) (brock: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1534240)
* /hive/trunk/shims/src/0.20/java/org/apache/hadoop/hive/shims/Hadoop20Shims.java
* /hive/trunk/shims/src/0.20S/java/org/apache/hadoop/hive/shims/Hadoop20SShims.java
* /hive/trunk/shims/src/0.23/java/org/apache/hadoop/hive/shims/Hadoop23Shims.java
* /hive/trunk/shims/src/common-secure/java/org/apache/hadoop/hive/shims/HadoopShimsSecure.java
* /hive/trunk/shims/src/common/java/org/apache/hadoop/fs/ProxyFileSystem.java
* /hive/trunk/shims/src/common/java/org/apache/hadoop/fs/ProxyLocalFileSystem.java
* /hive/trunk/shims/src/common/java/org/apache/hadoop/hive/shims/HadoopShims.java
, ABORTED: Integrated in Hive-trunk-hadoop2 #515 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/515/])
HIVE-5070 - Implement listLocatedStatus() in ProxyFileSystem for 0.23 shim (shanyu zhao via Brock Noland) (brock: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1534240)
* /hive/trunk/shims/src/0.20/java/org/apache/hadoop/hive/shims/Hadoop20Shims.java
* /hive/trunk/shims/src/0.20S/java/org/apache/hadoop/hive/shims/Hadoop20SShims.java
* /hive/trunk/shims/src/0.23/java/org/apache/hadoop/hive/shims/Hadoop23Shims.java
* /hive/trunk/shims/src/common-secure/java/org/apache/hadoop/hive/shims/HadoopShimsSecure.java
* /hive/trunk/shims/src/common/java/org/apache/hadoop/fs/ProxyFileSystem.java
* /hive/trunk/shims/src/common/java/org/apache/hadoop/fs/ProxyLocalFileSystem.java
* /hive/trunk/shims/src/common/java/org/apache/hadoop/hive/shims/HadoopShims.java
]