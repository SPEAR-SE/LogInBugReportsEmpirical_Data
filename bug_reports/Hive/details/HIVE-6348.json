{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12692632","self":"https://issues.apache.org/jira/rest/api/2/issue/12692632","key":"HIVE-6348","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12340268","id":"12340268","name":"3.0.0","archived":false,"released":true,"releaseDate":"2018-05-21"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-05-31T12:01:17.560+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue May 22 23:58:07 UTC 2018","customfield_12310420":"371227","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_105008501775_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_2581661639","customfield_12312321":null,"resolutiondate":"2017-06-30T08:09:30.417+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-6348/watchers","watchCount":7,"isWatching":false},"created":"2014-02-01T02:00:07.123+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":["sub-query"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-05-22T23:58:07.449+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"select * from (select * from foo order by c asc) bar order by c desc;\n\nin hive sorts the data set twice. The optimizer should probably remove any order by/sort by in the sub query unless you use 'limit '. Could even go so far as barring it at the semantic level.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12870560","id":"12870560","filename":"HIVE-6348.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-05-31T11:00:06.809+0000","size":3014,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12870560/HIVE-6348.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12870969","id":"12870969","filename":"HIVE-6348.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-02T11:22:38.233+0000","size":3427,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12870969/HIVE-6348.2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12872025","id":"12872025","filename":"HIVE-6348.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-08T08:43:09.289+0000","size":3784,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12872025/HIVE-6348.3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12874638","id":"12874638","filename":"HIVE-6348.4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-27T08:00:28.904+0000","size":520667,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12874638/HIVE-6348.4.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"371530","customfield_12312823":null,"summary":"Order by/Sort by in subquery","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16031049","id":"16031049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12870560/HIVE-6348.1.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 134 failed/errored test(s), 10804 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_join0] (batchId=82)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_join15] (batchId=15)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_join20] (batchId=83)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_join31] (batchId=42)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cbo_rp_auto_join0] (batchId=15)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cbo_rp_union] (batchId=5)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cbo_rp_windowing] (batchId=37)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cbo_union] (batchId=72)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cbo_windowing] (batchId=51)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[concat_op] (batchId=70)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[correlationoptimizer14] (batchId=33)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[decimal_3] (batchId=25)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[dynamic_rdd_cache] (batchId=51)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[groupby_distinct_samekey] (batchId=54)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[groupby_grouping_sets_grouping] (batchId=3)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[identity_project_remove_skip] (batchId=47)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input20] (batchId=12)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input33] (batchId=57)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input3_limit] (batchId=60)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[limit_pushdown_negative] (batchId=38)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[list_bucket_dml_8] (batchId=68)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[macro_duplicate] (batchId=38)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[mapreduce2] (batchId=22)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[mergejoin] (batchId=56)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[multi_insert_gby2] (batchId=37)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[multi_insert_gby3] (batchId=71)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[orc_ppd_schema_evol_2b] (batchId=14)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[order_by_expr_1] (batchId=65)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[order_by_expr_2] (batchId=62)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[partcols1] (batchId=60)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[partition_date] (batchId=14)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[partition_timestamp] (batchId=34)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[partition_varchar1] (batchId=62)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[pcr] (batchId=57)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[pointlookup2] (batchId=77)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[pointlookup3] (batchId=6)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ppd2] (batchId=25)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ppd_join4] (batchId=54)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ppd_udf_case] (batchId=41)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[reducesink_dedup] (batchId=22)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[rename_external_partition_location] (batchId=46)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[truncate_column] (batchId=78)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[truncate_column_buckets] (batchId=24)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_paren] (batchId=45)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_data_types] (batchId=72)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_decimal_3] (batchId=19)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_decimal_round] (batchId=34)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_decimal_round_2] (batchId=22)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_groupby_reduce] (batchId=53)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_interval_1] (batchId=15)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_non_string_partition] (batchId=32)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_tablesample_rows] (batchId=49)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vectorization_12] (batchId=10)\norg.apache.hadoop.hive.cli.TestContribCliDriver.testCliDriver[udf_row_sequence] (batchId=231)\norg.apache.hadoop.hive.cli.TestContribNegativeCliDriver.testCliDriver[invalid_row_sequence] (batchId=234)\norg.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[mapreduce2] (batchId=140)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[auto_join0] (batchId=161)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[auto_join30] (batchId=149)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[cbo_gby] (batchId=152)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[cbo_rp_gby] (batchId=156)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[cbo_rp_semijoin] (batchId=145)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[cbo_semijoin] (batchId=151)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[cbo_subq_not_in] (batchId=154)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[cbo_udf_udaf] (batchId=144)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[cbo_union] (batchId=158)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[cbo_windowing] (batchId=154)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[explainuser_1] (batchId=151)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[identity_project_remove_skip] (batchId=154)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[leftsemijoin_mr] (batchId=146)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[mergejoin] (batchId=155)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[mrr] (batchId=146)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[multi_column_in] (batchId=147)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[multi_column_in_single] (batchId=145)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[orc_ppd_schema_evol_2b] (batchId=146)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[ppr_pushdown] (batchId=152)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[reduce_deduplicate_extended] (batchId=156)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[special_character_in_tabnames_1] (batchId=153)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[subquery_in] (batchId=156)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[subquery_notin] (batchId=157)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[subquery_scalar] (batchId=152)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[tez_join] (batchId=151)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[tez_join_tests] (batchId=159)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[tez_joins_explain] (batchId=151)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[tez_schema_evolution] (batchId=160)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[tez_smb_1] (batchId=158)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[tez_smb_main] (batchId=149)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_data_types] (batchId=158)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_decimal_3] (batchId=147)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_decimal_round] (batchId=151)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_decimal_round_2] (batchId=148)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_groupby_grouping_sets_grouping] (batchId=145)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_groupby_reduce] (batchId=155)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=145)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_interval_1] (batchId=146)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_join30] (batchId=150)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_number_compare_projection] (batchId=145)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vectorization_12] (batchId=145)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[leftsemijoin_mr] (batchId=167)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[truncate_column_buckets] (batchId=167)\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[vector_non_string_partition] (batchId=98)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=232)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=232)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query39] (batchId=232)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query64] (batchId=232)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query91] (batchId=232)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query98] (batchId=232)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join0] (batchId=137)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join15] (batchId=107)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join20] (batchId=138)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join30] (batchId=113)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join31] (batchId=119)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[cbo_gby] (batchId=119)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[cbo_semijoin] (batchId=116)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[cbo_subq_not_in] (batchId=121)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[cbo_udf_udaf] (batchId=101)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[cbo_union] (batchId=133)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[dynamic_rdd_cache] (batchId=123)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[identity_project_remove_skip] (batchId=121)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[leftsemijoin_mr] (batchId=107)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[mapreduce2] (batchId=110)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[multi_insert_gby2] (batchId=116)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[multi_insert_gby3] (batchId=132)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[pcr] (batchId=125)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[subquery_in] (batchId=127)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[tez_join_tests] (batchId=135)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[tez_joins_explain] (batchId=116)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[vector_data_types] (batchId=133)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[vectorization_12] (batchId=104)\norg.apache.hadoop.hive.ql.TestTxnCommands2.testOrcNoPPD (batchId=268)\norg.apache.hadoop.hive.ql.TestTxnCommands2.testOrcPPD (batchId=268)\norg.apache.hadoop.hive.ql.TestTxnCommands2WithSplitUpdate.testOrcNoPPD (batchId=280)\norg.apache.hadoop.hive.ql.TestTxnCommands2WithSplitUpdate.testOrcPPD (batchId=280)\norg.apache.hadoop.hive.ql.TestTxnCommands2WithSplitUpdateAndVectorization.testOrcNoPPD (batchId=277)\norg.apache.hadoop.hive.ql.TestTxnCommands2WithSplitUpdateAndVectorization.testOrcPPD (batchId=277)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/5488/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/5488/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-5488/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 134 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12870560 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-05-31T12:01:17.560+0000","updated":"2017-05-31T12:01:17.560+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16034529","id":"16034529","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"Fix some tests in v2 patch.\nThe plan is to disallow order/sort by w/o limit in sub query in semantic level. We somehow have lots of such queries in qtest, and so they need to be updated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-02T11:26:13.664+0000","updated":"2017-06-02T11:26:13.664+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16034637","id":"16034637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12870969/HIVE-6348.2.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 68 failed/errored test(s), 10813 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_join0] (batchId=82)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_join15] (batchId=15)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_join20] (batchId=83)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_join31] (batchId=42)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cbo_rp_auto_join0] (batchId=15)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cbo_rp_windowing] (batchId=37)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cbo_windowing] (batchId=51)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[concat_op] (batchId=70)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[correlationoptimizer14] (batchId=33)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[dynamic_rdd_cache] (batchId=51)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[groupby_distinct_samekey] (batchId=54)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[identity_project_remove_skip] (batchId=47)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input20] (batchId=12)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input33] (batchId=57)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input3_limit] (batchId=60)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[limit_pushdown_negative] (batchId=38)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[mapreduce2] (batchId=22)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[multi_insert_gby2] (batchId=37)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[multi_insert_gby3] (batchId=71)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[partcols1] (batchId=60)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ppd2] (batchId=25)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ppd_join4] (batchId=54)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[reducesink_dedup] (batchId=22)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[truncate_column_buckets] (batchId=24)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_data_types] (batchId=72)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_tablesample_rows] (batchId=49)\norg.apache.hadoop.hive.cli.TestContribCliDriver.testCliDriver[udf_row_sequence] (batchId=231)\norg.apache.hadoop.hive.cli.TestContribNegativeCliDriver.testCliDriver[invalid_row_sequence] (batchId=234)\norg.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[mapreduce2] (batchId=140)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[auto_join0] (batchId=161)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[auto_join30] (batchId=149)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[cbo_gby] (batchId=152)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[cbo_rp_gby] (batchId=156)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[cbo_rp_semijoin] (batchId=145)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[cbo_semijoin] (batchId=151)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[cbo_windowing] (batchId=154)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[explainuser_1] (batchId=151)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[identity_project_remove_skip] (batchId=154)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[leftsemijoin_mr] (batchId=146)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[mrr] (batchId=146)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[multi_column_in] (batchId=147)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[multi_column_in_single] (batchId=145)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[reduce_deduplicate_extended] (batchId=156)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[special_character_in_tabnames_1] (batchId=153)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[tez_join_tests] (batchId=159)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[tez_joins_explain] (batchId=151)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_data_types] (batchId=158)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_join30] (batchId=150)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_number_compare_projection] (batchId=145)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[leftsemijoin_mr] (batchId=167)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[truncate_column_buckets] (batchId=167)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=232)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join0] (batchId=137)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join15] (batchId=107)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join20] (batchId=138)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join30] (batchId=113)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join31] (batchId=119)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[cbo_gby] (batchId=119)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[cbo_semijoin] (batchId=116)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[dynamic_rdd_cache] (batchId=123)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[identity_project_remove_skip] (batchId=121)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[leftsemijoin_mr] (batchId=107)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[mapreduce2] (batchId=110)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[multi_insert_gby2] (batchId=116)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[multi_insert_gby3] (batchId=132)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[tez_join_tests] (batchId=135)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[tez_joins_explain] (batchId=116)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[vector_data_types] (batchId=133)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/5516/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/5516/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-5516/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 68 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12870969 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-06-02T12:58:39.827+0000","updated":"2017-06-02T12:58:39.827+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16036612","id":"16036612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"The latest failures are due to the sub-query order/sort by in our tests. I'd like to get some feedbacks before updating them.\ncc [~hagleitn], [~ashutoshc], [~xuefuz]. Do you think the proposal makes sense?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-05T06:58:21.745+0000","updated":"2017-06-05T06:58:21.745+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16037185","id":"16037185","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm wondering if it makes more sense to optimize the query rather than banning it. While it might be dumb and inefficient, I don't quite see anything wrong in semantics.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-05T16:38:00.463+0000","updated":"2017-06-05T16:38:00.463+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16037241","id":"16037241","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Indeed optimizing away inner query sort (without limit) is much more user friendly then throwing up exception.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-05T17:21:12.165+0000","updated":"2017-06-05T17:21:12.165+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16037261","id":"16037261","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"body":"I agree with [~ashutoshc] and [~xuefuz]. If we do insist on letting users know about order by/sort by IMHO showing a warning and then proceeding with the query or optimizing to remove order by would be better.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-05T17:39:40.165+0000","updated":"2017-06-05T17:39:40.165+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16037458","id":"16037458","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cartershanklin","name":"cartershanklin","key":"cartershanklin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carter Shanklin","active":true,"timeZone":"America/Chicago"},"body":"I don't think banning is a good idea, there's just no way to know what will break in user's environments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cartershanklin","name":"cartershanklin","key":"cartershanklin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carter Shanklin","active":true,"timeZone":"America/Chicago"},"created":"2017-06-05T19:44:57.163+0000","updated":"2017-06-05T19:44:57.163+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16037930","id":"16037930","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks guys for the suggestions. Yeah I agree ignoring such order/sort by is better. Do you think I can just remove it from the AST?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-06T01:07:50.993+0000","updated":"2017-06-06T01:07:50.993+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16037986","id":"16037986","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lirui], I think it's better to remove it from operator tree and the optimization can be put as one of the optimization rules.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-06T02:01:05.626+0000","updated":"2017-06-06T02:01:05.626+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16038237","id":"16038237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"body":"I think it's better to remove it in AST or during logical plan generation. Because once HiveSubqueryRemoveRule is executed, which is the very first rule, subquery will be rewritten into join and there is no way to figure out if original query had a subquery.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-06T05:54:41.132+0000","updated":"2017-06-06T05:54:41.132+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16040710","id":"16040710","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi [~xuefuz], [~vgarg], I also think it's easier to do this in AST. Once we have the OP tree, I'm not sure how to tell whether an order by belongs to sub queries. Besides, I also noted CBO may introduce synthetic sub queries. So I'll write a patch to do it in AST.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-07T11:09:32.873+0000","updated":"2017-06-07T11:09:32.873+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16041187","id":"16041187","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Sounds good, [~lirui], [~vgarg]. As this is an optimization, I thought it can be put together with all these optimization rules. As to HiveSubqueryRemoveRule, removing order-by can be done right before that. Nevertheless, whatever makes it easy to implement.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-07T16:39:28.866+0000","updated":"2017-06-07T16:39:28.866+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16041275","id":"16041275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"I am not sure doing it on AST is better (or easier). AST is not amenable to traverse nor does it contain semantic info. Easier (and correct) way IMO would be to write a rule on calcite operator tree which matches on HiveSort followed by HiveSort check there is no limit in that sort and than removes that HiveSort from tree. \nSubQueryRemove rule will remove subqueries from tree by than, but I dont think that will matter. Essentially, on an operator tree you are looking for redundant Sort operators.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-07T17:38:40.319+0000","updated":"2017-06-07T17:38:40.319+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16042415","id":"16042415","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi [~ashutoshc], I didn't put it in calcite because it won't work if CBO is disabled.\nMy plan is to do it after we've done {{genResolvedParseTree}} on the AST, at which point parse info of each QB is generated. To remove the order by, we can simply remove the corresponding AST node. I feel it more complicated to do it in operator tree, e.g. we have to detect sorting RS in sub queries, and after the RS is removed (actually that's probably not the only OP that needs be removed), we may also have to do some modifications to upstream/downstream operators.\nUpload patch v3 for test and demonstrate my idea.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-08T08:42:41.091+0000","updated":"2017-06-08T08:42:41.091+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16043226","id":"16043226","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12872025/HIVE-6348.3.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 48 failed/errored test(s), 10820 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[insert_overwrite_local_directory_1] (batchId=237)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_join0] (batchId=83)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_join15] (batchId=15)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_join20] (batchId=83)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_join31] (batchId=42)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cbo_rp_auto_join0] (batchId=15)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[concat_op] (batchId=70)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[correlationoptimizer14] (batchId=33)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[dynamic_rdd_cache] (batchId=51)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[groupby_distinct_samekey] (batchId=54)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[identity_project_remove_skip] (batchId=47)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input20] (batchId=12)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input33] (batchId=57)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input3_limit] (batchId=60)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[limit_pushdown_negative] (batchId=38)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[multi_insert_gby2] (batchId=37)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[multi_insert_gby3] (batchId=71)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ppd2] (batchId=25)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ppd_join4] (batchId=54)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[truncate_column_buckets] (batchId=24)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_tablesample_rows] (batchId=49)\norg.apache.hadoop.hive.cli.TestContribCliDriver.testCliDriver[udf_row_sequence] (batchId=231)\norg.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[orc_ppd_basic] (batchId=140)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[auto_join0] (batchId=161)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[auto_join30] (batchId=149)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[explainuser_1] (batchId=151)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[identity_project_remove_skip] (batchId=154)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[mrr] (batchId=146)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[reduce_deduplicate_extended] (batchId=156)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[tez_join_tests] (batchId=159)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[tez_joins_explain] (batchId=151)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=145)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_join30] (batchId=150)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_number_compare_projection] (batchId=145)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[truncate_column_buckets] (batchId=167)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=232)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query78] (batchId=232)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join0] (batchId=137)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join15] (batchId=107)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join20] (batchId=138)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join30] (batchId=113)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join31] (batchId=119)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[dynamic_rdd_cache] (batchId=123)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[identity_project_remove_skip] (batchId=121)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[multi_insert_gby2] (batchId=116)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[multi_insert_gby3] (batchId=132)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[tez_join_tests] (batchId=135)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[tez_joins_explain] (batchId=116)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/5583/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/5583/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-5583/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 48 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12872025 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-06-08T18:46:39.456+0000","updated":"2017-06-08T18:46:39.456+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16046080","id":"16046080","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"body":"[~ashutoshc] Plan generated after subquery remove rule/de-correlation doesn't generate HiveSortLimit on HiveSortLimit e.g. for query {code:sql} select * from part where p_size IN (select p_size from part p where p.p_type <> part.p_name order by p_size) {code} plan just after decorrelation looks like\n{code:sql}\nHiveProject(p_partkey=[$0], p_name=[$1], p_mfgr=[$2], p_brand=[$3], p_type=[$4], p_size=[$5], p_container=[$6], p_retailprice=[$7], p_comment=[$8])\n  HiveProject(p_partkey=[$0], p_name=[$1], p_mfgr=[$2], p_brand=[$3], p_type=[$4], p_size=[$5], p_container=[$6], p_retailprice=[$7], p_comment=[$8], BLOCK__OFFSET__INSIDE__FILE=[$9], INPUT__FILE__NAME=[$10], ROW__ID=[$11])\n    LogicalJoin(condition=[AND(<>($1, $13), =($5, $12))], joinType=[inner])\n      HiveTableScan(table=[[default.part]], table:alias=[part])\n      HiveAggregate(group=[{0, 1}])\n        HiveProject(p_size=[$0], p_type0=[$1])\n          HiveProject(p_size=[$0], p_type0=[$13])\n            HiveSortLimit(sort0=[$0], dir0=[ASC-nulls-first])\n              HiveProject(p_size=[$5], p_partkey=[$0], p_name=[$1], p_mfgr=[$2], p_brand=[$3], p_type=[$4], p_size1=[$5], p_container=[$6], p_retailprice=[$7], p_comment=[$8], block__offset__inside__file=[$9], input__file__name=[$10], row__id=[$11], p_type0=[$4])\n                LogicalFilter(condition=[IS NOT NULL($4)])\n                  HiveTableScan(table=[[default.part]], table:alias=[p])\n{code}\nSo you have one sort limit on right side of join.  One possible rule could be if top project doesn't project any column/expression from right side then remove HiveSortLimit from right side of join.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-11T19:45:19.603+0000","updated":"2017-06-11T19:45:19.603+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16046081","id":"16046081","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lirui] Latest patch looks fine. Can you add tests?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-11T19:46:37.151+0000","updated":"2017-06-11T19:46:37.151+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16046396","id":"16046396","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi [~vgarg], it turns out we do need the sub query being sorted in some cases. An example is input20.q:\n{code}\nEXPLAIN\nFROM (\n  FROM src\n  MAP src.key, src.key \n  USING 'cat'\n  DISTRIBUTE BY key\n  SORT BY key, value\n) tmap\nINSERT OVERWRITE TABLE dest1\nREDUCE tmap.key, tmap.value\nUSING 'python input20_script.py'\nAS key, value;\n{code}\nThe query plan is:\n{noformat}\n  Stage: Stage-1\n    Map Reduce\n      Map Operator Tree:\n          TableScan\n            alias: src\n            Statistics: Num rows: 500 Data size: 5312 Basic stats: COMPLETE Column stats: NONE\n            Select Operator\n              expressions: key (type: string), key (type: string)\n              outputColumnNames: _col0, _col1\n              Statistics: Num rows: 500 Data size: 5312 Basic stats: COMPLETE Column stats: NONE\n              Transform Operator\n                command: cat\n                output info:\n                    input format: org.apache.hadoop.mapred.TextInputFormat\n                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat\n                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe\n                Statistics: Num rows: 500 Data size: 5312 Basic stats: COMPLETE Column stats: NONE\n                Reduce Output Operator\n                  key expressions: _col0 (type: string), _col1 (type: string)\n                  sort order: ++\n                  Map-reduce partition columns: _col0 (type: string)\n                  Statistics: Num rows: 500 Data size: 5312 Basic stats: COMPLETE Column stats: NONE\n                  value expressions: _col0 (type: string), _col1 (type: string)\n      Reduce Operator Tree:\n        Select Operator\n          expressions: VALUE._col0 (type: string), VALUE._col1 (type: string)\n          outputColumnNames: _col0, _col1\n          Statistics: Num rows: 500 Data size: 5312 Basic stats: COMPLETE Column stats: NONE\n          Transform Operator\n            command: python input20_script.py\n            output info:\n                input format: org.apache.hadoop.mapred.TextInputFormat\n                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat\n                serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe\n            Statistics: Num rows: 500 Data size: 5312 Basic stats: COMPLETE Column stats: NONE\n            Select Operator\n              expressions: UDFToInteger(_col0) (type: int), _col1 (type: string)\n              outputColumnNames: _col0, _col1\n              Statistics: Num rows: 500 Data size: 5312 Basic stats: COMPLETE Column stats: NONE\n              File Output Operator\n                compressed: false\n                Statistics: Num rows: 500 Data size: 5312 Basic stats: COMPLETE Column stats: NONE\n                table:\n                    input format: org.apache.hadoop.mapred.TextInputFormat\n                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat\n                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe\n                    name: default.dest1\n{noformat}\nThe script {{input20_script.py}} counts the number of times each <Key, Value> appears and expects the input to be sorted. I'll consider how to handle such a case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-12T09:52:38.400+0000","updated":"2017-06-12T09:52:38.400+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16047217","id":"16047217","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Turns out we already have such rules. They are HiveSortRemoveRule and HiveSortMergeRule. First thing to verify is why they are not able to optimize trees in these case.\n[~lirui] CBO is now always enabled. It can only be turned off if user set config to false explicitly, but that is true for any other config in system. Even your patch adds a config, so if thats off, user won't get this optimization either.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-12T23:31:06.737+0000","updated":"2017-06-12T23:31:06.737+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16048697","id":"16048697","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"body":"{{HiveSortRemoveRule}} removes HiveSortLimit only if it is created by HiveSortJoinReduceRule \"If it is not created by HiveSortJoinReduceRule, we cannot remove it\" {{HiveSortMergeRule}} seems to merge two HiveSortLimit into one which isn't the case here. So I don't think there is any existing rule covering this case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-14T04:37:47.283+0000","updated":"2017-06-14T04:37:47.283+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16055603","id":"16055603","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi [~ashutoshc], [~vgarg], either doing this in CBO or not is OK to me. But I'm not sure how to handle cases like input20.q. Let's consider the following two queries:\nThe orderBy should be removed in this one:\n{code}\nfrom (select key from src order by key) tmap insert overwrite table dest select tmap.key;\n{code}\nWhile it shouldn't be removed in this one:\n{code}\nfrom (select key,value from src order by key,value) tmap insert overwrite table dest1 reduce tmap.key, tmap.value using 'python input20_script.py';\n{code}\nThe two queries have very similar ASTs. Any suggestions how can we distinguish them? Maybe we can skip the optimization in case of scripts and UDFs. Is it correct to expect a specific order from a sub query in the first place?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-20T11:21:13.013+0000","updated":"2017-06-20T11:21:13.013+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16056874","id":"16056874","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"I am not sure why can't order by removed in these cases. There is no contract that scripts and UDFs will see data in any particular order. So, its perfectly alright to remove sorts in such cases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-21T02:35:05.106+0000","updated":"2017-06-21T02:35:05.106+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16057207","id":"16057207","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"[~ashutoshc], do you mean it's OK to break cases like input20? If so, can we go with v3 patch? Currently CBO won't run if query contains scripts or sortBy clause.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-21T08:56:14.129+0000","updated":"2017-06-21T08:56:14.129+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16063234","id":"16063234","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"I don't think its 'breaking'  those cases. So, change should be ok.\n[~lirui] Seems like some of q.out files needs update. Can you please update those? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-26T15:12:01.683+0000","updated":"2017-06-26T15:12:01.683+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16064437","id":"16064437","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"Patch v4 updates the affected tests.\n# I modified {{input20_script.py}} so it doesn't expect ordered input and gives the same results.\n# I disabled the optimization in {{correlationoptimizer14.q}} and {{reduce_deduplicate_extended.q}}. Otherwise most of the test cases in these two qfiles become pointless.\n# For {{concat_op.q}}, I removed the collect_list UDF in output. Because the column order in the list is not guaranteed.\n\nOther golden files only have changes in query plan, not the results. Will add an RB for this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-27T08:09:27.632+0000","updated":"2017-06-27T08:09:27.632+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16065458","id":"16065458","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12874638/HIVE-6348.4.patch\n\n{color:green}SUCCESS:{color} +1 due to 9 test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 12 failed/errored test(s), 10848 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[join36] (batchId=82)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[tez_smb_main] (batchId=149)\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=99)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=232)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query16] (batchId=232)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query94] (batchId=232)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcrossInstances.testBootstrapFunctionReplication (batchId=216)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcrossInstances.testCreateFunctionIncrementalReplication (batchId=216)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcrossInstances.testCreateFunctionWithFunctionBinaryJarsOnHDFS (batchId=216)\norg.apache.hive.hcatalog.api.TestHCatClient.testPartitionRegistrationWithCustomSchema (batchId=177)\norg.apache.hive.hcatalog.api.TestHCatClient.testPartitionSpecRegistrationWithCustomSchema (batchId=177)\norg.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation (batchId=177)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/5790/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/5790/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-5790/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 12 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12874638 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-06-27T21:01:50.589+0000","updated":"2017-06-27T21:01:50.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16066223","id":"16066223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"Latest failures are not related. [~vgarg], [~ashutoshc] could you take a look? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-28T09:40:15.345+0000","updated":"2017-06-28T09:40:15.345+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16067345","id":"16067345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lirui] Your patch removes order by from queries such as {code:sql}select key from (select key from src order by key) sub limit 1{code} I don't think it is safe to remove order by in this case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-28T22:13:34.231+0000","updated":"2017-06-28T22:13:34.231+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16067348","id":"16067348","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"body":"{{udf_row_sequence.q}} test is another example where order by is removed for query {code:sql}select key, row_sequence() as r from (select key from src order by key) x order by r{code} which I don't think is correct since row_sequence() is fixed for a given key depending upon its order","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-28T22:15:26.233+0000","updated":"2017-06-28T22:15:26.233+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16067372","id":"16067372","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"body":"Looks like I am wrong. According to https://mariadb.com/kb/en/mariadb/why-is-order-by-in-a-from-subquery-ignored/  \nbq. A \"table\" (and subquery in the FROM clause too) is - according to the SQL standard - an unordered set of rows. Rows in a table (or in a subquery in the FROM clause) do not come in any specific order. That's why the optimizer can ignore the ORDER BY clause that you have specified. In fact, SQL standard does not even allow the ORDER BY clause to appear in this subquery","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-28T22:30:46.845+0000","updated":"2017-06-28T22:30:46.845+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16067427","id":"16067427","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 Looks good to me","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-28T23:10:37.880+0000","updated":"2017-06-28T23:10:37.880+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16067612","id":"16067612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks [~vgarg] for reviewing. Yeah I think it's in compliance with the standard, though may \"break\" assumptions of some UDFs.\nI'll commit it if other guys have no further comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-29T02:43:49.429+0000","updated":"2017-06-29T02:43:49.429+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16067709","id":"16067709","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cartershanklin","name":"cartershanklin","key":"cartershanklin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carter Shanklin","active":true,"timeZone":"America/Chicago"},"body":"It's trivia at this point but ORDER BY in subquery is allowed by optional feature F851 in the SQL standard, but there is no associated guarantee of ordering that goes with it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cartershanklin","name":"cartershanklin","key":"cartershanklin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carter Shanklin","active":true,"timeZone":"America/Chicago"},"created":"2017-06-29T04:21:07.504+0000","updated":"2017-06-29T04:21:07.504+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16067731","id":"16067731","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"body":"[~cartershanklin] Good to know (y)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-29T04:40:09.685+0000","updated":"2017-06-29T04:40:09.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16069672","id":"16069672","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"Pushed to master. Thanks guys for the review!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-30T08:09:30.512+0000","updated":"2017-06-30T08:09:30.512+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16071980","id":"16071980","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=leftylev","name":"leftylev","key":"lefty@hortonworks.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lefty%40hortonworks.com&avatarId=15906","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lefty%40hortonworks.com&avatarId=15906","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lefty%40hortonworks.com&avatarId=15906","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lefty%40hortonworks.com&avatarId=15906"},"displayName":"Lefty Leverenz","active":true,"timeZone":"America/New_York"},"body":"Doc note:  This adds *hive.remove.orderby.in.subquery* to HiveConf.java, so it needs to be documented in Configuration Properties.\n\n* [Configuration Properties -- Query Execution | https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-QueryandDDLExecution]\n\nDo we also need general documentation?  If so, should it go in the Subqueries doc or the SortBy doc?\n\n* [Subqueries | https://cwiki.apache.org/confluence/display/Hive/LanguageManual+SubQueries]\n* [Sort By / Order By / etc. | https://cwiki.apache.org/confluence/display/Hive/LanguageManual+SortBy]\n\nAdded a TODOC3.0 label.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=leftylev","name":"leftylev","key":"lefty@hortonworks.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lefty%40hortonworks.com&avatarId=15906","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lefty%40hortonworks.com&avatarId=15906","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lefty%40hortonworks.com&avatarId=15906","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lefty%40hortonworks.com&avatarId=15906"},"displayName":"Lefty Leverenz","active":true,"timeZone":"America/New_York"},"created":"2017-07-03T06:45:29.234+0000","updated":"2017-07-03T06:45:29.234+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16074180","id":"16074180","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks [~leftylev] for the doc note. I've updated the configuration properties and order/sort by docs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-07-05T02:38:35.293+0000","updated":"2017-07-05T02:38:35.293+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16078913","id":"16078913","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=leftylev","name":"leftylev","key":"lefty@hortonworks.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lefty%40hortonworks.com&avatarId=15906","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lefty%40hortonworks.com&avatarId=15906","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lefty%40hortonworks.com&avatarId=15906","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lefty%40hortonworks.com&avatarId=15906"},"displayName":"Lefty Leverenz","active":true,"timeZone":"America/New_York"},"body":"Thank you for the documentation, Rui Li.  I removed the TODOC3.0 label.\n\nHere are the doc links:\n\n* [Configuration Properties -- hive.remove.orderby.in.subquery | https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.remove.orderby.in.subquery]\n* [SortBy -- Syntax of Order By | https://cwiki.apache.org/confluence/display/Hive/LanguageManual+SortBy#LanguageManualSortBy-SyntaxofOrderBy]\n* [SortBy -- Syntax of Sort By | https://cwiki.apache.org/confluence/display/Hive/LanguageManual+SortBy#LanguageManualSortBy-SyntaxofSortBy]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=leftylev","name":"leftylev","key":"lefty@hortonworks.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lefty%40hortonworks.com&avatarId=15906","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lefty%40hortonworks.com&avatarId=15906","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lefty%40hortonworks.com&avatarId=15906","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lefty%40hortonworks.com&avatarId=15906"},"displayName":"Lefty Leverenz","active":true,"timeZone":"America/New_York"},"created":"2017-07-08T02:36:29.826+0000","updated":"2017-07-08T02:36:29.826+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12692632/comment/16485890","id":"16485890","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"body":"Hive 3.0.0 has been released so closing this jira.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-05-22T23:58:07.440+0000","updated":"2018-05-22T23:58:07.440+0000"}],"maxResults":40,"total":40,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-6348/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1rz8v:"}}