{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12638690","self":"https://issues.apache.org/jira/rest/api/2/issue/12638690","key":"HIVE-4223","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-03-27T08:18:03.930+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Sep 19 13:49:03 UTC 2013","customfield_12310420":"319165","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4223/watchers","watchCount":5,"isWatching":false},"created":"2013-03-23T23:25:35.680+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317742","id":"12317742","description":"released","name":"0.9.0","archived":false,"released":true,"releaseDate":"2012-04-30"}],"issuelinks":[{"id":"12375503","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12375503","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12669458","key":"HIVE-5320","self":"https://issues.apache.org/jira/rest/api/2/issue/12669458","fields":{"summary":"Querying a table with nested struct type over JSON data results in errors","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-09-19T13:49:53.996+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312585","id":"12312585","name":"Serializers/Deserializers","description":"Tracks issues dealing with serdes"}],"timeoriginalestimate":null,"description":"The LazySimpleSerDe will throw IndexOutOfBoundsException if the column structure is struct containing array of struct. \nI have a table with one column defined like this:\n\ncolumnA\narray <\n    struct<\n       col1:primiType,\n       col2:primiType,\n       col3:primiType,\n       col4:primiType,\n       col5:primiType,\n       col6:primiType,\n       col7:primiType,\n       col8:array<\n            struct<\n              col1:primiType,\n              col2::primiType,\n              col3::primiType,\n              col4:primiType,\n              col5:primiType,\n              col6:primiType,\n              col7:primiType,\n              col8:primiType,\n              col9:primiType\n            >\n       >\n    >\n>\n\nIn this example, the outside struct has 8 columns (including the array), and the inner struct has 9 columns. As long as the outside struct has LESS column count than the inner struct column count, I think we will get the following exception as stracktrace in LazeSimpleSerDe when it tries to serialize a row:\n\nCaused by: java.lang.IndexOutOfBoundsException: Index: 8, Size: 8\n        at java.util.ArrayList.RangeCheck(ArrayList.java:547)\n        at java.util.ArrayList.get(ArrayList.java:322)\n        at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.serialize(LazySimpleSerDe.java:485)\n        at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.serialize(LazySimpleSerDe.java:443)\n        at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.serializeField(LazySimpleSerDe.java:381)\n        at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.serialize(LazySimpleSerDe.java:365)\n        at org.apache.hadoop.hive.ql.exec.FileSinkOperator.processOp(FileSinkOperator.java:568)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:471)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:762)\n        at org.apache.hadoop.hive.ql.exec.SelectOperator.processOp(SelectOperator.java:84)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:471)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:762)\n        at org.apache.hadoop.hive.ql.exec.FilterOperator.processOp(FilterOperator.java:132)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:471)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:762)\n        at org.apache.hadoop.hive.ql.exec.TableScanOperator.processOp(TableScanOperator.java:83)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:471)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:762)\n        at org.apache.hadoop.hive.ql.exec.MapOperator.process(MapOperator.java:531)\n        ... 9 more\n\nI am not very sure about exactly the reason of this problem. I believe that the   public static void serialize(ByteStream.Output out, Object obj,ObjectInspector objInspector, byte[] separators, int level, Text nullSequence, boolean escaped, byte escapeChar, boolean[] needsEscape) is recursively invoking itself when facing nest structure. But for the nested struct structure, the list reference will mass up, and the size() will return wrong data.\n\nIn the above example case I faced, \nfor these 2 lines:\n\n      List<? extends StructField> fields = soi.getAllStructFieldRefs();\n      list = soi.getStructFieldsDataAsList(obj);\n\nmy StructObjectInspector(soi) will return the CORRECT data for getAllStructFieldRefs() and getStructFieldsDataAsList() methods. For example, for one row, for the outsider 8 columns struct, I have 2 elements in the inner array of struct, and each element will have 9 columns (as there are 9 columns in the inner struct). During runtime, after I added more logging in the LazySimpleSerDe, I will see the following behavior in the logging:\n\nfor 8 outside column, loop\n    for 9 inside columns, loop for serialize\n    for 9 inside columns, loop for serialize\ncode broken here, for the outside loop, it will try to access the 9th element,which not exist in the outside loop, as you will see the stracktrace as it tried to access location 8 of size 8 of list.\n\nWhat I did is to change the following line of code, it look like fixing this problem. But I don't know if it is the right way, but it did fix this problem, and I did it on hive 0.9.0 version of code:\n\n481c481,482\n<         for (int i = 0; i < list.size(); i++) {\n---\n>         int listSize = list.size();\n>         for (int i = 0; i < listSize; i++) {\n\nI believe the reason of this bug is that if the code did the current way like\n        for (int i = 0; i < list.size(); i++)\n\nthe method list.size() will be invoked for every loop. But in the nest structure, the list.size() will return different result during the recursive call, and that caused the problem I am currently facing.\n\nThanks\n\nYong Zhang\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12594842","id":"12594842","filename":"nest_struct.data","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ctang.ma","name":"ctang.ma","key":"ctang.ma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chaoyu Tang","active":true,"timeZone":"America/New_York"},"created":"2013-07-30T02:11:48.969+0000","size":949,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12594842/nest_struct.data"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"319506","customfield_12312823":null,"summary":"LazySimpleSerDe will throw IndexOutOfBoundsException in nested structs of hive table","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=java8964","name":"java8964","key":"java8964","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=java8964&avatarId=36461","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=java8964&avatarId=36461","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=java8964&avatarId=36461","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=java8964&avatarId=36461"},"displayName":"Yong Zhang","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=java8964","name":"java8964","key":"java8964","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=java8964&avatarId=36461","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=java8964&avatarId=36461","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=java8964&avatarId=36461","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=java8964&avatarId=36461"},"displayName":"Yong Zhang","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Hive 0.9.0","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12638690/comment/13615020","id":"13615020","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"Can I ask that the query which made above exception is using UDTF?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-03-27T08:18:03.930+0000","updated":"2013-03-27T08:18:03.930+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12638690/comment/13615173","id":"13615173","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=java8964","name":"java8964","key":"java8964","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=java8964&avatarId=36461","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=java8964&avatarId=36461","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=java8964&avatarId=36461","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=java8964&avatarId=36461"},"displayName":"Yong Zhang","active":true,"timeZone":"America/New_York"},"body":"This exception is not made in any UDTF.\n\nThe query to produce this problem is very simple in my case:\n\nselect nest_struct_column from table where ..... (In where criteria, I just need to add something to make the nest_struct_column where to have some data, to make the exception happened in LazySimpleSerDe). The table is built on my custom SerDe. I don't know why runtime the LazySimpleSerDe will be invoked, maybe to show the data? But if the column is a nested structure as I explained above, the LazySimpleSerDe will break. Thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=java8964","name":"java8964","key":"java8964","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=java8964&avatarId=36461","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=java8964&avatarId=36461","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=java8964&avatarId=36461","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=java8964&avatarId=36461"},"displayName":"Yong Zhang","active":true,"timeZone":"America/New_York"},"created":"2013-03-27T12:38:44.204+0000","updated":"2013-03-27T12:38:44.204+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12638690/comment/13616085","id":"13616085","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"< for (int i = 0; i < list.size(); i++) {\n—\n> int listSize = list.size();\n> for (int i = 0; i < listSize; i++) {\n\nIf this change fixed the problem, it means the list is changed in serialization process and lateral view is always a good candidate for doing such thing. I've used before similar query in hive-0.10.0 and it worked well. Could you try that?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-03-28T05:54:19.930+0000","updated":"2013-03-28T05:54:19.930+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12638690/comment/13628361","id":"13628361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rathboma","name":"rathboma","key":"rathboma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew Rathbone","active":true,"timeZone":"Etc/UTC"},"body":"I've just hit this issue myself when trying to query against a fairly complex schema.\n\nIs the solution above valid or are you concerned with the fact that the list is changed during serialization (is that abnormal)?\n\nIf you're not concerned it'd be great to get this into master so we can cherry-pick the bug-fix on our end.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rathboma","name":"rathboma","key":"rathboma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew Rathbone","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-10T22:24:23.997+0000","updated":"2013-04-10T22:24:23.997+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12638690/comment/13628418","id":"13628418","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=java8964","name":"java8964","key":"java8964","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=java8964&avatarId=36461","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=java8964&avatarId=36461","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=java8964&avatarId=36461","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=java8964&avatarId=36461"},"displayName":"Yong Zhang","active":true,"timeZone":"America/New_York"},"body":"I will debug more about this problem, right now I am busy with something, so didn't have time to dig into it yet.\n\nHere are some my comments:\n1) I look the code again and again. The list is a local variable, and I cannot understand how the reference will be changed in the recursive call, but it did happen in the log. I need to add more logging to find out why.\n2) If you can compile hive by yourself, you can apply the change I made above, to see if it fixes your problem.\n3) What I did to work around this problem is to add a fake column, make the inner/outer struct having same length elements.\n4) I will test in hive 0.10 later to see if it fixes this, but from the code, it doesn't look like.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=java8964","name":"java8964","key":"java8964","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=java8964&avatarId=36461","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=java8964&avatarId=36461","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=java8964&avatarId=36461","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=java8964&avatarId=36461"},"displayName":"Yong Zhang","active":true,"timeZone":"America/New_York"},"created":"2013-04-10T23:15:35.166+0000","updated":"2013-04-10T23:15:35.166+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12638690/comment/13723276","id":"13723276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ctang.ma","name":"ctang.ma","key":"ctang.ma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chaoyu Tang","active":true,"timeZone":"America/New_York"},"body":"[~java8964] I was not able to reproduce the said problem in hive-0.9.0 and wondering if it might be related to the data? Here is my test case;\n1. create table bcd (col1 array <struct<col1:string, col2:string, col3:string,col4:string,col5:string,col6:string,col7:string,col8:array<struct<col1:string,col2:string,col3:string,col4:string,col5:string,col6:string,col7:string,col8:string,col9:string>>>>) row format delimited fields terminated by '\\001' collection items terminated by '\\002' lines terminated by '\\n' stored as textfile;\n** should be same as you described\n2. load data local inpath '/root/nest_struct.data' overwrite into table bcd;\n** see attached nest_struct.data\n3. select col1 from bcd;\n** got:\n[{\"col1\":\"c1v\",\"col2\":\"c2v\",\"col3\":\"c3v\",\"col4\":\"c4v\",\"col5\":\"c5v\",\"col6\":\"c6v\",\"col7\":\"c7v\",\"col8\":[{\"col1\":\"c11v\",\"col2\":\"c22v\",\"col3\":\"c33v\",\"col4\":\"c44v\",\"col5\":\"c55v\",\"col6\":\"c66v\",\"col7\":\"c77v\",\"col8\":\"c88v\",\"col9\":\"c99v\"}]}]\n....\n\nDid you see anything different from your case?\nCould you please update your case and probably I can have a try.\n\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ctang.ma","name":"ctang.ma","key":"ctang.ma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chaoyu Tang","active":true,"timeZone":"America/New_York"},"created":"2013-07-30T02:10:41.985+0000","updated":"2013-07-30T02:10:41.985+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12638690/comment/13723281","id":"13723281","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ctang.ma","name":"ctang.ma","key":"ctang.ma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chaoyu Tang","active":true,"timeZone":"America/New_York"},"body":"data file to my test case -- chaoyu","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ctang.ma","name":"ctang.ma","key":"ctang.ma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chaoyu Tang","active":true,"timeZone":"America/New_York"},"created":"2013-07-30T02:11:48.972+0000","updated":"2013-07-30T02:11:48.972+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12638690/comment/13723303","id":"13723303","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ctang.ma","name":"ctang.ma","key":"ctang.ma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chaoyu Tang","active":true,"timeZone":"America/New_York"},"body":"The previous comments are not in right format, re-post:\n\nI was not able to reproduce the said problem in hive-0.9.0 and wondering if it might be related to the data? Here is my test case;\n1. create table bcd (col1 array <struct<col1:string, col2:string, col3:string,col4:string,col5:string,col6:string,col7:string,col8:array<struct<col1:string,col2:string,col3:string,col4:string,col5:string,col6:string,col7:string,col8:string,col9:string>>>>) row format delimited fields terminated by '\\001' collection items terminated by '\\002' lines terminated by '\\n' stored as textfile;\n-- same as the case described in this JIRA\n2. load data local inpath '/root/nest_struct.data' overwrite into table bcd;\n-- see attached nest_struct.data\n3. select col1 from bcd;\n-- got expected result\n{code}\n[{\"col1\":\"c1v\",\"col2\":\"c2v\",\"col3\":\"c3v\",\"col4\":\"c4v\",\"col5\":\"c5v\",\"col6\":\"c6v\",\"col7\":\"c7v\",\"col8\":[{\"col1\":\"c11v\",\"col2\":\"c22v\",\"col3\":\"c33v\",\"col4\":\"c44v\",\"col5\":\"c55v\",\"col6\":\"c66v\",\"col7\":\"c77v\",\"col8\":\"c88v\",\"col9\":\"c99v\"}]}]\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ctang.ma","name":"ctang.ma","key":"ctang.ma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chaoyu Tang","active":true,"timeZone":"America/New_York"},"created":"2013-07-30T02:31:17.842+0000","updated":"2013-07-30T02:31:17.842+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12638690/comment/13771904","id":"13771904","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ctang.ma","name":"ctang.ma","key":"ctang.ma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chaoyu Tang","active":true,"timeZone":"America/New_York"},"body":"I was able to reproduce the similar issue but with JsonSerDe 1.1.4 (json-serde-1.1.4.jar/json-serde-1.1.4-jar-dependencies.jar). See Hive-5320 for details\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ctang.ma","name":"ctang.ma","key":"ctang.ma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chaoyu Tang","active":true,"timeZone":"America/New_York"},"created":"2013-09-19T13:49:03.280+0000","updated":"2013-09-19T13:49:03.280+0000"}],"maxResults":9,"total":9,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4223/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1j2jr:"}}