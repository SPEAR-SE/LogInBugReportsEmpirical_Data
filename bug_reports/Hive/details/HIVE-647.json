{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12430706","self":"https://issues.apache.org/jira/rest/api/2/issue/12430706","key":"HIVE-647","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2009-07-16T22:58:53.740+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Jul 18 00:22:34 UTC 2009","customfield_12310420":"73386","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_90395940_*|*_5_*:*_2_*:*_1477699_*|*_4_*:*_1_*:*_6878495","customfield_12312321":null,"resolutiondate":"2009-07-18T00:22:34.204+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-647/watchers","watchCount":1,"isWatching":false},"created":"2009-07-16T20:56:42.070+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-07-27T15:09:24.324+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"For queries with GROUP BY and SORT BY, the sort is not handled properly when a LIMIT is not supplied. If I run the following two queries, the first returns properly sorted results. The second does not.\n\nSELECT user, SUM(numRequests) AS num FROM MyTable GROUP BY user SORT BY num DESC LIMIT 50;\nSELECT user, SUM(numRequests) AS num FROM MyTable GROUP BY user SORT BY num DESC;\n\nExplain is different for the two queries as well. The first uses 3 M/R jobs and the second only uses 2, which might be part of the problem.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"122432","customfield_12312823":null,"summary":"SORT BY with GROUP ignored without LIMIT","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=billgraham","name":"billgraham","key":"billgraham","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bill Graham","active":true,"timeZone":"Etc/GMT-8"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=billgraham","name":"billgraham","key":"billgraham","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bill Graham","active":true,"timeZone":"Etc/GMT-8"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12430706/comment/12732176","id":"12732176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=billgraham","name":"billgraham","key":"billgraham","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bill Graham","active":true,"timeZone":"Etc/GMT-8"},"body":"Note that the second query does sort properly if I explicitly set the number of reducers to 1 with the following command.\n\nset mapred.reduce.tasks=1; ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=billgraham","name":"billgraham","key":"billgraham","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bill Graham","active":true,"timeZone":"Etc/GMT-8"},"created":"2009-07-16T21:26:54.789+0000","updated":"2009-07-16T21:26:54.789+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12430706/comment/12732231","id":"12732231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"body":"Actually sort is supposed to be a local sort within a reduce instead of a global sort. It is usually used along with the distribute by to define the manner in which the keys are distributed to a reducer and sorted within a reducer.\n\nI believe that if you used order by instead of sort by we automatically select 1 reducer and do the sort.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-16T22:58:53.740+0000","updated":"2009-07-16T22:58:53.740+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12430706/comment/12732599","id":"12732599","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=billgraham","name":"billgraham","key":"billgraham","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bill Graham","active":true,"timeZone":"Etc/GMT-8"},"body":"ORDER BY also uses multiple reducers and returns unordered results. Using SORT BY (with or without DISTRIBUTE BY) returns N sets of ordered results, where N is the number of reducers. \n\nIt makes sense that sort by is only per-reducer. The fact that the presents or absence of a LIMIT clause changes the result set in ways other that number of records returned though, seemed like a bug to me.\n\nIt's an easy enough workaround though, so maybe this issue should be closed?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=billgraham","name":"billgraham","key":"billgraham","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bill Graham","active":true,"timeZone":"Etc/GMT-8"},"created":"2009-07-17T16:50:38.517+0000","updated":"2009-07-17T16:50:38.517+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12430706/comment/12732735","id":"12732735","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"order by should use only 1 reducer - if you see otherwise, can you update the jira\nsort behavior is as expected - you are not guaranteed that the first query returns sorted results, it just happens to be sorted, probably the first reducer had more than 50 records which were returned.\n\nif order by does work, you can close this jira.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-07-17T21:04:35.726+0000","updated":"2009-07-17T21:04:35.726+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12430706/comment/12732750","id":"12732750","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=billgraham","name":"billgraham","key":"billgraham","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bill Graham","active":true,"timeZone":"Etc/GMT-8"},"body":"Thanks for you explanation re the first LIMIT query, that makes sense.\n\nRe-verified that ORDER BY does not use only 1 reducer in my tests. \n\nSELECT user, SUM(numRequests) AS num FROM MyTable GROUP BY user ORDER BY num DESC;","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=billgraham","name":"billgraham","key":"billgraham","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bill Graham","active":true,"timeZone":"Etc/GMT-8"},"created":"2009-07-17T21:58:42.839+0000","updated":"2009-07-17T21:58:42.839+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12430706/comment/12732752","id":"12732752","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"Not a problem - behavior is as expected","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-07-17T22:03:17.989+0000","updated":"2009-07-17T22:03:17.989+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12430706/comment/12732756","id":"12732756","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"body":"I think what Bill is saying is that order by DOES NOT use 1 reducer in his tests. That seems to be a bug to me.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-17T22:15:21.039+0000","updated":"2009-07-17T22:15:21.039+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12430706/comment/12732775","id":"12732775","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"Are you sure - I just tried the same query and it works for me - are you using trunk ?\n\n\nAlso, can you look at the plan file and search for numReducers \n(the plan file for the second job)\n\nThe plan file can be found by: hive.exec.plan from the tracker","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-07-17T22:56:21.790+0000","updated":"2009-07-17T22:56:21.790+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12430706/comment/12732803","id":"12732803","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=billgraham","name":"billgraham","key":"billgraham","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bill Graham","active":true,"timeZone":"Etc/GMT-8"},"body":"I turns out was testing using Hive 0.3.0 actually. I upgraded to the trunk on both my hive client and my hive server, and sure enough saw only one reducer. Sorry for the false alarm. Closing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=billgraham","name":"billgraham","key":"billgraham","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bill Graham","active":true,"timeZone":"Etc/GMT-8"},"created":"2009-07-18T00:21:16.182+0000","updated":"2009-07-18T00:21:16.182+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12430706/comment/12732805","id":"12732805","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=billgraham","name":"billgraham","key":"billgraham","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bill Graham","active":true,"timeZone":"Etc/GMT-8"},"body":"Verified expected behavior using trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=billgraham","name":"billgraham","key":"billgraham","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bill Graham","active":true,"timeZone":"Etc/GMT-8"},"created":"2009-07-18T00:22:34.200+0000","updated":"2009-07-18T00:22:34.200+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-647/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0lazz:"}}