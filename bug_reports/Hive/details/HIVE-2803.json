{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12542283","self":"https://issues.apache.org/jira/rest/api/2/issue/12542283","key":"HIVE-2803","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320745","id":"12320745","description":"released","name":"0.10.0","archived":false,"released":true,"releaseDate":"2013-01-11"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-02-23T02:30:34.471+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jan 10 19:53:06 UTC 2013","customfield_12310420":"227570","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_5215802716_*|*_1_*:*_1_*:*_960192228_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-04-23T23:23:18.398+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-2803/watchers","watchCount":5,"isWatching":false},"created":"2012-02-12T11:50:03.628+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316178","id":"12316178","description":"released","name":"0.8.0","archived":false,"released":true,"releaseDate":"2011-12-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tamtam180","name":"tamtam180","key":"tamtam180","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tamtam180&avatarId=13540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tamtam180&avatarId=13540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tamtam180&avatarId=13540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tamtam180&avatarId=13540"},"displayName":"tamtam180","active":true,"timeZone":"Asia/Tokyo"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-01-10T19:53:06.858+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313585","id":"12313585","name":"UDF","description":"This includes the UDFs and UDAFs"}],"timeoriginalestimate":null,"description":"How to reproduce:\n\n{noformat}\n$ echo \"2011-12-25 09:00:00.123456\" > /tmp/data5.txt\nhive> create table ts1(t1 timestamp);\nhive> load data local inpath '/tmp/data5.txt' overwrite into table ts1;\nhive> select t1, from_utc_timestamp(t1, 'JST'), from_utc_timestamp(t1, 'JST') from ts1 limit 1;\n{noformat}\n\nThe following result is expected:\n{noformat}\n 2011-12-25 09:00:00.123456      2011-12-25 18:00:00.123456      2011-12-25 18:00:00.123456\n{noformat}\nHowever, the above query return incorrect result like this:\n{noformat}\n 2011-12-26 03:00:00.492456      2011-12-26 03:00:00.492456      2011-12-26 03:00:00.492456\n{noformat}\n\nThis is because GenericUDFFromUtcTimestamp.applyOffset() does setTime() improperly.\nOn evaluating query, timestamp argument always returns the same instance.\nGenericUDFFromUtcTimestamp.applyOffset() does setTime() on the instance.\nThat means it adds all offsets in the query.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12516018","id":"12516018","filename":"ASF.LICENSE.NOT.GRANTED--HIVE-2803.D1959.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-25T02:20:07.696+0000","size":5586,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12516018/ASF.LICENSE.NOT.GRANTED--HIVE-2803.D1959.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12514267","id":"12514267","filename":"HIVE-2803.1.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tamtam180","name":"tamtam180","key":"tamtam180","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tamtam180&avatarId=13540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tamtam180&avatarId=13540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tamtam180&avatarId=13540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tamtam180&avatarId=13540"},"displayName":"tamtam180","active":true,"timeZone":"Asia/Tokyo"},"created":"2012-02-12T12:03:52.796+0000","size":5951,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12514267/HIVE-2803.1.patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12523904","id":"12523904","filename":"HIVE-2803.D1959.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tamtam180","name":"tamtam180","key":"tamtam180","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tamtam180&avatarId=13540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tamtam180&avatarId=13540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tamtam180&avatarId=13540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tamtam180&avatarId=13540"},"displayName":"tamtam180","active":true,"timeZone":"Asia/Tokyo"},"created":"2012-04-24T01:43:59.862+0000","size":5586,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12523904/HIVE-2803.D1959.1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"14575","customfield_12312823":null,"summary":"utc_from_timestamp and utc_to_timestamp returns incorrect results.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tamtam180","name":"tamtam180","key":"tamtam180","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tamtam180&avatarId=13540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tamtam180&avatarId=13540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tamtam180&avatarId=13540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tamtam180&avatarId=13540"},"displayName":"tamtam180","active":true,"timeZone":"Asia/Tokyo"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tamtam180","name":"tamtam180","key":"tamtam180","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tamtam180&avatarId=13540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tamtam180&avatarId=13540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tamtam180&avatarId=13540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tamtam180&avatarId=13540"},"displayName":"tamtam180","active":true,"timeZone":"Asia/Tokyo"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12542283/comment/13206398","id":"13206398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tamtam180","name":"tamtam180","key":"tamtam180","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tamtam180&avatarId=13540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tamtam180&avatarId=13540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tamtam180&avatarId=13540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tamtam180&avatarId=13540"},"displayName":"tamtam180","active":true,"timeZone":"Asia/Tokyo"},"body":"Attached is the patch which fixes this issue.\nIt changed so that applyOffset() return a new instance.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tamtam180","name":"tamtam180","key":"tamtam180","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tamtam180&avatarId=13540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tamtam180&avatarId=13540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tamtam180&avatarId=13540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tamtam180&avatarId=13540"},"displayName":"tamtam180","active":true,"timeZone":"Asia/Tokyo"},"created":"2012-02-12T12:03:53.025+0000","updated":"2012-02-12T12:03:53.025+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12542283/comment/13214221","id":"13214221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"body":"@tamtam180: If this patch is ready for review can you please change the status to 'Patch Available' and submit a review request using Phabricator? Instructions are located here:\nhttps://cwiki.apache.org/confluence/display/Hive/HowToContribute#HowToContribute-ReviewProcess\n\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-02-23T02:30:34.471+0000","updated":"2012-02-23T02:30:34.471+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12542283/comment/13216252","id":"13216252","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"tamtam180 requested code review of \"HIVE-2803 [jira] utc_from_timestamp and utc_to_timestamp returns incorrect results.\".\nReviewers: JIRA\n\n  https://issues.apache.org/jira/browse/HIVE-2803\n\n  HIVE-2803 utc_from_timestamp and utc_to_timestamp returns incorrect results.\n\n  It changed so that applyOffset() return a new instance.\n\n  How to reproduce:\n\n\n  $ echo \"2011-12-25 09:00:00.123456\" > /tmp/data5.txt\n  hive> create table ts1(t1 timestamp);\n  hive> load data local inpath '/tmp/data5.txt' overwrite into table ts1;\n  hive> select t1, from_utc_timestamp(t1, 'JST'), from_utc_timestamp(t1, 'JST') from ts1 limit 1;\n\n\n\n  The following result is expected:\n\n   2011-12-25 09:00:00.123456      2011-12-25 18:00:00.123456      2011-12-25 18:00:00.123456\n\n\n  However, the above query return incorrect result like this:\n\n   2011-12-26 03:00:00.492456      2011-12-26 03:00:00.492456      2011-12-26 03:00:00.492456\n\n\n\n  This is because GenericUDFFromUtcTimestamp.applyOffset() does setTime() improperly.\n  On evaluating query, timestamp argument always returns the same instance.\n  GenericUDFFromUtcTimestamp.applyOffset() does setTime() on the instance.\n  That means it adds all offsets in the query.\n\nTEST PLAN\n  EMPTY\n\nREVISION DETAIL\n  https://reviews.facebook.net/D1959\n\nAFFECTED FILES\n  ql/src/test/results/clientpositive/timestamp_udf.q.out\n  ql/src/test/queries/clientpositive/timestamp_udf.q\n  ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFFromUtcTimestamp.java\n\nMANAGE HERALD DIFFERENTIAL RULES\n  https://reviews.facebook.net/herald/view/differential/\n\nWHY DID I GET THIS EMAIL?\n  https://reviews.facebook.net/herald/transcript/4143/\n\nTip: use the X-Herald-Rules header to filter Herald messages in your client.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-25T02:20:03.965+0000","updated":"2012-02-25T02:20:03.965+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12542283/comment/13216361","id":"13216361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tamtam180","name":"tamtam180","key":"tamtam180","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tamtam180&avatarId=13540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tamtam180&avatarId=13540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tamtam180&avatarId=13540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tamtam180&avatarId=13540"},"displayName":"tamtam180","active":true,"timeZone":"Asia/Tokyo"},"body":"Carl,\nthanks your advice.\nI tried use of Phabricator, and changed status to 'Patch Available'.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tamtam180","name":"tamtam180","key":"tamtam180","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tamtam180&avatarId=13540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tamtam180&avatarId=13540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tamtam180&avatarId=13540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tamtam180&avatarId=13540"},"displayName":"tamtam180","active":true,"timeZone":"Asia/Tokyo"},"created":"2012-02-25T08:08:38.895+0000","updated":"2012-02-25T08:08:38.895+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12542283/comment/13260071","id":"13260071","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to trunk. Thanks Tamtam180!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-04-23T23:23:18.458+0000","updated":"2012-04-23T23:23:18.458+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12542283/comment/13260073","id":"13260073","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"body":"@tamtam180: can you please upload another copy of the patch and click the box that grants license rights to the ASF? Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-04-23T23:24:15.316+0000","updated":"2012-04-23T23:24:15.316+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12542283/comment/13260076","id":"13260076","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"tamtam180 has committed the revision \"HIVE-2803 [jira] utc_from_timestamp and utc_to_timestamp returns incorrect results.\".\n\n  Change committed by cws.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D1959\n\nCOMMIT\n  https://reviews.facebook.net/rHIVE1329507\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2012-04-23T23:30:30.743+0000","updated":"2012-04-23T23:30:30.743+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12542283/comment/13260139","id":"13260139","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tamtam180","name":"tamtam180","key":"tamtam180","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tamtam180&avatarId=13540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tamtam180&avatarId=13540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tamtam180&avatarId=13540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tamtam180&avatarId=13540"},"displayName":"tamtam180","active":true,"timeZone":"Asia/Tokyo"},"body":"Final version which grants rights to the ASF.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tamtam180","name":"tamtam180","key":"tamtam180","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tamtam180&avatarId=13540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tamtam180&avatarId=13540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tamtam180&avatarId=13540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tamtam180&avatarId=13540"},"displayName":"tamtam180","active":true,"timeZone":"Asia/Tokyo"},"created":"2012-04-24T01:43:59.916+0000","updated":"2012-04-24T01:43:59.916+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12542283/comment/13260299","id":"13260299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hive-trunk-h0.21 #1392 (See [https://builds.apache.org/job/Hive-trunk-h0.21/1392/])\n    HIVE-2803 [jira] utc_from_timestamp and utc_to_timestamp returns incorrect\nresults.\n(Kiyotaka Suzuki via Carl Steinbach)\n\nSummary:\nhttps://issues.apache.org/jira/browse/HIVE-2803\n\nHIVE-2803 utc_from_timestamp and utc_to_timestamp returns incorrect results.\n\nIt changed so that applyOffset() return a new instance.\n\nHow to reproduce:\n\n\n$ echo \"2011-12-25 09:00:00.123456\" > /tmp/data5.txt\nhive> create table ts1(t1 timestamp);\nhive> load data local inpath '/tmp/data5.txt' overwrite into table ts1;\nhive> select t1, from_utc_timestamp(t1, 'JST'), from_utc_timestamp(t1, 'JST')\nfrom ts1 limit 1;\n\n\n\nThe following result is expected:\n\n 2011-12-25 09:00:00.123456      2011-12-25 18:00:00.123456      2011-12-25\n18:00:00.123456\n\n\nHowever, the above query return incorrect result like this:\n\n 2011-12-26 03:00:00.492456      2011-12-26 03:00:00.492456      2011-12-26\n03:00:00.492456\n\n\n\nThis is because GenericUDFFromUtcTimestamp.applyOffset() does setTime()\nimproperly.\nOn evaluating query, timestamp argument always returns the same instance.\nGenericUDFFromUtcTimestamp.applyOffset() does setTime() on the instance.\nThat means it adds all offsets in the query.\n\nTest Plan: EMPTY\n\nReviewers: JIRA\n\nDifferential Revision: https://reviews.facebook.net/D1959 (Revision 1329507)\n\n     Result = FAILURE\ncws : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1329507\nFiles : \n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFFromUtcTimestamp.java\n* /hive/trunk/ql/src/test/queries/clientpositive/timestamp_udf.q\n* /hive/trunk/ql/src/test/results/clientpositive/timestamp_udf.q.out\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2012-04-24T06:51:26.243+0000","updated":"2012-04-24T06:51:26.243+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12542283/comment/13548231","id":"13548231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hive-trunk-hadoop2 #54 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/54/])\n    HIVE-2803 [jira] utc_from_timestamp and utc_to_timestamp returns incorrect\nresults.\n(Kiyotaka Suzuki via Carl Steinbach)\n\nSummary:\nhttps://issues.apache.org/jira/browse/HIVE-2803\n\nHIVE-2803 utc_from_timestamp and utc_to_timestamp returns incorrect results.\n\nIt changed so that applyOffset() return a new instance.\n\nHow to reproduce:\n\n\n$ echo \"2011-12-25 09:00:00.123456\" > /tmp/data5.txt\nhive> create table ts1(t1 timestamp);\nhive> load data local inpath '/tmp/data5.txt' overwrite into table ts1;\nhive> select t1, from_utc_timestamp(t1, 'JST'), from_utc_timestamp(t1, 'JST')\nfrom ts1 limit 1;\n\n\n\nThe following result is expected:\n\n 2011-12-25 09:00:00.123456      2011-12-25 18:00:00.123456      2011-12-25\n18:00:00.123456\n\n\nHowever, the above query return incorrect result like this:\n\n 2011-12-26 03:00:00.492456      2011-12-26 03:00:00.492456      2011-12-26\n03:00:00.492456\n\n\n\nThis is because GenericUDFFromUtcTimestamp.applyOffset() does setTime()\nimproperly.\nOn evaluating query, timestamp argument always returns the same instance.\nGenericUDFFromUtcTimestamp.applyOffset() does setTime() on the instance.\nThat means it adds all offsets in the query.\n\nTest Plan: EMPTY\n\nReviewers: JIRA\n\nDifferential Revision: https://reviews.facebook.net/D1959 (Revision 1329507)\n\n     Result = ABORTED\ncws : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1329507\nFiles : \n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFFromUtcTimestamp.java\n* /hive/trunk/ql/src/test/queries/clientpositive/timestamp_udf.q\n* /hive/trunk/ql/src/test/results/clientpositive/timestamp_udf.q.out\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-09T10:24:54.568+0000","updated":"2013-01-09T10:24:54.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12542283/comment/13550029","id":"13550029","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"This issue is fixed and released as part of 0.10.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-10T19:53:06.853+0000","updated":"2013-01-10T19:53:06.853+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-2803/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i02upb:"}}