{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12428788","self":"https://issues.apache.org/jira/rest/api/2/issue/12428788","key":"HIVE-578","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313714","id":"12313714","description":"released","name":"0.4.0","archived":false,"released":true,"releaseDate":"2009-10-12"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-06-24T23:45:08.881+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Aug 11 02:06:50 UTC 2009","customfield_12310420":"73434","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_4099029132_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-08-11T02:06:50.926+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-578/watchers","watchCount":2,"isWatching":false},"created":"2009-06-24T15:29:41.794+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313637","id":"12313637","description":"released","name":"0.3.0","archived":false,"released":true,"releaseDate":"2009-04-30"}],"issuelinks":[{"id":"12326143","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12326143","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12411888","key":"HIVE-218","self":"https://issues.apache.org/jira/rest/api/2/issue/12411888","fields":{"summary":"predicate on partitioning column is ignored in many places","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-12-17T00:07:21.139+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"Some bugs with partition pruning have been reported and the correct fix for many of them is to rewrite the partition pruning code as an optimizer transformation which gets kicked in after the predicate pushdown code. This refactor also uses the graph walker framework so that the partition pruning code gets consolidated well with the frameworks and does not work on the query block but rather works on the operator tree.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12414294","id":"12414294","filename":"patch-578_1.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-23T01:48:43.330+0000","size":1079411,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12414294/patch-578_1.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12415714","id":"12415714","filename":"patch-578_2.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-06T09:05:09.315+0000","size":1283160,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12415714/patch-578_2.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12415789","id":"12415789","filename":"patch-578_3.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-06T22:56:13.732+0000","size":1311693,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12415789/patch-578_3.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12411658","id":"12411658","filename":"patch-578.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-24T15:32:29.769+0000","size":69953,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12411658/patch-578.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"122367","customfield_12312823":null,"summary":"Refactor partition pruning code as an optimizer transformation","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12723603","id":"12723603","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"body":"This a preliminary code patch. I have not yet plugged this into the SemanticAnalyzer phase but comments are welcome in order to catch any early omissions. This introduces test diffs which I will upload with the final patch.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-24T15:32:29.809+0000","updated":"2009-06-24T15:32:29.809+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12723804","id":"12723804","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"Some high-level comments:\n\n1. Can you share some expression walker code from Predicate Pushdown ? seems like a lot of common stuff.\n2. Can you always assume that the predicate to be filtered will always be after the tablescan ? \n\n     Currently, all optimizations are independent of each other, and can be turned off - this way, \n     you are dependent on a new feature -- may have stability issues.\n\n     I don't remember exactly how does predicate pushdown work - if a filter is already present immediately after the table\n     scan, will the pushed up filter be merged. Is it pushed across user defined mappers/reducers ? Cant these things change\n     in the future ?\n\n     It might be a good idea to look for TS*FIL, and then keep some mapping - or probably use the same mapping that Predicate\n     pushdown has to figure out whether the filter is for the table under consideration.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-06-24T23:45:08.881+0000","updated":"2009-06-24T23:45:08.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12724786","id":"12724786","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"body":"Actually the walker is already shared. However, the actions encapsulated in the ExprProcFactory etc. are by definition different from predicate pushdown and partition pruning so there is no sharing there.\n\nFor 2 I checked with Prasad, and this assumption is correct. Also if there are multiple filter predicates after TS, there are all merged together and a new filter predicate is generated under the TS node, so looking for TS%FIL% should be sufficient.\n\nRegarding the optimization, I will keep the old pruning code around and toggle this new functionality only when predicate pushdown in enabled. Also I am going to add a number of tests to this before it goes in.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-27T01:31:06.521+0000","updated":"2009-06-27T01:31:06.521+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12731540","id":"12731540","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsm","name":"rsm","key":"rsm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghotham Murthy","active":true,"timeZone":"America/Los_Angeles"},"body":"I am trying to make similar changes to input pruning for sampling. \n\nA few questions:\n\nHow come we have both tableDesc and tableScanDesc? I see that tableDesc is used in FetchWork and tableScanDesc in TableScanOperator. Does it make sense to make FetchWork use TableScanOperator (FetchOperator is not really an operator)? Then, merge tableDesc and tableScanDesc? This will also allow us to have the same code path for select * queries as well. Right now it looks like FetchOperator is duplicating some code. Also, sample pruning can use the merged tableScanDesc object to store the sampling information.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsm","name":"rsm","key":"rsm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghotham Murthy","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-07-15T16:19:59.999+0000","updated":"2009-07-15T16:19:59.999+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12731564","id":"12731564","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"body":"yes that makes sense. In fact that needs to be done to make pruning work with select * from T where T.part = xyz kind of queries and I ran into that a few days back. I have punted that for the first stage and still rely on the old pruning stuff for such queries and when predicate pushdown is switched off. I have it mostly passing the tests except for sampling tests where in the predicate pushdown code seems not to be merging the two filter operators and I have made that assumption in my code. Will update today with the version sans the new tests and some cleanup. That way we can see how sampling stuff can work with this as well.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-15T17:14:09.537+0000","updated":"2009-07-15T17:14:09.537+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12731696","id":"12731696","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"body":"Actually semantics with table sampling is a bit tricky in case the sampling function is non deterministic e.g (rand()). In that case there are two possibilities:\n\n1. The sampling is done on the whole table and then the predicate is applied which implies no partition pruning.\nor\n2. The sampling is done after the partition predicate is applied ie. it is done after pruning.\n\n2 is what we do today - I am ok with keeping that, but just wanted to call that out as a special case in the partition pruning code.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-15T21:20:05.923+0000","updated":"2009-07-15T21:20:05.923+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12734421","id":"12734421","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"body":"New patch. This is now passing all the tests. I am going to add some more tests and refactor some of the state from ParseContext to tableScanDesc.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-23T01:48:43.353+0000","updated":"2009-07-23T01:48:43.353+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12734428","id":"12734428","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasadc","name":"prasadc","key":"prasadc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Chakka","active":true,"timeZone":"Etc/UTC"},"body":"Some comments.\n\nbq. for(String partName: Hive.get().getPartitionNames(MetaStoreUtils.DEFAULT_DATABASE_NAME, tab.getName(), (short) -1))\n\n1. should use tab.getDbName() instead.\n\n2. PartitionPruner::prune() should return partSpecs or partNames instead of partition objects and avoid calling getPartition() on all partNames. this would lower the unnecessary load on metastore. \n\nbq. {code}      if (HiveConf.getBoolVar(hiveConf, HiveConf.ConfVars.HIVEOPTPPD)) {\n       transformations.add(new PredicatePushDown());\n+      transformations.add(new PartitionPruner());\n     }\n\n{code}\n\n3. you should add new config param instead of piggybacking on PPD.\n\n4. isn't ColumnInfo.internalName unique among all tables? is tableName an additional information that is needed? Can't you get this info from RowResolver? Same question on exprNodeColDesc.\n\n5. don't understand the change in DefaultGraphWalker.java\n\n6. can't most of the functionality from ql/parse/PartitionPruner.java class can't be moved to the new class. atleast change the name so that it is not confusing as which pruner is doing what.\n\n7. import org.apache.hadoop.hive.ql.ppd.PredicatePushDown; is not needed in SemanticAnalyzer.java\n\n8. \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasadc","name":"prasadc","key":"prasadc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Chakka","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-23T02:15:56.454+0000","updated":"2009-07-23T02:15:56.454+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12734800","id":"12734800","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"Some more comments:\n\n1. Add lots of new tests\n2. Wrong comments in OpProcFactory:\n\n      // If fop2 exists (i.e this is not the top level filter and fop2 is not\n      // a sampling filter t1ehen we ignore the current filter\n      if (fop2 != null && !fop2.getConf().getIsSamplingPred())\n        return null;\n      \n      // ignore the predicate in case it is not a sampling predicate\n      if (fop.getConf().getIsSamplingPred()) {\n        return null;\n      }\n\n\n\nshould be:\n\n\n      // If fop2 exists (i.e this is not the top level filter and fop2 is not\n      // a sampling filter then we ignore the current filter\n      if (fop2 != null && !fop2.getConf().getIsSamplingPred())\n        return null;\n      \n      // ignore the predicate in case it is a sampling predicate\n      if (fop.getConf().getIsSamplingPred()) {\n        return null;\n      }\n\n\n3. ExprProcFactory.java:\n\nwrong parameters doc:\n  /**\n   * Extracts pushdown predicates from the given list of predicate expression\n   * @param opContext operator context used for resolving column references\n   * @param op operator of the predicates being processed\n   * @param preds\n   * @return hasNonPartCols returns true/false depending upon whether this pred has a non partition column\n   * @throws SemanticException\n   */\n\n4. ExprProcFactory: 104/146/182\nshouldnt you check for exprNodeNullDesc also\n\n\n5. wrong comment: 63\n    /**\n     * Converts the reference from child row resolver to current row resolver\n     */\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-07-23T21:37:25.066+0000","updated":"2009-07-23T21:37:25.066+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12739946","id":"12739946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"body":"@Namit\n1. I have added a bunch of tests with the new patch.\n2/3/5. Fixed the typos and wrong comments and javadocs\n4. I don't think I have to check for exprNodeNullDesc. The unknown value of an operand is denoted by a null value in exprNodeConstantDesc. exprNodeNullDesc is used to denote the liternal NULL which should be treated as is for predicate pruning expression. e.g. if(ISNULL(NULL), 1, 0) should evaluate to 1 instead of unknown. So I think it is correct to not check the exprNodeNullDesc for the function processors. Thoughts?\n\n@Prasad\n3. I have used the ppd parameter because I cannot do partition pruning without ppd. So even if I have a separate parameter it would still have to be checked along with ppd. At that point, it seems having a separate parameter for ppd does not add much value. Thoughts?\n7. Removed\n6. I have changed the name ot ASTPartitionPruner\n5. This fixes a bug in DefaultGraphWalker. Due to this bug the operation stack would always get popped when you exited this call. As a result the stack would actually just contain the last node and not all the nodes on the path leading to the last node.\n4. Which particular code file are you talking about here?\n2. Not sure how that is different from what we were doing before?\n1. Made the change\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-06T09:03:04.974+0000","updated":"2009-08-06T09:03:04.974+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12739947","id":"12739947","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"body":"New patch with tests and changes.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-06T09:05:09.363+0000","updated":"2009-08-06T09:05:09.363+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12740181","id":"12740181","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"body":"We should add a separate parameter to enable the new partition pruner.\n\nSince the new partition pruner works only when ppd is enabled, we should have 3 possible modes instead of 4.\nhive.opt.ppd=false, hive.partition.pruner=ast\nhive.opt.ppd=true, hive.partition.pruner=ast\nhive.opt.ppd=true, hive.partition.pruner=opt\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-08-06T18:17:40.412+0000","updated":"2009-08-06T18:17:40.412+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12740297","id":"12740297","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"body":"New patch where the ppr is controlled by a boolean parameter. It kicks in only if ppd and ppr are both true. If any one of them are not true the AST based approach is used.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-06T22:56:13.778+0000","updated":"2009-08-06T22:56:13.778+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12741553","id":"12741553","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"atching file ql/src/java/org/apache/hadoop/hive/ql/parse/PartitionPruner.java\n(Stripping trailing CRs from patch.)\ncan't find file to patch at input line 27070\nPerhaps you used the wrong -p or --strip option?\nThe text leading up to this was:\n--------------------------\n|Index: ql/src/java/org/apache/hadoop/hive/ql/parse/ASTPartitionPruner.java\n|===================================================================\n|--- ql/src/java/org/apache/hadoop/hive/ql/parse/ASTPartitionPruner.java\t(revision 801363)\n|+++ ql/src/java/org/apache/hadoop/hive/ql/parse/ASTPartitionPruner.java\t(working copy)\n--------------------------\nFile to patch: \nSkip this patch? [y] \nSkipping patch.\n5 out of 5 hunks ignored\n(Stripping trailing CRs from patch.)\npatching file ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckProcFactory.java\n(Stripping trailing CRs from patch.)\npatching file ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java\n(Stripping trailing CRs from patch.)\npatching file ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java\n(Stripping trailing CRs from patch.)\npatching file ql/src/java/org/apache/hadoop/hive/ql/parse/PrunedPartitionList.java\n\n\nProblems in applying the patch - can you generate the patch again ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-08-10T21:09:25.536+0000","updated":"2009-08-10T21:09:25.536+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12741588","id":"12741588","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"body":"I think the patch is correct. Before applying the patch just do an svn mv on the old PartitionPruner.java to ASTPartitionPruner.java. Actually change the class name in eclipse and then apply the patch. That should work.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-10T22:10:08.664+0000","updated":"2009-08-10T22:10:08.664+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12741660","id":"12741660","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"Done - running tests right now","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-08-11T01:34:10.116+0000","updated":"2009-08-11T01:34:10.116+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428788/comment/12741663","id":"12741663","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"Committed. Thanks Ashish","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-08-11T02:06:50.900+0000","updated":"2009-08-11T02:06:50.900+0000"}],"maxResults":17,"total":17,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-578/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0lalj:"}}