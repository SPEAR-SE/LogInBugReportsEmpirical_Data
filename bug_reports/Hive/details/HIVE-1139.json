{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12455677","self":"https://issues.apache.org/jira/rest/api/2/issue/12455677","key":"HIVE-1139","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2010-06-04T13:30:53.176+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 31 04:46:39 UTC 2018","customfield_12310420":"42614","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-1139/watchers","watchCount":2,"isWatching":false},"created":"2010-02-08T19:58:52.024+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314156","id":"12314156","description":"released","name":"0.5.0","archived":false,"released":true,"releaseDate":"2010-02-23"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aprabhakar","name":"aprabhakar","key":"aprabhakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arvind Prabhakar","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-07-31T05:51:33.460+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"When a partial aggregation performed on a mapper, a HashMap is created to keep all distinct keys in main memory. This could leads to OOM exception when there are too many distinct keys for a particular mapper. A workaround is to set the map split size smaller so that each mapper takes less number of rows. A better solution is to use the persistent HashMapWrapper (currently used in CommonJoinOperator) to spill overflow rows to disk. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12446988","id":"12446988","filename":"PersistentMap.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raj_velu","name":"raj_velu","key":"raj_velu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Soundararajan Velu","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-13T19:15:22.987+0000","size":13068,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12446988/PersistentMap.zip"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"122854","customfield_12312823":null,"summary":"GroupByOperator sometimes throws OutOfMemory error when there are too many distinct keys","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12831101","id":"12831101","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"GroupByOperator uses HashMap's size() and iterator() API, which is not supported by HashMapWrapper right now. We should extended HashMapWrapper to support those. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-02-08T20:28:05.798+0000","updated":"2010-02-08T20:28:05.798+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12875595","id":"12875595","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raj_velu","name":"raj_velu","key":"raj_velu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Soundararajan Velu","active":true,"timeZone":"Etc/UTC"},"body":"Thanks Ning, we are trying to implement HashMapWrapper in our solution for Group By,  Wanted to know if this has been already done, It will be great if you can suggest on this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raj_velu","name":"raj_velu","key":"raj_velu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Soundararajan Velu","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-04T13:30:53.176+0000","updated":"2010-06-04T13:30:53.176+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12875606","id":"12875606","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Soundararajan, Do you mean you are trying to replace HashMapWrapper or extend it to support GroupByOperator? I am not actively working on this JIRA now. I think maybe Arvind is working on it? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-04T14:00:47.537+0000","updated":"2010-06-04T14:00:47.537+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12875650","id":"12875650","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aprabhakar","name":"aprabhakar","key":"aprabhakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arvind Prabhakar","active":true,"timeZone":"America/Los_Angeles"},"body":"Soundararajan, Ning - Yes I am planning on working on it starting next week. I expect this to take at least upto mid to late in the week in order to get a patch available for this. However, if that schedule does not work for you, please feel free to take this issue into your queue and go ahead. It will be great if you could confirm it either way first.\n\nArvind","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aprabhakar","name":"aprabhakar","key":"aprabhakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arvind Prabhakar","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-04T16:25:55.390+0000","updated":"2010-06-04T16:25:55.390+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12876979","id":"12876979","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aprabhakar","name":"aprabhakar","key":"aprabhakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arvind Prabhakar","active":true,"timeZone":"America/Los_Angeles"},"body":"I did some preliminary analysis for this JIRA and converted the {{HashMapWrapper}} to implement the {{java.util.Map}} interface. This required some changes all the way down to the underlying JDBM classes. \n\nHowever, this alone is not sufficient to plug it into the {{GroupByOperator}} implementation because the data stored in the {{HashMap}} is a mix of serializable Java objects as well as {{Writable}}s. Since {{Writable}}s cannot be directly serialized to Java, it follows that inorder to use this for fixing the memory problem we need _an external serialization_ mechanism that can handle arbitrary mixed type object graphs.\n\nA trivial approach to address this would be to implement custom serialization using Java reflection but that would incur cost of excessive reflection and byte handling/marshaling.\n\nIf you have any other ideas regarding this, please add it to the comments of this issue for consideration.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aprabhakar","name":"aprabhakar","key":"aprabhakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arvind Prabhakar","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-09T06:49:38.617+0000","updated":"2010-06-09T06:49:38.617+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12877222","id":"12877222","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aprabhakar","name":"aprabhakar","key":"aprabhakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arvind Prabhakar","active":true,"timeZone":"America/Los_Angeles"},"body":"If there is interest, I can file a separate JIRA for modifying {{HashMapWrapper}} to support the {{java.util.Map}} interface and decouple that work from this JIRA. I think there is a lot of benefit in doing just that. Also, we could have this JIRA depend upon that as a prerequisite.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aprabhakar","name":"aprabhakar","key":"aprabhakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arvind Prabhakar","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-09T21:46:08.530+0000","updated":"2010-06-09T21:46:08.530+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12877232","id":"12877232","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"body":"Arvind, I thought the whole point of this JIRA was to make HashMapWrapper to support java.util.Map, no? If that would be a separate JIRA, what would this one be for? Sorry for being a bit dense here but if you could clarify that would be great.\n\nThanks,\nAshish\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-09T22:06:20.695+0000","updated":"2010-06-09T22:06:20.695+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12877239","id":"12877239","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aprabhakar","name":"aprabhakar","key":"aprabhakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arvind Prabhakar","active":true,"timeZone":"America/Los_Angeles"},"body":"Ashish - no problem - let me explain: The problem being addressed by this JIRA is that {{GroupByOperator}} and possibly other aggregation operators use in-memory maps to store intermediate keys, which could lead to {{OutOfMemoryException}} in case the number of such keys is large. It is suggested that one way to work around it is to use the {{HashMapWrapper}} class which would help alleviate the memory concern since it is capable of spilling the excess data to disk.\n\nThe {{HashMapWrapper}} however, uses Java serialization to write out the excess data. This does not work when the data contains non-serializable objects such as {{Writable}} types - {{Text}} etc. What I have done so far is to modify the {{HashMapWrapper}} to support full {{java.util.Map}} interface. However, when I tried updating the {{GroupByOperator}} to use it, I ran into the said serialization problem.\n\nThats why I was suggesting that perhaps we should decouple the serialization problem from enhancing the {{HashMapWrapper}} and let the later be checked independently.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aprabhakar","name":"aprabhakar","key":"aprabhakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arvind Prabhakar","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-09T22:24:54.060+0000","updated":"2010-06-09T22:24:54.060+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12877303","id":"12877303","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Arvind, I remember I got this problem (non-serializable) problem before and the problem boils down to support ObjectInspector in the same way as RowContainer does. In terms of a complete interface of Map, it would be good to have but I would be very cautious about performance penalty it may add. If the new API is not needed for now, I would vote for the ObjectInspector support first. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-10T03:45:48.996+0000","updated":"2010-06-10T03:45:48.996+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12877500","id":"12877500","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raj_velu","name":"raj_velu","key":"raj_velu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Soundararajan Velu","active":true,"timeZone":"Etc/UTC"},"body":"Ning, Aravind, I got this implemented and it looks good so far, I will try uploading the version I have modified after a thorough test, All I did was copy the HashMap implementation into the HashMapWrapper (leaving the existing functionality intact), now HashmapWrapper works exactly like hashmap, but I did not get to test out the serialization issues. will do that and update you guys. I think this should help us in our OOM issue around GroupBy...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raj_velu","name":"raj_velu","key":"raj_velu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Soundararajan Velu","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-10T17:33:04.446+0000","updated":"2010-06-10T17:33:04.446+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12877502","id":"12877502","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raj_velu","name":"raj_velu","key":"raj_velu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Soundararajan Velu","active":true,"timeZone":"Etc/UTC"},"body":"to add, XMLEncoder/XMLDecoder works just fine and can handle our serde issues.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raj_velu","name":"raj_velu","key":"raj_velu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Soundararajan Velu","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-10T17:39:07.251+0000","updated":"2010-06-10T17:39:07.251+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12878424","id":"12878424","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raj_velu","name":"raj_velu","key":"raj_velu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Soundararajan Velu","active":true,"timeZone":"Etc/UTC"},"body":"Aravind/Ning, This implementation uses XMLEncoder/XMLDecoder to handle the serde, I am still experimenting on this, I got the base implementation from http://gitorious.org/persistenthashmap/pages/Home, This library is distributed under GPL, Added some functionality around threshold and combined iteration... ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raj_velu","name":"raj_velu","key":"raj_velu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Soundararajan Velu","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-13T19:15:23.073+0000","updated":"2010-06-13T19:15:23.073+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12878774","id":"12878774","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Soundararajan, thanks for the contribution. However it seems the persistent hash map package is under GNU v.3, which is not compatible with apache license. We also looked at other existing open source packages before implementing our own HashMapWrapper. One of the problems we found out then is the license compatibility issue. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-14T22:12:51.085+0000","updated":"2010-06-14T22:12:51.085+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12879051","id":"12879051","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raj_velu","name":"raj_velu","key":"raj_velu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Soundararajan Velu","active":true,"timeZone":"Etc/UTC"},"body":"right... Ning is there any open source serializers/deserializers that you are aware of that is reflections based, if so I can quickly implement a similar persistent map around that....","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raj_velu","name":"raj_velu","key":"raj_velu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Soundararajan Velu","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-15T18:11:51.383+0000","updated":"2010-06-15T18:11:51.383+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12879061","id":"12879061","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm not aware of an efficient serde that are reflection based. The XMLEncoder/Decoder is JAXB-based and are very inefficient. That's another reason we don't want to use it in the execution code path. A better way is to use the Hive SerDe (e.g., LazyBinarySerde) just as it is done in RowContainer.\n\nAnother way to tackle this problem is have more accurate estimate of how many rows can be fit into the main memory. The current code checks the amount of available memory and use 0.25 (by default) of them to hold the hashmap. We set it to 0.15 in our environment and it works for most cases. 0.15 is probably a little bit conservative. Some experiments need to be done to tune this parameter so that most cases will be fit into main memory and only for the exceptional cases the secondary storage will be used. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-15T18:30:34.381+0000","updated":"2010-06-15T18:30:34.381+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12879406","id":"12879406","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raj_velu","name":"raj_velu","key":"raj_velu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Soundararajan Velu","active":true,"timeZone":"Etc/UTC"},"body":"Thanks Ning, sounds logical, will try with 0.15 and tune accordingly in our environment, but on a long run I guess we may need a strong reflection based serde Map. I am still exploring if it can be achieved.. will keep the progress posted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raj_velu","name":"raj_velu","key":"raj_velu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Soundararajan Velu","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-16T17:26:08.892+0000","updated":"2010-06-16T17:26:08.892+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/12879442","id":"12879442","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Sounds good. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-16T18:36:33.557+0000","updated":"2010-06-16T18:36:33.557+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12455677/comment/16563143","id":"16563143","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dingqiaoyi","name":"dingqiaoyi","key":"dingqiaoyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiaoyi Ding","active":true,"timeZone":"Etc/UTC"},"body":"Hi all, I'm new to HIVE, and i find there is no spilling when hash agg having lots of entries in the hash map which could cause OOM.\r\n\r\nSo, is this issue still open, or any update?[~aprabhakar]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dingqiaoyi","name":"dingqiaoyi","key":"dingqiaoyi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiaoyi Ding","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-31T04:46:39.715+0000","updated":"2018-07-31T05:51:33.453+0000"}],"maxResults":18,"total":18,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-1139/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ldlr:"}}