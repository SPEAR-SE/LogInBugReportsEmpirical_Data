{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12683013","self":"https://issues.apache.org/jira/rest/api/2/issue/12683013","key":"HIVE-5970","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-12-06T21:41:44.001+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 07 20:08:31 UTC 2014","customfield_12310420":"362266","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_20547446385_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-07-31T18:25:32.980+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5970/watchers","watchCount":10,"isWatching":false},"created":"2013-12-05T22:48:06.637+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":["orcfile"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324312","id":"12324312","description":"released","name":"0.12.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"issuelinks":[{"id":"12383562","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12383562","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12693495","key":"HIVE-6382","self":"https://issues.apache.org/jira/rest/api/2/issue/12693495","fields":{"summary":"PATCHED_BLOB encoding in ORC will corrupt data in some cases","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12379569","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379569","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"inwardIssue":{"id":"12635386","key":"HIVE-4123","self":"https://issues.apache.org/jira/rest/api/2/issue/12635386","fields":{"summary":"The RLE encoding for ORC can be improved","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-08-07T20:08:31.419+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320633","id":"12320633","name":"File Formats","description":"File Formats"}],"timeoriginalestimate":null,"description":"A workload involving ORC tables starts getting the following ArrayIndexOutOfBoundsException AFTER the upgrade to Hive 0.12. The file is added as part of HIVE-4123. \n\n2013-12-04 14:42:08,537 ERROR \ncause:java.io.IOException: java.io.IOException: java.lang.ArrayIndexOutOfBoundsException: 0\n2013-12-04 14:42:08,537 WARN org.apache.hadoop.mapred.Child: Error running child\njava.io.IOException: java.io.IOException: java.lang.ArrayIndexOutOfBoundsException: 0\n        at org.apache.hadoop.hive.io.HiveIOExceptionHandlerChain.handleRecordReaderNextException(HiveIOExceptionHandlerChain.java:121)\n        at org.apache.hadoop.hive.io.HiveIOExceptionHandlerUtil.handleRecordReaderNextException(HiveIOExceptionHandlerUtil.java:77)\n        at org.apache.hadoop.hive.shims.HadoopShimsSecure$CombineFileRecordReader.doNextWithExceptionHandler(HadoopShimsSecure.java:304)\n        at org.apache.hadoop.hive.shims.HadoopShimsSecure$CombineFileRecordReader.next(HadoopShimsSecure.java:220)\n        at org.apache.hadoop.mapred.MapTask$TrackedRecordReader.moveToNext(MapTask.java:215)\n        at org.apache.hadoop.mapred.MapTask$TrackedRecordReader.next(MapTask.java:200)\n        at org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:48)\n        at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:417)\n        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:332)\n        at org.apache.hadoop.mapred.Child$4.run(Child.java:268)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:396)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1408)\n        at org.apache.hadoop.mapred.Child.main(Child.java:262)\nCaused by: java.io.IOException: java.lang.ArrayIndexOutOfBoundsException: 0\n        at org.apache.hadoop.hive.io.HiveIOExceptionHandlerChain.handleRecordReaderNextException(HiveIOExceptionHandlerChain.java:121)\n        at org.apache.hadoop.hive.io.HiveIOExceptionHandlerUtil.handleRecordReaderNextException(HiveIOExceptionHandlerUtil.java:77)\n        at org.apache.hadoop.hive.ql.io.HiveContextAwareRecordReader.doNext(HiveContextAwareRecordReader.java:276)\n        at org.apache.hadoop.hive.ql.io.CombineHiveRecordReader.doNext(CombineHiveRecordReader.java:101)\n        at org.apache.hadoop.hive.ql.io.CombineHiveRecordReader.doNext(CombineHiveRecordReader.java:41)\n        at org.apache.hadoop.hive.ql.io.HiveContextAwareRecordReader.next(HiveContextAwareRecordReader.java:108)\n        at org.apache.hadoop.hive.shims.HadoopShimsSecure$CombineFileRecordReader.doNextWithExceptionHandler(HadoopShimsSecure.java:302)\n        ... 11 more\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 0\n        at org.apache.hadoop.hive.ql.io.orc.RunLengthIntegerReaderV2.readPatchedBaseValues(RunLengthIntegerReaderV2.java:171)\n        at org.apache.hadoop.hive.ql.io.orc.RunLengthIntegerReaderV2.readValues(RunLengthIntegerReaderV2.java:54)\n        at org.apache.hadoop.hive.ql.io.orc.RunLengthIntegerReaderV2.next(RunLengthIntegerReaderV2.java:287)\n        at org.apache.hadoop.hive.ql.io.orc.RecordReaderImpl$LongTreeReader.next(RecordReaderImpl.java:473)\n        at org.apache.hadoop.hive.ql.io.orc.RecordReaderImpl$StructTreeReader.next(RecordReaderImpl.java:1157)\n        at org.apache.hadoop.hive.ql.io.orc.RecordReaderImpl.next(RecordReaderImpl.java:2196)\n        at org.apache.hadoop.hive.ql.io.orc.OrcInputFormat$OrcRecordReader.next(OrcInputFormat.java:129)\n        at org.apache.hadoop.hive.ql.io.orc.OrcInputFormat$OrcRecordReader.next(OrcInputFormat.java:80)\n        at org.apache.hadoop.hive.ql.io.HiveContextAwareRecordReader.doNext(HiveContextAwareRecordReader.java:274)\n        ... 15 more","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12617479","id":"12617479","filename":"test_data","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Aleksei","name":"Aleksei","key":"aleksei","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aleksei Statkevich","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-06T21:41:55.469+0000","size":288012,"mimeType":"text/html","content":"https://issues.apache.org/jira/secure/attachment/12617479/test_data"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"362560","customfield_12312823":null,"summary":"ArrayIndexOutOfBoundsException in RunLengthIntegerReaderV2.java","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ericchu30","name":"ericchu30","key":"ericchu30","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Chu","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ericchu30","name":"ericchu30","key":"ericchu30","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Chu","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683013/comment/13840730","id":"13840730","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ericchu30","name":"ericchu30","key":"ericchu30","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Chu","active":true,"timeZone":"America/Los_Angeles"},"body":"Looking at the code where the exception occurs, It seems like the array unpackedPatch could be empty after SerializationUtils.readInts(), but there's no checking when accessing the array.\n\n   // unpack the patch blob\n    long[] unpackedPatch = new long[pl];\n    SerializationUtils.readInts(unpackedPatch, 0, pl, pw + pgw, input);\n\n    // apply the patch directly when decoding the packed data\n    int patchIdx = 0;\n    long currGap = 0;\n    long currPatch = 0;\n    currGap = unpackedPatch[patchIdx] >>> pw;\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ericchu30","name":"ericchu30","key":"ericchu30","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Chu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-06T00:22:29.102+0000","updated":"2013-12-06T00:22:29.102+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683013/comment/13840743","id":"13840743","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ericchu30","name":"ericchu30","key":"ericchu30","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Chu","active":true,"timeZone":"America/Los_Angeles"},"body":"Or pl could be 0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ericchu30","name":"ericchu30","key":"ericchu30","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Chu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-06T00:33:03.003+0000","updated":"2013-12-06T00:33:03.003+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683013/comment/13841743","id":"13841743","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Aleksei","name":"Aleksei","key":"aleksei","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aleksei Statkevich","active":true,"timeZone":"America/Los_Angeles"},"body":"My findings show that there is a problem in run length encoding.\nYou can reproduce the problem by doing the following steps:\n1. Create the table:\n{code:sql}\nCREATE TABLE test_orc_format(\n  site STRING,\n  a DOUBLE,\n  b BIGINT,\n  c BIGINT,\n  d BIGINT,\n  e DOUBLE,\n  f DOUBLE,\n  g DOUBLE,\n  h DOUBLE,\n  i DOUBLE,\n  j DOUBLE,\n  k BIGINT,\n  l BIGINT,\n  m BIGINT,\n  n BIGINT,\n  o BIGINT,\n  p BIGINT,\n  q ARRAY<DOUBLE>,\n  r ARRAY<DOUBLE>\n)\nROW FORMAT DELIMITED\nFIELDS TERMINATED BY '\\t'\nCOLLECTION ITEMS TERMINATED BY ','\nSTORED AS ORC\n;\n{code}\n2. Load the data from attached file.\n{code:sql}\nload data local inpath 'test_data' overwrite into test_orc_format;\n{code}\n3. Use one of the following queries:\n{code:sql}\nselect * from test_orc_format;\nselect o from test_orc_format;\n{code}\n\nNote, the attached file was created by hive during a job execution and not crafted by hands, it might be wrongly encoded as well. Also, note that the query that does calculation for column \"o\" cannot give negative results.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Aleksei","name":"Aleksei","key":"aleksei","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aleksei Statkevich","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-06T21:41:44.001+0000","updated":"2013-12-06T21:41:44.001+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683013/comment/13843739","id":"13843739","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"body":"[~ericchu30] and [~Aleksei] thanks for looking into this issue and your findings. I tried to reproduce the issue with the test data that is being provided. I think the attached test data is a corrupted orc file and so I was not able to reproduce the issue. But I recently faced a similar issue, ArrayIndexOutOfBoundsException while writing data using the new RunLengthIntegerReaderV2. I suspect that this issue might be related to writing of data RLEv2. I posted a patch for it here https://issues.apache.org/jira/browse/HIVE-5991. Will it be possible to apply this patch and see if this issue happens again?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-10T00:08:10.774+0000","updated":"2013-12-10T00:08:10.774+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683013/comment/13845144","id":"13845144","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jakeri","name":"jakeri","key":"jakeri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jakob Sultan Ericsson","active":true,"timeZone":"Europe/Berlin"},"body":"Also running into same problem. We have setup a new test cluster (Hortonworks 2.0) where we move some test data (roughly 6 000 000 000 rows) and try to move into a more optimized format (orc with buckets in a partitioned table).\n\nNot sure if this will help you but here is the stacktrace. Do you want some more information?\n\n{noformat}\nINSERT OVERWRITE TABLE hellotestdataend2 PARTITION(dt) SELECT * FROM event.hellotestdataend2 SORT BY dt, someid, msts, userid\n{noformat}\n\n{noformat}\nat javax.security.auth.Subject.doAs(Subject.java:415)\nat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1491)\nat org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:157)\nCaused by: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row (tag=0) {\"key\":{\"reducesinkkey0\":10017,\"reducesinkkey1\":1384880695473,\"reducesinkkey2\":1242212467},\"value\":{\"_col0\":1384880695473,\"_col1\":\"10017\",\"_col2\":1242212467,\"_col3\":\"ASPV6f3f82454d0df89704c74f7f0884fa15\",\"_col4\":1384880654,\"_col5\":19,\"_col6\":15,\"_col7\":21700,\"_col8\":0,\"_col9\":2552,\"_col10\":100,\"_col11\":1384880624,\"_col12\":0,\"_col13\":\"2013-11-19\"}}\nat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.reduce(ExecReducer.java:258)\n... 7 more\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 3\nat org.apache.hadoop.hive.ql.io.orc.RunLengthIntegerWriterV2.preparePatchedBlob(RunLengthIntegerWriterV2.java:593)\nat org.apache.hadoop.hive.ql.io.orc.RunLengthIntegerWriterV2.determineEncoding(RunLengthIntegerWriterV2.java:541)\nat org.apache.hadoop.hive.ql.io.orc.RunLengthIntegerWriterV2.write(RunLengthIntegerWriterV2.java:746)\nat org.apache.hadoop.hive.ql.io.orc.WriterImpl$IntegerTreeWriter.write(WriterImpl.java:744)\nat org.apache.hadoop.hive.ql.io.orc.WriterImpl$StructTreeWriter.write(WriterImpl.java:1320)\nat org.apache.hadoop.hive.ql.io.orc.WriterImpl.addRow(WriterImpl.java:1849)\nat org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat$OrcRecordWriter.write(OrcOutputFormat.java:75)\nat org.apache.hadoop.hive.ql.exec.FileSinkOperator.processOp(FileSinkOperator.java:638)\nat org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:501)\nat org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:842)\nat org.apache.hadoop.hive.ql.exec.SelectOperator.processOp(SelectOperator.java:88)\nat org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:501)\nat org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:842)\nat org.apache.hadoop.hive.ql.exec.ExtractOperator.processOp(ExtractOperator.java:45)\nat org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:501)\nat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.reduce(ExecReducer.java:249)\n... 7 more\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jakeri","name":"jakeri","key":"jakeri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jakob Sultan Ericsson","active":true,"timeZone":"Europe/Berlin"},"created":"2013-12-11T07:09:28.449+0000","updated":"2013-12-11T07:09:28.449+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683013/comment/13845147","id":"13845147","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"body":"[~jakeri] This issue with new RLEv2 encoding should be addressed by HIVE-5991. You can try HIVE-5991 patch or the alternative workaround would be to use hive.exec.orc.write.format=“0.11”. This will use the old RLE encoding. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-11T07:18:08.092+0000","updated":"2013-12-11T07:18:08.092+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683013/comment/13845159","id":"13845159","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ericchu30","name":"ericchu30","key":"ericchu30","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Chu","active":true,"timeZone":"America/Los_Angeles"},"body":"If we have already started using RLE 0.11 for some partitions of the table and want to switch to RLEv2, would we need to rewrite existing partitions in RLEv2? If not, would we need to set hive.exec.orc.write.format=0.11 when we query partitions with the old RLE, and set hive.exec.orc.write.format=null when we query partitions with RLEv2?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ericchu30","name":"ericchu30","key":"ericchu30","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Chu","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-11T07:35:45.049+0000","updated":"2013-12-11T07:35:45.049+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683013/comment/13845166","id":"13845166","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. If we have already started using RLE 0.11 for some partitions of the table and want to switch to RLEv2, would we need to rewrite existing partitions in RLEv2?\n\nYes. The partitions that used RLE 0.11 earlier needs to be rewritten to take advantage of RLEv2. In fact both RLE and RLEv2 partitions can co-exist. The advantage of using RLEv2 is that it has a better compression in most of the cases wrt old RLE because of improved run lengths and bit packing.\n\nbq. If not, would we need to set hive.exec.orc.write.format=0.11 when we query partitions with the old RLE, and set hive.exec.orc.write.format=null when we query partitions with RLEv2?\n\nNo.  reading the ORC files or while querying, there is no need to set hive.exec.orc.write.format config. The config is required only during writing the data. While reading ORC reader will read the version of RLE encoding used from the file footer.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-11T07:57:48.848+0000","updated":"2013-12-11T07:57:48.848+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683013/comment/13856024","id":"13856024","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcuso123","name":"rcuso123","key":"rcuso123","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"rcuso","active":true,"timeZone":"America/New_York"},"body":"FYI\n\nSetting set hive.exec.orc.write.format=0.11 (without quotes) resolved my error.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcuso123","name":"rcuso123","key":"rcuso123","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"rcuso","active":true,"timeZone":"America/New_York"},"created":"2013-12-23T23:49:30.225+0000","updated":"2013-12-23T23:49:30.225+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683013/comment/13857166","id":"13857166","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=leftylev","name":"leftylev","key":"lefty@hortonworks.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lefty%40hortonworks.com&avatarId=15906","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lefty%40hortonworks.com&avatarId=15906","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lefty%40hortonworks.com&avatarId=15906","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lefty%40hortonworks.com&avatarId=15906"},"displayName":"Lefty Leverenz","active":true,"timeZone":"America/New_York"},"body":"The wiki does not document hive.exec.orc.write.format, nor any other ORC configuration parameters.\n\nI found these in HiveConf.java with an \"orc\" search: \n\n* hive.exec.orc.memory.pool\n* hive.exec.orc.write.format\n* hive.exec.orc.default.stripe.size\n\nAlso, hive.default.fileformat can take the value ORC.  Are there any others?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=leftylev","name":"leftylev","key":"lefty@hortonworks.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lefty%40hortonworks.com&avatarId=15906","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lefty%40hortonworks.com&avatarId=15906","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lefty%40hortonworks.com&avatarId=15906","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lefty%40hortonworks.com&avatarId=15906"},"displayName":"Lefty Leverenz","active":true,"timeZone":"America/New_York"},"created":"2013-12-26T23:54:46.539+0000","updated":"2013-12-26T23:54:46.539+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683013/comment/13912231","id":"13912231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"body":"I just verified with the attached test data. This bug is solved by HIVE-6382.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-02-25T23:14:37.296+0000","updated":"2014-02-25T23:14:37.296+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683013/comment/14081237","id":"14081237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"body":"Closing this issue as I was able to verify HIVE-6382 solves the issue for the test data provided. Feel free to reopen the issue if this issue is not solved.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-07-31T18:25:33.013+0000","updated":"2014-07-31T18:25:33.013+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683013/comment/14089730","id":"14089730","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=leftylev","name":"leftylev","key":"lefty@hortonworks.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lefty%40hortonworks.com&avatarId=15906","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lefty%40hortonworks.com&avatarId=15906","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lefty%40hortonworks.com&avatarId=15906","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lefty%40hortonworks.com&avatarId=15906"},"displayName":"Lefty Leverenz","active":true,"timeZone":"America/New_York"},"body":"Just for the record, ORC parameters are now documented in the wiki:\n\n* [Configuration Properties -- ORC File Format | https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-ORCFileFormat]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=leftylev","name":"leftylev","key":"lefty@hortonworks.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lefty%40hortonworks.com&avatarId=15906","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lefty%40hortonworks.com&avatarId=15906","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lefty%40hortonworks.com&avatarId=15906","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lefty%40hortonworks.com&avatarId=15906"},"displayName":"Lefty Leverenz","active":true,"timeZone":"America/New_York"},"created":"2014-08-07T20:08:31.419+0000","updated":"2014-08-07T20:08:31.419+0000"}],"maxResults":13,"total":13,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5970/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qg27:"}}