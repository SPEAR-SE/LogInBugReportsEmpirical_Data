{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13097289","self":"https://issues.apache.org/jira/rest/api/2/issue/13097289","key":"HIVE-17383","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-08-28T06:01:14.938+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Sep 01 10:34:44 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-17383/watchers","watchCount":5,"isWatching":false},"created":"2017-08-24T11:29:47.828+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12513053","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12513053","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"outwardIssue":{"id":"13077179","key":"HIVE-16823","self":"https://issues.apache.org/jira/rest/api/2/issue/13077179","fields":{"summary":"\"ArrayIndexOutOfBoundsException\" in spark_vectorized_dynamic_partition_pruning.q","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-09-01T10:34:44.649+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[],"timeoriginalestimate":null,"description":"Query to reproduce:\n{noformat}\nset hive.cbo.enable=false;\nselect count(*) from (select key from src group by key) s where s.key='98';\n{noformat}\nThe stack trace is:\n{noformat}\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 1\n\tat org.apache.hadoop.hive.ql.exec.vector.VectorGroupKeyHelper.copyGroupKey(VectorGroupKeyHelper.java:107)\n\tat org.apache.hadoop.hive.ql.exec.vector.VectorGroupByOperator$ProcessingModeReduceMergePartial.doProcessBatch(VectorGroupByOperator.java:831)\n\tat org.apache.hadoop.hive.ql.exec.vector.VectorGroupByOperator$ProcessingModeBase.processBatch(VectorGroupByOperator.java:174)\n\tat org.apache.hadoop.hive.ql.exec.vector.VectorGroupByOperator.process(VectorGroupByOperator.java:1046)\n\tat org.apache.hadoop.hive.ql.exec.tez.ReduceRecordSource.processVectorGroup(ReduceRecordSource.java:462)\n\t... 18 more\n{noformat}\nMore details can be found in HIVE-16823","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12884629","id":"12884629","filename":"HIVE-17383.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-08-31T08:09:31.371+0000","size":4492,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12884629/HIVE-17383.1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"ArrayIndexOutOfBoundsException in VectorGroupByOperator","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097289/comment/16143405","id":"16143405","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kellyzly","name":"kellyzly","key":"kellyzly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liyunzhang","active":true,"timeZone":"Asia/Shanghai"},"body":"[~lirui]:  can you help to verify whether ArrayIndexOutOfBoundsException appear or not in above query? in my env(hive version:f86878b). No similar exception is thrown, this query passes. If there is a RS follows the GBY, the exception will not be thrown.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kellyzly","name":"kellyzly","key":"kellyzly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liyunzhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-08-28T06:01:14.938+0000","updated":"2017-08-28T06:01:14.938+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097289/comment/16143413","id":"16143413","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"[~kellyzly], I can reproduce the issue with latest master.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-08-28T06:19:54.095+0000","updated":"2017-08-28T06:19:54.095+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097289/comment/16143439","id":"16143439","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kellyzly","name":"kellyzly","key":"kellyzly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liyunzhang","active":true,"timeZone":"Asia/Shanghai"},"body":"[~lirui]: this passes in latest master(6be50b7) in my tez env. If there is some wrong with the configuration, tell me!\nquery\n{code}\nset hive.cbo.enable=false;\nset hive.user.install.directory=file:///tmp;\nset fs.default.name=file:///;\nset fs.defaultFS=file:///;\nset tez.staging-dir=/tmp;\nset tez.ignore.lib.uris=true;\nset tez.runtime.optimize.local.fetch=true;\nset tez.local.mode=true;\nset hive.explain.user=false;\nexplain select count(*) from (select key from src group by key) s where s.key='98';\n{code}\nexplain\n{code}\nSTAGE DEPENDENCIES:\n  Stage-1 is a root stage\n  Stage-0 depends on stages: Stage-1\n\nSTAGE PLANS:\n  Stage: Stage-1\n    Tez\n      DagId: root_20170828023743_be3df7bf-49cc-4c71-a4a7-25814558804c:1\n      Edges:\n        Reducer 2 <- Map 1 (SIMPLE_EDGE)\n        Reducer 3 <- Reducer 2 (CUSTOM_SIMPLE_EDGE)\n      DagName: root_20170828023743_be3df7bf-49cc-4c71-a4a7-25814558804c:1\n      Vertices:\n        Map 1 \n            Map Operator Tree:\n                TableScan\n                  alias: src\n                  Statistics: Num rows: 2906 Data size: 5812 Basic stats: COMPLETE Column stats: NONE\n                  Filter Operator\n                    predicate: (key = '98') (type: boolean)\n                    Statistics: Num rows: 1453 Data size: 2906 Basic stats: COMPLETE Column stats: NONE\n                    Select Operator\n                      Statistics: Num rows: 1453 Data size: 2906 Basic stats: COMPLETE Column stats: NONE\n                      Group By Operator\n                        keys: '98' (type: string)\n                        mode: hash\n                        outputColumnNames: _col0\n                        Statistics: Num rows: 1453 Data size: 2906 Basic stats: COMPLETE Column stats: NONE\n                        Reduce Output Operator\n                          key expressions: '98' (type: string)\n                          sort order: +\n                          Map-reduce partition columns: '98' (type: string)\n                          Statistics: Num rows: 1453 Data size: 2906 Basic stats: COMPLETE Column stats: NONE\n        Reducer 2 \n            Reduce Operator Tree:\n              Group By Operator\n                keys: '98' (type: string)\n                mode: mergepartial\n                outputColumnNames: _col0\n                Statistics: Num rows: 726 Data size: 1452 Basic stats: COMPLETE Column stats: NONE\n                Select Operator\n                  Statistics: Num rows: 726 Data size: 1452 Basic stats: COMPLETE Column stats: NONE\n                  Group By Operator\n                    aggregations: count()\n                    mode: hash\n                    outputColumnNames: _col0\n                    Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE\n                    Reduce Output Operator\n                      sort order: \n                      Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE\n                      value expressions: _col0 (type: bigint)\n        Reducer 3 \n            Reduce Operator Tree:\n              Group By Operator\n                aggregations: count(VALUE._col0)\n                mode: mergepartial\n                outputColumnNames: _col0\n                Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE\n                File Output Operator\n                  compressed: false\n                  Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE\n                  table:\n                      input format: org.apache.hadoop.mapred.SequenceFileInputFormat\n                      output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat\n                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe\n\n  Stage: Stage-0\n    Fetch Operator\n      limit: -1\n      Processor Tree:\n        ListSink\n\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kellyzly","name":"kellyzly","key":"kellyzly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liyunzhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-08-28T06:47:01.441+0000","updated":"2017-08-28T06:47:01.441+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097289/comment/16143449","id":"16143449","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"[~kellyzly], I don't see the works shown as vectorized in your explain. Have you enabled vectorization?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-08-28T06:56:28.054+0000","updated":"2017-08-28T06:56:28.054+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097289/comment/16143467","id":"16143467","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kellyzly","name":"kellyzly","key":"kellyzly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liyunzhang","active":true,"timeZone":"Asia/Shanghai"},"body":"[~lirui]: after enable vectorization, it throws ArrayIndexOutOfBoundsException.\nquery\n{code}\nset hive.cbo.enable=false;\nset hive.user.install.directory=file:///tmp;\nset fs.default.name=file:///;\nset fs.defaultFS=file:///;\nset tez.staging-dir=/tmp;\nset tez.ignore.lib.uris=true;\nset tez.runtime.optimize.local.fetch=true;\nset tez.local.mode=true;\nset hive.explain.user=false;\nset hive.vectorized.execution.enabled=true;\nselect count(*) from (select key from src group by key) s where s.key='98';\n{code}\nthe explain\n{code}\nSTAGE DEPENDENCIES:\n  Stage-1 is a root stage\n  Stage-0 depends on stages: Stage-1\n\nSTAGE PLANS:\n  Stage: Stage-1\n    Tez\n      DagId: root_20170828025707_7b882df3-3e96-47f0-b189-9b6919d44512:1\n      Edges:\n        Reducer 2 <- Map 1 (SIMPLE_EDGE)\n        Reducer 3 <- Reducer 2 (CUSTOM_SIMPLE_EDGE)\n      DagName: root_20170828025707_7b882df3-3e96-47f0-b189-9b6919d44512:1\n      Vertices:\n        Map 1 \n            Map Operator Tree:\n                TableScan\n                  alias: src\n                  Statistics: Num rows: 2906 Data size: 5812 Basic stats: COMPLETE Column stats: NONE\n                  Filter Operator\n                    predicate: (key = '98') (type: boolean)\n                    Statistics: Num rows: 1453 Data size: 2906 Basic stats: COMPLETE Column stats: NONE\n                    Select Operator\n                      Statistics: Num rows: 1453 Data size: 2906 Basic stats: COMPLETE Column stats: NONE\n                      Group By Operator\n                        keys: '98' (type: string)\n                        mode: hash\n                        outputColumnNames: _col0\n                        Statistics: Num rows: 1453 Data size: 2906 Basic stats: COMPLETE Column stats: NONE\n                        Reduce Output Operator\n                          key expressions: '98' (type: string)\n                          sort order: +\n                          Map-reduce partition columns: '98' (type: string)\n                          Statistics: Num rows: 1453 Data size: 2906 Basic stats: COMPLETE Column stats: NONE\n            Execution mode: vectorized\n        Reducer 2 \n            Execution mode: vectorized\n            Reduce Operator Tree:\n              Group By Operator\n                keys: '98' (type: string)\n                mode: mergepartial\n                outputColumnNames: _col0\n                Statistics: Num rows: 726 Data size: 1452 Basic stats: COMPLETE Column stats: NONE\n                Select Operator\n                  Statistics: Num rows: 726 Data size: 1452 Basic stats: COMPLETE Column stats: NONE\n                  Group By Operator\n                    aggregations: count()\n                    mode: hash\n                    outputColumnNames: _col0\n                    Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE\n                    Reduce Output Operator\n                      sort order: \n                      Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE\n                      value expressions: _col0 (type: bigint)\n        Reducer 3 \n            Execution mode: vectorized\n            Reduce Operator Tree:\n              Group By Operator\n                aggregations: count(VALUE._col0)\n                mode: mergepartial\n                outputColumnNames: _col0\n                Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE\n                File Output Operator\n                  compressed: false\n                  Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE\n                  table:\n                      input format: org.apache.hadoop.mapred.SequenceFileInputFormat\n                      output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat\n                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe\n\n  Stage: Stage-0\n    Fetch Operator\n      limit: -1\n      Processor Tree:\n        ListSink\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kellyzly","name":"kellyzly","key":"kellyzly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liyunzhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-08-28T07:17:19.624+0000","updated":"2017-08-28T07:17:19.624+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097289/comment/16148628","id":"16148628","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"Patch v1 uses the key index (instead of the vector expression's column index) for the output batch. Not sure if this the right way to go, trigger tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-08-31T08:13:26.610+0000","updated":"2017-08-31T08:13:26.610+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097289/comment/16148953","id":"16148953","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12884629/HIVE-17383.1.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 6 failed/errored test(s), 11005 tests executed\n*Failed tests:*\n{noformat}\nTestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=100)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=234)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.org.apache.hadoop.hive.cli.TestSparkCliDriver (batchId=103)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/6617/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/6617/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6617/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 6 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12884629 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-08-31T13:11:14.373+0000","updated":"2017-08-31T13:11:14.373+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097289/comment/16150314","id":"16150314","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"The failures can't be reproduced locally.\n[~mmccline], [~ashutoshc], [~gopalv] could you take a look? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-09-01T09:58:52.676+0000","updated":"2017-09-01T09:58:52.676+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097289/comment/16150330","id":"16150330","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kellyzly","name":"kellyzly","key":"kellyzly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liyunzhang","active":true,"timeZone":"Asia/Shanghai"},"body":"why say \"The failures can't be reproduced locally.\". Actually it can be reproduced in my env. Do you mean in latest master, this is fixed?\n\n\nNot very well understand the logic of vectorization.\nwhy {{firstOutputColumnIndex}} starts from {{initialColumnNames.length}}.  for example,if have 1 column, the {{firstOutputColumnIndex}} is from 1( normally the index is from 0).  When we construct the output batch, the column is from 1, is this right?\n{code}\n// Convenient constructor for initial batch creation takes\n  // a list of columns names and maps them to 0..n-1 indices.\n  public VectorizationContext(String contextName, List<String> initialColumnNames,\n      HiveConf hiveConf) {\n    this.contextName = contextName;\n    level = 0;\n    this.initialColumnNames = initialColumnNames;\n    this.projectionColumnNames = initialColumnNames;\n\n    projectedColumns = new ArrayList<Integer>();\n    projectionColumnMap = new HashMap<String, Integer>();\n    for (int i = 0; i < this.projectionColumnNames.size(); i++) {\n      projectedColumns.add(i);\n      projectionColumnMap.put(projectionColumnNames.get(i), i);\n    }\n\n    int firstOutputColumnIndex = projectedColumns.size();\n    this.ocm = new OutputColumnManager(firstOutputColumnIndex);\n    this.firstOutputColumnIndex = firstOutputColumnIndex;\n    vMap = new VectorExpressionDescriptor();\n\n    if (hiveConf != null) {\n      setHiveConfVars(hiveConf);\n    }\n  }\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kellyzly","name":"kellyzly","key":"kellyzly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liyunzhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-09-01T10:15:27.332+0000","updated":"2017-09-01T10:15:27.332+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13097289/comment/16150347","id":"16150347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"[~kellyzly], I mean the failures with age 1. Can you reproduce any of them with the patch in your env?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-09-01T10:34:44.649+0000","updated":"2017-09-01T10:34:44.649+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-17383/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3j8in:"}}