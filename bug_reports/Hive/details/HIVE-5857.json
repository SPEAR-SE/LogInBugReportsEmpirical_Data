{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12680071","self":"https://issues.apache.org/jira/rest/api/2/issue/12680071","key":"HIVE-5857","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324986","id":"12324986","description":"released","name":"0.13.0","archived":false,"released":true,"releaseDate":"2014-04-21"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-11-20T18:34:41.715+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Sep 04 18:24:10 UTC 2014","customfield_12310420":"359428","customfield_12312320":null,"customfield_12310222":"3_*:*_1_*:*_22873_*|*_10002_*:*_4_*:*_23571285011_*|*_1_*:*_3_*:*_1373767893_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-09-04T18:24:10.405+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5857/watchers","watchCount":8,"isWatching":false},"created":"2013-11-20T01:12:54.676+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":["plan","uber-jar","uberization","yarn"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324312","id":"12324312","description":"released","name":"0.12.0","archived":false,"released":true,"releaseDate":"2013-10-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324986","id":"12324986","description":"released","name":"0.13.0","archived":false,"released":true,"releaseDate":"2014-04-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12326829","id":"12326829","description":"0.13 maintenance release 1","name":"0.13.1","archived":false,"released":true,"releaseDate":"2014-06-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kawaa","name":"kawaa","key":"kawaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kawaa&avatarId=22332","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kawaa&avatarId=22332","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kawaa&avatarId=22332","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kawaa&avatarId=22332"},"displayName":"Adam Kawa","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-09-04T18:24:10.451+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"A Hive query fails when it tries to run a reduce task in uber mode in YARN.\n\nThe NullPointerException is thrown in the ExecReducer.configure method, because the plan file (reduce.xml) for a reduce task is not found.\n\nThe Utilities.getBaseWork method is expected to return BaseWork object, but it returns NULL due to FileNotFoundException. \n{code}\n// org.apache.hadoop.hive.ql.exec.Utilities\npublic static BaseWork getBaseWork(Configuration conf, String name) {\n  ...\n    try {\n    ...\n      if (gWork == null) {\n        Path localPath;\n        if (ShimLoader.getHadoopShims().isLocalMode(conf)) {\n          localPath = path;\n        } else {\n          localPath = new Path(name);\n        }\n        InputStream in = new FileInputStream(localPath.toUri().getPath());\n        BaseWork ret = deserializePlan(in);\n        ....\n      }\n      return gWork;\n    } catch (FileNotFoundException fnf) {\n      // happens. e.g.: no reduce work.\n      LOG.debug(\"No plan file found: \"+path);\n      return null;\n    } ...\n}\n{code}\n\nIt happens because, the ShimLoader.getHadoopShims().isLocalMode(conf)) method returns true, because immediately before running a reduce task, org.apache.hadoop.mapred.LocalContainerLauncher changes its configuration to local mode (\"mapreduce.framework.name\" is changed from\" \"yarn\" to \"local\"). On the other hand map tasks run successfully, because its configuration is not changed and still remains \"yarn\".\n\n{code}\n// org.apache.hadoop.mapred.LocalContainerLauncher\nprivate void runSubtask(..) {\n  ...\n  conf.set(MRConfig.FRAMEWORK_NAME, MRConfig.LOCAL_FRAMEWORK_NAME);\n  conf.set(MRConfig.MASTER_ADDRESS, \"local\");  // bypass shuffle\n\n  ReduceTask reduce = (ReduceTask)task;\n  reduce.setConf(conf);          \n\n  reduce.run(conf, umbilical);\n}\n{code}\n\nA super quick fix could just an additional if-branch, where we check if we run a reduce task in uber mode, and then look for a plan file in a different location.\n\n*Java stacktrace*\n\n{code}\n2013-11-20 00:50:56,862 INFO [uber-SubtaskRunner] org.apache.hadoop.hive.ql.exec.Utilities: No plan file found: hdfs://namenode.c.lon.spotify.net:54310/var/tmp/kawaa/hive_2013-11-20_00-50-43_888_3938384086824086680-2/-mr-10003/e3caacf6-15d6-4987-b186-d2906791b5b0/reduce.xml\n2013-11-20 00:50:56,862 WARN [uber-SubtaskRunner] org.apache.hadoop.mapred.LocalContainerLauncher: Exception running local (uberized) 'child' : java.lang.RuntimeException: Error in configuring object\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:109)\n\tat org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:75)\n\tat org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:133)\n\tat org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:427)\n\tat org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:408)\n\tat org.apache.hadoop.mapred.LocalContainerLauncher$SubtaskRunner.runSubtask(LocalContainerLauncher.java:340)\n\tat org.apache.hadoop.mapred.LocalContainerLauncher$SubtaskRunner.run(LocalContainerLauncher.java:225)\n\tat java.lang.Thread.run(Thread.java:662)\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:106)\n\t... 7 more\nCaused by: java.lang.NullPointerException\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.configure(ExecReducer.java:116)\n\t... 12 more\n\n2013-11-20 00:50:56,862 INFO [uber-SubtaskRunner] org.apache.hadoop.mapred.TaskAttemptListenerImpl: Status update from attempt_1384392632998_34791_r_000000_0\n2013-11-20 00:50:56,862 INFO [uber-SubtaskRunner] org.apache.hadoop.mapred.TaskAttemptListenerImpl: Progress of TaskAttempt attempt_1384392632998_34791_r_000000_0 is : 0.0\n2013-11-20 00:50:56,862 INFO [uber-SubtaskRunner] org.apache.hadoop.mapred.Task: Runnning cleanup for the task\n2013-11-20 00:50:56,863 INFO [uber-SubtaskRunner] org.apache.hadoop.mapred.TaskAttemptListenerImpl: Diagnostics report from attempt_1384392632998_34791_r_000000_0: java.lang.RuntimeException: Error in configuring object\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:109)\n\tat org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:75)\n\tat org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:133)\n\tat org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:427)\n\tat org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:408)\n\tat org.apache.hadoop.mapred.LocalContainerLauncher$SubtaskRunner.runSubtask(LocalContainerLauncher.java:340)\n\tat org.apache.hadoop.mapred.LocalContainerLauncher$SubtaskRunner.run(LocalContainerLauncher.java:225)\n\tat java.lang.Thread.run(Thread.java:662)\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:106)\n\t... 7 more\nCaused by: java.lang.NullPointerException\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.configure(ExecReducer.java:116)\n\t... 12 more\n\n2013-11-20 00:50:56,863 INFO [uber-SubtaskRunner] org.apache.hadoop.mapred.LocalContainerLauncher: Processing the event EventType: CONTAINER_REMOTE_CLEANUP for container container_1384392632998_34791_01_000001 taskAttempt attempt_1384392632998_34791_m_000000_0\n2013-11-20 00:50:56,863 INFO [AsyncDispatcher event handler] org.apache.hadoop.mapreduce.v2.app.job.impl.TaskAttemptImpl: Diagnostics report from attempt_1384392632998_34791_r_000000_0: java.lang.RuntimeException: Error in configuring object\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:109)\n\tat org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:75)\n\tat org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:133)\n\tat org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:427)\n\tat org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:408)\n\tat org.apache.hadoop.mapred.LocalContainerLauncher$SubtaskRunner.runSubtask(LocalContainerLauncher.java:340)\n\tat org.apache.hadoop.mapred.LocalContainerLauncher$SubtaskRunner.run(LocalContainerLauncher.java:225)\n\tat java.lang.Thread.run(Thread.java:662)\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:106)\n\t... 7 more\nCaused by: java.lang.NullPointerException\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.configure(ExecReducer.java:116)\n\t... 12 more\n{code}\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12614761","id":"12614761","filename":"HIVE-5857.1.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kawaa","name":"kawaa","key":"kawaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kawaa&avatarId=22332","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kawaa&avatarId=22332","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kawaa&avatarId=22332","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kawaa&avatarId=22332"},"displayName":"Adam Kawa","active":true,"timeZone":"Etc/UTC"},"created":"2013-11-20T01:27:53.304+0000","size":814,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12614761/HIVE-5857.1.patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12649938","id":"12649938","filename":"HIVE-5857.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kawaa","name":"kawaa","key":"kawaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kawaa&avatarId=22332","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kawaa&avatarId=22332","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kawaa&avatarId=22332","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kawaa&avatarId=22332"},"displayName":"Adam Kawa","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-11T23:08:27.424+0000","size":2427,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12649938/HIVE-5857.2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12649989","id":"12649989","filename":"HIVE-5857.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdere","name":"jdere","key":"jdere","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Dere","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-12T02:35:05.253+0000","size":6639,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12649989/HIVE-5857.3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12665524","id":"12665524","filename":"HIVE-5857.4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdere","name":"jdere","key":"jdere","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Dere","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-30T01:09:35.482+0000","size":3357,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12665524/HIVE-5857.4.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"359727","customfield_12312823":null,"summary":"Reduce tasks do not work in uber mode in YARN","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kawaa","name":"kawaa","key":"kawaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kawaa&avatarId=22332","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kawaa&avatarId=22332","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kawaa&avatarId=22332","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kawaa&avatarId=22332"},"displayName":"Adam Kawa","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kawaa","name":"kawaa","key":"kawaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kawaa&avatarId=22332","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kawaa&avatarId=22332","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kawaa&avatarId=22332","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kawaa&avatarId=22332"},"displayName":"Adam Kawa","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12680071/comment/13827950","id":"13827950","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12614761/HIVE-5857.1.patch.txt\n\n{color:green}SUCCESS:{color} +1 4665 tests passed\n\nTest results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/374/testReport\nConsole output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/374/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12614761","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-11-20T18:34:41.715+0000","updated":"2013-11-20T18:34:41.715+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12680071/comment/14009223","id":"14009223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"body":"[~kawaa]: Thanks for providing a fix. In order to get committed this patch needs a test case. Can you please add a qfile test that enables ubertask mode before running an aggregation query? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-27T02:12:47.243+0000","updated":"2014-05-27T02:12:47.243+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12680071/comment/14013514","id":"14013514","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kawaa","name":"kawaa","key":"kawaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kawaa&avatarId=22332","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kawaa&avatarId=22332","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kawaa&avatarId=22332","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kawaa&avatarId=22332"},"displayName":"Adam Kawa","active":true,"timeZone":"Etc/UTC"},"body":"[~cwsteinbach] Thanks for having a look on this patch. I will prepare tests during next week.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kawaa","name":"kawaa","key":"kawaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kawaa&avatarId=22332","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kawaa&avatarId=22332","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kawaa&avatarId=22332","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kawaa&avatarId=22332"},"displayName":"Adam Kawa","active":true,"timeZone":"Etc/UTC"},"created":"2014-05-30T11:17:37.439+0000","updated":"2014-05-30T11:17:37.439+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12680071/comment/14028757","id":"14028757","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdere","name":"jdere","key":"jdere","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Dere","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Adam, thanks for the patch/test.  I tried running your test, but when it runs as a regular q file test it doesn't actually fail when I comment out your fix. I've taken the liberty of making the test a MiniMR test, which does fail without your fix. Patch attached.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdere","name":"jdere","key":"jdere","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Dere","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-12T02:35:05.258+0000","updated":"2014-06-12T02:35:05.258+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12680071/comment/14028759","id":"14028759","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdere","name":"jdere","key":"jdere","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Dere","active":true,"timeZone":"America/Los_Angeles"},"body":"Question, your fix only kicks in in the case of REDUCE_PLAN_NAME .. would we ever need to worry about MAP_PLAN_NAME?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdere","name":"jdere","key":"jdere","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Dere","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-12T02:36:41.847+0000","updated":"2014-06-12T02:36:41.847+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12680071/comment/14029325","id":"14029325","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=appodictic","name":"appodictic","key":"appodictic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Capriolo","active":true,"timeZone":"Etc/UTC"},"body":"{code}\n } catch (FileNotFoundException fnf) {\n>       // happens. e.g.: no reduce work.\n>       LOG.debug(\"No plan file found: \"+path);\n>       return null;\n>     } ...\n{code}\n\nCan we remove this code? This bothers me. It is not self documenting all. Can we use if statements to determine when the file should be there and when it should not. \n\nSomething like:\nif (job.hasNoReduceWork()){\n  retur null;\n} else {\nthrow RuntimeException(\"work should be found but was not\" + expectedPathToFile);","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=appodictic","name":"appodictic","key":"appodictic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Capriolo","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-12T16:25:48.661+0000","updated":"2014-06-12T16:25:48.661+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12680071/comment/14030054","id":"14030054","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 at least one tests failed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12649989/HIVE-5857.3.patch\n\n{color:red}ERROR:{color} -1 due to 8 failed/errored test(s), 5610 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestHBaseCliDriver.testCliDriver_hbase_binary_storage_queries\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_dynpart_sort_optimization\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_insert1\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_load_dyn_part1\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_scriptfile1\norg.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_root_dir_external_table\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_ctas\norg.apache.hive.hcatalog.templeton.tool.TestTempletonUtils.testPropertiesParsing\n{noformat}\n\nTest results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/448/testReport\nConsole output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/448/console\nTest logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-Build-448/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 8 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12649989","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2014-06-13T00:03:12.209+0000","updated":"2014-06-13T00:03:12.209+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12680071/comment/14116153","id":"14116153","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdere","name":"jdere","key":"jdere","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Dere","active":true,"timeZone":"America/Los_Angeles"},"body":"Rebasing patch with trunk.\nAbout [this|https://issues.apache.org/jira/browse/HIVE-5857?focusedCommentId=14029325&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14029325], is there a way to know if a job should have reduce work or not, based on the conf or job? Would we be able to fix that part as a separate item?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdere","name":"jdere","key":"jdere","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Dere","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-30T01:09:35.487+0000","updated":"2014-08-30T01:09:35.487+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12680071/comment/14116205","id":"14116205","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 at least one tests failed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12665524/HIVE-5857.4.patch\n\n{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 6133 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hive.jdbc.miniHS2.TestHiveServer2.testConnection\n{noformat}\n\nTest results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/571/testReport\nConsole output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/571/console\nTest logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-571/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 1 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12665524","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2014-08-30T03:00:03.360+0000","updated":"2014-08-30T03:00:03.360+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12680071/comment/14116962","id":"14116962","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"+1\nLGTM, unless [~appodictic] has some suggestion on how to achieve what he suggested.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-01T01:18:22.083+0000","updated":"2014-09-01T01:18:22.083+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12680071/comment/14121716","id":"14121716","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdere","name":"jdere","key":"jdere","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Dere","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to trunk. Thanks [~kawaa] for fixing this!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdere","name":"jdere","key":"jdere","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Dere","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-09-04T18:24:10.441+0000","updated":"2014-09-04T18:24:10.441+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5857/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1pyn3:"}}