{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12712105","self":"https://issues.apache.org/jira/rest/api/2/issue/12712105","key":"HIVE-7012","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326450","id":"12326450","description":"released","name":"0.14.0","archived":false,"released":true,"releaseDate":"2014-11-12"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-05-07T08:48:19.824+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Nov 13 19:43:34 UTC 2014","customfield_12310420":"390424","customfield_12312320":null,"customfield_12310222":"10002_*:*_2_*:*_533080029_*|*_1_*:*_2_*:*_355950748_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-05-13T16:18:00.190+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-7012/watchers","watchCount":4,"isWatching":false},"created":"2014-05-03T09:20:49.466+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324986","id":"12324986","description":"released","name":"0.13.0","archived":false,"released":true,"releaseDate":"2014-04-21"}],"issuelinks":[{"id":"12387507","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12387507","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12695620","key":"HIVE-6455","self":"https://issues.apache.org/jira/rest/api/2/issue/12695620","fields":{"summary":"Scalable dynamic partitioning and bucketing optimization","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-11-13T19:43:34.960+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"With HIVE 0.13.0, run the following test case:\n{code:sql}\ncreate table src(key bigint, value string);\n\nselect  \n   count(distinct key) as col0\nfrom src\norder by col0;\n{code}\n\nThe following exception will be thrown:\n{noformat}\njava.lang.RuntimeException: Error in configuring object\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:93)\n\tat org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:64)\n\tat org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:117)\n\tat org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:485)\n\tat org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:420)\n\tat org.apache.hadoop.mapred.Child$4.run(Child.java:255)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:396)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1121)\n\tat org.apache.hadoop.mapred.Child.main(Child.java:249)\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:88)\n\t... 9 more\nCaused by: java.lang.RuntimeException: Reduce operator initialization failed\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.configure(ExecReducer.java:173)\n\t... 14 more\nCaused by: java.lang.RuntimeException: cannot find field _col0 from [0:reducesinkkey0]\n\tat org.apache.hadoop.hive.serde2.objectinspector.ObjectInspectorUtils.getStandardStructFieldRef(ObjectInspectorUtils.java:415)\n\tat org.apache.hadoop.hive.serde2.objectinspector.StandardStructObjectInspector.getStructFieldRef(StandardStructObjectInspector.java:150)\n\tat org.apache.hadoop.hive.ql.exec.ExprNodeColumnEvaluator.initialize(ExprNodeColumnEvaluator.java:79)\n\tat org.apache.hadoop.hive.ql.exec.GroupByOperator.initializeOp(GroupByOperator.java:288)\n\tat org.apache.hadoop.hive.ql.exec.Operator.initialize(Operator.java:376)\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.configure(ExecReducer.java:166)\n\t... 14 more\n{noformat}\n\nThis issue is related to HIVE-6455. When hive.optimize.reducededuplication is set to false, then this issue will be gone.\n\nLogical plan when hive.optimize.reducededuplication=false;\n{noformat}\nsrc \n  TableScan (TS_0)\n    alias: src\n    Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE\n    Select Operator (SEL_1)\n      expressions: key (type: bigint)\n      outputColumnNames: key\n      Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE\n      Group By Operator (GBY_2)\n        aggregations: count(DISTINCT key)\n        keys: key (type: bigint)\n        mode: hash\n        outputColumnNames: _col0, _col1\n        Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE\n        Reduce Output Operator (RS_3)\n          istinctColumnIndices:\n          key expressions: _col0 (type: bigint)\n          DistributionKeys: 0\n          sort order: +\n          OutputKeyColumnNames: _col0\n          Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE\n          Group By Operator (GBY_4)\n            aggregations: count(DISTINCT KEY._col0:0._col0)\n            mode: mergepartial\n            outputColumnNames: _col0\n            Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE\n            Select Operator (SEL_5)\n              expressions: _col0 (type: bigint)\n              outputColumnNames: _col0\n              Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE\n              Reduce Output Operator (RS_6)\n                key expressions: _col0 (type: bigint)\n                DistributionKeys: 1\n                sort order: +\n                OutputKeyColumnNames: reducesinkkey0\n                OutputVAlueColumnNames: _col0\n                Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE\n                value expressions: _col0 (type: bigint)\n                Extract (EX_7)\n                  Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE\n                  File Output Operator (FS_8)\n                    compressed: false\n                    Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE\n                    table:\n                        input format: org.apache.hadoop.mapred.TextInputFormat\n                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat\n                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe\n{noformat}\nYou will see that RS_3 and RS_6 are not merged.\n\nLogical plan when hive.optimize.reducededuplication=true;\n{noformat}\nsrc \n  TableScan (TS_0)\n    alias: src\n    Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE\n    Select Operator (SEL_1)\n      expressions: key (type: bigint)\n      outputColumnNames: key\n      Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE\n      Group By Operator (GBY_2)\n        aggregations: count(DISTINCT key)\n        keys: key (type: bigint)\n        mode: hash\n        outputColumnNames: _col0, _col1\n        Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE\n        Reduce Output Operator (RS_3)\n          istinctColumnIndices:\n          key expressions: _col0 (type: bigint)\n          DistributionKeys: 1\n          sort order: +\n          OutputKeyColumnNames: reducesinkkey0\n          Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE\n          Group By Operator (GBY_4)\n            aggregations: count(DISTINCT KEY._col0:0._col0)\n            mode: mergepartial\n            outputColumnNames: _col0\n            Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE\n            Select Operator (SEL_5)\n              expressions: _col0 (type: bigint)\n              outputColumnNames: _col0\n              Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE\n              File Output Operator (FS_8)\n                compressed: false\n                Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE\n                table:\n                    input format: org.apache.hadoop.mapred.TextInputFormat\n                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat\n                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe\n{noformat}\nYou will see that RS_6 has been merged into RS_3. However, Obviously the merge is incorrect because RS_3 and RS_6 have different sort keys. (The sort key for RS_3 is\nkey and the sort key for RS_6 is count(distinct key)).\n\nThe problem is that the method sameKeys() returns the result that both RS have same keys. sameKeys() depends ExprNodeDescUtils.backtrack() to backtrack a key expr of cRS to pRS.\n\nI don't understand the logical behind the following logic in ExprNodeDescUtils: \n  Why still backtrack when there is no mapping for the column of the current operator?\n{code}\n  private static ExprNodeDesc backtrack(ExprNodeColumnDesc column, Operator<?> current,\n      Operator<?> terminal) throws SemanticException {\n    ...\n    if (mapping == null || !mapping.containsKey(column.getColumn())) {\n      return backtrack((ExprNodeDesc)column, current, terminal);\n    }\n    ...\n  }\n{code}\nThe process of backtracking _col0 of cRS to pRS:\nRS_6:_col0 --> SEL_5:_col0 --> GBY_4:_col0 (because the colExprMap is null for GBY_4) --> RS_3:_col0 (No mapping for output column _col0), which is a wrong backtrack.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12643724","id":"12643724","filename":"HIVE-7012.1.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2014-05-07T08:45:25.327+0000","size":2059,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12643724/HIVE-7012.1.patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12644076","id":"12644076","filename":"HIVE-7012.2.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2014-05-09T05:55:58.869+0000","size":19280,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12644076/HIVE-7012.2.patch.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"390677","customfield_12312823":null,"summary":"Wrong RS de-duplication in the ReduceSinkDeDuplication Optimizer","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunrui","name":"sunrui","key":"sunrui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sun Rui","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunrui","name":"sunrui","key":"sunrui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sun Rui","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712105/comment/13988631","id":"13988631","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunrui","name":"sunrui","key":"sunrui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sun Rui","active":true,"timeZone":"Asia/Shanghai"},"body":"I am thinking about the following fix, but not sure if right:\n\nsameKeys():\n\n        ExprNodeDesc pexpr = pexprs.get(i);\n        ExprNodeDesc cexpr = ExprNodeDescUtils.backtrack(cexprs.get(i), child, parent);\n        // check if cexpr is from the parent\n        if (cexpr == null || (cexpr not contained in the colExprMap of the parent operator) || !pexpr.isSame(cexpr)) {\n          return null;\n        }","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunrui","name":"sunrui","key":"sunrui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sun Rui","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-05-03T09:28:17.653+0000","updated":"2014-05-03T09:28:17.653+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712105/comment/13991672","id":"13991672","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"[~sunrui] You're right. It's wrong assumption. I think there was some historical issue for things done like that. Let's see what will happen with the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2014-05-07T08:48:19.824+0000","updated":"2014-05-07T08:48:19.824+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712105/comment/13993301","id":"13993301","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 at least one tests failed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12643724/HIVE-7012.1.patch.txt\n\n{color:red}ERROR:{color} -1 due to 8 failed/errored test(s), 5433 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_fetch_aggregation\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppd2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_reduce_deduplicate_extended\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_partscan_1_23\norg.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_root_dir_external_table\norg.apache.hadoop.hive.ql.parse.TestParse.testParse_input20\norg.apache.hadoop.hive.ql.parse.TestParse.testParse_input4\norg.apache.hadoop.hive.ql.parse.TestParse.testParse_input5\n{noformat}\n\nTest results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/148/testReport\nConsole output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/148/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 8 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12643724","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2014-05-09T01:42:12.388+0000","updated":"2014-05-09T01:42:12.388+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712105/comment/13993768","id":"13993768","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"reduce_deduplicate_extended.q, ppd.q, fetch_aggregation.q failures might be relevant. [~navis] can you take a look?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-09T18:07:12.351+0000","updated":"2014-05-09T18:07:12.351+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712105/comment/13993937","id":"13993937","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Please ignore my previous comment, it seems your new patch takes care of those failures.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-09T21:32:04.822+0000","updated":"2014-05-09T21:32:04.822+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712105/comment/13993941","id":"13993941","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"In ppd2.q.out looks like new MR stage got added, looks like RS-dedup optimization got disabled for it. That looks like performance regression. Was that intentional ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-09T21:36:01.222+0000","updated":"2014-05-09T21:36:01.222+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712105/comment/13994368","id":"13994368","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunrui","name":"sunrui","key":"sunrui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sun Rui","active":true,"timeZone":"Asia/Shanghai"},"body":"[~navis] I verified that your patch solved my problem. \n\n[~navis] and [~yhuai] However, I suspect that the optimizer may still have bug when there are distinct expressions. It seems that the optimizer has not taken support for distinct keys into consideration when it was being implemented. Note that keyCols in ReduceSinkDesc is composed of groupby keys and possibly distinct keys. For example, assume cRS and pRS both have KeyCols as (a, b, c, d) and numDistributionKeys=2. cRS may have distinct expressions like distinct(c, d) while pRS may have distinct expressions like distinct(c), distinct(d). In this case, they have different sort keys while their KeyCols are same. [~yhuai] what do you think?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunrui","name":"sunrui","key":"sunrui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sun Rui","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-05-11T01:30:24.752+0000","updated":"2014-05-11T01:30:24.752+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712105/comment/13994580","id":"13994580","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 at least one tests failed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12644076/HIVE-7012.2.patch.txt\n\n{color:red}ERROR:{color} -1 due to 2 failed/errored test(s), 5503 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_partscan_1_23\norg.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_root_dir_external_table\n{noformat}\n\nTest results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/174/testReport\nConsole output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/174/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 2 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12644076","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2014-05-11T15:30:53.485+0000","updated":"2014-05-11T15:30:53.485+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712105/comment/13994895","id":"13994895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"[~ashutoshc] Yes, it's intended. In the query ppd2.q\n{code}\nselect a.*\n  from (\n    select key, count(value) as cc\n    from srcpart a\n    where a.ds = '2008-04-08' and a.hr = '11'\n    group by key\n  )a\n  distribute by a.key\n  sort by a.key,a.cc desc\n{code}\ncc is generated field by GBY operator, so It's semantically wrong to merge the RS for GBY with any following RS. But the same time, sort on \"a.cc\" is meaningless so it can be removed in optimizing, but not in here (maybe in SemanticAnalyzer?).\n\n[~sunrui] Yes, RS for distinct should be avoided from any dedup process. Could you take this issue? I think you knows better than me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2014-05-12T07:41:34.770+0000","updated":"2014-05-12T07:42:14.831+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712105/comment/13995204","id":"13995204","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 Issue raised by [~sunrui] if exists will probably require a different fix, which we shall take up in separate jira. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-12T16:15:03.450+0000","updated":"2014-05-12T16:15:03.450+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712105/comment/13995846","id":"13995846","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunrui","name":"sunrui","key":"sunrui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sun Rui","active":true,"timeZone":"Asia/Shanghai"},"body":"For the issue about distinct, I will investigate it later and if I can find a real test case, I will submit a separate jira.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunrui","name":"sunrui","key":"sunrui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sun Rui","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-05-13T00:09:05.501+0000","updated":"2014-05-13T00:09:05.501+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712105/comment/13996551","id":"13996551","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to trunk. Thanks, Navis!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-13T16:18:00.219+0000","updated":"2014-05-13T16:18:00.219+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712105/comment/14210995","id":"14210995","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"This has been fixed in 0.14 release. Please open new jira if you see any issues.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-13T19:43:34.944+0000","updated":"2014-11-13T19:43:34.944+0000"}],"maxResults":13,"total":13,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-7012/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1v90n:"}}