{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12412412","self":"https://issues.apache.org/jira/rest/api/2/issue/12412412","key":"HIVE-233","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2009-03-11T00:25:19.018+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 18 23:15:30 UTC 2009","customfield_12310420":"73687","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_5455097672_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-03-18T23:15:30.672+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-233/watchers","watchCount":2,"isWatching":false},"created":"2009-01-14T19:57:13.328+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313637","id":"12313637","description":"released","name":"0.3.0","archived":false,"released":true,"releaseDate":"2009-04-30"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=besquared","name":"besquared","key":"besquared","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Josh Ferguson","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-03-18T23:15:30.669+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"When attempting to run a query of the form \n\nINSERT OVERWRITE TABLE table_name PARTITION ( ... ) SELECT TRANSFORM ... \n\nThe table 'table_name' ends up empty even when the SELECT statement returns valid results that can be loaded by hand.\n\n*My target table*\n\nCREATE TABLE percentiles\n(actor_id STRING, percentile INT, count INT) \nPARTITIONED BY (account STRING, application STRING, dataset STRING, hour INT, span INT) \nCLUSTERED BY (actor_id) INTO 32 BUCKETS \nROW FORMAT DELIMITED \nCOLLECTION ITEMS TERMINATED BY '44'\nMAP KEYS TERMINATED BY '58'\nSTORED AS TEXTFILE;\n\n*The attempted query*\n\nINSERT OVERWRITE TABLE percentiles PARTITION ( account='cUU5T7y6DmdzMJFcFt3JDe', application='test', dataset='test', hour=341976, span=168 ) SELECT TRANSFORM(actor_id) USING '/Users/Josh/cluster/bin/percentiles.rb' AS (actor_id, percentile, count) FROM ( SELECT actor_id FROM activities CLUSTER BY actor_id ) actors;\n\n*The result in hadoop (which is 0 bytes)*\n\n$ hadoop fs -ls /user/hive/warehouse/percentiles/*/*/*/*/*\n-rw-r--r--   1 Josh supergroup          0 2009-01-14 11:19 /user/hive/warehouse/percentiles/account=cUU5T7y6DmdzMJFcFt3JDe/application=test/dataset=test/hour=341976/span=168/attempt_200901131908_0009_r_000000_0\n\n*Inserting into a temporary directory first*\n\nhive> INSERT OVERWRITE DIRECTORY 'hdfs://localhost:9000/tmp/hdfs_out' SELECT TRANSFORM(actor_id) USING '/Users/Josh/cluster/bin/percentiles.rb' AS (actor_id, percentile, count) FROM ( SELECT actor_id FROM activities CLUSTER BY actor_id ) actors;\n\n*The results in hadoop (8600 bytes)*\n\n$ hadoop fs -ls /tmp/hdfs_out\nFound 1 items\n-rw-r--r--   1 Josh supergroup       8600 2009-01-14 11:27 /tmp/hdfs_out/attempt_200901131908_0010_r_000000_0\n\n*Loading from the temporary directory into percentiles*\n\nhive> LOAD DATA INPATH 'hdfs://localhost:9000/tmp/hdfs_out' INTO TABLE percentiles PARTITION ( account='cUU5T7y6DmdzMJFcFt3JDe', application='test', dataset='test', hour=341976, span=168 ); \nLoading data to table percentiles partition {account=cUU5T7y6DmdzMJFcFt3JDe, application=test, dataset=test, hour=341976, span=168}\nOK\n\n*The results in hadoop (8600 bytes)*\n\n$ hadoop fs -ls /user/hive/warehouse/percentiles/*/*/*/*/*\n-rw-r--r--   1 Josh supergroup       8600 2009-01-14 11:27 /user/hive/warehouse/percentiles/account=cUU5T7y6DmdzMJFcFt3JDe/application=test/dataset=test/hour=341976/span=168/attempt_200901131908_0010_r_000000_0\n\nSo it works fine when loading via a LOAD DATA statement from a temporary directory but not in a query with an INSERT OVERWRITE statement.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"122052","customfield_12312823":null,"summary":"Inserting into a table from a map/reduce transform results in no data","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=besquared","name":"besquared","key":"besquared","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Josh Ferguson","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=besquared","name":"besquared","key":"besquared","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Josh Ferguson","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412412/comment/12680703","id":"12680703","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"body":"Marking this as a blocker for 0.3 as we need to understand this better and see if there is a workaround.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-11T00:25:19.018+0000","updated":"2009-03-11T00:25:19.018+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412412/comment/12681417","id":"12681417","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"CREATE TABLE dest1(key INT, value STRING, key1 INT, value1 STRING) partitioned by (ds string\\\n, hour string) STORED AS TEXTFILE;\n\nFROM (\n  FROM src\n  SELECT TRANSFORM(src.key, src.value, src.key, src.value)\n         USING '/bin/cat' AS (tkey, tvalue, tkey1, tvalue1)\n  CLUSTER BY tkey\n) tmap\nINSERT OVERWRITE TABLE dest1 PARTITION (ds='2009-03-10', hour='2') SELECT tmap.tkey, tmap.tv\\\nalue, tmap.tkey1, tmap.tvalue1 WHERE tmap.tkey < 100;\n\nSELECT dest1.* FROM dest1;\n\n\nThe above testcase works fine.\n\nJosh, can you give more details ? data in activities table, your mapper script.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-03-12T17:53:05.512+0000","updated":"2009-03-12T17:53:05.512+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412412/comment/12681556","id":"12681556","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=besquared","name":"besquared","key":"besquared","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Josh Ferguson","active":true,"timeZone":"Etc/UTC"},"body":"Sadly due to this issue I have changed the way I write and execute all my queries so I don't really have any of the queries or setup around for doing it anymore. If your test cases work then maybe I was just doing something wrong. I may have another case in the future where I make a query sort of like this one again but it won't be for a while.\n\nMaybe this issue should just be marked as something else for now. \n\nmy activities table looks like this:\n\nCREATE TABLE activities \n(occurred_at INT, actor_id STRING, actee_id STRING, properties MAP<STRING, STRING>) \nPARTITIONED BY (account STRING, application STRING, dataset STRING, hour INT) \nCLUSTERED BY (actor_id, actee_id) INTO 32 BUCKETS \nROW FORMAT DELIMITED \nCOLLECTION ITEMS TERMINATED BY '44'\nMAP KEYS TERMINATED BY '58'\nSTORED AS TEXTFILE;\n\nThe script can output anything in the proper format and the results are the same.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=besquared","name":"besquared","key":"besquared","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Josh Ferguson","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-13T00:23:06.199+0000","updated":"2009-03-13T00:23:06.199+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412412/comment/12683231","id":"12683231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"Closing it for now since it could not be reproduced","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-03-18T23:15:30.648+0000","updated":"2009-03-18T23:15:30.648+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-233/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0l8nj:"}}