{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12956375","self":"https://issues.apache.org/jira/rest/api/2/issue/12956375","key":"HIVE-13432","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2016-04-10T08:04:34.177+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Jun 12 07:14:43 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_5712788293_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2016-06-11T06:43:15.241+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-13432/watchers","watchCount":4,"isWatching":false},"created":"2016-04-06T03:50:07.010+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332384","id":"12332384","name":"1.2.1","archived":false,"released":true,"releaseDate":"2015-06-26"}],"issuelinks":[{"id":"12469461","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12469461","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12978242","key":"HIVE-14004","self":"https://issues.apache.org/jira/rest/api/2/issue/12978242","fields":{"summary":"Minor compaction produces ArrayIndexOutOfBoundsException: 7 in SchemaEvolution.getFileType","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmccline","name":"mmccline","key":"mmccline","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mmccline&avatarId=36046","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mmccline&avatarId=36046","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mmccline&avatarId=36046","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mmccline&avatarId=36046"},"displayName":"Matt McCline","active":true,"timeZone":"America/Chicago"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-06-13T17:52:32.472+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12328244","id":"12328244","name":"ORC"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12322671","id":"12322671","name":"Transactions","description":"Transaction management and ACID"}],"timeoriginalestimate":null,"description":"After initiating HIVE ACID ORC table compaction, the CompactorMR job throws exception:\n\nError: java.lang.ArrayIndexOutOfBoundsException: 7\n\tat org.apache.hadoop.hive.ql.io.orc.TreeReaderFactory$StructTreeReader.<init>(TreeReaderFactory.java:1968)\n\tat org.apache.hadoop.hive.ql.io.orc.TreeReaderFactory.createTreeReader(TreeReaderFactory.java:2368)\n\tat org.apache.hadoop.hive.ql.io.orc.TreeReaderFactory$StructTreeReader.<init>(TreeReaderFactory.java:1969)\n\tat org.apache.hadoop.hive.ql.io.orc.TreeReaderFactory.createTreeReader(TreeReaderFactory.java:2368)\n\tat org.apache.hadoop.hive.ql.io.orc.RecordReaderFactory.createTreeReader(RecordReaderFactory.java:69)\n\tat org.apache.hadoop.hive.ql.io.orc.RecordReaderImpl.<init>(RecordReaderImpl.java:202)\n\tat org.apache.hadoop.hive.ql.io.orc.ReaderImpl.rowsOptions(ReaderImpl.java:539)\n\tat org.apache.hadoop.hive.ql.io.orc.OrcRawRecordMerger$ReaderPair.<init>(OrcRawRecordMerger.java:183)\n\tat org.apache.hadoop.hive.ql.io.orc.OrcRawRecordMerger.<init>(OrcRawRecordMerger.java:466)\n\tat org.apache.hadoop.hive.ql.io.orc.OrcInputFormat.getRawReader(OrcInputFormat.java:1308)\n\tat org.apache.hadoop.hive.ql.txn.compactor.CompactorMR$CompactorMap.map(CompactorMR.java:512)\n\tat org.apache.hadoop.hive.ql.txn.compactor.CompactorMR$CompactorMap.map(CompactorMR.java:491)\n\tat org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:54)\n\tat org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:450)\n\tat org.apache.hadoop.mapred.MapTask.run(MapTask.java:343)\n\tat org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:163)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1656)\n\tat org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)\n\nAs a result, we see hadoop exception stack,\n\n297 failed with state FAILED due to: Task failed task_1458819387386_11297_m_000008\nJob failed as tasks failed. failedMaps:1 failedReduces:0\n\n2016-04-06 11:30:57,891 INFO  [dn209006-27]: mapreduce.Job (Job.java:monitorAndPrintJob(1392)) - Counters: 14\n  Job Counters \n    Failed map tasks=16\n    Killed map tasks=7\n    Launched map tasks=23\n    Other local map tasks=13\n    Data-local map tasks=6\n    Rack-local map tasks=4\n    Total time spent by all maps in occupied slots (ms)=412592\n    Total time spent by all reduces in occupied slots (ms)=0\n    Total time spent by all map tasks (ms)=206296\n    Total vcore-seconds taken by all map tasks=206296\n    Total megabyte-seconds taken by all map tasks=422494208\n  Map-Reduce Framework\n    CPU time spent (ms)=0\n    Physical memory (bytes) snapshot=0\n    Virtual memory (bytes) snapshot=0\n2016-04-06 11:30:57,891 ERROR [dn209006-27]: compactor.Worker (Worker.java:run(176)) - Caught exception while trying to compact lqz.my_orc_acid_table.  Marking clean to avoid repeated failures, java.io.IOException: Job failed!\n  at org.apache.hadoop.mapred.JobClient.runJob(JobClient.java:836)\n  at org.apache.hadoop.hive.ql.txn.compactor.CompactorMR.run(CompactorMR.java:186)\n  at org.apache.hadoop.hive.ql.txn.compactor.Worker.run(Worker.java:162)\n\n2016-04-06 11:30:57,894 ERROR [dn209006-27]: txn.CompactionTxnHandler (CompactionTxnHandler.java:markCleaned(327)) - Expected to remove at least one row from completed_txn_components when marking compaction entry as clean!","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12809364","id":"12809364","filename":"orc_hive-site.xml","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-06-10T05:37:19.078+0000","size":7907,"mimeType":"text/xml","content":"https://issues.apache.org/jira/secure/attachment/12809364/orc_hive-site.xml"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"ACID ORC CompactorMR job throws java.lang.ArrayIndexOutOfBoundsException: 7","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Hadoop 2.6.2+Hive 1.2.1","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12956375/comment/15227974","id":"15227974","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"body":"Can someone confirm that this is related to issue of https://issues.apache.org/jira/browse/HIVE-11981?\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-04-06T08:55:54.179+0000","updated":"2016-04-06T08:55:54.179+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12956375/comment/15233975","id":"15233975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmccline","name":"mmccline","key":"mmccline","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mmccline&avatarId=36046","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mmccline&avatarId=36046","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mmccline&avatarId=36046","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mmccline&avatarId=36046"},"displayName":"Matt McCline","active":true,"timeZone":"America/Chicago"},"body":"I ported a number of commits from master to branch-2.0, including:\n\nHIVE-12894 Detect whether ORC is reading from ACID table correctly for Schema Evolution (Matt McCline, reviewed by Prasanth J and Eugene Koifman)\n\nwhich may fix this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmccline","name":"mmccline","key":"mmccline","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mmccline&avatarId=36046","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mmccline&avatarId=36046","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mmccline&avatarId=36046","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mmccline&avatarId=36046"},"displayName":"Matt McCline","active":true,"timeZone":"America/Chicago"},"created":"2016-04-10T08:04:34.177+0000","updated":"2016-04-10T08:04:34.177+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12956375/comment/15234424","id":"15234424","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"body":"I will build hive 2.1/2.0.1 and let you know to see if it works. Many thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-04-11T02:33:13.153+0000","updated":"2016-04-11T02:33:13.153+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12956375/comment/15234463","id":"15234463","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi Matt, \n\nI build hive from hive git branch 2.0 and see patch of 12984, I try compaction again on the same ACID table but still see the same error,\n\n, kind: TIMESTAMP\n, kind: INT\n] innerStructSubtype -1\n  at org.apache.hadoop.hive.ql.io.orc.TreeReaderFactory$StructTreeReader.<init>(TreeReaderFactory.java:2092)\n  at org.apache.hadoop.hive.ql.io.orc.TreeReaderFactory.createTreeReader(TreeReaderFactory.java:2518)\n  at org.apache.hadoop.hive.ql.io.orc.TreeReaderFactory$StructTreeReader.<init>(TreeReaderFactory.java:2098)\n  at org.apache.hadoop.hive.ql.io.orc.TreeReaderFactory.createTreeReader(TreeReaderFactory.java:2518)\n  at org.apache.hadoop.hive.ql.io.orc.RecordReaderImpl.<init>(RecordReaderImpl.java:210)\n  at org.apache.hadoop.hive.ql.io.orc.ReaderImpl.rowsOptions(ReaderImpl.java:662)\n  at org.apache.hadoop.hive.ql.io.orc.OrcRawRecordMerger$ReaderPair.<init>(OrcRawRecordMerger.java:212)\n  at org.apache.hadoop.hive.ql.io.orc.OrcRawRecordMerger.<init>(OrcRawRecordMerger.java:512)\n  at org.apache.hadoop.hive.ql.io.orc.OrcInputFormat.getRawReader(OrcInputFormat.java:1870)\n  at org.apache.hadoop.hive.ql.txn.compactor.CompactorMR$CompactorMap.map(CompactorMR.java:575)\n  at org.apache.hadoop.hive.ql.txn.compactor.CompactorMR$CompactorMap.map(CompactorMR.java:554)\n  at org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:54)\n  at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:450)\n  at org.apache.hadoop.mapred.MapTask.run(MapTask.java:343)\n  at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:163)\n  at java.security.AccessController.doPrivileged(Native Method)\n  at javax.security.auth.Subject.doAs(Subject.java:415)\n  at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1656)\n  at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)\n\n16/04/11 11:54:21 INFO mapreduce.Job:  map 100% reduce 0%\n16/04/11 11:54:21 INFO mapreduce.Job: Job job_1458819387386_23797 failed with state FAILED due to: Task failed task_1458819387386_23797_m_000001\nJob failed as tasks failed. failedMaps:1 failedReduces:0\n\n16/04/11 11:54:21 INFO mapreduce.Job: Counters: 14\n  Job Counters \n    Failed map tasks=9\n    Killed map tasks=9\n    Launched map tasks=18\n    Other local map tasks=8\n    Data-local map tasks=4\n    Rack-local map tasks=6\n    Total time spent by all maps in occupied slots (ms)=405068\n    Total time spent by all reduces in occupied slots (ms)=0\n    Total time spent by all map tasks (ms)=202534\n    Total vcore-seconds taken by all map tasks=202534\n    Total megabyte-seconds taken by all map tasks=414789632\n  Map-Reduce Framework\n    CPU time spent (ms)=0\n    Physical memory (bytes) snapshot=0\n    Virtual memory (bytes) snapshot=0\n16/04/11 11:54:21 ERROR compactor.Worker: Caught exception while trying to compact id:80,dbname:lqz,tableName:my_acid_orc_table,partName:null,state:,type:MAJOR,runAs:null,tooManyAborts:false,highestTxnId:0.  Marking clean to avoid repeated failures, java.io.IOException: Job failed!\n  at org.apache.hadoop.mapred.JobClient.runJob(JobClient.java:836)\n  at org.apache.hadoop.hive.ql.txn.compactor.CompactorMR.launchCompactionJob(CompactorMR.java:247)\n  at org.apache.hadoop.hive.ql.txn.compactor.CompactorMR.run(CompactorMR.java:213)\n  at org.apache.hadoop.hive.ql.txn.compactor.Worker.run(Worker.java:164)\n\n16/04/11 11:54:34 INFO txn.AcidCompactionHistoryService: History reaper reaper ran for 0seconds.  isAliveCounter=-2147483642\n\nPlease let me know if you need more info for this issue. \n\nRegards,\nQiuzhuang","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-04-11T03:56:54.693+0000","updated":"2016-04-11T03:56:54.693+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12956375/comment/15234480","id":"15234480","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"body":"For more info, I also see the regression to the ACID feature for delete statement,\n\n16/04/11 12:38:43 WARN shims.HadoopShimsSecure: Can't fetch tasklog: TaskLogServlet is not supported in MR2 mode.\n\nTask with the most failures(4): \n-----\nTask ID:\n  task_1458819387386_23814_r_000003\n\nURL:\n  http://nn209003:8088/taskdetails.jsp?jobid=job_1458819387386_23814&tipid=task_1458819387386_23814_r_000003\n-----\nDiagnostic Messages for this Task:\nError: java.lang.RuntimeException: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row (tag=0) {\"key\":{\"reducesinkkey0\":{\"transactionid\":0,\"bucketid\":43,\"rowid\":0}},\"value\":null}\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.reduce(ExecReducer.java:257)\n\tat org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:444)\n\tat org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:392)\n\tat org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:163)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1656)\n\tat org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)\nCaused by: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row (tag=0) {\"key\":{\"reducesinkkey0\":{\"transactionid\":0,\"bucketid\":43,\"rowid\":0}},\"value\":null}\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.reduce(ExecReducer.java:245)\n\t... 7 more\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 1\n\tat org.apache.hadoop.hive.ql.exec.FileSinkOperator.process(FileSinkOperator.java:759)\n\tat org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:837)\n\tat org.apache.hadoop.hive.ql.exec.SelectOperator.process(SelectOperator.java:97)\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.reduce(ExecReducer.java:236)\n\t... 7 more\n\n\n16/04/11 12:38:43 ERROR exec.Task: \nTask with the most failures(4): \n-----\nTask ID:\n  task_1458819387386_23814_r_000003\n\nURL:\n  http://nn209003:8088/taskdetails.jsp?jobid=job_1458819387386_23814&tipid=task_1458819387386_23814_r_000003\n-----\nDiagnostic Messages for this Task:\nError: java.lang.RuntimeException: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row (tag=0) {\"key\":{\"reducesinkkey0\":{\"transactionid\":0,\"bucketid\":43,\"rowid\":0}},\"value\":null}\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.reduce(ExecReducer.java:257)\n\tat org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:444)\n\tat org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:392)\n\tat org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:163)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1656)\n\tat org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)\nCaused by: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row (tag=0) {\"key\":{\"reducesinkkey0\":{\"transactionid\":0,\"bucketid\":43,\"rowid\":0}},\"value\":null}\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.reduce(ExecReducer.java:245)\n\t... 7 more\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 1\n\tat org.apache.hadoop.hive.ql.exec.FileSinkOperator.process(FileSinkOperator.java:759)\n\tat org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:837)\n\tat org.apache.hadoop.hive.ql.exec.SelectOperator.process(SelectOperator.java:97)\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.reduce(ExecReducer.java:236)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-04-11T04:40:11.780+0000","updated":"2016-04-11T04:40:11.780+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12956375/comment/15303470","id":"15303470","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi Matt,\n\nSince we are blocked by this issue, can you please help take a look at this?\n\nMany thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-05-27T04:40:22.167+0000","updated":"2016-05-27T04:40:22.167+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12956375/comment/15316134","id":"15316134","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmccline","name":"mmccline","key":"mmccline","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mmccline&avatarId=36046","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mmccline&avatarId=36046","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mmccline&avatarId=36046","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mmccline&avatarId=36046"},"displayName":"Matt McCline","active":true,"timeZone":"America/Chicago"},"body":"In order to help, I need a repro.\n\nI need a *small self-contained test case*.  DLL for test input files, small amount of data, and the queries to run.  In particular, if any schema changes like adding a column would be critical.  The stack traces provided are insufficient for me to make progress.\n\nThe ACID code has undergone a huge amount of change in the last year.  Also, there has been a lot of change for Schema Evolution.\n\nThere is a new Hive-2 branch (branch-2.1) being readied.  RC0 as created and a new RC1 is in progress.  It has very recent ACID and Schema Evolution changes.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmccline","name":"mmccline","key":"mmccline","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mmccline&avatarId=36046","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mmccline&avatarId=36046","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mmccline&avatarId=36046","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mmccline&avatarId=36046"},"displayName":"Matt McCline","active":true,"timeZone":"America/Chicago"},"created":"2016-06-06T02:31:02.047+0000","updated":"2016-06-06T02:31:02.047+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12956375/comment/15323485","id":"15323485","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmccline","name":"mmccline","key":"mmccline","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mmccline&avatarId=36046","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mmccline&avatarId=36046","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mmccline&avatarId=36046","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mmccline&avatarId=36046"},"displayName":"Matt McCline","active":true,"timeZone":"America/Chicago"},"body":"We might have a clue of what is causing this problem.\n\nWe have one test case where \"minor\" compaction fails when hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat but succeeds when that environment variable is org.apache.hadoop.hive.ql.io.HiveInputFormat","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmccline","name":"mmccline","key":"mmccline","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mmccline&avatarId=36046","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mmccline&avatarId=36046","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mmccline&avatarId=36046","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mmccline&avatarId=36046"},"displayName":"Matt McCline","active":true,"timeZone":"America/Chicago"},"created":"2016-06-09T22:18:51.854+0000","updated":"2016-06-09T22:18:51.854+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12956375/comment/15323902","id":"15323902","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"body":"Sorry for delay response. Yes, our hive-site.xml uses CombineHiveInputFormat. I should have sent you our hive-site.xml. Please check the attached to see if any more clue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-06-10T05:31:38.574+0000","updated":"2016-06-10T05:31:38.574+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12956375/comment/15324302","id":"15324302","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmccline","name":"mmccline","key":"mmccline","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mmccline&avatarId=36046","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mmccline&avatarId=36046","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mmccline&avatarId=36046","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mmccline&avatarId=36046"},"displayName":"Matt McCline","active":true,"timeZone":"America/Chicago"},"body":"At the moment, the repro seems to involve deletions and minor compact.  Investigating.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmccline","name":"mmccline","key":"mmccline","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mmccline&avatarId=36046","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mmccline&avatarId=36046","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mmccline&avatarId=36046","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mmccline&avatarId=36046"},"displayName":"Matt McCline","active":true,"timeZone":"America/Chicago"},"created":"2016-06-10T11:12:18.246+0000","updated":"2016-06-10T11:12:18.246+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12956375/comment/15325752","id":"15325752","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmccline","name":"mmccline","key":"mmccline","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mmccline&avatarId=36046","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mmccline&avatarId=36046","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mmccline&avatarId=36046","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mmccline&avatarId=36046"},"displayName":"Matt McCline","active":true,"timeZone":"America/Chicago"},"body":"HIVE-13974\n\n(ACID Delete Events have slight different schema than other ACID records)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmccline","name":"mmccline","key":"mmccline","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mmccline&avatarId=36046","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mmccline&avatarId=36046","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mmccline&avatarId=36046","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mmccline&avatarId=36046"},"displayName":"Matt McCline","active":true,"timeZone":"America/Chicago"},"created":"2016-06-11T06:43:15.285+0000","updated":"2016-06-11T06:43:15.285+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12956375/comment/15326232","id":"15326232","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"body":"I remove this configuration when running compactorMR job and it looks ok now. BTW, is this CombineHiveInputFormat issue related to the recent fix of HIVE-13968?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qiuzhuang.lian","name":"qiuzhuang.lian","key":"qiuzhuang.lian","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Qiuzhuang Lian","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-06-12T07:14:43.876+0000","updated":"2016-06-12T07:14:43.876+0000"}],"maxResults":12,"total":12,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-13432/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2vp87:"}}