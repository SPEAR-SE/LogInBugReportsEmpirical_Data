{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12682703","self":"https://issues.apache.org/jira/rest/api/2/issue/12682703","key":"HIVE-5945","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324986","id":"12324986","description":"released","name":"0.13.0","archived":false,"released":true,"releaseDate":"2014-04-21"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-12-11T01:27:33.639+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jan 16 17:46:52 UTC 2014","customfield_12310420":"361960","customfield_12312320":null,"customfield_12310222":"10002_*:*_8_*:*_2412038309_*|*_1_*:*_8_*:*_1311290856_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-01-16T17:46:29.562+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5945/watchers","watchCount":2,"isWatching":false},"created":"2013-12-04T15:31:00.432+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"8.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316178","id":"12316178","description":"released","name":"0.8.0","archived":false,"released":true,"releaseDate":"2011-12-16"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12317742","id":"12317742","description":"released","name":"0.9.0","archived":false,"released":true,"releaseDate":"2012-04-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12320745","id":"12320745","description":"released","name":"0.10.0","archived":false,"released":true,"releaseDate":"2013-01-11"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323587","id":"12323587","description":"Hive 0.11.0","name":"0.11.0","archived":false,"released":true,"releaseDate":"2013-05-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324312","id":"12324312","description":"released","name":"0.12.0","archived":false,"released":true,"releaseDate":"2013-10-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324986","id":"12324986","description":"released","name":"0.13.0","archived":false,"released":true,"releaseDate":"2014-04-21"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-01-16T17:46:52.220+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"Here is an example\n{code}\nselect\n   i_item_id,\n   s_state,\n   avg(ss_quantity) agg1,\n   avg(ss_list_price) agg2,\n   avg(ss_coupon_amt) agg3,\n   avg(ss_sales_price) agg4\nFROM store_sales\nJOIN date_dim on (store_sales.ss_sold_date_sk = date_dim.d_date_sk)\nJOIN item on (store_sales.ss_item_sk = item.i_item_sk)\nJOIN customer_demographics on (store_sales.ss_cdemo_sk = customer_demographics.cd_demo_sk)\nJOIN store on (store_sales.ss_store_sk = store.s_store_sk)\nwhere\n   cd_gender = 'F' and\n   cd_marital_status = 'U' and\n   cd_education_status = 'Primary' and\n   d_year = 2002 and\n   s_state in ('GA','PA', 'LA', 'SC', 'MI', 'AL')\ngroup by\n   i_item_id,\n   s_state\norder by\n   i_item_id,\n   s_state\nlimit 100;\n{\\code}\nI turned off noconditionaltask. So, I expected that there will be 4 Map-only jobs for this query. However, I got 1 Map-only job (joining strore_sales and date_dim) and 3 MR job (for reduce joins.)\n\nSo, I checked the conditional task determining the plan of the join involving item. In ql.plan.ConditionalResolverCommonJoin.resolveMapJoinTask, aliasToFileSizeMap contains all input tables used in this query and the intermediate table generated by joining store_sales and date_dim. So, when we sum the size of all small tables, the size of store_sales (which is around 45GB in my test) will be also counted.  ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12618153","id":"12618153","filename":"HIVE-5945.1.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-12-11T01:24:02.943+0000","size":13967,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12618153/HIVE-5945.1.patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12618185","id":"12618185","filename":"HIVE-5945.2.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-12-11T05:13:20.502+0000","size":14781,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12618185/HIVE-5945.2.patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12619255","id":"12619255","filename":"HIVE-5945.3.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-12-18T05:03:42.084+0000","size":16560,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12619255/HIVE-5945.3.patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12620580","id":"12620580","filename":"HIVE-5945.4.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-12-27T03:12:06.054+0000","size":15626,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12620580/HIVE-5945.4.patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12620793","id":"12620793","filename":"HIVE-5945.5.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-12-30T02:20:10.988+0000","size":19826,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12620793/HIVE-5945.5.patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12621023","id":"12621023","filename":"HIVE-5945.6.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2014-01-02T02:34:16.933+0000","size":20785,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12621023/HIVE-5945.6.patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12622571","id":"12622571","filename":"HIVE-5945.7.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2014-01-13T02:33:30.275+0000","size":21087,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12622571/HIVE-5945.7.patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12622597","id":"12622597","filename":"HIVE-5945.8.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2014-01-13T08:45:53.936+0000","size":22292,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12622597/HIVE-5945.8.patch.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"362255","customfield_12312823":null,"summary":"ql.plan.ConditionalResolverCommonJoin.resolveMapJoinTask also sums those tables which are not used in the child of this conditional task.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13838991","id":"13838991","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"aliasToFileSizeMap should have aliases used in the next stage instead of all tables. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2013-12-04T15:37:10.595+0000","updated":"2013-12-04T15:37:10.595+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13839008","id":"13839008","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"Seems this bug was introduced by HIVE-2095. I am marking all affected versions.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2013-12-04T15:49:02.762+0000","updated":"2013-12-04T15:49:02.762+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13844912","id":"13844912","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"Running test. \n\nI've heard MapJoin is not working after upgrading 0.11.0. HIVE-4042 (ignoring mapjoin hint) which is included 0.11.0 seemed revealed this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-12-11T01:27:33.639+0000","updated":"2013-12-11T01:27:33.639+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13844968","id":"13844968","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"Thanks [~navis] for taking this issue. Can you attach the link to the review board? Also, I saw \n{code}\n+                // todo: should nullify summary for non-native tables,\n+                // not to be selected as a mapjoin target\n{\\code}\nin your patch. Does a \"non-native\" table mean an intermediate table? If so, I think for a conditional task, it's better to keep the option to use the intermediate table as the small table.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2013-12-11T01:58:26.119+0000","updated":"2013-12-11T01:58:26.119+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13844980","id":"13844980","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"\"non-native table\" is table based on custom storage handler something like HBaseStorageHandler. In this case input summary for the table directory always contains 0 file and 0 length, which might confuse mapjoin resolver to take the table small enough to be hashed.\n\nI'll make a review board entry.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-12-11T02:11:22.478+0000","updated":"2013-12-11T02:11:22.478+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13845045","id":"13845045","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 at least one tests failed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12618153/HIVE-5945.1.patch.txt\n\n{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 4761 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_infer_bucket_sort_convert_join\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_mapjoin_hook\norg.apache.hadoop.hive.cli.TestHBaseCliDriver.testCliDriver_hbase_scan_params\n{noformat}\n\nTest results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/605/testReport\nConsole output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/605/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 3 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12618153","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-12-11T03:43:00.193+0000","updated":"2013-12-11T03:43:00.193+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13845076","id":"13845076","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"Fixed infer_bucket_sort_convert_join.q and mapjoin_hook, but cannot reproduce hbase_scan_params.q (it does not have any joins)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-12-11T05:13:20.507+0000","updated":"2013-12-11T05:13:20.507+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13845262","id":"13845262","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12618185/HIVE-5945.2.patch.txt\n\n{color:green}SUCCESS:{color} +1 4761 tests passed\n\nTest results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/611/testReport\nConsole output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/611/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12618185","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-12-11T10:15:45.880+0000","updated":"2013-12-11T10:15:45.880+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13851260","id":"13851260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"Thanks [~navis] :) I left a few comments on the review board. I think the conditional task in the original trunk is not well tested. With a .q test file, we cannot test if a conditional task picks the right execution plan because the result of a .q file only shows the plan and the result. I think it is necessary to add a junit test to unit test the decision of resolveMapJoinTask. Also, let's add some logs in resolveMapJoinTask. Right now, we only have \"xx is filtered out by condition resolver.\" and \"xx is selected by condition resolver.\" in ConditionalTask. Through these two logs, we cannot know why a execution plan is selected. In resolveMapJoinTask, we can first log the size of tables which will be used in next task and then log why a path is selected.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2013-12-18T01:54:13.050+0000","updated":"2013-12-18T01:54:13.050+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13851459","id":"13851459","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12619255/HIVE-5945.3.patch.txt\n\n{color:green}SUCCESS:{color} +1 4762 tests passed\n\nTest results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/682/testReport\nConsole output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/682/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12619255","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-12-18T07:15:01.119+0000","updated":"2013-12-18T07:15:01.119+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13851756","id":"13851756","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"Two minor comments in the review board.\n\nTwo additional comments.\nWhen we find \n{code}\nbigTableFileAlias != null\n{\\code}\ncan we also log sumOfOthers and the threshold of the size of small tables? So, the log entry will show the size of the big table, the total size of other small tables, and the threshold of the size of small tables.\nAlso, can you add a unit test?\n\nThanks :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2013-12-18T14:08:29.016+0000","updated":"2013-12-18T14:08:29.016+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13857297","id":"13857297","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12620580/HIVE-5945.4.patch.txt\n\n{color:green}SUCCESS:{color} +1 4817 tests passed\n\nTest results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/747/testReport\nConsole output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/747/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12620580","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-12-27T04:23:51.407+0000","updated":"2013-12-27T04:23:51.407+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13858495","id":"13858495","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"Missed comments in here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-12-30T00:46:37.332+0000","updated":"2013-12-30T00:46:37.332+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13858568","id":"13858568","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12620793/HIVE-5945.5.patch.txt\n\n{color:green}SUCCESS:{color} +1 4818 tests passed\n\nTest results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/767/testReport\nConsole output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/767/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12620793","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-12-30T05:25:07.622+0000","updated":"2013-12-30T05:25:07.622+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13859114","id":"13859114","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"Thanks Navis :) I played with your patch and found a issue which I commented at the review board. I am also attaching more info at here. For the query in the description, we can have 4 map-joins. There will be 3 different intermediate tables called $INTNAME. The current patch does not update the size of $INTNAME.\n\nHere are logs.\n{code}\n13/12/30 16:48:25 INFO ql.Driver: MapReduce Jobs Launched: \nJob 0: Map: 1   Cumulative CPU: 12.76 sec   HDFS Read: 388445624 HDFS Write: 20815654 SUCCESS\n13/12/30 16:48:25 INFO ql.Driver: Job 0: Map: 1   Cumulative CPU: 12.76 sec   HDFS Read: 388445624 HDFS Write: 20815654 SUCCESS\nJob 1: Map: 1   Cumulative CPU: 9.18 sec   HDFS Read: 20816111 HDFS Write: 28593993 SUCCESS\n13/12/30 16:48:25 INFO ql.Driver: Job 1: Map: 1   Cumulative CPU: 9.18 sec   HDFS Read: 20816111 HDFS Write: 28593993 SUCCESS\nJob 2: Map: 1   Cumulative CPU: 17.38 sec   HDFS Read: 80660331 HDFS Write: 378063 SUCCESS\n13/12/30 16:48:25 INFO ql.Driver: Job 2: Map: 1   Cumulative CPU: 17.38 sec   HDFS Read: 80660331 HDFS Write: 378063 SUCCESS\nJob 3: Map: 1   Cumulative CPU: 2.06 sec   HDFS Read: 378520 HDFS Write: 96 SUCCESS\n13/12/30 16:48:25 INFO ql.Driver: Job 3: Map: 1   Cumulative CPU: 2.06 sec   HDFS Read: 378520 HDFS Write: 96 SUCCESS\nJob 4: Map: 1  Reduce: 1   Cumulative CPU: 2.45 sec   HDFS Read: 553 HDFS Write: 96 SUCCESS\n13/12/30 16:48:25 INFO ql.Driver: Job 4: Map: 1  Reduce: 1   Cumulative CPU: 2.45 sec   HDFS Read: 553 HDFS Write: 96 SUCCESS\nJob 5: Map: 1  Reduce: 1   Cumulative CPU: 2.33 sec   HDFS Read: 553 HDFS Write: 0 SUCCESS\n13/12/30 16:48:25 INFO ql.Driver: Job 5: Map: 1  Reduce: 1   Cumulative CPU: 2.33 sec   HDFS Read: 553 HDFS Write: 0 SUCCESS\nTotal MapReduce CPU Time Spent: 46 seconds 160 msec\n{code}\n\n{code}\nMap-join1:\nplan.ConditionalResolverCommonJoin: Driver alias is store_sales with size 388445409 (total size of others : 0, threshold : 25000000)\nStage-28 is selected by condition resolver.\n\nMap-join2:\nplan.ConditionalResolverCommonJoin: Driver alias is $INTNAME with size 20815654 (total size of others : 5051899, threshold : 25000000)\nStage-26 is selected by condition resolver.\n\nMap-join3:\n plan.ConditionalResolverCommonJoin: Driver alias is customer_demographics with size 80660096 (total size of others : 20815654, threshold : 25000000)\nStage-24 is filtered out by condition resolver.\n\nMap-join4:\nplan.ConditionalResolverCommonJoin: Driver alias is $INTNAME with size 20815654 (total size of others : 3155, threshold : 25000000)\nStage-22 is selected by condition resolver.\n{code}\n\n\nbtw, a minor question. Why the log of map-join 1 shows the size of others 0?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2013-12-30T21:52:27.385+0000","updated":"2013-12-30T21:52:27.385+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13859982","id":"13859982","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"[~yhuai] Ah.. right. I'll check that (and zero size issue also). Thanks for the enlightening.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2014-01-02T01:28:42.009+0000","updated":"2014-01-02T01:28:42.009+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13859994","id":"13859994","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"Made not to share size of intermediate tables among ConditionalTasks, seemingly solving invalid lengths. But I cannot reproduce zero length problem. Is it(date_dim) non-native table?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2014-01-02T02:34:16.937+0000","updated":"2014-01-02T02:34:16.937+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13861465","id":"13861465","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12621023/HIVE-5945.6.patch.txt\n\n{color:green}SUCCESS:{color} +1 4873 tests passed\n\nTest results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/790/testReport\nConsole output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/790/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12621023","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2014-01-03T12:13:28.608+0000","updated":"2014-01-03T12:13:28.608+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13863047","id":"13863047","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"Thanks Navis for the change. date_dim is a native table. Actually, I think the problem is org.apache.hadoop.hive.ql.plan.ConditionalResolverCommonJoin.getParticipants. It uses ctx.getAliasToTask(); to get all aliases. However, these aliases do not include aliases appearing in the MapLocalWork (those small tables.). So for a query like \n{code}\nset hive.auto.convert.join.noconditionaltask=false;\nselect\n   i_item_id\nFROM store_sales\nJOIN item on (store_sales.ss_item_sk = item.i_item_sk)\nlimit 10;\n{code}\n\nThe plan is \n{code}\nSTAGE DEPENDENCIES:\n  Stage-5 is a root stage , consists of Stage-6, Stage-1\n  Stage-6 has a backup stage: Stage-1\n  Stage-3 depends on stages: Stage-6\n  Stage-1\n  Stage-0 is a root stage\n\nSTAGE PLANS:\n  Stage: Stage-5\n    Conditional Operator\n\n  Stage: Stage-6\n    Map Reduce Local Work\n      Alias -> Map Local Tables:\n        item \n          Fetch Operator\n            limit: -1\n      Alias -> Map Local Operator Tree:\n        item \n          TableScan\n            alias: item\n            HashTable Sink Operator\n              condition expressions:\n                0 \n                1 {i_item_id}\n              handleSkewJoin: false\n              keys:\n                0 [Column[ss_item_sk]]\n                1 [Column[i_item_sk]]\n              Position of Big Table: 0\n\n  Stage: Stage-3\n    Map Reduce\n      Alias -> Map Operator Tree:\n        store_sales \n          TableScan\n            alias: store_sales\n            Map Join Operator\n              condition map:\n                   Inner Join 0 to 1\n              condition expressions:\n                0 \n                1 {i_item_id}\n              handleSkewJoin: false\n              keys:\n                0 [Column[ss_item_sk]]\n                1 [Column[i_item_sk]]\n              outputColumnNames: _col26\n              Position of Big Table: 0\n              Select Operator\n                expressions:\n                      expr: _col26\n                      type: string\n                outputColumnNames: _col0\n                Limit\n                  File Output Operator\n                    compressed: false\n                    GlobalTableId: 0\n                    table:\n                        input format: org.apache.hadoop.mapred.TextInputFormat\n                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat\n                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe\n      Local Work:\n        Map Reduce Local Work\n\n  Stage: Stage-1\n    Map Reduce\n      Alias -> Map Operator Tree:\n        item \n          TableScan\n            alias: item\n            Reduce Output Operator\n              key expressions:\n                    expr: i_item_sk\n                    type: int\n              sort order: +\n              Map-reduce partition columns:\n                    expr: i_item_sk\n                    type: int\n              tag: 1\n              value expressions:\n                    expr: i_item_id\n                    type: string\n        store_sales \n          TableScan\n            alias: store_sales\n            Reduce Output Operator\n              key expressions:\n                    expr: ss_item_sk\n                    type: int\n              sort order: +\n              Map-reduce partition columns:\n                    expr: ss_item_sk\n                    type: int\n              tag: 0\n      Reduce Operator Tree:\n        Join Operator\n          condition map:\n               Inner Join 0 to 1\n          condition expressions:\n            0 \n            1 {VALUE._col1}\n          handleSkewJoin: false\n          outputColumnNames: _col26\n          Select Operator\n            expressions:\n                  expr: _col26\n                  type: string\n            outputColumnNames: _col0\n            Limit\n              File Output Operator\n                compressed: false\n                GlobalTableId: 0\n                table:\n                    input format: org.apache.hadoop.mapred.TextInputFormat\n                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat\n                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe\n\n  Stage: Stage-0\n    Fetch Operator\n      limit: 10\n{code}\nThe alias of \"item\" will not be in the set returned by getParticipants. Thus, the input of sumOfExcept will be \n{code}\naliasToSize: {store_sales=388445409, item=5051899}\naliases: [store_sales]\nexcept: store_sales\n{code}\nand then we get \"0\" for the size of small tables.\n\nI think in getParticipants, we can check the type of a task and if it is a MapRedTask, we can use getWork().getMapWork().getMapLocalWork() to get the local task. Then, we can get aliases of those small tables through aliasToWork.\n\nAnother minor comment. Can you add a comment for the method of clone in the class of ConditionalResolverCommonJoinCtx to explain why we only want to copy aliasToKnownSize?\n\nThanks :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2014-01-06T15:33:02.832+0000","updated":"2014-01-06T15:33:02.832+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13869351","id":"13869351","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 at least one tests failed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12622571/HIVE-5945.7.patch.txt\n\n{color:red}ERROR:{color} -1 due to 5 failed/errored test(s), 4917 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_auto_join30\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_auto_join31\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_auto_join_filters\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union22\norg.apache.hadoop.hive.ql.plan.TestConditionalResolverCommonJoin.testResolvingDriverAlias\n{noformat}\n\nTest results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/877/testReport\nConsole output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/877/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 5 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12622571","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2014-01-13T08:07:22.386+0000","updated":"2014-01-13T08:07:22.386+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13869579","id":"13869579","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12622597/HIVE-5945.8.patch.txt\n\n{color:green}SUCCESS:{color} +1 4917 tests passed\n\nTest results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/882/testReport\nConsole output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/882/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12622597","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2014-01-13T14:32:51.346+0000","updated":"2014-01-13T14:32:51.346+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13872582","id":"13872582","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2014-01-15T20:57:44.103+0000","updated":"2014-01-15T20:57:44.103+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682703/comment/13873656","id":"13873656","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"Committed to trunk. Thanks, Navis!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2014-01-16T17:46:52.220+0000","updated":"2014-01-16T17:46:52.220+0000"}],"maxResults":23,"total":23,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5945/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qe6f:"}}