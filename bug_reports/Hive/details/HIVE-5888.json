{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12681214","self":"https://issues.apache.org/jira/rest/api/2/issue/12681214","key":"HIVE-5888","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-11-26T16:42:25.427+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Apr 08 21:15:10 UTC 2014","customfield_12310420":"360479","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5888/watchers","watchCount":6,"isWatching":false},"created":"2013-11-26T06:42:55.641+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323587","id":"12323587","description":"Hive 0.11.0","name":"0.11.0","archived":false,"released":true,"releaseDate":"2013-05-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324312","id":"12324312","description":"released","name":"0.12.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"issuelinks":[{"id":"12384205","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12384205","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12685148","key":"HIVE-6041","self":"https://issues.apache.org/jira/rest/api/2/issue/12685148","fields":{"summary":"Incorrect task dependency graph for skewed join optimization","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-04-08T21:15:10.358+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":null,"customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"360778","customfield_12312823":null,"summary":"group by after join operation product no result when  hive.optimize.skewjoin = true ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cyril.liao","name":"cyril.liao","key":"cyril.liao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"cyril liao","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cyril.liao","name":"cyril.liao","key":"cyril.liao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"cyril liao","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12681214/comment/13832362","id":"13832362","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cyril.liao","name":"cyril.liao","key":"cyril.liao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"cyril liao","active":true,"timeZone":"Asia/Shanghai"},"body":"if hive.optimize.skewjoin is set to false,we got right result","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cyril.liao","name":"cyril.liao","key":"cyril.liao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"cyril liao","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-11-26T06:43:51.375+0000","updated":"2013-11-26T06:43:51.375+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12681214/comment/13832748","id":"13832748","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"[~cyril.liao] If you have a reproducible test case, can you please add it here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-11-26T16:42:25.427+0000","updated":"2013-11-26T16:42:25.427+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12681214/comment/13920354","id":"13920354","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.jian.fang","name":"john.jian.fang","key":"john.jian.fang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian Fang","active":true,"timeZone":"America/Los_Angeles"},"body":"We had the same problem for Hive 0.11. Ankit created a JIRA at https://issues.apache.org/jira/browse/HIVE-6520.\n\nBased on Ankit's observation, here is the root cause of the problem:\n\n--------------------------------------------------------------------------\nHive's Skew join optimization is a physical optimization that changes the operator DAG (At compile time, Hive first creates a basic operator DAG and then various optimizations optimize it). After compile time skew join optimization, the skew join related nodes will look like: (MR job with Reduce Join Operator (Stage-1))->(Conditional Skew Join Task that performs Map Join (Stage-2)). When Skew Join optimization kicks in at compile time, it sets a flag \"handleSkewJoin\" in Stage-1. At run time, Stage-1 performs following (provided \"handleSkewJoin\" flag was set):\n\n1. Join unskewed keys through normal MR job.\n2. Copies data with skewed keys (from all tables) in a specific directory structure in hdfs.\n\nStage-2 then picks the skewed data and performs Map Join. The Map Join of the skewed keys is the real optimization because it saves running reducer which has to copy intermediate data from mappers.\n\nHive also has Map Join Optimization and this is the cause of the problem. A normal map-reduce join is converted to map join if (n-1) small tables can fit in memory. If this happens, at compile time, after both map join and skew join optimization, nodes will look like: (MR job with Map Join Operator (Stage-1))->(Conditional Skew Join Task that performs Map Join (Stage-2)).\n\nNow the problem is that Skew Join optimization sets \"handleSkewJoin\" only for \"Reduce Join Operator\" in Stage-1 (it assumes there will be a reducer). So, in case there is \"Map Join Operator\", \"handleSkewJoin\" flag is not set and Stage-1 doesn't copy skewed keys in hdfs. When Stage-2 runs, it is not able to find skewed key directory and it gets eliminated at run time. Therefore, no results are displayed. \n---------------------------------------------------------\n\nI tried to set hive.optimize.skewjoin=true and hive.auto.convert.join=false so that stage-1 would not be converted to a mapjoin to work around this problem. But the reduce phase in stage-1 took an extremely long time. We had 200 reducers, most of them only have 5 or 6 input keys and all the remaining keys were distributed to two reducers. \n\nSeems the two reducers created very big RowContainer files on local disk, for example.\n\n-rwxrwxrwx 1 hadoop hadoop 334G Mar  5 00:56 RowContainer6650985529012862786.[129].tmp\n-rw-r--r-- 1 hadoop hadoop 2.7G Mar  5 00:56 .RowContainer6650985529012862786.[129].tmp.crc\n\nThis behavior is really weird. The inconsistent results caused a lot trouble for us. \n\nIs there any way to work around this problem? \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.jian.fang","name":"john.jian.fang","key":"john.jian.fang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian Fang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-05T01:20:12.328+0000","updated":"2014-03-05T01:20:12.328+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12681214/comment/13920493","id":"13920493","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"I believe this is fixed by HIVE-6041, which is included in hive-0.13.0. There remains a minor issue in explain result. But it makes valid result now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2014-03-05T04:49:40.332+0000","updated":"2014-03-05T04:49:40.332+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12681214/comment/13921057","id":"13921057","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.jian.fang","name":"john.jian.fang","key":"john.jian.fang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian Fang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks a lot. Will try the fix in HIVE-6041. Could you please explain the weird behavior when I set  hive.optimize.skewjoin=true and hive.auto.convert.join=false? Why almost all keys were distributed to only two reducers? Like to make sure there is no other bugs in the skewjoin logic.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.jian.fang","name":"john.jian.fang","key":"john.jian.fang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian Fang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-05T17:16:19.948+0000","updated":"2014-03-05T17:16:19.948+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12681214/comment/13921063","id":"13921063","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.jian.fang","name":"john.jian.fang","key":"john.jian.fang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian Fang","active":true,"timeZone":"America/Los_Angeles"},"body":"Also, the two reducers often failed because no space left on device. This could be a big problem.\n\n\njava.lang.RuntimeException: org.apache.hadoop.fs.FSError: java.io.IOException: No space left on device\n\tat org.apache.hadoop.hive.ql.exec.ExecReducer.reduce(ExecReducer.java:278)\n\tat org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:528)\n\tat org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:429)\n\tat org.apache.hadoop.mapred.Child$4.run(Child.java:255)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1140)\n\tat org.apache.hadoop.mapred.Child.main(Child.java:249)\nCaused by: org.apache.hadoop.fs.FSError: java.io.IOException: No space left on device\n\tat org.apache.hadoop.fs.RawLocalFileSystem$LocalFSFileOutputStream.write(RawLocalFileSystem.java:200)\n\tat org.apache.hadoop.fs.FSDataOutputStream$PositionCache.write(FSDataOutputStream.java:57)\n\tat java.io.DataOutputStream.write(DataOutputStream.java:107)\n\tat org.apache.hadoop.fs.ChecksumFileSystem$ChecksumFSOutputSummer.writeChunk(ChecksumFileSystem.java:354)\n\tat org.apache.hadoop.fs.FSOutputSummer.writeChecksumChunk(FSOutputSummer.java:150)\n\tat org.apache.hadoop.fs.FSOutputSummer.flushBuffer(FSOutputSummer.java:132)\n\tat org.apache.hadoop.fs.FSOutputSummer.flushBuffer(FSOutputSummer.java:121)\n\tat org.apache.hadoop.fs.FSOutputSummer.write1(FSOutputSummer.java:112)\n\tat org.apache.hadoop.fs.FSOutputSummer.write(FSOutputSummer.java:86)\n\tat org.apache.hadoop.fs.FSDataOutputStream$PositionCache.write(FSDataOutputStream.java:57)\n\tat java.io.DataOutputStream.write(DataOutputStream.java:107)\n\tat org.apache.hadoop.io.SequenceFile$Writer.append(SequenceFile.java:1115)\n\tat org.apache.hadoop.io.SequenceFile$Writer.append(SequenceFile.java:1076)\n\tat org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat$1.write(HiveSequenceFileOutputFormat.java:77)\n\tat org.apache.hadoop.hive.ql.exec.persistence.RowContainer.spillBlock(RowContainer.java:334)\n\tat org.apache.hadoop.hive.ql.exec.persistence.RowContainer.add(RowContainer.java:164)\n\tat org.apache.hadoop.hive.ql.exec.persistence.RowContainer.add(RowContainer.java:74)\n\tat org.apache.hadoop.hive.ql.exec.JoinOperator.processOp(JoinOperator.java:127)\n\tat org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:502)\n\tat org.apache.hadoop.hive.ql.exec.ExecReducer.reduce(ExecReducer.java:257)\n\t... 7 more\nCaused by: java.io.IOException: No space left on device\n\tat java.io.FileOutputStream.writeBytes(Native Method)\n\tat java.io.FileOutputStream.write(FileOutputStream.java:345)\n\tat org.apache.hadoop.fs.RawLocalFileSystem$LocalFSFileOutputStream.write(RawLocalFileSystem.java:198)\n\t... 26 more","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.jian.fang","name":"john.jian.fang","key":"john.jian.fang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian Fang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-05T17:24:13.038+0000","updated":"2014-03-05T17:24:13.038+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12681214/comment/13921355","id":"13921355","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.jian.fang","name":"john.jian.fang","key":"john.jian.fang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian Fang","active":true,"timeZone":"America/Los_Angeles"},"body":"Cherry picked HIVE-6041 patch from branch-0.13 to hive 0.11, but got the following errors. Are there any other patches I need to pick to make it work?\n\nTotal MapReduce jobs = 9\njava.io.FileNotFoundException: java.io.FileNotFoundException: File does not exist: /mnt/var/lib/hive_0110/tmp/scratch/hive_2014-03-05_20-12-41_114_4395627082352200171/-mr-10002\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)\n        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n        at java.lang.reflect.Constructor.newInstance(Constructor.java:526)\n        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:95)\n        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:57)\n        at org.apache.hadoop.hdfs.DFSClient.getContentSummary(DFSClient.java:1315)\n        at org.apache.hadoop.hdfs.DistributedFileSystem.getContentSummary(DistributedFileSystem.java:240)\n        at org.apache.hadoop.hive.ql.plan.ConditionalResolverCommonJoin.resolveMapJoinTask(ConditionalResolverCommonJoin.java:185)\n        at org.apache.hadoop.hive.ql.plan.ConditionalResolverCommonJoin.getTasks(ConditionalResolverCommonJoin.java:117)\n        at org.apache.hadoop.hive.ql.exec.ConditionalTask.execute(ConditionalTask.java:81)\n        at org.apache.hadoop.hive.ql.exec.Task.executeTask(Task.java:144)\n        at org.apache.hadoop.hive.ql.exec.TaskRunner.runSequential(TaskRunner.java:57)\n        at org.apache.hadoop.hive.ql.Driver.launchTask(Driver.java:1355)\n        at org.apache.hadoop.hive.ql.Driver.execute(Driver.java:1139)\n        at org.apache.hadoop.hive.ql.Driver.run(Driver.java:945)\n        at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:310)\n        at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:231)\n        at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:466)\n        at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:401)\n        at org.apache.hadoop.hive.cli.CliDriver.processReader(CliDriver.java:499)\n        at org.apache.hadoop.hive.cli.CliDriver.processFile(CliDriver.java:514)\n        at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:773)\n        at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:674)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:606)\n        at org.apache.hadoop.util.RunJar.main(RunJar.java:187)\nCaused by: org.apache.hadoop.ipc.RemoteException: java.io.FileNotFoundException: File does not exist: /mnt/var/lib/hive_0110/tmp/scratch/hive_2014-03-05_20-12-41_114_4395627082352200171/-mr-10002\n        at org.apache.hadoop.hdfs.server.namenode.FSDirectory.getContentSummary(FSDirectory.java:1158)\n        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getContentSummary(FSNamesystem.java:2089)\n        at org.apache.hadoop.hdfs.server.namenode.NameNode.getContentSummary(NameNode.java:948)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:606)\n        at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:573)\n        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:1393)\n        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:1389)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:415)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1140)\n        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:1387)\n\n        at org.apache.hadoop.ipc.Client.call(Client.java:1067)\n        at org.apache.hadoop.ipc.RPC$Invoker.invoke(RPC.java:225)\n        at com.sun.proxy.$Proxy6.getContentSummary(Unknown Source)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:606)\n        at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:83)\n        at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:59)\n        at com.sun.proxy.$Proxy6.getContentSummary(Unknown Source)\n        at org.apache.hadoop.hdfs.DFSClient.getContentSummary(DFSClient.java:1313)\n        ... 22 more\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.jian.fang","name":"john.jian.fang","key":"john.jian.fang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian Fang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-05T20:17:29.457+0000","updated":"2014-03-05T20:17:29.457+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12681214/comment/13921611","id":"13921611","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.jian.fang","name":"john.jian.fang","key":"john.jian.fang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian Fang","active":true,"timeZone":"America/Los_Angeles"},"body":"Also tried to set hive.optimize.skewjoin=true and hive.auto.convert.join=false for the patched Hive-0.11, but still got the \"two long running reducers\" issue. How to solve this issue then?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.jian.fang","name":"john.jian.fang","key":"john.jian.fang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jian Fang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-05T23:23:53.784+0000","updated":"2014-03-05T23:23:53.784+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12681214/comment/13921745","id":"13921745","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"Skew join in current implementation is infamous for not reducing total execution time. For checking skewness, all values should be shuffled first, which means all damages are already done in that state. Skewed keys are store in reducer and following MR job processes them.\n\nThere are other options like list bucketing(HIVE-3073), or explicit skew join(HIVE-3286), and the former is available in hive-0.11.0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2014-03-06T00:53:13.574+0000","updated":"2014-03-06T00:53:13.574+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12681214/comment/13963454","id":"13963454","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=muthunivas","name":"muthunivas","key":"muthunivas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Muthu","active":true,"timeZone":"America/Los_Angeles"},"body":"[~navis] After applying the patch from HIVE-6041 to hive 0.12, queries with auto MAPJOIN fails with the following error:  Any workarounds?\nset hive.optimize.skewjoin=true; set hive.auto.convert.join=true; SELECT ru.userid, SUM(ru.total_count) FROM BIGTABLE ru JOIN SMALLTABLE c on c.creative_id = ru.creative_id JOIN placement_dapi p ON p.placement_id = c.placement_id WHERE ru.realdate = '2014-01-02' AND ru.userid > 0 GROUP BY ru.userid;\n\nStage-1 is selected by condition resolver.\njava.io.FileNotFoundException: java.io.FileNotFoundException: File does not exist: /tmp/hive-muthu.nivas/tmp/hive-muthu.nivas/hive_2014-02-26_18-17-04_075_3879899075227148508-1/-mr-10002\nat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\nat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)\nat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\nat java.lang.reflect.Constructor.newInstance(Constructor.java:526)\nat org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:96)\nat org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:58)\nat org.apache.hadoop.hdfs.DFSClient.getContentSummary(DFSClient.java:917)\nat org.apache.hadoop.hdfs.DistributedFileSystem.getContentSummary(DistributedFileSystem.java:232)\nat org.apache.hadoop.hive.ql.plan.ConditionalResolverCommonJoin.resolveMapJoinTask(ConditionalResolverCommonJoin.java:185)\nat org.apache.hadoop.hive.ql.plan.ConditionalResolverCommonJoin.getTasks(ConditionalResolverCommonJoin.java:117)\nat org.apache.hadoop.hive.ql.exec.ConditionalTask.execute(ConditionalTask.java:81)\nat org.apache.hadoop.hive.ql.exec.Task.executeTask(Task.java:151)\nat org.apache.hadoop.hive.ql.exec.TaskRunner.runSequential(TaskRunner.java:65)\nat org.apache.hadoop.hive.ql.exec.TaskRunner.run(TaskRunner.java:55)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=muthunivas","name":"muthunivas","key":"muthunivas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Muthu","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-08T21:15:10.358+0000","updated":"2014-04-08T21:15:10.358+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5888/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1q53b:"}}