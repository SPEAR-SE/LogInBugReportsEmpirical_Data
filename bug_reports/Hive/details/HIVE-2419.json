{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12520783","self":"https://issues.apache.org/jira/rest/api/2/issue/12520783","key":"HIVE-2419","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2012-08-20T15:51:18.051+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Oct 15 20:48:21 UTC 2013","customfield_12310420":"42126","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-2419/watchers","watchCount":6,"isWatching":false},"created":"2011-08-30T18:25:04.832+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-10-15T20:48:21.020+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"If you run a CTAS statement on a fresh Hive install without a warehouse directory (as is the case with Amazon EMR), it runs the query but errors out at the end:\n\n{quote}\nhive> create table foo as select * from t_message limit 1;\nTotal MapReduce jobs = 1\nLaunching Job 1 out of 1\n...\nEnded Job = job_201108301753_0001\nMoving data to: hdfs://ip-10-202-22-194.ec2.internal:9000/mnt/hive_07_1/warehouse/foo\nFailed with exception Unable to rename: hdfs://ip-10-202-22-194.ec2.internal:9000/mnt/var/lib/hive_07_1/tmp/scratch/hive_2011-08-30_18-04-36_809_6130923980133666976/-ext-10001 to: hdfs://ip-10-202-22-194.ec2.internal:9000/mnt/hive_07_1/warehouse/foo\nFAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.MoveTask\n{quote}\n\nThis is different behavior from a simple CREATE TABLE, which creates the warehouse directory.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12541603","id":"12541603","filename":"HIVE-2419.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clarkyzl","name":"clarkyzl","key":"clarkyzl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=clarkyzl&avatarId=30540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=clarkyzl&avatarId=30540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=clarkyzl&avatarId=30540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=clarkyzl&avatarId=30540"},"displayName":"Zhuoluo Yang","active":true,"timeZone":"Asia/Shanghai"},"created":"2012-08-20T15:51:18.044+0000","size":1556,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12541603/HIVE-2419.1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"123878","customfield_12312823":null,"summary":"CREATE TABLE AS SELECT should create warehouse directory","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=electrum","name":"electrum","key":"electrum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Phillips","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=electrum","name":"electrum","key":"electrum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Phillips","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520783/comment/13437957","id":"13437957","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clarkyzl","name":"clarkyzl","key":"clarkyzl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=clarkyzl&avatarId=30540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=clarkyzl&avatarId=30540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=clarkyzl&avatarId=30540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=clarkyzl&avatarId=30540"},"displayName":"Zhuoluo Yang","active":true,"timeZone":"Asia/Shanghai"},"body":"This is an annoying problem, especially for new hive users. We have fixed the problem in our internal version of hive by simply create the hive.metastore.warehouse.dir during the semantic analysis phase.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clarkyzl","name":"clarkyzl","key":"clarkyzl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=clarkyzl&avatarId=30540","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=clarkyzl&avatarId=30540","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=clarkyzl&avatarId=30540","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=clarkyzl&avatarId=30540"},"displayName":"Zhuoluo Yang","active":true,"timeZone":"Asia/Shanghai"},"created":"2012-08-20T15:51:18.051+0000","updated":"2012-08-20T15:51:18.051+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520783/comment/13795317","id":"13795317","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"Seems MoveTask.moveFile(Path, Path, boolean) throws this exception when it trying to rename the path.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2013-10-15T15:40:23.110+0000","updated":"2013-10-15T15:40:23.110+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520783/comment/13795361","id":"13795361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Instead of SemanticAnalyzer, HiveMetaStore should be the one creating WH dir when its starting up. We don't wh dir to be owned by first user happening to run query, rather WH dir should be owned by user running metastore service. \nMetastore already has a logic to create default db (if not exists) while its initializing, we need very similar logic for creating wh dir during same initialization.\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-10-15T16:43:55.057+0000","updated":"2013-10-15T16:43:55.057+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520783/comment/13795383","id":"13795383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=appodictic","name":"appodictic","key":"appodictic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Capriolo","active":true,"timeZone":"Etc/UTC"},"body":"What if /user/hive does not exist?\nWhat if /user does not exist?\n\nMaybe it is better to let people make the directories themselves. Or simply have a pre-flight startup check in init scripts or a java main.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=appodictic","name":"appodictic","key":"appodictic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Capriolo","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-15T17:05:27.629+0000","updated":"2013-10-15T17:05:27.629+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520783/comment/13795615","id":"13795615","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=electrum","name":"electrum","key":"electrum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Phillips","active":true,"timeZone":"America/Los_Angeles"},"body":"[~appodictic], those are valid concerns but are orthogonal to the point of this issue: address the asymmetry between {{CREATE TABLE}} and {{CREATE TABLE AS SELECT}}, where the former creates the directory but the latter does not.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=electrum","name":"electrum","key":"electrum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Phillips","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-10-15T20:48:21.020+0000","updated":"2013-10-15T20:48:21.020+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-2419/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ljxb:"}}