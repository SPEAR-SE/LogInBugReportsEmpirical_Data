{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12609413","self":"https://issues.apache.org/jira/rest/api/2/issue/12609413","key":"HIVE-3509","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2012-09-28T04:49:31.978+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun May 05 21:36:15 UTC 2013","customfield_12310420":"259281","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-3509/watchers","watchCount":7,"isWatching":false},"created":"2012-09-27T17:05:20.553+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317742","id":"12317742","description":"released","name":"0.9.0","archived":false,"released":true,"releaseDate":"2012-04-30"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matt.martin","name":"matt.martin","key":"matt.martin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Martin","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-05T21:36:16.005+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12317303","id":"12317303","name":"Locking","description":"Issues related to the Locking system"}],"timeoriginalestimate":null,"description":"If locking is enabled, the acquireReadWriteLocks() method in org.apache.hadoop.hive.ql.Driver iterates through all of the input and output entities of the query plan and attempts to acquire the appropriate locks.  In general, it should acquire SHARED locks for all of the input entities and exclusive locks for all of the output entities (see the Hive wiki page on [locking|https://cwiki.apache.org/confluence/display/Hive/Locking] for more detailed information).\n\nWhen the query involves dynamic partitions, the situation is a little more subtle.  As the Hive wiki notes (see previous link):\n\n{quote}\nin some cases, the list of objects may not be known - for eg. in case of dynamic partitions, the list of partitions being modified is not known at compile time - so, the list is generated conservatively. Since the number of partitions may not be known, an exclusive lock is taken on the table, or the prefix that is known.\n{quote}\n\nAfter [HIVE-1781|https://issues.apache.org/jira/browse/HIVE-1781], the observed behavior is no longer consistent with the behavior described above.  [HIVE-1781|https://issues.apache.org/jira/browse/HIVE-1781] appears to have altered the logic so that SHARED locks are acquired instead of EXCLUSIVE locks whenever the query involves dynamic partitions.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12546877","id":"12546877","filename":"HIVE-3509.1.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matt.martin","name":"matt.martin","key":"matt.martin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Martin","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-27T17:10:53.445+0000","size":2308,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12546877/HIVE-3509.1.patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12577710","id":"12577710","filename":"HIVE-3509.D10065.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-09T05:28:15.259+0000","size":46223,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12577710/HIVE-3509.D10065.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12577940","id":"12577940","filename":"HIVE-3509.D10065.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-10T02:20:15.660+0000","size":52857,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12577940/HIVE-3509.D10065.2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12579478","id":"12579478","filename":"HIVE-3509.D10065.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-19T05:23:15.352+0000","size":79595,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12579478/HIVE-3509.D10065.3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12579485","id":"12579485","filename":"HIVE-3509.D10065.4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-19T05:45:15.953+0000","size":79757,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12579485/HIVE-3509.D10065.4.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12581835","id":"12581835","filename":"HIVE-3509.D10065.5.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-05-05T21:36:15.989+0000","size":113292,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12581835/HIVE-3509.D10065.5.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"124534","customfield_12312823":null,"summary":"Exclusive locks are not acquired when using dynamic partitions","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matt.martin","name":"matt.martin","key":"matt.martin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Martin","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matt.martin","name":"matt.martin","key":"matt.martin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Martin","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13464881","id":"13464881","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matt.martin","name":"matt.martin","key":"matt.martin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Martin","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm attaching my first pass attempt at a solution.  I ran some manual tests to confirm that things seemed to be working as expected after applying the patch. As far as automated tests are concerned, I thought it might be useful to add the list of locks to the prehook output, but I have not looked into doing that yet.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matt.martin","name":"matt.martin","key":"matt.martin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Martin","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-27T17:10:53.446+0000","updated":"2012-09-27T17:10:53.446+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13465349","id":"13465349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"Can you submit a phabricator request ?\n\nhttps://cwiki.apache.org/Hive/phabricatorcodereview.html\n\nHave you run all the tests ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-09-28T04:49:31.978+0000","updated":"2012-09-28T04:49:31.978+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13465677","id":"13465677","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matt.martin","name":"matt.martin","key":"matt.martin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Martin","active":true,"timeZone":"America/Los_Angeles"},"body":"I will try to run all tests and submit a phabricator request over the weekend.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matt.martin","name":"matt.martin","key":"matt.martin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Martin","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-09-28T15:34:27.453+0000","updated":"2012-09-28T15:34:27.453+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13626245","id":"13626245","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"MattMartin requested code review of \"HIVE-3509 [jira] Exclusive locks are not acquired when using dynamic partitions\".\n\nReviewers: JIRA\n\nMake sure queries involving dynamic partitions acquire exclusive locks on their output (instead of shared locks).\n\nThis check-in also includes changes to PreExecutePrinter hook to make it easier to see (and therefore test) which locks are actually being acquired for each query.  Updated the hive-site.xml file used by the test cases to set \"hive.support.concurrency\" to false In order to make sure this change to PreExecutePrinter didn't affect unrelated tests (no locks are acquired or printed when \"hive.support.concurrency\" is set to false).\n\nIf locking is enabled, the acquireReadWriteLocks() method in org.apache.hadoop.hive.ql.Driver iterates through all of the input and output entities of the query plan and attempts to acquire the appropriate locks.  In general, it should acquire SHARED locks for all of the input entities and exclusive locks for all of the output entities (see the Hive wiki page on locking for more detailed information).\n\nWhen the query involves dynamic partitions, the situation is a little more subtle.  As the Hive wiki notes (see previous link):\n\nin some cases, the list of objects may not be known - for eg. in case of dynamic partitions, the list of partitions being modified is not known at compile time - so, the list is generated conservatively. Since the number of partitions may not be known, an exclusive lock is taken on the table, or the prefix that is known.\n\nAfter HIVE-1781, the observed behavior is no longer consistent with the behavior described above.  HIVE-1781 appears to have altered the logic so that SHARED locks are acquired instead of EXCLUSIVE locks whenever the query involves dynamic partitions.\n\nTEST PLAN\n  EMPTY\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10065\n\nAFFECTED FILES\n  data/conf/hive-site.xml\n  ql/src/java/org/apache/hadoop/hive/ql/Driver.java\n  ql/src/java/org/apache/hadoop/hive/ql/hooks/HookContext.java\n  ql/src/test/org/apache/hadoop/hive/ql/hooks/PreExecutePrinter.java\n  ql/src/test/queries/clientnegative/lockneg1.q\n  ql/src/test/queries/clientnegative/lockneg2.q\n  ql/src/test/queries/clientnegative/lockneg3.q\n  ql/src/test/queries/clientnegative/lockneg4.q\n  ql/src/test/queries/clientnegative/lockneg5.q\n  ql/src/test/queries/clientpositive/lock1.q\n  ql/src/test/queries/clientpositive/lock2.q\n  ql/src/test/queries/clientpositive/lock3.q\n  ql/src/test/queries/clientpositive/lock4.q\n  ql/src/test/results/clientnegative/lockneg1.q.out\n  ql/src/test/results/clientnegative/lockneg2.q.out\n  ql/src/test/results/clientnegative/lockneg3.q.out\n  ql/src/test/results/clientnegative/lockneg4.q.out\n  ql/src/test/results/clientnegative/lockneg5.q.out\n  ql/src/test/results/clientpositive/lock1.q.out\n  ql/src/test/results/clientpositive/lock2.q.out\n  ql/src/test/results/clientpositive/lock3.q.out\n  ql/src/test/results/clientpositive/lock4.q.out\n\nMANAGE HERALD RULES\n  https://reviews.facebook.net/herald/view/differential/\n\nWHY DID I GET THIS EMAIL?\n  https://reviews.facebook.net/herald/transcript/24027/\n\nTo: JIRA, MattMartin\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-09T05:28:15.160+0000","updated":"2013-04-09T05:28:15.160+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13626276","id":"13626276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"njain has commented on the revision \"HIVE-3509 [jira] Exclusive locks are not acquired when using dynamic partitions\".\n\nINLINE COMMENTS\n  ql/src/test/results/clientpositive/lock3.q.out:73 Something is wrong here ? Shouldn't it be EXCLUSIVE -- this is a incomplete output.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10065\n\nTo: JIRA, MattMartin\nCc: njain\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-09T06:12:13.908+0000","updated":"2013-04-09T06:12:13.908+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13626285","id":"13626285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"comments","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-04-09T06:22:56.083+0000","updated":"2013-04-09T06:22:56.083+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13626288","id":"13626288","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"njain has commented on the revision \"HIVE-3509 [jira] Exclusive locks are not acquired when using dynamic partitions\".\n\nINLINE COMMENTS\n  ql/src/test/results/clientpositive/lock4.q.out:73 same as lock3\n  ql/src/java/org/apache/hadoop/hive/ql/Driver.java:718 This also needs to be fixed\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10065\n\nTo: JIRA, MattMartin\nCc: njain\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-09T06:24:15.567+0000","updated":"2013-04-09T06:24:15.567+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13627391","id":"13627391","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"MattMartin updated the revision \"HIVE-3509 [jira] Exclusive locks are not acquired when using dynamic partitions\".\n\n    - Updated Driver.java to make sure that dynamic partitions are handled properly when 1 or more parts of the dynamic partition is specified (e.g. \"insert overwrite table tstsrcpart partition (ds ='2008-04-08', hr) select key, value, hr where ds = '2008-04-08';\").  The earlier check-in on this branch/issue only addressed queries that used dynamic partitions without specifying any of the partitions (e.g. \"insert overwrite table tstsrcpart partition (ds, hr) select key, value, ds, hr where ds <= '2008-04-08';\")\n    - Fixing LINT error.\n\nReviewers: JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10065\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D10065?vs=31467&id=31563#toc\n\nAFFECTED FILES\n  data/conf/hive-site.xml\n  ql/src/java/org/apache/hadoop/hive/ql/Driver.java\n  ql/src/java/org/apache/hadoop/hive/ql/hooks/HookContext.java\n  ql/src/test/org/apache/hadoop/hive/ql/hooks/PreExecutePrinter.java\n  ql/src/test/queries/clientnegative/lockneg1.q\n  ql/src/test/queries/clientnegative/lockneg2.q\n  ql/src/test/queries/clientnegative/lockneg3.q\n  ql/src/test/queries/clientnegative/lockneg4.q\n  ql/src/test/queries/clientnegative/lockneg5.q\n  ql/src/test/queries/clientpositive/lock1.q\n  ql/src/test/queries/clientpositive/lock2.q\n  ql/src/test/queries/clientpositive/lock3.q\n  ql/src/test/queries/clientpositive/lock4.q\n  ql/src/test/results/clientnegative/lockneg1.q.out\n  ql/src/test/results/clientnegative/lockneg2.q.out\n  ql/src/test/results/clientnegative/lockneg3.q.out\n  ql/src/test/results/clientnegative/lockneg4.q.out\n  ql/src/test/results/clientnegative/lockneg5.q.out\n  ql/src/test/results/clientpositive/lock1.q.out\n  ql/src/test/results/clientpositive/lock2.q.out\n  ql/src/test/results/clientpositive/lock3.q.out\n  ql/src/test/results/clientpositive/lock4.q.out\n\nTo: JIRA, MattMartin\nCc: njain\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-10T02:20:15.486+0000","updated":"2013-04-10T02:20:15.486+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13627612","id":"13627612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"comments","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-04-10T08:44:25.649+0000","updated":"2013-04-10T08:44:25.649+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13627613","id":"13627613","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"njain has commented on the revision \"HIVE-3509 [jira] Exclusive locks are not acquired when using dynamic partitions\".\n\n  Also, the whole hierarchy should be present in LOCK/UNLOCK also.\n\nINLINE COMMENTS\n  ql/src/test/results/clientnegative/lockneg1.q.out:25 This may be an existing bug, but can you take a look ?\n\n  Shouldn't tstsrc also be locked and shown in the PREHOOK ?\n\n  The same issue is present in all the lock requests\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10065\n\nTo: JIRA, MattMartin\nCc: njain\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-10T08:46:15.533+0000","updated":"2013-04-10T08:46:15.533+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13636078","id":"13636078","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"MattMartin updated the revision \"HIVE-3509 [jira] Exclusive locks are not acquired when using dynamic partitions\".\n\n  Committing two minor changes and one partially implemented major change. The two minor changes are: 1) ZookeeperHiveLockManager returns database level locks and 2) handling the case when the default db is not being used (lock5.q handles this case).  The major change illustrates why it is probably not a good idea to change the \"lock ...\" and \"unlock ...\" commands to automatically acquire locks across the whole hierarchy.  Users can still acquire locks across the entire hierarchy if they need to/want to.\n\nReviewers: JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10065\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D10065?vs=31563&id=32433#toc\n\nAFFECTED FILES\n  data/conf/hive-site.xml\n  ql/src/java/org/apache/hadoop/hive/ql/Driver.java\n  ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java\n  ql/src/java/org/apache/hadoop/hive/ql/hooks/HookContext.java\n  ql/src/java/org/apache/hadoop/hive/ql/lockmgr/HiveLockObject.java\n  ql/src/java/org/apache/hadoop/hive/ql/lockmgr/zookeeper/ZooKeeperHiveLockManager.java\n  ql/src/test/org/apache/hadoop/hive/ql/hooks/PreExecutePrinter.java\n  ql/src/test/queries/clientnegative/lockneg1.q\n  ql/src/test/queries/clientnegative/lockneg2.q\n  ql/src/test/queries/clientnegative/lockneg3.q\n  ql/src/test/queries/clientnegative/lockneg4.q\n  ql/src/test/queries/clientnegative/lockneg5.q\n  ql/src/test/queries/clientpositive/lock1.q\n  ql/src/test/queries/clientpositive/lock2.q\n  ql/src/test/queries/clientpositive/lock3.q\n  ql/src/test/queries/clientpositive/lock4.q\n  ql/src/test/queries/clientpositive/lock5.q\n  ql/src/test/results/clientnegative/lockneg1.q.out\n  ql/src/test/results/clientnegative/lockneg2.q.out\n  ql/src/test/results/clientnegative/lockneg3.q.out\n  ql/src/test/results/clientnegative/lockneg4.q.out\n  ql/src/test/results/clientnegative/lockneg5.q.out\n  ql/src/test/results/clientpositive/lock1.q.out\n  ql/src/test/results/clientpositive/lock2.q.out\n  ql/src/test/results/clientpositive/lock3.q.out\n  ql/src/test/results/clientpositive/lock4.q.out\n  ql/src/test/results/clientpositive/lock5.q.out\n\nTo: JIRA, MattMartin\nCc: njain\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-19T05:23:15.201+0000","updated":"2013-04-19T05:23:15.201+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13636098","id":"13636098","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"MattMartin updated the revision \"HIVE-3509 [jira] Exclusive locks are not acquired when using dynamic partitions\".\n\n    - Adding missing changes to lockneg2.q.out and lockneg3.q.out that should've been included in the last commit.\n\nReviewers: JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10065\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D10065?vs=32433&id=32439#toc\n\nAFFECTED FILES\n  data/conf/hive-site.xml\n  ql/src/java/org/apache/hadoop/hive/ql/Driver.java\n  ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java\n  ql/src/java/org/apache/hadoop/hive/ql/hooks/HookContext.java\n  ql/src/java/org/apache/hadoop/hive/ql/lockmgr/HiveLockObject.java\n  ql/src/java/org/apache/hadoop/hive/ql/lockmgr/zookeeper/ZooKeeperHiveLockManager.java\n  ql/src/test/org/apache/hadoop/hive/ql/hooks/PreExecutePrinter.java\n  ql/src/test/queries/clientnegative/lockneg1.q\n  ql/src/test/queries/clientnegative/lockneg2.q\n  ql/src/test/queries/clientnegative/lockneg3.q\n  ql/src/test/queries/clientnegative/lockneg4.q\n  ql/src/test/queries/clientnegative/lockneg5.q\n  ql/src/test/queries/clientpositive/lock1.q\n  ql/src/test/queries/clientpositive/lock2.q\n  ql/src/test/queries/clientpositive/lock3.q\n  ql/src/test/queries/clientpositive/lock4.q\n  ql/src/test/queries/clientpositive/lock5.q\n  ql/src/test/results/clientnegative/lockneg1.q.out\n  ql/src/test/results/clientnegative/lockneg2.q.out\n  ql/src/test/results/clientnegative/lockneg3.q.out\n  ql/src/test/results/clientnegative/lockneg4.q.out\n  ql/src/test/results/clientnegative/lockneg5.q.out\n  ql/src/test/results/clientpositive/lock1.q.out\n  ql/src/test/results/clientpositive/lock2.q.out\n  ql/src/test/results/clientpositive/lock3.q.out\n  ql/src/test/results/clientpositive/lock4.q.out\n  ql/src/test/results/clientpositive/lock5.q.out\n\nTo: JIRA, MattMartin\nCc: njain\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-19T05:45:15.784+0000","updated":"2013-04-19T05:45:15.784+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13636294","id":"13636294","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"njain has commented on the revision \"HIVE-3509 [jira] Exclusive locks are not acquired when using dynamic partitions\".\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/lockmgr/HiveLockObject.java:144 This is a incompatible change, and may break many existing apps.\n\n  For eg: in FB we log the query along with inputs and outputs, and this will leave the\n  burden on the client to change / to @ appropriately.\n\n  Although it is not ideal, but let us stick with the format:\n\n  db@table@partns. where partitions is of partitionCol1/partitionCol2\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10065\n\nTo: JIRA, MattMartin\nCc: njain\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-19T11:39:15.285+0000","updated":"2013-04-19T11:39:15.285+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13636297","id":"13636297","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"comments","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-04-19T11:43:24.631+0000","updated":"2013-04-19T11:43:24.631+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13636551","id":"13636551","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"MattMartin has commented on the revision \"HIVE-3509 [jira] Exclusive locks are not acquired when using dynamic partitions\".\n\n  For the record, I'm planning to roll back the \"major change\" in my last revision which acquires and releases the whole hierarchy of locks on explicit \"lock ...\" and \"unlock ...\".\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/lockmgr/HiveLockObject.java:144 This change should only affect locks.  In particular, this would make sure the lock paths are consistent for dummy partitions and non-dummy partitions.\n\n  Without this change, I think a case could arise where a write query with dynamic partitions tries to acquire an exclusive lock on \"<base dir in zookeeper>/db@table@partns\" while a read query simultaneously tries to acquire a shared lock on \"<base locking dir in zookeeper>/db/table/partns\". In this case the reader and writer would not block each other even though they should. I'll try to add a test case to illustrate this point.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10065\n\nTo: JIRA, MattMartin\nCc: njain\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-19T16:23:15.548+0000","updated":"2013-04-19T16:23:15.548+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609413/comment/13649440","id":"13649440","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"MattMartin updated the revision \"HIVE-3509 [jira] Exclusive locks are not acquired when using dynamic partitions\".\n\n    - This commit rolls back an earlier change which automatically acquired all of the locks in the hierarchy when a \"LOCK ...\" command is given on the CLI.  Instead of automatically acquiring these locks, changes have been made to allow users to lock intermediate (i.e. \"dummy partitions\") on the CLI. With this change, users can now acquire locks up the whole hierarchy as needed instead of changing the implementation of the \"LOCK …\" command itself.  Another implication of this change, is that users can now use the \"LOCK …\" command to lock partitions that don't exist.  If the partition does not exist, a dummy partition object is created and used instead.  As a result of this change, the lockneg4.q test case was removed from the set of negative test cases and a similar test case was added to the set of positive test cases.\n\nReviewers: JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10065\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D10065?vs=32439&id=33357#toc\n\nAFFECTED FILES\n  data/conf/hive-site.xml\n  ql/src/java/org/apache/hadoop/hive/ql/Driver.java\n  ql/src/java/org/apache/hadoop/hive/ql/exec/DDLTask.java\n  ql/src/java/org/apache/hadoop/hive/ql/hooks/HookContext.java\n  ql/src/java/org/apache/hadoop/hive/ql/lockmgr/zookeeper/ZooKeeperHiveLockManager.java\n  ql/src/test/org/apache/hadoop/hive/ql/hooks/PreExecutePrinter.java\n  ql/src/test/queries/clientnegative/lockneg1.q\n  ql/src/test/queries/clientnegative/lockneg2.q\n  ql/src/test/queries/clientnegative/lockneg3.q\n  ql/src/test/queries/clientnegative/lockneg4.q\n  ql/src/test/queries/clientnegative/lockneg5.q\n  ql/src/test/queries/clientnegative/lockneg6.q\n  ql/src/test/queries/clientnegative/lockneg7.q\n  ql/src/test/queries/clientnegative/lockneg8.q\n  ql/src/test/queries/clientnegative/lockneg9.q\n  ql/src/test/queries/clientpositive/lock1.q\n  ql/src/test/queries/clientpositive/lock2.q\n  ql/src/test/queries/clientpositive/lock3.q\n  ql/src/test/queries/clientpositive/lock4.q\n  ql/src/test/queries/clientpositive/lock5.q\n  ql/src/test/queries/clientpositive/lock6.q\n  ql/src/test/queries/clientpositive/lock7.q\n  ql/src/test/queries/clientpositive/lock8.q\n  ql/src/test/results/clientnegative/lockneg1.q.out\n  ql/src/test/results/clientnegative/lockneg2.q.out\n  ql/src/test/results/clientnegative/lockneg3.q.out\n  ql/src/test/results/clientnegative/lockneg4.q.out\n  ql/src/test/results/clientnegative/lockneg5.q.out\n  ql/src/test/results/clientnegative/lockneg6.q.out\n  ql/src/test/results/clientnegative/lockneg7.q.out\n  ql/src/test/results/clientnegative/lockneg8.q.out\n  ql/src/test/results/clientnegative/lockneg9.q.out\n  ql/src/test/results/clientpositive/lock1.q.out\n  ql/src/test/results/clientpositive/lock2.q.out\n  ql/src/test/results/clientpositive/lock3.q.out\n  ql/src/test/results/clientpositive/lock4.q.out\n  ql/src/test/results/clientpositive/lock5.q.out\n  ql/src/test/results/clientpositive/lock6.q.out\n  ql/src/test/results/clientpositive/lock7.q.out\n  ql/src/test/results/clientpositive/lock8.q.out\n\nTo: JIRA, MattMartin\nCc: njain\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-05-05T21:36:15.756+0000","updated":"2013-05-05T21:36:15.756+0000"}],"maxResults":16,"total":16,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-3509/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0lnz3:"}}