{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12704408","self":"https://issues.apache.org/jira/rest/api/2/issue/12704408","key":"HIVE-6784","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326450","id":"12326450","description":"released","name":"0.14.0","archived":false,"released":true,"releaseDate":"2014-11-12"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2014-03-29T15:31:15.028+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Nov 13 19:43:52 UTC 2014","customfield_12310420":"382742","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_554164487_*|*_1_*:*_2_*:*_648443203_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-04-12T00:29:22.101+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-6784/watchers","watchCount":6,"isWatching":false},"created":"2014-03-29T02:25:54.443+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324986","id":"12324986","description":"released","name":"0.13.0","archived":false,"released":true,"releaseDate":"2014-04-21"}],"issuelinks":[{"id":"12445674","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12445674","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12903872","key":"HIVE-12080","self":"https://issues.apache.org/jira/rest/api/2/issue/12903872","fields":{"summary":"Support auto type widening (int->bigint & float->double) for Parquet table","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-12T03:50:42.430+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320633","id":"12320633","name":"File Formats","description":"File Formats"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312585","id":"12312585","name":"Serializers/Deserializers","description":"Tracks issues dealing with serdes"}],"timeoriginalestimate":null,"description":"see also in the following parquet issue:\nhttps://github.com/Parquet/parquet-mr/issues/323\n\nCurrently, if we change parquet format hive table using \"alter table parquet_table change c1 c1 bigint \" ( assuming original type of c1 is int), it will result in exception thrown from SerDe: \"org.apache.hadoop.io.IntWritable cannot be cast to org.apache.hadoop.io.LongWritable\" in query runtime.\n\nThis is different behavior from hive (using other file format), where it will try to perform cast (null value in case of incompatible type).\n\nParquet Hive's RecordReader returns an ArrayWritable (based on schema stored in footers of parquet files); ParquetHiveSerDe also creates an corresponding ArrayWritableObjectInspector (but using column type info from metastore). Whenever there is column type change, the objector inspector will throw exception, since WritableLongObjectInspector cannot inspect an IntWritable etc...\n\nConversion has to happen somewhere if we want to allow type change. SerDe's deserialize method seems a natural place for it.\n\nCurrently, serialize method calls createStruct (then createPrimitive) for every record, but it creates a new object regardless, which seems expensive. I think that could be optimized a bit by just returning the object passed if already of the right type. deserialize also reuse this method, if there is a type change, there will be new object to be created, which I think is inevitable. \n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12638763","id":"12638763","filename":"HIVE-6784.1.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tongjie","name":"tongjie","key":"tongjie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tongjie Chen","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-04T20:55:43.769+0000","size":11394,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12638763/HIVE-6784.1.patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12638877","id":"12638877","filename":"HIVE-6784.2.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tongjie","name":"tongjie","key":"tongjie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tongjie Chen","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-05T19:02:02.909+0000","size":18595,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12638877/HIVE-6784.2.patch.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"383010","customfield_12312823":null,"summary":"parquet-hive should allow column type change","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tongjie","name":"tongjie","key":"tongjie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tongjie Chen","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tongjie","name":"tongjie","key":"tongjie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tongjie Chen","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704408/comment/13954289","id":"13954289","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"FYI [~jcoffey] [~xuefuz]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-29T15:31:15.028+0000","updated":"2014-03-29T15:31:15.028+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704408/comment/13954290","id":"13954290","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"FYI [~szehon]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-29T15:31:36.102+0000","updated":"2014-03-29T15:31:36.102+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704408/comment/13960421","id":"13960421","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tongjie","name":"tongjie","key":"tongjie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tongjie Chen","active":true,"timeZone":"Etc/UTC"},"body":"https://reviews.apache.org/r/20048/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tongjie","name":"tongjie","key":"tongjie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tongjie Chen","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-04T21:04:31.335+0000","updated":"2014-04-04T21:04:31.335+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704408/comment/13961205","id":"13961205","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tongjie","name":"tongjie","key":"tongjie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tongjie Chen","active":true,"timeZone":"Etc/UTC"},"body":"add a new qtest for changing type","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tongjie","name":"tongjie","key":"tongjie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tongjie Chen","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-05T19:02:02.913+0000","updated":"2014-04-05T19:02:02.913+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704408/comment/13961358","id":"13961358","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12638877/HIVE-6784.2.patch.txt\n\n{color:green}SUCCESS:{color} +1 5550 tests passed\n\nTest results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2147/testReport\nConsole output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2147/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12638877","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2014-04-06T09:34:11.499+0000","updated":"2014-04-06T09:34:11.499+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704408/comment/13965279","id":"13965279","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcoffey","name":"jcoffey","key":"jcoffey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Justin Coffey","active":true,"timeZone":"Etc/UTC"},"body":"-1 on this patch.\n\nLooping on the arraywriteable in deserialize() will cause a performance penalty at read time, and running parseXxxx(obj.toString) in the event of a type mismatch is also painful.\n\nChanging types of columns is a rare event, we shouldn't write code that will cause performance penalties to handle it.  Users should recreate the table with the new type and load it from the old table casting and converting as appropriate in their query.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcoffey","name":"jcoffey","key":"jcoffey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Justin Coffey","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-10T12:02:22.422+0000","updated":"2014-04-10T12:02:22.422+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704408/comment/13965702","id":"13965702","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tongjie","name":"tongjie","key":"tongjie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tongjie Chen","active":true,"timeZone":"Etc/UTC"},"body":"Not allowing changing types of columns would be negative for adopting parquet --- at least this is a different behavior from using other file format. \n\nRegarding performance penalty, \n\n1) if you look at current implementation of LazyInteger, LayzLong etc (from LazySimpleSerDe, in package org.apache.hadoop.hive.serde2.lazy), they try to parseInt, parseLong for every column (all initially represented as string, the parsing overhead occurs even if the type is expected).  This is how hive achieves change types of columns (\"schema on read\");  in another word, the similar performance penalty is already there for other SerDe in order to achieve \"schema on read\".\n\n  /** \n   *Parses the string argument as if it was an int value and returns the\n   * result. Throws NumberFormatException if the string does not represent an\n   * int quantity.\n   ...\n    public static int parseInt(byte[] bytes, int start, int length, int radix) {\n\n\n   /**\n   * Parses the string argument as if it was a long value and returns the\n   * result. Throws NumberFormatException if the string does not represent a\n   * long quantity.\n   ....\n   public static long parseLong(byte[] bytes, int start, int length, int radix) {\n\n\n2) In he patch for this jira, the extra overhead is to list the top level element of ArrayWritable to inspect whether there is a type change or not. A new converted object is created ONLY IF the type is changed.\n\n    I agree that there would be some overhead to list the element of ArrayWritable, but it is a tradeoff.\n\n3) The patch in this jira would actually help performance when serializing (in time of writing) ArrayWritable. The old approach is to create a new object for every single writable element; with this patch, it only creates new a new object when there is type change.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tongjie","name":"tongjie","key":"tongjie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tongjie Chen","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-10T19:05:16.592+0000","updated":"2014-04-10T19:05:16.592+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704408/comment/13966341","id":"13966341","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcoffey","name":"jcoffey","key":"jcoffey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Justin Coffey","active":true,"timeZone":"Etc/UTC"},"body":"You've cited a \"lazy\" serde.  Parquet is not \"lazy\".  It is similar to ORC.\n\nHave a look ORC's deserialize() method (org.apache.hadoop.hive.ql.io.orc.OrcSerde):\n{code}\n  @Override\n  public Object deserialize(Writable writable) throws SerDeException {\n    return writable;\n  }\n{code}\n\nA quick look through ORC code indicates to me that they don't do any reparsing (though I might have missed something).\n\nLooking through other serde's not a single one (that I checked) reparses values.  Value parsing is handled in ObjectInspectors (poke around org.apache.hadoop.hive.serde2.objectinspector.primitive.PrimitiveObjectInspectorUtils).\n\nIn my opinion, the *substantial* performance penalty that you are introducing with this patch is going to be a much bigger negative to adopting parquet than obliging people to rebuild their data set in the rare event that you have to change a type.\n\nAnd if you do need to change a type, insert overwrite table is a good work around.\n\n-1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcoffey","name":"jcoffey","key":"jcoffey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Justin Coffey","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-11T08:50:41.906+0000","updated":"2014-04-11T08:50:41.906+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704408/comment/13967292","id":"13967292","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tongjie","name":"tongjie","key":"tongjie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tongjie Chen","active":true,"timeZone":"Etc/UTC"},"body":"OK, I will cancel this patch.\n\nThe exception raised from changing type actually only happens to non-partitioned tables.  For partitioned tables, if there is type change in table level, there will be an ObjectInspectorConverter (in parquet's case --- StructConverter) to convert type between partition and table. For non-partitioned tables, the ObjectInspectorConverter is always IdentityConverter, which passes the deserialized object as it is, causing type mismatch between object and ObjectInspector.\n\nFor now, we can live with the workaround (insert overwrite table) given that it is only affecting non-partitioned tables and relatively rare.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tongjie","name":"tongjie","key":"tongjie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tongjie Chen","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-12T00:29:02.039+0000","updated":"2014-04-12T00:29:02.039+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704408/comment/14094075","id":"14094075","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wzc1989","name":"wzc1989","key":"wzc1989","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Zhichun Wu","active":true,"timeZone":"Asia/Shanghai"},"body":"@ [~tongjie] ,\n\nbq. The exception raised from changing type actually only happens to non-partitioned tables. For partitioned tables, if there is type change in table level, there will be an ObjectInspectorConverter (in parquet's case â€” StructConverter) to convert type between partition and table. \n\nI've test changing type with parquet partitioned table in hive 0.13 and found that this issue also existed in partitioned tables.  After changing type, when I query old partition data, it would throw following exception:\n{code}\n Cannot inspect java.util.ArrayList\n        at org.apache.hadoop.hive.ql.io.parquet.serde.ArrayWritableObjectInspector.getStructFieldData(ArrayWritableObjectInspector.java:139)\n        at org.apache.hadoop.hive.serde2.objectinspector.UnionStructObjectInspector.getStructFieldData(UnionStructObjectInspector.java:135)\n        at org.apache.hadoop.hive.serde2.SerDeUtils.buildJSONString(SerDeUtils.java:349)\n        at org.apache.hadoop.hive.serde2.SerDeUtils.getJSONString(SerDeUtils.java:193)\n        at org.apache.hadoop.hive.serde2.SerDeUtils.getJSONString(SerDeUtils.java:179)\n        at org.apache.hadoop.hive.ql.exec.MapOperator.process(MapOperator.java:545)\n        at org.apache.hadoop.hive.ql.exec.mr.ExecMapper.map(ExecMapper.java:177)\n        at org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:54)\n        at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:429)\n        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:341)\n        at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:162)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:415)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1491)\n        at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:157)\n{code}\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wzc1989","name":"wzc1989","key":"wzc1989","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Zhichun Wu","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-08-12T14:07:18.976+0000","updated":"2014-08-12T14:07:18.976+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704408/comment/14094118","id":"14094118","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tongjie","name":"tongjie","key":"tongjie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tongjie Chen","active":true,"timeZone":"Etc/UTC"},"body":"if you backport this jira, it will be OK.\nhttps://issues.apache.org/jira/browse/HIVE-6785","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tongjie","name":"tongjie","key":"tongjie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tongjie Chen","active":true,"timeZone":"Etc/UTC"},"created":"2014-08-12T14:49:25.539+0000","updated":"2014-08-12T14:49:25.539+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12704408/comment/14211051","id":"14211051","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"This has been fixed in 0.14 release. Please open new jira if you see any issues.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-13T19:43:52.396+0000","updated":"2014-11-13T19:43:52.396+0000"}],"maxResults":12,"total":12,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-6784/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1txu7:"}}