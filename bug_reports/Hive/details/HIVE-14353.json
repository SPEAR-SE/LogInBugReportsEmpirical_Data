{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12992839","self":"https://issues.apache.org/jira/rest/api/2/issue/12992839","key":"HIVE-14353","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-07-27T16:35:34.568+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jul 29 01:21:16 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-14353/watchers","watchCount":5,"isWatching":false},"created":"2016-07-27T07:46:52.862+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332384","id":"12332384","name":"1.2.1","archived":false,"released":true,"releaseDate":"2015-06-26"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-07-29T01:32:35.464+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12323402","id":"12323402","name":"CBO","description":"All issues dealing with Hive's cost based optimizer and its interaction with Optiq"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12323400","id":"12323400","name":"Logical Optimizer","description":"Optimizations which are independent of runtime."}],"timeoriginalestimate":null,"description":"TPC-DS with factor 1024.\nHive on Spark. \nWith and without projection prunning,time spent are quite different.\nThe way to disable projection prunning : disable HiveRelFieldTrimmer in code and compile a new jar.\n||queries||CBO_no_projection_prune||CBO||\n|q27|\t160|251 |     \n|q7\t|   200|312 |\n|q88|\t701|1092|\n|q68|\t234|345 |\n|q39|    53|78  |\n|q73|\t160|228 |\n|q31|\t463|659 |\n|q79|\t242|343 |\n|q46|\t256|363 |\n|q60|\t271|382 |\n|q66|\t198|278 |\n|q34|\t155|217 |\n|q19|\t184|256 |\n|q26|\t154|214 |\n|q56|\t262|364 |\n|q75|\t942|1303|\n|q71|\t288|388 |\n|q25|\t329|442 |\n|q52|\t142|190 |\n|q42|\t142|189 |\n|q3\t|   139|185 |\n|q98|\t153|203 |\n|q89|\t187|248 |\n|q58|\t264|340 |\n|q43|\t127|162 |\n|q32|\t174|221 |\n|q96|\t156|197 |\n|q70|\t320|404 |\n|q29|\t499|629 |\n|q18|\t266|329 |\n|q21|\t76 |92  |\n|q90|\t139|165 |\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12820656","id":"12820656","filename":"q46_cbo_no_projection_prune_explain.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-07-28T06:31:22.224+0000","size":24910,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12820656/q46_cbo_no_projection_prune_explain.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12820657","id":"12820657","filename":"q46_cbo_projection_prune_explain.rar","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-07-28T06:33:15.673+0000","size":3887,"mimeType":"application/x-rar-compressed","content":"https://issues.apache.org/jira/secure/attachment/12820657/q46_cbo_projection_prune_explain.rar"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12820853","id":"12820853","filename":"q46_explain_cbo_vs_nocbo.tar.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-07-29T01:32:35.460+0000","size":7004,"mimeType":"application/gzip","content":"https://issues.apache.org/jira/secure/attachment/12820853/q46_explain_cbo_vs_nocbo.tar.gz"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Performance degradation  after Projection Pruning in CBO","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12992839/comment/15395947","id":"15395947","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pxiong","name":"pxiong","key":"pxiong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pengcheng Xiong","active":true,"timeZone":"America/Los_Angeles"},"body":"[~nemon]. that is interesting finding. Could u also record how much time did we spend on HiveRelFieldTrimmer in CBO on case and put them in the 3rd column? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pxiong","name":"pxiong","key":"pxiong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pengcheng Xiong","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-27T16:35:34.568+0000","updated":"2016-07-27T16:35:34.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12992839/comment/15396893","id":"15396893","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"body":"||queries||CBO_total_time||CBO_time_in_SelectOP||\n|q27|\t266.494|80.5 |     \n|q7\t|   328.259|98.8 |\n|q68|\t369.159|105 |\n|q46|\t392.777|91.75|\n\nI just run a few of them because of time limit. The time spent in selectOP is calculated by adding up total times spent for selectOP  in one executor ,and then divide number of cores.(4 in my case).\nAlso,I have run q46 without projection pruning.And total time is 266.226,time spent in selectOP is 0.125 seconds.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-07-28T04:14:49.910+0000","updated":"2016-07-29T01:08:02.955+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12992839/comment/15396905","id":"15396905","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pxiong","name":"pxiong","key":"pxiong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pengcheng Xiong","active":true,"timeZone":"America/Los_Angeles"},"body":"[~nemon], thanks for your data. I am bit confused for the CBO_time_in_SelectOP that you mentioned... What i would like to see is how much time did we spend on compiling the query (I mean the time spent on the application of HiveRelFieldTrimmer). For example, for q27, the time difference is 251-160=91. If the time spent on the application of HiveRelFieldTrimmer is around 90s, then that means we should improve the compilation. Otherwise if the time spent on the application of HiveRelFieldTrimmer is around 1-5s, then that means the difference comes from somewhere else rather than compilation.. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pxiong","name":"pxiong","key":"pxiong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pengcheng Xiong","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-28T04:53:07.069+0000","updated":"2016-07-28T04:53:07.069+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12992839/comment/15396922","id":"15396922","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"body":"[~pxiong]  Sorry for the misleading. Performance degradation is at run time(an application run on YARN),not compile time.\nHiveRelFieldTrimmer adds a projection rel node above table scan.The projection node then compiled to select operator in hive.\nThat's why I record the time spent in select operator during run time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-07-28T05:07:14.507+0000","updated":"2016-07-28T05:07:14.507+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12992839/comment/15397041","id":"15397041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"body":"A preliminary analysis:\nHive has a built in column pruner, and column pruning has been pushed down to InputFormat layer.\nCBO adds an projection above table scan,which is very costly especially when doing projection before join.\nJoin can filter out a lot of rows in most cases of TPCDS.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-07-28T06:44:51.024+0000","updated":"2016-07-28T06:44:51.024+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12992839/comment/15398540","id":"15398540","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"body":"The motivation of this jira ticket is that ,I found that query46 was lower with CBO on than off, while the join order is the same. ( I changed the join order in SQL manually when CBO is off.)\nAfter comparing these two query plans,the major difference is the select operator introduced by CBO's projection pruning.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-07-29T01:21:16.855+0000","updated":"2016-07-29T01:21:16.855+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-14353/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i31k0n:"}}