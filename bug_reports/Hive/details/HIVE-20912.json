{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13198300","self":"https://issues.apache.org/jira/rest/api/2/issue/13198300","key":"HIVE-20912","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2018-11-14 11:50:04.576","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-20912/watchers","watchCount":2,"isWatching":false},"created":"2018-11-14T11:50:04.576+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332384","id":"12332384","name":"1.2.1","archived":false,"released":true,"releaseDate":"2015-06-26"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-11-14T11:58:49.124+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12325007","id":"12325007","name":"Hive"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12331026","id":"12331026","name":"Operators"}],"timeoriginalestimate":null,"description":"The file merge stage had two tasks, which should create two files, but there was three files created.\r\n\r\n!image-2018-11-14-19-28-18-924.png!\r\n\r\nBy tracing the log, we found that there were two task attempts(one of them was a speculation) finished in one second by such a coincidence. Although the later one received a kill signal from AM, the rename operation was already done at that time, which cause the data duplication.\r\n\r\nThe rename operation was done at _AbstractFileMergeOperator.closeOp()_, the __ final path name was determined by the task attempt id rather than the task id. In this case, the final path ended with '000000_0' and '000000_1' rather than '000000'. IMHO, by making the final path name ended with task id without task attempt id, one task can only generate at most one file, which could solve this issue. But I don't know the side effects for changing the final path name.\r\n\r\nThis issue also affects other operators related to file renaming like JoinOperator and FileSinkOperator.\r\n\r\n!image-2018-11-14-17-53-13-191.png!\r\n\r\n!image-2018-11-14-17-53-50-171.png!","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12948119","id":"12948119","filename":"image-2018-11-14-17-48-59-826.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zihao.ye","name":"zihao.ye","key":"zihao.ye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10445","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10445","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10445","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10445"},"displayName":"Zihao Ye","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-11-14T09:48:58.632+0000","size":92708,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12948119/image-2018-11-14-17-48-59-826.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12948118","id":"12948118","filename":"image-2018-11-14-17-53-13-191.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zihao.ye","name":"zihao.ye","key":"zihao.ye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10445","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10445","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10445","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10445"},"displayName":"Zihao Ye","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-11-14T09:53:11.890+0000","size":74340,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12948118/image-2018-11-14-17-53-13-191.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12948117","id":"12948117","filename":"image-2018-11-14-17-53-50-171.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zihao.ye","name":"zihao.ye","key":"zihao.ye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10445","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10445","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10445","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10445"},"displayName":"Zihao Ye","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-11-14T09:53:48.430+0000","size":62820,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12948117/image-2018-11-14-17-53-50-171.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12948116","id":"12948116","filename":"image-2018-11-14-19-28-18-924.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zihao.ye","name":"zihao.ye","key":"zihao.ye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10445","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10445","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10445","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10445"},"displayName":"Zihao Ye","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-11-14T11:28:18.147+0000","size":92708,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12948116/image-2018-11-14-19-28-18-924.png"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Output data might be duplicated while speculation is enabled","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zihao.ye","name":"zihao.ye","key":"zihao.ye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10445","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10445","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10445","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10445"},"displayName":"Zihao Ye","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zihao.ye","name":"zihao.ye","key":"zihao.ye","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10445","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10445","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10445","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10445"},"displayName":"Zihao Ye","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Hive 1.2.1\r\n\r\nHadoop 2.7.3\r\n\r\nTez 0.7.0","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-20912/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|s00h6g:"}}