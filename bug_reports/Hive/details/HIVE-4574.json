{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12648210","self":"https://issues.apache.org/jira/rest/api/2/issue/12648210","key":"HIVE-4574","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2013-07-30T04:50:35.068+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Dec 11 23:46:25 UTC 2013","customfield_12310420":"328566","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_14957116502_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-11-06T19:41:37.633+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4574/watchers","watchCount":10,"isWatching":false},"created":"2013-05-17T16:56:21.166+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323587","id":"12323587","description":"Hive 0.11.0","name":"0.11.0","archived":false,"released":true,"releaseDate":"2013-05-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324312","id":"12324312","description":"released","name":"0.12.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"issuelinks":[{"id":"12377969","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12377969","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12671598","key":"HIVE-5411","self":"https://issues.apache.org/jira/rest/api/2/issue/12671598","fields":{"summary":"Migrate expression serialization to Kryo","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-12-11T23:46:25.372+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320408","id":"12320408","name":"HiveServer2","description":"Tracks issues related to HiveServer2"}],"timeoriginalestimate":null,"description":"In open jdk7, XMLEncoder.writeObject call leads to calls to java.beans.MethodFinder.findMethod(). MethodFinder class not thread safe because it uses a static WeakHashMap that would get used from multiple threads. See -\nhttp://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7-b147/com/sun/beans/finder/MethodFinder.java#46\n\nConcurrent access to HashMap implementation that are not thread safe can sometimes result in infinite-loops and other problems. If jdk7 is in use, it makes sense to synchronize calls to XMLEncoder.writeObject .\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12583688","id":"12583688","filename":"HIVE-4574.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-05-17T20:51:47.155+0000","size":1000,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12583688/HIVE-4574.1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"328910","customfield_12312823":null,"summary":"XMLEncoder thread safety issues in openjdk7 causes HiveServer2 to be stuck","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13660856","id":"13660856","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"The stack trace of threads in hiveserver2 when it gets into this state looks like this -\n{code}\n- java.util.WeakHashMap.get(java.lang.Object) @bci=72, line=470 (Compiled frame; information may be imprecise)\n - com.sun.beans.WeakCache.get(java.lang.Object) @bci=5, line=55 (Interpreted frame)\n - com.sun.beans.finder.MethodFinder.findMethod(java.lang.Class, java.lang.String, java.lang.Class[]) @bci=33, line=68 (Interpreted frame)\n - java.beans.Statement.getMethod(java.lang.Class, java.lang.String, java.lang.Class[]) @bci=3, line=357 (Interpreted frame)\n - java.beans.Statement.invokeInternal() @bci=419, line=287 (Interpreted frame)\n - java.beans.Statement.access$000(java.beans.Statement) @bci=1, line=58 (Interpreted frame)\n - java.beans.Statement$2.run() @bci=4, line=185 (Interpreted frame)\n - java.security.AccessController.doPrivileged(java.security.PrivilegedExceptionAction, java.security.AccessControlContext) @bci=0 (Interpreted frame)\n - java.beans.Statement.invoke() @bci=34, line=182 (Compiled frame)\n - java.beans.Expression.getValue() @bci=12, line=153 (Compiled frame)\n - java.beans.DefaultPersistenceDelegate.doProperty(java.lang.Class, java.beans.PropertyDescriptor, java.lang.Object, java.lang.Object, java.beans.Encoder) @bci=63, line=192 (Interpreted frame)\n - java.beans.DefaultPersistenceDelegate.initBean(java.lang.Class, java.lang.Object, java.lang.Object, java.beans.Encoder) @bci=254, line=253 (Interpreted frame)\n - java.beans.DefaultPersistenceDelegate.initialize(java.lang.Class, java.lang.Object, java.lang.Object, java.beans.Encoder) @bci=23, line=400 (Interpreted frame)\n - java.beans.PersistenceDelegate.writeObject(java.lang.Object, java.beans.Encoder) @bci=42, line=118 (Interpreted frame)\n - java.beans.Encoder.writeObject(java.lang.Object) @bci=26, line=74 (Interpreted frame)\n - java.beans.XMLEncoder.writeObject(java.lang.Object) @bci=9, line=327 (Interpreted frame)\n - java.beans.Encoder.writeExpression(java.beans.Expression) @bci=36, line=330 (Interpreted frame)\n - java.beans.XMLEncoder.writeExpression(java.beans.Expression) @bci=46, line=454 (Interpreted frame)\n - java.beans.PersistenceDelegate.writeObject(java.lang.Object, java.beans.Encoder) @bci=28, line=115 (Interpreted frame)\n - java.beans.Encoder.writeObject(java.lang.Object) @bci=26, line=74 (Interpreted frame)\n - java.beans.XMLEncoder.writeObject(java.lang.Object) @bci=9, line=327 (Interpreted frame)\n - java.beans.Encoder.writeExpression(java.beans.Expression) @bci=36, line=330 (Interpreted frame)\n - java.beans.XMLEncoder.writeExpression(java.beans.Expression) @bci=46, line=454 (Interpreted frame)\n - java.beans.DefaultPersistenceDelegate.doProperty(java.lang.Class, java.beans.PropertyDescriptor, java.lang.Object, java.lang.Object, java.beans.Encoder) @bci=79, line=194 (Interpreted frame)\n - java.beans.DefaultPersistenceDelegate.initBean(java.lang.Class, java.lang.Object, java.lang.Object, java.beans.Encoder) @bci=254, line=253 (Interpreted frame)\n - java.beans.DefaultPersistenceDelegate.initialize(java.lang.Class, java.lang.Object, java.lang.Object, java.beans.Encoder) @bci=23, line=400 (Interpreted frame)\n - java.beans.PersistenceDelegate.writeObject(java.lang.Object, java.beans.Encoder) @bci=42, line=118 (Interpreted frame)\n - java.beans.Encoder.writeObject(java.lang.Object) @bci=26, line=74 (Interpreted frame)\n - java.beans.XMLEncoder.writeObject(java.lang.Object) @bci=9, line=327 (Interpreted frame)\n.... (many more java.beans* calls in stack)\n....\n - java.beans.XMLEncoder.writeObject(java.lang.Object) @bci=9, line=327 (Interpreted frame)\n - java.beans.Encoder.writeObject1(java.lang.Object) @bci=12, line=258 (Interpreted frame)\n - java.beans.Encoder.cloneStatement(java.beans.Statement) @bci=46, line=271 (Interpreted frame)\n - java.beans.Encoder.writeStatement(java.beans.Statement) @bci=2, line=301 (Interpreted frame)\n - java.beans.XMLEncoder.writeStatement(java.beans.Statement) @bci=12, line=400 (Interpreted frame)\n - java.beans.XMLEncoder.writeObject(java.lang.Object) @bci=34, line=330 (Interpreted frame)\n - org.apache.hadoop.hive.ql.exec.Utilities.serializeMapRedWork(org.apache.hadoop.hive.ql.plan.MapredWork, java.io.OutputStream) @bci=41, line=549 (Interpreted frame)\n - org.apache.hadoop.hive.ql.exec.Utilities.setMapRedWork(org.apache.hadoop.conf.Configuration, org.apache.hadoop.hive.ql.plan.MapredWork, java.lang.String) @bci=53, line=396 (Interpreted frame)\n - org.apache.hadoop.hive.ql.exec.ExecDriver.execute(org.apache.hadoop.hive.ql.DriverContext) @bci=1273, line=410 (Interpreted frame)\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-05-17T16:58:59.536+0000","updated":"2013-05-17T16:58:59.536+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13660858","id":"13660858","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"I have filed a bug report with openjdk (oracle). Unfortunately, they create the public bug only after review, so I don't have a link to it right now.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-05-17T17:00:23.784+0000","updated":"2013-05-17T17:00:23.784+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13661039","id":"13661039","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"HIVE-4574.1.patch - Synchronizes calls to XMLEncoder in Utilities.java. That is the only place I see XMLEncoder or java beans being called directly from hive. Need to look at ways to do this only for the jdk versions with this bug.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-05-17T20:51:47.159+0000","updated":"2013-05-17T20:51:47.159+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13723399","id":"13723399","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chenchun","name":"chenchun","key":"chenchun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Chun Chen","active":true,"timeZone":"Asia/Shanghai"},"body":"I also encountered this problem with oracle jdk 1.7.0_21","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chenchun","name":"chenchun","key":"chenchun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Chun Chen","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-07-30T04:50:35.068+0000","updated":"2013-07-30T04:50:35.068+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13723526","id":"13723526","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"Regarding the bug report, that has gone into the black hole of oracle bug reporting system. I haven't heard back from the review process. I wish it was really more *open* !\nMaybe, switching to a different serialization format as suggested in HIVE-1511 is the best bet.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-30T07:45:38.388+0000","updated":"2013-07-30T07:45:38.388+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13723972","id":"13723972","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=appodictic","name":"appodictic","key":"appodictic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Capriolo","active":true,"timeZone":"Etc/UTC"},"body":"I am pretty close to having an xstream patch on HIVE-1511","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=appodictic","name":"appodictic","key":"appodictic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Capriolo","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-30T15:45:25.334+0000","updated":"2013-07-30T15:45:25.334+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13724653","id":"13724653","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdrome","name":"cdrome","key":"cdrome","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Drome","active":true,"timeZone":"America/Los_Angeles"},"body":"[~thejas], I was wondering why none of the other methods which use XMLEncoder are not synchronized as well. Is there something specific about serializeExpression that makes it different?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdrome","name":"cdrome","key":"cdrome","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Drome","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-31T00:23:19.992+0000","updated":"2013-07-31T00:23:19.992+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13724679","id":"13724679","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdrome","name":"cdrome","key":"cdrome","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Drome","active":true,"timeZone":"America/Los_Angeles"},"body":"Specifically, it appears that serializeMapRedWork and serializeMapRedLocalWork may also be called by hive.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdrome","name":"cdrome","key":"cdrome","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Drome","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-31T00:45:25.898+0000","updated":"2013-07-31T00:45:25.898+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13724693","id":"13724693","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"bq, I was wondering why none of the other methods which use XMLEncoder are not synchronized as well. \nI had a brief look at the OpenJDK code again, I could not find a reason why I might not have synchronized other calls to XMLEncoder. It was probably an oversight.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-31T01:01:44.861+0000","updated":"2013-07-31T01:01:44.861+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13724840","id":"13724840","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdrome","name":"cdrome","key":"cdrome","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Drome","active":true,"timeZone":"America/Los_Angeles"},"body":"[~thejas], sorry I was unclear in my previous comment. I was concerned about about other methods in the Utilities.java class that similarly call writeObject on XMLEncoder. It doesn't look like we need to worry about Utilities.serializeTasks or Utilities.serializeQueryPlan. However, it looks like Utilities.serializeMapRedWork or Utilities.serializeMapRedLocalWork.\n\nAdditionally, I'm not sure if we have to be concerned about deserialization which calls readObject.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdrome","name":"cdrome","key":"cdrome","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Drome","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-31T03:59:11.446+0000","updated":"2013-07-31T03:59:11.446+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13724894","id":"13724894","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"With latest version of code (post HIVE-4825 ), in Utilities.java looks like we need the synchronization in only two functions - serializeObject  and serializeExpression .\n\nRegarding deserialization calls, I haven't traced openjdk call hierarchy for that. But the culprit (com.sun.beans.finder.MethodFinder.findMethod) seems to be a call that might be used in deserialization call path as well. Also, I don't have much faith remaining in the overall thread safety of this part of the code. As the  deserialization calls (deserializeExpression, deserializeObject) are called from client side, it would be safer to synchronize them (until of course HIVE-1511 removes use of XMLEncoder)\n\nPTFUtils class is also using XMLEncoder, but those function that uses them don't seem to get used anywhere (PTFUtils.serialize) .\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-31T05:35:14.001+0000","updated":"2013-07-31T05:35:14.001+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13724939","id":"13724939","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdrome","name":"cdrome","key":"cdrome","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Drome","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for your thoughts. We are concerned with 0.10 at this point, but your point is taken. Looking forward to HIVE-1511!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdrome","name":"cdrome","key":"cdrome","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Drome","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-31T06:53:51.662+0000","updated":"2013-07-31T06:53:51.662+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13815086","id":"13815086","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nainostrebor","name":"nainostrebor","key":"nainostrebor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ian Robertson","active":true,"timeZone":"America/Denver"},"body":"I'm seeing this issue in CDH 5 beta 1, which runs jdk1.7.0_25-cloudera and hive-0.11. I have verified it is the same issue - we're seeing stack traces similar to the above in three threads across multiple thread dumps, and the heap dump shows a corrupted WeakHashMap (owned by a WeakCache) with a circular reference in the linked list for one of its buckets.\n\nNotably, CDH5b1 also has a backported patch of HIVE-1511 - see http://archive.cloudera.com/cdh5/cdh/5/hive-0.11.0-cdh5.0.0-beta-1.CHANGES.txt. Perhaps this needs an additional fix?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nainostrebor","name":"nainostrebor","key":"nainostrebor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ian Robertson","active":true,"timeZone":"America/Denver"},"created":"2013-11-06T18:08:21.036+0000","updated":"2013-11-06T18:08:21.036+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13815087","id":"13815087","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nainostrebor","name":"nainostrebor","key":"nainostrebor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ian Robertson","active":true,"timeZone":"America/Denver"},"body":"I'm seeing this issue in CDH 5 beta 1, which runs jdk1.7.0_25-cloudera and hive-0.11. I have verified it is the same issue - we're seeing stack traces similar to the above in three threads across multiple thread dumps, and the heap dump shows a corrupted WeakHashMap (owned by a WeakCache) with a circular reference in the linked list for one of its buckets.\n\nNotably, CDH5b1 also has a backported patch of HIVE-1511 - see http://archive.cloudera.com/cdh5/cdh/5/hive-0.11.0-cdh5.0.0-beta-1.CHANGES.txt. Perhaps this needs an additional fix?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nainostrebor","name":"nainostrebor","key":"nainostrebor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ian Robertson","active":true,"timeZone":"America/Denver"},"created":"2013-11-06T18:08:21.059+0000","updated":"2013-11-06T18:08:21.059+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13815191","id":"13815191","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"I believe that HIVE-5411 will resolve this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-11-06T19:33:39.853+0000","updated":"2013-11-06T19:33:39.853+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13815205","id":"13815205","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"Yes, as you guys have already pointed out, this is not a problem in hive trunk (0.13) as the serialization is done using kryo.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-11-06T19:41:37.662+0000","updated":"2013-11-06T19:41:37.662+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13817506","id":"13817506","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nainostrebor","name":"nainostrebor","key":"nainostrebor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ian Robertson","active":true,"timeZone":"America/Denver"},"body":"For those tracking this issue, the underlying issue is now in the openjdk bug tracker: https://bugs.openjdk.java.net/browse/JDK-8028054 . It's currently scheduled for JDK8; not clear whether it will also be backported to a release of 7.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nainostrebor","name":"nainostrebor","key":"nainostrebor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ian Robertson","active":true,"timeZone":"America/Denver"},"created":"2013-11-08T17:49:00.465+0000","updated":"2013-11-08T17:49:00.465+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648210/comment/13845856","id":"13845856","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slider","name":"slider","key":"slider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven K. Wong","active":true,"timeZone":"America/Los_Angeles"},"body":"[https://bugs.openjdk.java.net/browse/JDK-8028054] now says that the bug is fixed in 8 and backported to 7u60.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slider","name":"slider","key":"slider","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven K. Wong","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-11T23:46:25.372+0000","updated":"2013-12-11T23:46:25.372+0000"}],"maxResults":18,"total":18,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4574/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1kotr:"}}