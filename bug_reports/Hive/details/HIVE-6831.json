{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12706392","self":"https://issues.apache.org/jira/rest/api/2/issue/12706392","key":"HIVE-6831","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-04-08T05:56:19.728+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Apr 08 06:51:38 UTC 2014","customfield_12310420":"384715","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-6831/watchers","watchCount":1,"isWatching":false},"created":"2014-04-03T10:06:08.449+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323587","id":"12323587","description":"Hive 0.11.0","name":"0.11.0","archived":false,"released":true,"releaseDate":"2013-05-15"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-04-08T06:51:38.109+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"Code snippet in  ConditionalTask.java as bellow:  \n\n    // resolved task\n        if (driverContext.addToRunnable(tsk)) {\n          console.printInfo(tsk.getId() + \" is selected by condition resolver.\");\n    }\n\nThe selected task is added into the runnable queue immediately without any dependency checking. If the selected task is original task ,and its parent task is not being executed, then the result will be incorrect.\n\nLike this:\n1. Before skew join optimization:\nStep1 ,Step 2 <-- step 3   ( Step1 and Step2 is Step 3's parent)\n2. after skew join optimization:\nStep1 <- Step4 (ConditionTask)<- consists of [Step3,Step10]    \nStep2 <- Step5 (ConditionTask)<- consists of [Step3,Step11]\n3. Runing\nStep3 is selected in Step4 and Step5\nStep3 will be execute immediately after Step4 , its not correct.\nStep3 will be execute after Step5 again, its not correct either.\n4. The correct scheduler is that step3 will be execute after step4 and step5.\n5. So, I add a checking operate in the snippet  as bellow:\n\n        if (!driverContext.getRunnable().contains(tsk)) {\n          console.printInfo(tsk.getId() + \" is selected by condition resolver.\");\n          if(DriverContext.isLaunchable(tsk)){\n        \t  driverContext.addToRunnable(tsk);\n          }\n        }\n\nSo , that is work right for me in my enviroment. I am not sure whether it will has some problems  in someother condition. \n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12638446","id":"12638446","filename":"6831.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=3h.william","name":"3h.william","key":"3h.william","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"william zhu","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-04-03T10:07:57.423+0000","size":710,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12638446/6831.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"384982","customfield_12312823":null,"summary":"The job schedule in condition task could not be correct with skewed join optimization","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=3h.william","name":"3h.william","key":"3h.william","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"william zhu","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=3h.william","name":"3h.william","key":"3h.william","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"william zhu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Hive 0.11.0","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12706392/comment/13962616","id":"13962616","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"Could you provide the query which induces the situation you've described?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2014-04-08T05:56:19.728+0000","updated":"2014-04-08T05:56:19.728+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12706392/comment/13962630","id":"13962630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=3h.william","name":"3h.william","key":"3h.william","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"william zhu","active":true,"timeZone":"Asia/Shanghai"},"body":"1. The query can be simplied like this:\nSelect * from \n(select   *  from   TableA  Union all select * from TableB)  a\n2.  TableA and TableB is consists of other select query.  \n3.  And I set the hive parameter is : \nset hive.auto.convert.join=false;\nset hive.optimize.skewjoin = true;\nset hive.skewjoin.key = 500000;\nset hive.mapjoin.smalltable.filesize=50000000;\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=3h.william","name":"3h.william","key":"3h.william","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"william zhu","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-04-08T06:28:44.594+0000","updated":"2014-04-08T06:28:44.594+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12706392/comment/13962637","id":"13962637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=3h.william","name":"3h.william","key":"3h.william","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"william zhu","active":true,"timeZone":"Asia/Shanghai"},"body":"The problem is ,the union operate will be resolved two steps(A,B). The two steps have one child steps(C) ,C will aggregate A and B steps.\nAnd in skew join condition task , c will be selected without any check that its parent steps(A,B) have been completed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=3h.william","name":"3h.william","key":"3h.william","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"william zhu","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-04-08T06:51:38.109+0000","updated":"2014-04-08T06:51:38.109+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-6831/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1u9zj:"}}