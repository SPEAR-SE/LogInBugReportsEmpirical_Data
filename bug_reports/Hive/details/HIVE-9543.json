{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12771671","self":"https://issues.apache.org/jira/rest/api/2/issue/12771671","key":"HIVE-9543","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-02-22T18:52:01.058+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed May 18 11:39:57 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-9543/watchers","watchCount":16,"isWatching":false},"created":"2015-02-02T08:26:48.192+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326829","id":"12326829","description":"0.13 maintenance release 1","name":"0.13.1","archived":false,"released":true,"releaseDate":"2014-06-06"}],"issuelinks":[{"id":"12450032","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12450032","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12686504","key":"HIVE-6113","self":"https://issues.apache.org/jira/rest/api/2/issue/12686504","fields":{"summary":"Upgrade DataNucleus [was: Unable to instantiate org.apache.hadoop.hive.metastore.HiveMetaStoreClient]","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=guo_tian_qi","name":"guo_tian_qi","key":"guo_tian_qi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"guo_tian_qi","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-08-08T07:16:50.180+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312584","id":"12312584","name":"Metastore","description":"Tracks issue dealing with metastore."}],"timeoriginalestimate":null,"description":"When i run bin/hive command, i got the following exception:\n{noformat}\nLogging initialized using configuration in jar:file:/home/hadoop/apache-hive-0.13.1-bin/lib/hive-common-0.13.1.jar!/hive-log4j.properties\nException in thread \"main\" java.lang.RuntimeException: java.lang.RuntimeException: Unable to instantiate org.apache.hadoop.hive.metastore.HiveMetaStoreClient\n    at org.apache.hadoop.hive.ql.session.SessionState.start(SessionState.java:346)\n    at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:681)\n    at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:625)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:606)\n    at org.apache.hadoop.util.RunJar.main(RunJar.java:212)\nCaused by: java.lang.RuntimeException: Unable to instantiate org.apache.hadoop.hive.metastore.HiveMetaStoreClient\n    at org.apache.hadoop.hive.metastore.MetaStoreUtils.newInstance(MetaStoreUtils.java:1412)\n    at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.<init>(RetryingMetaStoreClient.java:62)\n    at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.getProxy(RetryingMetaStoreClient.java:72)\n    at org.apache.hadoop.hive.ql.metadata.Hive.createMetaStoreClient(Hive.java:2453)\n    at org.apache.hadoop.hive.ql.metadata.Hive.getMSC(Hive.java:2465)\n    at org.apache.hadoop.hive.ql.session.SessionState.start(SessionState.java:340)\n    ... 7 more\nCaused by: java.lang.reflect.InvocationTargetException\n    at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n    at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)\n    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n    at java.lang.reflect.Constructor.newInstance(Constructor.java:526)\n    at org.apache.hadoop.hive.metastore.MetaStoreUtils.newInstance(MetaStoreUtils.java:1410)\n    ... 12 more\nCaused by: MetaException(message:Metastore contains multiple versions)\n    at org.apache.hadoop.hive.metastore.ObjectStore.getMSchemaVersion(ObjectStore.java:6368)\n    at org.apache.hadoop.hive.metastore.ObjectStore.getMetaStoreSchemaVersion(ObjectStore.java:6330)\n    at org.apache.hadoop.hive.metastore.ObjectStore.checkSchema(ObjectStore.java:6289)\n    at org.apache.hadoop.hive.metastore.ObjectStore.verifySchema(ObjectStore.java:6277)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:606)\n    at org.apache.hadoop.hive.metastore.RawStoreProxy.invoke(RawStoreProxy.java:108)\n    at com.sun.proxy.$Proxy9.verifySchema(Unknown Source)\n    at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.getMS(HiveMetaStore.java:476)\n    at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.createDefaultDB(HiveMetaStore.java:523)\n    at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.init(HiveMetaStore.java:397)\n    at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.<init>(HiveMetaStore.java:356)\n    at org.apache.hadoop.hive.metastore.RetryingHMSHandler.<init>(RetryingHMSHandler.java:54)\n    at org.apache.hadoop.hive.metastore.RetryingHMSHandler.getProxy(RetryingHMSHandler.java:59)\n    at org.apache.hadoop.hive.metastore.HiveMetaStore.newHMSHandler(HiveMetaStore.java:4944)\n    at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.<init>(HiveMetaStoreClient.java:171)\n    ... 17 more\n{noformat}\n\n\n\nAnd i have found two record in metastore table VERSION. after reading source code, i found following code maybe cause the problem: \nIn the org.apache.hadoop.hive.metastore.ObjectStore.java:6289:\n{noformat}\n    String schemaVer = getMetaStoreSchemaVersion();\n    if (schemaVer == null) {\n      // metastore has no schema version information\n      if (strictValidation) {\n            throw new MetaException(\"Version information not found in metastore. \");\n          } else {\n            LOG.warn(\"Version information not found in metastore. \"\n                + HiveConf.ConfVars.METASTORE_SCHEMA_VERIFICATION.toString() +\n                \" is not enabled so recording the schema version \" +\n                MetaStoreSchemaInfo.getHiveSchemaVersion());\n            setMetaStoreSchemaVersion(MetaStoreSchemaInfo.getHiveSchemaVersion(),\n                \"Set by MetaStore\");\n        }\n    }\n{noformat}\n\n\n\nIf there is exception in the {{getMetaStoreSchemaVersion()}}, Hive will insert a duplication record\nAnd i also found my another exception maybe the same cause as above.the exception is :\n\n{noformat}\n Exception in thread \"main\" java.lang.RuntimeException: java.lang.RuntimeException: Unable to instantiate org.apache.hadoop.hive.metastore.HiveMetaStoreClient\n        at org.apache.hadoop.hive.ql.session.SessionState.start(SessionState.java:346)\n        at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:681)\n        at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:625)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:606)\n        at org.apache.hadoop.util.RunJar.main(RunJar.java:212)\nCaused by: java.lang.RuntimeException: Unable to instantiate org.apache.hadoop.hive.metastore.HiveMetaStoreClient\n        at org.apache.hadoop.hive.metastore.MetaStoreUtils.newInstance(MetaStoreUtils.java:1412)\n        at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.<init>(RetryingMetaStoreClient.java:62)\n        at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.getProxy(RetryingMetaStoreClient.java:72)\n        at org.apache.hadoop.hive.ql.metadata.Hive.createMetaStoreClient(Hive.java:2453)\n        at org.apache.hadoop.hive.ql.metadata.Hive.getMSC(Hive.java:2465)\n        at org.apache.hadoop.hive.ql.session.SessionState.start(SessionState.java:340)\n        ... 7 more\nCaused by: java.lang.reflect.InvocationTargetException\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)\n        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n        at java.lang.reflect.Constructor.newInstance(Constructor.java:526)\n        at org.apache.hadoop.hive.metastore.MetaStoreUtils.newInstance(MetaStoreUtils.java:1410)\n        ... 12 more\nCaused by: javax.jdo.JDODataStoreException: Insert of object \"org.apache.hadoop.hive.metastore.model.MRoleMap@2fd02622\" using statement \"INSERT INTO `ROLE_MAP` (`ROLE_GRANT_ID`,`GRANTOR`,`A\nDD_TIME`,`ROLE_ID`,`GRANTOR_TYPE`,`GRANT_OPTION`,`PRINCIPAL_NAME`,`PRINCIPAL_TYPE`) VALUES (?,?,?,?,?,?,?,?)\" failed : Duplicate entry 'hadoop-1-admin-ROLE' for key 'USERROLEMAPINDEX'\nNestedThrowables:\ncom.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException: Duplicate entry 'hadoop-1-admin-ROLE' for key 'USERROLEMAPINDEX'\n        at org.datanucleus.api.jdo.NucleusJDOHelper.getJDOExceptionForNucleusException(NucleusJDOHelper.java:451)\n        at org.datanucleus.api.jdo.JDOPersistenceManager.jdoMakePersistent(JDOPersistenceManager.java:732)\n        at org.datanucleus.api.jdo.JDOPersistenceManager.makePersistent(JDOPersistenceManager.java:752)\n        at org.apache.hadoop.hive.metastore.ObjectStore.grantRole(ObjectStore.java:3058)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:606)\n        at org.apache.hadoop.hive.metastore.RawStoreProxy.invoke(RawStoreProxy.java:108)\n        at com.sun.proxy.$Proxy9.grantRole(Unknown Source)\n        at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.addAdminUsers(HiveMetaStore.java:611)\n        at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.init(HiveMetaStore.java:399)\n        at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.<init>(HiveMetaStore.java:356)\n        at org.apache.hadoop.hive.metastore.RetryingHMSHandler.<init>(RetryingHMSHandler.java:55)\n        at org.apache.hadoop.hive.metastore.RetryingHMSHandler.getProxy(RetryingHMSHandler.java:60)\n        at org.apache.hadoop.hive.metastore.HiveMetaStore.newHMSHandler(HiveMetaStore.java:4944)\n        at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.<init>(HiveMetaStoreClient.java:171)\n        ... 17 more\nCaused by: com.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException: Duplicate entry 'hadoop-1-admin-ROLE' for key 'USERROLEMAPINDEX'\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)\n        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n        at java.lang.reflect.Constructor.newInstance(Constructor.java:526)\n        at com.mysql.jdbc.Util.handleNewInstance(Util.java:406)\n        at com.mysql.jdbc.Util.getInstance(Util.java:381)\n        at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:1015)\n        at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:956)\n        at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:3515)\n        at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:3447)\n        at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1951)\n        at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:2101)\n        at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2554)\n        at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:1761)\n        at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:2046)\n        at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1964)\n        at com.mysql.jdbc.PreparedStatement.executeUpdate(PreparedStatement.java:1949)\n        at com.jolbox.bonecp.PreparedStatementHandle.executeUpdate(PreparedStatementHandle.java:205)\n        at org.datanucleus.store.rdbms.ParamLoggingPreparedStatement.executeUpdate(ParamLoggingPreparedStatement.java:399)\n        at org.datanucleus.store.rdbms.SQLController.executeStatementUpdate(SQLController.java:439)\n        at org.datanucleus.store.rdbms.request.InsertRequest.execute(InsertRequest.java:410)\n        at org.datanucleus.store.rdbms.RDBMSPersistenceHandler.insertTable(RDBMSPersistenceHandler.java:167)\n        at org.datanucleus.store.rdbms.RDBMSPersistenceHandler.insertObject(RDBMSPersistenceHandler.java:143)\n        at org.datanucleus.state.JDOStateManager.internalMakePersistent(JDOStateManager.java:3784)\n        at org.datanucleus.state.JDOStateManager.makePersistent(JDOStateManager.java:3760)\n        at org.datanucleus.ExecutionContextImpl.persistObjectInternal(ExecutionContextImpl.java:2219)\n        at org.datanucleus.ExecutionContextImpl.persistObjectWork(ExecutionContextImpl.java:2065)\n        at org.datanucleus.ExecutionContextImpl.persistObject(ExecutionContextImpl.java:1913)\n        at org.datanucleus.ExecutionContextThreadedImpl.persistObject(ExecutionContextThreadedImpl.java:217)\n        at org.datanucleus.api.jdo.JDOPersistenceManager.jdoMakePersistent(JDOPersistenceManager.java:727)\n        ... 32 more\n{noformat}\n\nThe following code maybe cause the exception, in In the org.apache.hadoop.hive.metastore.ObjectStore.java:3018:\n{noformat}\n      MRole nameCheck = this.getMRole(roleName);\n      if (nameCheck != null) {\n        throw new InvalidObjectException(\"Role \" + roleName + \" already exists.\");\n      }\n      int now = (int)(System.currentTimeMillis()/1000);\n      MRole mRole = new MRole(roleName, now,\n          ownerName);\n      pm.makePersistent(mRole);\n      commited = commitTransaction();\n      success = true;\n{noformat} \n\nIf there is exception in the {{getMRole(roleName)}} function, Hive will try to insert a duplicate record into table ROLE_MAP, this will cause exception above.\n\nSo can we just throw the exception instead of ignoring the exception in the {{getMRole(ObjectStore.java:3292)}} and in the {{getMetaStoreSchemaVersion(ObjectStore.java:6326)}}\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"MetaException(message:Metastore contains multiple versions)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lijy83","name":"lijy83","key":"lijy83","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Junyong Li","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lijy83","name":"lijy83","key":"lijy83","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Junyong Li","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12771671/comment/14332299","id":"14332299","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"Hmm looking at this code:\nhttps://github.com/apache/hive/blob/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java#L6630\n\nThe only way I could see multiple versions being inserted is by multiple clients executing against a HMS which did not have a version recorded.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-02-22T18:52:01.058+0000","updated":"2015-02-22T18:52:01.058+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12771671/comment/14335926","id":"14335926","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lijy83","name":"lijy83","key":"lijy83","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Junyong Li","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi, please look at \nhttps://github.com/apache/hive/blob/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java#L6617\ngetMetaStoreSchemaVersion() will return null if it have MysqlException. this will cause Hive to insert another version record. I think maybe I met this situation","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lijy83","name":"lijy83","key":"lijy83","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Junyong Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-02-25T03:14:38.874+0000","updated":"2015-02-25T03:14:38.874+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12771671/comment/14336882","id":"14336882","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"The only exception which is caught is {{NoSuchObjectException}} which is expected if the table is empty. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-02-25T18:07:44.370+0000","updated":"2015-02-25T18:07:44.370+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12771671/comment/14338069","id":"14338069","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lijy83","name":"lijy83","key":"lijy83","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Junyong Li","active":true,"timeZone":"Asia/Shanghai"},"body":"You are right, but this exception always happens. I am sure The meta already has a verion record before this exceptin happen and after i delete the duplicate record in the mysql table manually everything is ok, But the exception will happen within a few hours. So can you give some else clue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lijy83","name":"lijy83","key":"lijy83","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Junyong Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-02-26T07:59:22.564+0000","updated":"2015-02-26T07:59:22.564+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12771671/comment/14364857","id":"14364857","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pavan101","name":"pavan101","key":"pavan101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavan Srinivas","active":true,"timeZone":"Etc/UTC"},"body":"Hey [~brocknoland], as [~lijy83] pointed out, when ever there is a MysqlException, a duplicate entry will be created. The problem here is with https://db.apache.org/jdo/api20/apidocs/javax/jdo/Query.html#execute%28%29 execute() function of Query.java.  \"execute()\" does not throw any exceptions. \n\nSome reproducible steps: \n1) Make sure metastore db is reachable&running. \n2) Enable debugger and stop at a breakpoint inside checkSchema().\n3) Stop the metastore db or make it unreachable. \n4) Continue on the debugger, you would see execute call of getMSchemaVersion() does not throw exceptions of DB reachability. It just returns an empty array as if there are no entries in the table. Thus making the getMSchemaVersion() throw NoSuchObjectException. \n\n\nThis issue happens when we have a flacky network connection to DB. \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pavan101","name":"pavan101","key":"pavan101","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavan Srinivas","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-17T10:04:02.447+0000","updated":"2015-03-17T10:04:02.447+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12771671/comment/14731888","id":"14731888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuqiang","name":"fuqiang","key":"fuqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"fuqiang cao","active":true,"timeZone":"Etc/UTC"},"body":"hi，have you worked out any approach to solve the problem? i have the same problem. thanks. my QQ:363190371 email:rain841024@163.com","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuqiang","name":"fuqiang","key":"fuqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"fuqiang cao","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-05T09:05:58.085+0000","updated":"2015-09-05T09:05:58.085+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12771671/comment/14964925","id":"14964925","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Feng+Yuan","name":"Feng Yuan","key":"feng yuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=feng+yuan&avatarId=29897","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=feng+yuan&avatarId=29897","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=feng+yuan&avatarId=29897","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=feng+yuan&avatarId=29897"},"displayName":"Feng Yuan","active":true,"timeZone":"Etc/UTC"},"body":"all above 2 errors are due to query.execute() function didnt throw exceptions when network is wrong...i think\nif we can add a exception in this section?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Feng+Yuan","name":"Feng Yuan","key":"feng yuan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=feng+yuan&avatarId=29897","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=feng+yuan&avatarId=29897","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=feng+yuan&avatarId=29897","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=feng+yuan&avatarId=29897"},"displayName":"Feng Yuan","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-20T10:17:34.564+0000","updated":"2015-10-20T10:17:34.564+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12771671/comment/14972999","id":"14972999","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuqiang","name":"fuqiang","key":"fuqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"fuqiang cao","active":true,"timeZone":"Etc/UTC"},"body":"这个问题你们也经常发生吗？我其实现在还没有发现具体什么原因导致 metastore 表中会有多个版本出现？按照你的说法，应该是hive的bug吗？ \n\n\n\n\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuqiang","name":"fuqiang","key":"fuqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"fuqiang cao","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-25T04:12:40.628+0000","updated":"2015-10-25T04:12:40.628+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12771671/comment/15288832","id":"15288832","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qinchaofeng","name":"qinchaofeng","key":"qinchaofeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qinchaofeng&avatarId=30643","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qinchaofeng&avatarId=30643","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qinchaofeng&avatarId=30643","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qinchaofeng&avatarId=30643"},"displayName":"qinchaofeng","active":true,"timeZone":"Etc/UTC"},"body":"I met this today \nwhat is the reason for, anyon can explain ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qinchaofeng","name":"qinchaofeng","key":"qinchaofeng","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qinchaofeng&avatarId=30643","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qinchaofeng&avatarId=30643","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qinchaofeng&avatarId=30643","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qinchaofeng&avatarId=30643"},"displayName":"qinchaofeng","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-18T11:39:57.103+0000","updated":"2016-05-18T11:39:57.103+0000"}],"maxResults":9,"total":9,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-9543/votes","votes":6,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i252dr:"}}