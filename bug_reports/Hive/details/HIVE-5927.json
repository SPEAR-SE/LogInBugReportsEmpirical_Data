{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12682394","self":"https://issues.apache.org/jira/rest/api/2/issue/12682394","key":"HIVE-5927","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2013-12-03 14:24:32.536","customfield_12310420":"361651","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5927/watchers","watchCount":2,"isWatching":false},"created":"2013-12-03T14:24:32.536+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320745","id":"12320745","description":"released","name":"0.10.0","archived":false,"released":true,"releaseDate":"2013-01-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-12-03T14:25:19.741+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313461","id":"12313461","name":"HBase Handler"}],"timeoriginalestimate":null,"description":"Given two hbase tables (hbase shell commands shown to create and populate them):\n\n{code}\ncreate 'tablea', 'data'\ncreate 'tableb', 'data'\nput 'tablea', 'a', 'data:linkb', 'b'\nput 'tableb', 'b', 'data:linka', 'a'\n{code}\n\nAnd given two corresponding hive table definitions:\n\n{code}\ncreate external table tablea(rowkey string, linkb string) stored by 'org.apache.hadoop.hive.hbase.HBaseStorageHandler' with SERDEPROPERTIES ('hbase.columns.mapping' = ':key,data:linkb') tblproperties ('hbase.table.name'='tablea');\ncreate external table tableb(rowkey string, linka string) stored by 'org.apache.hadoop.hive.hbase.HBaseStorageHandler' with SERDEPROPERTIES ('hbase.columns.mapping' = ':key,data:linka') tblproperties ('hbase.table.name'='tableb');\n{code}\n\nThese two queries return no results while they should return a single result:\n\n{code}\nselect * from tablea join tableb on tablea.linkb = tableb.rowkey where tablea.linkb = 'b';\nselect * from tablea join tableb on tablea.linkb = tableb.rowkey where tableb.rowkey = 'b';\n{code}\n\nFor reference, this works:\n\n{code}\nselect * from tablea join tableb on tablea.linkb = tableb.rowkey;\n+---------+--------+---------+--------+\n| rowkey  | linkb  | rowkey  | linka  |\n+---------+--------+---------+--------+\n| a       | b      | b       | a      |\n+---------+--------+---------+--------+\n{code}\n\nI think the problem is related to how the HBaseStorageHandler builds scans. The failing queries result in two scans, one for each table. However, both scans seem to be configured with start and stop row keys = 'b'. This is only correct for the scan over tableb. This seems to be caused by the TableScanDesc.FILTER_EXPR_CONF_STR on the job configuration, which is set to the same value for both cases.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"361949","customfield_12312823":null,"summary":"wrong start/stop key on hbase scan with inner join and where clause on id","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=janvanbesien%40ngdata.com","name":"janvanbesien@ngdata.com","key":"janvanbesien@ngdata.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jan Van Besien","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=janvanbesien%40ngdata.com","name":"janvanbesien@ngdata.com","key":"janvanbesien@ngdata.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jan Van Besien","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5927/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qcb3:"}}