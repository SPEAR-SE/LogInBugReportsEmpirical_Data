{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13025663","self":"https://issues.apache.org/jira/rest/api/2/issue/13025663","key":"HIVE-15359","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12340269","id":"12340269","name":"2.3.0","archived":false,"released":true,"releaseDate":"2017-07-18"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2016-12-07T10:08:14.424+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Dec 08 15:11:50 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_2_*:*_26726103_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_2_*:*_230798829","customfield_12312321":null,"resolutiondate":"2016-12-08T15:11:50.366+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-15359/watchers","watchCount":2,"isWatching":false},"created":"2016-12-05T15:39:45.959+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-07-21T18:26:21.128+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12330946","id":"12330946","name":"Reader"}],"timeoriginalestimate":null,"description":"This issue's reproduce is very like HIVE-12718 , but the data file is larger than 128M . In this case, even make sure only one mapper is used, the footer is still wrongly skipped. \nThis issue happens when hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12842039","id":"12842039","filename":"HIVE-15359.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-06T22:29:58.187+0000","size":4508,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12842039/HIVE-15359.1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"skip.footer.line.count doesnt work properly for certain situations","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025663/comment/15723657","id":"15723657","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"body":"Current skip footer feature need one file map to one split to work properly. The split need to be not only logical one but also physically one. Which means, the related file is unsplitable. Reproduce the issue with a data file has size of 140M. In hadoop, it is put into two blocks: the lengths are: 128M, 12M . 128M is dfs.block.size. For this query, hive use CombineHiveInputSplit to handle split, although logically, There is only one CombineHiveInputSplit(so one mapper), but the split has two paths (the same path with different startpos and lengths: 128M, 12M).\nWhen CombineHiveRecordReader use the split, CombineHiveRecordReader generate two FileSplits for the two blocks. And the code in HiveContextAwareRecordReader that handle skip footer assuming each FileSplit is physically independent file, it skip footer in the first block and does not do any thing in the second block. So some record in the middle of the file is wrongly skipped as the footer, the real footer is still in the result. \nFix the issue by tranfer footerbuffer across FileSplits for the same file, that will make the one mapper case correctly for skipping footer.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-05T23:03:33.853+0000","updated":"2016-12-05T23:03:33.853+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025663/comment/15723661","id":"15723661","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"body":"Need code review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-05T23:04:55.532+0000","updated":"2016-12-05T23:04:55.532+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025663/comment/15728346","id":"15728346","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12842039/HIVE-15359.1.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 11 failed/errored test(s), 10745 tests executed\n*Failed tests:*\n{noformat}\nTestMiniLlapLocalCliDriver - did not produce a TEST-*.xml file (likely timed out) (batchId=143)\n\t[vectorized_rcfile_columnar.q,vector_elt.q,explainuser_1.q,multi_insert.q,tez_dml.q,vector_bround.q,schema_evol_orc_acid_table.q,vector_when_case_null.q,orc_ppd_schema_evol_1b.q,vector_join30.q,vectorization_11.q,cte_3.q,update_tmp_table.q,vector_decimal_cast.q,groupby_grouping_id2.q,vector_decimal_round.q,tez_smb_empty.q,orc_merge6.q,vector_decimal_trailing.q,cte_5.q,tez_union.q,cbo_rp_subq_not_in.q,vector_decimal_2.q,columnStatsUpdateForStatsOptimizer_1.q,vector_outer_join3.q,schema_evol_text_vec_part_all_complex.q,tez_dynpart_hashjoin_2.q,auto_sortmerge_join_12.q,offset_limit.q,tez_union_multiinsert.q]\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_sortmerge_join_2] (batchId=44)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[dbtxnmgr_showlocks] (batchId=71)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample2] (batchId=5)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample4] (batchId=15)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample6] (batchId=61)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample7] (batchId=60)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample9] (batchId=38)\norg.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=134)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[stats_based_fetch_decision] (batchId=150)\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=92)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/2455/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/2455/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2455/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 11 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12842039 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2016-12-07T10:08:14.424+0000","updated":"2016-12-07T10:08:14.424+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025663/comment/15728918","id":"15728918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"body":"The failures are not related.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-07T14:41:06.503+0000","updated":"2016-12-07T14:41:06.503+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025663/comment/15729820","id":"15729820","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"body":"The patch looks good. \nIt would be good if we can add some comments  to \n\n{noformat}\n   if (preReader != null && preReader instanceof CombineHiveRecordReader\n73\t        && ((CombineHiveRecordReader)preReader).getFooterBuffer() != null) {\n74\t      if (partition != 0 && hsplit.getPaths()[partition -1].equals(hsplit.getPaths()[partition])) //the split is from same file as previous split.\n75\t        this.setFooterBuffer(((CombineHiveRecordReader)preReader).getFooterBuffer());\n{noformat}\n\n+1. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-12-07T20:23:52.137+0000","updated":"2016-12-07T20:23:52.137+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13025663/comment/15732452","id":"15732452","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~aihuaxu] for reviewing the code, the code is committed to master with added comment. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"created":"2016-12-08T15:11:50.667+0000","updated":"2016-12-08T15:11:50.667+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-15359/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i376bb:"}}