{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13205057","self":"https://issues.apache.org/jira/rest/api/2/issue/13205057","key":"HIVE-21054","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2018-12-18 07:13:17.653","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-21054/watchers","watchCount":1,"isWatching":false},"created":"2018-12-18T07:13:17.653+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12344240","id":"12344240","name":"3.1.1","archived":false,"released":true,"releaseDate":"2018-11-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-12-21T05:59:41.523+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12324798","id":"12324798","name":"Query Planning"}],"timeoriginalestimate":null,"description":" i make 3 tables \r\n\r\n \r\n{code:java}\r\n// 코드 자리 표시자\r\nCREATE TABLE `testdb`.`tab` ( \r\nstn1 STRING COMMENT '' ,\r\nint2 BIGINT COMMENT '' ,\r\nfloat3 FLOAT COMMENT '' ,\r\nlong4 STRING COMMENT '' ,\r\ndouble5 DOUBLE COMMENT '' ,\r\nboolean6 BOOLEAN COMMENT '' ,\r\ntimestamp7 TIMESTAMP COMMENT '' ,\r\nwords8 STRING COMMENT '' ,\r\nemail9 STRING COMMENT '' ,\r\ntime10 STRING COMMENT '' ,\r\nint11 BIGINT COMMENT '' ,\r\nfloat12 FLOAT COMMENT '' ,\r\nlong13 STRING COMMENT '' ,\r\ndouble14 DOUBLE COMMENT '' ,\r\nboolean15 BOOLEAN COMMENT '' ,\r\ntimestamp16 TIMESTAMP COMMENT '' ,\r\nemail17 STRING COMMENT '' ,\r\ntime18 STRING COMMENT '' ,\r\nlist19 STRING COMMENT '' ,\r\nid20 STRING COMMENT '' ,\r\nsqltime21 TIMESTAMP COMMENT '' ,\r\nctype22 INT COMMENT '' ,\r\nreg23 STRING COMMENT '' \r\n)\r\n\r\nCREATE TABLE `testdb`.`space` ( \r\nstn1 STRING COMMENT '' ,\r\nint2 BIGINT COMMENT '' ,\r\nfloat3 FLOAT COMMENT '' ,\r\nlong4 STRING COMMENT '' ,\r\ndouble5 DOUBLE COMMENT '' ,\r\nboolean6 BOOLEAN COMMENT '' ,\r\ntimestamp7 TIMESTAMP COMMENT '' ,\r\nwords8 STRING COMMENT '' ,\r\nemail9 STRING COMMENT '' ,\r\ntime10 STRING COMMENT '' ,\r\nint11 BIGINT COMMENT '' ,\r\nfloat12 FLOAT COMMENT '' ,\r\nlong13 STRING COMMENT '' ,\r\ndouble14 DOUBLE COMMENT '' ,\r\nboolean15 BOOLEAN COMMENT '' ,\r\ntimestamp16 TIMESTAMP COMMENT '' ,\r\nemail17 STRING COMMENT '' ,\r\ntime18 STRING COMMENT '' ,\r\nlist19 STRING COMMENT '' ,\r\nid20 STRING COMMENT '' ,\r\nsqltime21 TIMESTAMP COMMENT '' ,\r\nctype22 INT COMMENT '' ,\r\nreg23 STRING COMMENT '' \r\n)\r\n\r\nCREATE TABLE `testdb`.`colon` ( \r\nstn1 STRING COMMENT '' ,\r\nint2 BIGINT COMMENT '' ,\r\nfloat3 FLOAT COMMENT '' ,\r\nlong4 STRING COMMENT '' ,\r\ndouble5 DOUBLE COMMENT '' ,\r\nboolean6 BOOLEAN COMMENT '' ,\r\ntimestamp7 TIMESTAMP COMMENT '' ,\r\nwords8 STRING COMMENT '' ,\r\nemail9 STRING COMMENT '' ,\r\ntime10 STRING COMMENT '' ,\r\nint11 BIGINT COMMENT '' ,\r\nfloat12 FLOAT COMMENT '' ,\r\nlong13 STRING COMMENT '' ,\r\ndouble14 DOUBLE COMMENT '' ,\r\nboolean15 BOOLEAN COMMENT '' ,\r\ntimestamp16 TIMESTAMP COMMENT '' ,\r\nemail17 STRING COMMENT '' ,\r\ntime18 STRING COMMENT '' ,\r\nlist19 STRING COMMENT '' ,\r\nid20 STRING COMMENT '' ,\r\nsqltime21 TIMESTAMP COMMENT '' ,\r\nctype22 INT COMMENT '' ,\r\nreg23 STRING COMMENT '' \r\n)\r\n{code}\r\n \r\n\r\n \r\n\r\nand execute query at below : \r\n{code:java}\r\n// \r\nset hive.vectorized.execution.enabled=FALSE;\r\n\r\nSELECT distinct t1.ctype, t1.id_all , t2.list19\r\nFROM (\r\nSELECT ctype22 AS ctype, id20 AS id_all, list19 AS item_list \r\nFROM tab WHERE stn1='20130101010100'\r\nAND ctype22 BETWEEN 2 AND 5   --result 45 row\r\n\r\nUNION ALL \r\n\r\nSELECT ctype22 AS ctype, id20 AS id_all, list19 AS item_list \r\nFROM space \r\nWHERE stn1='20130102010100'\r\nAND ctype22 BETWEEN 2 AND 5   --result empty\r\n\r\n) t1 JOIN colon t2 ON (t1.id_all = t2.id20 AND t2.list19 ='ITEM30') -- join matched 3 rows\r\n{code}\r\nexpected result \r\n||ctype||id_all||list19||\r\n|2|104|ITEM30|\r\n|2|683|ITEM30|\r\n|1|970|ITEM30|\r\n\r\nbut, actual result empty..\r\n\r\n \r\n\r\n \r\n\r\ninstead make table \"union all\" query result\r\n{code:java}\r\n// 코드 자리 표시자\r\nset hive.vectorized.execution.enabled=FALSE;\r\n\r\ncreate table unionalltbl as\r\nSELECT ctype22 AS close_type, id20 AS id_all, list19 AS ITEM_list \r\nFROM tab WHERE stn1='20130101010100'\r\nAND ctype22 BETWEEN 2 AND 5 \r\n\r\nUNION ALL \r\n\r\nSELECT ctype22 AS close_type, id20 AS id_all, list19 AS ITEM_list \r\nFROM space \r\nWHERE stn1='20130102010100'\r\nAND ctype22 BETWEEN 2 AND 5\r\n{code}\r\n \r\n\r\nand retry query \r\n{code:java}\r\n// 코드 자리 표시자\r\nset hive.vectorized.execution.enabled=FALSE;\r\n\r\nselect DISTINCT t1.close_type, t1.id_all, t2.list19\r\nfrom unionalltbl t1 JOIN colon t2 ON t1.id_all=t2.id20 and t2.list19='ITEM30'\r\n{code}\r\ni got expected result \r\n\r\n \r\n\r\nand i compare two query explain\r\n first query\r\n{code:java}\r\n// 코드 자리 표시자\r\nrel#18659:HiveProject.HIVE.[](input=rel#18657:HiveAggregate.HIVE.[]\r\n(\r\ninput=rel#18655:HiveProject.HIVE.[]\r\n(\r\ninput=rel#18653:HiveJoin.HIVE.[]\r\n(\r\nleft=rel#18650:HiveProject.HIVE.[]\r\n(\r\ninput=rel#18648:HiveUnion.HIVE.[]\r\n(\r\ninput#0=rel#18641:HiveProject.HIVE.[]\r\n(\r\ninput=rel#18639:HiveFilter.HIVE.[]\r\n(\r\ninput=rel#18611:HiveTableScan.HIVE.[](table=[testdb.tab],table:alias=tab)[false]\r\n,condition=AND(=($0, _UTF-16LE'20130101010100'), BETWEEN(false, $21, 2, 5))\r\n)\r\n,close_type=$21,id_all=$19,item_list=$18\r\n)\r\n,input#1=rel#18646:HiveProject.HIVE.[]\r\n( \r\ninput=rel#18644:HiveFilter.HIVE.[]\r\n(\r\ninput=rel#18614:HiveTableScan.HIVE.[](table=[testdb.space],table:alias=space)[false]\r\n,condition=AND(=($0, _UTF-16LE'20130102010100'), BETWEEN(false, $21, 2, 5))\r\n),close_type=$21,id_all=$19,item_list=$18\r\n)\r\n,all=true\r\n)\r\n,close_type=$0,id_all=$1,item_list=$2\r\n),\r\nright=rel#18619:HiveTableScan.HIVE.[]\r\n(\r\ntable=[testdb.colon],table:alias=t2\r\n)\r\n[false],condition=AND\r\n(\r\n=($1, $22), =($21, _UTF-16LE'ITEM30')\r\n)\r\n,joinType=inner,algorithm=none,cost=not available\r\n)\r\n,$f0=$0,$f1=$1,$f2=$21\r\n)\r\n,group={0, 1, 2}\r\n)\r\n,close_type=$0,id_all=$1,list19=$2)\r\n{code}\r\nsecond query\r\n{code:java}\r\n// 코드 자리 표시자\r\nrel#17893:HiveProject.HIVE.[]\r\n(\r\ninput=rel#17891:HiveAggregate.HIVE.[]\r\n(\r\ninput=rel#17889:HiveProject.HIVE.[]\r\n(\r\ninput=rel#17887:HiveJoin.HIVE.[]\r\n(\r\nleft=rel#17872:HiveTableScan.HIVE.[]\r\n(able=[testdb.unionalltbl],table:alias=t1)[false],\r\n\r\nright=rel#17873:HiveTableScan.HIVE.[](table=[testdb.colon],table:alias=t2)[false],\r\ncondition=AND(=($1, $25), =($24, _UTF-16LE'ITEM30')),\r\njoinType=inner,algorithm=none,cost=not available\r\n),\r\n$f0=$0,$f1=$1,$f2=$24\r\n),\r\ngroup={0, 1, 2}\r\n)\r\n,close_type=$0,id_all=$1,list19=$2\r\n)\r\n{code}\r\nwhy right table 'colon' condition column number different? \r\n\r\n ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"union all and join result wrong","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dave.kim","name":"dave.kim","key":"dave.kim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"daveKim","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dave.kim","name":"dave.kim","key":"dave.kim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34045","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"},"displayName":"daveKim","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-21054/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|u002s0:"}}