{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12686560","self":"https://issues.apache.org/jira/rest/api/2/issue/12686560","key":"HIVE-6117","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324986","id":"12324986","description":"released","name":"0.13.0","archived":false,"released":true,"releaseDate":"2014-04-21"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-12-27T20:06:09.392+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Dec 30 17:47:41 UTC 2013","customfield_12310420":"365551","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_241173073_*|*_1_*:*_1_*:*_505938_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-12-30T14:54:23.783+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-6117/watchers","watchCount":3,"isWatching":false},"created":"2013-12-27T19:46:24.812+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12380448","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12380448","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12674338","key":"HBASE-9791","self":"https://issues.apache.org/jira/rest/api/2/issue/12674338","fields":{"summary":"MR initializes scanner twice","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-12-30T17:47:41.136+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313461","id":"12313461","name":"HBase Handler"}],"timeoriginalestimate":null,"description":"The HBase storage handler makes use of a mapreduce.RecordReader instance but does not initialize it when consumed from local context. This results in a NPE for some queries, for instance\n\n{noformat}\ncreate table hbase_1(key string, age int) stored by 'org.apache.hadoop.hive.hbase.HBaseStorageHandler' with serdeproperties ( \"hbase.columns.mapping\" = \"info:age\");\ninsert overwrite table hbase_1 select name, SUM(age) from studenttab10k group by name;\nselect * from hbase_1;\n{noformat}\n\nThe select statement throws the following exception\n\n{noformat}\n13/12/18 01:30:32 ERROR CliDriver: Failed with exception java.io.IOException:java.lang.NullPointerException\njava.io.IOException: java.lang.NullPointerException\nat org.apache.hadoop.hive.ql.exec.FetchOperator.getNextRow(FetchOperator.java:551)\nat org.apache.hadoop.hive.ql.exec.FetchOperator.pushRow(FetchOperator.java:489)\nat org.apache.hadoop.hive.ql.exec.FetchTask.fetch(FetchTask.java:136)\nat org.apache.hadoop.hive.ql.Driver.getResults(Driver.java:1494)\nat org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:271)\nat org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:216)\nat org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:413)\nat org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:348)\nat org.apache.hadoop.hive.cli.CliDriver.processReader(CliDriver.java:446)\nat org.apache.hadoop.hive.cli.CliDriver.processFile(CliDriver.java:456)\nat org.apache.hadoop.hive.cli.CliDriver.executeDriver(CliDriver.java:737)\nat org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:675)\nat org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:614)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.lang.reflect.Method.invoke(Method.java:601)\nat org.apache.hadoop.util.RunJar.main(RunJar.java:212)\nCaused by: java.lang.NullPointerException\nat org.apache.hadoop.hbase.mapreduce.TableRecordReaderImpl.nextKeyValue(TableRecordReaderImpl.java:196)\nat org.apache.hadoop.hbase.mapreduce.TableRecordReader.nextKeyValue(TableRecordReader.java:138)\nat org.apache.hadoop.hive.hbase.HiveHBaseTableInputFormat$1.next(HiveHBaseTableInputFormat.java:234)\nat org.apache.hadoop.hive.hbase.HiveHBaseTableInputFormat$1.next(HiveHBaseTableInputFormat.java:193)\nat org.apache.hadoop.hive.ql.exec.FetchOperator.getNextRow(FetchOperator.java:521)\n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12620641","id":"12620641","filename":"6117.00.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-27T19:54:36.233+0000","size":807,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12620641/6117.00.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12620732","id":"12620732","filename":"HIVE-6117.0.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-28T13:55:02.113+0000","size":807,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12620732/HIVE-6117.0.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"365859","customfield_12312823":null,"summary":"mapreduce.RecordReader instance needs to be initialized","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13857681","id":"13857681","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"body":"Attaching patch for trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-27T19:54:36.238+0000","updated":"2013-12-27T19:54:36.238+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13857689","id":"13857689","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Nick. Looks like this was caused by HBASE-9791. Was hive not correctly using the API or this an API change?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-27T20:06:09.392+0000","updated":"2013-12-27T20:06:09.392+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13857697","id":"13857697","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"body":"Oh, good catch [~brocknoland]. I think the responsibility lies with Hive because, in this case, the RecordReader is being consumed outside of the MapReduce Framework context. I don't know *where* Hive should initialize the RecordReader -- my patch may result in a double-initialize for the mapreduce case, but corrects the problem for the local query. I think, somehow, processLocalCmd needs to indicate to HiveHBaseTableInputFormat that its RecordReader is being consumed outside of MapReduce. Perhaps you can advise?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-27T20:16:33.359+0000","updated":"2013-12-27T20:16:33.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13857735","id":"13857735","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"Hmm, does this same error not occur during a MR run?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-27T21:05:53.540+0000","updated":"2013-12-27T21:05:53.540+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13857747","id":"13857747","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"body":"Not sure; can I force the SELECT statement to run as a job?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-27T21:25:47.842+0000","updated":"2013-12-27T21:25:47.842+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13857749","id":"13857749","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"SELECT count(\\*) from table","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-27T21:28:27.748+0000","updated":"2013-12-27T21:28:27.748+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13857758","id":"13857758","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"body":"SELECT count(*) FROM hbase_1; gave me a MR job. It ran without complaint.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-27T21:35:43.882+0000","updated":"2013-12-27T21:35:43.882+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13857762","id":"13857762","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"It ran correctly with or without the patch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-27T21:39:20.550+0000","updated":"2013-12-27T21:39:20.550+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13857763","id":"13857763","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"body":"Ran correctly with the patch.\n\nBuildBot should verify as well, yes?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-27T21:41:25.168+0000","updated":"2013-12-27T21:41:25.168+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13857784","id":"13857784","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Nick!  I have seen this error with MR + HBase trunk.\n\nAs fair as I can tell we have not yet answered the question \"Was hive not correctly using the API or this an API change?\" I am fine making the change to Hive, but we should know if hive was simply using HBase incorrectly or if HBase is changing the API.\n\nBrock","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-27T21:56:33.864+0000","updated":"2013-12-27T21:56:33.864+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13857818","id":"13857818","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"body":"Technically speaking, HBase changed the way it initializes this particular MapReduce component via a public API, thus HBase's API has changed. Hive is consuming that component without respecting its API -- that is, Hadoop's mapreduce.RecordReader says the framework will call initialize, so Hive should be calling initialize when consuming it outside of the MapReduce Framework context. I think the answer is \"both\". Perhaps HBASE-9791 needs to add a release note.\n\ncc [~stack] [~jxiang].","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-27T22:54:05.586+0000","updated":"2013-12-27T22:54:05.586+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13858024","id":"13858024","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"Reuploading the exact same patch with a new file name so HiveQA will pick it up.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-28T13:55:02.118+0000","updated":"2013-12-28T13:55:02.118+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13858025","id":"13858025","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"Thank you for clarifying. I am +1 if the tests pass.\n\nbq. Hadoop's mapreduce.RecordReader says the framework will call initialize,\n\nWhat's interesting is I have seen this same error occur within an MR job. Additionally we are doing some weird wrapping of RR here. Therefore I think it's likely that Hive should be calling initialize itself even in the MR case. I think this patch will in fact do this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-28T13:57:40.984+0000","updated":"2013-12-28T13:57:40.984+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13858201","id":"13858201","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12620732/HIVE-6117.0.patch\n\n{color:green}SUCCESS:{color} +1 4818 tests passed\n\nTest results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/762/testReport\nConsole output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/762/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12620732","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-12-29T01:04:03.299+0000","updated":"2013-12-29T01:04:03.299+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13858497","id":"13858497","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jxiang","name":"jxiang","key":"jxiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jimmy Xiang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~ndimiduk], I think HBASE-9791 fixed a bug in HBase that does initialization twice. If some subclass needs to call initialization again, does this mean the fix in HBASE-9791 is not right?  If it is right, why should HIVE need to call init again?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jxiang","name":"jxiang","key":"jxiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jimmy Xiang","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-30T00:47:20.583+0000","updated":"2013-12-30T00:47:20.583+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13858837","id":"13858837","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"Hey guys,\n\nI think I see the issue here. o.a.h.mapreduce.RecordReader has an initialize method which is called by the mapper. o.a.h.mapred.RecordReader does not have an initialize method. Hive uses the mapred API so you can see here: https://github.com/apache/hive/blob/fb63a28cd5fddb5e5c974cab84cd9c3a4155e40d/hbase-handler/src/java/org/apache/hadoop/hive/hbase/HiveHBaseTableInputFormat.java#L178\n\nthat we wrap the mapreduce RR from HBase in a mapred RR. Therefore it's hive's responsibility to call initialize which we are not doing. Therefore the patch looks correct and I will commit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-30T14:43:07.318+0000","updated":"2013-12-30T14:43:07.318+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13858845","id":"13858845","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"I also verified that this patch fixes the NPE I was seeing with *both* select \\* from table (no-MR job) and select count(\\*) from table (MR job).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-30T14:52:52.164+0000","updated":"2013-12-30T14:52:52.164+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13858846","id":"13858846","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to trunk! Thank you Nick and Jimmy for your help on this one!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-30T14:54:23.813+0000","updated":"2013-12-30T14:54:23.813+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12686560/comment/13858955","id":"13858955","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. that we wrap the mapreduce RR from HBase in a mapred RR. Therefore it's hive's responsibility to call initialize which we are not doing. Therefore the patch looks correct and I will commit.\n\nYes, that's my understanding too. Thanks [~brocknoland], [~jxiang] for the context and quick response!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-30T17:47:41.136+0000","updated":"2013-12-30T17:47:41.136+0000"}],"maxResults":19,"total":19,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-6117/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1r0fz:"}}