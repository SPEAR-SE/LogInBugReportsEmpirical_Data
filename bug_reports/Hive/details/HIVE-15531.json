{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13031651","self":"https://issues.apache.org/jira/rest/api/2/issue/13031651","key":"HIVE-15531","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2017-01-03T19:34:20.093+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jan 18 01:03:52 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1144467_*|*_3_*:*_1_*:*_27448490_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_2_*:*_1225389916","customfield_12312321":null,"resolutiondate":"2017-01-18T01:03:52.008+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-15531/watchers","watchCount":3,"isWatching":false},"created":"2017-01-03T12:44:09.198+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334255","id":"12334255","name":"2.1.0","archived":false,"released":true,"releaseDate":"2016-06-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhiraj.kumar","name":"dhiraj.kumar","key":"dhiraj.kumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dhiraj Kumar","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-01-18T01:03:52.064+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Hadoop (2.7), which is using Commons-logging is not compatible with log4j2 without bridge. \n\nThe bridge is missing in Hive. \n\nThis leads to a problem whereby commons-logging initialises a log4j (1.2) version Logger, does not configure it properly since configuration for it is missing and sends logging output to stdout (the default). \n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12845384","id":"12845384","filename":"HIVE-15531.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhiraj.kumar","name":"dhiraj.kumar","key":"dhiraj.kumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dhiraj Kumar","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-03T13:02:21.605+0000","size":1500,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12845384/HIVE-15531.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Hive breaks Hadoop commons logging with log4j2","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhiraj.kumar","name":"dhiraj.kumar","key":"dhiraj.kumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dhiraj Kumar","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhiraj.kumar","name":"dhiraj.kumar","key":"dhiraj.kumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dhiraj Kumar","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031651/comment/15795972","id":"15795972","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 pending tests","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-03T19:34:20.093+0000","updated":"2017-01-03T19:34:20.093+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031651/comment/15795975","id":"15795975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"[~dhiraj.kumar] -can you change it to patch available, so that the tests would run-? nm, done","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-03T19:35:00.836+0000","updated":"2017-01-03T20:41:23.322+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031651/comment/15796261","id":"15796261","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12845384/HIVE-15531.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 9 failed/errored test(s), 10899 tests executed\n*Failed tests:*\n{noformat}\nTestDerbyConnector - did not produce a TEST-*.xml file (likely timed out) (batchId=233)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[case_sensitivity] (batchId=61)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input_testxpath] (batchId=28)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udf_coalesce] (batchId=75)\norg.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[orc_ppd_basic] (batchId=134)\norg.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[orc_ppd_schema_evol_3a] (batchId=135)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[subquery_notin] (batchId=150)\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=93)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.org.apache.hadoop.hive.cli.TestSparkCliDriver (batchId=96)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/2768/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/2768/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2768/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 9 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12845384 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-01-03T21:37:03.830+0000","updated":"2017-01-03T21:37:03.830+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031651/comment/15798980","id":"15798980","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhiraj.kumar","name":"dhiraj.kumar","key":"dhiraj.kumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dhiraj Kumar","active":true,"timeZone":"Etc/UTC"},"body":"[~sershe], I dug the bug deeper and found out that it was our environmental issue. There were two problem at our end,\n\n1. An UDF jar in near beginning of classpath with log4j (1.2) classes in it. It was picked by Commons-logger. \n2. Another jar, having a basic log4j.properties was picked for properties since hive configuration directory (top in class path) was missing log4j.properties and was having log4j2.properties. \n\nSo, even without log4j-jcl (current patch), it may work fine. Since log4j-1.2-api (already part of hive 2.x) has org.apache.log4j.Logger class and initialises it properly with log4j2 configuration. That works like bridge. \nProvided there is no other class in class path before log4j-1.2-api which has org.apache.log4j.Logger class. \n\nlog4j-jcl overcomes classpath issue since commons-logging tries to find LogFactory and log4j-jcl injects itself there. So there won't be any classpath issue with it. Code snippet below from org.apache.commons.logging.LogFactory\n\n{code}\n// Second, try to find a service by using the JDK1.3 class\n        // discovery mechanism, which involves putting a file with the name\n        // of an interface class in the META-INF/services directory, where the\n        // contents of the file is a single line specifying a concrete class\n        // that implements the desired interface.\n\n        if (factory == null) {\n            if (isDiagnosticsEnabled()) {\n                logDiagnostic(\"[LOOKUP] Looking for a resource file of name [\" + SERVICE_ID +\n                              \"] to define the LogFactory subclass to use...\");\n            }\n            try {\n                final InputStream is = getResourceAsStream(contextClassLoader, SERVICE_ID);\n{code}\n\nSince this issue reflects itself based on classpath, I am thinking to inject log4j 1.2 in classpath with test scope and check that right class has been loaded by Commons logging. \nWould like to know your thoughts. \n\n\n\n\n\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhiraj.kumar","name":"dhiraj.kumar","key":"dhiraj.kumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dhiraj Kumar","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-04T18:31:35.140+0000","updated":"2017-01-04T18:31:35.140+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031651/comment/15800899","id":"15800899","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhiraj.kumar","name":"dhiraj.kumar","key":"dhiraj.kumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dhiraj Kumar","active":true,"timeZone":"Etc/UTC"},"body":"Related issue [HIVE-11572|https://issues.apache.org/jira/browse/HIVE-11572]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhiraj.kumar","name":"dhiraj.kumar","key":"dhiraj.kumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dhiraj Kumar","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-05T09:35:55.681+0000","updated":"2017-01-05T09:35:55.681+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031651/comment/15803961","id":"15803961","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhiraj.kumar","name":"dhiraj.kumar","key":"dhiraj.kumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dhiraj Kumar","active":true,"timeZone":"Etc/UTC"},"body":"[~sershe] I thought about test cases with below approach \na) Manipulating classpath at runtime to put log4j 1.2 before log4j 2.4 libraries and showcasing the fact that commons-log will pick older version of logger. \nb) Keeping log4j 1.2 in beginning and putting log4j-jcl anywhere in classpath and showing that commons-logging will pick Log4j 2.4 \n\nThe problem with this approach I have to manipulate classpath at runtime which might affect other tests downstream. Moreover, I am not able to find a clean solution to do it. \n\nWould a trivial test like this suffice? \n\n{code}\n    Log log = LogFactory.getLog(CommonsLoggingTest.class);\n    assertEquals(log.getClass(),org.apache.logging.log4j.jcl.Log4jLog.class);\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhiraj.kumar","name":"dhiraj.kumar","key":"dhiraj.kumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dhiraj Kumar","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-06T08:23:13.823+0000","updated":"2017-01-06T08:23:13.823+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031651/comment/15805856","id":"15805856","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"Hmm... not sure what the best approach there. Does Hive logger still get log4j2, and Hadoop logger log4j? My assumption was that with slf4j, they'd both use the same.\n[~prasanth_j] did the slf4j work and might know better.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-06T21:44:21.444+0000","updated":"2017-01-06T21:44:21.444+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031651/comment/15810881","id":"15810881","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhiraj.kumar","name":"dhiraj.kumar","key":"dhiraj.kumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dhiraj Kumar","active":true,"timeZone":"Etc/UTC"},"body":"{quote}   Does Hive logger still get log4j2, and Hadoop logger log4j?  {quote}\n\nIt is possible if classpath is messed up. Will depend what extra library end user has put in their classpath. That is exactly what happened in my case as explained in earlier comment. \nThis patch makes sure that even if end users mess up their classpath (just from log4j perspective), still logging will be setup properly and won't get into log4j vs log4j2 issue. \n\nI did not look it from the perspective of slf4j. \n\n[~prasanth_j] can you have a look?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhiraj.kumar","name":"dhiraj.kumar","key":"dhiraj.kumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dhiraj Kumar","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-09T07:07:38.890+0000","updated":"2017-01-09T07:07:38.890+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031651/comment/15811016","id":"15811016","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"body":"We used to have log4j-jcl bridge before when hive used both commons logging and slf4j. We then moved hive completely use slf4j removing the log4j-jcl bridge as it is no longer required. This is the commit that moved to slf4j and remove log4j-jcl bridge.\nhttps://github.com/apache/hive/commit/a8ea6d82b0b6763f846848afeb5b338ab94e474a\n\nRegarding the classpath ordering, we always force loading log4j2 jars first before loading hadoop jars. \nhttps://github.com/apache/hive/blob/master/bin/hive#L193","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-09T08:15:30.139+0000","updated":"2017-01-09T08:19:30.338+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031651/comment/15811588","id":"15811588","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhiraj.kumar","name":"dhiraj.kumar","key":"dhiraj.kumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dhiraj Kumar","active":true,"timeZone":"Etc/UTC"},"body":"If commons-logging is not used by hive then log4j-jcl is not required. But if commons-logging is being used by Hadoop, a bridge will be required. By default log4j-1.2-api acts as bridge for hadoop logging which had been added in the commit \n\nhttps://github.com/apache/hive/commit/c93d6c77e31e2eb9b40f5167ab3491d44eae351a\n\nAlso agree that with classpath properly ordered, this issue will not surface at all. \n\nI would have liked it with log4j-jcl, removing classpath ordering dependency as well as user lib into classpath (coming higher than hive log4j's lib)\n\nI will leave it to you and will close the discussion here. \n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhiraj.kumar","name":"dhiraj.kumar","key":"dhiraj.kumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dhiraj Kumar","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-09T11:50:51.236+0000","updated":"2017-01-09T11:50:51.236+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13031651/comment/15827172","id":"15827172","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"body":"Closing it for now as hive enforces the classpath ordering which will avoid the issue. Will revisit later if we run into issues. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-18T01:03:52.054+0000","updated":"2017-01-18T01:03:52.054+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-15531/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i38793:"}}