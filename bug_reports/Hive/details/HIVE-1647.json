{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12474306","self":"https://issues.apache.org/jira/rest/api/2/issue/12474306","key":"HIVE-1647","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315150","id":"12315150","description":"released","name":"0.7.0","archived":false,"released":true,"releaseDate":"2011-03-29"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-09-16T18:38:50.916+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Sep 30 22:10:09 UTC 2010","customfield_12310420":"72795","customfield_12312320":null,"customfield_12310222":"10002_*:*_2_*:*_385327929_*|*_1_*:*_3_*:*_4290379672_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-11-09T21:19:55.641+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-1647/watchers","watchCount":0,"isWatching":false},"created":"2010-09-16T18:31:28.040+0000","customfield_12310192":"This problem is fixed in Hive-1754","customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":600,"aggregatetimeoriginalestimate":600,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314524","id":"12314524","description":"released","name":"0.6.0","archived":false,"released":true,"releaseDate":"2010-10-29"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315150","id":"12315150","description":"released","name":"0.7.0","archived":false,"released":true,"releaseDate":"2011-03-29"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liyin","name":"liyin","key":"liyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Liyin Tang","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-12-16T23:59:26.862+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312588","id":"12312588","name":"Server Infrastructure","description":"Tracks issues dealing with Server infrastructure"}],"timeoriginalestimate":600,"description":"Bug in org.apache.hadoop.hive.ql.io.IOContext\nin relation to initialization of thread local variable.\n \npublic class IOContext {\n \n  private static ThreadLocal<IOContext> threadLocal = new ThreadLocal<IOContext>(){ };\n \n  static {\n    if (threadLocal.get() == null) {\n      threadLocal.set(new IOContext());\n    }\n  }\n \nIn a multi-threaded environment, the thread that gets to load the class first for the JVM (assuming threads share the classloader),\ngets to initialize itself correctly by executing the code in the static block. Once the class is loaded, \nany subsequent threads would  have their respective threadlocal variable as null.  Since IOContext\nis set during initialization of HiveRecordReader, In a scenario where multiple threads get to acquire\n an instance of HiveRecordReader, it would result in a NPE for all but the first thread that gets to load the class in the VM.\n \nIs the above scenario of multiple threads initializing HiveRecordReader a typical one ?  or we could just provide the following fix...\n \n  private static ThreadLocal<IOContext> threadLocal = new ThreadLocal<IOContext>(){\n    protected synchronized IOContext initialValue() {\n      return new IOContext();\n    }  \n  };\n","customfield_10010":null,"timetracking":{"originalEstimate":"10m","remainingEstimate":"10m","originalEstimateSeconds":600,"remainingEstimateSeconds":600},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12455938","id":"12455938","filename":"HIVE-1647.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liyin","name":"liyin","key":"liyin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Liyin Tang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-09-29T19:05:48.855+0000","size":793,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12455938/HIVE-1647.patch"}],"aggregatetimeestimate":600,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"123272","customfield_12312823":null,"summary":"Incorrect initialization of thread local variable inside IOContext ( implementation is not threadsafe ) ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ramang","name":"ramang","key":"ramang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raman Grover","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ramang","name":"ramang","key":"ramang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raman Grover","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":600,"percent":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":600,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12474306/comment/12910259","id":"12910259","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"It's good to have the fix you proposed. Can you post a patch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-16T18:38:50.916+0000","updated":"2010-09-16T18:38:50.916+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12474306/comment/12916676","id":"12916676","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"+1 running tests","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-30T21:28:22.670+0000","updated":"2010-09-30T21:28:22.670+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12474306/comment/12916712","id":"12916712","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"The test is still running, but there are a lot of diffs. Can you take a look? Examples like join_map_ppr.q, input_part10.q\n\nYou can use ' ant test -Dtestcase=TestCliDriver -Dqfile=join_map_ppr.q,input_part10.q ' to reproduce.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-30T22:10:09.459+0000","updated":"2010-09-30T22:10:09.459+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-1647/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0lg6n:"}}