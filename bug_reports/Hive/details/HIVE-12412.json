{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12913005","self":"https://issues.apache.org/jira/rest/api/2/issue/12913005","key":"HIVE-12412","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2015-11-13 22:08:30.873","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-12412/watchers","watchCount":7,"isWatching":false},"created":"2015-11-13T22:08:30.873+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["Correctness","CorrectnessBug"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329345","id":"12329345","description":"Hive 1.2.0","name":"1.2.0","archived":false,"released":true,"releaseDate":"2015-05-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12329363","id":"12329363","name":"1.1.0","archived":false,"released":true,"releaseDate":"2015-03-07"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12340269","id":"12340269","name":"2.3.0","archived":false,"released":true,"releaseDate":"2017-07-18"}],"issuelinks":[{"id":"12449242","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12449242","type":{"id":"12310361","name":"Blocked","inward":"Blocked","outward":"Blocked","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310361"},"outwardIssue":{"id":"12539853","key":"HIVE-2750","self":"https://issues.apache.org/jira/rest/api/2/issue/12539853","fields":{"summary":"Hive multi group by single reducer optimization causes invalid column reference error","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-06-05T11:50:45.060+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"We use multi insert queries to take data in one table and manipulate it by inserting it into a results table.  Queries are of this form:\n\nfrom (select * from data_table lateral view explode(data_table.f2) f2 as explode_f2) as explode_data_table  \n       insert overwrite table results_table partition (q_id='C.P1',rl='1') \n       select \n       array(cast(if(explode_data_table.f1 is null or explode_data_table.f1='', 'UNKNOWN',explode_data_table.f1) as String),cast(explode_f2.s1 as String)) as dimensions, \n       ARRAY(CAST(sum(explode_f2.d1) as Double)) as metrics, \n       null as rownm \n       where (explode_data_table.date_id between 20151016 and 20151016)\n       group by \n       if(explode_data_table.f1 is null or explode_data_table.f1='', 'UNKNOWN',explode_data_table.f1),\n       explode_f2.s1         \n       INSERT OVERWRITE TABLE results_table PARTITION (q_id='C.P2',rl='0') \n       SELECT ARRAY(CAST('Total' as String),CAST('Total' as String)) AS dimensions, \n       ARRAY(CAST(sum(explode_f2.d1) as Double)) AS metrics, \n       null AS rownm \n       WHERE (explode_data_table.date_id BETWEEN 20151016 AND 20151016) \n       INSERT OVERWRITE TABLE results_table PARTITION (q_id='C.P5',rl='0') \n       SELECT \n       ARRAY(CAST('Total' as String)) AS dimensions, \n       ARRAY(CAST(sum(explode_f2.d1) as Double)) AS metrics, \n       null AS rownm \n       WHERE (explode_data_table.date_id BETWEEN 20151016 AND 20151016)\n\nThis query is meant to total a given field of a struct that is potentially a list of structs.  For our test data set, which consists of a single row, the summation yields \"Null\",  with messages in the hive log of the nature:\n\nMissing fields! Expected 2 fields but only got 1! Ignoring similar problems.\nor \"Extra fields detected...\"\n\nFor significantly more data, this query will eventually cause a run time error while processing a column (caused by array index out of bounds exception in one of the lazy binary classes such as LazyBinaryString or LazyBinaryStruct).\n\nUsing the query above from the hive command line, the following data was used:\n(note there are tabs in the data below)\n\nstring one\tone:1.0:1.00:10.0,eon:1.0:1.00:100.0\nstring two\ttwo:2.0:2.00:20.0,otw:2.0:2.00:20.0,wott:2.0:2.00:20.0\nstring thr\tthree:3.0:3.00:30.0\nstring fou\tfour:4.0:4.00:40.0\n\nThere are two fields, a string, (eg. 'string one') and a list of structs.  The following is used to create the table:\n\ncreate table if not exists t1 (\n                         f1 string, \n                          f2 array<struct<s1:string,d1:double,d2:double,d3:double>>\n                         )\n                          partitioned by (clid string, date_id string) \n                          row format delimited fields \n                         terminated by '09' \n                         collection items terminated by ',' \n                         map keys terminated by ':'\n                         lines terminated by '10' \n                         location '/user/hive/warehouse/t1';\n\nAnd the following is used to load the data:\n\nload data local inpath '/path/to/data/file/cplx_test.data2' OVERWRITE  into table t1  partition(client_id='987654321',date_id='20151016');\n\nThe resulting table should yield the following:\n[\"string fou\",\"four\"]\t[4.0]\tnull\tC.P1\t1\t\n[\"string one\",\"eon\"]\t[1.0]\tnull\tC.P1\t1\t\n[\"string one\",\"one\"]\t[1.0]\tnull\tC.P1\t1\t\n[\"string thr\",\"three\"]\t[3.0]\tnull\tC.P1\t1\t\n[\"string two\",\"otw\"]\t[2.0]\tnull\tC.P1\t1\t\n[\"string two\",\"two\"]\t[2.0]\tnull\tC.P1\t1\t\n[\"string two\",\"wott\"]\t[2.0]\tnull\tC.P1\t1\t\n[\"Total\",\"Total\"]\t[15.0]\tnull\tC.P2\t0\t\n[\"Total\"]\t[15.0]\tnull\tC.P5\t0\t\n\nHowever what we get is:\nHive Runtime Error while processing row {\"_col2\":2.5306499719322744E-258,\"_col3\":\"\"} (ultimately due to an array index out of bounds exception)\n\nIf we reduce the above data to a SINGLE row, the we don't get an exception but the total fields come out as NULL.\n\nThe ONLY way this query would work is \n1) if I added a group by (date_id) or even group by ('') as the last line in the query... or removed the last where clause for the final insert.  (The reason why we have a where clause on the initial select is due to push down predicates not working... and causing a complete scan of the entire table).\n\nor \n2) removing the group by clauses entirely \n\nor using\n3) hive.multigroupby.singlereducer = false\n\nOnce 3) is used no modification of the query is needed... it all runs.  This is very similar in nature to the following:\nhttps://issues.apache.org/jira/browse/HIVE-2750\nwhich is supposedly fixed and closed.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Multi insert queries fail to run properly in hive 1.1.x or later.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpetrakis","name":"jpetrakis","key":"jpetrakis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John P. Petrakis","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpetrakis","name":"jpetrakis","key":"jpetrakis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John P. Petrakis","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-12412/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2oe1r:"}}