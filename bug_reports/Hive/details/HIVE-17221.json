{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13091440","self":"https://issues.apache.org/jira/rest/api/2/issue/13091440","key":"HIVE-17221","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-11-11T18:59:42.236+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Nov 11 18:59:42 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-17221/watchers","watchCount":3,"isWatching":false},"created":"2017-08-01T03:16:14.626+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335838","id":"12335838","description":"Maintenance branch for 2.1 ","name":"2.1.1","archived":false,"released":true,"releaseDate":"2016-12-08"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pgolash","name":"pgolash","key":"pgolash","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Golash","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-11-11T18:59:42.236+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12325007","id":"12325007","name":"Hive"}],"timeoriginalestimate":null,"description":"Run the following queries in beeline:\nObserved that is a regression and used to work in Hive 1.x.\n---- \n\n!connect jdbc:hive2://localhost:10000/default (Login as hive/hive)\n \nSET hive.txn.manager=org.apache.hadoop.hive.ql.lockmgr.DbTxnManager;\n\nSET hive.support.concurrency=true;\nSET hive.enforce.bucketing=true;\nSET hive.exec.dynamic.partition.mode=nonstrict;\n\ncreate table orders_bkt1 (\n O_ORDERKEY DOUBLE,\n O_CUSTKEY DOUBLE,\n O_TOTALPRICE DOUBLE,\n O_ORDERDATE STRING, \n O_ORDERPRIORITY STRING,\n O_CLERK STRING,\n O_SHIPPRIORITY DOUBLE,\n O_COMMENT STRING)\nPARTITIONED BY (\nO_ORDERSTATUS STRING)\nCLUSTERED BY (O_ORDERPRIORITY) INTO 6 BUCKETS\nROW FORMAT DELIMITED\nFIELDS TERMINATED BY '|' STORED AS ORC\nTBLPROPERTIES (\"transactional\"=\"true\");\n\ncreate table orders_src (\nO_ORDERKEY DOUBLE,\nO_CUSTKEY DOUBLE,\nO_ORDERSTATUS STRING,\nO_TOTALPRICE DOUBLE,\nO_ORDERDATE STRING,\nO_ORDERPRIORITY STRING,\nO_CLERK STRING,\nO_SHIPPRIORITY DOUBLE,\nO_COMMENT STRING)\nROW FORMAT DELIMITED FIELDS TERMINATED BY '|' STORED AS TEXTFILE;\n\nInsert into orders_src values (1.5,2.5,\"PENDING\",15.5,\"10/25/2017\",\"low\",\"clerk\", 1.0,\"comment\");\n\nCREATE TABLE IF NOT EXISTS w2834719472743385761_update_strategy_m_orders_updtx_50percent (a0 DOUBLE, a1 DOUBLE, a2 STRING, a3 DOUBLE, a4 STRING, a5 STRING, a6 STRING, a7 DOUBLE, a8 STRING) CLUSTERED BY (a0, a1, a2, a3, a4, a5, a6, a7, a8) INTO 32 BUCKETS STORED AS ORC TBLPROPERTIES ('transactional'='true');\n\nINSERT INTO TABLE w2834719472743385761_update_strategy_m_orders_updtx_50percent SELECT alias.o_orderkey as a0, alias.o_custkey as a1, alias.o_orderstatus as a2, 10 + alias.o_totalprice as a3, alias.o_orderdate as a4, alias.o_orderpriority as a5, alias.o_clerk as a6, alias.o_shippriority as a7, alias.o_comment as a8 FROM orders_src alias;\n\nCREATE TABLE IF NOT EXISTS w2834719472743385761_write_orders_bkt_src_tmp_m_orders_updtx_50percent (a0 DOUBLE, a1 DOUBLE, a2 DOUBLE, a3 STRING, a4 STRING, a5 STRING, a6 DOUBLE, a7 STRING, a8 STRING) CLUSTERED BY (a0) INTO 32 BUCKETS STORED AS ORC TBLPROPERTIES ('transactional'='true');\n\nINSERT INTO TABLE w2834719472743385761_write_orders_bkt_src_tmp_m_orders_updtx_50percent SELECT w2834719472743385761_update_strategy_m_orders_updtx_50percent.a0 as a0, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a1 as a1, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a3 as a2, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a4 as a3, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a5 as a4, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a6 as a5, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a7 as a6, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a8 as a7, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a2 as a8 FROM w2834719472743385761_update_strategy_m_orders_updtx_50percent WHERE (CASE WHEN w2834719472743385761_update_strategy_m_orders_updtx_50percent.a2 = 'P' THEN 1 ELSE 0 END) = 1;\n\nCREATE TABLE IF NOT EXISTS w2834719472743385761_write_orders_bkt_tgt_tmp_m_orders_updtx_50percent (a0 DOUBLE, a1 DOUBLE, a2 DOUBLE, a3 STRING, a4 STRING, a5 STRING, a6 DOUBLE, a7 STRING, a8 STRING) CLUSTERED BY (a0) INTO 32 BUCKETS STORED AS ORC TBLPROPERTIES ('transactional'='true');\n\nINSERT INTO TABLE w2834719472743385761_write_orders_bkt_tgt_tmp_m_orders_updtx_50percent SELECT orders_bkt1.o_orderkey as a0, orders_bkt1.o_custkey as a1, orders_bkt1.o_totalprice as a2, orders_bkt1.o_orderdate as a3, orders_bkt1.o_orderpriority as a4, orders_bkt1.o_clerk as a5, orders_bkt1.o_shippriority as a6, orders_bkt1.o_comment as a7, orders_bkt1.o_orderstatus as a8 FROM w2834719472743385761_write_orders_bkt_src_tmp_m_orders_updtx_50percent JOIN orders_bkt1 ON (w2834719472743385761_write_orders_bkt_src_tmp_m_orders_updtx_50percent.a0 = orders_bkt1.o_orderkey);\n\nDELETE FROM orders_bkt1 WHERE EXISTS  (SELECT w2834719472743385761_update_strategy_m_orders_updtx_50percent.a0 as a0, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a1 as a1, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a3 as a2, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a4 as a3, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a5 as a4, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a6 as a5, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a7 as a6, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a8 as a7, w2834719472743385761_update_strategy_m_orders_updtx_50percent.a2 as a8 FROM w2834719472743385761_update_strategy_m_orders_updtx_50percent WHERE (((CASE WHEN w2834719472743385761_update_strategy_m_orders_updtx_50percent.a2 = 'P' THEN 1 ELSE 0 END) = 1) OR ((CASE WHEN w2834719472743385761_update_strategy_m_orders_updtx_50percent.a2 = 'P' THEN 1 ELSE 0 END) = 2)) AND (orders_bkt1.o_orderkey = w2834719472743385761_update_strategy_m_orders_updtx_50percent.a0));\n\nThe result is :\n\nError: Error while compiling statement: FAILED: IndexOutOfBoundsException Index: 4, Size: 2 (state=42000,code=40000)\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Error: Error while compiling statement: FAILED: IndexOutOfBoundsException Index: 4, Size: 2 (state=42000,code=40000)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matanvr","name":"matanvr","key":"matanvr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matan Vardi","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=matanvr","name":"matanvr","key":"matanvr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matan Vardi","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Amazon EMR 5.4 or any version where Hive 2.1.1 is used.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13091440/comment/16248623","id":"16248623","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pgolash","name":"pgolash","key":"pgolash","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Golash","active":true,"timeZone":"America/Los_Angeles"},"body":"I build hive from 2.1 branch.\r\n\r\npgolash-C02SH6ERG8WP:hive pgolash$ hive --version\r\nHive 2.1.2-SNAPSHOT\r\n\r\nWhen running the above commands mentioned by you, I don't see any error.\r\n\r\nAre you still facing the issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pgolash","name":"pgolash","key":"pgolash","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Golash","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-11-11T18:59:42.236+0000","updated":"2017-11-11T18:59:42.236+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-17221/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3i8wn:"}}