{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12459451","self":"https://issues.apache.org/jira/rest/api/2/issue/12459451","key":"HIVE-1253","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314524","id":"12314524","description":"released","name":"0.6.0","archived":false,"released":true,"releaseDate":"2010-10-29"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-03-20T00:11:05.898+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Apr 01 22:26:48 UTC 2010","customfield_12310420":"73015","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_1116942507_*|*_1_*:*_1_*:*_177051689_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-04-01T22:26:48.462+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-1253/watchers","watchCount":1,"isWatching":false},"created":"2010-03-17T23:00:14.266+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=batalbot","name":"batalbot","key":"batalbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Talbot","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-12-17T00:04:03.897+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"date_sub('2010-03-15', 7) returns '2010-03-07'. This is because we have time shifts on 2010-03-14 for daylight saving time.\n\nLooking at ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDateSub.java, it is getting a calendar instance in UTC time zone.\n\ndef calendar = Calendar.getInstance(TimeZone.getTimeZone(\"UTC\"));\n\nAnd use calendar.add() to substract 7 days, then conver the time to 'yyyy-MM-dd' format.\n\nIf it simply uses default timezone, the problem is solved: \"def calendar = Calendar.getInstance());\"\n\nWhen people use date_sub('2010-03-15', 7), I think they mean substract 7 days, instead of substracting 7*24 hours. So it should be an easy fix. The same changes should go to date_add and date_diff\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12439339","id":"12439339","filename":"HIVE-1253.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=batalbot","name":"batalbot","key":"batalbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Talbot","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-20T00:12:26.967+0000","size":10487,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12439339/HIVE-1253.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"122944","customfield_12312823":null,"summary":"Fix Date_sub and Date_add in case of daylight saving","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miwang","name":"miwang","key":"miwang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mingran wang","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miwang","name":"miwang","key":"miwang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mingran wang","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459451/comment/12846669","id":"12846669","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miwang","name":"miwang","key":"miwang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mingran wang","active":true,"timeZone":"Etc/UTC"},"body":"To get to the bottom of this, the formatter (SimpleDateFormat) interprets the time string as local time zone, when it sets the calendar, it is PDT time zone (7 hours difference from UTC), and when it substracts 7 days and convert back to formatter string, it converts UTC to PST (still the local time zone, but different time zone now, and 8 hours difference from UTC).\n\nFor the purpose of this function, since it is doing simple date_sub function, there is no need to consider time zone at all, and all time zone should give the same result for this kind of computation. For this reason, using default time zone would be fine, and we have to use default time zone because formatter is using it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=miwang","name":"miwang","key":"miwang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"mingran wang","active":true,"timeZone":"Etc/UTC"},"created":"2010-03-17T23:30:26.589+0000","updated":"2010-03-17T23:30:26.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459451/comment/12847663","id":"12847663","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=batalbot","name":"batalbot","key":"batalbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Talbot","active":true,"timeZone":"America/Los_Angeles"},"body":"date_sub and date_add used both a Calendar and a SimpleDateFormat object; however, the UTC timezone was only set for the Calendar object.  This causes the computation to sometimes be incorrect when the date ranges cross daylight savings time changes.\n\nThe patch removes specifying the UTC timezone for the Calendar object so that both Calendar and the SimpleDateFormat will use the default timezone.  This should allow the date math to be consistent with other potential date math functions as long as they all use the default timezone.\n\nIf the user wishes to use a specific timezone that is not the system default, it can be set using the normal java ways (e.g. setting user.timezone, etc.).\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=batalbot","name":"batalbot","key":"batalbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Talbot","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-20T00:11:05.898+0000","updated":"2010-03-20T00:11:05.898+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459451/comment/12847665","id":"12847665","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=batalbot","name":"batalbot","key":"batalbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Talbot","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch includes new JUnit tests for UDFDateSub, UDFDateAdd and UDFDateDiff to test correctness over daylight savings time changes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=batalbot","name":"batalbot","key":"batalbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Talbot","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-03-20T00:12:26.978+0000","updated":"2010-03-20T00:12:26.978+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459451/comment/12852279","id":"12852279","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"body":"+1. Will test and commit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-04-01T08:07:57.476+0000","updated":"2010-04-01T08:07:57.476+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459451/comment/12852581","id":"12852581","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed. Thanks Bryan!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-04-01T22:26:48.442+0000","updated":"2010-04-01T22:26:48.442+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-1253/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0le5r:"}}