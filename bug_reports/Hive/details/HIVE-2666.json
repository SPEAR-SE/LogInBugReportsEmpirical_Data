{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12535907","self":"https://issues.apache.org/jira/rest/api/2/issue/12535907","key":"HIVE-2666","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317742","id":"12317742","description":"released","name":"0.9.0","archived":false,"released":true,"releaseDate":"2012-04-30"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-12-20T23:21:30.751+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Apr 30 21:11:40 UTC 2012","customfield_12310420":"221590","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_74708092_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-12-21T18:23:42.346+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-2666/watchers","watchCount":0,"isWatching":false},"created":"2011-12-20T21:38:34.354+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12367114","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12367114","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12641520","key":"HIVE-4317","self":"https://issues.apache.org/jira/rest/api/2/issue/12641520","fields":{"summary":"StackOverflowError when add jar concurrently ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-04-10T03:43:22.606+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"When a custom UDF is used as part of a join which is converted to a map join, the XMLEncoder enters an infinite loop when serializing the map reduce task for the second time, as part of sending it to be executed.  This results in a stack overflow error.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12508149","id":"12508149","filename":"ASF.LICENSE.NOT.GRANTED--HIVE-2666.D957.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2011-12-20T23:21:31.458+0000","size":8074,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12508149/ASF.LICENSE.NOT.GRANTED--HIVE-2666.D957.1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"124063","customfield_12312823":null,"summary":"StackOverflowError when using custom UDF in map join","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535907/comment/13173603","id":"13173603","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"kevinwilfong requested code review of \"HIVE-2666 [jira] StackOverflowError when using custom UDF in map join\".\nReviewers: JIRA\n\n  Resource files are now added to the class path as soon as they are added via the CLI.  This fixes the stack overflow error mentioned in the JIRA by ensuring a consistent class loader between serializers and deserializers for the same query.\n\n  Note that now serdes which contain a static block to register themselves are now registered twice, once when adding the file to the class loader, and once when an instance of the class is created.  Previously, registering a serde twice resulted in an exception, to avoid this, I have downgraded it to a warning.\n\n  When a custom UDF is used as part of a join which is converted to a map join, the XMLEncoder enters an infinite loop when serializing the map reduce task for the second time, as part of sending it to be executed.  This results in a stack overflow error.\n\nTEST PLAN\n  EMPTY\n\nREVISION DETAIL\n  https://reviews.facebook.net/D957\n\nAFFECTED FILES\n  serde/src/java/org/apache/hadoop/hive/serde2/SerDeUtils.java\n  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java\n  ql/src/java/org/apache/hadoop/hive/ql/processors/AddResourceProcessor.java\n  ql/src/java/org/apache/hadoop/hive/ql/processors/DeleteResourceProcessor.java\n\nMANAGE HERALD DIFFERENTIAL RULES\n  https://reviews.facebook.net/herald/view/differential/\n\nWHY DID I GET THIS EMAIL?\n  https://reviews.facebook.net/herald/transcript/1989/\n\nTip: use the X-Herald-Rules header to filter Herald messages in your client.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2011-12-20T23:21:30.751+0000","updated":"2011-12-20T23:21:30.751+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535907/comment/13173609","id":"13173609","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"heyongqiang has commented on the revision \"HIVE-2666 [jira] StackOverflowError when using custom UDF in map join\".\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/processors/DeleteResourceProcessor.java:63 have u verified the delete also work fine?\n\nREVISION DETAIL\n  https://reviews.facebook.net/D957\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2011-12-20T23:25:30.725+0000","updated":"2011-12-20T23:25:30.725+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535907/comment/13173617","id":"13173617","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"kevinwilfong has commented on the revision \"HIVE-2666 [jira] StackOverflowError when using custom UDF in map join\".\n\n  There is a unit test query in TestNegativeCliDriver called deletejar, which verifies an error is thrown if you add a jar, delete that jar, and then attempt to use a class in the jar.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D957\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2011-12-20T23:33:30.534+0000","updated":"2011-12-20T23:33:30.534+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535907/comment/13173714","id":"13173714","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"heyongqiang has accepted the revision \"HIVE-2666 [jira] StackOverflowError when using custom UDF in map join\".\n\n  running tests\n\nREVISION DETAIL\n  https://reviews.facebook.net/D957\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2011-12-21T01:07:30.412+0000","updated":"2011-12-21T01:07:30.412+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535907/comment/13174275","id":"13174275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"committed, thanks Kevin!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2011-12-21T18:23:42.390+0000","updated":"2011-12-21T18:23:42.390+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535907/comment/13174279","id":"13174279","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"heyongqiang has committed the revision \"HIVE-2666 [jira] StackOverflowError when using custom UDF in map join\".\n\nREVISION DETAIL\n  https://reviews.facebook.net/D957\n\nCOMMIT\n  https://reviews.facebook.net/rHIVE1221830\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2011-12-21T18:29:30.597+0000","updated":"2011-12-21T18:29:30.597+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535907/comment/13174331","id":"13174331","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hive-trunk-h0.23.0 #42 (See [https://builds.apache.org/job/Hive-trunk-h0.23.0/42/])\n    HIVE-2666 [jira] StackOverflowError when using custom UDF in map join\n(Kevin Wilfong via Yongqiang He)\n\nSummary:\nResource files are now added to the class path as soon as they are added via the\nCLI.  This fixes the stack overflow error mentioned in the JIRA by ensuring a\nconsistent class loader between serializers and deserializers for the same\nquery.\n\nNote that now serdes which contain a static block to register themselves are now\nregistered twice, once when adding the file to the class loader, and once when\nan instance of the class is created.  Previously, registering a serde twice\nresulted in an exception, to avoid this, I have downgraded it to a warning.\n\nWhen a custom UDF is used as part of a join which is converted to a map join,\nthe XMLEncoder enters an infinite loop when serializing the map reduce task for\nthe second time, as part of sending it to be executed.  This results in a stack\noverflow error.\n\nTest Plan:\nI ran the unit tests to verify nothing was broken.\n\nI ran several queries which used custom UDFs and involved a join which was\nconverted to a map join.  I verified these completed successfully consistently\n\nReviewers: JIRA, heyongqiang\n\nReviewed By: heyongqiang\n\nCC: heyongqiang, kevinwilfong\n\nDifferential Revision: 957\n\nheyongqiang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1221830\nFiles : \n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/processors/AddResourceProcessor.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/processors/DeleteResourceProcessor.java\n* /hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/SerDeUtils.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2011-12-21T19:17:37.214+0000","updated":"2011-12-21T19:17:37.214+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535907/comment/13174521","id":"13174521","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hive-trunk-h0.21 #1164 (See [https://builds.apache.org/job/Hive-trunk-h0.21/1164/])\n    HIVE-2666 [jira] StackOverflowError when using custom UDF in map join\n(Kevin Wilfong via Yongqiang He)\n\nSummary:\nResource files are now added to the class path as soon as they are added via the\nCLI.  This fixes the stack overflow error mentioned in the JIRA by ensuring a\nconsistent class loader between serializers and deserializers for the same\nquery.\n\nNote that now serdes which contain a static block to register themselves are now\nregistered twice, once when adding the file to the class loader, and once when\nan instance of the class is created.  Previously, registering a serde twice\nresulted in an exception, to avoid this, I have downgraded it to a warning.\n\nWhen a custom UDF is used as part of a join which is converted to a map join,\nthe XMLEncoder enters an infinite loop when serializing the map reduce task for\nthe second time, as part of sending it to be executed.  This results in a stack\noverflow error.\n\nTest Plan:\nI ran the unit tests to verify nothing was broken.\n\nI ran several queries which used custom UDFs and involved a join which was\nconverted to a map join.  I verified these completed successfully consistently\n\nReviewers: JIRA, heyongqiang\n\nReviewed By: heyongqiang\n\nCC: heyongqiang, kevinwilfong\n\nDifferential Revision: 957\n\nheyongqiang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1221830\nFiles : \n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/processors/AddResourceProcessor.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/processors/DeleteResourceProcessor.java\n* /hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/SerDeUtils.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2011-12-22T00:19:34.078+0000","updated":"2011-12-22T00:19:34.078+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535907/comment/13265312","id":"13265312","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"This issue is closed now. It was released with the fix in 0.9.0. If there is a problem, please open a new jira and link this one with that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-04-30T21:11:40.176+0000","updated":"2012-04-30T21:11:40.176+0000"}],"maxResults":9,"total":9,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-2666/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ll2f:"}}