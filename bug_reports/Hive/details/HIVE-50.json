{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12407835","self":"https://issues.apache.org/jira/rest/api/2/issue/12407835","key":"HIVE-50","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2008-11-05T20:52:11.059+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Feb 11 17:20:52 UTC 2010","customfield_12310420":"42910","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-50/watchers","watchCount":3,"isWatching":false},"created":"2008-11-05T09:33:43.316+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-02-11T17:20:52.226+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"    CREATE TABLE tname (INT cname1, INT pcol PARTITIONING )\n    COMMENT 'This is a table' \n    PARTITIONED BY(dt STRING) \n    STORED AS SEQUENCEFILE; \n\nThe goal here is to annotate a column as being a \"partitioning\" column. Consider pcol in the above example. It is annotated with 'PARTITIONING', which implies that the create table\nhas \n\nPARTITIONED BY (dt, pcol)\n\nand every write to this table has implicitly\n\nINSERT OVERWRITE tname PARTITION (pcol='X')\nWHERE output.pcol = 'X'\n\nfor every distinct value X that pcol takes.\n\nThis is ideally an addition on top of the explicit partitioning that is already in the syntax, so that if I said\n\nINSERT OVERWRITE tname PARTITION (dt='D')\n\nit would still go into the partition (dt='D\", pcol='Y') when the value of pcol is Y.\n\nIt would be up to the user to make sure the cardinality of these columns is reasonable, and that enough data goes into each partition that there is some net benefit (just as it is in the explicit case).","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"108166","customfield_12312823":null,"summary":"Tag columns as partitioning columns","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=indigoviolet","name":"indigoviolet","key":"indigoviolet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Venky Iyer","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=indigoviolet","name":"indigoviolet","key":"indigoviolet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Venky Iyer","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12407835/comment/12645318","id":"12645318","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"body":"Instead of specifying which column will be \"special\" in the create table statement, we can also specify that at insertion time:\n\nCREATE TABLE tname (cname1 INT)\nCOMMENT 'This is a table'\nPARTITIONED BY(dt STRING, pcol INT)\nSTORED AS SEQUENCEFILE; \n\nINSERT OVERWRITE tname PARTITION (dt = '2008-11-04') (pcol, cname1)\nSELECT another.a, another.b FROM another;\n\nThis conforms to the standard SQL Syntax: http://dev.mysql.com/doc/refman/5.0/en/insert.html\n\n\nThe implementation would involves several steps:\n1. Change the grammar to support specifying columns in the insert clause (the default will be all columns except partition columns), and change the plan generation to support that;\n2. Allow specifying partition columns in the insert clause, change the execution code to create a new file on each new partition key.\n3. Optimization: The bad thing about 2 is that if we have 100 reducers, then each of the partition will have 100 files. We could first generate the result of the select, and then do a count to see the number of rows in each partition, and then decide whether we should do another map-reduce job to gather all rows in the same partition together or not.\n\n\nOverall this will be a very useful feature.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-11-05T20:52:11.059+0000","updated":"2008-11-05T20:52:11.059+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12407835/comment/12650281","id":"12650281","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"body":"This sounds good to me. I guess the PARTITION clause is just a syntax sugar at this point and this could implicitly be achieved by\n\nINSERT OVERWRITE tname(dt, pcol, cname)\nSELECT '2008-11-04', another.a, another.b FROM another;\n\nWe could always infer from this that a constant value is being put in the partition col dt and generate any optimizations that could be done for the PARTITION clause.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=athusoo","name":"athusoo","key":"athusoo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashish Thusoo","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-24T19:02:14.696+0000","updated":"2008-11-24T19:02:14.696+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12407835/comment/12832576","id":"12832576","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=esammer","name":"esammer","key":"esammer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"E. Sammer","active":true,"timeZone":"Etc/UTC"},"body":"Rather than having two places to define columns, it seems like it would be nicer to specify all columns once and then reference them in the partitioned by clause.\n\nEx:\n\nCREATE TABLE events ( year int, month int, day int, event_type int, user_id int ) PARTITIONED BY ( year, month, day );\n\nOne of the side effects of this is that the column output order is defined solely by the actual column definition. As of 0.4.1, partitioned columns are always after \"normal\" columns which is annoying for cases where you want to expect query output to match the source files on which the query was run in terms of layout without having to have some explicit external ordering knowledge. In other words, partitioned columns should only be special to the query parser / optimizer and directory structures. Today, partitioning creates a requirement on the field ordering in files which violates the notion that there is no Hive file format and means reformatting files needlessly to partition them. Partitioned columns should be able to appear anywhere in the file layout.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=esammer","name":"esammer","key":"esammer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"E. Sammer","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-11T17:20:52.110+0000","updated":"2010-02-11T17:20:52.110+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-50/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ivb3:"}}