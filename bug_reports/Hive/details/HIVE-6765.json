{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12703930","self":"https://issues.apache.org/jira/rest/api/2/issue/12703930","key":"HIVE-6765","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2014-05-01T00:14:48.803+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat May 24 23:59:42 UTC 2014","customfield_12310420":"382264","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_3969753476_*|*_1_*:*_1_*:*_1095694252_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-05-24T23:59:42.064+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-6765/watchers","watchCount":3,"isWatching":false},"created":"2014-03-27T08:55:34.373+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324312","id":"12324312","description":"released","name":"0.12.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-05-24T23:59:42.096+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"when a view contains a UDF, and the view comes into a JOIN operation, Hive will encounter a bug with stack trace like\nCaused by: java.lang.InstantiationException: org.apache.hadoop.hive.ql.parse.ASTNodeOrigin\n\tat java.lang.Class.newInstance0(Class.java:359)\n\tat java.lang.Class.newInstance(Class.java:327)\n\tat sun.reflect.GeneratedMethodAccessor84.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:616)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12637110","id":"12637110","filename":"HIVE-6765.patch.1","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-03-27T09:04:44.871+0000","size":1929,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12637110/HIVE-6765.patch.1"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"382535","customfield_12312823":null,"summary":"ASTNodeOrigin unserializable leads to fail when join with view","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12703930/comment/13949052","id":"13949052","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"I added a PersistenceDelegate in serializeObject() in Class Utilities and resolved the problem. later I'll attach the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-03-27T08:57:33.926+0000","updated":"2014-03-27T08:57:33.926+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12703930/comment/13949075","id":"13949075","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"Here's an example to see the Exception:\nCREATE TABLE t1 (a1 INT, b1 INT);\nCREATE VIEW v1 (x1) AS SELECT MAX(a1) FROM t1;\nSELECT s1.x1 FROM v1 s1 JOIN (SELECT MAX(a1) AS ma FROM t1) s2 ON s1.x1 = s2.ma;\n\nThis is a bug on both ApacheHive and Tez, outputing \"return code 1 ...\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-03-27T09:20:12.063+0000","updated":"2014-03-27T09:20:12.063+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12703930/comment/13949076","id":"13949076","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"And I think this is just another drawback for using XMLEncoder to clone plan.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-03-27T09:21:55.131+0000","updated":"2014-03-27T09:21:55.131+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12703930/comment/13949113","id":"13949113","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"Sorry, the previous example works on Tez with hive-0.13.\nBut it fails when I run the query in Hive-0.12 in eclipse.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-03-27T10:04:23.952+0000","updated":"2014-03-27T10:04:23.952+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12703930/comment/13949118","id":"13949118","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"when I run the test case in hive command line(0.12-release), the full output is as follows,\nhive> SELECT s1.x1 FROM v1 s1 JOIN (SELECT MAX(a1) AS ma FROM t1) s2 ON s1.x1 = s2.ma;\njava.lang.RuntimeException: Cannot serialize object\n\tat org.apache.hadoop.hive.ql.exec.Utilities$1.exceptionThrown(Utilities.java:652)\n\tat java.beans.XMLEncoder.writeStatement(XMLEncoder.java:361)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:277)\n\tat org.apache.hadoop.hive.ql.exec.Utilities.serializeObject(Utilities.java:666)\n\tat org.apache.hadoop.hive.ql.exec.Utilities.clonePlan(Utilities.java:637)\n\tat org.apache.hadoop.hive.ql.optimizer.physical.CommonJoinTaskDispatcher.processCurrentTask(CommonJoinTaskDispatcher.java:505)\n\tat org.apache.hadoop.hive.ql.optimizer.physical.AbstractJoinTaskDispatcher.dispatch(AbstractJoinTaskDispatcher.java:182)\n\tat org.apache.hadoop.hive.ql.lib.TaskGraphWalker.dispatch(TaskGraphWalker.java:111)\n\tat org.apache.hadoop.hive.ql.lib.TaskGraphWalker.walk(TaskGraphWalker.java:194)\n\tat org.apache.hadoop.hive.ql.lib.TaskGraphWalker.startWalking(TaskGraphWalker.java:139)\n\tat org.apache.hadoop.hive.ql.optimizer.physical.CommonJoinResolver.resolve(CommonJoinResolver.java:79)\n\tat org.apache.hadoop.hive.ql.optimizer.physical.PhysicalOptimizer.optimize(PhysicalOptimizer.java:90)\n\tat org.apache.hadoop.hive.ql.parse.MapReduceCompiler.compile(MapReduceCompiler.java:300)\n\tat org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:8410)\n\tat org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:284)\n\tat org.apache.hadoop.hive.ql.Driver.compile(Driver.java:441)\n\tat org.apache.hadoop.hive.ql.Driver.compile(Driver.java:342)\n\tat org.apache.hadoop.hive.ql.Driver.runInternal(Driver.java:977)\n\tat org.apache.hadoop.hive.ql.Driver.run(Driver.java:888)\n\tat org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:259)\n\tat org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:216)\n\tat org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:413)\n\tat org.apache.hadoop.hive.cli.CliDriver.executeDriver(CliDriver.java:781)\n\tat org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:675)\n\tat org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:614)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:616)\n\tat org.apache.hadoop.util.RunJar.main(RunJar.java:212)\nCaused by: java.lang.Exception: XMLEncoder: discarding statement XMLEncoder.writeObject(MapredWork);\n\t... 29 more\nCaused by: java.lang.RuntimeException: Cannot serialize object\n\tat org.apache.hadoop.hive.ql.exec.Utilities$1.exceptionThrown(Utilities.java:652)\n\tat java.beans.DefaultPersistenceDelegate.initBean(DefaultPersistenceDelegate.java:267)\n\tat java.beans.DefaultPersistenceDelegate.initialize(DefaultPersistenceDelegate.java:408)\n\tat java.beans.PersistenceDelegate.writeObject(PersistenceDelegate.java:116)\n\tat java.beans.Encoder.writeObject(Encoder.java:74)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:274)\n\tat java.beans.Encoder.writeExpression(Encoder.java:304)\n\tat java.beans.XMLEncoder.writeExpression(XMLEncoder.java:389)\n\tat java.beans.PersistenceDelegate.writeObject(PersistenceDelegate.java:113)\n\tat java.beans.Encoder.writeObject(Encoder.java:74)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:274)\n\tat java.beans.Encoder.writeObject1(Encoder.java:231)\n\tat java.beans.Encoder.cloneStatement(Encoder.java:244)\n\tat java.beans.Encoder.writeStatement(Encoder.java:275)\n\tat java.beans.XMLEncoder.writeStatement(XMLEncoder.java:348)\n\t... 28 more\nCaused by: java.lang.RuntimeException: Cannot serialize object\n\tat org.apache.hadoop.hive.ql.exec.Utilities$1.exceptionThrown(Utilities.java:652)\n\tat java.beans.DefaultPersistenceDelegate.initBean(DefaultPersistenceDelegate.java:267)\n\tat java.beans.DefaultPersistenceDelegate.initialize(DefaultPersistenceDelegate.java:408)\n\tat java.beans.PersistenceDelegate.writeObject(PersistenceDelegate.java:116)\n\tat java.beans.Encoder.writeObject(Encoder.java:74)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:274)\n\tat java.beans.Encoder.writeExpression(Encoder.java:304)\n\tat java.beans.XMLEncoder.writeExpression(XMLEncoder.java:389)\n\tat java.beans.DefaultPersistenceDelegate.doProperty(DefaultPersistenceDelegate.java:229)\n\tat java.beans.DefaultPersistenceDelegate.initBean(DefaultPersistenceDelegate.java:264)\n\t... 41 more\nCaused by: java.lang.RuntimeException: Cannot serialize object\n\tat org.apache.hadoop.hive.ql.exec.Utilities$1.exceptionThrown(Utilities.java:652)\n\tat java.beans.java_util_Map_PersistenceDelegate.initialize(MetaData.java:652)\n\tat java.beans.PersistenceDelegate.initialize(PersistenceDelegate.java:206)\n\tat java.beans.DefaultPersistenceDelegate.initialize(DefaultPersistenceDelegate.java:406)\n\tat java.beans.PersistenceDelegate.initialize(PersistenceDelegate.java:206)\n\tat java.beans.DefaultPersistenceDelegate.initialize(DefaultPersistenceDelegate.java:406)\n\tat java.beans.PersistenceDelegate.writeObject(PersistenceDelegate.java:116)\n\tat java.beans.Encoder.writeObject(Encoder.java:74)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:274)\n\tat java.beans.Encoder.writeExpression(Encoder.java:304)\n\tat java.beans.XMLEncoder.writeExpression(XMLEncoder.java:389)\n\tat java.beans.PersistenceDelegate.writeObject(PersistenceDelegate.java:113)\n\tat java.beans.Encoder.writeObject(Encoder.java:74)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:274)\n\tat java.beans.Encoder.writeExpression(Encoder.java:304)\n\tat java.beans.XMLEncoder.writeExpression(XMLEncoder.java:389)\n\tat java.beans.DefaultPersistenceDelegate.doProperty(DefaultPersistenceDelegate.java:229)\n\tat java.beans.DefaultPersistenceDelegate.initBean(DefaultPersistenceDelegate.java:264)\n\t... 49 more\nCaused by: java.lang.RuntimeException: Cannot serialize object\n\tat org.apache.hadoop.hive.ql.exec.Utilities$1.exceptionThrown(Utilities.java:652)\n\tat java.beans.DefaultPersistenceDelegate.initBean(DefaultPersistenceDelegate.java:267)\n\tat java.beans.DefaultPersistenceDelegate.initialize(DefaultPersistenceDelegate.java:408)\n\tat java.beans.PersistenceDelegate.writeObject(PersistenceDelegate.java:116)\n\tat java.beans.Encoder.writeObject(Encoder.java:74)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:274)\n\tat java.beans.Encoder.writeExpression(Encoder.java:304)\n\tat java.beans.XMLEncoder.writeExpression(XMLEncoder.java:389)\n\tat java.beans.PersistenceDelegate.writeObject(PersistenceDelegate.java:113)\n\tat java.beans.Encoder.writeObject(Encoder.java:74)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:274)\n\tat java.beans.Encoder.writeExpression(Encoder.java:304)\n\tat java.beans.XMLEncoder.writeExpression(XMLEncoder.java:389)\n\tat java.beans.java_util_Map_PersistenceDelegate.initialize(MetaData.java:643)\n\t... 65 more\nCaused by: java.lang.RuntimeException: Cannot serialize object\n\tat org.apache.hadoop.hive.ql.exec.Utilities$1.exceptionThrown(Utilities.java:652)\n\tat java.beans.DefaultPersistenceDelegate.initBean(DefaultPersistenceDelegate.java:267)\n\tat java.beans.DefaultPersistenceDelegate.initialize(DefaultPersistenceDelegate.java:408)\n\tat java.beans.PersistenceDelegate.writeObject(PersistenceDelegate.java:116)\n\tat java.beans.Encoder.writeObject(Encoder.java:74)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:274)\n\tat java.beans.Encoder.writeExpression(Encoder.java:304)\n\tat java.beans.XMLEncoder.writeExpression(XMLEncoder.java:389)\n\tat java.beans.PersistenceDelegate.writeObject(PersistenceDelegate.java:113)\n\tat java.beans.Encoder.writeObject(Encoder.java:74)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:274)\n\tat java.beans.Encoder.writeExpression(Encoder.java:304)\n\tat java.beans.XMLEncoder.writeExpression(XMLEncoder.java:389)\n\tat java.beans.DefaultPersistenceDelegate.doProperty(DefaultPersistenceDelegate.java:229)\n\tat java.beans.DefaultPersistenceDelegate.initBean(DefaultPersistenceDelegate.java:264)\n\t... 77 more\nCaused by: java.lang.RuntimeException: Cannot serialize object\n\tat org.apache.hadoop.hive.ql.exec.Utilities$1.exceptionThrown(Utilities.java:652)\n\tat java.beans.java_util_Map_PersistenceDelegate.initialize(MetaData.java:652)\n\tat java.beans.PersistenceDelegate.initialize(PersistenceDelegate.java:206)\n\tat java.beans.DefaultPersistenceDelegate.initialize(DefaultPersistenceDelegate.java:406)\n\tat java.beans.PersistenceDelegate.writeObject(PersistenceDelegate.java:116)\n\tat java.beans.Encoder.writeObject(Encoder.java:74)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:274)\n\tat java.beans.Encoder.writeExpression(Encoder.java:304)\n\tat java.beans.XMLEncoder.writeExpression(XMLEncoder.java:389)\n\tat java.beans.DefaultPersistenceDelegate.doProperty(DefaultPersistenceDelegate.java:229)\n\tat java.beans.DefaultPersistenceDelegate.initBean(DefaultPersistenceDelegate.java:264)\n\t... 90 more\nCaused by: java.lang.RuntimeException: Cannot serialize object\n\tat org.apache.hadoop.hive.ql.exec.Utilities$1.exceptionThrown(Utilities.java:652)\n\tat java.beans.DefaultPersistenceDelegate.initBean(DefaultPersistenceDelegate.java:267)\n\tat java.beans.DefaultPersistenceDelegate.initialize(DefaultPersistenceDelegate.java:408)\n\tat java.beans.PersistenceDelegate.writeObject(PersistenceDelegate.java:116)\n\tat java.beans.Encoder.writeObject(Encoder.java:74)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:274)\n\tat java.beans.Encoder.writeExpression(Encoder.java:304)\n\tat java.beans.XMLEncoder.writeExpression(XMLEncoder.java:389)\n\tat java.beans.PersistenceDelegate.writeObject(PersistenceDelegate.java:113)\n\tat java.beans.Encoder.writeObject(Encoder.java:74)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:274)\n\tat java.beans.Encoder.writeExpression(Encoder.java:304)\n\tat java.beans.XMLEncoder.writeExpression(XMLEncoder.java:389)\n\tat java.beans.java_util_Map_PersistenceDelegate.initialize(MetaData.java:643)\n\t... 99 more\nCaused by: java.lang.RuntimeException: Cannot serialize object\n\tat org.apache.hadoop.hive.ql.exec.Utilities$1.exceptionThrown(Utilities.java:652)\n\tat java.beans.Encoder.getValue(Encoder.java:108)\n\tat java.beans.Encoder.get(Encoder.java:225)\n\tat java.beans.PersistenceDelegate.writeObject(PersistenceDelegate.java:110)\n\tat java.beans.Encoder.writeObject(Encoder.java:74)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:274)\n\tat java.beans.Encoder.writeExpression(Encoder.java:304)\n\tat java.beans.XMLEncoder.writeExpression(XMLEncoder.java:389)\n\tat java.beans.PersistenceDelegate.writeObject(PersistenceDelegate.java:113)\n\tat java.beans.Encoder.writeObject(Encoder.java:74)\n\tat java.beans.XMLEncoder.writeObject(XMLEncoder.java:274)\n\tat java.beans.Encoder.writeExpression(Encoder.java:304)\n\tat java.beans.XMLEncoder.writeExpression(XMLEncoder.java:389)\n\tat java.beans.DefaultPersistenceDelegate.doProperty(DefaultPersistenceDelegate.java:229)\n\tat java.beans.DefaultPersistenceDelegate.initBean(DefaultPersistenceDelegate.java:264)\n\t... 111 more\nCaused by: java.lang.InstantiationException: org.apache.hadoop.hive.ql.parse.ASTNodeOrigin\n\tat java.lang.Class.newInstance0(Class.java:359)\n\tat java.lang.Class.newInstance(Class.java:327)\n\tat sun.reflect.GeneratedMethodAccessor82.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:616)\n\tat sun.reflect.misc.Trampoline.invoke(MethodUtil.java:55)\n\tat sun.reflect.GeneratedMethodAccessor81.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:616)\n\tat sun.reflect.misc.MethodUtil.invoke(MethodUtil.java:262)\n\tat java.beans.Statement.invokeInternal(Statement.java:257)\n\tat java.beans.Statement.access$000(Statement.java:56)\n\tat java.beans.Statement$2.run(Statement.java:158)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.beans.Statement.invoke(Statement.java:154)\n\tat java.beans.Expression.getValue(Expression.java:115)\n\tat java.beans.Encoder.getValue(Encoder.java:105)\n\t... 124 more\nFAILED: SemanticException Generate Map Join Task Error: Cannot serialize object\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-03-27T10:12:56.094+0000","updated":"2014-03-27T10:12:56.094+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12703930/comment/13986234","id":"13986234","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=selinazh","name":"selinazh","key":"selinazh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=selinazh&avatarId=19244","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=selinazh&avatarId=19244","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=selinazh&avatarId=19244","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=selinazh&avatarId=19244"},"displayName":"Selina Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~adrian-wang] We came across the same problem. Just wonder why this ASTNodeOrigin serialization problem came up suddenly. It is not the first day we join with a view. The root cause maybe something else? Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=selinazh","name":"selinazh","key":"selinazh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=selinazh&avatarId=19244","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=selinazh&avatarId=19244","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=selinazh&avatarId=19244","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=selinazh&avatarId=19244"},"displayName":"Selina Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-01T00:14:48.803+0000","updated":"2014-05-01T00:14:48.803+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12703930/comment/13988648","id":"13988648","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"[~selinazh] Thanks for your comment! It's so glad that someone also noticed this. Actually, I found that only when there was something like an aggregation function in the view, will the problem came up. The problem results from cloning the plan, but when joining with view as described, the plan would contain a node of ASTNodeOrigin, which does not have a default construct method, in which case when duplicating, exception will be thrown.\nCould you please try to apply my patch here to see whether your problem is resolved? Thanks again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-05-03T11:24:16.697+0000","updated":"2014-05-03T11:24:16.697+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12703930/comment/13989148","id":"13989148","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdrome","name":"cdrome","key":"cdrome","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Drome","active":true,"timeZone":"America/Los_Angeles"},"body":"[~adrian-wang] this does not appear to be an issue with hive-0.13 as they are using Kryo for XML serialization.\n\nFor clarification, I found that several setting can impact whether this problem arises or not. hive.auto.convert.join.noconditionaltask.size is used to determine the big table candidate set. Then hive.mapjoin.smalltable.filesize is used as a cutoff to determine whether a map-size join should be performed.\n\nI found that when hive.auto.convert.join is true, it will try to perform a map-side join first. Based on hive.auto.convert.join.noconditionaltask.size it will return a set of big table candidates to the physical optimizer. The physical optimizer will use hive.mapjoin.smalltable.filesize to determine whether the map-side join should proceed. If not the clonePlan method is called, which manifests the problem. I don't think it is solely influenced by the size of the tables involved in the join. In my tests, shrinking the size of the table allows the map-side join to proceed, while increasing the size of the table causes this failure.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cdrome","name":"cdrome","key":"cdrome","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Drome","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-04T20:52:50.183+0000","updated":"2014-05-04T20:52:50.183+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12703930/comment/13989287","id":"13989287","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"[~cdrome] good catch. I knew the serialization in Hive has been notorious for a long time, but I didn't know the progress they made there. Actually, I was real curious when I saw my case was OK with Tez with hive-0.13, while I never tried Apache's hive-0.13 since there was no official release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adrian-wang","name":"adrian-wang","key":"adrian-wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adrian Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2014-05-05T05:26:13.958+0000","updated":"2014-05-05T05:26:13.958+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12703930/comment/14008244","id":"14008244","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Resolving as wont fix since 0.13 has been released which uses Kryo based serialization which doesnt have this problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-24T23:59:42.092+0000","updated":"2014-05-24T23:59:42.092+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-6765/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1tuwv:"}}