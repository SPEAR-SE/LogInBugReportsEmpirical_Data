{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13172133","self":"https://issues.apache.org/jira/rest/api/2/issue/13172133","key":"HIVE-20173","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-07-18T18:24:04.502+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 31 17:46:03 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-20173/watchers","watchCount":3,"isWatching":false},"created":"2018-07-13T22:06:29.108+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329363","id":"12329363","name":"1.1.0","archived":false,"released":true,"releaseDate":"2015-03-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-07-31T17:46:03.316+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312584","id":"12312584","name":"Metastore","description":"Tracks issue dealing with metastore."}],"timeoriginalestimate":null,"description":"When attempting to test the existence of a Hive database, the Metastore will query the backing database.\r\n\r\nThe method MetaStoreDirectSql#executeWithArray catches all exceptions, turning them into MetaExceptions.\r\n\r\nFurther up the stack, the ObjectStore#getDatabase explicitly catches MetaExceptions and turns them into NoSuchObjectExceptions.\r\n\r\nFinally, RetryingHMSHandler explicitly looks for NoSuchObjectExceptions and does _not_ retry them, thinking they are legitimate answers.\r\n\r\nIf the exception in MetaStoreDirectSql#executeWithArray was a runtime JDOException due to, say, some sort of network error between the Metastore and the backing database, this inability to query the backing database looks just like an answer of \"no database exists\" higher up the stack.  Any program depending on this information will continue with an incorrect answer rather than retrying the original getDatabase query.\r\n\r\nI am unsure the extent of the effects of this, but I imagine that explicitly _not_ catching RuntimeExceptions in MetaStoreDirectSql#executeWithArray will allow the exception to raise all the way up to the RetryingHMSHandler which will, correctly, retry the operation.\r\n\r\nWould allowing RuntimeExceptions to be thrown from MetaStoreDirectSql#executeWithArray be too deleterious?  Or did I miss some code path such that my observations are incorrect?\r\n\r\n \r\n\r\nThanks,\r\n\r\nAaron","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"MetaStoreDirectSql#executeWithArray should not catch RuntimeExceptions from JDO","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aagottlieb","name":"aagottlieb","key":"aagottlieb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Gottlieb","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aagottlieb","name":"aagottlieb","key":"aagottlieb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Gottlieb","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13172133/comment/16548214","id":"16548214","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"I think the problem is actually the part where MetaExceptions are turned into NoSuchObject...\r\nEvery other step is just wrapping exceptions to match method signature, or for network transfer between metastore and metastore client.\r\nHowever, translating Meta... to NoSuchObject... is unwarranted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-07-18T18:24:04.502+0000","updated":"2018-07-18T18:24:04.502+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13172133/comment/16564061","id":"16564061","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aagottlieb","name":"aagottlieb","key":"aagottlieb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Gottlieb","active":true,"timeZone":"America/Los_Angeles"},"body":"I do not think it is warranted either.  So I believe my options are to either\r\n # allow the JDOException to escape or\r\n # add MetaException to the list of thrown exceptions of org.apache.hadoop.hive.metastore.RawStore#getDatabase and alter org.apache.hadoop.hive.metastore.ObjectStore#getDatabase to not wrap the MetaException\r\n\r\nI suppose no existing code could break for option 2 as its _adding_ an exception.  Looking at the interface of RawStore, almost every other method does specify MetaException, making the lack of it on getDatabase seem like an oversight.  Does anyone know any history of why its missing on getDatabase?  Should it have been there the whole time?\r\n\r\nIf there's no reason not to include it, I'll submit a patch with this change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aagottlieb","name":"aagottlieb","key":"aagottlieb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Gottlieb","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-07-31T17:46:03.316+0000","updated":"2018-07-31T17:46:03.316+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-20173/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3vvzb:"}}