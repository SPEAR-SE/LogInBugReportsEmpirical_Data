{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13134726","self":"https://issues.apache.org/jira/rest/api/2/issue/13134726","key":"HIVE-18582","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-01-30T17:36:09.749+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Feb 01 08:47:27 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-18582/watchers","watchCount":6,"isWatching":false},"created":"2018-01-30T11:34:15.312+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335838","id":"12335838","description":"Maintenance branch for 2.1 ","name":"2.1.1","archived":false,"released":true,"releaseDate":"2016-12-08"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liubangchen","name":"liubangchen","key":"liubangchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liubangchen","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-02-01T11:00:40.482+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12324798","id":"12324798","name":"Query Planning"}],"timeoriginalestimate":null,"description":"while executing query MSCK REPAIR TABLE tablename I got Exception:\r\n{code:java}\r\norg.apache.hadoop.hive.ql.metadata.HiveException: MetaException(message:Expected 1 components, got 2 (log_date=2015121309/vgameid=lyjt))\r\nat org.apache.hadoop.hive.ql.exec.DDLTask.msck(DDLTask.java:1847)\r\nat org.apache.hadoop.hive.ql.exec.DDLTask.execute(DDLTask.java:402)\r\nat org.apache.hadoop.hive.ql.exec.Task.executeTask(Task.java:197)\r\nat org.apache.hadoop.hive.ql.exec.TaskRunner.runSequential(TaskRunner.java:100)\r\nat org.apache.hadoop.hive.ql.Driver.launchTask(Driver.java:2073)\r\nat org.apache.hadoop.hive.ql.Driver.execute(Driver.java:1744)\r\nat org.apache.hadoop.hive.ql.Driver.runInternal(Driver.java:1453)\r\nat org.apache.hadoop.hive.ql.Driver.run(Driver.java:1171)\r\nat org.apache.hadoop.hive.ql.Driver.run(Driver.java:1161)\r\nat org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:232)\r\n--\r\nCaused by: MetaException(message:Expected 1 components, got 2 (log_date=2015121309/vgameid=lyjt))\r\nat org.apache.hadoop.hive.metastore.Warehouse.makeValsFromName(Warehouse.java:385)\r\nat org.apache.hadoop.hive.ql.exec.DDLTask.msck(DDLTask.java:1845)\r\n{code}\r\ntable PARTITIONED by (log_date,vgameid)\r\n\r\nThe data file on HDFS is:\r\n\r\n \r\n{code:java}\r\n/usr/hive/warehouse/a.db/tablename/log_date=2015063023\r\ndrwxr-xr-x - root supergroup 0 2018-01-26 09:41 /usr/hive/warehouse/a.db/tablename/log_date=2015121309/vgameid=lyjt\r\n{code}\r\nThe subdir of log_data=2015063023 is empty\r\n\r\nIf i set  hive.msck.path.validation=ignore Then msck repair table will executed ok.\r\n\r\nThen I found code like this:\r\n{code:java}\r\nprivate int msck(Hive db, MsckDesc msckDesc) {\r\n  CheckResult result = new CheckResult();\r\n  List<String> repairOutput = new ArrayList<String>();\r\n  try {\r\n    HiveMetaStoreChecker checker = new HiveMetaStoreChecker(db);\r\n    String[] names = Utilities.getDbTableName(msckDesc.getTableName());\r\n    checker.checkMetastore(names[0], names[1], msckDesc.getPartSpecs(), result);\r\n    List<CheckResult.PartitionResult> partsNotInMs = result.getPartitionsNotInMs();\r\n    if (msckDesc.isRepairPartitions() && !partsNotInMs.isEmpty()) {\r\n     //I think bug is here\r\n      AbstractList<String> vals = null;\r\n      String settingStr = HiveConf.getVar(conf, HiveConf.ConfVars.HIVE_MSCK_PATH_VALIDATION);\r\n      boolean doValidate = !(\"ignore\".equals(settingStr));\r\n      boolean doSkip = doValidate && \"skip\".equals(settingStr);\r\n      // The default setting is \"throw\"; assume doValidate && !doSkip means throw.\r\n      if (doValidate) {\r\n        // Validate that we can add partition without escaping. Escaping was originally intended\r\n        // to avoid creating invalid HDFS paths; however, if we escape the HDFS path (that we\r\n        // deem invalid but HDFS actually supports - it is possible to create HDFS paths with\r\n        // unprintable characters like ASCII 7), metastore will create another directory instead\r\n        // of the one we are trying to \"repair\" here.\r\n        Iterator<CheckResult.PartitionResult> iter = partsNotInMs.iterator();\r\n        while (iter.hasNext()) {\r\n          CheckResult.PartitionResult part = iter.next();\r\n          try {\r\n            vals = Warehouse.makeValsFromName(part.getPartitionName(), vals);\r\n          } catch (MetaException ex) {\r\n            throw new HiveException(ex);\r\n          }\r\n          for (String val : vals) {\r\n            String escapedPath = FileUtils.escapePathName(val);\r\n            assert escapedPath != null;\r\n            if (escapedPath.equals(val)) continue;\r\n            String errorMsg = \"Repair: Cannot add partition \" + msckDesc.getTableName()\r\n                + ':' + part.getPartitionName() + \" due to invalid characters in the name\";\r\n            if (doSkip) {\r\n              repairOutput.add(errorMsg);\r\n              iter.remove();\r\n            } else {\r\n              throw new HiveException(errorMsg);\r\n            }\r\n          }\r\n        }\r\n      }\r\n{code}\r\nI think  AbstractList<String> vals = null; must placed after  \"while (iter.hasNext()) {\" will work ok.\r\n\r\n \r\n\r\n ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12908522","id":"12908522","filename":"HIVE-18582.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liubangchen","name":"liubangchen","key":"liubangchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liubangchen","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-31T07:55:11.651+0000","size":2161,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12908522/HIVE-18582.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12908778","id":"12908778","filename":"HIVE-18582-1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liubangchen","name":"liubangchen","key":"liubangchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liubangchen","active":true,"timeZone":"Etc/UTC"},"created":"2018-02-01T10:54:14.238+0000","size":3278,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12908778/HIVE-18582-1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":" MSCK REPAIR TABLE Throw MetaException","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liubangchen","name":"liubangchen","key":"liubangchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liubangchen","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liubangchen","name":"liubangchen","key":"liubangchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liubangchen","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13134726/comment/16345491","id":"16345491","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vihangk1","name":"vihangk1","key":"vihangk1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vihang Karajgaonkar","active":true,"timeZone":"America/Los_Angeles"},"body":"This is interesting. It looks like when we set {{hive.msck.path.validation}} to {{skip}} or {{throw}} msck will throw an exception when there are empty partition directories. Moving \"AbstractList<String> vals = null\" after \"while (iter.hasNext())\" as suggested above may not help since if the vals is set to null {{Warehouse.makeValsFromName}} will initialize it.\r\n\r\nThis behavior may be but design although I am not a 100% sure. [~sershe] Do you know if this an intended behavior or a bug? Based on the description of the config it looks like it should check only for \"invalid\" characters in the partition names. But looks like it is throwing for empty partitions as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vihangk1","name":"vihangk1","key":"vihangk1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vihang Karajgaonkar","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-01-30T17:36:09.749+0000","updated":"2018-01-30T17:36:09.749+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13134726/comment/16345757","id":"16345757","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"Throwing for a missing partition directory in throw mode is by design.\r\nHowever, the change itself makes sense to me, vals should not really survive between partitions so the scope should be reduced.\r\nPatches welcome ;)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-01-30T20:32:49.295+0000","updated":"2018-01-30T20:32:49.295+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13134726/comment/16346386","id":"16346386","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liubangchen","name":"liubangchen","key":"liubangchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liubangchen","active":true,"timeZone":"Etc/UTC"},"body":"We can add a method to valid the method findUnknownPartitions of class HiveMetaStoreChecker \r\n\r\n \r\n{code:java}\r\n\r\nvoid findUnknownPartitions(Table table, Set<Path> partPaths,\r\n      CheckResult result) throws IOException, HiveException {\r\n\r\n    Path tablePath = table.getPath();\r\n    // now check the table folder and see if we find anything\r\n    // that isn't in the metastore\r\n    Set<Path> allPartDirs = new HashSet<Path>();\r\n    getAllLeafDirs(tablePath, allPartDirs);\r\n    // don't want the table dir\r\n    allPartDirs.remove(tablePath);\r\n\r\n    // remove the partition paths we know about\r\n    allPartDirs.removeAll(partPaths);\r\n\r\n    // we should now only have the unexpected folders left\r\n    for (Path partPath : allPartDirs) {\r\n      if(!isVaildPartitionPath(table,partPath)){\r\n        LOG.warn(\"invalid data path:\"+partPath.toString());\r\n        continue;\r\n      }\r\n      FileSystem fs = partPath.getFileSystem(conf);\r\n      String partitionName = getPartitionName(fs.makeQualified(tablePath),\r\n          partPath);\r\n\r\n      if (partitionName != null) {\r\n        PartitionResult pr = new PartitionResult();\r\n        pr.setPartitionName(partitionName);\r\n        pr.setTableName(table.getTableName());\r\n\r\n        result.getPartitionsNotInMs().add(pr);\r\n      }\r\n    }\r\n  }\r\n\r\n  boolean isVaildPartitionPath(Table table,Path partpath){\r\n    Path tablePath = table.getPath();\r\n    String partpathinfo=partpath.toString();\r\n    String partinfo=partpathinfo.substring(tablePath.toString().length()+1,partpathinfo.length());\r\n    if(partinfo==null||\"\".equals(partinfo)){\r\n      return false;\r\n    }\r\n    String[] parts=partinfo.split(\"/\");\r\n    if(parts==null||parts.length==0){\r\n      return false;\r\n    }\r\n    Map<String,String> partsmap=new java.util.HashMap<String,String>();\r\n    for(String part:parts){\r\n      int index=part.indexOf(\"=\");\r\n      if(index<0){\r\n        continue;\r\n      }\r\n      String partname=part.substring(0,index);\r\n      partsmap.put(partname,partname);\r\n    }\r\n    for (FieldSchema field : table.getPartCols()) {\r\n      String val = partsmap.get(field.getName());\r\n      if (val == null || val.isEmpty()) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n{code}\r\n\r\nLet me submit the patch.\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liubangchen","name":"liubangchen","key":"liubangchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liubangchen","active":true,"timeZone":"Etc/UTC"},"created":"2018-01-31T07:51:30.144+0000","updated":"2018-01-31T07:54:14.658+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13134726/comment/16347487","id":"16347487","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"This code should still respect the mode as specified - i.e. in throw case, it should throw on bad directories, not skip them.\r\n\r\nPartition directories actually do not have to be under a table directory, so the code that does the sub-directory may be incorrect, unless the caller ensures they are.\r\n\r\nCan you post on review board? There are some minor comments (typo in Valid, etc) that are easier to leave there.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-01-31T19:43:37.409+0000","updated":"2018-01-31T19:43:37.409+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13134726/comment/16347536","id":"16347536","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"| (x) *{color:red}-1 overall{color}* |\r\n\\\\\r\n\\\\\r\n|| Vote || Subsystem || Runtime || Comment ||\r\n|| || || || {color:brown} Prechecks {color} ||\r\n| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m  0s{color} | {color:blue} Findbugs executables are not available. {color} |\r\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\r\n|| || || || {color:brown} master Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  7m  7s{color} | {color:green} master passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  1m  1s{color} | {color:green} master passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 36s{color} | {color:green} master passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 52s{color} | {color:green} master passed {color} |\r\n|| || || || {color:brown} Patch Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  1m 16s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  1m  4s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javac {color} | {color:green}  1m  4s{color} | {color:green} the patch passed {color} |\r\n| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red}  0m 34s{color} | {color:red} ql: The patch generated 8 new + 3 unchanged - 0 fixed = 11 total (was 3) {color} |\r\n| {color:red}-1{color} | {color:red} whitespace {color} | {color:red}  0m  0s{color} | {color:red} The patch has 1 line(s) that end in whitespace. Use git apply --whitespace=fix <<patch_file>>. Refer https://git-scm.com/docs/git-apply {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 50s{color} | {color:green} the patch passed {color} |\r\n|| || || || {color:brown} Other Tests {color} ||\r\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 12s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\r\n| {color:black}{color} | {color:black} {color} | {color:black} 13m 47s{color} | {color:black} {color} |\r\n\\\\\r\n\\\\\r\n|| Subsystem || Report/Notes ||\r\n| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  |\r\n| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u1 (2016-09-03) x86_64 GNU/Linux |\r\n| Build tool | maven |\r\n| Personality | /data/hiveptest/working/yetus/dev-support/hive-personality.sh |\r\n| git revision | master / 79e4740 |\r\n| Default Java | 1.8.0_111 |\r\n| checkstyle | http://104.198.109.242/logs//PreCommit-HIVE-Build-8952/yetus/diff-checkstyle-ql.txt |\r\n| whitespace | http://104.198.109.242/logs//PreCommit-HIVE-Build-8952/yetus/whitespace-eol.txt |\r\n| modules | C: ql U: ql |\r\n| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-8952/yetus.txt |\r\n| Powered by | Apache Yetus    http://yetus.apache.org |\r\n\r\n\r\nThis message was automatically generated.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2018-01-31T20:10:36.819+0000","updated":"2018-01-31T20:10:36.819+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13134726/comment/16347611","id":"16347611","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12908522/HIVE-18582.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 23 failed/errored test(s), 12964 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestAccumuloCliDriver.testCliDriver[accumulo_queries] (batchId=240)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[mapjoin_hook] (batchId=13)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ppd_join5] (batchId=36)\norg.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_move_tbl] (batchId=175)\norg.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[llap_smb] (batchId=152)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[bucket_map_join_tez1] (batchId=172)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=167)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[llap_acid] (batchId=171)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[llap_acid_fast] (batchId=161)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[mergejoin] (batchId=166)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[resourceplan] (batchId=164)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[sysdb] (batchId=161)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vectorization_input_format_excludes] (batchId=163)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[ppd_join5] (batchId=122)\norg.apache.hadoop.hive.cli.control.TestDanglingQOuts.checkDanglingQOut (batchId=221)\norg.apache.hadoop.hive.metastore.client.TestTablesCreateDropAlterTruncate.testAlterTableNullStorageDescriptorInNew[Embedded] (batchId=206)\norg.apache.hadoop.hive.metastore.client.TestTablesList.testListTableNamesByFilterNullDatabase[Embedded] (batchId=206)\norg.apache.hadoop.hive.ql.exec.TestOperators.testNoConditionalTaskSizeForLlap (batchId=282)\norg.apache.hadoop.hive.ql.io.TestDruidRecordWriter.testWrite (batchId=256)\norg.apache.hive.beeline.cli.TestHiveCli.testNoErrorDB (batchId=188)\norg.apache.hive.jdbc.TestSSL.testConnectionMismatch (batchId=234)\norg.apache.hive.jdbc.TestSSL.testConnectionWrongCertCN (batchId=234)\norg.apache.hive.jdbc.TestSSL.testMetastoreConnectionWrongCertCN (batchId=234)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/8952/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/8952/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-8952/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.YetusPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 23 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12908522 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2018-01-31T21:06:42.537+0000","updated":"2018-01-31T21:06:42.537+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13134726/comment/16348219","id":"16348219","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liubangchen","name":"liubangchen","key":"liubangchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liubangchen","active":true,"timeZone":"Etc/UTC"},"body":"Throw an exception on detect a bad directories.\r\n\r\nAdd a method to check exsits partition data location dir is valid.\r\n\r\nCode diff is here :\r\n\r\n https://reviews.apache.org/r/65458/diff/1#index_header\r\n\r\n[~sershe] Hope you review the patch .Thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=liubangchen","name":"liubangchen","key":"liubangchen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"liubangchen","active":true,"timeZone":"Etc/UTC"},"created":"2018-02-01T08:47:27.261+0000","updated":"2018-02-01T11:00:40.457+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-18582/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3pj9b:"}}