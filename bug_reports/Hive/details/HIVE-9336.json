{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12766742","self":"https://issues.apache.org/jira/rest/api/2/issue/12766742","key":"HIVE-9336","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326450","id":"12326450","description":"released","name":"0.14.0","archived":false,"released":true,"releaseDate":"2014-11-12"}],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-01-14T05:14:31.982+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jan 11 17:08:46 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-9336/watchers","watchCount":2,"isWatching":false},"created":"2015-01-12T01:59:17.983+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326829","id":"12326829","description":"0.13 maintenance release 1","name":"0.13.1","archived":false,"released":true,"releaseDate":"2014-06-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-01-11T17:08:46.210+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12324450","id":"12324450","name":"Parser","description":"Hive grammar"}],"timeoriginalestimate":null,"description":"Currently, when Hive parses GROUPING SETS clauses, and if there are some expressions that were composed of two or more common subexpressions, then the first element of those expressions can only be a simple Identifier without any qualifications, otherwise Hive will throw ParseException during its parser stage. Therefore, Hive will throw ParseException while parsing the following HQLs:\n{code}\n    drop table test;\n    create table test(tc1 int, tc2 int, tc3 int);\n    \n    explain select test.tc1, test.tc2 from test group by test.tc1, test.tc2 grouping sets(test.tc1, (test.tc1, test.tc2));\n    explain select tc1+tc2, tc2 from test group by tc1+tc2, tc2 grouping sets(tc2, (tc1 + tc2, tc2));\n    \n    drop table test;\n{code}\nThe following contents show some ParseExctption stacktrace:\n{code}\n    2015-01-07 09:53:34,718 INFO [main]: log.PerfLogger (PerfLogger.java:PerfLogBegin(108)) - <PERFLOG method=Driver.run from=org.apache.hadoop.hive.ql.Driver>\n    2015-01-07 09:53:34,719 INFO [main]: log.PerfLogger (PerfLogger.java:PerfLogBegin(108)) - <PERFLOG method=TimeToSubmit from=org.apache.hadoop.hive.ql.Driver>\n    2015-01-07 09:53:34,721 INFO [main]: ql.Driver (Driver.java:checkConcurrency(158)) - Concurrency mode is disabled, not creating a lock manager\n    2015-01-07 09:53:34,721 INFO [main]: log.PerfLogger (PerfLogger.java:PerfLogBegin(108)) - <PERFLOG method=compile from=org.apache.hadoop.hive.ql.Driver>\n    2015-01-07 09:53:34,724 INFO [main]: log.PerfLogger (PerfLogger.java:PerfLogBegin(108)) - <PERFLOG method=parse from=org.apache.hadoop.hive.ql.Driver>\n    2015-01-07 09:53:34,724 INFO [main]: parse.ParseDriver (ParseDriver.java:parse(185)) - Parsing command: explain select test.tc1, test.tc2 from test group by test.tc1, test.tc2 grouping sets(test.tc1, (test.tc1, test.tc2))\n    2015-01-07 09:53:34,734 ERROR [main]: ql.Driver (SessionState.java:printError(545)) - FAILED: ParseException line 1:105 missing ) at ',' near '<EOF>'\n    line 1:116 extraneous input ')' expecting EOF near '<EOF>'\n    org.apache.hadoop.hive.ql.parse.ParseException: line 1:105 missing ) at ',' near '<EOF>'\n    line 1:116 extraneous input ')' expecting EOF near '<EOF>'\n    at org.apache.hadoop.hive.ql.parse.ParseDriver.parse(ParseDriver.java:210)\n    at org.apache.hadoop.hive.ql.parse.ParseDriver.parse(ParseDriver.java:166)\n    at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:404)\n    at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:322)\n    at org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:975)\n    at org.apache.hadoop.hive.ql.Driver.runInternal(Driver.java:1040)\n    at org.apache.hadoop.hive.ql.Driver.run(Driver.java:911)\n    at org.apache.hadoop.hive.ql.Driver.run(Driver.java:901)\n    at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:268)\n    at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:220)\n    at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:423)\n    at org.apache.hadoop.hive.cli.CliDriver.executeDriver(CliDriver.java:792)\n    at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:686)\n    at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:625)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:606)\n    at org.apache.hadoop.util.RunJar.main(RunJar.java:208)\n    2015-01-07 09:53:34,745 INFO [main]: log.PerfLogger (PerfLogger.java:PerfLogEnd(135)) - </PERFLOG method=compile start=1420595614721 end=1420595614745 duration=24 from=org.apache.hadoop.hive.ql.Driver>\n    2015-01-07 09:53:34,745 INFO [main]: log.PerfLogger (PerfLogger.java:PerfLogBegin(108)) - <PERFLOG method=releaseLocks from=org.apache.hadoop.hive.ql.Driver>\n    2015-01-07 09:53:34,746 INFO [main]: log.PerfLogger (PerfLogger.java:PerfLogEnd(135)) - </PERFLOG method=releaseLocks start=1420595614745 end=1420595614746 duration=1 from=org.apache.hadoop.hive.ql.Driver>\n    2015-01-07 09:53:34,746 INFO [main]: log.PerfLogger (PerfLogger.java:PerfLogBegin(108)) - <PERFLOG method=releaseLocks from=org.apache.hadoop.hive.ql.Driver>\n    2015-01-07 09:53:34,746 INFO [main]: log.PerfLogger (PerfLogger.java:PerfLogEnd(135)) - </PERFLOG method=releaseLocks start=1420595614746 end=1420595614746 duration=0 from=org.apache.hadoop.hive.ql.Driver>\n{code}\nBut, Hive will not throw ParseException while handling the follwing HQLs:\n{code}\n    drop table test;\n    create table test(tc1 int, tc2 int, tc3 int);\n    \n    explain select tc1, test.tc2 from test group by tc1, test.tc2 grouping sets(tc1, (tc1, test.tc2));\n    explain select tc1+tc2, tc1 from test group by tc1+tc2, tc1 grouping sets(tc1, (tc1, tc1 + tc2));\n    explain select test.tc1, test.tc1 + test.tc2 from test group by test.tc1, test.tc1 + test.tc2 grouping sets(test.tc1, (test.tc1), (test.tc1 + test.tc2));\n    \n    drop table test;\n{code}\nFor why and how to solve it, see the attachments: Fix-Hive-ParseException-of-Grouping-Sets.htm and HIVE-9336.1.patch\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12691831","id":"12691831","filename":"Fix-Hive-ParseException-of-Grouping-Sets.htm","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaohm3","name":"zhaohm3","key":"zhaohm3","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhaohm3","active":true,"timeZone":"Asia/Chongqing"},"created":"2015-01-13T02:47:12.663+0000","size":58821,"mimeType":"text/html","content":"https://issues.apache.org/jira/secure/attachment/12691831/Fix-Hive-ParseException-of-Grouping-Sets.htm"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12691869","id":"12691869","filename":"HIVE-9336.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaohm3","name":"zhaohm3","key":"zhaohm3","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhaohm3","active":true,"timeZone":"Asia/Chongqing"},"created":"2015-01-13T07:08:23.783+0000","size":815,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12691869/HIVE-9336.1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Fix Hive throws ParseException while handling Grouping-Sets clauses","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaohm3","name":"zhaohm3","key":"zhaohm3","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhaohm3","active":true,"timeZone":"Asia/Chongqing"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaohm3","name":"zhaohm3","key":"zhaohm3","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhaohm3","active":true,"timeZone":"Asia/Chongqing"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12766742/comment/14273152","id":"14273152","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaohm3","name":"zhaohm3","key":"zhaohm3","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhaohm3","active":true,"timeZone":"Asia/Chongqing"},"body":"For more details, visit: https://www.zybuluo.com/Spongcer/note/61369\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaohm3","name":"zhaohm3","key":"zhaohm3","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhaohm3","active":true,"timeZone":"Asia/Chongqing"},"created":"2015-01-12T02:01:49.943+0000","updated":"2015-01-12T02:01:49.943+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12766742/comment/14274623","id":"14274623","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaohm3","name":"zhaohm3","key":"zhaohm3","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhaohm3","active":true,"timeZone":"Asia/Chongqing"},"body":"Or see the attachment: Fix-Hive-ParseException-of-Grouping-Sets.htm","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaohm3","name":"zhaohm3","key":"zhaohm3","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhaohm3","active":true,"timeZone":"Asia/Chongqing"},"created":"2015-01-13T02:50:16.307+0000","updated":"2015-01-13T02:50:16.307+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12766742/comment/14276491","id":"14276491","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 at least one tests failed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12691869/HIVE-9336.1.patch\n\n{color:red}ERROR:{color} -1 due to 10 failed/errored test(s), 7311 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_index_bitmap_auto\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_optimize_nullscan\norg.apache.hadoop.hive.ql.TestMTQueries.testMTQueries1\norg.apache.hive.spark.client.TestSparkClient.testAddJarsAndFiles\norg.apache.hive.spark.client.TestSparkClient.testCounters\norg.apache.hive.spark.client.TestSparkClient.testErrorJob\norg.apache.hive.spark.client.TestSparkClient.testJobSubmission\norg.apache.hive.spark.client.TestSparkClient.testMetricsCollection\norg.apache.hive.spark.client.TestSparkClient.testRemoteClient\norg.apache.hive.spark.client.TestSparkClient.testSimpleSparkJob\n{noformat}\n\nTest results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2356/testReport\nConsole output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2356/console\nTest logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2356/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 10 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12691869 - PreCommit-HIVE-TRUNK-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2015-01-14T05:14:31.982+0000","updated":"2015-01-14T05:14:31.982+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12766742/comment/14278170","id":"14278170","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaohm3","name":"zhaohm3","key":"zhaohm3","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhaohm3","active":true,"timeZone":"Asia/Chongqing"},"body":"@Prasad Mujumdar \n\nI rerun the unit tests through the following commands and all report success without any errors, So I guess that there are some \ndifferences between my local environment and Hive QA's, or we do not use the same options to mvn when compile and run unit tests, or anything else, Could you help me to find what happened?\n\ncd itests\n\nmvn test -Dtest=rg.apache.hadoop.hive.cli.TestMinimrCliDriver -Dqfile=index_bitmap_auto.q -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hadoop.hive.cli.TestMinimrCliDriver#testCliDriver_index_bitmap_auto -Dtest.silent=false -Phadoop-2\n\nmvn test -Dtest=org.apache.hadoop.hive.cli.TestSparkCliDriver -Dqfile=optimize_nullscan.q  -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hadoop.hive.cli.TestSparkCliDriver#testCliDriver_optimize_nullscan -Dtest.silent=false -Phadoop-2\n\nmvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testRemoteClient -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testCounters -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testAddJarsAndFiles -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testSimpleSparkJob -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testErrorJob -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testJobSubmission -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testMetricsCollection -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hadoop.hive.ql.TestMTQueries#testMTQueries1 -Dtest.silent=false -Phadoop-2","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaohm3","name":"zhaohm3","key":"zhaohm3","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhaohm3","active":true,"timeZone":"Asia/Chongqing"},"created":"2015-01-15T03:02:08.521+0000","updated":"2015-01-15T03:02:08.521+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12766742/comment/14285118","id":"14285118","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaohm3","name":"zhaohm3","key":"zhaohm3","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhaohm3","active":true,"timeZone":"Asia/Chongqing"},"body":"[~xuefuz]\n\nI build Hive with the following comands:\n\nmvn clean install -DskipTests -Phadoop-2 | tee logs/mvn.logs\ncd itests\nmvn clean install -DskipTests -Phadoop-2 | tee logs/mvn.logs\n\nand after that, I rerun the unit tests through the following commands and all report successed without any errors, So I guess that there are some \ndifferences between my local environment and Hive QA's, or we do not pass the same options to mvn when compile and run unit tests, or anything else, Could you help me to find what happened?\n\ncd itests\n\nmvn test -Dtest=rg.apache.hadoop.hive.cli.TestMinimrCliDriver -Dqfile=index_bitmap_auto.q -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hadoop.hive.cli.TestMinimrCliDriver#testCliDriver_index_bitmap_auto -Dtest.silent=false -Phadoop-2\n\nmvn test -Dtest=org.apache.hadoop.hive.cli.TestSparkCliDriver -Dqfile=optimize_nullscan.q  -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hadoop.hive.cli.TestSparkCliDriver#testCliDriver_optimize_nullscan -Dtest.silent=false -Phadoop-2\n\nmvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testRemoteClient -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testCounters -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testAddJarsAndFiles -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testSimpleSparkJob -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testErrorJob -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testJobSubmission -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hive.spark.client.TestSparkClient#testMetricsCollection -Dtest.silent=false -Phadoop-2\nmvn test -Dtest=org.apache.hadoop.hive.ql.TestMTQueries#testMTQueries1 -Dtest.silent=false -Phadoop-2","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaohm3","name":"zhaohm3","key":"zhaohm3","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"zhaohm3","active":true,"timeZone":"Asia/Chongqing"},"created":"2015-01-21T03:43:23.266+0000","updated":"2015-01-21T03:43:23.266+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12766742/comment/15818627","id":"15818627","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=victor.batyt%40gmail.com","name":"victor.batyt@gmail.com","key":"victor.batyt@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Viktor Batytskyi","active":true,"timeZone":"Etc/UTC"},"body":"+1 Having the same issue.\n\nThough, there is a workaround for it:\nWe can write:\n\n{code}\n    explain select test.tc1, test.tc2 from test group by null, test.tc1, test.tc2 grouping sets(null, test.tc1, (test.tc1, test.tc2));\n    explain select tc1+tc2, tc2 from test group by null, tc1+tc2, tc2 grouping sets(null, tc2, (tc1 + tc2, tc2));\n{code}\nInstead of:\n\n{code}\n    explain select test.tc1, test.tc2 from test group by test.tc1, test.tc2 grouping sets(test.tc1, (test.tc1, test.tc2));\n    explain select tc1+tc2, tc2 from test group by tc1+tc2, tc2 grouping sets(tc2, (tc1 + tc2, tc2));\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=victor.batyt%40gmail.com","name":"victor.batyt@gmail.com","key":"victor.batyt@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Viktor Batytskyi","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-11T15:32:37.067+0000","updated":"2017-01-11T15:32:51.251+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12766742/comment/15818853","id":"15818853","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12691869/HIVE-9336.1.patch\n\n{color:red}ERROR:{color} -1 due to build exiting with an error\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/2888/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/2888/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2888/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nTests exited with: NonZeroExitCodeException\nCommand 'bash /data/hiveptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ date '+%Y-%m-%d %T.%3N'\n2017-01-11 17:08:44.860\n+ [[ -n /usr/lib/jvm/java-8-openjdk-amd64 ]]\n+ export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64\n+ JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64\n+ export PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games\n+ PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games\n+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m '\n+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m '\n+ export 'MAVEN_OPTS=-Xmx1g '\n+ MAVEN_OPTS='-Xmx1g '\n+ cd /data/hiveptest/working/\n+ tee /data/hiveptest/logs/PreCommit-HIVE-Build-2888/source-prep.txt\n+ [[ false == \\t\\r\\u\\e ]]\n+ mkdir -p maven ivy\n+ [[ git = \\s\\v\\n ]]\n+ [[ git = \\g\\i\\t ]]\n+ [[ -z master ]]\n+ [[ -d apache-github-source-source ]]\n+ [[ ! -d apache-github-source-source/.git ]]\n+ [[ ! -d apache-github-source-source ]]\n+ date '+%Y-%m-%d %T.%3N'\n2017-01-11 17:08:44.863\n+ cd apache-github-source-source\n+ git fetch origin\n+ git reset --hard HEAD\nHEAD is now at cb771bb HIVE-15563: Ignore Illegal Operation state transition exception in SQLOperation.runQuery to expose real exception (Zhihai Xu via Jimmy Xiang)\n+ git clean -f -d\n+ git checkout master\nAlready on 'master'\nYour branch is up-to-date with 'origin/master'.\n+ git reset --hard origin/master\nHEAD is now at cb771bb HIVE-15563: Ignore Illegal Operation state transition exception in SQLOperation.runQuery to expose real exception (Zhihai Xu via Jimmy Xiang)\n+ git merge --ff-only origin/master\nAlready up-to-date.\n+ date '+%Y-%m-%d %T.%3N'\n2017-01-11 17:08:45.877\n+ patchCommandPath=/data/hiveptest/working/scratch/smart-apply-patch.sh\n+ patchFilePath=/data/hiveptest/working/scratch/build.patch\n+ [[ -f /data/hiveptest/working/scratch/build.patch ]]\n+ chmod +x /data/hiveptest/working/scratch/smart-apply-patch.sh\n+ /data/hiveptest/working/scratch/smart-apply-patch.sh /data/hiveptest/working/scratch/build.patch\nerror: patch failed: ql/src/java/org/apache/hadoop/hive/ql/parse/IdentifiersParser.g:66\nerror: ql/src/java/org/apache/hadoop/hive/ql/parse/IdentifiersParser.g: patch does not apply\nThe patch does not appear to apply with p0, p1, or p2\n+ exit 1\n'\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12691869 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-01-11T17:08:46.210+0000","updated":"2017-01-11T17:08:46.210+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-9336/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i248rj:"}}