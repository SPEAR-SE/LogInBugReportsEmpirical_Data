{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12443894","self":"https://issues.apache.org/jira/rest/api/2/issue/12443894","key":"HIVE-1001","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314156","id":"12314156","description":"released","name":"0.5.0","archived":false,"released":true,"releaseDate":"2010-02-23"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-12-21T19:15:31.587+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Jan 02 07:55:41 UTC 2010","customfield_12310420":"73161","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_56841275_*|*_5_*:*_2_*:*_593180959_*|*_4_*:*_1_*:*_387520832","customfield_12312321":null,"resolutiondate":"2010-01-02T07:55:41.059+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-1001/watchers","watchCount":1,"isWatching":false},"created":"2009-12-21T07:43:17.993+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314156","id":"12314156","description":"released","name":"0.5.0","archived":false,"released":true,"releaseDate":"2010-02-23"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-12-17T00:05:41.057+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"From David Lerman:\n\"\nI'm running into errors where CombinedHiveInputFormat is combining data from\ntwo different tables which is causing problems because the tables have\ndifferent input formats.\n\nIt looks like the problem is in\norg.apache.hadoop.hive.shims.Hadoop20Shims.getInputPathsShim.  It calls\nCombineFileInputFormat.getInputPaths which returns the list of input paths\nand then chops off the first 5 characters to remove file: from the\nbeginning, but the return value I'm getting from getInputPaths is actually\nhdfs://domain/path.  So then when it creates the pools using these paths,\nnone of the input paths match the pools (since they're just the file path\nwhich protocol or domain).\n\"\n\nWe should use Path.getPath() to get the path part of an URI instead of just chopping off 5 chars.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12428661","id":"12428661","filename":"hive.1001.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-12-21T22:04:43.598+0000","size":6736,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12428661/hive.1001.1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"122738","customfield_12312823":null,"summary":"CombinedHiveInputFormat should parse the inputpath correctly","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12443894/comment/12793305","id":"12793305","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"This is a blocker for 0.5","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-12-21T19:15:31.587+0000","updated":"2009-12-21T19:15:31.587+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12443894/comment/12793389","id":"12793389","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"+1. Looks good. Will commit if tests pass.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2009-12-21T22:20:36.470+0000","updated":"2009-12-21T22:20:36.470+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12443894/comment/12793414","id":"12793414","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"I just committed. Thanks Namit!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2009-12-21T23:30:39.250+0000","updated":"2009-12-21T23:30:39.250+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12443894/comment/12794912","id":"12794912","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlerman","name":"dlerman","key":"dlerman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Lerman","active":true,"timeZone":"Etc/UTC"},"body":"This patch appears to affect other functionality.  Without the patch, \"insert overwrite directory 'out' select ... from ...\" yields 1 MR job, but with the patch, it yields 2 MR jobs.  At first glance, it looks like the second job in the insert overwrite plan is a conditional operation where it either does an HDFS move to move the data from the temp output directory to its final destination, or runs a MR job to copy the data (maybe if it needs to copy across clusters?).  Before the patch, it just does the HDFS copy, but after it, it does the MR copy.  Maybe the paths its comparing to determine which task to run are getting screwed up by the patch?\n\nSteps to reproduce:\n\nUsing Cloudera's Hadoop 0.20.1+152 (since the CombineFile functionality doesn't work in 0.20.1 without the extra patches):\n\n* Create a data file twolines.dat containing:\n\nkey1^Avalue1\nkey2^Avalue2\n\n* Create a table with two partitions each containing that data:\n\nCREATE TABLE fourlinestest(KEY STRING, VALUE STRING) PARTITIONED BY (part int) STORED AS TEXTFILE;\nload data local inpath 'twolines.dat' into table fourlinestest partition (part=1);\nload data local inpath 'twolines.dat' into table fourlinestest partition (part=2);\n\n* Using Hive r888452 (before this patch was applied):\n\nset hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;\ninsert overwrite directory 'out' select key from fourlinestest;\n\n--> The log shows that that the pools are getting created with corrupt paths (which was the bug that was fixed), but the job runs successfully with 1 MR job:\n\nTotal MapReduce jobs = 2\nLaunching Job 1 out of 2\nNumber of reduce tasks is set to 0 since there's no reduce operator\nStarting Job = job_200912240057_7597, Tracking URL = http://REMOVED:50030/jobdetails.jsp?jobid=job_200912240057_7597\nKill Command = REMOVED/bin/hadoop job  -Dmapred.job.tracker=REMOVED:8021 -kill job_200912240057_7597\n2009-12-28 14:47:02,350 Stage-1 map = 0%,  reduce = 0%\n2009-12-28 14:47:14,189 Stage-1 map = 100%,  reduce = 0%\n2009-12-28 14:47:18,404 Stage-1 map = 100%,  reduce = 100%\nEnded Job = job_200912240057_7597\nLaunching Job 2 out of 2\nMoving data to: hdfs://REMOVED/561636114/10000\nMoving data to: out\n4 Rows loaded to out\nOK\n\n* Apply the patch, rebuild, and rerun\n\npatch -p0 < hive.1001.1.patch\nant package\nbin/hive\nset hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;\ninsert overwrite directory 'out' select key from fourlinestest;\n\n--> This time the second job actually runs a MR job (which then fails because of HIVE-1006).\n\nTotal MapReduce jobs = 2\nLaunching Job 1 out of 2\nNumber of reduce tasks is set to 0 since there's no reduce operator\nStarting Job = job_200912240057_7616, Tracking URL = http://REMOVED:50030/jobdetails.jsp?jobid=job_200912240057_7616\nKill Command = REMOVED/bin/hadoop job  -Dmapred.job.tracker=REMOVED:8021 -kill job_200912240057_7616\n2009-12-28 14:54:39,414 Stage-1 map = 0%,  reduce = 0%\n2009-12-28 14:54:51,224 Stage-1 map = 100%,  reduce = 0%\nEnded Job = job_200912240057_7616\nLaunching Job 2 out of 2\nNumber of reduce tasks determined at compile time: 1\nIn order to change the average load for a reducer (in bytes):\n  set hive.exec.reducers.bytes.per.reducer=<number>\nIn order to limit the maximum number of reducers:\n  set hive.exec.reducers.max=<number>\nIn order to set a constant number of reducers:\n  set mapred.reduce.tasks=<number>\njava.io.IOException: cannot find dir = hdfs://RMOVED/1656362434/10001/attempt_200912240057_7616_m_000000_0 in partToPartitionInfo!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlerman","name":"dlerman","key":"dlerman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Lerman","active":true,"timeZone":"Etc/UTC"},"created":"2009-12-28T20:17:00.212+0000","updated":"2009-12-28T20:17:00.212+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12443894/comment/12794968","id":"12794968","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"Hi Dave,\n\nHow many mappers in the map-reduce job before applying this patch?  It is strange that the merge job was not running. The merge job is started according to average result file size produced by the first job, and the merge job always uses a map-reduce job.\n\nAnd also discussed with Namit, we may need to add another parameter \"number of files\" to determine whether to start the merge job or not (this will be a different issue).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2009-12-28T23:52:24.695+0000","updated":"2009-12-28T23:52:24.695+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12443894/comment/12795788","id":"12795788","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlerman","name":"dlerman","key":"dlerman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Lerman","active":true,"timeZone":"Etc/UTC"},"body":"Okay, that makes sense then.  Without the patch, the two input pools have corrupt paths so the input files don't match either pool and get processed together in one pool of non-matching paths.  This yields one split and one mapper, so the merge step doesn't run (since there's only one output file).\n\nWith the patch, the pools get created correctly, so the two files are processed in separate pools, which yields two splits and two mappers, so the merge step runs.\n\nThanks for the help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlerman","name":"dlerman","key":"dlerman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Lerman","active":true,"timeZone":"Etc/UTC"},"created":"2010-01-01T20:03:54.086+0000","updated":"2010-01-01T20:03:54.086+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12443894/comment/12795841","id":"12795841","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"Closing the jira as per the clarification","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-01-02T07:55:41.038+0000","updated":"2010-01-02T07:55:41.038+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-1001/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0lcvz:"}}