{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13153153","self":"https://issues.apache.org/jira/rest/api/2/issue/13153153","key":"HIVE-19231","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12340268","id":"12340268","name":"3.0.0","archived":false,"released":true,"releaseDate":"2018-05-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12343014","id":"12343014","description":"","name":"3.1.0","archived":false,"released":true,"releaseDate":"2018-07-30"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2018-04-26T21:58:53.730+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue May 22 23:12:50 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_71543832_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_1213350367","customfield_12312321":null,"resolutiondate":"2018-05-02T18:39:06.020+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-19231/watchers","watchCount":2,"isWatching":false},"created":"2018-04-17T21:44:11.864+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334255","id":"12334255","name":"2.1.0","archived":false,"released":true,"releaseDate":"2016-06-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-05-22T23:12:50.179+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12324409","id":"12324409","name":"Beeline"}],"timeoriginalestimate":null,"description":"We had a customer that was using some sort of front end that would invoke beeline commands with some query files on a node that that remote to the HS2 node.\r\n\r\nSo beeline runs locally on this edge but connects to a remote HS2. Since the fix made in HIVE-14342, the beeline started producing garbled line in the output. Something like\r\n{code:java}\r\n^Mnull                                                   ^Mnull^Mnull                                                   ^Mnull00-0000\tAll Occupations\t135185230\t42270\r\n11-0000\tManagement occupations\t6152650\t100310{code}\r\n \r\n\r\nI havent been able to reproduce the issue locally as I do not have their system, but with some additional instrumentation I have been able to get some info regarding the beeline process.\r\n\r\nEssentially, such invocation causes beeline process to run with {{-Djline.terminal=jline.UnsupportedTerminal}} all the time and thus causes the issue. They can run the same beeline command directly in the shell on the same host and it does not cause this issue.\r\n\r\nPID            S   TTY          TIME COMMAND\r\n44107  S    S  ?        00:00:00 bash beeline -u ...\r\n\r\nPID              S     TTY          TIME COMMAND\r\n48453  S+   S     pts/4    00:00:00 bash beeline -u ...\r\n\r\nSomehow that process wasnt attached to any local terminals. So the check made for /dev/stdin wouldnt work.\r\n\r\n \r\n\r\nInstead an additional check to check the TTY session of the process before using the UnsupportedTerminal (which really should only be used for backgrounded beeline sessions) seems to resolve the issue.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12340268","id":"12340268","name":"3.0.0","archived":false,"released":true,"releaseDate":"2018-05-21"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12919658","id":"12919658","filename":"HIVE-19231.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"created":"2018-04-18T17:36:23.593+0000","size":525,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12919658/HIVE-19231.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Beeline generates garbled output when using UnsupportedTerminal","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13153153/comment/16454689","id":"16454689","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"body":"[~aihuaxu] Could you please review this when you have a chance? Thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"created":"2018-04-26T18:49:56.496+0000","updated":"2018-04-26T18:49:56.496+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13153153/comment/16455449","id":"16455449","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"body":"? for TTY means the process is not attached to any TTY (terminal interface). Probably similar to something like daemon. Seems we should add such check for background process. I also notice some platform on mac may show as \"??\". The script works for both case, right?\r\n\r\nProbably you can try out cron job calling beeline to simulate this. \r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-04-26T21:58:53.730+0000","updated":"2018-04-26T21:58:53.730+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13153153/comment/16459875","id":"16459875","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"body":"[~aihuaxu] Running a beeline command using a cron job seems to be resulting in similar output that we were seeing that caused this issue.\r\n{code:java}\r\n  PID          S TTY          TIME COMMAND\r\n22756 ?        S ?        00:00:00 bash /usr/lib/hive/bin/beeline -u jdbc:hive2://localhost:10000 -n hive -p hive -e select * from sample_08 where salary > 50000\r\nJava HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=512M; support was removed in 8.0\r\nJava HotSpot(TM) 64-Bit Server VM warning: Using incremental CMS is deprecated and will likely be removed in a future release\r\nJava HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=512M; support was removed in 8.0\r\nscan complete in 2ms\r\nConnecting to jdbc:hive2://localhost:10000\r\nConnected to: Apache Hive (version 1.1.0-cdh5.14.3-SNAPSHOT)\r\nDriver: Hive JDBC (version 1.1.0-cdh5.14.3-SNAPSHOT)\r\nTransaction isolation: TRANSACTION_REPEATABLE_READ\r\nINFO  : Compiling command(queryId=hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0): select * from sample_08 where salary > 50000\r\nINFO  : Semantic Analysis Completed\r\nINFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:sample_08.code, type:string, comment:null), FieldSchema(name:sample_08.description, type:string, comment:null), FieldSchema(name:samp\r\nle_08.total_emp, type:int, comment:null), FieldSchema(name:sample_08.salary, type:int, comment:null)], properties:null)\r\nINFO  : Completed compiling command(queryId=hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0); Time taken: 0.123 seconds\r\nINFO  : Executing command(queryId=hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0): select * from sample_08 where salary > 50000\r\nINFO  : Query ID = hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0\r\nINFO  : Total jobs = 1\r\nINFO  : Launching Job 1 out of 1\r\nINFO  : Starting task [Stage-1:MAPRED] in serial mode\r\nINFO  : Number of reduce tasks is set to 0 since there's no reduce operator\r\nINFO  : number of splits:1\r\nINFO  : Submitting tokens for job: job_1525165852892_0012\r\nINFO  : The url to track the job: http://<SNIPPED>:8088/proxy/application_1525165852892_0012/\r\nINFO  : Starting Job = job_1525165852892_0012, Tracking URL = http://<SNIPPED>:8088/proxy/application_1525165852892_0012/\r\nINFO  : Kill Command = /usr/lib/hadoop/bin/hadoop job  -kill job_1525165852892_0012\r\nINFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 0\r\nINFO  : 2018-05-01 10:05:10,966 Stage-1 map = 0%,  reduce = 0%\r\nINFO  : 2018-05-01 10:05:18,294 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 3.89 sec\r\nINFO  : MapReduce Total cumulative CPU time: 3 seconds 890 msec\r\nINFO  : Ended Job = job_1525165852892_0012\r\nINFO  : MapReduce Jobs Launched:\r\nINFO  : Stage-Stage-1: Map: 1   Cumulative CPU: 3.89 sec   HDFS Read: 50608 HDFS Write: 16567 SUCCESS\r\nINFO  : Total MapReduce CPU Time Spent: 3 seconds 890 msec\r\nINFO  : Completed executing command(queryId=hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0); Time taken: 13.981 seconds\r\nINFO  : OK\r\n{code}\r\n\r\nHowever, running as a cron job with or without the fix does not seem to reproduce the issue whether running the script runs beeline in background or foreground (I suspect the way cron is run, it can never be run as a foreground process). So it appears we are good for this usecase as well.\r\n\r\nDo you have additional concerns? Thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"created":"2018-05-01T17:17:32.149+0000","updated":"2018-05-01T17:17:32.149+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13153153/comment/16459891","id":"16459891","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"body":"Sounds good. +1.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-05-01T17:27:37.010+0000","updated":"2018-05-01T17:27:37.010+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13153153/comment/16461480","id":"16461480","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"body":"Fix has been pushed to master and branch-3. Thank you for the review [~aihuaxu]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"created":"2018-05-02T18:39:06.038+0000","updated":"2018-05-02T18:39:06.038+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13153153/comment/16484796","id":"16484796","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"This jira is resolved and released with Hive 3.0 If you find an issue with it, please create a new jira.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-05-22T23:12:50.170+0000","updated":"2018-05-22T23:12:50.170+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-19231/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3so8f:"}}