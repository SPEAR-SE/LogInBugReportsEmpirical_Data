{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12633126","self":"https://issues.apache.org/jira/rest/api/2/issue/12633126","key":"HIVE-4041","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323587","id":"12323587","description":"Hive 0.11.0","name":"0.11.0","archived":false,"released":true,"releaseDate":"2013-05-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-03-07T21:36:23.051+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 20 17:04:43 UTC 2013","customfield_12310420":"313622","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2469947113_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-03-20T17:04:43.463+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4041/watchers","watchCount":5,"isWatching":false},"created":"2013-02-20T02:58:56.373+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12364639","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12364639","type":{"id":"12310040","name":"Required","inward":"is required by","outward":"requires","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310040"},"inwardIssue":{"id":"12438744","key":"HIVE-896","self":"https://issues.apache.org/jira/rest/api/2/issue/12438744","fields":{"summary":"Add LEAD/LAG/FIRST/LAST analytical windowing functions to Hive.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-16T21:10:08.118+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320378","id":"12320378","name":"PTF-Windowing","description":"Partitioned Table Functions & Windowing"}],"timeoriginalestimate":null,"description":"Currently we disallow queries if the partition specifications of all Wdw fns are not the same. We can relax this by generating multiple PTFOps based on the unique partitionings in a Query. For partitionings that only differ in sort, we can introduce a sort step in between PTFOps, which can happen in the same Reduce task.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12573564","id":"12573564","filename":"HIVE-4041.D9381.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-03-13T20:00:11.488+0000","size":26297,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12573564/HIVE-4041.D9381.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12574360","id":"12574360","filename":"HIVE-4041.D9381.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-03-19T16:17:14.586+0000","size":25414,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12574360/HIVE-4041.D9381.2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12574569","id":"12574569","filename":"HIVE-4041.D9381.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-03-20T16:29:15.220+0000","size":34457,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12574569/HIVE-4041.D9381.3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12572253","id":"12572253","filename":"WindowingComponentization.pdf","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-06T04:39:02.494+0000","size":136576,"mimeType":"application/pdf","content":"https://issues.apache.org/jira/secure/attachment/12572253/WindowingComponentization.pdf"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"313967","customfield_12312823":null,"summary":"Support multiple partitionings in a single Query","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633126/comment/13594355","id":"13594355","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"body":"attached Design notes","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-06T04:39:21.783+0000","updated":"2013-03-06T04:39:21.783+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633126/comment/13596406","id":"13596406","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Went through the design doc. Thanks, Harish for writing this up. \nIn light of discussion over on HIVE-4108 you may want to update section 3. Also, section 4 needs to be updated because of it. I believe because of dropping of implicit partitioning concept, design (and thus implementation) will be cleaner (and thus easier), which is a good thing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-07T21:36:23.051+0000","updated":"2013-03-07T21:36:23.051+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633126/comment/13601563","id":"13601563","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"hbutani requested code review of \"HIVE-4041 [jira] Support multiple partitionings in a single Query\".\n\nReviewers: JIRA, ashutoshc\n\nadd support for multiple partitioning\n\nCurrently we disallow queries if the partition specifications of all Wdw fns are not the same. We can relax this by generating multiple PTFOps based on the unique partitionings in a Query. For partitionings that only differ in sort, we can introduce a sort step in between PTFOps, which can happen in the same Reduce task.\n\nTEST PLAN\n  added tests to windowing_multipartitioning.q\n\nREVISION DETAIL\n  https://reviews.facebook.net/D9381\n\nAFFECTED FILES\n  data/files/flights_tiny.txt\n  data/files/part.rc\n  data/files/part.seq\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFInvocationSpec.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/WindowingComponentizer.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/WindowingSpec.java\n  ql/src/test/queries/clientpositive/windowing_multipartitioning.q\n  ql/src/test/results/clientpositive/windowing_multipartitioning.q.out\n\nMANAGE HERALD RULES\n  https://reviews.facebook.net/herald/view/differential/\n\nWHY DID I GET THIS EMAIL?\n  https://reviews.facebook.net/herald/transcript/22545/\n\nTo: JIRA, ashutoshc, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-03-13T20:00:11.395+0000","updated":"2013-03-13T20:00:11.395+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633126/comment/13601919","id":"13601919","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"ashutoshc has commented on the revision \"HIVE-4041 [jira] Support multiple partitionings in a single Query\".\n\n  First pass through patch. Some initial questions.\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java:415 Why do we need to do this null check here ?\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java:425 Same question.\n  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java:482 This will set Order on all queries ?\n  Consider query like sum(i) over (partition by si) ... this doesn't need an ordering, right ?\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java:212 Why do we need to change this function?\n\nREVISION DETAIL\n  https://reviews.facebook.net/D9381\n\nTo: JIRA, ashutoshc, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-03-14T00:56:12.280+0000","updated":"2013-03-14T00:56:12.280+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633126/comment/13602037","id":"13602037","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"hbutani has commented on the revision \"HIVE-4041 [jira] Support multiple partitionings in a single Query\".\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java:212 We need to maintain the order of the original columns. This is because at runtime we reconstruct the OIs using the serde props map which has the column names and types.\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java:415 because ExprNodeConstantDesc returns a null for the getCols() call.\n  for the over() case we add a Constant expression to the Partition list\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java:425 same reason as above\n  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java:482 What we are doing today is adding the partition columns as a prefix to the order expressions. Functionally it should not matter; but it is not needed and probably has a performance impact. I need to test that removal.\n  Was planning to do this for Jira 4109. Didn't want to change this behavior in this Jira. But with the refactoring it is quite easy to remove the prefixing code.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D9381\n\nTo: JIRA, ashutoshc, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-03-14T05:12:11.225+0000","updated":"2013-03-14T05:12:11.225+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633126/comment/13603591","id":"13603591","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"ashutoshc has commented on the revision \"HIVE-4041 [jira] Support multiple partitionings in a single Query\".\n\n  Some more questions.\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java:415 I see. I thought with following query I can simulate the same problem even on trunk.\n  select 1 from over10k group by 1;\n\n  But this didn't result in NPE and query ran successfully. Is this query good approximation to simulate this path ? My motivation is somehow to simulate this code path without over clause and thus expose bug on trunk and fix it there, so we don't need to do this in branch.\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java:212 Hmm. I think we hold on to the schema for PTFOp way too early in semantic phase. Apart from changes required here, this holding on to the schema is not playing well with other compile time optimization which hive does after semantic analysis. Other operators don't do this. I think we need to spend a bit of time on this. Can you point to me where we hold on to schema in SemanticAnalyzer and why is it necessary?\n  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java:482 I am fine with doing it in follow-up. But if possible we should get rid of this. This probably result in runtime perf impact since I think this will force hadoop secondary sort so that values for a given key come out sorted. Further, adding extra constraints will lessen the opportunity to do compile time optimizations like filter push down (see my comments on HIVE-4180).\n  ql/src/java/org/apache/hadoop/hive/ql/parse/WindowingComponentizer.java:38 It will be good to define group more concretely. If I am getting this right, this is group of over functions which has same partitioning. Is that correct ?\n  So, a group may have multiple functions associated with it (but all on same partitioning). So, group -> one PTFOp on which there will be multiple functions working? Or a group implies multiple PTFOp chained in same reducer one after other each working on their own function.\n  ql/src/java/org/apache/hadoop/hive/ql/parse/WindowingComponentizer.java:85 Which filter this is? Is this having clause ? But I thought we already removed support for that. If not, I think we should. Or this regular where clause. If later, we should not consume other operators of query in PTOperator.\n  ql/src/test/queries/clientpositive/windowing_multipartitioning.q:21 It will be good to add more tests from the google document which I shared with you. It has multipartitioning tests towards the end.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D9381\n\nTo: JIRA, ashutoshc, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-03-15T17:52:11.316+0000","updated":"2013-03-15T17:52:11.316+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633126/comment/13603738","id":"13603738","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"hbutani has commented on the revision \"HIVE-4041 [jira] Support multiple partitionings in a single Query\".\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java:212 Yes the translation code could do with your review.\n  We were not paying much attention to optimization at the time we wrote it.\n  So the TableFuncDef holds onto ShapeDetails(input, output..)\n  The Shape class has Serde props that we use to reconstruct the OIs during runtime.\n  This happens in PTFTranslator. Read the translate for WindowingSpec method (line 138) in PTFTranslator.\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ReduceSinkDeDuplication.java:415 Just added a Jira 4186 for this.\n  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java:482 yes I agree. I just don't want to make these changes in this Jira. Want to only add multi partition support here.\n  ql/src/java/org/apache/hadoop/hive/ql/parse/WindowingComponentizer.java:38 I will add more comments. So there is:\n  - 1 PTFOp\n  - It can contain one or more PTF invocations.\n  - When the PTF is WindowTableFunc, it can contain 1 or more UDAFs; they have the same partitioning.\n  - During translation we create a WindowingSpec for each destination with Windowing(over clauses).\n  - Here we then componentize the single WindowingSpec into multiple WindowingSpecs based on the partitioning.\n  ql/src/java/org/apache/hadoop/hive/ql/parse/WindowingComponentizer.java:85 Yes the having is to be removed. Haven't gotten around to it. Again didn't want to make this change in this Jira. It is on my todo.\n  ql/src/test/queries/clientpositive/windowing_multipartitioning.q:21 I added all the multipartition tests from the spreadsheet except the ones that have no order. Those I will add once we resolve how to handle no order.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D9381\n\nTo: JIRA, ashutoshc, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-03-15T19:34:11.845+0000","updated":"2013-03-15T19:34:11.845+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633126/comment/13606090","id":"13606090","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"ashutoshc has accepted the revision \"HIVE-4041 [jira] Support multiple partitionings in a single Query\".\n\n  Changes look good. I will commit this once HIVE-4186 is in trunk and after I have merged trunk into branch.\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java:482 Can you file a follow-up jira for this?\n  ql/src/java/org/apache/hadoop/hive/ql/parse/WindowingComponentizer.java:85 Can you file a follow-up jira for this?\n  ql/src/test/queries/clientpositive/windowing_multipartitioning.q:21 Can you file a follow-up jira for this?\n\nREVISION DETAIL\n  https://reviews.facebook.net/D9381\n\nBRANCH\n  HIVE-4041\n\nARCANIST PROJECT\n  hive\n\nTo: JIRA, ashutoshc, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-03-19T05:41:13.905+0000","updated":"2013-03-19T05:41:13.905+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633126/comment/13606451","id":"13606451","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"hbutani updated the revision \"HIVE-4041 [jira] Support multiple partitionings in a single Query\".\n\n    - Merge branch 'ptf' into HIVE-4041\n    - updates for 4041\n\nReviewers: ashutoshc, JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D9381\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D9381?vs=29775&id=30057#toc\n\nBRANCH\n  HIVE-4041\n\nARCANIST PROJECT\n  hive\n\nAFFECTED FILES\n  data/files/flights_tiny.txt\n  data/files/part.rc\n  data/files/part.seq\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFInvocationSpec.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/WindowingComponentizer.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/WindowingSpec.java\n  ql/src/test/queries/clientpositive/windowing_multipartitioning.q\n  ql/src/test/results/clientpositive/windowing_multipartitioning.q.out\n\nTo: JIRA, ashutoshc, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-03-19T16:17:14.468+0000","updated":"2013-03-19T16:17:14.468+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633126/comment/13606457","id":"13606457","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Ashutosh. I have\n- removed change to ReduceSinkDeDuplication\n- added comments to WindowingComponentizer.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-19T16:18:53.373+0000","updated":"2013-03-19T16:18:53.373+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633126/comment/13607237","id":"13607237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Following negative tests failed:\n* ptf_negative_IncompatibleDistributeClause.q\n* ptf_negative_IncompatibleOrderInWindowDefs.q\n* ptf_negative_IncompatiblePartitionInWindowDefs.q\n* ptf_negative_IncompatibleSortClause.q\n* ptf_negative_InvalidValueBoundary.q","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-20T03:39:29.114+0000","updated":"2013-03-20T03:39:29.114+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633126/comment/13607247","id":"13607247","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"All the +ve tests did pass.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-20T03:59:51.939+0000","updated":"2013-03-20T03:59:51.939+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633126/comment/13607818","id":"13607818","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"hbutani updated the revision \"HIVE-4041 [jira] Support multiple partitionings in a single Query\".\n\n    - remove negative tests, that are valid now; expose underlying error when componentization fails\n\nReviewers: ashutoshc, JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D9381\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D9381?vs=30057&id=30159#toc\n\nBRANCH\n  HIVE-4041\n\nARCANIST PROJECT\n  hive\n\nAFFECTED FILES\n  data/files/flights_tiny.txt\n  data/files/part.rc\n  data/files/part.seq\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFInvocationSpec.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/WindowingComponentizer.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/WindowingSpec.java\n  ql/src/test/queries/clientnegative/ptf_negative_IncompatibleDistributeClause.q\n  ql/src/test/queries/clientnegative/ptf_negative_IncompatibleOrderInWindowDefs.q\n  ql/src/test/queries/clientnegative/ptf_negative_IncompatiblePartitionInWindowDefs.q\n  ql/src/test/queries/clientnegative/ptf_negative_IncompatibleSortClause.q\n  ql/src/test/queries/clientnegative/ptf_negative_InvalidValueBoundary.q\n  ql/src/test/queries/clientpositive/windowing_multipartitioning.q\n  ql/src/test/results/clientnegative/ptf_negative_IncompatibleDistributeClause.q.out\n  ql/src/test/results/clientnegative/ptf_negative_IncompatibleOrderInWindowDefs.q.out\n  ql/src/test/results/clientnegative/ptf_negative_IncompatiblePartitionInWindowDefs.q.out\n  ql/src/test/results/clientnegative/ptf_negative_IncompatibleSortClause.q.out\n  ql/src/test/results/clientnegative/ptf_negative_InvalidValueBoundary.q.out\n  ql/src/test/results/clientpositive/windowing_multipartitioning.q.out\n\nTo: JIRA, ashutoshc, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-03-20T16:29:15.096+0000","updated":"2013-03-20T16:29:15.096+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633126/comment/13607859","id":"13607859","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to branch. Thanks, Harish!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-03-20T17:04:43.480+0000","updated":"2013-03-20T17:04:43.480+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4041/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1i4db:"}}