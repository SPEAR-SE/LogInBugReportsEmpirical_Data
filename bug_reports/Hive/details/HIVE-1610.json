{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12473098","self":"https://issues.apache.org/jira/rest/api/2/issue/12473098","key":"HIVE-1610","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2010-09-02T01:27:24.731+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Sep 08 02:01:48 UTC 2010","customfield_12310420":"42423","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-1610/watchers","watchCount":0,"isWatching":false},"created":"2010-09-02T00:38:37.131+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-09-08T02:01:48.182+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"I have a relatively complicated hive query using CombinedHiveInputFormat:\nset hive.exec.dynamic.partition.mode=nonstrict;\nset hive.exec.dynamic.partition=true; \nset hive.exec.max.dynamic.partitions=1000;\nset hive.exec.max.dynamic.partitions.pernode=300;\nset hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;\nINSERT OVERWRITE TABLE keyword_serp_results_no_dups PARTITION(week) select distinct keywords.keyword, keywords.domain, keywords.url, keywords.rank, keywords.universal_rank, keywords.serp_type, keywords.date_indexed, keywords.search_engine_type, keywords.week from keyword_serp_results keywords JOIN (select domain, keyword, search_engine_type, week, max_date_indexed, min(rank) as best_rank from (select keywords1.domain, keywords1.keyword, keywords1.search_engine_type,  keywords1.week, keywords1.rank, dupkeywords1.max_date_indexed from keyword_serp_results keywords1 JOIN (select domain, keyword, search_engine_type, week, max(date_indexed) as max_date_indexed from keyword_serp_results group by domain,keyword,search_engine_type,week) dupkeywords1 on keywords1.keyword = dupkeywords1.keyword AND  keywords1.domain = dupkeywords1.domain AND keywords1.search_engine_type = dupkeywords1.search_engine_type AND keywords1.week = dupkeywords1.week AND keywords1.date_indexed = dupkeywords1.max_date_indexed) dupkeywords2 group by domain,keyword,search_engine_type,week,max_date_indexed ) dupkeywords3 on keywords.keyword = dupkeywords3.keyword AND  keywords.domain = dupkeywords3.domain AND keywords.search_engine_type = dupkeywords3.search_engine_type AND keywords.week = dupkeywords3.week AND keywords.date_indexed = dupkeywords3.max_date_indexed AND keywords.rank = dupkeywords3.best_rank;\n \nThis query use to work fine until I updated to r991183 on trunk and started getting this error:\n\njava.io.IOException: cannot find dir = hdfs://ec2-75-101-174-245.compute-1.amazonaws.com/tmp/hive-root/hive_2010-09-01_10-57-41_396_1409145025949924904/-mr-10002/000000_0 in \npartToPartitionInfo: [hdfs://ec2-75-101-174-245.compute-1.amazonaws.com:8020/tmp/hive-root/hive_2010-09-01_10-57-41_396_1409145025949924904/-mr-10002,\nhdfs://ec2-75-101-174-245.compute-1.amazonaws.com/user/root/domain_keywords/account=417/week=201035/day=20100829,\nhdfs://ec2-75-101-174-245.compute-1.amazonaws.com/user/root/domain_keywords/account=418/week=201035/day=20100829,\nhdfs://ec2-75-101-174-245.compute-1.amazonaws.com/user/root/domain_keywords/account=419/week=201035/day=20100829,\nhdfs://ec2-75-101-174-245.compute-1.amazonaws.com/user/root/domain_keywords/account=422/week=201035/day=20100829,\nhdfs://ec2-75-101-174-245.compute-1.amazonaws.com/user/root/domain_keywords/account=422/week=201035/day=20100831]\nat org.apache.hadoop.hive.ql.io.HiveFileFormatUtils.getPartitionDescFromPathRecursively(HiveFileFormatUtils.java:277)\nat org.apache.hadoop.hive.ql.io.CombineHiveInputFormat$CombineHiveInputSplit.<init>(CombineHiveInputFormat.java:100)\nat org.apache.hadoop.hive.ql.io.CombineHiveInputFormat.getSplits(CombineHiveInputFormat.java:312)\nat org.apache.hadoop.mapred.JobClient.writeOldSplits(JobClient.java:810)\nat org.apache.hadoop.mapred.JobClient.submitJobInternal(JobClient.java:781)\nat org.apache.hadoop.mapred.JobClient.submitJob(JobClient.java:730)\nat org.apache.hadoop.hive.ql.exec.ExecDriver.execute(ExecDriver.java:610)\nat org.apache.hadoop.hive.ql.exec.MapRedTask.execute(MapRedTask.java:120)\nat org.apache.hadoop.hive.ql.exec.Task.executeTask(Task.java:108)\n\nThis query works if I don't change the hive.input.format.\nset hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;\n\nI've narrowed down this issue to the commit for HIVE-1510.  If I take out the changeset from r987746, everything works as before.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12453658","id":"12453658","filename":"0002-HIVE-1610.-Added-additional-schema-check-to-doGetPar.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sammy.yu","name":"sammy.yu","key":"sammy.yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sammy Yu","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-02T06:08:51.720+0000","size":3311,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12453658/0002-HIVE-1610.-Added-additional-schema-check-to-doGetPar.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12453712","id":"12453712","filename":"0003-HIVE-1610.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sammy.yu","name":"sammy.yu","key":"sammy.yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sammy Yu","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-02T18:51:09.346+0000","size":2653,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12453712/0003-HIVE-1610.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12454032","id":"12454032","filename":"0004-hive.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sammy.yu","name":"sammy.yu","key":"sammy.yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sammy Yu","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-07T17:53:13.334+0000","size":2356,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12454032/0004-hive.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"123239","customfield_12312823":null,"summary":"Using CombinedHiveInputFormat causes partToPartitionInfo IOException  ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sammy.yu","name":"sammy.yu","key":"sammy.yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sammy Yu","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sammy.yu","name":"sammy.yu","key":"sammy.yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sammy Yu","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Hadoop 0.20.2","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473098/comment/12905367","id":"12905367","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"Yes. There is a bug in HiveFileFormatUtils.getPartitionDescFromPathRecursively\n\n{noformat}\n    if (part == null\n        && (dir.toUri().getScheme() == null || dir.toUri().getScheme().trim()\n            .equals(\"\"))) {\n{noformat}\n\nWe need to remove \n{noformat}\n&& (dir.toUri().getScheme() == null || dir.toUri().getScheme().trim()\n            .equals(\"\"))\n{noformat}\n\nSammy, can you help post a fix? You can add a testcase in TestHiveFileFormatUtils.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-02T01:27:24.731+0000","updated":"2010-09-02T01:27:24.731+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473098/comment/12905424","id":"12905424","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sammy.yu","name":"sammy.yu","key":"sammy.yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sammy Yu","active":true,"timeZone":"Etc/UTC"},"body":"You will have to forgive my ignorance since this is my first time looking at Hive source code.\n\nI can validate that removing the additional check on the scheme works, however the original test case in TestHiveFileFormatUtils fails now.    The third assertion in first group fails for testGetPartitionDescFromPathRecursively.\n\nI suspect that the root of the issue is that there is an additional :8020 part in the key of the pathToPartitionInfo table.  With the changes populateNewPartitionDesc would remove everything but the path so that it works.  I am wondering if the best approach is to make doGetPartitionDescFromPath aware of scheme.  I've attached a hack for this approach with the additional test case.  Please note it doesn't know anything about default ports for a given scheme.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sammy.yu","name":"sammy.yu","key":"sammy.yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sammy Yu","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-02T06:08:33.808+0000","updated":"2010-09-02T06:08:33.808+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473098/comment/12905594","id":"12905594","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"1.\njust remove \n{noformat}\n&& (dir.toUri().getScheme() == null || dir.toUri().getScheme().trim()\n            .equals(\"\"))\n{noformat}\n\nwill make things work.\n\n2. you need to use svn (not git) to generate the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-02T17:17:31.796+0000","updated":"2010-09-02T17:17:31.796+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473098/comment/12905635","id":"12905635","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sammy.yu","name":"sammy.yu","key":"sammy.yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sammy Yu","active":true,"timeZone":"Etc/UTC"},"body":"Yongqiang, thanks for taking a look at this.\n\nIf I take out the URI scheme checks, the original TestHiveFileFormatUtils.testGetPartitionDescFromPathRecursively test case fails:\n\n    [junit] Running org.apache.hadoop.hive.ql.io.TestHiveFileFormatUtils\n    [junit] junit.framework.TestListener: tests to run: 2\n    [junit] junit.framework.TestListener: startTest(testGetPartitionDescFromPathRecursively)\n    [junit] junit.framework.TestListener: addFailure(testGetPartitionDescFromPathRecursively, hdfs:///tbl/par1/part2/part3 should return null expected:<true> but was:<false>)\n    [junit] junit.framework.TestListener: endTest(testGetPartitionDescFromPathRecursively)\n    [junit] junit.framework.TestListener: startTest(testGetPartitionDescFromPathWithPort)\n    [junit] junit.framework.TestListener: endTest(testGetPartitionDescFromPathWithPort)\n    [junit] Tests run: 2, Failures: 1, Errors: 0, Time elapsed: 0.091 sec\n    [junit] Test org.apache.hadoop.hive.ql.io.TestHiveFileFormatUtils FAILED\n\nhdfs:///tbl/par1/part2/part3 should not match any PartitionDesc since the path in the map is file:///tbl/par1/part2/part3.  I will attach the svn version of the patch shortly.\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sammy.yu","name":"sammy.yu","key":"sammy.yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sammy Yu","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-02T18:50:49.650+0000","updated":"2010-09-02T18:50:49.650+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473098/comment/12905751","id":"12905751","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"Sammy, the only change in TestHiveFileFormatUtils is to remove URI scheme checks (1 line change). \nYou actually added some lines of code which were removed by HIVE-1510, and this is the reason the testcase fails. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-03T00:52:27.004+0000","updated":"2010-09-03T00:52:27.004+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473098/comment/12906837","id":"12906837","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"Sammy, we can not fix this issue by just removing the schema check. \nIf the input URI's path part is the same with one partition's path, but their schema is different, we should still return NULL.\n\nFor your case, the main problem is the port, which is contained in the partitionDesc but not in the input path.\n\nIs it possible if we just ignore the port? I mean is there a case that two different instances share the same address but use different port?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-07T15:30:08.698+0000","updated":"2010-09-07T15:30:08.698+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473098/comment/12906898","id":"12906898","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sammy.yu","name":"sammy.yu","key":"sammy.yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sammy Yu","active":true,"timeZone":"Etc/UTC"},"body":"He,  yes that's what the original 0002 patch does (it adds an additional check to ignore the port as well as test case for it).   I'm not sure why there's a disparity in the port being there in the first place.  I'll regenerate 0002 patch for svn against trunk@993445.  Thanks!\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sammy.yu","name":"sammy.yu","key":"sammy.yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sammy Yu","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-07T17:51:54.589+0000","updated":"2010-09-07T17:51:54.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473098/comment/12907058","id":"12907058","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"Sammy, there are mainly 2 problems. \n1) going over the map is not efficient, and 2) using startWith to do prefix match is a bug fixed in HIVE-1510.\n\nSammy, can you change the logic as follows:\n\nright now, hive generates another pathToPartitionInfo map by removing the path's schema information, and put it in a cacheMap. \nWe can keep the same logic but change the new pathToPartitionInfo map's value to be an array of PartitionDesc. \nAnd then we can just remove the schema check, and once we get a match, we go through the array of PartitionDesc to find the best one.\n\nthis can also solve another problem. If there are 2 partitionDesc which's path part is same but the schema is different, only one is contained in the new pathToPartitionInfo map. \n\nAbout how to go through the array of PartitionDesc to find the best one:\nif the array contains only 1 element, return array.get(0);\n1) if the original input does not have any schema information:  if the array contains more then 1 element, report error.\n2) if the original input contains schema information: 1) if the array contains an element which's the exact match (also contains schema and port, and the same with input), return the exact match. 2) ignore port part but keep the schema and address, and go through the array. \n\nwhat do you think?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-08T02:01:48.112+0000","updated":"2010-09-08T02:01:48.112+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-1610/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0lfzb:"}}