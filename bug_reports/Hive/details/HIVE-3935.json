{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12629022","self":"https://issues.apache.org/jira/rest/api/2/issue/12629022","key":"HIVE-3935","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-02-01T00:31:15.106+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Feb 01 00:43:35 UTC 2013","customfield_12310420":"308640","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-3935/watchers","watchCount":3,"isWatching":false},"created":"2013-01-24T08:09:09.904+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317742","id":"12317742","description":"released","name":"0.9.0","archived":false,"released":true,"releaseDate":"2012-04-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12320745","id":"12320745","description":"released","name":"0.10.0","archived":false,"released":true,"releaseDate":"2013-01-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-02-01T00:43:35.660+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"When a \"select distinct\" command is issued on empty table which uses sequence file for storage, a new extra line (0x0a) is present in the result set even when table has no data. This output is not consistent with result of same command Hive 0.7.1 and can cause workflows to fail due to wrong record count.\n\nExecution on Hive 0.9 and 0.10\nhive> create table hoge2(col1 string,col2 string) partitioned by (p_part\nstring) stored as sequencefile;\nhive> describe hoge2;\nOK\ncol1    string\ncol2    string\np_part  string\nTime taken: 0.24 seconds\nhive> select distinct p_part from hoge2;\nTotal MapReduce jobs = 1\nLaunching Job 1 out of 1\nNumber of reduce tasks not specified. Estimated from input data size: 1\nIn order to change the average load for a reducer (in bytes):\n  set hive.exec.reducers.bytes.per.reducer=<number>\nIn order to limit the maximum number of reducers:\n  set hive.exec.reducers.max=<number>\nIn order to set a constant number of reducers:\n  set mapred.reduce.tasks=<number>\nStarting Job = job_201301230112_0001, Tracking URL =\nhttp://testcluster2-1:50030/jobdetails.jsp?jobid=job_201301230112_0001\nKill Command = /opt/mapr/hadoop/hadoop-0.20.2/bin/../bin/hadoop job \n-Dmapred.job.tracker=maprfs:/// -kill job_201301230112_0001\nHadoop job information for Stage-1: number of mappers: 1; number of reducers: 1\n2013-01-23 02:50:16,843 Stage-1 map = 0%,  reduce = 0%\n2013-01-23 02:50:26,897 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.13\nsec\n2013-01-23 02:50:27,905 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.13\nsec\n2013-01-23 02:50:28,911 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.13\nsec\n2013-01-23 02:50:29,919 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.13\nsec\n2013-01-23 02:50:30,925 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.13\nsec\n2013-01-23 02:50:31,933 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.13\nsec\n2013-01-23 02:50:32,939 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.13\nsec\n2013-01-23 02:50:33,945 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 1.8\nsec\nMapReduce Total cumulative CPU time: 1 seconds 800 msec\nEnded Job = job_201301230112_0001\nMapReduce Jobs Launched:\nJob 0: Map: 1  Reduce: 1   Cumulative CPU: 1.8 sec   MAPRFS Read: 327 MAPRFS\nWrite: 71 SUCCESS\nTotal MapReduce CPU Time Spent: 1 seconds 800 msec\nOK\n\nTime taken: 21.94 seconds\n\nResult on Hive 0.7.1\nhive> select count(distinct p_part) from hoge3;\nTotal MapReduce jobs = 1\nLaunching Job 1 out of 1\nNumber of reduce tasks determined at compile time: 1\nIn order to change the average load for a reducer (in bytes):\n  set hive.exec.reducers.bytes.per.reducer=<number>\nIn order to limit the maximum number of reducers:\n  set hive.exec.reducers.max=<number>\nIn order to set a constant number of reducers:\n  set mapred.reduce.tasks=<number>\nStarting Job = job_201210261659_0019, Tracking URL =\nhttp://testcluster1-1:50030/jobdetails.jsp?jobid=job_201210261659_0019\nKill Command = /opt/mapr/hadoop/hadoop-0.20.2/bin/../bin/hadoop job \n-Dmapred.job.tracker=maprfs:/// -kill job_201210261659_0019\n2013-01-23 21:42:01,787 Stage-1 map = 0%,  reduce = 0%\n2013-01-23 21:42:07,815 Stage-1 map = 100%,  reduce = 0%\n2013-01-23 21:42:12,835 Stage-1 map = 100%,  reduce = 100%\nEnded Job = job_201210261659_0019\nOK\n0\nTime taken: 16.637 seconds\n\nUnderlying Hadoop version for Hive 0.9 is Hadoop 1.0.3 and for Hive 0.7 it is 0.20.203","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12567468","id":"12567468","filename":"HIVE-3935-0.9.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adityakishore","name":"adityakishore","key":"adityakishore","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Aditya Kishore","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-01T00:43:35.646+0000","size":1121,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12567468/HIVE-3935-0.9.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"282492","customfield_12312823":null,"summary":"New line character in output when sequence file is used for storage and table is empty","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doodlegum","name":"doodlegum","key":"doodlegum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhinav Chawade","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doodlegum","name":"doodlegum","key":"doodlegum","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Abhinav Chawade","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Centos 6.3","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629022/comment/13568289","id":"13568289","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adityakishore","name":"adityakishore","key":"adityakishore","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Aditya Kishore","active":true,"timeZone":"America/Los_Angeles"},"body":"The reason for the difference in behavior between 0.7 and 0.9 is different default InputFormat used.\n\nHaving said that, the root cause is that the query planner detects this scan query on virtual column as meta only scan and converts the scan operation on the partition to meta only scan and sets {{OneNullRowInputFormat}} as the partition's InputFormat, which *always* emits exactly one row irrespective of whether a partition exists or not.\n\nAnd this one row (null) is sent to mapper as input which forward this to reducer and eventually to query result.\n\nA temporary fix for this problem is to disable MetadataOnlyOptimizer in hive-site.xml.\n\n{code}\n<property>\n  <name>hive.optimize.metadataonly</name>\n  <value>false</value>\n</property>\n{code}\n\nThough this has some performance penalty in certain cases, it is better than reverting to HiveInputFormat.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adityakishore","name":"adityakishore","key":"adityakishore","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Aditya Kishore","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-01T00:31:15.106+0000","updated":"2013-02-01T00:31:15.106+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12629022/comment/13568303","id":"13568303","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adityakishore","name":"adityakishore","key":"adityakishore","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Aditya Kishore","active":true,"timeZone":"America/Los_Angeles"},"body":"Attaching a proposed patch where, if the partition descriptor is empty, use the table's InputFormat Class as the InputFormat Class for the split.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adityakishore","name":"adityakishore","key":"adityakishore","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10450","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"},"displayName":"Aditya Kishore","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-01T00:43:35.650+0000","updated":"2013-02-01T00:43:35.650+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-3935/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1cqx3:"}}