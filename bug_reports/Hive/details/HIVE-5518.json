{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12673340","self":"https://issues.apache.org/jira/rest/api/2/issue/12673340","key":"HIVE-5518","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-10-11T04:52:48.436+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Oct 11 17:49:34 UTC 2013","customfield_12310420":"352963","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5518/watchers","watchCount":9,"isWatching":false},"created":"2013-10-11T00:15:56.352+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324312","id":"12324312","description":"released","name":"0.12.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-10-11T17:49:34.710+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313604","id":"12313604","name":"CLI","description":"Command-line interpreter for Hive.\n"}],"timeoriginalestimate":null,"description":"Jars referenced in {{ADD JAR}} statements are not made available on the immediate classpath. That means they're useless for scripts which need to initialize external output formats for job submission (ie, hbase storage handler). Is this expected behavior?\n\nFor example, the table 'pagecounts_hbase' is an hbase table defined using the HBaseStorageHandler\n\n{noformat}\n$ cat foo.hql\nADD FILE /etc/hbase/conf/hbase-site.xml;\nADD JAR /usr/lib/hbase/lib/hbase-common-0.96.0.2.0.6.0-68-hadoop2.jar;\nADD JAR /usr/lib/hbase/lib/hbase-server-0.96.0.2.0.6.0-68-hadoop2.jar;\nADD JAR /usr/lib/hbase/lib/hbase-client-0.96.0.2.0.6.0-68-hadoop2.jar;\nADD JAR /usr/lib/hbase/lib/hbase-protocol-0.96.0.2.0.6.0-68-hadoop2.jar;\n\nFROM pgc INSERT INTO TABLE pagecounts_hbase SELECT pgc.* WHERE rowkey LIKE 'en/q%' LIMIT 10;\n$ hive -f foo.hql\n...\nAdded resource: /etc/hbase/conf/hbase-site.xml\nAdded /usr/lib/hbase/lib/hbase-common-0.96.0.2.0.6.0-68-hadoop2.jar to class path\nAdded resource: /usr/lib/hbase/lib/hbase-common-0.96.0.2.0.6.0-68-hadoop2.jar\n...\nException in thread \"main\" java.lang.NoClassDefFoundError: org/apache/hadoop/hbase/mapreduce/TableInputFormatBase                                                                                [29/1858]\n        at java.lang.ClassLoader.defineClass1(Native Method)\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:791)\n        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)\n        at java.net.URLClassLoader.defineClass(URLClassLoader.java:449)\n        at java.net.URLClassLoader.access$100(URLClassLoader.java:71)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:361)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:355)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:354)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:423)\n        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:410)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:410)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:410)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:410)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:410)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:410)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:356)\n        at java.lang.Class.forName0(Native Method)\n        at java.lang.Class.forName(Class.java:266)\n        at org.apache.hadoop.hive.ql.metadata.Table.getInputFormatClass(Table.java:305)\n        at org.apache.hadoop.hive.ql.metadata.Table.<init>(Table.java:98)\n        at org.apache.hadoop.hive.ql.metadata.Hive.getTable(Hive.java:989)\n        at org.apache.hadoop.hive.ql.metadata.Hive.getTable(Hive.java:892)\n        at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer$tableSpec.<init>(BaseSemanticAnalyzer.java:730)\n        at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer$tableSpec.<init>(BaseSemanticAnalyzer.java:707)\n        at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.getMetaData(SemanticAnalyzer.java:1196)\n        at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.getMetaData(SemanticAnalyzer.java:1053)\n        at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:8342)\n        at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:284)\n        at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:441)\n        at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:342)\n        at org.apache.hadoop.hive.ql.Driver.runInternal(Driver.java:977)\n        at org.apache.hadoop.hive.ql.Driver.run(Driver.java:888)\n        at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:259)\n        at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:216)\n        at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:413)\n        at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:348)\n        at org.apache.hadoop.hive.cli.CliDriver.processReader(CliDriver.java:446)\n        at org.apache.hadoop.hive.cli.CliDriver.processFile(CliDriver.java:456)\n        at org.apache.hadoop.hive.cli.CliDriver.executeDriver(CliDriver.java:737)\n        at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:675)\n        at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:614)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:601)\n        at org.apache.hadoop.util.RunJar.main(RunJar.java:212)\nCaused by: java.lang.ClassNotFoundException: org.apache.hadoop.hbase.mapreduce.TableInputFormatBase\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:366)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:355)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:354)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:423)\n        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:356)\n        ... 48 more\n{noformat}\n\nThe ADDed jar hbase-server.jar contains the missing class:\n\n{noformat}\n$ unzip -l /usr/lib/hbase/lib/hbase-server-0.96.0.2.0.6.0-68-hadoop2.jar | grep TableInputFormatBase\n     5363  10-09-2013 19:45   org/apache/hadoop/hbase/mapred/TableInputFormatBase.class\n     7460  10-09-2013 19:45   org/apache/hadoop/hbase/mapreduce/MultiTableInputFormatBase.class\n     8803  10-09-2013 19:45   org/apache/hadoop/hbase/mapreduce/TableInputFormatBase.class\n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"353250","customfield_12312823":null,"summary":"ADD JAR should add entries to local classpath","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12673340/comment/13792331","id":"13792331","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=appodictic","name":"appodictic","key":"appodictic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Capriolo","active":true,"timeZone":"Etc/UTC"},"body":"Lets look into this. I do not see a reason why the auxpath and add jar list can not be combined. It sure would make many things easier.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=appodictic","name":"appodictic","key":"appodictic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Capriolo","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-11T04:52:48.436+0000","updated":"2013-10-11T04:52:48.436+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12673340/comment/13792795","id":"13792795","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. It sure would make many things easier.\n\n+1\n\nThe combination of auxpath, classpath, and jar list makes this stuff pretty opaque. How do each of these impact the operations I want to run, which omissions cause immediate failure and which won't fail until I'm into the 3rd job in my plan? Seems most people I talk to populate their jars everywhere and cross their fingers.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-10-11T16:53:09.853+0000","updated":"2013-10-11T16:53:09.853+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12673340/comment/13792844","id":"13792844","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=appodictic","name":"appodictic","key":"appodictic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Capriolo","active":true,"timeZone":"Etc/UTC"},"body":"Anecdotally. Anything required as part of an input format needs to be on the aux_path. They are needed to read the data, where as UDFs need not be on the aux_path as they are used inside operators. It would be great if we could unify these concepts without making the classpath needed to launch every job very large. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=appodictic","name":"appodictic","key":"appodictic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Capriolo","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-11T17:30:04.045+0000","updated":"2013-10-11T17:30:04.045+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12673340/comment/13792867","id":"13792867","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"body":"For mapreduce jobs involving HBase, we expect the client classpath will contain all of the necessary jars. We have a utility for determining which should be shipped to the cluster based on job parameters ([TableMapReduceUtils#addDependencyJars|https://github.com/apache/hbase/blob/a6c89bac930216c1afc0ce2d6b518f3eb690ab31/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java#L519-L584]). The user can also explicitly call these methods to add additional jars by a contained class.\n\nIMHO, it would be nice if a Hive user didn't have to distinguish between jars needed locally and jars needed by the jobs. Just toss them all in and let the system sort it out.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-10-11T17:47:57.924+0000","updated":"2013-10-11T17:47:57.924+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12673340/comment/13792871","id":"13792871","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"body":"A related question: what's the precise behavior of using {{ADD JAR}} ? Does it copy the file from the client local machine up to the job's distributed cache and include it on the task classpaths?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ndimiduk","name":"ndimiduk","key":"ndimiduk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ndimiduk&avatarId=17533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ndimiduk&avatarId=17533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ndimiduk&avatarId=17533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ndimiduk&avatarId=17533"},"displayName":"Nick Dimiduk","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-10-11T17:49:34.710+0000","updated":"2013-10-11T17:49:34.710+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5518/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1ouqv:"}}