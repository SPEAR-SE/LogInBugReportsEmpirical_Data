{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12633522","self":"https://issues.apache.org/jira/rest/api/2/issue/12633522","key":"HIVE-4051","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324312","id":"12324312","description":"released","name":"0.12.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-07-20T00:58:43.522+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Oct 15 23:30:21 UTC 2013","customfield_12310420":"314017","customfield_12312320":null,"customfield_12310222":"10002_*:*_2_*:*_1028212344_*|*_1_*:*_3_*:*_13328877729_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-08-07T05:30:29.855+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4051/watchers","watchCount":16,"isWatching":false},"created":"2013-02-22T01:25:39.816+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"9.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12385278","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12385278","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12675308","key":"HIVE-5626","self":"https://issues.apache.org/jira/rest/api/2/issue/12675308","fields":{"summary":"enable metastore direct SQL for drop/similar queries","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}},{"id":"12385275","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12385275","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12688444","key":"HIVE-6188","self":"https://issues.apache.org/jira/rest/api/2/issue/12688444","fields":{"summary":"Document hive.metastore.try.direct.sql & hive.metastore.try.direct.sql.ddl","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}},{"id":"12385274","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12385274","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12662706","key":"HIVE-5029","self":"https://issues.apache.org/jira/rest/api/2/issue/12662706","fields":{"summary":"direct SQL perf optimization cannot be tested well","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/6","id":"6","description":"A new unit, integration or system test.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/requirement.png","name":"Test","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-03-25T07:28:19.969+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312587","id":"12312587","name":"Clients","description":"Tracks issues dealing with CLI, Webclient, JDBC clients or other such clients."},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312584","id":"12312584","name":"Metastore","description":"Tracks issue dealing with metastore."}],"timeoriginalestimate":null,"description":"Hive's query client takes a long time to initialize & start planning queries because of delays in creating all the MTable/MPartition objects.\n\nFor a hive db with 1800 partitions, the metastore took 6-7 seconds to initialize - firing approximately 5900 queries to the mysql database.\n\nSeveral of those queries fetch exactly one row to create a single object on the client.\n\nThe following 12 queries were repeated for each partition, generating a storm of SQL queries \n\n{code}\n4 Query     SELECT `A0`.`SD_ID`,`B0`.`INPUT_FORMAT`,`B0`.`IS_COMPRESSED`,`B0`.`IS_STOREDASSUBDIRECTORIES`,`B0`.`LOCATION`,`B0`.`NUM_BUCKETS`,`B0`.`OUTPUT_FORMAT`,`B0`.`SD_ID` FROM `PARTITIONS` `A0` LEFT OUTER JOIN `SDS` `B0` ON `A0`.`SD_ID` = `B0`.`SD_ID` WHERE `A0`.`PART_ID` = 3945\n4 Query     SELECT `A0`.`CD_ID`,`B0`.`CD_ID` FROM `SDS` `A0` LEFT OUTER JOIN `CDS` `B0` ON `A0`.`CD_ID` = `B0`.`CD_ID` WHERE `A0`.`SD_ID` =4871\n4 Query     SELECT COUNT(*) FROM `COLUMNS_V2` THIS WHERE THIS.`CD_ID`=1546 AND THIS.`INTEGER_IDX`>=0\n4 Query     SELECT `A0`.`COMMENT`,`A0`.`COLUMN_NAME`,`A0`.`TYPE_NAME`,`A0`.`INTEGER_IDX` AS NUCORDER0 FROM `COLUMNS_V2` `A0` WHERE `A0`.`CD_ID` = 1546 AND `A0`.`INTEGER_IDX` >= 0 ORDER BY NUCORDER0\n4 Query     SELECT `A0`.`SERDE_ID`,`B0`.`NAME`,`B0`.`SLIB`,`B0`.`SERDE_ID` FROM `SDS` `A0` LEFT OUTER JOIN `SERDES` `B0` ON `A0`.`SERDE_ID` = `B0`.`SERDE_ID` WHERE `A0`.`SD_ID` =4871\n4 Query     SELECT COUNT(*) FROM `SORT_COLS` THIS WHERE THIS.`SD_ID`=4871 AND THIS.`INTEGER_IDX`>=0\n4 Query     SELECT `A0`.`COLUMN_NAME`,`A0`.`ORDER`,`A0`.`INTEGER_IDX` AS NUCORDER0 FROM `SORT_COLS` `A0` WHERE `A0`.`SD_ID` =4871 AND `A0`.`INTEGER_IDX` >= 0 ORDER BY NUCORDER0\n4 Query     SELECT COUNT(*) FROM `SKEWED_VALUES` THIS WHERE THIS.`SD_ID_OID`=4871 AND THIS.`INTEGER_IDX`>=0\n4 Query     SELECT 'org.apache.hadoop.hive.metastore.model.MStringList' AS NUCLEUS_TYPE,`A1`.`STRING_LIST_ID`,`A0`.`INTEGER_IDX` AS NUCORDER0 FROM `SKEWED_VALUES` `A0` INNER JOIN `SKEWED_STRING_LIST` `A1` ON `A0`.`STRING_LIST_ID_EID` = `A1`.`STRING_LIST_ID` WHERE `A0`.`SD_ID_OID` =4871 AND `A0`.`INTEGER_IDX` >= 0 ORDER BY NUCORDER0\n4 Query     SELECT COUNT(*) FROM `SKEWED_COL_VALUE_LOC_MAP` WHERE `SD_ID` =4871 AND `STRING_LIST_ID_KID` IS NOT NULL\n4 Query     SELECT 'org.apache.hadoop.hive.metastore.model.MStringList' AS NUCLEUS_TYPE,`A0`.`STRING_LIST_ID` FROM `SKEWED_STRING_LIST` `A0` INNER JOIN `SKEWED_COL_VALUE_LOC_MAP` `B0` ON `A0`.`STRING_LIST_ID` = `B0`.`STRING_LIST_ID_KID` WHERE `B0`.`SD_ID` =4871\n4 Query     SELECT `A0`.`STRING_LIST_ID_KID`,`A0`.`LOCATION` FROM `SKEWED_COL_VALUE_LOC_MAP` `A0` WHERE `A0`.`SD_ID` =4871 AND NOT (`A0`.`STRING_LIST_ID_KID` IS NULL)\n{code}\n\nThis data is not detached or cached, so this operation is performed during every query plan for the partitions, even in the same hive client.\n\nThe queries are automatically generated by JDO/DataNucleus which makes it nearly impossible to rewrite it into a single denormalized join operation & process it locally.\n\nAttempts to optimize this with JDO fetch-groups did not bear fruit in improving the query count.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12594063","id":"12594063","filename":"HIVE-4051.D11805.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-24T23:53:46.598+0000","size":36856,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12594063/HIVE-4051.D11805.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12594511","id":"12594511","filename":"HIVE-4051.D11805.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-27T02:53:46.916+0000","size":37616,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12594511/HIVE-4051.D11805.2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12595072","id":"12595072","filename":"HIVE-4051.D11805.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-30T23:29:48.250+0000","size":179986,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12595072/HIVE-4051.D11805.3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12595079","id":"12595079","filename":"HIVE-4051.D11805.4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-30T23:53:48.044+0000","size":185778,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12595079/HIVE-4051.D11805.4.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12595110","id":"12595110","filename":"HIVE-4051.D11805.5.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-31T02:33:47.384+0000","size":186200,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12595110/HIVE-4051.D11805.5.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12595477","id":"12595477","filename":"HIVE-4051.D11805.6.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-01T20:37:48.016+0000","size":40725,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12595477/HIVE-4051.D11805.6.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12595725","id":"12595725","filename":"HIVE-4051.D11805.7.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-03T02:35:48.487+0000","size":44334,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12595725/HIVE-4051.D11805.7.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12596239","id":"12596239","filename":"HIVE-4051.D11805.8.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-05T23:33:50.362+0000","size":52059,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12596239/HIVE-4051.D11805.8.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12596257","id":"12596257","filename":"HIVE-4051.D11805.9.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-06T01:09:48.470+0000","size":52064,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12596257/HIVE-4051.D11805.9.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"314362","customfield_12312823":null,"summary":"Hive's metastore suffers from 1+N queries when querying partitions & is slow","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gopalv","name":"gopalv","key":"gopalv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gopal V","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gopalv","name":"gopalv","key":"gopalv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gopal V","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"RHEL 6.3 / EC2 C1.XL","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13714281","id":"13714281","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"I am actually getting 16 queries... 3 by PART_ID (itself, values, params), 10 per its SD_ID, 2 for SD_ID_OID (might also be SD_ID?), and 1 for SERDE.\nSome normalization doesn't make any sense, e.g.\n{code}\nmysql> select name, slib, count(1) from SERDES;\n+------+----------------------------------------------------+----------+\n| name | slib                                               | count(1) |\n+------+----------------------------------------------------+----------+\n| NULL | org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe |    32769 |\n+------+----------------------------------------------------+----------+\n{code}\nif stored for each row 1-on-1 anyway, why not just store it in the row?\n\nI am looking in the direction of doing a full-string query returning a bag of fields, rather than MPartition, so that per-object calls are not done. Then SDs can be fetched with join, etc.\nOne thing that is not quite clear is how to do fetch from separate tables for which DN object doesn't exist e.g. PARTITION_KEY_VALS. Ideally we would fetch all of these for all necessary partitions in one query and put them into objects.\n\nIf all else fails we can use SQL http://www.datanucleus.org/products/datanucleus/jdo/sql.html, but it will halfway defeat the purpose of having DN in the first place, since it becomes RDBMS-dependent.\n\nIn fact to avoid warring with datanucleus perhaps we could do SQL as storage-specific optimization, configurable for metastore, and fall back to ORM if disabled.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-20T00:58:43.522+0000","updated":"2013-07-20T00:58:43.522+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13719045","id":"13719045","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"sershe requested code review of \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\nReviewers: JIRA\n\nPreliminary patch for HIVE-4051 (ready for review).\nThis introduces \"direct SQL\" optimization for metastore.\nWhen memstore gets partitions by filter or by names, it does so using ANSI SQL92 queries, if enabled (default).\nThis will not work on non-RDBMS datastores, may not work on non-ANSI-compiant ones (I tested on mysql in default mode).\nIf disabled, or if any error happens, it will use the default DataNucleus code.\nWhen it does work, which is most practical cases, with local mysql it produces up to x20 speedup for getting large number of partitions.\nSQL queries can be further optimized to achieve even more, presumably - see some comments in the code. That will be done as separate JIRAs.\n\nSo far the patch has no tests, because it is peculiar to the storage engine, so I need to look if derby test makes sense.\nAnother question is whether it makes sense to put SQL antics into separate class.\nLet me run HIVE QA (some test have run on local). After discussion I will update the patch, but the core is ready for review.\n\n\nHive's query client takes a long time to initialize & start planning queries because of delays in creating all the MTable/MPartition objects.\n\nFor a hive db with 1800 partitions, the metastore took 6-7 seconds to initialize - firing approximately 5900 queries to the mysql database.\n\nSeveral of those queries fetch exactly one row to create a single object on the client.\n\nThe following 12 queries were repeated for each partition, generating a storm of SQL queries\n\n4 Query     SELECT `A0`.`SD_ID`,`B0`.`INPUT_FORMAT`,`B0`.`IS_COMPRESSED`,`B0`.`IS_STOREDASSUBDIRECTORIES`,`B0`.`LOCATION`,`B0`.`NUM_BUCKETS`,`B0`.`OUTPUT_FORMAT`,`B0`.`SD_ID` FROM `PARTITIONS` `A0` LEFT OUTER JOIN `SDS` `B0` ON `A0`.`SD_ID` = `B0`.`SD_ID` WHERE `A0`.`PART_ID` = 3945\n4 Query     SELECT `A0`.`CD_ID`,`B0`.`CD_ID` FROM `SDS` `A0` LEFT OUTER JOIN `CDS` `B0` ON `A0`.`CD_ID` = `B0`.`CD_ID` WHERE `A0`.`SD_ID` =4871\n4 Query     SELECT COUNT(*) FROM `COLUMNS_V2` THIS WHERE THIS.`CD_ID`=1546 AND THIS.`INTEGER_IDX`>=0\n4 Query     SELECT `A0`.`COMMENT`,`A0`.`COLUMN_NAME`,`A0`.`TYPE_NAME`,`A0`.`INTEGER_IDX` AS NUCORDER0 FROM `COLUMNS_V2` `A0` WHERE `A0`.`CD_ID` = 1546 AND `A0`.`INTEGER_IDX` >= 0 ORDER BY NUCORDER0\n4 Query     SELECT `A0`.`SERDE_ID`,`B0`.`NAME`,`B0`.`SLIB`,`B0`.`SERDE_ID` FROM `SDS` `A0` LEFT OUTER JOIN `SERDES` `B0` ON `A0`.`SERDE_ID` = `B0`.`SERDE_ID` WHERE `A0`.`SD_ID` =4871\n4 Query     SELECT COUNT(*) FROM `SORT_COLS` THIS WHERE THIS.`SD_ID`=4871 AND THIS.`INTEGER_IDX`>=0\n4 Query     SELECT `A0`.`COLUMN_NAME`,`A0`.`ORDER`,`A0`.`INTEGER_IDX` AS NUCORDER0 FROM `SORT_COLS` `A0` WHERE `A0`.`SD_ID` =4871 AND `A0`.`INTEGER_IDX` >= 0 ORDER BY NUCORDER0\n4 Query     SELECT COUNT(*) FROM `SKEWED_VALUES` THIS WHERE THIS.`SD_ID_OID`=4871 AND THIS.`INTEGER_IDX`>=0\n4 Query     SELECT 'org.apache.hadoop.hive.metastore.model.MStringList' AS NUCLEUS_TYPE,`A1`.`STRING_LIST_ID`,`A0`.`INTEGER_IDX` AS NUCORDER0 FROM `SKEWED_VALUES` `A0` INNER JOIN `SKEWED_STRING_LIST` `A1` ON `A0`.`STRING_LIST_ID_EID` = `A1`.`STRING_LIST_ID` WHERE `A0`.`SD_ID_OID` =4871 AND `A0`.`INTEGER_IDX` >= 0 ORDER BY NUCORDER0\n4 Query     SELECT COUNT(*) FROM `SKEWED_COL_VALUE_LOC_MAP` WHERE `SD_ID` =4871 AND `STRING_LIST_ID_KID` IS NOT NULL\n4 Query     SELECT 'org.apache.hadoop.hive.metastore.model.MStringList' AS NUCLEUS_TYPE,`A0`.`STRING_LIST_ID` FROM `SKEWED_STRING_LIST` `A0` INNER JOIN `SKEWED_COL_VALUE_LOC_MAP` `B0` ON `A0`.`STRING_LIST_ID` = `B0`.`STRING_LIST_ID_KID` WHERE `B0`.`SD_ID` =4871\n4 Query     SELECT `A0`.`STRING_LIST_ID_KID`,`A0`.`LOCATION` FROM `SKEWED_COL_VALUE_LOC_MAP` `A0` WHERE `A0`.`SD_ID` =4871 AND NOT (`A0`.`STRING_LIST_ID_KID` IS NULL)\n\nThis data is not detached or cached, so this operation is performed during every query plan for the partitions, even in the same hive client.\n\nThe queries are automatically generated by JDO/DataNucleus which makes it nearly impossible to rewrite it into a single denormalized join operation & process it locally.\n\nAttempts to optimize this with JDO fetch-groups did not bear fruit in improving the query count.\n\nTEST PLAN\n  EMPTY\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nAFFECTED FILES\n  build.xml\n  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java\n  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java\n\nMANAGE HERALD RULES\n  https://reviews.facebook.net/herald/view/differential/\n\nWHY DID I GET THIS EMAIL?\n  https://reviews.facebook.net/herald/transcript/28047/\n\nTo: JIRA, sershe\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-24T23:53:46.473+0000","updated":"2013-07-24T23:53:46.473+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13719782","id":"13719782","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 at least one tests failed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12594063/HIVE-4051.D11805.1.patch\n\n{color:red}ERROR:{color} -1 due to 230 failed/errored test(s), 2651 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_drop_multi_partitions\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_sort_merge_join_desc_6\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_multi7\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_quote1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_nullgroup5\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_escape1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin2\norg.apache.hadoop.hive.metastore.TestRemoteHiveMetaStore.testFilterSinglePartition\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part10\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part5\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_mapjoin_hook\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_8\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_map_ppr\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_insert4\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_part\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin_19\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_bitmap_rc\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_filter_join_breaktask\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union_ppr\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union_lateralview\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_auto_join9\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppr_pushdown2\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_hook_context_cs\norg.apache.hcatalog.listener.TestNotificationListener.testAMQListener\norg.apache.hcatalog.pig.TestHCatStorer.testPartColsInData\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin_12\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part6\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge_dynamic_partition\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_insert_into2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppr_pushdown\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin_11\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_mapjoin_distinct\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats10\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat7\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_compact_2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_sort_merge_join_desc_5\norg.apache.hcatalog.pig.TestHCatLoader.testReadPartitionedBasic\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part0\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_partitioned\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_multi2\norg.apache.hcatalog.mapreduce.TestHCatPartitioned.testHCatPartitionedTable\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin_10\norg.apache.hadoop.hive.metastore.TestRemoteHiveMetaStore.testPartitionFilter\norg.apache.hadoop.hive.metastore.TestSetUGIOnBothClientServer.testFilterSinglePartition\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter5\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_drop_partitions_ignore_protection\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union_view\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part5\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_7\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_nonmr_fetch\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input25\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union26\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_transform_ppr2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge_dynamic_partition5\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_auto_join25\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_serde_format\norg.apache.hadoop.hive.metastore.TestEmbeddedHiveMetaStore.testPartitionFilter\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin_20\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_disallow_incompatible_type_change_on2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_lock2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge_dynamic_partition2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_6\norg.apache.hadoop.hive.ql.parse.TestParse.testParse_input_part1\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_partspec5\norg.apache.hadoop.hive.metastore.TestEmbeddedHiveMetaStore.testFilterLastPartition\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_multi1\norg.apache.hcatalog.pig.TestOrcHCatLoader.testReadPartitionedBasic\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_filter_join_breaktask2\norg.apache.hadoop.hive.metastore.TestSetUGIOnOnlyServer.testPartitionFilter\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_authorization_2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin12\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin_18\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_bitmap_auto_partitioned\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_alter_partition_offline\norg.apache.hadoop.hive.metastore.TestSetUGIOnOnlyClient.testFilterLastPartition\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter_partition_protect_mode\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_insert2_overwrite_partitions\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_global_limit\norg.apache.hadoop.hive.ql.parse.TestParse.testParse_sample1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_router_join_ppr\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_truncate_column\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_compact\norg.apache.hadoop.hive.metastore.TestEmbeddedHiveMetaStore.testFilterSinglePartition\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge_dynamic_partition4\norg.apache.hadoop.hive.metastore.TestSetUGIOnOnlyServer.testFilterLastPartition\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_sample1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_mi\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_fail_5\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input42\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter_merge_2\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_protectmode_tbl7\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_inputddl7\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_partspec2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_archive_multi\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_create_or_replace_view\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge4\norg.apache.hcatalog.mapreduce.TestHCatDynamicPartitioned.testHCatDynamicPartitionedTableMultipleTask\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_dynamic_partitions_with_whitelist\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin8\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin_21\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_bitmap\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin9\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input28\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_insertexternal1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part9\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppr_allchildsarenull\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_sa_fail_hook3\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_sample8\norg.apache.hcatalog.mapreduce.TestHCatHiveThriftCompatibility.testDynamicCols\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_multi4\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_5\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_join14_hadoop20\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part2\norg.apache.hadoop.hive.metastore.TestSetUGIOnBothClientServer.testPartitionFilter\norg.apache.hadoop.hive.metastore.TestSetUGIOnBothClientServer.testFilterLastPartition\norg.apache.hadoop.hive.metastore.TestSetUGIOnOnlyServer.testFilterSinglePartition\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_mult_tables\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_protectmode\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_lock4\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_union22\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_protectmode_part\norg.apache.hcatalog.fileformats.TestOrcDynamicPartitioned.testHCatDynamicPartitionedTable\norg.apache.hcatalog.fileformats.TestOrcDynamicPartitioned.testHCatDynamicPartitionedTableMultipleTask\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_rename_external_partition_location\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partitions_json\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_partspec1\norg.apache.hadoop.hive.metastore.TestSetUGIOnOnlyClient.testFilterSinglePartition\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_truncate_table\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_noscan_2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_4\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_ppr_multi_distinct\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_inputddl6\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_pcr\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_partspec3\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppd2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_sort_6\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_alter_partition_nodrop\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_fail_4\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin_negative\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_multi3\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_rand_partitionpruner2\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_multi6\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_rcfile_merge1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats3\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_insert1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_unused\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter3\norg.apache.hadoop.hive.metastore.TestMetaStoreEventListener.testListener\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_disallow_incompatible_type_change_on1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppd_union_view\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input40\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_map_ppr_multi_distinct\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin3\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_louter_join_ppr\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter_partition_coltype\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucket_groupby\norg.apache.hadoop.hive.ql.security.TestAuthorizationPreEventListener.testListener\norg.apache.hcatalog.security.TestHdfsAuthorizationProvider.testAddDropPartition\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_fail_3\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_stale_partitioned\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part2\norg.apache.hcatalog.security.TestHdfsAuthorizationProvider.testDropPartitionFail2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucket3\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_auto_join14_hadoop20\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_insert2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part7\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_partspec4\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_insert1_overwrite_partitions\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats11\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_concatenate_inherit_table_location\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_disallow_incompatible_type_change_off\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input26\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_loadpart1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_lock3\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_create_view_partitioned\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_join9\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_sort_8\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_protectmode_part_no_drop\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_multi5\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union25\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input24\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part11\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auth\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_lockneg4\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union22\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_3\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_touch\norg.apache.hcatalog.api.TestHCatClient.testGetPartitionsWithPartialSpec\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_combine3\norg.apache.hadoop.hive.metastore.TestSetUGIOnOnlyClient.testPartitionFilter\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_bucket_mapjoin_mismatch1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_rename_partition_location\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_sort_7\norg.apache.hcatalog.api.TestHCatClient.testPartitionsHCatClientImpl\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part8\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_auto_join19\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input39_hadoop20\norg.apache.hcatalog.mapreduce.TestHCatDynamicPartitioned.testHCatDynamicPartitionedTable\norg.apache.hcatalog.security.TestHdfsAuthorizationProvider.testDropPartitionFail1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_updateAccessTime\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_drop_partitions_filter\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_database_drop\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_mult_tables_compact\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_insert3\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat4\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_protectmode_tbl8\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input23\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part7\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin13\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin1\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_lockneg3\norg.apache.hcatalog.pig.TestHCatStorer.testStoreInPartiitonedTbl\norg.apache.hcatalog.mapreduce.TestHCatHiveCompatibility.testPartedRead\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_view_cast\norg.apache.hadoop.hive.metastore.TestRemoteHiveMetaStore.testFilterLastPartition\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin9\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_ppr\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_protectmode_part1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter_rename_partition\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppd_udf_case\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_database\norg.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_bucketmapjoin7\norg.apache.hcatalog.api.TestHCatClient.testDropPartitionsWithPartialSpec\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_sort_9\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_lateral_view_ppd\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/182/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/182/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.CleanupPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests failed with: TestsFailedException: 230 tests failed\n{noformat}\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-07-25T17:06:02.441+0000","updated":"2013-07-25T17:06:02.441+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13721505","id":"13721505","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"sershe updated the revision \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\n  Fixed mishandling of transactions, lack of support for limit, and boolean fields failing on Derby. Some random tests I ran pass, will run all tests overnight.\n\nReviewers: JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D11805?vs=36135&id=36357#toc\n\nAFFECTED FILES\n  build.xml\n  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java\n  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java\n\nTo: JIRA, sershe\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-27T02:53:46.793+0000","updated":"2013-07-27T02:53:46.793+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13721584","id":"13721584","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 at least one tests failed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12594511/HIVE-4051.D11805.2.patch\n\n{color:red}ERROR:{color} -1 due to 59 failed/errored test(s), 2653 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppr_pushdown2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_select_unquote_or\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_bitmap_rc\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_insert_into2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_partitioned\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_compact_2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_select_unquote_and\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat11\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_explain_dependency2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union_view\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_sample10\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_special_char\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part12\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_bitmap_auto_partitioned\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part3\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_compact\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_inputddl7\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_archive_multi\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_mi\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_combine2_hadoop20\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter_merge_2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge_dynamic_partition3\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part4\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_columnstats_partlvl\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_bitmap\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats4\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge3\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_decode_name\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_mult_tables\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat12\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ql_rewrite_gbtoidx\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_noscan_2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part10\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats12\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppd2\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_sort_6\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_unused\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter_partition_coltype\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_stale_partitioned\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucket_groupby\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_explain_dependency\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_concatenate_inherit_table_location\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auth\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat5\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input24\norg.apache.hcatalog.api.TestHCatClient.testGetPartitionsWithPartialSpec\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part8\norg.apache.hcatalog.api.TestHCatClient.testPartitionsHCatClientImpl\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_explain_logical\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_rename_partition_location\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_select_unquote_not\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part9\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_updateAccessTime\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats7\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_mult_tables_compact\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_database_drop\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppd_constant_where\norg.apache.hcatalog.api.TestHCatClient.testDropPartitionsWithPartialSpec\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/206/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/206/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.CleanupPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests failed with: TestsFailedException: 59 tests failed\n{noformat}\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-07-27T09:07:33.181+0000","updated":"2013-07-27T09:07:33.181+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13721696","id":"13721696","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"brock has commented on the revision \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\n  Comments about handling of error.\n\nINLINE COMMENTS\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:2074 In general I am supportive of this patch but we should not be catching Throwable here. We should at most catch Exceptuon.\n\n  Additionally log4j now supports passing exceptions directly, the stringifyException is no longer needed, you can pass the exception as the second arg of the log method.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nTo: JIRA, sershe\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-27T17:33:46.626+0000","updated":"2013-07-27T17:33:46.626+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13724152","id":"13724152","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"I've fixed most of the queries, there are a couple of bugs and sorting is undefined (and changed as we no longer sort by partition name) in some tests, couple stubborn ones remain, hopefully will update today","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-30T17:49:50.506+0000","updated":"2013-07-30T17:49:50.506+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13724160","id":"13724160","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lchouinard","name":"lchouinard","key":"lchouinard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laurent Chouinard","active":true,"timeZone":"America/New_York"},"body":"Hi,\n\nI will be on vacation from July 29th to August 6th inclusively. For any question or emergency, please contact the group MTL-IT-Production-Tools@ubisoft.com<mailto:MTL-IT-Production-Tools@ubisoft.com>\n\nThanks.\n\nLaurent Chouinard\nIT Production - Tools Programmer\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lchouinard","name":"lchouinard","key":"lchouinard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laurent Chouinard","active":true,"timeZone":"America/New_York"},"created":"2013-07-30T17:53:48.303+0000","updated":"2013-07-30T17:53:48.303+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13724607","id":"13724607","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"sershe updated the revision \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\n  Addressed Phabricator comments, fixed minor bugs (e.g. null checks, setTableName called instead of setDbName), added column schemas that ended up being needed after all, cleaned up the code a bit, added some short circuiting, added order to tests that had undefined order and so depended on the order in which partitions are returned (ORM code returns them by name, SQL by ID).\n  Added some short-circuiting to the queries/getting stuff.\n  I compared the reflection-based dump of SQL- and ORM- based objects from some tests (code not included) and they are the same.\n\n  The existing tests seem to adequately cover this code. The only concern is that if it fails it's impossible to see as it falls back to ORM...\n\nReviewers: JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D11805?vs=36357&id=36615#toc\n\nAFFECTED FILES\n  build.xml\n  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java\n  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java\n  ql/src/test/queries/clientpositive/alter_partition_coltype.q\n  ql/src/test/queries/clientpositive/load_dyn_part3.q\n  ql/src/test/queries/clientpositive/load_dyn_part4.q\n  ql/src/test/queries/clientpositive/load_dyn_part9.q\n  ql/src/test/queries/clientpositive/ppr_pushdown2.q\n  ql/src/test/queries/clientpositive/stats4.q\n  ql/src/test/results/clientpositive/load_dyn_part3.q.out\n  ql/src/test/results/clientpositive/load_dyn_part4.q.out\n  ql/src/test/results/clientpositive/load_dyn_part9.q.out\n  ql/src/test/results/clientpositive/ppr_pushdown2.q.out\n  ql/src/test/results/clientpositive/stats4.q.out\n\nTo: JIRA, sershe\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-30T23:29:48.104+0000","updated":"2013-07-30T23:29:48.104+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13724630","id":"13724630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"sershe updated the revision \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\n  Followup - forgot to rerun one query after changing.\n\nReviewers: JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D11805?vs=36615&id=36621#toc\n\nAFFECTED FILES\n  build.xml\n  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java\n  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java\n  ql/src/test/queries/clientpositive/alter_partition_coltype.q\n  ql/src/test/queries/clientpositive/load_dyn_part3.q\n  ql/src/test/queries/clientpositive/load_dyn_part4.q\n  ql/src/test/queries/clientpositive/load_dyn_part9.q\n  ql/src/test/queries/clientpositive/ppr_pushdown2.q\n  ql/src/test/queries/clientpositive/stats4.q\n  ql/src/test/results/clientpositive/alter_partition_coltype.q.out\n  ql/src/test/results/clientpositive/load_dyn_part3.q.out\n  ql/src/test/results/clientpositive/load_dyn_part4.q.out\n  ql/src/test/results/clientpositive/load_dyn_part9.q.out\n  ql/src/test/results/clientpositive/ppr_pushdown2.q.out\n  ql/src/test/results/clientpositive/stats4.q.out\n\nTo: JIRA, sershe\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-30T23:53:47.857+0000","updated":"2013-07-30T23:53:47.857+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13724737","id":"13724737","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 no tests executed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12595079/HIVE-4051.D11805.4.patch\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/251/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/251/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nTests failed with: NonZeroExitCodeException: Command 'bash /data/hive-ptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ [[ -n '' ]]\n+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128'\n+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128'\n+ cd /data/hive-ptest/working/\n+ tee /data/hive-ptest/logs/PreCommit-HIVE-Build-251/source-prep.txt\n+ mkdir -p maven ivy\n+ [[ svn = \\s\\v\\n ]]\n+ [[ -n '' ]]\n+ [[ -d apache-svn-trunk-source ]]\n+ [[ ! -d apache-svn-trunk-source/.svn ]]\n+ [[ ! -d apache-svn-trunk-source ]]\n+ cd apache-svn-trunk-source\n+ svn revert -R .\nReverted 'ql/src/java/org/apache/hadoop/hive/ql/exec/JoinOperator.java'\nReverted 'ql/src/java/org/apache/hadoop/hive/ql/exec/MapJoinOperator.java'\nReverted 'ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java'\n++ egrep -v '^X|^Performing status on external'\n++ awk '{print $2}'\n++ svn status --no-ignore\n+ rm -rf build hcatalog/build hcatalog/core/build hcatalog/storage-handlers/hbase/build hcatalog/server-extensions/build hcatalog/webhcat/svr/build hcatalog/webhcat/java-client/build hcatalog/hcatalog-pig-adapter/build common/src/gen\n+ svn update\n\nFetching external item into 'hcatalog/src/test/e2e/harness'\nExternal at revision 1508705.\n\nAt revision 1508705.\n+ patchCommandPath=/data/hive-ptest/working/scratch/smart-apply-patch.sh\n+ patchFilePath=/data/hive-ptest/working/scratch/build.patch\n+ [[ -f /data/hive-ptest/working/scratch/build.patch ]]\n+ chmod +x /data/hive-ptest/working/scratch/smart-apply-patch.sh\n+ /data/hive-ptest/working/scratch/smart-apply-patch.sh /data/hive-ptest/working/scratch/build.patch\nThe patch does not appear to apply with p0 to p2\n+ exit 1\n'\n{noformat}\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-07-31T01:42:44.257+0000","updated":"2013-07-31T01:42:44.257+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13724749","id":"13724749","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 no tests executed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12595079/HIVE-4051.D11805.4.patch\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/252/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/252/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nTests failed with: NonZeroExitCodeException: Command 'bash /data/hive-ptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ [[ -n '' ]]\n+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128'\n+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128'\n+ cd /data/hive-ptest/working/\n+ tee /data/hive-ptest/logs/PreCommit-HIVE-Build-252/source-prep.txt\n+ mkdir -p maven ivy\n+ [[ svn = \\s\\v\\n ]]\n+ [[ -n '' ]]\n+ [[ -d apache-svn-trunk-source ]]\n+ [[ ! -d apache-svn-trunk-source/.svn ]]\n+ [[ ! -d apache-svn-trunk-source ]]\n+ cd apache-svn-trunk-source\n+ svn revert -R .\n++ awk '{print $2}'\n++ egrep -v '^X|^Performing status on external'\n++ svn status --no-ignore\n+ rm -rf\n+ svn update\nU    testutils/ptest2/src/test/resources/SomeTest-success.xml\nU    testutils/ptest2/src/test/resources/test-outputs/SomeTest-truncated.xml\nU    testutils/ptest2/src/test/resources/test-outputs/skewjoin_union_remove_1.q-TEST-org.apache.hadoop.hive.cli.TestCliDriver.xml\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestHostExecutor.java\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestExecutionPhase.testPassingUnitTest.approved.txt\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestCleanupPhase.java\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestScripts.testPrepGit.approved.txt\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestPhase.testRsyncFromLocalToRemoteInstancesWithFailureUnknown.approved.txt\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestCleanupPhase.testExecute.approved.txt\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestScripts.java\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestScripts.testPrepNone.approved.txt\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestScripts.testPrepSvn.approved.txt\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestPhase.java\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestPrepPhase.testExecute.approved.txt\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestPhase.testRsyncFromLocalToRemoteInstancesWithFailureOne.approved.txt\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestExecutionPhase.testFailingUnitTest.approved.txt\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestExecutionPhase.java\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/AbstractTestPhase.java\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestExecutionPhase.testPassingQFileTest.approved.txt\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/MockSSHCommandExecutor.java\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/MockRSyncCommandExecutor.java\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestReportParser.java\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestExecutionPhase.testFailingQFile.approved.txt\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/MockLocalCommandFactory.java\nU    testutils/ptest2/src/test/java/org/apache/hive/ptest/api/server/TestTestExecutor.java\nU    testutils/ptest2/src/main/resources/batch-exec.vm\nU    testutils/ptest2/src/main/resources/source-prep.vm\nU    testutils/ptest2/src/main/resources/log4j.properties\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/api/server/TestExecutor.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/api/server/ExecutionController.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/api/request/TestStartRequest.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/api/client/PTestClient.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/ExecutionPhase.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/PrepPhase.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/ReportingPhase.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/HostExecutor.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/PTest.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/LogDirectoryCleaner.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/Phase.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/JUnitReportParser.java\nA    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/HostExecutorBuilder.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/context/CloudExecutionContextProvider.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/context/CloudComputeService.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/conf/ExecutionContextConfiguration.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/conf/QFileTestBatch.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/conf/TestConfiguration.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/conf/TestParser.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/JIRAService.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/Drone.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/CleanupPhase.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/Constants.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/ssh/SSHCommandExecutor.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/ssh/RSyncCommandExecutor.java\nU    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/ssh/AbstractSSHCommand.java\nU    eclipse-templates/.classpath\nU    eclipse-templates/.classpath._hbase\n\nFetching external item into 'hcatalog/src/test/e2e/harness'\nUpdated external to revision 1508709.\n\nUpdated to revision 1508708.\n+ patchCommandPath=/data/hive-ptest/working/scratch/smart-apply-patch.sh\n+ patchFilePath=/data/hive-ptest/working/scratch/build.patch\n+ [[ -f /data/hive-ptest/working/scratch/build.patch ]]\n+ chmod +x /data/hive-ptest/working/scratch/smart-apply-patch.sh\n+ /data/hive-ptest/working/scratch/smart-apply-patch.sh /data/hive-ptest/working/scratch/build.patch\nThe patch does not appear to apply with p0 to p2\n+ exit 1\n'\n{noformat}\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-07-31T01:54:49.111+0000","updated":"2013-07-31T01:54:49.111+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13724781","id":"13724781","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"sershe updated the revision \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\n  Rebase the patch\n\nReviewers: JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D11805?vs=36621&id=36627#toc\n\nAFFECTED FILES\n  build.xml\n  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java\n  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java\n  ql/src/test/queries/clientpositive/alter_partition_coltype.q\n  ql/src/test/queries/clientpositive/load_dyn_part3.q\n  ql/src/test/queries/clientpositive/load_dyn_part4.q\n  ql/src/test/queries/clientpositive/load_dyn_part9.q\n  ql/src/test/queries/clientpositive/ppr_pushdown2.q\n  ql/src/test/queries/clientpositive/stats4.q\n  ql/src/test/results/clientpositive/alter_partition_coltype.q.out\n  ql/src/test/results/clientpositive/load_dyn_part3.q.out\n  ql/src/test/results/clientpositive/load_dyn_part4.q.out\n  ql/src/test/results/clientpositive/load_dyn_part9.q.out\n  ql/src/test/results/clientpositive/ppr_pushdown2.q.out\n  ql/src/test/results/clientpositive/stats4.q.out\n\nTo: JIRA, sershe\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-31T02:33:47.184+0000","updated":"2013-07-31T02:33:47.184+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13724818","id":"13724818","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"body":"{quote}\nThis introduces \"direct SQL\" optimization for metastore.\nWhen memstore gets partitions by filter or by names, it does so using ANSI SQL92 queries, if enabled (default).\nThis will not work on non-RDBMS datastores, may not work on non-ANSI-compiant ones (I tested on mysql in default mode).\n{quote}\n\nHas anyone tested this patch on Derby, PostgreSQL, or Oracle? Until it's verified to work on these DBs I think this new code should be disabled by default.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-31T03:38:34.082+0000","updated":"2013-07-31T03:38:34.082+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13724880","id":"13724880","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 at least one tests failed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12595110/HIVE-4051.D11805.5.patch\n\n{color:red}ERROR:{color} -1 due to 8 failed/errored test(s), 2748 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part3\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part13\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part4\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats4\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part1\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge3\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part9\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part8\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/256/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/256/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests failed with: TestsFailedException: 8 tests failed\n{noformat}\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-07-31T05:21:21.384+0000","updated":"2013-07-31T05:21:21.384+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13725486","id":"13725486","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"{quote}Has anyone tested this patch on Derby, PostgreSQL, or Oracle? Until it's verified to work on these DBs I think this new code should be disabled by default.{quote}\nI tested on Derby and MySQL so far.\nNote that full fallback is there, so it could have a 3-position switch or two settings - current on/off being the same, and the \"on, but turn off [for some grace period?] on first error\"-setting. The latter could be the default, so in case if it fails it goes back to DN and doesn't introduce a lot of extra load. \nWhat do you think?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-31T17:48:45.158+0000","updated":"2013-07-31T17:48:45.158+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13726852","id":"13726852","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"sershe updated the revision \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\n  The above failed tests are due to sorting. Due to so many tests failing I changed the code to preserve the same sort as JDO, it's actually a very small change. I am getting some test failures locally that look like they are caused by my laptop problems; let me try to push to HiveQA again.\n\nReviewers: JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D11805?vs=36627&id=36771#toc\n\nAFFECTED FILES\n  build.xml\n  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java\n  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java\n\nTo: JIRA, sershe\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-01T20:37:47.892+0000","updated":"2013-08-01T20:37:47.892+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13726974","id":"13726974","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12595477/HIVE-4051.D11805.6.patch\n\n{color:green}SUCCESS:{color} +1 2749 tests passed\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/278/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/278/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n{noformat}\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-08-01T22:14:27.904+0000","updated":"2013-08-01T22:14:27.904+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13728115","id":"13728115","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"ashutoshc has requested changes to the revision \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\n  Initial review pass. Few comments.\n\nINLINE COMMENTS\n  build.xml:703 This is a good change which I like, but lets do it in separate jira : )\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1654 ObjectStore is getting too big. Lets move this class in a separate file.\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1681 I havent verified in code, but as far as I remember nothing in code at the moment uses CREATE_TIME, LAST_ACCESS_TIME, so we can drop these from select list.\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1711 You can initialize size of these treemaps with result.size()\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1681 We already know dbName and table name, why are you having them in select list?\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1735 If we do decide to keep create and last access time, can you check if they are Integer, I though they are longs.\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1776 Can there ever be a case when coldId == null ? I am not able to imagine one, did you see some failures ?\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1826 Instead of *, its better to use ORDER here, because RDBMS which doesn't support ORDER as column name would anyway be broken when schemas are created in it.\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:2268 This query is not encapsulated in transaction anymore?\n  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java:379 We should be able to support for non-strings as well, right? Is it just that you want to do that in later jira ?\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nBRANCH\n  HIVE-4051\n\nARCANIST PROJECT\n  hive\n\nTo: JIRA, ashutoshc, sershe\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-02T21:05:47.598+0000","updated":"2013-08-02T21:05:47.598+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13728356","id":"13728356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"sershe has commented on the revision \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\nINLINE COMMENTS\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1654 Will do after other feedback, otherwise the diff will be hard to do between files\n  build.xml:703 fixed\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1681 fixed\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1681 someone might use them without knowing... it's cheap to get couple more columns\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1711 treemaps don't have size initializer?\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1735 they are int both in db, and in methods\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1776 I am being paranoid... I think it cannot happen, but db schema doesn't prevent that.\n  Should we throw if sd, serde or col Ids are null?\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1826 the database is created by script (or DN) in RDBMS-specific way I'd assume, so it would escape the reserved word properly. Mysql by default doesn't support ANSI way of escaping words... and it we use backticks for mysql it won't work on other RDBMS-es.\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:2268 the tx is external to the method... renamed method for clarity\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nBRANCH\n  HIVE-4051\n\nARCANIST PROJECT\n  hive\n\nTo: JIRA, ashutoshc, sershe\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-03T01:03:47.491+0000","updated":"2013-08-03T01:03:47.491+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13728403","id":"13728403","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"Some perf results (with a patch I am about to update).\nI am running metastore separately on the same box as MySQL box in a cluster, with default config.\nI've created a table as such:\n{code}\ncreate table sqltest(c string) partitioned by (s string,n string,p int);\n{code}\nand inserted 32k partitions with s being 32-character random string, n - a number between 0 and 14, and p also a number.\nThere's no data in the table.\n\nI am running a query that would select 256 partitions with filter pushdown from hive CLI is on a different box\nThe time spent for creating partition objects out of 32k is about 150-180ms on current database schema. Bulk of it (~100ms) is in the query that does the filtering by joining PARTITION_KEY_VALS.\nIf this is done beforehand: \"create index idx1 on PARTITION_KEY_VALS (PART_KEY_VAL);\", the total server-side fetch time becomes about 50ms, ~40-45ms for assorted queries and ~5ms for java code.\nOn empty dataset, the total time to run the query (no job as there's no data) is about 150ms in the latter case.\nTrunk with filter pushdown takes the total of 1.7-2 seconds in this case; with more partitions fetched the difference is proportional.\nResults are similar if both are run w/o pushdown (both are slower ofc).\n\nAs mentioned above, I will move code into its own class in separate \"last\" iteration w/o logic changes in order to not complicate the review.\n\nTuning MySQL/other databases, and queries, for further perf, can be in separate JIRA(s). The Hive admin/DBA could even do the former in the meantime if absolutely necessary.\n\n[~cws] What do you think about the more conservative fallback scheme proposed above? (not in the patch yet)\nI can test on Postgres if desired but I don't think I have access to Oracle.\n\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-03T02:25:38.968+0000","updated":"2013-08-03T02:25:38.968+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13728404","id":"13728404","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"[~cwsteinbach] Sorry, mistyped the alias in the previous comment.\nbq. What do you think about the more conservative fallback scheme proposed above? (not in the patch yet)\nbq. I can test on Postgres if desired but I don't think I have access to Oracle.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-03T02:27:34.857+0000","updated":"2013-08-03T02:27:34.857+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13728408","id":"13728408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"sershe updated the revision \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\n  Feedback from review board, split the first query because it's hideously slow otherwise after sorting is added.\n\nReviewers: ashutoshc, JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D11805?vs=36771&id=36879#toc\n\nAFFECTED FILES\n  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java\n  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java\n\nTo: JIRA, ashutoshc, sershe\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-03T02:35:48.359+0000","updated":"2013-08-03T02:35:48.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13728460","id":"13728460","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 at least one tests failed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12595725/HIVE-4051.D11805.7.patch\n\n{color:red}ERROR:{color} -1 due to 1 failed/errored test(s), 2758 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hcatalog.pig.TestHCatStorer.testPartColsInData\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/296/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/296/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests failed with: TestsFailedException: 1 tests failed\n{noformat}\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-08-03T05:40:23.512+0000","updated":"2013-08-03T05:40:23.512+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13729915","id":"13729915","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"ashutoshc has requested changes to the revision \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\n  Mostly looks good. Can you update the final patch with new class in its own file, with following two comments (if they looks alright.)\n\nINLINE COMMENTS\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1681 You are still selecting dbname, tblname ?\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1776 Yes.. I think we should throw in those cases. Having empty list will mask the root problem if there is any which results from it.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nBRANCH\n  HIVE-4051\n\nARCANIST PROJECT\n  hive\n\nTo: JIRA, ashutoshc, sershe\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-05T20:45:47.961+0000","updated":"2013-08-05T20:45:47.961+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13729917","id":"13729917","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"I think automatic fallback is good which makes sure that user query always succeed even in cases where this direct-sql optimization doesn't work for whatever reason. Folks who wants to turn this off anyway, can always do this by setting config variable. I am +1 on the patch as it is.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-05T20:47:13.593+0000","updated":"2013-08-05T20:47:13.593+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13730134","id":"13730134","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"sershe updated the revision \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\n  Moved the code for SQL filter generation and usage into separate class.\n  The only other changes are latest two comments on Phabricator, as well as some minor cleanup like null checks.\n\nReviewers: ashutoshc, JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D11805?vs=36879&id=37071#toc\n\nAFFECTED FILES\n  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreDirectSql.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java\n  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java\n\nTo: JIRA, ashutoshc, sershe\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-05T23:33:50.234+0000","updated":"2013-08-05T23:33:50.234+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13730137","id":"13730137","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"sershe has commented on the revision \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\nINLINE COMMENTS\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1681 fixed\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1776 fixed\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nTo: JIRA, ashutoshc, sershe\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-05T23:35:50.685+0000","updated":"2013-08-05T23:35:50.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13730238","id":"13730238","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"sershe updated the revision \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\n  Fixing bugs introduced while moving code.\n\nReviewers: ashutoshc, JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D11805?vs=37071&id=37083#toc\n\nAFFECTED FILES\n  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreDirectSql.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java\n  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java\n  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java\n\nTo: JIRA, ashutoshc, sershe\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-06T01:09:48.342+0000","updated":"2013-08-06T01:09:48.342+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13730363","id":"13730363","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"ashutoshc has accepted the revision \"HIVE-4051 [jira] Hive's metastore suffers from 1+N queries when querying partitions & is slow\".\n\n  +1\n\nREVISION DETAIL\n  https://reviews.facebook.net/D11805\n\nBRANCH\n  HIVE-4051\n\nARCANIST PROJECT\n  hive\n\nTo: JIRA, ashutoshc, sershe\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-06T05:17:49.382+0000","updated":"2013-08-06T05:17:49.382+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13731662","id":"13731662","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to trunk. Thanks, Sergey!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-08-07T05:30:29.871+0000","updated":"2013-08-07T05:30:29.871+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13731676","id":"13731676","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hive-trunk-hadoop2 #336 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/336/])\nHIVE-4051 : Hive's metastore suffers from 1+N queries when querying partitions & is slow (Sergey Shelukhin via Ashutosh Chauhan) (hashutosh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1511177)\n* /hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreDirectSql.java\n* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java\n* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-07T05:50:27.342+0000","updated":"2013-08-07T05:50:27.342+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13732847","id":"13732847","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"ABORTED: Integrated in Hive-trunk-hadoop2-ptest #50 (See [https://builds.apache.org/job/Hive-trunk-hadoop2-ptest/50/])\nHIVE-4051 : Hive's metastore suffers from 1+N queries when querying partitions & is slow (Sergey Shelukhin via Ashutosh Chauhan) (hashutosh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1511177)\n* /hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreDirectSql.java\n* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java\n* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-07T22:29:51.722+0000","updated":"2013-08-07T22:29:51.722+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13733048","id":"13733048","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hive-trunk-h0.21 #2250 (See [https://builds.apache.org/job/Hive-trunk-h0.21/2250/])\nHIVE-4051 : Hive's metastore suffers from 1+N queries when querying partitions & is slow (Sergey Shelukhin via Ashutosh Chauhan) (hashutosh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1511177)\n* /hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreDirectSql.java\n* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java\n* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-08T01:46:51.800+0000","updated":"2013-08-08T01:46:51.800+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13733287","id":"13733287","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"ABORTED: Integrated in Hive-trunk-hadoop1-ptest #121 (See [https://builds.apache.org/job/Hive-trunk-hadoop1-ptest/121/])\nHIVE-4051 : Hive's metastore suffers from 1+N queries when querying partitions & is slow (Sergey Shelukhin via Ashutosh Chauhan) (hashutosh: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1511177)\n* /hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreDirectSql.java\n* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java\n* /hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-08T09:08:56.597+0000","updated":"2013-08-08T09:08:56.597+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13772142","id":"13772142","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dougsedlak","name":"dougsedlak","key":"dougsedlak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Sedlak","active":true,"timeZone":"Etc/UTC"},"body":"I've noticed that the more partitions in a Hive table, the slower the following operations come back.  With thousands of partitions they approach painfully slow:\nSELECT * FROM TABNAME\nSHOW TABLE EXTENDED LIKE `TABNAME`\n\nDo you know if this fix takes case of these issues?  If not is it something you could test?\nIf not, I'll enter a new case.\n\nThanks, Doug  doug.sedlak@sas.com","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dougsedlak","name":"dougsedlak","key":"dougsedlak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Sedlak","active":true,"timeZone":"Etc/UTC"},"created":"2013-09-19T18:26:05.023+0000","updated":"2013-09-19T18:26:05.023+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13775826","id":"13775826","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"this and the followup patches (HIVE-5158) will take care of pre-map-reduce-job slowdown on select * with many partitions, but it's hard to tell whether that's the main culprit from just looking at the query.\nshow table I am not sure, if not it should be easy to extend. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-09-24T00:01:20.010+0000","updated":"2013-09-24T00:01:20.010+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12633522/comment/13796011","id":"13796011","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-10-15T23:30:21.155+0000","updated":"2013-10-15T23:30:21.155+0000"}],"maxResults":38,"total":38,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4051/votes","votes":3,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1i6t3:"}}