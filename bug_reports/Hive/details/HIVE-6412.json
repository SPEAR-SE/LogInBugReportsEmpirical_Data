{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12694724","self":"https://issues.apache.org/jira/rest/api/2/issue/12694724","key":"HIVE-6412","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2014-02-24T20:36:13.874+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Feb 25 14:59:57 UTC 2014","customfield_12310420":"373232","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1134423847_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-02-25T14:59:57.894+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-6412/watchers","watchCount":2,"isWatching":false},"created":"2014-02-12T11:52:54.095+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-02-25T14:59:57.937+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"{code}\nCaused by: java.lang.ClassCastException: org.apache.hadoop.hive.serde2.io.HiveDecimalWritable cannot be cast to org.apache.hadoop.hive.common.type.HiveDecimal\n        at org.apache.hadoop.hive.serde2.objectinspector.primitive.JavaHiveDecimalObjectInspector.getPrimitiveWritableObject(JavaHiveDecimalObjectInspector.java:49)\n        at org.apache.hadoop.hive.serde2.objectinspector.primitive.JavaHiveDecimalObjectInspector.getPrimitiveWritableObject(JavaHiveDecimalObjectInspector.java:27)\n        at org.apache.hadoop.hive.serde2.objectinspector.ObjectInspectorUtils.copyToStandardObject(ObjectInspectorUtils.java:281)\n        at org.apache.hadoop.hive.ql.exec.JoinUtil.computeKeys(JoinUtil.java:143)\n        at org.apache.hadoop.hive.ql.exec.SMBMapJoinOperator$MergeQueue.next(SMBMapJoinOperator.java:809)\n        at org.apache.hadoop.hive.ql.exec.SMBMapJoinOperator$MergeQueue.nextHive(SMBMapJoinOperator.java:771)\n        at org.apache.hadoop.hive.ql.exec.SMBMapJoinOperator$MergeQueue.setupContext(SMBMapJoinOperator.java:710)\n        at org.apache.hadoop.hive.ql.exec.SMBMapJoinOperator.setUpFetchContexts(SMBMapJoinOperator.java:538)\n        at org.apache.hadoop.hive.ql.exec.SMBMapJoinOperator.processOp(SMBMapJoinOperator.java:248)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:790)\n        at org.apache.hadoop.hive.ql.exec.TableScanOperator.processOp(TableScanOperator.java:92)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:790)\n        at org.apache.hadoop.hive.ql.exec.MapOperator.process(MapOperator.java:524)\n{code}\n\nRepro:\n{code}\ncreate table vsmb_bucket_1(key decimal(9,0), value decimal(38,10)) \n  CLUSTERED BY (key) \n  SORTED BY (key) INTO 1 BUCKETS \n  STORED AS ORC;\ncreate table vsmb_bucket_2(key decimal(19,3), value decimal(28,0)) \n  CLUSTERED BY (key) \n  SORTED BY (key) INTO 1 BUCKETS \n  STORED AS ORC;\n  \ninsert into table vsmb_bucket_1 \n  select cast(cint as decimal(9,0)) as key, \n    cast(cfloat as decimal(38,10)) as value \n  from alltypesorc limit 2;\ninsert into table vsmb_bucket_2 \n  select cast(cint as decimal(19,3)) as key, \n    cast(cfloat as decimal(28,0)) as value \n  from alltypesorc limit 2;\n\nset hive.optimize.bucketmapjoin = true;\nset hive.optimize.bucketmapjoin.sortedmerge = true;\nset hive.auto.convert.sortmerge.join.noconditionaltask = true;\nset hive.input.format = org.apache.hadoop.hive.ql.io.BucketizedHiveInputFormat;\n\nexplain\nselect /*+MAPJOIN(a)*/ * from vsmb_bucket_1 a join vsmb_bucket_2 b on a.key = b.key;\nselect /*+MAPJOIN(a)*/ * from vsmb_bucket_1 a join vsmb_bucket_2 b on a.key = b.key;\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"373533","customfield_12312823":null,"summary":"SMB join on Decimal columns causes cast exception in JoinUtil.computeKeys","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12694724/comment/13910779","id":"13910779","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"I tried the queries in the latest trunk and wasn't able to reproduce the problem. Presumably the problem is fixed. [~rusanu] Could you please verify?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-02-24T20:36:13.874+0000","updated":"2014-02-24T20:36:13.874+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12694724/comment/13911568","id":"13911568","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"body":"I concur, this seems to no longer repro in current trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"created":"2014-02-25T13:38:44.508+0000","updated":"2014-02-25T13:38:44.508+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12694724/comment/13911642","id":"13911642","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Close the issue as non-reproducible.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-02-25T14:59:57.930+0000","updated":"2014-02-25T14:59:57.930+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-6412/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1sbj3:"}}