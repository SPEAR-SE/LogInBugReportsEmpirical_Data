{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12990334","self":"https://issues.apache.org/jira/rest/api/2/issue/12990334","key":"HIVE-14264","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-07-19T14:45:43.790+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jul 28 05:56:11 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-14264/watchers","watchCount":4,"isWatching":false},"created":"2016-07-18T10:36:14.343+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334255","id":"12334255","name":"2.1.0","archived":false,"released":true,"releaseDate":"2016-06-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gszadovszky","name":"gszadovszky","key":"gszadovszky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gszadovszky&avatarId=29443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gszadovszky&avatarId=29443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gszadovszky&avatarId=29443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gszadovszky&avatarId=29443"},"displayName":"Gabor Szadovszky","active":true,"timeZone":"Europe/Budapest"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-07-28T05:56:11.169+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"We have noticed ArrayIndexOutOfBoundsException for queries with IS NOT NULL filter. Exception goes away when hive.cbo.enable=false\n\nHere is a  stacktrace in our production environment :\n{noformat}\nCaused by: java.lang.ArrayIndexOutOfBoundsException: -1\n        at java.util.ArrayList.elementData(ArrayList.java:418) ~[na:1.8.0_72]\n        at java.util.ArrayList.set(ArrayList.java:446) ~[na:1.8.0_72]\n        at org.apache.hadoop.hive.ql.optimizer.physical.MapJoinResolver$LocalMapJoinTaskDispatcher.processCurrentTask(MapJoinResolver.java:173) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.optimizer.physical.MapJoinResolver$LocalMapJoinTaskDispatcher.dispatch(MapJoinResolver.java:239) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.lib.TaskGraphWalker.dispatch(TaskGraphWalker.java:111) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.lib.TaskGraphWalker.walk(TaskGraphWalker.java:180) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.lib.TaskGraphWalker.startWalking(TaskGraphWalker.java:125) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.optimizer.physical.MapJoinResolver.resolve(MapJoinResolver.java:81) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.optimizer.physical.PhysicalOptimizer.optimize(PhysicalOptimizer.java:107) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.parse.MapReduceCompiler.optimizeTaskPlan(MapReduceCompiler.java:271) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.parse.TaskCompiler.compile(TaskCompiler.java:274) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:10764) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.parse.CalcitePlanner.analyzeInternal(CalcitePlanner.java:234) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:250) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:436) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:328) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:1156) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:1143) ~[hive-exec-2.1.2-inm.jar:2.1.2-inm]\n        at org.apache.hive.service.cli.operation.SQLOperation.prepare(SQLOperation.java:147) ~[hive-service-2.1.2-inm.jar:2.1.2-inm]\n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"ArrayIndexOutOfBoundsException when cbo is enabled ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12990334/comment/15384259","id":"15384259","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gszadovszky","name":"gszadovszky","key":"gszadovszky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gszadovszky&avatarId=29443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gszadovszky&avatarId=29443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gszadovszky&avatarId=29443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gszadovszky&avatarId=29443"},"displayName":"Gabor Szadovszky","active":true,"timeZone":"Europe/Budapest"},"body":"Tried on 2.1.0-rc0 running on Derby db. \n\nBeeline was started using the command: ./beeline --hiveconf hive.cbo.enable=false -u jdbc:hive2://\n\nTest data created using the following commands:\nCREATE DATABASE hive_14264;\nUSE hive_14264;\nCREATE TABLE table1 (key STRING, value STRING);\nINSERT INTO TABLE table1 \n\tVALUES ('key1', 'value1'), (null, 'value2'), ('key3', null), (null, null);\n\nTried to reproduce the issue by using the following queries:\n0: jdbc:hive2://> SELECT * FROM table1 WHERE key IS NOT NULL;\nOK\n+-------------+---------------+--+\n| table1.key  | table1.value  |\n+-------------+---------------+--+\n| key1        | value1        |\n| key3        | NULL          |\n+-------------+---------------+--+\n2 rows selected (0.29 seconds)\n0: jdbc:hive2://> SELECT * FROM table1 WHERE value IS NOT NULL;OK\n+-------------+---------------+--+\n| table1.key  | table1.value  |\n+-------------+---------------+--+\n| key1        | value1        |\n| NULL        | value2        |\n+-------------+---------------+--+\n2 rows selected (0.087 seconds)\n\nQueries executed as expected; issue was not reproducible.\nCould you please provide more info to reproduce the issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gszadovszky","name":"gszadovszky","key":"gszadovszky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gszadovszky&avatarId=29443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gszadovszky&avatarId=29443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gszadovszky&avatarId=29443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gszadovszky&avatarId=29443"},"displayName":"Gabor Szadovszky","active":true,"timeZone":"Europe/Budapest"},"created":"2016-07-19T14:45:43.790+0000","updated":"2016-07-19T14:45:43.790+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12990334/comment/15384300","id":"15384300","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gszadovszky","name":"gszadovszky","key":"gszadovszky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gszadovszky&avatarId=29443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gszadovszky&avatarId=29443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gszadovszky&avatarId=29443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gszadovszky&avatarId=29443"},"displayName":"Gabor Szadovszky","active":true,"timeZone":"Europe/Budapest"},"body":"Tried with both hive.cbo.enable=true and hive.cbo.enable=false: issue was not reproducible in either cases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gszadovszky","name":"gszadovszky","key":"gszadovszky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gszadovszky&avatarId=29443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gszadovszky&avatarId=29443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gszadovszky&avatarId=29443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gszadovszky&avatarId=29443"},"displayName":"Gabor Szadovszky","active":true,"timeZone":"Europe/Budapest"},"created":"2016-07-19T15:01:59.344+0000","updated":"2016-07-19T15:01:59.344+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12990334/comment/15395626","id":"15395626","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"[~gszadovszky], Thanks for looking into this. We were also not able reproduce in our local setup, query was only failing in our production with above stacktrace. By disabling cbo, we were able to move forward.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-27T12:59:53.377+0000","updated":"2016-07-27T12:59:53.377+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12990334/comment/15395685","id":"15395685","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gszadovszky","name":"gszadovszky","key":"gszadovszky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gszadovszky&avatarId=29443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gszadovszky&avatarId=29443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gszadovszky&avatarId=29443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gszadovszky&avatarId=29443"},"displayName":"Gabor Szadovszky","active":true,"timeZone":"Europe/Budapest"},"body":"Are you able to add some details about your environment? Unfortunately, I was not able to figure anything out of the stacktrace.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gszadovszky","name":"gszadovszky","key":"gszadovszky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gszadovszky&avatarId=29443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gszadovszky&avatarId=29443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gszadovszky&avatarId=29443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gszadovszky&avatarId=29443"},"displayName":"Gabor Szadovszky","active":true,"timeZone":"Europe/Budapest"},"created":"2016-07-27T13:36:06.125+0000","updated":"2016-07-27T13:36:06.125+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12990334/comment/15396993","id":"15396993","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"[~gszadovszky] We are running queries on hive server on version 2.1 and using MR execution engine. The tables are partitioned and the issue mostly happens when col is not projected but it is only in filter clause with 'IS NOT NULL' filter. But we have seen failures in some cases when column is projected as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-07-28T05:56:11.169+0000","updated":"2016-07-28T05:56:11.169+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-14264/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i314kf:"}}