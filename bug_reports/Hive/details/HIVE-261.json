{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12413576","self":"https://issues.apache.org/jira/rest/api/2/issue/12413576","key":"HIVE-261","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2009-02-03T00:43:07.179+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Mar 26 00:04:49 UTC 2009","customfield_12310420":"73663","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_4752375588_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-03-26T00:04:49.686+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-261/watchers","watchCount":0,"isWatching":false},"created":"2009-01-29T23:58:34.098+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-03-26T00:04:49.684+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"we have this query:\n\nSELECT a.u, b.id FROM (\n SELECT a1.u, a1.id as id FROM t_1 a1 WHERE a1.date = '2009-01-01' UNION ALL\n SELECT a2.u, a2.id as id FROM t_2 a2 WHERE a2.date = '2009-01-01' UNION ALL\n ...\n SELECT aN.u, aN.id as id FROM t_N an WHERE aN.date = '2009-01-01'\n) a \nJOIN t b ON a.id = b.id WHERE b.date='2009-01-01' \nGROUP BY a.u, b.id\n\nWhen we union more than 20 tables, the query will hang. It looks like something wrong in the compiler.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"122079","customfield_12312823":null,"summary":"union all query hangs","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hliu","name":"hliu","key":"hliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hao Liu","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hliu","name":"hliu","key":"hliu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hao Liu","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413576/comment/12669815","id":"12669815","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"body":"{code}\nsed 's@msgs.push(\"\\(.*\\)\");@System.out.println(\"msgs size=\" + msgs.size() + \" \\1\"); msgs.push(\"\\1\");@g' ./ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g\n{code}\n\nIt seems there is a missing pop or something:\n\n{code}\n    [junit] msgs size=1756954 selection target\n    [junit] msgs size=1756955 select expression\n    [junit] msgs size=1756956 expression specification\n    [junit] msgs size=1756957 function specification\n    [junit] msgs size=1756958 function name\n    [junit] msgs size=1756959 table column identifier\n    [junit] msgs size=1756960 table column identifier\n    [junit] msgs size=1756961 function specification\n    [junit] msgs size=1756962 function name\n    [junit] msgs size=1756963 table column identifier\n    [junit] msgs size=1756964 table column identifier\n    [junit] msgs size=1756965 function specification\n    [junit] msgs size=1756966 function name\n    [junit] msgs size=1756967 table column identifier\n    [junit] msgs size=1756968 table column identifier\n    [junit] msgs size=1756969 expression specification\n    [junit] msgs size=1756970 function specification\n    [junit] msgs size=1756971 function name\n    [junit] msgs size=1756972 table column identifier\n    [junit] msgs size=1756973 table column identifier\n    [junit] msgs size=1756974 function specification\n    [junit] msgs size=1756975 function name\n    [junit] msgs size=1756976 table column identifier\n    [junit] msgs size=1756977 table column identifier\n    [junit] msgs size=1756978 function specification\n    [junit] msgs size=1756979 function name\n    [junit] msgs size=1756980 table column identifier\n    [junit] msgs size=1756981 table column identifier\n    [junit] msgs size=1756982 selection target\n    [junit] msgs size=1756983 select expression\n    [junit] msgs size=1756984 expression specification\n    [junit] msgs size=1756985 function specification\n    [junit] msgs size=1756986 function name\n    [junit] msgs size=1756987 table column identifier\n    [junit] msgs size=1756988 table column identifier\n    [junit] msgs size=1756989 function specification\n    [junit] msgs size=1756990 function name\n    [junit] msgs size=1756991 table column identifier\n    [junit] msgs size=1756992 table column identifier\n    [junit] msgs size=1756993 function specification\n    [junit] msgs size=1756994 function name\n    [junit] msgs size=1756995 table column identifier\n    [junit] msgs size=1756996 table column identifier\n    [junit] msgs size=1756997 expression specification\n    [junit] msgs size=1756998 function specification\n    [junit] msgs size=1756999 function name\n    [junit] msgs size=1757000 table column identifier\n    [junit] msgs size=1757001 table column identifier\n    [junit] msgs size=1757002 function specification\n    [junit] msgs size=1757003 function name\n    [junit] msgs size=1757004 table column identifier\n    [junit] msgs size=1757005 table column identifier\n    [junit] msgs size=1757006 function specification\n    [junit] msgs size=1757007 function name\n    [junit] msgs size=1757008 table column identifier\n    [junit] msgs size=1757009 table column identifier\n    [junit] msgs size=1757010 select list\n    [junit] msgs size=1757011 selection target\n    [junit] msgs size=1757012 select expression\n{code}\n\n\nMy query:\n{code}\nexplain\n  select count(1) FROM (\n\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\n\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\n\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\n\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\n\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\nselect s1.key as key, s1.value as value from src s1 UNION ALL\n\nselect s2.key as key, s2.value as value from src s2) unionsrc;\n\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-02-03T00:43:07.179+0000","updated":"2009-02-03T00:43:07.179+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413576/comment/12669827","id":"12669827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"body":"I am very surprised at the number of levels that antlr needs to go through to parse this query.\nAlso it seems msgs.pop() was not executed for some reason.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-02-03T01:03:17.404+0000","updated":"2009-02-03T01:03:17.404+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413576/comment/12669835","id":"12669835","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"body":"Antlr does not put the code in @after in every return statement.\n\n{code}\n    ./build/ql/gen-java/org/apache/hadoop/hive/ql/parse/HiveParser.java\n\n    public final explainStatement_return explainStatement() throws RecognitionException {\n        explainStatement_return retval = new explainStatement_return();\n        retval.start = input.LT(1);\n\n        CommonTree root_0 = null;\n\n        Token isExtended=null;\n        Token KW_EXPLAIN5=null;\n        execStatement_return execStatement6 = null;\n\n\n        CommonTree isExtended_tree=null;\n        CommonTree KW_EXPLAIN5_tree=null;\n        RewriteRuleTokenStream stream_KW_EXTENDED=new RewriteRuleTokenStream(adaptor,\"token KW_EXTENDED\");\n        RewriteRuleTokenStream stream_KW_EXPLAIN=new RewriteRuleTokenStream(adaptor,\"token KW_EXPLAIN\");\n        RewriteRuleSubtreeStream stream_execStatement=new RewriteRuleSubtreeStream(adaptor,\"rule execStatement\");\n         System.out.println(\"msgs size=\" + msgs.size() + \" explain statement\"); msgs.push(\"explain statement\");\n        try {\n            // /data/users/zshao/sync/apache-trunk-HIVE-261/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g:157:2: ( KW_EXPLAIN (isExtended= KW_EXTENDED )? execStatement -> ^( TOK_EXPLAI\\\nN execStatement ( $isExtended)? ) )\n            // /data/users/zshao/sync/apache-trunk-HIVE-261/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g:157:4: KW_EXPLAIN (isExtended= KW_EXTENDED )? execStatement\n            {\n            KW_EXPLAIN5=(Token)input.LT(1);\n            match(input,KW_EXPLAIN,FOLLOW_KW_EXPLAIN_in_explainStatement448); if (failed) return retval;\n            if ( backtracking==0 ) stream_KW_EXPLAIN.add(KW_EXPLAIN5);\n\n            // /data/users/zshao/sync/apache-trunk-HIVE-261/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g:157:15: (isExtended= KW_EXTENDED )?\n            int alt2=2;\n            int LA2_0 = input.LA(1);\n\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zshao","name":"zshao","key":"zshao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zshao&avatarId=14358","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zshao&avatarId=14358","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zshao&avatarId=14358","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zshao&avatarId=14358"},"displayName":"Zheng Shao","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-02-03T01:28:42.255+0000","updated":"2009-02-03T01:28:42.255+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413576/comment/12689286","id":"12689286","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"duplicate of jira 318","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-03-26T00:04:49.665+0000","updated":"2009-03-26T00:04:49.665+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-261/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0l8tj:"}}