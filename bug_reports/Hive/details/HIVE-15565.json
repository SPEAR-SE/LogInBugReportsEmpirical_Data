{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13032979","self":"https://issues.apache.org/jira/rest/api/2/issue/13032979","key":"HIVE-15565","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335837","id":"12335837","name":"2.2.0","archived":false,"released":true,"releaseDate":"2017-07-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-01-09T08:27:25.379+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Jan 22 22:29:17 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_235092_*|*_4_*:*_1_*:*_1578926_*|*_5_*:*_2_*:*_674400215_*|*_10002_*:*_2_*:*_504112978","customfield_12312321":null,"resolutiondate":"2017-01-22T22:29:17.473+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-15565/watchers","watchCount":5,"isWatching":false},"created":"2017-01-09T06:37:10.365+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-07-25T20:05:30.447+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12328311","id":"12328311","name":"llap"}],"timeoriginalestimate":null,"description":"{{GroupByOperator::isTez}} would be true in LLAP mode. Current memory computations can go wrong with {{isTez}} checks in {{GroupByOperator}}. For e.g, in a LLAP instance with Xmx128G and 12 executors, it would start flushing hash table for every record once it reaches around 42GB (hive.tez.container.size=7100, hive.map.aggr.hash.percentmemory=0.5).\n\n{noformat}\n2017-01-08T23:40:21,339 INFO  [TezTaskRunner (1480722417364_1922_7_03_000004_1)] org.apache.hadoop.hive.ql.exec.GroupByOperator: Hash Table flushed: new size = 0\n2017-01-08T23:40:21,339 INFO  [TezTaskRunner (1480722417364_1922_7_03_000012_1)] org.apache.hadoop.hive.ql.exec.GroupByOperator: Hash Table flushed: new size = 0\n2017-01-08T23:40:21,339 INFO  [TezTaskRunner (1480722417364_1922_7_03_000004_1)] org.apache.hadoop.hive.ql.exec.GroupByOperator: Hash Tbl flush: #hash table = 1\n2017-01-08T23:40:21,339 INFO  [TezTaskRunner (1480722417364_1922_7_03_000012_1)] org.apache.hadoop.hive.ql.exec.GroupByOperator: Hash Tbl flush: #hash table = 1\n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12846265","id":"12846265","filename":"HIVE-15565.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-01-09T06:40:39.068+0000","size":1772,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12846265/HIVE-15565.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12848220","id":"12848220","filename":"HIVE-15565.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-01-19T03:45:09.422+0000","size":804,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12848220/HIVE-15565.2.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"LLAP: GroupByOperator flushes hash table too frequently","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13032979/comment/15811045","id":"15811045","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"body":"For LLAP, GBY hashtable memory should be shared by all executors. The problem is with tracking memory usage per thread. There is already an open jira for this. HIVE-15508\nIdeally, we want to track memory usage per executor and flush based on usage vs max memory available per executor ratio. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-09T08:27:25.379+0000","updated":"2017-01-09T08:27:25.379+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13032979/comment/15811206","id":"15811206","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12846265/HIVE-15565.1.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 6 failed/errored test(s), 10903 tests executed\n*Failed tests:*\n{noformat}\nTestDerbyConnector - did not produce a TEST-*.xml file (likely timed out) (batchId=233)\nTestSparkCliDriver - did not produce a TEST-*.xml file (likely timed out) (batchId=122)\n\t[groupby3_map.q,union26.q,mapreduce1.q,mapjoin_addjar.q,bucket_map_join_spark1.q,udf_example_add.q,multi_insert_with_join.q,sample7.q,auto_join_nulls.q,ppd_outer_join4.q,load_dyn_part8.q,alter_merge_orc.q,sample6.q,bucket_map_join_1.q,auto_sortmerge_join_9.q]\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[case_sensitivity] (batchId=61)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[input_testxpath] (batchId=28)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[udf_coalesce] (batchId=75)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_char_simple] (batchId=146)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/2839/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/2839/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2839/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 6 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12846265 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-01-09T09:44:25.255+0000","updated":"2017-01-09T09:44:25.255+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13032979/comment/15813221","id":"15813221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-09T23:39:11.950+0000","updated":"2017-01-09T23:39:11.950+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13032979/comment/15817577","id":"15817577","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~sershe], [~prasanth_j]. Committed to master.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-01-11T07:59:01.236+0000","updated":"2017-01-11T07:59:01.236+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13032979/comment/15824647","id":"15824647","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"body":"I don't understand this - isn't the commit doing the exact opposite of what [~prasanth_j] says? This is flushing when the JVM memory is hit v the max allocated memory per executor. This would have a lot of bad side effects by having multiple queries/fragments step on one another...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-16T22:01:05.027+0000","updated":"2017-01-16T22:01:05.027+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13032979/comment/15824655","id":"15824655","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"Looking at it again (and at [~prasanth_j] 's comment that I cannot quite understand)... what is the task configured memory that we are no longer using? Is it set based on Tez executor size (or equivalent) in MapRecordProcessor? It's set from Tez context.\nAlso, why is this causing single-record flushes if we base on task memory?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-16T22:08:32.239+0000","updated":"2017-01-16T22:08:32.239+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13032979/comment/15824756","id":"15824756","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"body":"\nAs per old impl, maxMemory in {{GroupByOperator}} was 5,312,784,896. After running few queries (e.g q22,18, 70, 67) heap usage increases to ~64GB. Now when q22 is rerun, {{GroupByOperator::shouldBeFlushed}} would always return true for every record due to the following calculation\n\n{noformat}\n      usedMemory = isLlap ? usedMemory / numExecutors : usedMemory;\n      rate = (float) usedMemory / (float) maxMemory;  <==== 64/12 = 5.33 GB / 5312784896 bytes  > memoryThreshold of 0.9.\n      if(rate > memoryThreshold){\n        return true;\n      }\n{noformat}\n\nEven though q22 dataset is very small, it would end up flushing for every row. Patch fixes the assumption for isTez/isLLAP. But we still need HIVE-15508 for exact memory tracking. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-01-17T00:27:03.341+0000","updated":"2017-01-17T00:27:03.341+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13032979/comment/15828993","id":"15828993","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sseth","name":"sseth","key":"sseth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Siddharth Seth","active":true,"timeZone":"America/Los_Angeles"},"body":"After the patch, we won't flush in LLAP GroupBy, correct? used/numExecutors always < maxMemory ?\n\nBefore the patch - it's random, and depends on other operators running in the system.\nhttps://issues.apache.org/jira/browse/HIVE-15508 is pretty important - tracking memory per operator should help with this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sseth","name":"sseth","key":"sseth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Siddharth Seth","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-18T23:46:20.269+0000","updated":"2017-01-18T23:46:20.269+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13032979/comment/15829228","id":"15829228","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"body":"Had offline discussion with [~prasanth_j] on this. We do not need to flush the hashTable when {{numEntriesHashTable=0}} in LLAP.  We can revert the existing patch and check for this condition for LLAP.  That would reduce the number of flushes by large margin.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-01-19T03:17:20.216+0000","updated":"2017-01-19T03:17:20.216+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13032979/comment/15829231","id":"15829231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"body":"Reverted the patch. Will post a separate patch for checking \"numEntriesHashTable==0\" for LLAP.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-01-19T03:19:27.653+0000","updated":"2017-01-19T03:19:27.653+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13032979/comment/15829282","id":"15829282","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"body":"This delays the memory check hoping memory will be freed up in the meantime. Although freeing up of memory is not guaranteed and may not happen at all because of on-heap metadata cache and when other executors are performing allocations. \n\nLGTM, +1. Pending tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanth_j","name":"prasanth_j","key":"prasanth_j","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasanth Jayachandran","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-19T04:05:33.660+0000","updated":"2017-01-19T04:05:33.660+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13032979/comment/15831308","id":"15831308","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12848220/HIVE-15565.2.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 11 failed/errored test(s), 10963 tests executed\n*Failed tests:*\n{noformat}\nTestDerbyConnector - did not produce a TEST-*.xml file (likely timed out) (batchId=235)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[specialChar] (batchId=22)\norg.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_join_with_different_encryption_keys] (batchId=159)\norg.apache.hadoop.hive.cli.TestHBaseNegativeCliDriver.testCliDriver[cascade_dbdrop] (batchId=226)\norg.apache.hadoop.hive.cli.TestHBaseNegativeCliDriver.testCliDriver[generatehfiles_require_family_path] (batchId=226)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[escape1] (batchId=139)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[escape2] (batchId=154)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[schema_evol_text_vec_part] (batchId=149)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=140)\norg.apache.hadoop.hive.cli.TestNegativeMinimrCliDriver.testCliDriver[cluster_tasklog_retrieval] (batchId=87)\norg.apache.hadoop.hive.cli.TestNegativeMinimrCliDriver.testCliDriver[minimr_broken_pipe] (batchId=87)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/3060/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/3060/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-3060/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 11 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12848220 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-01-20T06:59:12.911+0000","updated":"2017-01-20T06:59:12.911+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13032979/comment/15833738","id":"15833738","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~prasanth_j], [~sershe].  Committed to master. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rajesh.balamohan","name":"rajesh.balamohan","key":"rajesh.balamohan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Balamohan","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-01-22T22:29:17.548+0000","updated":"2017-01-22T22:29:17.548+0000"}],"maxResults":13,"total":13,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-15565/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i38ffr:"}}