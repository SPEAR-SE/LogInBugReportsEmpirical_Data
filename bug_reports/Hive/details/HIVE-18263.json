{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13124184","self":"https://issues.apache.org/jira/rest/api/2/issue/13124184","key":"HIVE-18263","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12340268","id":"12340268","name":"3.0.0","archived":false,"released":true,"releaseDate":"2018-05-21"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-12-12T16:35:08.720+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue May 22 23:15:54 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_81905342_*|*_3_*:*_1_*:*_91541_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_2_*:*_236335575","customfield_12312321":null,"resolutiondate":"2017-12-15T09:57:09.402+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-18263/watchers","watchCount":6,"isWatching":false},"created":"2017-12-11T17:31:37.156+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12523473","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12523473","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"13016925","key":"HIVE-15102","self":"https://issues.apache.org/jira/rest/api/2/issue/13016925","fields":{"summary":"Hiveptest is killing nodes where IP is reused after previous node termination","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szita","name":"szita","key":"szita","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Szita","active":true,"timeZone":"Europe/Budapest"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-05-22T23:15:54.902+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312590","id":"12312590","name":"Testing Infrastructure","description":"Tracks issues with tests and testing infrastructure."}],"timeoriginalestimate":null,"description":"PreCommit-HIVE-Build job has been seen running very long from time to time. Usually it should take about 1.5 hours, but in some cases it took over 4-5 hours.\r\nLooking in the logs of one such execution I've seen that some commands that were sent to test executing slaves returned 255. Here this typically means that there is unknown return code for the remote call since hiveptest-server can't reach these slaves anymore.\r\n\r\nIn the hiveptest-server logs it is seen that some slaves were killed while running the job normally, and here is why:\r\n* Hive's ptest-server checks periodically in every 60 minutes the status of slaves. It also keeps track of slaves that were terminated.\r\n** If upon such check it is found that a slave that was already killed ([mTerminatedHosts map|https://github.com/apache/hive/blob/master/testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/context/CloudExecutionContextProvider.java#L93] contains its IP) is still running, it will try and terminate it again.\r\n* The server also maintains a file on its local FS that contains the IP of hosts that were used before. (This probably for resilience reasons)\r\n** This file is read when tomcat server starts and if any of the IPs in the file are seen as running slaves, ptest will terminate these first so it can begin with a fresh start\r\n** The IPs of these terminated instances already make their way into {{mTerminatedHosts}} upon initialization...\r\n* The cloud provider may reuse some older IPs, so it is not too rare that the same IP that belonged to a terminated host is assigned to a new one.\r\n\r\nThis is problematic: Hive ptest's slave caretaker thread kicks in every 60 minutes and might see a running host that has the same IP as an old slave had which was terminated at startup. It will think that this host should be terminated since it already tried 60 minutes ago as its IP is in {{mTerminatedHosts}}\r\n\r\nWe have to fix this by making sure that if a new slave is created, we check the contents of {{mTerminatedHosts}} and remove this IP from it if it is there.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12901711","id":"12901711","filename":"HIVE-18263.0.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szita","name":"szita","key":"szita","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Szita","active":true,"timeZone":"Europe/Budapest"},"created":"2017-12-12T16:15:31.789+0000","size":1262,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12901711/HIVE-18263.0.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12902084","id":"12902084","filename":"HIVE-18263.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szita","name":"szita","key":"szita","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Szita","active":true,"timeZone":"Europe/Budapest"},"created":"2017-12-14T14:44:53.178+0000","size":1665,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12902084/HIVE-18263.1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Ptest execution are multiple times slower sometimes due to dying executor slaves","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szita","name":"szita","key":"szita","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Szita","active":true,"timeZone":"Europe/Budapest"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szita","name":"szita","key":"szita","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Szita","active":true,"timeZone":"Europe/Budapest"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16287816","id":"16287816","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szita","name":"szita","key":"szita","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Szita","active":true,"timeZone":"Europe/Budapest"},"body":"[~pvary], [~zsombor.klara] can you take a look please?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szita","name":"szita","key":"szita","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Szita","active":true,"timeZone":"Europe/Budapest"},"created":"2017-12-12T16:16:31.142+0000","updated":"2017-12-12T16:16:31.142+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16287840","id":"16287840","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=asherman","name":"asherman","key":"asherman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=asherman&avatarId=31918","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=asherman&avatarId=31918","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=asherman&avatarId=31918","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=asherman&avatarId=31918"},"displayName":"Andrew Sherman","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~szita] for working on this important but unglamourous issue","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=asherman","name":"asherman","key":"asherman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=asherman&avatarId=31918","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=asherman&avatarId=31918","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=asherman&avatarId=31918","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=asherman&avatarId=31918"},"displayName":"Andrew Sherman","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-12-12T16:35:08.720+0000","updated":"2017-12-12T16:35:08.720+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16287929","id":"16287929","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"HIVE-15102 looks related and had some discussion on the topic.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-12-12T17:08:39.946+0000","updated":"2017-12-12T17:08:39.946+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16287976","id":"16287976","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zsombor.klara","name":"zsombor.klara","key":"zsombor.klara","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Barna Zsombor Klara","active":true,"timeZone":"Europe/Budapest"},"body":"Thank you for the patch Adam and for the detailed analysis. Just one minor question:\r\nAny reason we gather all the addresses into one set then iterate over the set instead of iterating over the nodes and iterating in a nested manner over the addresses to remove them from the failed hosts collection?\r\nNot a big issue, I'm just curious.\r\nOtherwise +1.\r\n\r\n[~spena] based on the linked Jira it seems you came to a different conclusion, that the ips cannot clash between the killed and the live hosts. Would you please help in clarifying what is/can be going on here? I'm confused.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zsombor.klara","name":"zsombor.klara","key":"zsombor.klara","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Barna Zsombor Klara","active":true,"timeZone":"Europe/Budapest"},"created":"2017-12-12T17:57:43.454+0000","updated":"2017-12-12T18:03:57.388+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16288034","id":"16288034","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"| (x) *{color:red}-1 overall{color}* |\r\n\\\\\r\n\\\\\r\n|| Vote || Subsystem || Runtime || Comment ||\r\n|| || || || {color:brown} Prechecks {color} ||\r\n| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m  0s{color} | {color:blue} Findbugs executables are not available. {color} |\r\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  1s{color} | {color:green} The patch does not contain any @author tags. {color} |\r\n|| || || || {color:brown} master Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  6m 51s{color} | {color:green} master passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 10s{color} | {color:green} master passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 10s{color} | {color:green} master passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 12s{color} | {color:green} master passed {color} |\r\n|| || || || {color:brown} Patch Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 13s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m  9s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javac {color} | {color:green}  0m  9s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m  9s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m  9s{color} | {color:green} the patch passed {color} |\r\n|| || || || {color:brown} Other Tests {color} ||\r\n| {color:red}-1{color} | {color:red} asflicense {color} | {color:red}  0m 11s{color} | {color:red} The patch generated 3 ASF License warnings. {color} |\r\n| {color:black}{color} | {color:black} {color} | {color:black}  8m 29s{color} | {color:black} {color} |\r\n\\\\\r\n\\\\\r\n|| Subsystem || Report/Notes ||\r\n| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  |\r\n| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u1 (2016-09-03) x86_64 GNU/Linux |\r\n| Build tool | maven |\r\n| Personality | /data/hiveptest/working/yetus/dev-support/hive-personality.sh |\r\n| git revision | master / d6ce23d |\r\n| Default Java | 1.8.0_111 |\r\n| asflicense | http://104.198.109.242/logs//PreCommit-HIVE-Build-8198/yetus/patch-asflicense-problems.txt |\r\n| modules | C: testutils/ptest2 U: testutils/ptest2 |\r\n| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-8198/yetus.txt |\r\n| Powered by | Apache Yetus    http://yetus.apache.org |\r\n\r\n\r\nThis message was automatically generated.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-12-12T18:37:31.196+0000","updated":"2017-12-12T18:37:31.196+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16288151","id":"16288151","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12901711/HIVE-18263.0.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 14 failed/errored test(s), 11499 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.org.apache.hadoop.hive.cli.TestCliDriver (batchId=85)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_join25] (batchId=72)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_sortmerge_join_2] (batchId=48)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[mapjoin_hook] (batchId=12)\norg.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[llap_smb] (batchId=151)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[hybridgrace_hashjoin_2] (batchId=157)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=165)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[llap_acid] (batchId=169)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[llap_acid_fast] (batchId=160)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[sysdb] (batchId=160)\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[authorization_part] (batchId=93)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[subquery_multi] (batchId=113)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testConstraints (batchId=226)\norg.apache.hive.service.cli.TestEmbeddedThriftBinaryCLIService.testExecuteStatementParallel (batchId=230)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/8198/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/8198/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-8198/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.YetusPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 14 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12901711 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-12-12T19:35:26.827+0000","updated":"2017-12-12T19:35:26.827+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16289154","id":"16289154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szita","name":"szita","key":"szita","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Szita","active":true,"timeZone":"Europe/Budapest"},"body":"I believe the description of HIVE-15102 says exactly what happens and matches what I have been observing, but I disagree with the proposed solution and the conclusion as well.\r\n\r\nI'm showing here an example of this issue through slave with IP 35.225.218.206, that was killed during a job unnecessarily. I'm also providing some snippets of logs of [PreCommit-HIVE-Build/8176|https://builds.apache.org/job/PreCommit-HIVE-Build/8176/consoleFull]\r\n\r\n\r\nTomcat was just started and the first job assigned to it was PreCommit-HIVE-Build/8176/.\r\nOn hiveptest-server-upstream, /data/hiveptest/hosts file contains 35.225.218.206 even right now, and was contained on 2017-12-11 morning as well.\r\nAlthough I don't have all the server logs from that time now, we will see that upon initalization this host was killed, and then a new one was created with same IP.\r\n\r\nJenkins has started running the job at 2017-12-11T09:31:55Z as seen at the beginning of the logs:\r\n{code}\r\n....\r\n[INFO] Copying spring-webmvc-3.2.16.RELEASE.jar to /home/jenkins/jenkins-slave/workspace/PreCommit-HIVE-Build/hive/build/hive/testutils/ptest2/target/lib/spring-webmvc-3.2.16.RELEASE.jar\r\n[INFO] Copying velocity-1.7.jar to /home/jenkins/jenkins-slave/workspace/PreCommit-HIVE-Build/hive/build/hive/testutils/ptest2/target/lib/velocity-1.7.jar\r\n[INFO] ------------------------------------------------------------------------\r\n[INFO] BUILD SUCCESS\r\n[INFO] ------------------------------------------------------------------------\r\n[INFO] Total time: 9.239 s\r\n[INFO] Finished at: 2017-12-11T09:31:55Z\r\n[INFO] Final Memory: 37M/913M\r\n[INFO] ------------------------------------------------------------------------\r\n+ local 'PTEST_CLASSPATH=/home/jenkins/jenkins-slave/workspace/PreCommit-HIVE-Build/hive/build/hive/testutils/ptest2/target/hive-ptest-3.0-classes.jar:/home/jenkins/jenkins-slave/workspace/PreCommit-HIVE-Build/hive/build/hive/testutils/ptest2/target/lib/*'\r\n+ java -cp '/home/jenkins/jenkins-slave/workspace/PreCommit-HIVE-Build/hive/build/hive/testutils/ptest2/target/hive-ptest-3.0-classes.jar:/home/jenkins/jenkins-slave/workspace/PreCommit-HIVE-Build/hive/build/hive/testutils/ptest2/target/lib/*' org.apache....\r\n{code}\r\n\r\nHere unfortunately we don't have logs from the server, what happens is basically the server is reading the hosts file, terminating any running nodes that are found in this file and then creating 12 new executors.\r\nThis takes time because only 2 executors are created simultaneously, and there is a wait time in between them, hence the log of jenkins shows what happens when ptest already created the slaves: (you can see 35.225.218.206 in the middle)\r\n\r\n{code}\r\n2017-12-11 09:49:35,101  INFO [TestExecutor] LocalCommand.awaitProcessCompletion:67 Finished LocalCommandId=46. ElapsedTime(ms)=296543\r\n2017-12-11 09:49:35,101 DEBUG [TestExecutor] PrepPhase.execute:68 Deleting /data/hiveptest/working/scratch/source-prep.sh: true\r\n2017-12-11 09:49:35,110  INFO [HostExecutor 3] LocalCommand.<init>:45 Starting LocalCommandId=48: ssh -v -i /home/hiveptest/.ssh/hive-ptest-user-key  -l hiveptest 104.198.217.87 'pkill -f java'\r\n2017-12-11 09:49:35,111  INFO [HostExecutor 0] LocalCommand.<init>:45 Starting LocalCommandId=50: ssh -v -i /home/hiveptest/.ssh/hive-ptest-user-key  -l hiveptest 35.184.147.31 'pkill -f java'\r\n2017-12-11 09:49:35,111  INFO [HostExecutor 1] LocalCommand.<init>:45 Starting LocalCommandId=49: ssh -v -i /home/hiveptest/.ssh/hive-ptest-user-key  -l hiveptest 35.224.37.167 'pkill -f java'\r\n2017-12-11 09:49:35,111  INFO [HostExecutor 2] LocalCommand.<init>:45 Starting LocalCommandId=47: ssh -v -i /home/hiveptest/.ssh/hive-ptest-user-key  -l hiveptest 35.184.14.247 'pkill -f java'\r\n2017-12-11 09:49:35,112  INFO [HostExecutor 6] LocalCommand.<init>:45 Starting LocalCommandId=55: ssh -v -i /home/hiveptest/.ssh/hive-ptest-user-key  -l hiveptest 35.184.205.41 'pkill -f java'\r\n2017-12-11 09:49:35,112  INFO [HostExecutor 8] LocalCommand.<init>:45 Starting LocalCommandId=54: ssh -v -i /home/hiveptest/.ssh/hive-ptest-user-key  -l hiveptest 35.192.223.60 'pkill -f java'\r\n2017-12-11 09:49:35,112  INFO [HostExecutor 7] LocalCommand.<init>:45 Starting LocalCommandId=53: ssh -v -i /home/hiveptest/.ssh/hive-ptest-user-key  -l hiveptest 35.192.216.79 'pkill -f java'\r\n2017-12-11 09:49:35,113  INFO [HostExecutor 4] LocalCommand.<init>:45 Starting LocalCommandId=51: ssh -v -i /home/hiveptest/.ssh/hive-ptest-user-key  -l hiveptest 35.225.218.206 'pkill -f java'\r\n2017-12-11 09:49:35,113  INFO [HostExecutor 5] LocalCommand.<init>:45 Starting LocalCommandId=52: ssh -v -i /home/hiveptest/.ssh/hive-ptest-user-key  -l hiveptest 35.188.119.125 'pkill -f java'\r\n2017-12-11 09:49:35,113  INFO [HostExecutor 9] LocalCommand.<init>:45 Starting LocalCommandId=56: ssh -v -i /home/hiveptest/.ssh/hive-ptest-user-key  -l hiveptest 35.225.33.208 'pkill -f java'\r\n2017-12-11 09:49:35,114  INFO [HostExecutor 10] LocalCommand.<init>:45 Starting LocalCommandId=57: ssh -v -i /home/hiveptest/.ssh/hive-ptest-user-key  -l hiveptest 35.224.189.104 'pkill -f java'\r\n2017-12-11 09:49:35,119  INFO [HostExecutor 11] LocalCommand.<init>:45 Starting LocalCommandId=58: ssh -v -i /home/hiveptest/.ssh/hive-ptest-user-key  -l hiveptest 104.198.248.189 'pkill -f java'\r\n{code}\r\n\r\nOur slave is now executing tests without a problem, the last good execution happens at 2017-12-11 10:29:29:\r\n{code}\r\n2017-12-11 10:29:29,710  INFO [HostExecutor 44] HostExecutor.executeTestBatch:261 Completed executing tests for batch [231_TestOperationLoggingAPIWithTez] on host 35.225.218.206. ElapsedTime(ms)=168594\r\n{code}\r\nThe next log entry about this host shows an error:\r\n{code}\r\n2017-12-11 10:41:23,413  WARN [HostExecutor 45] SSHCommandExecutor.execute:67 Command exited with 255, will retry: SSHCommand [command=bash /home/hiveptest/35.225.218.206-hiveptest-1/scratch/hiveptest-226_UTBatch_itests__hive-unit_9_tests.sh, getHost()=35.225.218.206, getInstance()=1]\r\n{code}\r\n\r\n..the host was killed in the meantime. And here we can see the server logs:\r\n\r\n{code}\r\n2017-12-11 10:31:50 INFO  [CloudExecutionContextProvider-BackgroundWorker] CloudExecutionContextProvider:363 - Submitting termination for {id=https://www.googleapis.com/compute/v1/projects/gcp-hive-upstream/zones/us-central1-a/instances/hive-ptest-slaves-c17, ....... group=hive-ptest-slaves, imageId=https://www.googleapis.com/compute/v1/projects/gcp-hive-upstream/global/images/hiveptest-slave-debian-8-20161003, status=RUNNING, loginPort=22, hostname=hive-ptest-slaves-c17, privateAddresses=[10.128.0.15], publicAddresses=[35.225.218.206], ...........\r\n2017-12-11 10:31:50 WARN  [CloudExecutionContextProvider-BackgroundWorker] CloudExecutionContextProvider:339 - Found zombie node: {id=https://www.googleapis.com/compute/v1/projects/gcp-hive-upstream/zones/us-central1-a/instances/hive-ptest-slaves-c17, providerId=3923746733594766760, uri=https://www.googleapis.com/compute/v1/projects/gcp-hive-upstream/zones/us-central1-a/instances/hive-ptest-slaves-c17, name=hive-ptest-slaves-c17, ........ group=hive-ptest-slaves, imageId=https://www.googleapis.com/compute/v1/projects/gcp-hive-upstream/global/images/hiveptest-slave-debian-8-20161003, status=RUNNING, loginPort=22, hostname=hive-ptest-slaves-c17, privateAddresses=[10.128.0.15], publicAddresses=[35.225.218.206], ...... previously terminated at Mon Dec 11 09:34:27 UTC 2017\r\n{code}\r\n\r\nI want to highlight *previously terminated at Mon Dec 11 09:34:27 UTC 2017*.\r\n\r\nSo:\r\n# 35.225.218.206 was in /data/hiveptest/hosts file and also running when tomcat was started at 9:30\r\n# so upon startup hiveptest terminated it, and put its IP into mTerminatedHosts\r\n# hiveptest started the hourly caretaker thread\r\n# hiveptest created 12 new executors, one of them with IP 35.225.218.206\r\n# tests were executed for an hour for job 8176\r\n# after an hour (at 10:31) the caretaker took a look on mTerminatedHosts and saw 35.225.218.206 in there, but also running. It thought that a previous termination have failed so it is retrying now..\r\n# our perfectly healthy host is now terminated, making the whole job running longer.\r\n\r\nSo it is very much likely to happen that a the same IP is given to a new node.\r\nThe solution in HIVE-15102 proposes to remove the IP from mTerminatedHosts when termination for it was submitted. This is actually against the whole point, (which I think is to try and terminate zombies that are costly to be alive (instructed to terminate but still alive)).\r\n\r\nI'd rather keep this functionality intact, and workaround this issue by removing the IP from mTerminatedHosts when we create a new slave with this IP. If the creation succeeded we can be sure that there is no zombie host on that IP, but a fresh one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szita","name":"szita","key":"szita","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Szita","active":true,"timeZone":"Europe/Budapest"},"created":"2017-12-13T11:45:56.179+0000","updated":"2017-12-13T11:45:56.179+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16289286","id":"16289286","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zsombor.klara","name":"zsombor.klara","key":"zsombor.klara","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Barna Zsombor Klara","active":true,"timeZone":"Europe/Budapest"},"body":"Based on the logs I tend to agree with [~szita] and the proposed patch is small with a very limited impact. Even if we misunderstood something here the possibility of regression is small.\r\nSo +1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zsombor.klara","name":"zsombor.klara","key":"zsombor.klara","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Barna Zsombor Klara","active":true,"timeZone":"Europe/Budapest"},"created":"2017-12-13T14:00:35.409+0000","updated":"2017-12-13T14:00:59.238+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16290901","id":"16290901","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pvary","name":"pvary","key":"pvary","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Vary","active":true,"timeZone":"Europe/Budapest"},"body":"We would like to deploy this proposed solution tomorrow morning CET.\r\nWith an additional log line showing the IP addresses of the hosts in the {{mTerminatedHosts}} map.\r\n\r\nPlease feel free to voice any concerns until then.\r\n\r\nThanks,\r\nPeter\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pvary","name":"pvary","key":"pvary","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Vary","active":true,"timeZone":"Europe/Budapest"},"created":"2017-12-14T14:24:53.435+0000","updated":"2017-12-14T14:24:53.435+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16290922","id":"16290922","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szita","name":"szita","key":"szita","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Szita","active":true,"timeZone":"Europe/Budapest"},"body":"Attached [^HIVE-18263.1.patch] with the additional logging included.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szita","name":"szita","key":"szita","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Szita","active":true,"timeZone":"Europe/Budapest"},"created":"2017-12-14T14:45:52.617+0000","updated":"2017-12-14T14:45:52.617+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16291945","id":"16291945","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"| (x) *{color:red}-1 overall{color}* |\r\n\\\\\r\n\\\\\r\n|| Vote || Subsystem || Runtime || Comment ||\r\n|| || || || {color:brown} Prechecks {color} ||\r\n| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m  1s{color} | {color:blue} Findbugs executables are not available. {color} |\r\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\r\n|| || || || {color:brown} master Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  7m  2s{color} | {color:green} master passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 12s{color} | {color:green} master passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 10s{color} | {color:green} master passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 12s{color} | {color:green} master passed {color} |\r\n|| || || || {color:brown} Patch Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 13s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m  9s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javac {color} | {color:green}  0m  9s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m  9s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 10s{color} | {color:green} the patch passed {color} |\r\n|| || || || {color:brown} Other Tests {color} ||\r\n| {color:red}-1{color} | {color:red} asflicense {color} | {color:red}  0m 12s{color} | {color:red} The patch generated 3 ASF License warnings. {color} |\r\n| {color:black}{color} | {color:black} {color} | {color:black}  8m 46s{color} | {color:black} {color} |\r\n\\\\\r\n\\\\\r\n|| Subsystem || Report/Notes ||\r\n| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  |\r\n| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u1 (2016-09-03) x86_64 GNU/Linux |\r\n| Build tool | maven |\r\n| Personality | /data/hiveptest/working/yetus/dev-support/hive-personality.sh |\r\n| git revision | master / e120bd8 |\r\n| Default Java | 1.8.0_111 |\r\n| asflicense | http://104.198.109.242/logs//PreCommit-HIVE-Build-8251/yetus/patch-asflicense-problems.txt |\r\n| modules | C: testutils/ptest2 U: testutils/ptest2 |\r\n| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-8251/yetus.txt |\r\n| Powered by | Apache Yetus    http://yetus.apache.org |\r\n\r\n\r\nThis message was automatically generated.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-12-15T02:31:36.434+0000","updated":"2017-12-15T02:31:36.434+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16291987","id":"16291987","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12902084/HIVE-18263.1.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 24 failed/errored test(s), 11497 tests executed\n*Failed tests:*\n{noformat}\nTestMiniLlapLocalCliDriver - did not produce a TEST-*.xml file (likely timed out) (batchId=168)\n\t[smb_mapjoin_15.q,vector_windowing_expressions.q,auto_join1.q,insert_values_partitioned.q,selectDistinctStar.q,vector_windowing_gby.q,vectorized_timestamp.q,bucket4.q,vector_groupby_mapjoin.q,cbo_subq_exists.q,insert_values_dynamic_partitioned.q,schema_evol_orc_vec_part_all_primitive.q,infer_bucket_sort_bucketed_table.q,cbo_union.q,filter_join_breaktask2.q,udaf_all_keyword.q,schema_evol_orc_vec_part.q,tez_self_join.q,vector_data_types.q,mm_conversions.q,vector_partitioned_date_time.q,schema_evol_orc_nonvec_part.q,dynamic_semijoin_reduction_2.q,vector_mapjoin_reduce.q,vectorization_3.q,auto_sortmerge_join_8.q,disable_merge_for_bucketing.q,vectorized_date_funcs.q,vector_varchar_simple.q,vector_adaptor_usage_mode.q]\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ppd_join5] (batchId=35)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[bucketsortoptimize_insert_2] (batchId=152)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[hybridgrace_hashjoin_2] (batchId=157)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=165)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[llap_acid] (batchId=169)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[llap_acid_fast] (batchId=160)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[quotedid_smb] (batchId=157)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[sysdb] (batchId=160)\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[archive_partspec2] (batchId=93)\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[authorization_alter_table_exchange_partition_fail] (batchId=93)\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[authorization_part] (batchId=93)\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[ctas_noemptyfolder] (batchId=93)\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[materialized_view_authorization_create_no_grant] (batchId=93)\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[materialized_view_authorization_drop_other] (batchId=93)\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[stats_aggregator_error_1] (batchId=93)\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[stats_publisher_error_1] (batchId=93)\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[subquery_notin_implicit_gby] (batchId=93)\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[truncate_bucketed_column] (batchId=93)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_sortmerge_join_10] (batchId=138)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[bucketsortoptimize_insert_7] (batchId=128)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[ppd_join5] (batchId=120)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[subquery_multi] (batchId=113)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testConstraints (batchId=226)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/8251/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/8251/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-8251/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.YetusPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 24 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12902084 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-12-15T03:33:34.240+0000","updated":"2017-12-15T03:33:34.240+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16292284","id":"16292284","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pvary","name":"pvary","key":"pvary","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Vary","active":true,"timeZone":"Europe/Budapest"},"body":"Pushed to master, and deployed the change.\r\nThanks for your work [~szita]!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pvary","name":"pvary","key":"pvary","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Vary","active":true,"timeZone":"Europe/Budapest"},"created":"2017-12-15T09:57:09.577+0000","updated":"2017-12-15T09:57:09.577+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16292354","id":"16292354","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szita","name":"szita","key":"szita","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Szita","active":true,"timeZone":"Europe/Budapest"},"body":"Thanks for reviewing [~zsombor.klara], and committing [~pvary]!\r\n\r\nThis morning after the change was committed I've restarted ptest2, and I've been monitoring its log:\r\nIt started by killing off the existing 12 slaves it was using before, and simultaneously creating 12 new ones, all according to plan:\r\n{code}\r\n2017-12-15 09:44:41 INFO  [localhost-startStop-1] ExecutionController:85 - Reading configuration from file: /opt/apache-tomcat-7.0.72/conf/cloudhost.properties\r\n2017-12-15 09:44:46 INFO  [localhost-startStop-1] CloudExecutionContextProvider:130 - CloudExecutionContextProvider maxHostsPerCreateRequest = 2\r\n2017-12-15 09:44:46 INFO  [localhost-startStop-1] CloudExecutionContextProvider:421 - Requesting termination of [35.225.33.208, 104.198.248.189, 35.184.205.41, 35.184.14.247, 35.192.52.184, 104.154.229.171, 35.192.216.79, 35.224.189.104, 35.184.147.31, 35.225.218.206, 104.198.217.87, 35.224.37.167]\r\n{code}\r\nOne hour later the caretaker thread saw the following IP's in {{mTerminatedHosts}}:\r\n{code}\r\n2017-12-15 10:44:51 INFO  [CloudExecutionContextProvider-BackgroundWorker] CloudExecutionContextProvider:340 - Performing background work\r\n2017-12-15 10:44:51 INFO  [CloudExecutionContextProvider-BackgroundWorker] CloudExecutionContextProvider:345 - Currently tracked terminated hosts: [35.225.33.208, 35.184.205.41, 104.154.229.171, 35.192.216.79, 35.184.147.31, 35.225.218.206, 35.224.37.167]\r\n{code}\r\n..and it did nothing after, killed no slaves.\r\n\r\nAll of these 7 IPs can be found in the list of 12 old slaves above (they were killed at startup). So without this change it is very likely that 5 slaves would've been killed during test execution unnecessarily.\r\n(e.g. host with IP 104.198.217.87 is not part of mTerminatedHosts, but it is running right now, and it reuses an IP from the old group)\r\n\r\nAll-in-all I believe this is working now as it should.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szita","name":"szita","key":"szita","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Szita","active":true,"timeZone":"Europe/Budapest"},"created":"2017-12-15T11:12:49.242+0000","updated":"2017-12-15T11:12:49.242+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13124184/comment/16485404","id":"16485404","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"This jira is resolved and released with Hive 3.0 If you find an issue with it, please create a new jira.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-05-22T23:15:54.894+0000","updated":"2018-05-22T23:15:54.894+0000"}],"maxResults":15,"total":15,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-18263/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3nruv:"}}