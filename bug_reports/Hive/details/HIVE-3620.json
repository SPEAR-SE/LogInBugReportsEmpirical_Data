{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12613534","self":"https://issues.apache.org/jira/rest/api/2/issue/12613534","key":"HIVE-3620","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-01-25T05:41:43.918+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Apr 18 21:24:57 UTC 2013","customfield_12310420":"251080","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-3620/watchers","watchCount":5,"isWatching":false},"created":"2012-10-25T18:30:45.863+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-04-18T21:24:57.216+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"hive> drop table load_test_table_20000_0;                                                                              \nFAILED: Error in metadata: org.apache.thrift.transport.TTransportException: java.net.SocketTimeoutException: Read timedout                                                                                                                    \nFAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask \n\nThe DB used is Oracle and hive had only one table:\nselect COUNT(*) from PARTITIONS;\n54839\n\nI can try and play around with the parameter hive.metastore.client.socket.timeout if that is what is being used. But it is 200 seconds as of now, and 200 seconds for a drop table calls seems high already.\n\nThanks,\nArup","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12579415","id":"12579415","filename":"Hive-3620_HeapDump.jpg","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thiruvel","name":"thiruvel","key":"thiruvel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thiruvel Thirumoolan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-18T20:53:28.429+0000","size":320829,"mimeType":"image/jpeg","content":"https://issues.apache.org/jira/secure/attachment/12579415/Hive-3620_HeapDump.jpg"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12579425","id":"12579425","filename":"HIVE-3620 Heapdump detail.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mithun","name":"mithun","key":"mithun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mithun&avatarId=18936","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mithun&avatarId=18936","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mithun&avatarId=18936","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mithun&avatarId=18936"},"displayName":"Mithun Radhakrishnan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-18T21:24:57.210+0000","size":197416,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12579425/HIVE-3620+Heapdump+detail.png"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"62765","customfield_12312823":null,"summary":"Drop table using hive CLI throws error when the total number of partition in the table is around 50K.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amalakar","name":"amalakar","key":"amalakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=amalakar&avatarId=19604","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=amalakar&avatarId=19604","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=amalakar&avatarId=19604","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=amalakar&avatarId=19604"},"displayName":"Arup Malakar","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amalakar","name":"amalakar","key":"amalakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=amalakar&avatarId=19604","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=amalakar&avatarId=19604","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=amalakar&avatarId=19604","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=amalakar&avatarId=19604"},"displayName":"Arup Malakar","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12613534/comment/13562444","id":"13562444","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sho.shimauchi","name":"sho.shimauchi","key":"sho.shimauchi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sho Shimauchi","active":true,"timeZone":"Asia/Tokyo"},"body":"Hi Arup,\n\nCurrent version of Hive fetches only 1000 partitions information at a time.\nIncreasing hive.metastore.batch.retrieve.table.partition.max may solve this issue.\nThis change can cause OOME on your client.\nIf you hit heap error, please increase the heap size of the client and try again. \n\nSee HIVE-2907 for more details.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sho.shimauchi","name":"sho.shimauchi","key":"sho.shimauchi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sho Shimauchi","active":true,"timeZone":"Asia/Tokyo"},"created":"2013-01-25T05:41:43.918+0000","updated":"2013-01-25T05:41:43.918+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12613534/comment/13627148","id":"13627148","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amalakar","name":"amalakar","key":"amalakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=amalakar&avatarId=19604","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=amalakar&avatarId=19604","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=amalakar&avatarId=19604","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=amalakar&avatarId=19604"},"displayName":"Arup Malakar","active":true,"timeZone":"America/Los_Angeles"},"body":"Error log I see in the server is:\n{code}\n2013-04-09 19:47:41,955 ERROR thrift.ProcessFunction (ProcessFunction.java:process(41)) - Internal error processing get_databasejava.lang.OutOfMemoryError: Java heap space        at java.lang.AbstractStringBuilder.<init>(AbstractStringBuilder.java:45)        at java.lang.StringBuilder.<init>(StringBuilder.java:80)        at oracle.net.ns.Packet.<init>(Packet.java:513)        at oracle.net.ns.Packet.<init>(Packet.java:142)\n        at oracle.net.ns.NSProtocol.connect(NSProtocol.java:279)\n        at oracle.jdbc.driver.T4CConnection.connect(T4CConnection.java:1042)\n        at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:301)\n        at oracle.jdbc.driver.PhysicalConnection.<init>(PhysicalConnection.java:531)        at oracle.jdbc.driver.T4CConnection.<init>(T4CConnection.java:221)        at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:32)        at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:503)        at yjava.database.jdbc.oracle.KeyDbDriverWrapper.connect(KeyDbDriverWrapper.java:81)        at java.sql.DriverManager.getConnection(DriverManager.java:582)        at java.sql.DriverManager.getConnection(DriverManager.java:185)        at org.apache.commons.dbcp.DriverManagerConnectionFactory.createConnection(DriverManagerConnectionFactory.java:75)        at org.apache.commons.dbcp.PoolableConnectionFactory.makeObject(PoolableConnectionFactory.java:582)\n        at org.apache.commons.pool.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:1148)\n        at org.apache.commons.dbcp.PoolingDataSource.getConnection(PoolingDataSource.java:106)\n        at org.datanucleus.store.rdbms.ConnectionProviderPriorityList.getConnection(ConnectionProviderPriorityList.java:57)\n        at org.datanucleus.store.rdbms.ConnectionFactoryImpl$ManagedConnectionImpl.getConnection(ConnectionFactoryImpl.java:363)\n        at org.datanucleus.store.rdbms.ConnectionFactoryImpl$ManagedConnectionImpl.getXAResource(ConnectionFactoryImpl.java:322)\n        at org.datanucleus.store.connection.ConnectionManagerImpl.enlistResource(ConnectionManagerImpl.java:388)\n        at org.datanucleus.store.connection.ConnectionManagerImpl.allocateConnection(ConnectionManagerImpl.java:253)\n        at org.datanucleus.store.connection.AbstractConnectionFactory.getConnection(AbstractConnectionFactory.java:60)\n        at org.datanucleus.store.AbstractStoreManager.getConnection(AbstractStoreManager.java:338)\n        at org.datanucleus.store.AbstractStoreManager.getConnection(AbstractStoreManager.java:307)\n        at org.datanucleus.store.rdbms.query.JDOQLQuery.performExecute(JDOQLQuery.java:582)\n        at org.datanucleus.store.query.Query.executeQuery(Query.java:1692)\n        at org.datanucleus.store.query.Query.executeWithArray(Query.java:1527)\n        at org.datanucleus.jdo.JDOQuery.execute(JDOQuery.java:243)\n        at org.apache.hadoop.hive.metastore.ObjectStore.getMDatabase(ObjectStore.java:405)\n        at org.apache.hadoop.hive.metastore.ObjectStore.getDatabase(ObjectStore.java:424)\n{code}\n\nShow table takes time too:\n{code}\nhive> show tables;\nOK\nload_test_table_20000_0\ntestTime taken: 285.705 seconds\n\nLog in server:\n\n2013-04-09 19:53:52,783 INFO  metastore.HiveMetaStore (HiveMetaStore.java:logInfo(434)) - 5: get_database: default\n2013-04-09 19:54:09,143 INFO  metastore.HiveMetaStore (HiveMetaStore.java:newRawStore(391)) - 5: Opening raw store with implemenation class:org.apache.hadoop.hive.metastore.ObjectStore\n2013-04-09 19:57:44,812 INFO  metastore.ObjectStore (ObjectStore.java:initialize(222)) - ObjectStore, initialize called\n2013-04-09 19:57:44,816 INFO  metastore.ObjectStore (ObjectStore.java:setConf(205)) - Initialized ObjectStore\n2013-04-09 19:57:51,700 INFO  metastore.HiveMetaStore (HiveMetaStore.java:logInfo(434)) - 6: get_database: default\n2013-04-09 19:57:51,706 INFO  metastore.HiveMetaStore (HiveMetaStore.java:newRawStore(391)) - 6: Opening raw store with implemenation class:org.apache.hadoop.hive.metastore.ObjectStore\n2013-04-09 19:57:51,712 INFO  metastore.ObjectStore (ObjectStore.java:initialize(222)) - ObjectStore, initialize called\n2013-04-09 19:57:51,714 INFO  metastore.ObjectStore (ObjectStore.java:setConf(205)) - Initialized ObjectStore\n2013-04-09 19:57:52,048 INFO  metastore.HiveMetaStore (HiveMetaStore.java:logInfo(434)) - 6: get_tables: db=default pat=.*\n2013-04-09 19:57:52,262 ERROR DataNucleus.Transaction (Log4JLogger.java:error(115)) - Operation rollback failed on resource: org.datanucleus.store.rdbms.ConnectionFactoryImpl$EmulatedXAResource@18d3a2f, error code UNKNOWN and transaction: [DataNucleus Transaction, ID=Xid=�, enlisted resources=[org.datanucleus.store.rdbms.ConnectionFactoryImpl$EmulatedXAResource@18d3a2f]]\n2013-04-09 19:57:52,262 ERROR DataNucleus.Transaction (Log4JLogger.java:error(115)) - Operation rollback failed on resource: org.datanucleus.store.rdbms.ConnectionFactoryImpl$EmulatedXAResource@18d3a2f, error code UNKNOWN and transaction: [DataNucleus Transaction, ID=Xid=�, enlisted resources=[org.datanucleus.store.rdbms.ConnectionFactoryImpl$EmulatedXAResource@18d3a2f]]\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amalakar","name":"amalakar","key":"amalakar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=amalakar&avatarId=19604","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=amalakar&avatarId=19604","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=amalakar&avatarId=19604","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=amalakar&avatarId=19604"},"displayName":"Arup Malakar","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-09T21:42:26.296+0000","updated":"2013-04-09T21:42:26.296+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12613534/comment/13627283","id":"13627283","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thiruvel","name":"thiruvel","key":"thiruvel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thiruvel Thirumoolan","active":true,"timeZone":"America/Los_Angeles"},"body":"I have had this problem in the past (in my case 0.2 million partitions, was stress testing dynamic partitions). Metastore crashes badly, may be mine was a remote situation. The workaround I did was to drop one hierarchy of partition. In my case, there were many partition keys and I used to drop the topmost one instead of dropping the table.\n\nMay be its worthwhile to visit HIVE-3214 and see if there is anything we could do at datanucleus end.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thiruvel","name":"thiruvel","key":"thiruvel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thiruvel Thirumoolan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-09T23:50:33.775+0000","updated":"2013-04-09T23:50:33.775+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12613534/comment/13635676","id":"13635676","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thiruvel","name":"thiruvel","key":"thiruvel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thiruvel Thirumoolan","active":true,"timeZone":"America/Los_Angeles"},"body":"[~sho.shimauchi] Did you have any special parameters for datanucleus to get this working? I tried disabling datanucleus cache and also set connection pools, but that does not seem to help. Will also post a snapshot of memory dump I have. BTW, I tried dropping a table with 45k partitions with the batch size configured to 100 and 1000.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thiruvel","name":"thiruvel","key":"thiruvel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thiruvel Thirumoolan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-18T20:50:48.173+0000","updated":"2013-04-18T20:50:48.173+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12613534/comment/13635711","id":"13635711","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mithun","name":"mithun","key":"mithun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mithun&avatarId=18936","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mithun&avatarId=18936","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mithun&avatarId=18936","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mithun&avatarId=18936"},"displayName":"Mithun Radhakrishnan","active":true,"timeZone":"America/Los_Angeles"},"body":"Just to add even more detail, this leak-report indicates Datanucleus's ConnectionFactoryImpl seems to retain a majority of the memory being leaked (440 MB, in this case).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mithun","name":"mithun","key":"mithun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mithun&avatarId=18936","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mithun&avatarId=18936","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mithun&avatarId=18936","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mithun&avatarId=18936"},"displayName":"Mithun Radhakrishnan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-18T21:24:57.213+0000","updated":"2013-04-18T21:24:57.213+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-3620/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0b413:"}}