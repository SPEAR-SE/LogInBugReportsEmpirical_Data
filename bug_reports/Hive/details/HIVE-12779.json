{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12927238","self":"https://issues.apache.org/jira/rest/api/2/issue/12927238","key":"HIVE-12779","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-03-21T11:22:49.185+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue May 31 11:10:39 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-12779/watchers","watchCount":6,"isWatching":false},"created":"2016-01-05T10:46:15.317+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alangates","name":"alangates","key":"alangates","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alan Gates","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-05-31T11:10:39.753+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12317906","id":"12317906","name":"Database/Schema","description":"Issues related to support for multiple Datasbases/Schemas"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12315100","id":"12315100","name":"SQL","description":"Issues related to Hive Query Language and its conformance with ANSI SQL."}],"timeoriginalestimate":null,"description":"I face a buffer underflow problem when inserting data to table from hive 1.1.0.\n\nthe block size is 128 MB and the data size is only 10MB, but it gives me 891 mappers.\n\nTask with the most failures(4):\n-----\nTask ID:\n  task_1451989578563_0001_m_000008\n\nURL:\n  http://0.0.0.0:8088/taskdetails.jsp?jobid=job_1451989578563_0001&tipid=task_1451989578563_0001_m_000008\n-----\nDiagnostic Messages for this Task:\nError: java.lang.RuntimeException: Failed to load plan: hdfs://tpe-nn-3-1:8020/tmp/hive/alec.tu/af798488-dbf5-45da-8adb-e4f2ddde1242/hive_2016-01-05_18-34-26_864_3947114301988950007-1/-mr-10004/bb86c923-0dca-43cd-aa5d-ef575d764e06/map.xml: org.apache.hive.com.esotericsoftware.kryo.KryoException: Buffer underflow.\n        at org.apache.hadoop.hive.ql.exec.Utilities.getBaseWork(Utilities.java:450)\n        at org.apache.hadoop.hive.ql.exec.Utilities.getMapWork(Utilities.java:296)\n        at org.apache.hadoop.hive.ql.io.HiveInputFormat.init(HiveInputFormat.java:268)\n        at org.apache.hadoop.hive.ql.io.HiveInputFormat.getRecordReader(HiveInputFormat.java:234)\n        at org.apache.hadoop.hive.ql.io.CombineHiveInputFormat.getRecordReader(CombineHiveInputFormat.java:701)\n        at org.apache.hadoop.mapred.MapTask$TrackedRecordReader.<init>(MapTask.java:169)\n        at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:432)\n        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:343)\n        at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:163)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:415)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1671)\n        at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)\nCaused by: org.apache.hive.com.esotericsoftware.kryo.KryoException: Buffer underflow.\n        at org.apache.hive.com.esotericsoftware.kryo.io.Input.require(Input.java:181)\n        at org.apache.hive.com.esotericsoftware.kryo.io.Input.readBoolean(Input.java:783)\n        at org.apache.hive.com.esotericsoftware.kryo.serializers.UnsafeCacheFields$UnsafeBooleanField.read(UnsafeCacheFields.java:120)\n        at org.apache.hive.com.esotericsoftware.kryo.serializers.FieldSerializer.read(FieldSerializer.java:507)\n        at org.apache.hive.com.esotericsoftware.kryo.Kryo.readObject(Kryo.java:672)\n        at org.apache.hadoop.hive.ql.exec.Utilities.deserializeObjectByKryo(Utilities.java:1069)\n        at org.apache.hadoop.hive.ql.exec.Utilities.deserializePlan(Utilities.java:960)\n        at org.apache.hadoop.hive.ql.exec.Utilities.deserializePlan(Utilities.java:974)\n        at org.apache.hadoop.hive.ql.exec.Utilities.getBaseWork(Utilities.java:416)\n        ... 12 more\n\nContainer killed by the ApplicationMaster.\nContainer killed on request. Exit code is 143\nContainer exited with a non-zero exit code 143\n\nThank you.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329363","id":"12329363","name":"1.1.0","archived":false,"released":true,"releaseDate":"2015-03-07"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Buffer underflow when inserting data to table","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alec.tu","name":"alec.tu","key":"alec.tu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ming Hsuan Tu","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alec.tu","name":"alec.tu","key":"alec.tu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ming Hsuan Tu","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"CDH 5.4.9","customfield_12313520":null,"customfield_12311020":null,"duedate":"2016-01-31","customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12927238/comment/15204052","id":"15204052","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alina.abramova","name":"alina.abramova","key":"alina.abramova","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alina.abramova&avatarId=26003","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alina.abramova&avatarId=26003","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alina.abramova&avatarId=26003","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alina.abramova&avatarId=26003"},"displayName":"Alina Abramova","active":true,"timeZone":"Europe/Kiev"},"body":"I investigated this issue and see that this bug appears randomly and for me only in case concurrently running jobs in Hive which address to the same table. I ran two queries in two beelines and about one of thirty attempts finished with this exception. After investigating issues with kryo's serializer I found that this exception appears in few cases:\n1) Kryo is used in multithreading env. But I see that in Hive kryo created as thread local variable and this case is excluded, I think\n2) Two Input uses the same buffer. As example\nInput inp1 = new Input(buff);\nInput inp2 = new Input(buff);\nFor me suspected causes cases when Hive receives the stream to read from FileSystem, maybe two threads use the one path for reading a plan, but, in theory, it is excluded, because jobs can not have the one plan with one path.\n3) When output stream was not closed after serialization, but I did not found such incidents in Hive's code after HIVE-8688.\n\nMaybe reporter could give more information about the query for finding 100% reproducable case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alina.abramova","name":"alina.abramova","key":"alina.abramova","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=alina.abramova&avatarId=26003","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alina.abramova&avatarId=26003","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alina.abramova&avatarId=26003","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alina.abramova&avatarId=26003"},"displayName":"Alina Abramova","active":true,"timeZone":"Europe/Kiev"},"created":"2016-03-21T11:22:49.185+0000","updated":"2016-03-21T11:22:49.185+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12927238/comment/15296115","id":"15296115","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=osayankin","name":"osayankin","key":"osayankin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=osayankin&avatarId=34533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=osayankin&avatarId=34533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=osayankin&avatarId=34533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=osayankin&avatarId=34533"},"displayName":"Oleksiy Sayankin","active":true,"timeZone":"Etc/UTC"},"body":"Steps to reproduce:\n\n*STEP 1. Create tables temp.test with over 1 000 000 of rows*\n\nCreate test file test.csv with 1 000 000 lines of random test data of according types to table.\n\n*STEP 2. Create folders in hdfs*\n\n{code}\nsudo -u mapr hadoop fs -mkdir /temp\nsudo -u mapr hadoop fs -mkdir /temp/step5\nsudo -u mapr hadoop fs -mkdir /temp/step6\n{code}\n\n*STEP 3 Create test table and upload data*\n\n{code}\nCREATE TABLE temp.test \n(id INT, a1 BIGINT, a2 BIGINT, b1 BOOLEAN, b2 BOOLEAN,\nc1 DECIMAL(10,5), c2 DECIMAL(10,5), d1 DOUBLE, d2 DOUBLE, e1 FLOAT,\ne2 FLOAT, f1 INT, f2 INT, g1 SMALLINT, g2 SMALLINT,\nh1 STRING, h2 STRING, i1 TIMESTAMP, i2 TIMESTAMP, j1 TINYINT,\nj2 TINYINT, k1 CHAR(22), k2 CHAR(22), l1 VARCHAR(22), l2 VARCHAR(22))\nROW FORMAT DELIMITED FIELDS TERMINATED BY \",\";\n{code}\n\n{code}\nhadoop fs -put ~/test.csv /user/hive/warehouse/temp.db/test;\n{code}\n\n*STEP 4. Create tables temp.step5 and temp.step6 using queries below*\n\n{code}\nCREATE TABLE temp.step5\n{code}\n\n{code}\nCreate External Table if not exists temp.step5 (\ntrans_num decimal(10,5),\nstore_num bigint,\nquantity double,\nnet_price double,\nweight double,\noperating_company string,\nbanner string,\nproduct_id_hormel_rev3 int,\nexposed_flag int,\ntm_dim_key_week bigint,\nexperian_id bigint,\nunits int,\ncents int,\nbaseline_units double,\nbaseline_cents double,\ncoupon int,\nfeature int,\ndisplay int,\ntotl_prc_reduc int,\nfeature_or_display int,\nany_promo int,\ncoupon_occasions int,\nfeature_occasions int,\ndisplay_occasions int,\nprice_reduction_occasions int,\nfeature_or_display_occasions int,\nany_promo_occasions int,\ncoupon_dollars double,\ncoupon_units int,\nperiod int,\nestimated_hh_income string,\nstate string,\ncounty_code string,\nlatitude string,\nlongitude string,\ncape_age_pop_pct_0_17 string,\ncape_age_pop_pct_65_99_plus string,\ncape_age_pop_pct_18_99_plus string,\ncape_age_pop_median_age string,\ncape_ethnic_pop_pct_white_only string,\ncape_ethnic_pop_pct_black_only string,\ncape_ethnic_pop_pct_asian_only string,\ncape_ethnic_pop_pct_hispanic string,\ncape_child_hh_pct_with_persons_lt18 string,\ncape_child_hh_pct_marr_couple_famwith_persons_lt18 string,\ncape_typ_hh_pct_married_couple_family string,\ncape_tenancy_occhu_pct_owner_occupied string,\ncape_tenancy_occhu_pct_renter_occupied string,\ncape_hhsize_hh_average_household_size string,\ncape_density_persons_per_hh_for_pop_in_hh string,\ncape_homval_oohu_median_home_value string,\ncape_hustr_hu_pct_mobile_home string,\ncape_built_hu_median_housing_unit_age string,\ncape_lang_hh_pct_spanish_speaking string,\ncape_educ_pop25_plus_median_education_attained string,\ncape_inc_hh_median_family_household_income string,\ncape_educ_ispsa_decile string,\ncape_inc_family_inc_state_decile string,\ncensus_rural_urban_county_size_code string,\ncore_based_statistical_areas string,\nperson_1_birth_year_and_month string,\nperson_1_combined_age string,\nperson_1_gender string,\nperson_1_marital_status string,\nrecipient_reliability_code string,\nhousehold_composition string,\nperson_1_person_type string,\nhomeowner_combined_homeowner string,\nhomeowner_probability_model string,\ndwelling_type string,\nlength_of_residence string,\ndwelling_unit_size string,\nnumber_of_children_in_living_unit string,\nnumber_of_adults_in_living_unit string,\nnumber_of_person_in_living_unit string,\nmail_responder string,\nmosaic_hh string)\nROW FORMAT DELIMITED FIELDS TERMINATED BY ',' LOCATION '/temp/step5';\n{code}\n\n{code}\nCREATE TABLE temp.step6\n{code}\n\n{code}\nCreate External Table if not exists temp.step6\n(\nexperian_id bigint,                                  \nexposed_flag int,                                   \nbanner STRING,                                        \nProduct_0_Quantity_PRE STRING,                        \nProduct_1_Quantity_PRE STRING,                       \nProduct_2_Quantity_PRE STRING,                       \nProduct_3_Quantity_PRE STRING,                       \nProduct_4_Quantity_PRE STRING,                       \nProduct_5_Quantity_PRE STRING,                       \nProduct_6_Quantity_PRE STRING,                       \nProduct_7_Quantity_PRE STRING,  \nProduct_8_Quantity_PRE STRING,              \nProduct_0_Quantity_POS STRING,\n\nProduct_1_Quantity_POS STRING,                       \nProduct_2_Quantity_POS STRING,                       \nProduct_3_Quantity_POS STRING,                       \nProduct_4_Quantity_POS STRING,                       \nProduct_5_Quantity_POS STRING,                       \nProduct_6_Quantity_POS STRING,                       \nProduct_7_Quantity_POS STRING,   \nProduct_8_Quantity_POS STRING,\n\nProduct_0_Net_Price_PRE STRING ,                      \nProduct_1_Net_Price_PRE STRING ,                      \nProduct_2_Net_Price_PRE STRING ,                      \nProduct_3_Net_Price_PRE STRING ,                      \nProduct_4_Net_Price_PRE STRING ,                      \nProduct_5_Net_Price_PRE STRING ,                      \nProduct_6_Net_Price_PRE STRING ,                      \nProduct_7_Net_Price_PRE STRING ,                      \nProduct_8_Net_Price_PRE STRING ,\n\nProduct_0_Net_Price_POS STRING ,                      \nProduct_1_Net_Price_POS STRING ,                      \nProduct_2_Net_Price_POS STRING ,                      \nProduct_3_Net_Price_POS STRING ,                      \nProduct_4_Net_Price_POS STRING ,                      \nProduct_5_Net_Price_POS STRING ,                      \nProduct_6_Net_Price_POS STRING ,                      \nProduct_7_Net_Price_POS STRING ,                      \nProduct_8_Net_Price_POS STRING ,\n\nCoupon_Units_PRE_P0 STRING ,                          \nCoupon_Units_PRE_P1 STRING ,                          \nCoupon_Units_PRE_P2 STRING ,                          \nCoupon_Units_PRE_P3 STRING ,                          \nCoupon_Units_PRE_P4 STRING ,                          \nCoupon_Units_PRE_P5 STRING ,                          \nCoupon_Units_PRE_P6 STRING ,                          \nCoupon_Units_PRE_P7 STRING ,  \nCoupon_Units_PRE_P8 STRING ,         \n\nCoupon_Units_POS_P0 STRING ,                          \nCoupon_Units_POS_P1 STRING ,                          \nCoupon_Units_POS_P2 STRING ,                          \nCoupon_Units_POS_P3 STRING ,                          \nCoupon_Units_POS_P4 STRING ,                          \nCoupon_Units_POS_P5 STRING ,                          \nCoupon_Units_POS_P6 STRING ,                          \nCoupon_Units_POS_P7 STRING ,                          \nCoupon_Units_POS_P8 STRING ,\n\nCoupon_Dollars_PRE_P0   STRING ,                      \nCoupon_Dollars_PRE_P1   STRING ,                      \nCoupon_Dollars_PRE_P2   STRING ,                      \nCoupon_Dollars_PRE_P3   STRING ,                      \nCoupon_Dollars_PRE_P4   STRING ,                      \nCoupon_Dollars_PRE_P5   STRING ,                      \nCoupon_Dollars_PRE_P6   STRING ,                      \nCoupon_Dollars_PRE_P7   STRING ,\nCoupon_Dollars_PRE_P8   STRING ,                     \n\nCoupon_Dollars_POS_P0   STRING ,                      \nCoupon_Dollars_POS_P1   STRING ,                      \nCoupon_Dollars_POS_P2   STRING ,                      \nCoupon_Dollars_POS_P3   STRING ,                      \nCoupon_Dollars_POS_P4   STRING ,                      \nCoupon_Dollars_POS_P5   STRING ,                      \nCoupon_Dollars_POS_P6   STRING ,                      \nCoupon_Dollars_POS_P7   STRING ,\nCoupon_Dollars_POS_P8   STRING ,                      \n\nDollars_per_Trip_PRE_P0   STRING ,                    \nDollars_per_Trip_PRE_P1   STRING ,                    \nDollars_per_Trip_PRE_P2   STRING ,                    \nDollars_per_Trip_PRE_P3   STRING ,                    \nDollars_per_Trip_PRE_P4   STRING ,                    \nDollars_per_Trip_PRE_P5   STRING ,                    \nDollars_per_Trip_PRE_P6   STRING ,                    \nDollars_per_Trip_PRE_P7   STRING ,\nDollars_per_Trip_PRE_P8   STRING ,                    \n\nDollars_per_Trip_POS_P0   STRING ,                    \nDollars_per_Trip_POS_P1   STRING ,                    \nDollars_per_Trip_POS_P2   STRING ,                    \nDollars_per_Trip_POS_P3   STRING ,                    \nDollars_per_Trip_POS_P4   STRING ,                    \nDollars_per_Trip_POS_P5   STRING ,                    \nDollars_per_Trip_POS_P6   STRING ,                    \nDollars_per_Trip_POS_P7   STRING ,   \nDollars_per_Trip_POS_P8   STRING ,                  \n\nUnits_per_Trip_PRE_P0    STRING ,                     \nUnits_per_Trip_PRE_P1    STRING ,                     \nUnits_per_Trip_PRE_P2    STRING ,                     \nUnits_per_Trip_PRE_P3    STRING ,                     \nUnits_per_Trip_PRE_P4    STRING ,                     \nUnits_per_Trip_PRE_P5    STRING ,                     \nUnits_per_Trip_PRE_P6    STRING ,                     \nUnits_per_Trip_PRE_P7    STRING ,  \nUnits_per_Trip_PRE_P8    STRING ,                   \n\nUnits_per_Trip_POS_P0    STRING ,                     \nUnits_per_Trip_POS_P1    STRING ,                     \nUnits_per_Trip_POS_P2    STRING ,                     \nUnits_per_Trip_POS_P3    STRING ,                     \nUnits_per_Trip_POS_P4    STRING ,                     \nUnits_per_Trip_POS_P5    STRING ,                     \nUnits_per_Trip_POS_P6    STRING ,                     \nUnits_per_Trip_POS_P7    STRING ,                     \nUnits_per_Trip_POS_P8    STRING ,\n\nTrips_PRE_P0 STRING ,                                 \nTrips_PRE_P1 STRING ,                                 \nTrips_PRE_P2 STRING ,                                 \nTrips_PRE_P3 STRING ,                                 \nTrips_PRE_P4 STRING ,                                 \nTrips_PRE_P5 STRING ,                                 \nTrips_PRE_P6 STRING ,                                 \nTrips_PRE_P7 STRING ,   \nTrips_PRE_P8 STRING ,                              \n\nTrips_POS_P0 STRING ,                                 \nTrips_POS_P1 STRING ,                                 \nTrips_POS_P2 STRING ,                                 \nTrips_POS_P3 STRING ,                                 \nTrips_POS_P4 STRING ,                                 \nTrips_POS_P5 STRING ,                                 \nTrips_POS_P6 STRING ,                                 \nTrips_POS_P7 STRING ,                                 \nTrips_POS_P8 STRING ,\n\nCoupon_Dollars_per_Trip_Diff_PRE_POS_P1 STRING,      \nCoupon_Dollars_per_Trip_Diff_PRE_POS_P2 STRING,      \nCoupon_Dollars_per_Trip_Diff_PRE_POS_P3 STRING,      \nCoupon_Dollars_per_Trip_Diff_PRE_POS_P4 STRING,      \nCoupon_Dollars_per_Trip_Diff_PRE_POS_P5 STRING,      \nCoupon_Dollars_per_Trip_Diff_PRE_POS_P6 STRING,      \nCoupon_Dollars_per_Trip_Diff_PRE_POS_P7 STRING,  \nCoupon_Dollars_per_Trip_Diff_PRE_POS_P8 STRING,  \n\nPerc_Coupon_Dollars_P0_PRE  STRING ,                  \nPerc_Coupon_Dollars_P1_PRE  STRING ,                  \nPerc_Coupon_Dollars_P2_PRE  STRING ,                  \nPerc_Coupon_Dollars_P3_PRE  STRING ,                  \nPerc_Coupon_Dollars_P4_PRE  STRING ,                  \nPerc_Coupon_Dollars_P5_PRE  STRING ,                  \nPerc_Coupon_Dollars_P6_PRE  STRING ,                  \nPerc_Coupon_Dollars_P7_PRE  STRING ,                  \nPerc_Coupon_Dollars_P8_PRE  STRING ,\n\nPerc_Coupon_Dollars_P0_POS  STRING ,                  \nPerc_Coupon_Dollars_P1_POS  STRING ,                  \nPerc_Coupon_Dollars_P2_POS  STRING ,                  \nPerc_Coupon_Dollars_P3_POS  STRING ,                  \nPerc_Coupon_Dollars_P4_POS  STRING ,                  \nPerc_Coupon_Dollars_P5_POS  STRING ,                  \nPerc_Coupon_Dollars_P6_POS  STRING ,                  \nPerc_Coupon_Dollars_P7_POS  STRING ,   \nPerc_Coupon_Dollars_P8_POS  STRING ,                \n\nCoupon_Units_per_Trip_Diff_PRE_POS_P0   STRING,      \nCoupon_Units_per_Trip_Diff_PRE_POS_P1   STRING,      \nCoupon_Units_per_Trip_Diff_PRE_POS_P2   STRING,      \nCoupon_Units_per_Trip_Diff_PRE_POS_P3   STRING,      \nCoupon_Units_per_Trip_Diff_PRE_POS_P4   STRING,      \nCoupon_Units_per_Trip_Diff_PRE_POS_P5   STRING,      \nCoupon_Units_per_Trip_Diff_PRE_POS_P6   STRING,      \nCoupon_Units_per_Trip_Diff_PRE_POS_P7   STRING,      \nCoupon_Units_per_Trip_Diff_PRE_POS_P8   STRING,\n\nPerc_Coupon_Units_P0_PRE  STRING ,                    \nPerc_Coupon_Units_P1_PRE  STRING ,                    \nPerc_Coupon_Units_P2_PRE  STRING ,                    \nPerc_Coupon_Units_P3_PRE  STRING ,                    \nPerc_Coupon_Units_P4_PRE  STRING ,                    \nPerc_Coupon_Units_P5_PRE  STRING ,                    \nPerc_Coupon_Units_P6_PRE  STRING ,                    \nPerc_Coupon_Units_P7_PRE  STRING ,    \nPerc_Coupon_Units_P8_PRE  STRING ,                \n\nPerc_Coupon_Units_P0_POS  STRING ,                    \nPerc_Coupon_Units_P1_POS  STRING ,                    \nPerc_Coupon_Units_P2_POS  STRING ,                    \nPerc_Coupon_Units_P3_POS  STRING ,                    \nPerc_Coupon_Units_P4_POS  STRING ,                    \nPerc_Coupon_Units_P5_POS  STRING ,                    \nPerc_Coupon_Units_P6_POS  STRING ,                    \nPerc_Coupon_Units_P7_POS  STRING ,  \nPerc_Coupon_Units_P8_POS  STRING ,                  \n\nCoupon_Trips_Share_Diff_PRE_POS_P0 STRING,           \nCoupon_Trips_Share_Diff_PRE_POS_P1 STRING,           \nCoupon_Trips_Share_Diff_PRE_POS_P2 STRING,           \nCoupon_Trips_Share_Diff_PRE_POS_P3 STRING,           \nCoupon_Trips_Share_Diff_PRE_POS_P4 STRING,           \nCoupon_Trips_Share_Diff_PRE_POS_P5 STRING,           \nCoupon_Trips_Share_Diff_PRE_POS_P6 STRING,           \nCoupon_Trips_Share_Diff_PRE_POS_P7 STRING,  \nCoupon_Trips_Share_Diff_PRE_POS_P8 STRING,          \n\nPerc_Coupon_Trips__P0_PRE  STRING ,                 \nPerc_Coupon_Trips__P1_PRE  STRING ,                 \nPerc_Coupon_Trips__P2_PRE  STRING ,                 \nPerc_Coupon_Trips__P3_PRE  STRING ,                 \nPerc_Coupon_Trips__P4_PRE  STRING ,                 \nPerc_Coupon_Trips__P5_PRE  STRING ,                 \nPerc_Coupon_Trips__P6_PRE  STRING ,                 \nPerc_Coupon_Trips__P7_PRE  STRING ,  \nPerc_Coupon_Trips__P8_PRE  STRING ,               \n\nPerc_Coupon_Trips__P0_POS  STRING ,                 \nPerc_Coupon_Trips__P1_POS  STRING ,                 \nPerc_Coupon_Trips__P2_POS  STRING ,                 \nPerc_Coupon_Trips__P3_POS  STRING ,                 \nPerc_Coupon_Trips__P4_POS  STRING ,                 \nPerc_Coupon_Trips__P5_POS  STRING ,                 \nPerc_Coupon_Trips__P6_POS  STRING ,                 \nPerc_Coupon_Trips__P7_POS  STRING ,   \nPerc_Coupon_Trips__P8_POS  STRING ,               \n\nFeature_Trips_Share_Diff_PRE_POS_P0  STRING,         \nFeature_Trips_Share_Diff_PRE_POS_P1  STRING,         \nFeature_Trips_Share_Diff_PRE_POS_P2  STRING,         \nFeature_Trips_Share_Diff_PRE_POS_P3  STRING,         \nFeature_Trips_Share_Diff_PRE_POS_P4  STRING,         \nFeature_Trips_Share_Diff_PRE_POS_P5  STRING,         \nFeature_Trips_Share_Diff_PRE_POS_P6  STRING,         \nFeature_Trips_Share_Diff_PRE_POS_P7  STRING,         \nFeature_Trips_Share_Diff_PRE_POS_P8  STRING,\n\nPerc_Feature_Trips_P0_PRE    STRING ,                 \nPerc_Feature_Trips_P1_PRE    STRING ,                 \nPerc_Feature_Trips_P2_PRE    STRING ,                 \nPerc_Feature_Trips_P3_PRE    STRING ,                 \nPerc_Feature_Trips_P4_PRE    STRING ,                 \nPerc_Feature_Trips_P5_PRE    STRING ,                 \nPerc_Feature_Trips_P6_PRE    STRING ,                 \nPerc_Feature_Trips_P7_PRE     STRING ,   \nPerc_Feature_Trips_P8_PRE     STRING ,                \n\nPerc_Feature_Trips_P0_POS    STRING ,                 \nPerc_Feature_Trips_P1_POS    STRING ,                 \nPerc_Feature_Trips_P2_POS    STRING ,                 \nPerc_Feature_Trips_P3_POS    STRING ,                 \nPerc_Feature_Trips_P4_POS    STRING ,                 \nPerc_Feature_Trips_P5_POS    STRING ,                 \nPerc_Feature_Trips_P6_POS    STRING ,                 \nPerc_Feature_Trips_P7_POS    STRING ,  \nPerc_Feature_Trips_P8_POS    STRING ,                \n\nDisplay_Trips_Share_Diff_PRE_POS_P0  STRING,         \nDisplay_Trips_Share_Diff_PRE_POS_P1  STRING,         \nDisplay_Trips_Share_Diff_PRE_POS_P2  STRING,         \nDisplay_Trips_Share_Diff_PRE_POS_P3  STRING,         \nDisplay_Trips_Share_Diff_PRE_POS_P4  STRING,         \nDisplay_Trips_Share_Diff_PRE_POS_P5  STRING,         \nDisplay_Trips_Share_Diff_PRE_POS_P6  STRING,         \nDisplay_Trips_Share_Diff_PRE_POS_P7  STRING,  \nDisplay_Trips_Share_Diff_PRE_POS_P8  STRING,        \n\nPerc_Display_Trips_P0_PRE  STRING ,                   \nPerc_Display_Trips_P1_PRE  STRING ,                   \nPerc_Display_Trips_P2_PRE  STRING ,                   \nPerc_Display_Trips_P3_PRE  STRING ,                   \nPerc_Display_Trips_P4_PRE  STRING ,                   \nPerc_Display_Trips_P5_PRE  STRING ,                   \nPerc_Display_Trips_P6_PRE  STRING ,                   \nPerc_Display_Trips_P7_PRE  STRING ,                   \nPerc_Display_Trips_P8_PRE  STRING ,\n\nPerc_Display_Trips_P0_POS  STRING ,                   \nPerc_Display_Trips_P1_POS  STRING ,                   \nPerc_Display_Trips_P2_POS  STRING ,                   \nPerc_Display_Trips_P3_POS  STRING ,                   \nPerc_Display_Trips_P4_POS  STRING ,                   \nPerc_Display_Trips_P5_POS  STRING ,                   \nPerc_Display_Trips_P6_POS  STRING ,                   \nPerc_Display_Trips_P7_POS  STRING ,                   \nPerc_Display_Trips_P8_POS  STRING ,\n\nFeature_or_display_Trips_Share_Diff_PRE_POS_P0 STRING,\nFeature_or_display_Trips_Share_Diff_PRE_POS_P1 STRING,\nFeature_or_display_Trips_Share_Diff_PRE_POS_P2 STRING,\nFeature_or_display_Trips_Share_Diff_PRE_POS_P3 STRING,\nFeature_or_display_Trips_Share_Diff_PRE_POS_P4 STRING,\nFeature_or_display_Trips_Share_Diff_PRE_POS_P5 STRING,\nFeature_or_display_Trips_Share_Diff_PRE_POS_P6 STRING,\nFeature_or_display_Trips_Share_Diff_PRE_POS_P7 STRING,\nFeature_or_display_Trips_Share_Diff_PRE_POS_P8 STRING,\n\nPerc_Feature_or_Display_Trips_P0_PRE  STRING ,        \nPerc_Feature_or_Display_Trips_P1_PRE  STRING ,        \nPerc_Feature_or_Display_Trips_P2_PRE  STRING ,        \nPerc_Feature_or_Display_Trips_P3_PRE  STRING ,        \nPerc_Feature_or_Display_Trips_P4_PRE  STRING ,        \nPerc_Feature_or_Display_Trips_P5_PRE  STRING ,        \nPerc_Feature_or_Display_Trips_P6_PRE  STRING ,        \nPerc_Feature_or_Display_Trips_P7_PRE  STRING ,      \nPerc_Feature_or_Display_Trips_P8_PRE  STRING ,   \n\nPerc_Feature_or_Display_Trips_P0_POS  STRING ,        \nPerc_Feature_or_Display_Trips_P1_POS  STRING ,        \nPerc_Feature_or_Display_Trips_P2_POS  STRING ,        \nPerc_Feature_or_Display_Trips_P3_POS  STRING ,        \nPerc_Feature_or_Display_Trips_P4_POS  STRING ,        \nPerc_Feature_or_Display_Trips_P5_POS  STRING ,        \nPerc_Feature_or_Display_Trips_P6_POS  STRING ,        \nPerc_Feature_or_Display_Trips_P7_POS  STRING ,        \nPerc_Feature_or_Display_Trips_P8_POS  STRING ,     \n\nAny_promo_Trips_Share_Diff_PRE_POS_P0  STRING,       \nAny_promo_Trips_Share_Diff_PRE_POS_P1  STRING,       \nAny_promo_Trips_Share_Diff_PRE_POS_P2  STRING,       \nAny_promo_Trips_Share_Diff_PRE_POS_P3  STRING,       \nAny_promo_Trips_Share_Diff_PRE_POS_P4  STRING,       \nAny_promo_Trips_Share_Diff_PRE_POS_P5  STRING,       \nAny_promo_Trips_Share_Diff_PRE_POS_P6  STRING,       \nAny_promo_Trips_Share_Diff_PRE_POS_P7  STRING,\nAny_promo_Trips_Share_Diff_PRE_POS_P8  STRING,       \n\nPerc_Any_Promo_Trips_P0_PRE   STRING ,                \nPerc_Any_Promo_Trips_P1_PRE   STRING ,                \nPerc_Any_Promo_Trips_P2_PRE   STRING ,                \nPerc_Any_Promo_Trips_P3_PRE   STRING ,                \nPerc_Any_Promo_Trips_P4_PRE   STRING ,                \nPerc_Any_Promo_Trips_P5_PRE   STRING ,                \nPerc_Any_Promo_Trips_P6_PRE   STRING ,                \nPerc_Any_Promo_Trips_P7_PRE   STRING ,    \n\nPerc_Any_Promo_Trips_P0_POS   STRING ,                \nPerc_Any_Promo_Trips_P1_POS   STRING ,                \nPerc_Any_Promo_Trips_P2_POS   STRING ,                \nPerc_Any_Promo_Trips_P3_POS   STRING ,                \nPerc_Any_Promo_Trips_P4_POS   STRING ,                \nPerc_Any_Promo_Trips_P5_POS   STRING ,                \nPerc_Any_Promo_Trips_P6_POS   STRING ,                \nPerc_Any_Promo_Trips_P7_POS   STRING ,\nPerc_Any_Promo_Trips_P8_POS   STRING ,               \n\nPrice_reduction_Trips_Share_Diff_PRE_POS_P0 STRING,  \nPrice_reduction_Trips_Share_Diff_PRE_POS_P1 STRING,  \nPrice_reduction_Trips_Share_Diff_PRE_POS_P2 STRING,  \nPrice_reduction_Trips_Share_Diff_PRE_POS_P3 STRING,  \nPrice_reduction_Trips_Share_Diff_PRE_POS_P4 STRING,  \nPrice_reduction_Trips_Share_Diff_PRE_POS_P5 STRING,  \nPrice_reduction_Trips_Share_Diff_PRE_POS_P6 STRING,  \nPrice_reduction_Trips_Share_Diff_PRE_POS_P7 STRING,  \nPrice_reduction_Trips_Share_Diff_PRE_POS_P8 STRING,\n\nPerc_Price_Reduction_Trips_P0_PRE    STRING ,         \nPerc_Price_Reduction_Trips_P1_PRE    STRING ,         \nPerc_Price_Reduction_Trips_P2_PRE    STRING ,         \nPerc_Price_Reduction_Trips_P3_PRE    STRING ,         \nPerc_Price_Reduction_Trips_P4_PRE    STRING ,         \nPerc_Price_Reduction_Trips_P5_PRE    STRING ,         \nPerc_Price_Reduction_Trips_P6_PRE    STRING ,         \nPerc_Price_Reduction_Trips_P7_PRE    STRING ,  \nPerc_Price_Reduction_Trips_P8_PRE    STRING ,       \n\nPerc_Price_Reduction_Trips_P0_POS    STRING ,         \nPerc_Price_Reduction_Trips_P1_POS    STRING ,         \nPerc_Price_Reduction_Trips_P2_POS    STRING ,         \nPerc_Price_Reduction_Trips_P3_POS    STRING ,         \nPerc_Price_Reduction_Trips_P4_POS    STRING ,         \nPerc_Price_Reduction_Trips_P5_POS    STRING ,         \nPerc_Price_Reduction_Trips_P6_POS    STRING ,         \nPerc_Price_Reduction_Trips_P7_POS    STRING ,      \nPerc_Price_Reduction_Trips_P8_POS    STRING ,     \n\nPrice_per_Unit_Diff_PRE_POS_P0 STRING,               \nPrice_per_unit_Diff_PRE_POS_P1 STRING,               \nPrice_per_unit_Diff_PRE_POS_P2 STRING,               \nPrice_per_unit_Diff_PRE_POS_P3 STRING,               \nPrice_per_unit_Diff_PRE_POS_P4 STRING,               \nPrice_per_unit_Diff_PRE_POS_P5 STRING,               \nPrice_per_unit_Diff_PRE_POS_P6 STRING,               \nPrice_per_unit_Diff_PRE_POS_P7 STRING,               \nPrice_per_unit_Diff_PRE_POS_P8 STRING,\n\nPrice_per_Unit_P0_PRE   STRING ,                      \nPrice_per_Unit_P1_PRE   STRING ,                      \nPrice_per_Unit_P2_PRE   STRING ,                      \nPrice_per_Unit_P3_PRE   STRING ,                      \nPrice_per_Unit_P4_PRE   STRING ,                      \nPrice_per_Unit_P5_PRE   STRING ,                      \nPrice_per_Unit_P6_PRE   STRING ,                      \nPrice_per_Unit_P7_PRE   STRING ,                      \nPrice_per_Unit_P8_PRE   STRING ,\n\nPrice_per_Unit_P0_POS   STRING ,                      \nPrice_per_Unit_P1_POS   STRING ,                      \nPrice_per_Unit_P2_POS   STRING ,                      \nPrice_per_Unit_P3_POS   STRING ,                      \nPrice_per_Unit_P4_POS   STRING ,                      \nPrice_per_Unit_P5_POS   STRING ,                      \nPrice_per_Unit_P6_POS   STRING ,                      \nPrice_per_Unit_P7_POS   STRING ,      \nPrice_per_Unit_P8_POS   STRING ,\n\nBuyer_Pre_P0 STRING,                \nBuyer_Pre_P1 STRING,\nBuyer_Pre_P2 STRING,\nBuyer_Pre_P3 STRING,\nBuyer_Pre_P4 STRING,\nBuyer_Pre_P5 STRING,\nBuyer_Pre_P6 STRING,\nBuyer_Pre_P7 STRING,\nBuyer_Pre_P8 STRING,\n\nNonbuyer_Pre_P0 STRING,\nNonbuyer_Pre_P1 STRING,\nNonbuyer_Pre_P2 STRING,\nNonbuyer_Pre_P3 STRING,\nNonbuyer_Pre_P4 STRING,\nNonbuyer_Pre_P5 STRING,\nNonbuyer_Pre_P6 STRING,\nNonbuyer_Pre_P7 STRING,\nNonbuyer_Pre_P8 STRING,\n\nBuyer_Pos_P0 STRING,\nBuyer_Pos_P1 STRING,\nBuyer_Pos_P2 STRING,\nBuyer_Pos_P3 STRING,\nBuyer_Pos_P4 STRING,\nBuyer_Pos_P5 STRING,\nBuyer_Pos_P6 STRING,\nBuyer_Pos_P7 STRING,\nBuyer_Pos_P8 STRING,\n\nNonbuyer_Pos_P0 STRING,\nNonbuyer_Pos_P1 STRING,\nNonbuyer_Pos_P2 STRING,\nNonbuyer_Pos_P3 STRING,\nNonbuyer_Pos_P4 STRING,\nNonbuyer_Pos_P5 STRING,\nNonbuyer_Pos_P6 STRING,\nNonbuyer_Pos_P7 STRING,\nNonbuyer_Pos_P8 STRING,\n\nestimated_hh_income string,\nstate string,\ncounty_code string,\nlatitude string,\nlongitude string,\ncape_age_pop_pct_0_17 string,\ncape_age_pop_pct_65_99_plus string,\ncape_age_pop_pct_18_99_plus string,\ncape_age_pop_median_age string,\ncape_ethnic_pop_pct_white_only string,\ncape_ethnic_pop_pct_black_only string,\ncape_ethnic_pop_pct_asian_only string,\ncape_ethnic_pop_pct_hispanic string,\ncape_child_hh_pct_with_persons_lt18 string,\ncape_child_hh_pct_marr_couple_famwith_persons_lt18 string,\ncape_typ_hh_pct_married_couple_family string,\ncape_tenancy_occhu_pct_owner_occupied string,\ncape_tenancy_occhu_pct_renter_occupied string,\ncape_hhsize_hh_average_household_size string,\ncape_density_persons_per_hh_for_pop_in_hh string,\ncape_homval_oohu_median_home_value string,\ncape_hustr_hu_pct_mobile_home string,\ncape_built_hu_median_housing_unit_age string,\ncape_lang_hh_pct_spanish_speaking string,\ncape_educ_pop25_plus_median_education_attained string,\ncape_inc_hh_median_family_household_income string,\ncape_educ_ispsa_decile string,\ncape_inc_family_inc_state_decile string,\ncensus_rural_urban_county_size_code string,\ncore_based_statistical_areas string,\nperson_1_birth_year_and_month string,\nperson_1_combined_age string,\nperson_1_gender string,\nperson_1_marital_status string,\nrecipient_reliability_code string,\nhousehold_composition string,\nperson_1_person_type string,\nhomeowner_combined_homeowner string,\nhomeowner_probability_model string,\ndwelling_type string,\nlength_of_residence string,\ndwelling_unit_size string,\nnumber_of_children_in_living_unit string,\nnumber_of_adults_in_living_unit string,\nnumber_of_person_in_living_unit string,\nmail_responder string,\nmosaic_hh string\n)\nROW FORMAT DELIMITED FIELDS TERMINATED BY '|' LOCATION '/temp/step6';\n{code}\n\n*STEP 5. Insert data to table temp.step6*\n\n{code}\nINSERT OVERWRITE TABLE temp.step5 SELECT \nc2,a2,d2,d2,d2,h2,h2,f2,f2,a2,id,f2,f2,d2,d2,f2,f2,f2,f2,f2,f2,f2,f2,f2,f2,f2,\nf2,d2,f2,f2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,\nh2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2,h2\nFROM temp.test;\n{code}\n\n*STEP 6. Run query in hive shell*\n\n{code}\nInsert Overwrite Table temp.step6\nSELECT\nexperian_id,max(exposed_flag) as exposed_flag,banner,\n\nsum(CASE WHEN product_id_Hormel_REV3=0 and PERIOD=1 THEN Quantity END) as Product_0_Quantity_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=1 and PERIOD=1 THEN Quantity END) as Product_1_Quantity_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=2 and PERIOD=1 THEN Quantity END) as Product_2_Quantity_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=3 and PERIOD=1 THEN Quantity END) as Product_3_Quantity_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=4 and PERIOD=1 THEN Quantity END) as Product_4_Quantity_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=5 and PERIOD=1 THEN Quantity END) as Product_5_Quantity_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=6 and PERIOD=1 THEN Quantity END) as Product_6_Quantity_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=7 and PERIOD=1 THEN Quantity END) as Product_7_Quantity_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=8 and PERIOD=1 THEN Quantity END) as Product_8_Quantity_PRE,\n\nsum(CASE WHEN product_id_Hormel_REV3=0 and PERIOD=2 THEN Quantity END) as Product_0_Quantity_POS,\nsum(CASE WHEN product_id_Hormel_REV3=1 and PERIOD=2 THEN Quantity END) as Product_1_Quantity_POS,\nsum(CASE WHEN product_id_Hormel_REV3=2 and PERIOD=2 THEN Quantity END) as Product_2_Quantity_POS,\nsum(CASE WHEN product_id_Hormel_REV3=3 and PERIOD=2 THEN Quantity END) as Product_3_Quantity_POS,\nsum(CASE WHEN product_id_Hormel_REV3=4 and PERIOD=2 THEN Quantity END) as Product_4_Quantity_POS,\nsum(CASE WHEN product_id_Hormel_REV3=5 and PERIOD=2 THEN Quantity END) as Product_5_Quantity_POS,\nsum(CASE WHEN product_id_Hormel_REV3=6 and PERIOD=2 THEN Quantity END) as Product_6_Quantity_POS,\nsum(CASE WHEN product_id_Hormel_REV3=7 and PERIOD=2 THEN Quantity END) as Product_7_Quantity_POS,\nsum(CASE WHEN product_id_Hormel_REV3=8 and PERIOD=2 THEN Quantity END) as Product_8_Quantity_POS,\n\nsum(CASE WHEN product_id_Hormel_REV3=0 and PERIOD=1 THEN Net_Price END) as Product_0_Net_Price_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=1 and PERIOD=1 THEN Net_Price END) as Product_1_Net_Price_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=2 and PERIOD=1 THEN Net_Price END) as Product_2_Net_Price_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=3 and PERIOD=1 THEN Net_Price END) as Product_3_Net_Price_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=4 and PERIOD=1 THEN Net_Price END) as Product_4_Net_Price_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=5 and PERIOD=1 THEN Net_Price END) as Product_5_Net_Price_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=6 and PERIOD=1 THEN Net_Price END) as Product_6_Net_Price_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=7 and PERIOD=1 THEN Net_Price END) as Product_7_Net_Price_PRE,\nsum(CASE WHEN product_id_Hormel_REV3=8 and PERIOD=1 THEN Net_Price END) as Product_8_Net_Price_PRE,\n\nsum(CASE WHEN product_id_Hormel_REV3=0 and PERIOD=2 THEN Net_Price END) as Product_0_Net_Price_POS,\nsum(CASE WHEN product_id_Hormel_REV3=1 and PERIOD=2 THEN Net_Price END) as Product_1_Net_Price_POS,\nsum(CASE WHEN product_id_Hormel_REV3=2 and PERIOD=2 THEN Net_Price END) as Product_2_Net_Price_POS,\nsum(CASE WHEN product_id_Hormel_REV3=3 and PERIOD=2 THEN Net_Price END) as Product_3_Net_Price_POS,\nsum(CASE WHEN product_id_Hormel_REV3=4 and PERIOD=2 THEN Net_Price END) as Product_4_Net_Price_POS,\nsum(CASE WHEN product_id_Hormel_REV3=5 and PERIOD=2 THEN Net_Price END) as Product_5_Net_Price_POS,\nsum(CASE WHEN product_id_Hormel_REV3=6 and PERIOD=2 THEN Net_Price END) as Product_6_Net_Price_POS,\nsum(CASE WHEN product_id_Hormel_REV3=7 and PERIOD=2 THEN Net_Price END) as Product_7_Net_Price_POS,\nsum(CASE WHEN product_id_Hormel_REV3=8 and PERIOD=2 THEN Net_Price END) as Product_8_Net_Price_POS,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Coupon_Units END) as Coupon_Units_PRE_P0,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Coupon_Units END) as Coupon_Units_PRE_P1,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Coupon_Units END) as Coupon_Units_PRE_P2,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Coupon_Units END) as Coupon_Units_PRE_P3,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Coupon_Units END) as Coupon_Units_PRE_P4,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Coupon_Units END) as Coupon_Units_PRE_P5,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Coupon_Units END) as Coupon_Units_PRE_P6,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Coupon_Units END) as Coupon_Units_PRE_P7,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Coupon_Units END) as Coupon_Units_PRE_P8,\n\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Coupon_Units END) as Coupon_Units_POS_P0,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Coupon_Units END) as Coupon_Units_POS_P1,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Coupon_Units END) as Coupon_Units_POS_P2,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Coupon_Units END) as Coupon_Units_POS_P3,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Coupon_Units END) as Coupon_Units_POS_P4,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Coupon_Units END) as Coupon_Units_POS_P5,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Coupon_Units END) as Coupon_Units_POS_P6,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Coupon_Units END) as Coupon_Units_POS_P7,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Coupon_Units END) as Coupon_Units_POS_P8,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Coupon_Dollars END) as Coupon_Dollars_PRE_P0,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Coupon_Dollars END) as Coupon_Dollars_PRE_P1,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Coupon_Dollars END) as Coupon_Dollars_PRE_P2,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Coupon_Dollars END) as Coupon_Dollars_PRE_P3,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Coupon_Dollars END) as Coupon_Dollars_PRE_P4,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Coupon_Dollars END) as Coupon_Dollars_PRE_P5,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Coupon_Dollars END) as Coupon_Dollars_PRE_P6,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Coupon_Dollars END) as Coupon_Dollars_PRE_P7,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Coupon_Dollars END) as Coupon_Dollars_PRE_P8,\n\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Coupon_Dollars END) as Coupon_Dollars_POS_P0,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Coupon_Dollars END) as Coupon_Dollars_POS_P1,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Coupon_Dollars END) as Coupon_Dollars_POS_P2,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Coupon_Dollars END) as Coupon_Dollars_POS_P3,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Coupon_Dollars END) as Coupon_Dollars_POS_P4,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Coupon_Dollars END) as Coupon_Dollars_POS_P5,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Coupon_Dollars END) as Coupon_Dollars_POS_P6,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Coupon_Dollars END) as Coupon_Dollars_POS_P7,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Coupon_Dollars END) as Coupon_Dollars_POS_P8,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Dollars_per_Trip_PRE_P0,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Dollars_per_Trip_PRE_P1,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Dollars_per_Trip_PRE_P2,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Dollars_per_Trip_PRE_P3,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Dollars_per_Trip_PRE_P4,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Dollars_per_Trip_PRE_P5,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Dollars_per_Trip_PRE_P6,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Dollars_per_Trip_PRE_P7,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Dollars_per_Trip_PRE_P8,\n\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Dollars_per_Trip_POS_P0,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Dollars_per_Trip_POS_P1,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Dollars_per_Trip_POS_P2,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Dollars_per_Trip_POS_P3,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Dollars_per_Trip_POS_P4,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Dollars_per_Trip_POS_P5,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Dollars_per_Trip_POS_P6,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Dollars_per_Trip_POS_P7,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Dollars_per_Trip_POS_P8,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Quantity END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Units_per_Trip_PRE_P0,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Quantity END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Units_per_Trip_PRE_P1,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Quantity END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Units_per_Trip_PRE_P2,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Quantity END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Units_per_Trip_PRE_P3,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Quantity END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Units_per_Trip_PRE_P4,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Quantity END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Units_per_Trip_PRE_P5,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Quantity END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Units_per_Trip_PRE_P6,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Quantity END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Units_per_Trip_PRE_P7,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Quantity END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Units_per_Trip_PRE_P8,\n\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Quantity END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Units_per_Trip_POS_P0,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Quantity END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Units_per_Trip_POS_P1,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Quantity END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Units_per_Trip_POS_P2,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Quantity END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Units_per_Trip_POS_P3,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Quantity END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Units_per_Trip_POS_P4,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Quantity END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Units_per_Trip_POS_P5,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Quantity END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Units_per_Trip_POS_P6,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Quantity END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Units_per_Trip_POS_P7,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Quantity END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Units_per_Trip_POS_P8,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Trips_PRE_P0,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Trips_PRE_P1,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Trips_PRE_P2,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Trips_PRE_P3,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Trips_PRE_P4,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Trips_PRE_P5,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Trips_PRE_P6,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Trips_PRE_P7,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Trips_PRE_P8,\n\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Trips_POS_P0,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Trips_POS_P1,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Trips_POS_P2,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Trips_POS_P3,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Trips_POS_P4,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Trips_POS_P5,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Trips_POS_P6,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Trips_POS_P7,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Trips_POS_P8,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Coupon_Dollars_per_Trip_Diff_PRE_POS_P1,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Coupon_Dollars_per_Trip_Diff_PRE_POS_P2,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Coupon_Dollars_per_Trip_Diff_PRE_POS_P3,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Coupon_Dollars_per_Trip_Diff_PRE_POS_P4,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Coupon_Dollars_per_Trip_Diff_PRE_POS_P5,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Coupon_Dollars_per_Trip_Diff_PRE_POS_P6,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Coupon_Dollars_per_Trip_Diff_PRE_POS_P7,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Coupon_Dollars_per_Trip_Diff_PRE_POS_P8,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Coupon_Dollars_P0_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Coupon_Dollars_P1_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Coupon_Dollars_P2_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Coupon_Dollars_P3_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Coupon_Dollars_P4_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Coupon_Dollars_P5_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Coupon_Dollars_P6_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Coupon_Dollars_P7_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Perc_Coupon_Dollars_P8_PRE,\n\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Coupon_Dollars_P0_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Coupon_Dollars_P1_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Coupon_Dollars_P2_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Coupon_Dollars_P3_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Coupon_Dollars_P4_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Coupon_Dollars_P5_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Coupon_Dollars_P6_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Coupon_Dollars_P7_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Coupon_Dollars END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Perc_Coupon_Dollars_P8_POS,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Coupon_Units_per_Trip_Diff_PRE_POS_P0,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Coupon_Units_per_Trip_Diff_PRE_POS_P1,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Coupon_Units_per_Trip_Diff_PRE_POS_P2,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Coupon_Units_per_Trip_Diff_PRE_POS_P3,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Coupon_Units_per_Trip_Diff_PRE_POS_P4,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Coupon_Units_per_Trip_Diff_PRE_POS_P5,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Coupon_Units_per_Trip_Diff_PRE_POS_P6,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Coupon_Units_per_Trip_Diff_PRE_POS_P7,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Coupon_Units_per_Trip_Diff_PRE_POS_P8,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Coupon_Units_P0_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Coupon_Units_P1_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Coupon_Units_P2_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Coupon_Units_P3_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Coupon_Units_P4_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Coupon_Units_P5_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Coupon_Units_P6_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Coupon_Units_P7_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Perc_Coupon_Units_P8_PRE,\n\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Coupon_Units_P0_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Coupon_Units_P1_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Coupon_Units_P2_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Coupon_Units_P3_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Coupon_Units_P4_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Coupon_Units_P5_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Coupon_Units_P6_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Coupon_Units_P7_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Coupon_Units END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Perc_Coupon_Units_P8_POS,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Coupon_Trips_Share_Diff_PRE_POS_P0,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Coupon_Trips_Share_Diff_PRE_POS_P1,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Coupon_Trips_Share_Diff_PRE_POS_P2,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Coupon_Trips_Share_Diff_PRE_POS_P3,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Coupon_Trips_Share_Diff_PRE_POS_P4,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Coupon_Trips_Share_Diff_PRE_POS_P5,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Coupon_Trips_Share_Diff_PRE_POS_P6,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Coupon_Trips_Share_Diff_PRE_POS_P7,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Coupon_Trips_Share_Diff_PRE_POS_P8,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Coupon_Trips__P0_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Coupon_Trips__P1_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Coupon_Trips__P2_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Coupon_Trips__P3_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Coupon_Trips__P4_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Coupon_Trips__P5_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Coupon_Trips__P6_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Coupon_Trips__P7_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Perc_Coupon_Trips__P8_PRE,\n\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Coupon_Trips__P0_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Coupon_Trips__P1_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Coupon_Trips__P2_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Coupon_Trips__P3_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Coupon_Trips__P4_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Coupon_Trips__P5_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Coupon_Trips__P6_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Coupon_Trips__P7_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN coupon_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Perc_Coupon_Trips__P8_POS,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Feature_Trips_Share_Diff_PRE_POS_P0,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Feature_Trips_Share_Diff_PRE_POS_P1,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Feature_Trips_Share_Diff_PRE_POS_P2,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Feature_Trips_Share_Diff_PRE_POS_P3,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Feature_Trips_Share_Diff_PRE_POS_P4,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Feature_Trips_Share_Diff_PRE_POS_P5,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Feature_Trips_Share_Diff_PRE_POS_P6,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Feature_Trips_Share_Diff_PRE_POS_P7,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Feature_Trips_Share_Diff_PRE_POS_P8,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Feature_Trips_P0_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Feature_Trips_P1_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Feature_Trips_P2_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Feature_Trips_P3_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Feature_Trips_P4_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Feature_Trips_P5_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Feature_Trips_P6_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Feature_Trips_P7_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN feature_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Perc_Feature_Trips_P8_PRE,\n\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Feature_Trips_P0_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Feature_Trips_P1_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Feature_Trips_P2_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Feature_Trips_P3_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Feature_Trips_P4_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Feature_Trips_P5_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Feature_Trips_P6_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Feature_Trips_P7_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN feature_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Perc_Feature_Trips_P8_POS,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Display_Trips_Share_Diff_PRE_POS_P0,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Display_Trips_Share_Diff_PRE_POS_P1,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Display_Trips_Share_Diff_PRE_POS_P2,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Display_Trips_Share_Diff_PRE_POS_P3,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Display_Trips_Share_Diff_PRE_POS_P4,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Display_Trips_Share_Diff_PRE_POS_P5,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Display_Trips_Share_Diff_PRE_POS_P6,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Display_Trips_Share_Diff_PRE_POS_P7,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Display_Trips_Share_Diff_PRE_POS_P8,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Display_Trips_P0_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Display_Trips_P1_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Display_Trips_P2_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Display_Trips_P3_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Display_Trips_P4_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Display_Trips_P5_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Display_Trips_P6_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Display_Trips_P7_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Perc_Display_Trips_P8_PRE,\n\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Display_Trips_P0_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Display_Trips_P1_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Display_Trips_P2_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Display_Trips_P3_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Display_Trips_P4_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Display_Trips_P5_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Display_Trips_P6_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Display_Trips_P7_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Perc_Display_Trips_P8_POS,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Feature_or_display_Trips_Share_Diff_PRE_POS_P0,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Feature_or_display_Trips_Share_Diff_PRE_POS_P1,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Feature_or_display_Trips_Share_Diff_PRE_POS_P2,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Feature_or_display_Trips_Share_Diff_PRE_POS_P3,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Feature_or_display_Trips_Share_Diff_PRE_POS_P4,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Feature_or_display_Trips_Share_Diff_PRE_POS_P5,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Feature_or_display_Trips_Share_Diff_PRE_POS_P6,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Feature_or_display_Trips_Share_Diff_PRE_POS_P7,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Feature_or_display_Trips_Share_Diff_PRE_POS_P8,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) as  Perc_Feature_or_Display_Trips_P0_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) as  Perc_Feature_or_Display_Trips_P1_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) as  Perc_Feature_or_Display_Trips_P2_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) as  Perc_Feature_or_Display_Trips_P3_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) as  Perc_Feature_or_Display_Trips_P4_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) as  Perc_Feature_or_Display_Trips_P5_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) as  Perc_Feature_or_Display_Trips_P6_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) as  Perc_Feature_or_Display_Trips_P7_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) as  Perc_Feature_or_Display_Trips_P8_PRE,\n\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Feature_or_Display_Trips_P0_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Feature_or_Display_Trips_P1_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Feature_or_Display_Trips_P2_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Feature_or_Display_Trips_P3_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Feature_or_Display_Trips_P4_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Feature_or_Display_Trips_P5_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Feature_or_Display_Trips_P6_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Feature_or_Display_Trips_P7_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN feature_or_display_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Perc_Feature_or_Display_Trips_P8_POS,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Any_promo_Trips_Share_Diff_PRE_POS_P0,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Any_promo_Trips_Share_Diff_PRE_POS_P1,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Any_promo_Trips_Share_Diff_PRE_POS_P2,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Any_promo_Trips_Share_Diff_PRE_POS_P3,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Any_promo_Trips_Share_Diff_PRE_POS_P4,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Any_promo_Trips_Share_Diff_PRE_POS_P5,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Any_promo_Trips_Share_Diff_PRE_POS_P6,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Any_promo_Trips_Share_Diff_PRE_POS_P7,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Any_promo_Trips_Share_Diff_PRE_POS_P8,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Any_Promo_Trips_P0_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Any_Promo_Trips_P1_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Any_Promo_Trips_P2_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Any_Promo_Trips_P3_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Any_Promo_Trips_P4_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Any_Promo_Trips_P5_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Any_Promo_Trips_P6_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Any_Promo_Trips_P7_PRE,\n\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Any_Promo_Trips_P0_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Any_Promo_Trips_P1_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Any_Promo_Trips_P2_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Any_Promo_Trips_P3_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Any_Promo_Trips_P4_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Any_Promo_Trips_P5_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Any_Promo_Trips_P6_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Any_Promo_Trips_P7_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN any_promo_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Perc_Any_Promo_Trips_P8_POS,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Price_reduction_Trips_Share_Diff_PRE_POS_P0,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Price_reduction_Trips_Share_Diff_PRE_POS_P1,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Price_reduction_Trips_Share_Diff_PRE_POS_P2,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Price_reduction_Trips_Share_Diff_PRE_POS_P3,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Price_reduction_Trips_Share_Diff_PRE_POS_P4,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Price_reduction_Trips_Share_Diff_PRE_POS_P5,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Price_reduction_Trips_Share_Diff_PRE_POS_P6,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Price_reduction_Trips_Share_Diff_PRE_POS_P7,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Price_reduction_Trips_Share_Diff_PRE_POS_P8,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P0_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P1_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P2_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P3_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P4_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P5_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P6_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P7_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P8_PRE,\n\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P0_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P1_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P2_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P3_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P4_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P5_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P6_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P7_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN price_reduction_occasions END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END) as Perc_Price_Reduction_Trips_P8_POS,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Quantity  END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Quantity  END) as Price_per_Unit_Diff_PRE_POS_P0,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Quantity  END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Quantity  END) as Price_per_unit_Diff_PRE_POS_P1,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Quantity  END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Quantity  END) as Price_per_unit_Diff_PRE_POS_P2,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Quantity  END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Quantity  END) as Price_per_unit_Diff_PRE_POS_P3,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Quantity  END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Quantity  END) as Price_per_unit_Diff_PRE_POS_P4,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Quantity  END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Quantity  END) as Price_per_unit_Diff_PRE_POS_P5,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Quantity  END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Quantity  END) as Price_per_unit_Diff_PRE_POS_P6,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Quantity  END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Quantity  END) as Price_per_unit_Diff_PRE_POS_P7,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Quantity  END) -  sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Quantity  END) as Price_per_unit_Diff_PRE_POS_P8,\n\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Quantity  END) as Price_per_Unit_P0_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Quantity  END) as Price_per_Unit_P1_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Quantity  END) as Price_per_Unit_P2_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Quantity  END) as Price_per_Unit_P3_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Quantity  END) as Price_per_Unit_P4_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Quantity  END) as Price_per_Unit_P5_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Quantity  END) as Price_per_Unit_P6_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Quantity  END) as Price_per_Unit_P7_PRE,\nsum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Net_Price END)/sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Quantity  END) as Price_per_Unit_P8_PRE,\n\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Quantity  END) as Price_per_Unit_P0_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Quantity  END) as Price_per_Unit_P1_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Quantity  END) as Price_per_Unit_P2_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Quantity  END) as Price_per_Unit_P3_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Quantity  END) as Price_per_Unit_P4_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Quantity  END) as Price_per_Unit_P5_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Quantity  END) as Price_per_Unit_P6_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Quantity  END) as Price_per_Unit_P7_POS,\nsum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Net_Price END)/sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Quantity  END) as Price_per_Unit_P8_POS,\n\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pre_P0,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pre_P1,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pre_P2,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pre_P3,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pre_P4,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pre_P5,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pre_P6,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pre_P7,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pre_P8,\n\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=0 THEN Trans_Num END)) IS NULL then 1 else 0 end) as  Nonbuyer_Pre_P0,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=1 THEN Trans_Num END)) IS NULL then 1 else 0 end) as  Nonbuyer_Pre_P1,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=2 THEN Trans_Num END)) IS NULL then 1 else 0 end) as  Nonbuyer_Pre_P2,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=3 THEN Trans_Num END)) IS NULL then 1 else 0 end) as  Nonbuyer_Pre_P3,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=4 THEN Trans_Num END)) IS NULL then 1 else 0 end) as  Nonbuyer_Pre_P4,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=5 THEN Trans_Num END)) IS NULL then 1 else 0 end) as  Nonbuyer_Pre_P5,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=6 THEN Trans_Num END)) IS NULL then 1 else 0 end) as  Nonbuyer_Pre_P6,\n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=7 THEN Trans_Num END)) IS NULL then 1 else 0 end) as  Nonbuyer_Pre_P7,                                                                                                                                                                                                                                                                                              \n(case when (sum(CASE WHEN PERIOD=1 and product_id_Hormel_REV3=8 THEN Trans_Num END)) IS NULL then 1 else 0 end) as  Nonbuyer_Pre_P8,                                                                                                                                                                                                                                                                                              \n\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pos_P0,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pos_P1,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pos_P2,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pos_P3,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pos_P4,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pos_P5,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pos_P6,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pos_P7,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END)) >0 then 1 else 0 end) as Buyer_Pos_P8,\n\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=0 THEN Trans_Num END)) IS NULL then 1 else 0 end) as Nonbuyer_Pos_P0,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=1 THEN Trans_Num END)) IS NULL then 1 else 0 end) as Nonbuyer_Pos_P1,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=2 THEN Trans_Num END)) IS NULL then 1 else 0 end) as Nonbuyer_Pos_P2,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=3 THEN Trans_Num END)) IS NULL then 1 else 0 end) as Nonbuyer_Pos_P3,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=4 THEN Trans_Num END)) IS NULL then 1 else 0 end) as Nonbuyer_Pos_P4,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=5 THEN Trans_Num END)) IS NULL then 1 else 0 end) as Nonbuyer_Pos_P5,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=6 THEN Trans_Num END)) IS NULL then 1 else 0 end) as Nonbuyer_Pos_P6,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=7 THEN Trans_Num END)) IS NULL then 1 else 0 end) as Nonbuyer_Pos_P7,\n(case when (sum(CASE WHEN PERIOD=2 and product_id_Hormel_REV3=8 THEN Trans_Num END)) IS NULL then 1 else 0 end) as Nonbuyer_Pos_P8,\n\nmax(estimated_hh_income) as  estimated_hh_income,                                                                                                                                                                                                                                             \nmax(state) as  state,\nmax(county_code) as  county_code,\nmax(latitude) as  latitude,\nmax(longitude) as  longitude,\nmax(cape_age_pop_pct_0_17) as  cape_age_pop_pct_0_17,\nmax(cape_age_pop_pct_65_99_plus) as  cape_age_pop_pct_65_99_plus,\nmax(cape_age_pop_pct_18_99_plus) as  cape_age_pop_pct_18_99_plus,\nmax(cape_age_pop_median_age) as  cape_age_pop_median_age,\nmax(cape_ethnic_pop_pct_white_only) as  cape_ethnic_pop_pct_white_only,\nmax(cape_ethnic_pop_pct_black_only) as  cape_ethnic_pop_pct_black_only,\nmax(cape_ethnic_pop_pct_asian_only) as  cape_ethnic_pop_pct_asian_only,\nmax(cape_ethnic_pop_pct_hispanic) as  cape_ethnic_pop_pct_hispanic,\nmax(cape_child_hh_pct_with_persons_lt18) as  cape_child_hh_pct_with_persons_lt18,\nmax(cape_child_hh_pct_marr_couple_famwith_persons_lt18) as  cape_child_hh_pct_marr_couple_famwith_persons_lt18,\nmax(cape_typ_hh_pct_married_couple_family) as  cape_typ_hh_pct_married_couple_family,\nmax(cape_tenancy_occhu_pct_owner_occupied) as  cape_tenancy_occhu_pct_owner_occupied,\nmax(cape_tenancy_occhu_pct_renter_occupied) as  cape_tenancy_occhu_pct_renter_occupied,\nmax(cape_hhsize_hh_average_household_size) as  cape_hhsize_hh_average_household_size,\nmax(cape_density_persons_per_hh_for_pop_in_hh) as  cape_density_persons_per_hh_for_pop_in_hh,\nmax(cape_homval_oohu_median_home_value) as  cape_homval_oohu_median_home_value,\nmax(cape_hustr_hu_pct_mobile_home) as  cape_hustr_hu_pct_mobile_home,\nmax(cape_built_hu_median_housing_unit_age) as  cape_built_hu_median_housing_unit_age,\nmax(cape_lang_hh_pct_spanish_speaking) as  cape_lang_hh_pct_spanish_speaking,\nmax(cape_educ_pop25_plus_median_education_attained) as  cape_educ_pop25_plus_median_education_attained,\nmax(cape_inc_hh_median_family_household_income) as  cape_inc_hh_median_family_household_income,\nmax(cape_educ_ispsa_decile) as  cape_educ_ispsa_decile,\nmax(cape_inc_family_inc_state_decile) as  cape_inc_family_inc_state_decile,\nmax(census_rural_urban_county_size_code) as  census_rural_urban_county_size_code,\nmax(core_based_statistical_areas) as  core_based_statistical_areas,\nmax(person_1_birth_year_and_month) as  person_1_birth_year_and_month,\nmax(person_1_combined_age) as  person_1_combined_age,\nmax(person_1_gender) as  person_1_gender,\nmax(person_1_marital_status) as  person_1_marital_status,\nmax(recipient_reliability_code) as  recipient_reliability_code,\nmax(household_composition) as  household_composition,\nmax(person_1_person_type) as  person_1_person_type,\nmax(homeowner_combined_homeowner) as  homeowner_combined_homeowner,\nmax(homeowner_probability_model) as  homeowner_probability_model,\nmax(dwelling_type) as  dwelling_type,\nmax(length_of_residence) as  length_of_residence,\nmax(dwelling_unit_size) as  dwelling_unit_size,\nmax(number_of_children_in_living_unit) as  number_of_children_in_living_unit,\nmax(number_of_adults_in_living_unit) as  number_of_adults_in_living_unit,\nmax(number_of_person_in_living_unit) as  number_of_person_in_living_unit,\nmax(mail_responder) as  mail_responder,\nmax(mosaic_hh) as  mosaic_hh\n\nFROM temp.step5\ngroup by experian_id,Banner;\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=osayankin","name":"osayankin","key":"osayankin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=osayankin&avatarId=34533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=osayankin&avatarId=34533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=osayankin&avatarId=34533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=osayankin&avatarId=34533"},"displayName":"Oleksiy Sayankin","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-23T08:52:54.600+0000","updated":"2016-05-23T08:52:54.600+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12927238/comment/15296226","id":"15296226","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=osayankin","name":"osayankin","key":"osayankin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=osayankin&avatarId=34533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=osayankin&avatarId=34533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=osayankin&avatarId=34533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=osayankin&avatarId=34533"},"displayName":"Oleksiy Sayankin","active":true,"timeZone":"Etc/UTC"},"body":"I have patch for this issue. Alan Gates, could you assign this issue to me?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=osayankin","name":"osayankin","key":"osayankin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=osayankin&avatarId=34533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=osayankin&avatarId=34533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=osayankin&avatarId=34533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=osayankin&avatarId=34533"},"displayName":"Oleksiy Sayankin","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-23T10:55:02.908+0000","updated":"2016-05-23T10:55:02.908+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12927238/comment/15307573","id":"15307573","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=osayankin","name":"osayankin","key":"osayankin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=osayankin&avatarId=34533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=osayankin&avatarId=34533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=osayankin&avatarId=34533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=osayankin&avatarId=34533"},"displayName":"Oleksiy Sayankin","active":true,"timeZone":"Etc/UTC"},"body":"Alina has found a workaround for this issue.\n\n*ROOT-CAUSE:*\n\nConsider method \n\n{code}\n  protected int require (int required) throws KryoException \n{code}\n\nfrom class com.esotericsoftware.kryo.io.Input where exception happens. \n\n{code}\n  int remaining = limit - position;\n  if (remaining >= required) return remaining;\n  if (required > capacity) throw new KryoException(\"Buffer too small: capacity:\n\" + capacity + \", required: \" + required);\n\n  int count;\n  // Try to fill the buffer.\n  if (remaining > 0) {\n  count = fill(buffer, limit, capacity - limit);\n  if (count == -1) throw new KryoException(\"Buffer underflow.\");\n{code}\n\nWe can see that exception (\"Buffer underflow.\") occurs when count == -1. So let us see method fill(byte[] buffer, int offset, int count) in details:\n{code}\n  if (inputStream == null) return -1;\n  try {\n  return inputStream.read(buffer, offset, count);\n  } catch (IOException ex) {\n  throw new KryoException(ex);\n  }\n{code}\n\nIt returns -1 either when inputStream == null or from inputStream.read(buffer, offset, count). We definitely know that inputStream can not be equal null here because of constructor:\n\n{code}\n  public Input (InputStream inputStream) {\n    this(4096);\n    if (inputStream == null) throw new IllegalArgumentException(\"inputStream\ncannot be null.\");\n    this.inputStream = inputStream;\n    }\n{code}\n\nFrom Java docs we know that if no byte is available because the stream is at end of file, the value -1 is returned by the method  inputStream.read(buffer, offset, count). Hence we suspect here some errors in HDFS  here that causes -1 to be a return value. Skipping usage of file system as query plan storage and sending it via RPC directly will fix the issue.\n\n\n*SOLUTION:*\n\nUse \n\n{code}\n  <property>\n    <name>hive.rpc.query.plan</name>\n    <value>true</value>\n  </property>\n{code}\n\nin hive-site.xml as workaround. This property defines whether to send the query plan via local resource or RPC.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=osayankin","name":"osayankin","key":"osayankin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=osayankin&avatarId=34533","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=osayankin&avatarId=34533","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=osayankin&avatarId=34533","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=osayankin&avatarId=34533"},"displayName":"Oleksiy Sayankin","active":true,"timeZone":"Etc/UTC"},"created":"2016-05-31T11:10:39.753+0000","updated":"2016-05-31T11:10:39.753+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-12779/votes","votes":3,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2qssf:"}}