{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12982508","self":"https://issues.apache.org/jira/rest/api/2/issue/12982508","key":"HIVE-14086","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-01-31T20:18:31.119+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jan 31 23:57:20 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-14086/watchers","watchCount":5,"isWatching":false},"created":"2016-06-23T23:10:09.362+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-01-31T23:57:20.627+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12324726","id":"12324726","name":"API"}],"timeoriginalestimate":null,"description":"Consider this table, using an external Avro schema file:\n\n{noformat}\nCREATE TABLE avro_table\n  PARTITIONED BY (str_part STRING)\n  ROW FORMAT SERDE\n  'org.apache.hadoop.hive.serde2.avro.AvroSerDe'\n  STORED AS INPUTFORMAT\n  'org.apache.hadoop.hive.ql.io.avro.AvroContainerInputFormat'\n  OUTPUTFORMAT\n  'org.apache.hadoop.hive.ql.io.avro.AvroContainerOutputFormat'\n  TBLPROPERTIES (\n    'avro.schema.url'='hdfs://localhost:20500/tmp/avro.json'\n  );\n{noformat}\n\nThis will populate the \"COLUMNS_V2\" metastore table with the correct column information (as per HIVE-6308). The columns of this table can then be queried via the Hive API, for example by calling {{.getSd().getCols()}} on a {{org.apache.hadoop.hive.metastore.api.Table}} object.\n\nChanges to the avro.schema.url file - either changing where it points to or changing its contents - will be reflected in the output of {{describe formatted avro_table}} *but not* in the result of the {{.getSd().getCols()}} API call. Instead it looks like Hive only reads the Avro schema file internally, but does not expose the information therein via its API.\n\nIs there a way to obtain the effective Table information via Hive? Would it make sense to fix table retrieval so calls to {{get_table}} return the correct set of columns?\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12818906","id":"12818906","filename":"avro.json","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lv","name":"lv","key":"lv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lv&avatarId=31242","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lv&avatarId=31242","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lv&avatarId=31242","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lv&avatarId=31242"},"displayName":"Lars Volker","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-19T20:06:20.133+0000","size":202,"mimeType":"application/json","content":"https://issues.apache.org/jira/secure/attachment/12818906/avro.json"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12818907","id":"12818907","filename":"avro.sql","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lv","name":"lv","key":"lv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lv&avatarId=31242","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lv&avatarId=31242","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lv&avatarId=31242","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lv&avatarId=31242"},"displayName":"Lars Volker","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-19T20:06:20.138+0000","size":377,"mimeType":"application/x-sql","content":"https://issues.apache.org/jira/secure/attachment/12818907/avro.sql"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12818908","id":"12818908","filename":"avroremoved.json","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lv","name":"lv","key":"lv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lv&avatarId=31242","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lv&avatarId=31242","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lv&avatarId=31242","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lv&avatarId=31242"},"displayName":"Lars Volker","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-19T20:06:20.141+0000","size":158,"mimeType":"application/json","content":"https://issues.apache.org/jira/secure/attachment/12818908/avroremoved.json"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"org.apache.hadoop.hive.metastore.api.Table does not return columns from Avro schema file","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lv","name":"lv","key":"lv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lv&avatarId=31242","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lv&avatarId=31242","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lv&avatarId=31242","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lv&avatarId=31242"},"displayName":"Lars Volker","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lv","name":"lv","key":"lv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lv&avatarId=31242","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lv&avatarId=31242","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lv&avatarId=31242","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lv&avatarId=31242"},"displayName":"Lars Volker","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12982508/comment/15384775","id":"15384775","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lv","name":"lv","key":"lv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lv&avatarId=31242","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lv&avatarId=31242","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lv&avatarId=31242","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lv&avatarId=31242"},"displayName":"Lars Volker","active":true,"timeZone":"America/Los_Angeles"},"body":"SQL to create table (avro.sql):\n{noformat}\nCREATE TABLE avro_table\n  PARTITIONED BY (str_part STRING)\n  ROW FORMAT SERDE\n  'org.apache.hadoop.hive.serde2.avro.AvroSerDe'\n  STORED AS INPUTFORMAT\n  'org.apache.hadoop.hive.ql.io.avro.AvroContainerInputFormat'\n  OUTPUTFORMAT\n  'org.apache.hadoop.hive.ql.io.avro.AvroContainerOutputFormat'\n  TBLPROPERTIES (\n    'avro.schema.url'='hdfs://localhost:20500/tmp/avro.json'\n  );\n{noformat}\n\navro.json:\n{noformat}\n{\n    \"namespace\": \"com.cloudera.test\",\n    \"name\": \"avro_table\",\n    \"type\": \"record\",\n    \"fields\": [\n    { \"name\":\"string1\", \"type\":\"string\" },\n    { \"name\":\"CamelCol\", \"type\":\"string\" }\n    ]\n    }\n{noformat}\n\navroremoved.json (one column removed from schema):\n{noformat}\n{\n    \"namespace\": \"com.cloudera.test\",\n    \"name\": \"avro_table\",\n    \"type\": \"record\",\n    \"fields\": [\n    { \"name\":\"string1\", \"type\":\"string\" }\n    ]\n    }\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lv","name":"lv","key":"lv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lv&avatarId=31242","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lv&avatarId=31242","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lv&avatarId=31242","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lv&avatarId=31242"},"displayName":"Lars Volker","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-19T20:06:20.145+0000","updated":"2016-07-19T20:06:20.145+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12982508/comment/15847433","id":"15847433","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"body":"[~lv] I think you can get the actual schema from the following method: {{get_schema(String db, String tableName)}}\n\nThe {{get_schema}} method will return the partition columns (read from COLUMNS_V2) and the regular columns (read from the table serialization library). The serialization library will build the columns from what Hive uses as schema on the table. This schema should be based on the {{avro.schema.url}}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"created":"2017-01-31T20:18:31.119+0000","updated":"2017-01-31T20:18:31.119+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12982508/comment/15847742","id":"15847742","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lv","name":"lv","key":"lv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lv&avatarId=31242","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lv&avatarId=31242","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lv&avatarId=31242","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lv&avatarId=31242"},"displayName":"Lars Volker","active":true,"timeZone":"America/Los_Angeles"},"body":"[~spena] - Thanks for the update. Has this been added to Hive recently? Can you point me to a commit that adds the feature?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lv","name":"lv","key":"lv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lv&avatarId=31242","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lv&avatarId=31242","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lv&avatarId=31242","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lv&avatarId=31242"},"displayName":"Lars Volker","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-31T23:52:54.962+0000","updated":"2017-01-31T23:52:54.962+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12982508/comment/15847746","id":"15847746","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"Note that since 2.0 (HIVE-11985) the column names for serdes with external schemas are generally not stored in metastore anymore.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-31T23:57:20.627+0000","updated":"2017-01-31T23:57:20.627+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-14086/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3004v:"}}