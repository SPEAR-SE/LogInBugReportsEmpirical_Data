{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12666199","self":"https://issues.apache.org/jira/rest/api/2/issue/12666199","key":"HIVE-5172","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-08-31T01:30:53.206+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Oct 22 15:34:25 UTC 2013","customfield_12310420":"346138","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5172/watchers","watchCount":6,"isWatching":false},"created":"2013-08-29T21:36:57.377+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317742","id":"12317742","description":"released","name":"0.9.0","archived":false,"released":true,"releaseDate":"2012-04-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12320745","id":"12320745","description":"released","name":"0.10.0","archived":false,"released":true,"releaseDate":"2013-01-11"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323587","id":"12323587","description":"Hive 0.11.0","name":"0.11.0","archived":false,"released":true,"releaseDate":"2013-05-15"}],"issuelinks":[{"id":"12374858","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12374858","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12554269","key":"HIVE-3008","self":"https://issues.apache.org/jira/rest/api/2/issue/12554269","fields":{"summary":"Memory leak in TUGIContainingTransport","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-10-22T15:34:25.099+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312584","id":"12312584","name":"Metastore","description":"Tracks issue dealing with metastore."}],"timeoriginalestimate":null,"description":"We are running into frequent problem using HCatalog 0.4.1 (Hive Metastore Server 0.9) where we get connection reset or connection timeout errors on the client and NullPointerException in TUGIBasedProcessor on the server. \n\n\n{code}\n\nhive client logs:\n=================\n\norg.apache.thrift.transport.TTransportException: java.net.SocketTimeoutException: Read timed out\nat org.apache.thrift.transport.TIOStreamTransport.read(TIOStreamTransport.java:129)\nat org.apache.thrift.transport.TTransport.readAll(TTransport.java:84)\nat org.apache.thrift.protocol.TBinaryProtocol.readAll(TBinaryProtocol.java:378)\nat org.apache.thrift.protocol.TBinaryProtocol.readI32(TBinaryProtocol.java:297)\nat org.apache.thrift.protocol.TBinaryProtocol.readMessageBegin(TBinaryProtocol.java:204)\nat org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:69)\nat org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Client.recv_set_ugi(ThriftHiveMetastore.java:2136)\nat org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Client.set_ugi(ThriftHiveMetastore.java:2122)\nat org.apache.hadoop.hive.metastore.HiveMetaStoreClient.openStore(HiveMetaStoreClient.java:286)\nat org.apache.hadoop.hive.metastore.HiveMetaStoreClient.open(HiveMetaStoreClient.java:197)\nat org.apache.hadoop.hive.metastore.HiveMetaStoreClient.<init>(HiveMetaStoreClient.java:157)\nat org.apache.hadoop.hive.ql.metadata.Hive.createMetaStoreClient(Hive.java:2092)\nat org.apache.hadoop.hive.ql.metadata.Hive.getMSC(Hive.java:2102)\nat org.apache.hadoop.hive.ql.metadata.Hive.getTable(Hive.java:888)\nat org.apache.hadoop.hive.ql.metadata.Hive.getTable(Hive.java:830)\nat org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.getMetaData(SemanticAnalyzer.java:954)\nat org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:7524)\nat org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:243)\nat org.apache.hadoop.hive.ql.Driver.compile(Driver.java:431)\nat org.apache.hadoop.hive.ql.Driver.compile(Driver.java:336)\nat org.apache.hadoop.hive.ql.Driver.run(Driver.java:909)\nat org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:258)\nat org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:215)\nat org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:406)\nat org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:341)\nat org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:642)\nat org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:557)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\nat java.lang.reflect.Method.invoke(Method.java:597)\nat org.apache.hadoop.util.RunJar.main(RunJar.java:156)\nCaused by: java.net.SocketTimeoutException: Read timed out\nat java.net.SocketInputStream.socketRead0(Native Method)\nat java.net.SocketInputStream.read(SocketInputStream.java:129)\nat org.apache.thrift.transport.TIOStreamTransport.read(TIOStreamTransport.java:127)\n... 31 more\n{code}\n\n{code}\n\nhive metastore server logs:\n===============================\n\n2013-07-26 06:34:52,853 ERROR server.TThreadPoolServer (TThreadPoolServer.java:run(182)) - Error occurred during processing of message.\njava.lang.NullPointerException\n        at org.apache.hadoop.hive.metastore.TUGIBasedProcessor.setIpAddress(TUGIBasedProcessor.java:183)\n        at org.apache.hadoop.hive.metastore.TUGIBasedProcessor.process(TUGIBasedProcessor.java:79)\n        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:176)\nat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\nat java.lang.Thread.run(Thread.java:662)\n{code}\n\nAdding some extra debug log messages in TUGIBasedProcessor, noticed that the TUGIContainingTransport is null which results in NullPointerException on the server.\n\nFurther drilling into TUGIContainingTransport noticed that getTransport() returns a null which causes the above \nerror. \n\nFurther corelating with GC logs observed that that error always hits when the CMS GC has just kicked in \n(but does not happen after every GC)\n\n\n\nPut some debugging code in TUGIContainingTransport.getTransport() and I tracked it down to \n\n{code}\n@Override\npublic TUGIContainingTransport getTransport(TTransport trans) {\n\n      // UGI information is not available at connection setup time, it will be set later\n      // via set_ugi() rpc.\n      transMap.putIfAbsent(trans, new TUGIContainingTransport(trans));\n\n      //return transMap.get(trans); //<-change\n\n      TUGIContainingTransport retTrans = transMap.get(trans);\n\n      if ( retTrans == null ) {\n             LOGGER.error (\"cannot find transport that was in map !!\")\n\t     return retTrans;\n       }  else {\n             LOGGER.debug (\"found transport in map\")\n             return retTrans;    \n       }\n}\n{code}\n\nWhen we run this in our test environment, see that we run into the problem just after GC runs,\nand \"cannot find transport that was in the map!!\" message gets logged.\n\nCould the GC be collecting entries from transMap, just before the we get it \n\nTried a minor change which seems to work\n\n{code}\npublic TUGIContainingTransport getTransport(TTransport trans) {\n\n   TUGIContainingTransport tugiTrans = transMap.get(trans);\n\n    if ( tugiTrans == null ) {\n      // UGI information is not available at connection setup time, it will be set later\n      // via set_ugi() rpc.\n       tugiTrans = new TUGIContainingTransport(trans); //get a new TUGIContainingTransport\n        transMap.putIfAbsent(trans, tugiTrans);\n    }\n   return tugiTrans;\n}\n{code}\n\nMy questions for hive and  thrift experts\n\n1.) Do we need to use a ConcurrentMap\n{code}\nConcurrentMap<TTransport, TUGIContainingTransport> transMap = new MapMaker().weakKeys().weakValues().makeMap();\n{code}\nIt does use == to compare keys (which might be the problem), also in this case we cant rely on the trans to be always there in the transMap, even after a put, so in that case change above probably makes sense\n\n2.) Is it better idea to use WeakHashMap with WeakReference value instead ? (was looking at org.apache.thrift.transport.TSaslServerTransport, especially change made by THRIFT-1468 as an example)\n\ne.g.\n{code}\nprivate static Map<TTransport, WeakReference<TUGIContainingTransport>> transMap = Collections.synchronizedMap(new WeakHashMap<TTransport, WeakReference<TUGIContainingTransport>>());\n{code}\n\ngetTransport() would be something like\n\n{code}\npublic TUGIContainingTransport getTransport(TTransport trans) {\n      WeakReference<TUGIContainingTransport> ret = transMap.get(trans);\n      if (ret == null || ret.get() == null) {\n        ret = new WeakReference<TUGIContainingTransport>(new TUGIContainingTransport(trans));  \n        transMap.put(trans, ret); // No need for putIfAbsent().\n         // Concurrent calls to getTransport() will pass in different TTransports.\n      }\n      return ret.get();\n}\n{code}\n\n3.) Is it absolutely essential that successive calls to get getTransport() need to retrieve the same TUGIContainingTransport object or its ok to create a new one, if its not available in the map ?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12600723","id":"12600723","filename":"HIVE-5172.1.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=agateaaa","name":"agateaaa","key":"agateaaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashwin Agate","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-30T03:56:45.871+0000","size":945,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12600723/HIVE-5172.1.patch.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"346439","customfield_12312823":null,"summary":"TUGIContainingTransport returning null transport, causing intermittent SocketTimeoutException on hive client and NullPointerException in TUGIBasedProcessor on the server","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=agateaaa","name":"agateaaa","key":"agateaaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashwin Agate","active":true,"timeZone":"Etc/UTC"},"subtasks":[{"id":"12674746","key":"HIVE-5597","self":"https://issues.apache.org/jira/rest/api/2/issue/12674746","fields":{"summary":"Temporary fix for HIVE-5172 (possible NPE in TUGIContainingTransport)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=agateaaa","name":"agateaaa","key":"agateaaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashwin Agate","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666199/comment/13754351","id":"13754351","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=agateaaa","name":"agateaaa","key":"agateaaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashwin Agate","active":true,"timeZone":"Etc/UTC"},"body":"Uploading a patch which creates a new TUGIContainingTransport and adds it to the map, and returns the newly created TUGIContainingTransport","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=agateaaa","name":"agateaaa","key":"agateaaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashwin Agate","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-30T03:56:45.873+0000","updated":"2013-08-30T03:56:45.873+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666199/comment/13755179","id":"13755179","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=agateaaa","name":"agateaaa","key":"agateaaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashwin Agate","active":true,"timeZone":"Etc/UTC"},"body":"Please review this patch. Its a minor change as noted in description above. Checks transMap for cached  TUGIContainingTransport, creates a new object and adds it  cache, and returns it (doesnt look in the cache after put, where the possibility is that it wont be there if the entry has been garbage collected).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=agateaaa","name":"agateaaa","key":"agateaaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashwin Agate","active":true,"timeZone":"Etc/UTC"},"created":"2013-08-30T21:53:13.622+0000","updated":"2013-08-30T21:53:13.622+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666199/comment/13755330","id":"13755330","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12600723/HIVE-5172.1.patch.txt\n\n{color:green}SUCCESS:{color} +1 2902 tests passed\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/578/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/578/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n{noformat}\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-08-31T01:30:53.206+0000","updated":"2013-08-31T01:30:53.206+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666199/comment/13769220","id":"13769220","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"+1 for the patch, but I cannot reply any of questions. [~ashutoshc] Could you check this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-09-17T05:35:34.321+0000","updated":"2013-09-17T05:35:34.321+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666199/comment/13769239","id":"13769239","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"As I mentioned in https://issues.apache.org/jira/browse/HIVE-3805?focusedCommentId=13533106&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13533106 this TUGIContainingTransport is really a hack, current way to do this is to use {{Plain Sasl Server}} otherwise we keep running into problems like this. [~agateaaa] wondering if you would like to pursue the 'proper fix'? \nIf not, than I need to think a bit for this current patch. Will get back to you soon. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-09-17T06:01:24.272+0000","updated":"2013-09-17T06:01:24.272+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666199/comment/13769843","id":"13769843","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=agateaaa","name":"agateaaa","key":"agateaaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashwin Agate","active":true,"timeZone":"Etc/UTC"},"body":"~ashutoshc, We have a patched version currently running in our test environment and havent run into any other problems for more than two weeks. I agree having a elegant solution is probably warranted but probably should be done in a different JIRA (just my opinion). This problem was a showstopper P1 issue for us and had to spend weeks to track it down.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=agateaaa","name":"agateaaa","key":"agateaaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashwin Agate","active":true,"timeZone":"Etc/UTC"},"created":"2013-09-17T19:37:46.850+0000","updated":"2013-09-17T19:37:46.850+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666199/comment/13774261","id":"13774261","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Though fix seems harmless, I think it doesn't eliminate root cause. Under intense GC pressure, same problem may occur even with this fix. I am fine putting this in, but just be aware this fix has not solved the root cause.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-09-23T03:03:27.747+0000","updated":"2013-09-23T03:03:27.747+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666199/comment/13787438","id":"13787438","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=agateaaa","name":"agateaaa","key":"agateaaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashwin Agate","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~ashutoshc] and [~navis] for taking the time to look at this patch. Can we put this patch in ? Having this patch in will be helpful for lot of users as its better than the way it is right now (which is not usable at all for production use under any circumstance)\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=agateaaa","name":"agateaaa","key":"agateaaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashwin Agate","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-06T00:51:18.248+0000","updated":"2013-10-06T00:51:18.248+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666199/comment/13801566","id":"13801566","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hive-trunk-hadoop1-ptest #210 (See [https://builds.apache.org/job/Hive-trunk-hadoop1-ptest/210/])\nHIVE-5597 : Temporary fix for HIVE-5172 (possible NPE in TUGIContainingTransport) (agate via Navis) (navis: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1534524)\n* /hive/trunk/shims/src/common/java/org/apache/hadoop/hive/thrift/TUGIContainingTransport.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-22T07:26:18.736+0000","updated":"2013-10-22T07:26:18.736+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666199/comment/13801584","id":"13801584","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"As mentioned above by Ashutosh, current patch is not complete fix for this problem. So I've made separate issue and committed to trunk for a temporal mending.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-10-22T07:47:41.171+0000","updated":"2013-10-22T07:47:41.171+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666199/comment/13801658","id":"13801658","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hive-trunk-hadoop2-ptest #148 (See [https://builds.apache.org/job/Hive-trunk-hadoop2-ptest/148/])\nHIVE-5597 : Temporary fix for HIVE-5172 (possible NPE in TUGIContainingTransport) (agate via Navis) (navis: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1534524)\n* /hive/trunk/shims/src/common/java/org/apache/hadoop/hive/thrift/TUGIContainingTransport.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-22T09:52:20.694+0000","updated":"2013-10-22T09:52:20.694+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666199/comment/13801925","id":"13801925","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hive-trunk-h0.21 #2414 (See [https://builds.apache.org/job/Hive-trunk-h0.21/2414/])\nHIVE-5597 : Temporary fix for HIVE-5172 (possible NPE in TUGIContainingTransport) (agate via Navis) (navis: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1534524)\n* /hive/trunk/shims/src/common/java/org/apache/hadoop/hive/thrift/TUGIContainingTransport.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-22T15:34:19.894+0000","updated":"2013-10-22T15:34:19.894+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12666199/comment/13801929","id":"13801929","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hive-trunk-hadoop2 #516 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/516/])\nHIVE-5597 : Temporary fix for HIVE-5172 (possible NPE in TUGIContainingTransport) (agate via Navis) (navis: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1534524)\n* /hive/trunk/shims/src/common/java/org/apache/hadoop/hive/thrift/TUGIContainingTransport.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-10-22T15:34:25.099+0000","updated":"2013-10-22T15:34:25.099+0000"}],"maxResults":13,"total":13,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5172/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1notj:"}}