{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12718872","self":"https://issues.apache.org/jira/rest/api/2/issue/12718872","key":"HIVE-7186","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jun 20 14:16:13 UTC 2014","customfield_12310420":"397071","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-7186/watchers","watchCount":1,"isWatching":false},"created":"2014-06-06T15:58:15.122+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324312","id":"12324312","description":"released","name":"0.12.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-06-20T14:16:13.096+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"Occasionally, a table will start exhibiting behavior that will prevent it from being used in a JOIN. \n\nWhen doing a map join, it will just stall at \"Starting to launch local task to process map join; \".\nWhen doing a regular join, it will make progress but then error out with a IndexOutOfBoundsException:\n\nCaused by: org.apache.hadoop.hive.ql.metadata.HiveException: java.lang.IndexOutOfBoundsException\n        at org.apache.hadoop.hive.ql.exec.ReduceSinkOperator.processOp(ReduceSinkOperator.java:365)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:504)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:842)\n        at org.apache.hadoop.hive.ql.exec.TableScanOperator.processOp(TableScanOperator.java:91)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:504)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:842)\n        at org.apache.hadoop.hive.ql.exec.MapOperator.process(MapOperator.java:534)\n        ... 9 more\nCaused by: java.lang.IndexOutOfBoundsException\n        at java.nio.Buffer.checkIndex(Buffer.java:532)\n        at java.nio.ByteBufferAsIntBufferL.put(ByteBufferAsIntBufferL.java:131)\n        at org.apache.hadoop.mapred.MapTask$MapOutputBuffer.collect(MapTask.java:1153)\n        at org.apache.hadoop.mapred.MapTask$OldOutputCollector.collect(MapTask.java:586)\n        at org.apache.hadoop.hive.ql.exec.ReduceSinkOperator.collect(ReduceSinkOperator.java:372)\n        at org.apache.hadoop.hive.ql.exec.ReduceSinkOperator.processOp(ReduceSinkOperator.java:334)\n        ... 15 more\n        \nDoing simple selects against this table work fine and do not show any apparent problems with the data.\n\nAssume that the table in question is called tableA and was created by queryA.\n\nDoing either of the following has helped resolve the issue in the past.\n\n1) create table tableB as select * from tableA;\n\n  Then just use tableB instead in the JOIN.\n\n2) regenerate tableA using queryA\n\n  Then use tableA in the JOIN again. It usually works the second time.\n  \n\nWhen doing a \"describe formatted\" on the tables, the totalSize will be different between the original tableA and tableB, and sometimes (but not always) between the original tableA and the regenerated tableA. The numRows will be the same across all versions of the tables.\n\nThis problem can not be reproduced consistently, but the issue always happens when we try to use an affected table in a JOIN.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"397189","customfield_12312823":null,"summary":"Unable to perform join on table","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=terrasect","name":"terrasect","key":"terrasect","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Nastetsky","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=terrasect","name":"terrasect","key":"terrasect","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Nastetsky","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Hortonworks Data Platform 2.0.6.0","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12718872/comment/14038830","id":"14038830","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=terrasect","name":"terrasect","key":"terrasect","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Nastetsky","active":true,"timeZone":"America/New_York"},"body":"I just saw a similar problem with with a different stacktrace. This time, the join got to the very end of the job and failed as it finished:\n{code}\norg.apache.hadoop.yarn.exceptions.YarnRuntimeException: java.io.EOFException: Premature EOF: no length prefix available\n\tat org.apache.hadoop.mapreduce.jobhistory.JobHistoryEventHandler.handleEvent(JobHistoryEventHandler.java:514)\n\tat org.apache.hadoop.mapreduce.jobhistory.JobHistoryEventHandler.serviceStop(JobHistoryEventHandler.java:332)\n\tat org.apache.hadoop.service.AbstractService.stop(AbstractService.java:221)\n\tat org.apache.hadoop.service.ServiceOperations.stop(ServiceOperations.java:52)\n\tat org.apache.hadoop.service.ServiceOperations.stopQuietly(ServiceOperations.java:80)\n\tat org.apache.hadoop.service.CompositeService.stop(CompositeService.java:159)\n\tat org.apache.hadoop.service.CompositeService.serviceStop(CompositeService.java:132)\n\tat org.apache.hadoop.service.AbstractService.stop(AbstractService.java:221)\n\tat org.apache.hadoop.mapreduce.v2.app.MRAppMaster.shutDownJob(MRAppMaster.java:548)\n\tat org.apache.hadoop.mapreduce.v2.app.MRAppMaster$JobFinishEventHandler$1.run(MRAppMaster.java:599)\nCaused by: java.io.EOFException: Premature EOF: no length prefix available\n\tat org.apache.hadoop.hdfs.protocolPB.PBHelper.vintPrefixed(PBHelper.java:1492)\n\tat org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.transfer(DFSOutputStream.java:962)\n\tat org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.addDatanode2ExistingPipeline(DFSOutputStream.java:930)\n\tat org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.setupPipelineForAppendOrRecovery(DFSOutputStream.java:1031)\n\tat org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.processDatanodeError(DFSOutputStream.java:823)\n\tat org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.run(DFSOutputStream.java:475)\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=terrasect","name":"terrasect","key":"terrasect","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Nastetsky","active":true,"timeZone":"America/New_York"},"created":"2014-06-20T14:16:13.096+0000","updated":"2014-06-20T14:16:13.096+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-7186/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1wczr:"}}