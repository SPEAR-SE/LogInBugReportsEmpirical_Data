{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13057609","self":"https://issues.apache.org/jira/rest/api/2/issue/13057609","key":"HIVE-16257","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2017-03-20T20:03:16.681+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Apr 07 21:10:41 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1565901750_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2017-04-07T20:46:50.038+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-16257/watchers","watchCount":6,"isWatching":false},"created":"2017-03-20T17:48:28.325+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329363","id":"12329363","name":"1.1.0","archived":false,"released":true,"releaseDate":"2015-03-07"}],"issuelinks":[{"id":"12500313","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12500313","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12924986","key":"HIVE-12768","self":"https://issues.apache.org/jira/rest/api/2/issue/12924986","fields":{"summary":"Thread safety: binary sortable serde decimal deserialization","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-04-07T21:10:41.706+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12325007","id":"12325007","name":"Hive"}],"timeoriginalestimate":null,"description":"This issue is highly intermittent that only seems to occurs with spark engine when the query has a GROUPBY clause. The following is the testcase.\n{code}\ndrop table if exists test_hos_sample;\ncreate table test_hos_sample (name string, val1 decimal(18,2), val2 decimal(20,3));\ninsert into test_hos_sample values ('test1',101.12,102.123),('test1',101.12,102.123),('test2',102.12,103.234),('test1',101.12,102.123),('test3',103.52,102.345),('test3',103.52,102.345),('test3',103.52,102.345),('test3',103.52,102.345),('test3',103.52,102.345),('test4',104.52,104.456),('test4',104.52,104.456),('test5',105.52,105.567),('test3',103.52,102.345),('test5',105.52,105.567);\n\nset hive.execution.engine=spark;\nselect  name, val1,val2 from test_hos_sample group by name, val1, val2;\n{code}\n\nExpected Results:\n{code}\nname    val1    val2\ntest5   105.52  105.567\ntest3   103.52  102.345\ntest1   101.12  102.123\ntest4   104.52  104.456\ntest2   102.12  103.234\n{code}\n\nIncorrect results once in a while:\n{code}\nname    val1    val2\ntest5   105.52  105.567\ntest3   103.52  102.345\ntest1   104.52  102.123\ntest4   104.52  104.456\ntest2   102.12  103.234\n{code}\n\n1) Not reproducible with HoMR.\n2) Not an issue when running from spark-shell.\n3) Not reproducible when the column data type is String or double. Only reproducible with decimal data types. Also works fine for decimal datatype if you cast decimal as string on read and cast it back to decimal on select.\n4) Occurs with parquet and text file format as well. (havent tried with other formats).\n5) Occurs in both scenarios when table data is within encryption zone and outside.\n6) Even in clusters where this is reproducible, this occurs once in like 20 times or more.\n7) Occurs with both Beeline and Hive CLI.\n8) Reproducible only when there is a a groupby clause.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12862157","id":"12862157","filename":"failed_yarnlogs.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"created":"2017-04-05T20:48:45.426+0000","size":254502,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12862157/failed_yarnlogs.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12862158","id":"12862158","filename":"success_yarnlogs.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"created":"2017-04-05T20:48:45.432+0000","size":182021,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12862158/success_yarnlogs.log"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Intermittent issue with incorrect resultset with Spark","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057609/comment/15933187","id":"15933187","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"body":"[~xuefuz] [~szehon] Any clues on where this could be originating? When the problem does occur, the incorrect column value always seems to match a value from another row like show above. \nRuled out any beeline display issue with output because it is reproducible from CLI too.\nAlthough this is not reproducible with spark-shell, I have not ruled out to be a spark issue because the set of transformations used by spark-shell could be different from the transformations used by Hive.\n\nWhat code should we instrument to confirm or eliminate hive as a source of the problem? Any help appreciated. Thank you","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"created":"2017-03-20T17:57:33.033+0000","updated":"2017-03-20T17:57:33.033+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057609/comment/15933423","id":"15933423","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=appodictic","name":"appodictic","key":"appodictic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Capriolo","active":true,"timeZone":"Etc/UTC"},"body":"Now THAT is how to file a bug report! Tried it 8 different ways!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=appodictic","name":"appodictic","key":"appodictic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Capriolo","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-20T20:03:16.681+0000","updated":"2017-03-20T20:03:16.681+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057609/comment/15933437","id":"15933437","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"body":"Thanks [~appodictic] I try to add as many details as possible. It helps others understand the issue as well. Heck, even myself. A couple of months from now, I would be wondering what this issue was. :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"created":"2017-03-20T20:09:52.849+0000","updated":"2017-03-20T20:09:52.849+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057609/comment/15933741","id":"15933741","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~ngangam], This does sound like a concurrency issue. If you are able to reproduce the issue, it would be helpful to get the yarn logs. Ideally, you can get logs for one run that doesn't produce the problem. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-03-20T22:38:07.527+0000","updated":"2017-03-20T22:38:07.527+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057609/comment/15957637","id":"15957637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"body":"Managed to reproduced this in-house (just on one particular cluster though). \nI am attaching the yarn logs from one particular run when I could reproduce the issue the first time(@17/03/29 09:21:36) I ran the query, but the next run (@17/03/29 09:23:23) immediately after the first worked fine.\n\nQuery plan looks identical in both cases and I do not spot anything that looks suspicious. [~xuefuz] Could you take a quick look to see if you can spot something? Any help much appreciated. Thanks a bunch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"created":"2017-04-05T20:48:45.437+0000","updated":"2017-04-05T20:48:45.437+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057609/comment/15957927","id":"15957927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~ngangam], thanks for providing the log. Unfortunately, the log does't tell much. I also tried the case many times but failed to reproduce. I'm using cdh 5.7.2.\n\nBTW, when you reproduced it, did you run the query in the same user session or different ones?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-04-05T22:35:43.683+0000","updated":"2017-04-05T22:35:43.683+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057609/comment/15959003","id":"15959003","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"body":"[~xuefuz] Thanks for taking a look at this.  I can reproduce it by re-running the query within the same beeline session. Also by setting {{spark.executor.cores=1}} the issue no longer occurs. So serializing the tasks within spark somehow doesnt cause this issue. In discussion with the spark team, they think it is an indication of a race condition on HoS side.\nFrom the spark plan, we have 2 stages, the root stage with 4 tasks. The second stage has just one task.\nWe only have a single input split in this case, so I am guessing that the number of tasks are determined by spark internals based on number of spark partitions.\n{code}\n17/03/29 09:21:51 INFO input.FileInputFormat: Total input paths to process : 1\n17/03/29 09:21:51 INFO input.CombineFileInputFormat: DEBUG: Terminated node allocation with : CompletedNodes: 3, size left: 0\n17/03/29 09:21:51 INFO io.CombineHiveInputFormat: number of splits 1\n17/03/29 09:21:51 INFO io.CombineHiveInputFormat: Number of all splits 1\n{code}\n\nIf a single executor running all these tasks can resolve the issue, to me it suggests there might be an issue in Spark. But I am not sure how to conclude this either way. Any tips? Thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"created":"2017-04-06T14:25:55.470+0000","updated":"2017-04-06T14:25:55.470+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057609/comment/15959366","id":"15959366","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"It's a little strange that you have 4 tasks in the first stage, given that there are only 5 rows. I have only one task, which could explain why I couldn't reproduce the problem. Can you check how many source files you have for the table?\n\nI think it's helpful if you can find out why you have 4 tasks, which might give some hints where it might go wrong.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-04-06T17:24:02.206+0000","updated":"2017-04-06T17:24:02.206+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057609/comment/15961367","id":"15961367","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mszurap","name":"mszurap","key":"mszurap","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Miklos Szurap","active":true,"timeZone":"Europe/Budapest"},"body":"It seems like HIVE-12768 is the root cause.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mszurap","name":"mszurap","key":"mszurap","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Miklos Szurap","active":true,"timeZone":"Europe/Budapest"},"created":"2017-04-07T20:05:49.905+0000","updated":"2017-04-07T20:05:49.905+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057609/comment/15961411","id":"15961411","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"body":"[~xuefuz] In my case, it is always coming out to 4 tasks (in the first stage) for some reason. There is a single input file on hdfs. However, the default {{spark.executor.cores}} for me is 4. I dont know if they are related. After adding some instrumentation, the data being passed to reducers was found to be correct indicating the problem was prior to this phase. Seems like we use serde to parse decimal types which pointed to HIVE-12768. It does not occur with HoMR because each mapper is run in a seperate process. It also does not occur when using a single executor.cores because it uses single thread to process it.\n\nWith the fix for HIVE-12768, we are currently unable to reproduce the issue after several dozens of retries. As far as it being an intermittent issue, I think the size of the data matters. The larger the dataset, the higher the chance of reproducing it. In this case, the data was very small and hence was hard to reproduce. Closing this jira. Thanks for all your help [~xuefuz]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ngangam","name":"ngangam","key":"ngangam","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Naveen Gangam","active":true,"timeZone":"America/New_York"},"created":"2017-04-07T20:45:50.291+0000","updated":"2017-04-07T20:45:50.291+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13057609/comment/15961436","id":"15961436","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~ngangam], Yes, our build has HIVE-12768, which explains why we cannot reproduce the issue. Nevertheless, you should check why you have 4 tasks for a 5-row file. I also have spark.executor.core=4, and I only see one task. Also, I was using text file. That can also relate to minSplitSize, etc. \n\nBesides HIVE-12768, we have also fixed many concurrency issues that can impact HoS.\n\nThanks for looking to this problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-04-07T21:10:41.706+0000","updated":"2017-04-07T21:10:41.706+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-16257/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3cj3b:"}}