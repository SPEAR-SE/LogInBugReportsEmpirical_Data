{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12989134","self":"https://issues.apache.org/jira/rest/api/2/issue/12989134","key":"HIVE-14227","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-07-22T10:04:34.579+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 27 14:25:54 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-14227/watchers","watchCount":11,"isWatching":false},"created":"2016-07-13T14:34:59.636+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332641","id":"12332641","description":"Hive 2.0.0","name":"2.0.0","archived":false,"released":true,"releaseDate":"2016-02-15"}],"issuelinks":[{"id":"12475771","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12475771","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12955709","key":"HIVE-13415","self":"https://issues.apache.org/jira/rest/api/2/issue/12955709","fields":{"summary":"Decouple Sessions from thrift binary transport","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12475770","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12475770","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12852560","key":"HIVE-11485","self":"https://issues.apache.org/jira/rest/api/2/issue/12852560","fields":{"summary":"Session close should not close async SQL operations","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-07-27T14:25:54.660+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320408","id":"12320408","name":"HiveServer2","description":"Tracks issues related to HiveServer2"}],"timeoriginalestimate":null,"description":"There are the following warnings. \n\n{noformat}\nWARN  org.apache.hive.service.cli.thrift.ThriftCLIService: [HiveServer2-Handler-Pool: Thread-55]: Error executing statement:\norg.apache.hive.service.cli.HiveSQLException: Invalid SessionHandle: SessionHandle [1bc00251-64e9-4a95-acb7-a7f53f773528]\n        at org.apache.hive.service.cli.session.SessionManager.getSession(SessionManager.java:318)\n        at org.apache.hive.service.cli.CLIService.executeStatementAsync(CLIService.java:258)\n        at org.apache.hive.service.cli.thrift.ThriftCLIService.ExecuteStatement(ThriftCLIService.java:506)\n        at org.apache.hive.service.cli.thrift.TCLIService$Processor$ExecuteStatement.getResult(TCLIService.java:1313)\n        at org.apache.hive.service.cli.thrift.TCLIService$Processor$ExecuteStatement.getResult(TCLIService.java:1298)\n        at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39)\n{noformat}\n\n{noformat}\nWARN  org.apache.hive.service.cli.thrift.ThriftCLIService: [HiveServer2-Handler-Pool: Thread-1060]: Error closing operation:\norg.apache.hive.service.cli.HiveSQLException: Invalid OperationHandle: OperationHandle [opType=EXECUTE_STATEMENT, getHandleIdentifier()=13d930dd-316c-4c09-9f44-fee5f483e73d]\n        at org.apache.hive.service.cli.operation.OperationManager.getOperation(OperationManager.java:185)\n        at org.apache.hive.service.cli.CLIService.closeOperation(CLIService.java:408)\n        at org.apache.hive.service.cli.thrift.ThriftCLIService.CloseOperation(ThriftCLIService.java:664)\n        at org.apache.hive.service.cli.thrift.TCLIService$Processor$CloseOperation.getResult(TCLIService.java:1513)\n        at org.apache.hive.service.cli.thrift.TCLIService$Processor$CloseOperation.getResult(TCLIService.java:1498)\n        at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39)\n        at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39)\n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12819724","id":"12819724","filename":"HIVE-14227.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-22T21:22:22.149+0000","size":151636,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12819724/HIVE-14227.1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Investigate invalid SessionHandle and invalid OperationHandle","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[{"id":"12988435","key":"HIVE-14209","self":"https://issues.apache.org/jira/rest/api/2/issue/12988435","fields":{"summary":"Add some logging info for session and operation management","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}},{"id":"12989480","key":"HIVE-14239","self":"https://issues.apache.org/jira/rest/api/2/issue/12989480","fields":{"summary":"Change OperationManager to serve each session and make it threadsafe","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15382488","id":"15382488","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"body":"I spent some time understanding the issue. Seems the problem comes from disconnection between connection and session. For beeline client, we are creating a connection and then open a session on top of it. Then we close session and destroy the connection. That's fine. While if a connection (connection2) is created and we make calls with an existing session, that's legal. But if the other connection (connection1) in which session is opened gets destroyed, the session gets destroyed as well and we will see invalid sessionHandle from connection2.  Hope my understanding is correct. \n\nI'm thinking of the following approach: similar to a call openSession(), we can add a call bindSession(sessionHandle) for a new connection with an existing session handle. Then each connection will be aware of the session and the following calls can be called without sessionHandle. Also the session will remember associated connections with it and session can be really closed when there is no connections.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-18T15:52:33.256+0000","updated":"2016-07-18T15:52:33.256+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15382490","id":"15382490","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"body":"Of course, seems solving the backward compatibility will be a little challenging. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-18T15:53:58.368+0000","updated":"2016-07-18T15:53:58.368+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15387725","id":"15387725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"body":"+ [~szehon] who had worked on that before. +[~romainr] from thrift client (HUE) perspective.\n\nFrom what I understand to thrift client making hiveserver2 call: after opening a session and creating multiple connections, we are passing the same session over the connections. The issue is, the connection doesn't bind to one session so theoretically, the connection can use any session to make the call, thus, session can't be aware of the connections and the disconnected connection has to choose leaving the session open (causing the possible leak) or kill the session (cause invalid session handle from another connection).\n\nI'm working/evaluating on this binding approach and feel it's promising. The hard part is to keep backward compatible. Want to hear more ideas on that.\n\nThe new workflow would be:\n\nopenConnection =>openSession/bindSession =>  make calls without sessionHandle => closeSession => closeConnection. \n\ncloseSession will actually do unbindSession or closeSession if no active connections. If somehow closeSession is not called, closeConnection will do such work so it won't be any leaking.\n\n \n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-21T13:53:05.908+0000","updated":"2016-07-21T13:53:05.908+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15389257","id":"15389257","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szehon","name":"szehon","key":"szehon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Szehon Ho","active":true,"timeZone":"Europe/Paris"},"body":"I admit i never thought in depth of a use-case about a connection binding to an existing session instead of a new one as I was just using beeline before, but it might be useful for client like Hue.\n\nThere was some discussion about this in HIVE-11485, and there was some fix in HIVE-13415, just in case you went aware.\n\nI think [~cwsteinbach] might be able to offer some good inputs on this proposal.  He also mentioned in the previous discussion that session should be orthogonal to connection and support things like 'session migration', which I guess is being proposed here?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szehon","name":"szehon","key":"szehon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Szehon Ho","active":true,"timeZone":"Europe/Paris"},"created":"2016-07-22T10:04:34.579+0000","updated":"2016-07-22T10:04:34.579+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15390223","id":"15390223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~szehon]. Not sure what you mean \"session migration\". What I'm proposing is to bind the session with the connection so the session knows how many connections associated with it. \n\nAttached patch-1: initial patch for the proposal. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-22T21:29:40.753+0000","updated":"2016-07-22T21:29:40.753+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15391064","id":"15391064","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12819724/HIVE-14227.1.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 105 failed/errored test(s), 10156 tests executed\n*Failed tests:*\n{noformat}\nTestMsgBusConnection - did not produce a TEST-*.xml file\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_13\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_acid_globallimit\norg.apache.hadoop.hive.llap.daemon.impl.TestLlapTokenChecker.testCheckPermissions\norg.apache.hadoop.hive.llap.daemon.impl.TestLlapTokenChecker.testGetToken\norg.apache.hadoop.hive.metastore.TestMetaStoreMetrics.testConnections\norg.apache.hadoop.hive.metastore.TestPartitionNameWhitelistValidation.testAppendPartitionWithValidCharacters\norg.apache.hive.beeline.TestBeeLineWithArgs.org.apache.hive.beeline.TestBeeLineWithArgs\norg.apache.hive.beeline.cli.TestHiveCli.testCmd\norg.apache.hive.beeline.cli.TestHiveCli.testDatabaseOptions\norg.apache.hive.beeline.cli.TestHiveCli.testErrOutput\norg.apache.hive.beeline.cli.TestHiveCli.testHelp\norg.apache.hive.beeline.cli.TestHiveCli.testInValidCmd\norg.apache.hive.beeline.cli.TestHiveCli.testInvalidDatabaseOptions\norg.apache.hive.beeline.cli.TestHiveCli.testInvalidOptions\norg.apache.hive.beeline.cli.TestHiveCli.testInvalidOptions2\norg.apache.hive.beeline.cli.TestHiveCli.testNoErrorDB\norg.apache.hive.beeline.cli.TestHiveCli.testSetHeaderValue\norg.apache.hive.beeline.cli.TestHiveCli.testSetPromptValue\norg.apache.hive.beeline.cli.TestHiveCli.testSourceCmd\norg.apache.hive.beeline.cli.TestHiveCli.testSourceCmd2\norg.apache.hive.beeline.cli.TestHiveCli.testSourceCmd3\norg.apache.hive.beeline.cli.TestHiveCli.testSqlFromCmd\norg.apache.hive.beeline.cli.TestHiveCli.testSqlFromCmdWithDBName\norg.apache.hive.beeline.cli.TestHiveCli.testUseCurrentDB1\norg.apache.hive.beeline.cli.TestHiveCli.testUseCurrentDB2\norg.apache.hive.beeline.cli.TestHiveCli.testUseCurrentDB3\norg.apache.hive.beeline.cli.TestHiveCli.testUseInvalidDB\norg.apache.hive.beeline.cli.TestHiveCli.testVariables\norg.apache.hive.beeline.cli.TestHiveCli.testVariablesForSource\norg.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler.org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler\norg.apache.hive.jdbc.TestJdbcDriver2.org.apache.hive.jdbc.TestJdbcDriver2\norg.apache.hive.jdbc.TestJdbcWithLocalClusterSpark.org.apache.hive.jdbc.TestJdbcWithLocalClusterSpark\norg.apache.hive.jdbc.TestJdbcWithMiniHA.org.apache.hive.jdbc.TestJdbcWithMiniHA\norg.apache.hive.jdbc.TestJdbcWithMiniHS2.org.apache.hive.jdbc.TestJdbcWithMiniHS2\norg.apache.hive.jdbc.TestJdbcWithMiniLlap.org.apache.hive.jdbc.TestJdbcWithMiniLlap\norg.apache.hive.jdbc.TestJdbcWithMiniMr.org.apache.hive.jdbc.TestJdbcWithMiniMr\norg.apache.hive.jdbc.TestMultiSessionsHS2WithLocalClusterSpark.org.apache.hive.jdbc.TestMultiSessionsHS2WithLocalClusterSpark\norg.apache.hive.jdbc.TestNoSaslAuth.org.apache.hive.jdbc.TestNoSaslAuth\norg.apache.hive.jdbc.TestSSL.testConnectionMismatch\norg.apache.hive.jdbc.TestSSL.testConnectionWrongCertCN\norg.apache.hive.jdbc.TestSSL.testInvalidConfig\norg.apache.hive.jdbc.TestSSL.testSSLConnectionWithProperty\norg.apache.hive.jdbc.TestSSL.testSSLConnectionWithURL\norg.apache.hive.jdbc.TestSSL.testSSLFetch\norg.apache.hive.jdbc.TestSSL.testSSLFetchHttp\norg.apache.hive.jdbc.TestSchedulerQueue.testFairSchedulerPrimaryQueueMapping\norg.apache.hive.jdbc.TestSchedulerQueue.testFairSchedulerQueueMapping\norg.apache.hive.jdbc.TestSchedulerQueue.testFairSchedulerSecondaryQueueMapping\norg.apache.hive.jdbc.TestSchedulerQueue.testQueueMappingCheckDisabled\norg.apache.hive.jdbc.TestServiceDiscoveryWithMiniHS2.testConnectionWithConfigsPublished\norg.apache.hive.jdbc.TestServiceDiscoveryWithMiniHS2.testConnectionWithoutConfigsPublished\norg.apache.hive.jdbc.TestXSRFFilter.testFilterDisabledNoInjection\norg.apache.hive.jdbc.TestXSRFFilter.testFilterDisabledWithInjection\norg.apache.hive.jdbc.TestXSRFFilter.testFilterEnabledNoInjection\norg.apache.hive.jdbc.TestXSRFFilter.testFilterEnabledWithInjection\norg.apache.hive.jdbc.authorization.TestHS2AuthzContext.org.apache.hive.jdbc.authorization.TestHS2AuthzContext\norg.apache.hive.jdbc.authorization.TestHS2AuthzSessionContext.org.apache.hive.jdbc.authorization.TestHS2AuthzSessionContext\norg.apache.hive.jdbc.authorization.TestJdbcMetadataApiAuth.org.apache.hive.jdbc.authorization.TestJdbcMetadataApiAuth\norg.apache.hive.jdbc.authorization.TestJdbcWithSQLAuthUDFBlacklist.testBlackListedUdfUsage\norg.apache.hive.jdbc.authorization.TestJdbcWithSQLAuthorization.org.apache.hive.jdbc.authorization.TestJdbcWithSQLAuthorization\norg.apache.hive.jdbc.miniHS2.TestHiveServer2.org.apache.hive.jdbc.miniHS2.TestHiveServer2\norg.apache.hive.jdbc.miniHS2.TestHiveServer2SessionTimeout.testConnection\norg.apache.hive.jdbc.miniHS2.TestHs2Metrics.org.apache.hive.jdbc.miniHS2.TestHs2Metrics\norg.apache.hive.jdbc.miniHS2.TestMiniHS2.testConfInSession\norg.apache.hive.minikdc.TestHs2HooksWithMiniKdc.org.apache.hive.minikdc.TestHs2HooksWithMiniKdc\norg.apache.hive.minikdc.TestJdbcNonKrbSASLWithMiniKdc.org.apache.hive.minikdc.TestJdbcNonKrbSASLWithMiniKdc\norg.apache.hive.minikdc.TestJdbcWithDBTokenStore.org.apache.hive.minikdc.TestJdbcWithDBTokenStore\norg.apache.hive.minikdc.TestJdbcWithMiniKdc.org.apache.hive.minikdc.TestJdbcWithMiniKdc\norg.apache.hive.minikdc.TestJdbcWithMiniKdcCookie.org.apache.hive.minikdc.TestJdbcWithMiniKdcCookie\norg.apache.hive.minikdc.TestJdbcWithMiniKdcSQLAuthBinary.org.apache.hive.minikdc.TestJdbcWithMiniKdcSQLAuthBinary\norg.apache.hive.minikdc.TestJdbcWithMiniKdcSQLAuthHttp.org.apache.hive.minikdc.TestJdbcWithMiniKdcSQLAuthHttp\norg.apache.hive.service.TestHS2ImpersonationWithRemoteMS.org.apache.hive.service.TestHS2ImpersonationWithRemoteMS\norg.apache.hive.service.cli.TestEmbeddedThriftBinaryCLIService.testConfOverlay\norg.apache.hive.service.cli.TestEmbeddedThriftBinaryCLIService.testExecuteStatement\norg.apache.hive.service.cli.TestEmbeddedThriftBinaryCLIService.testExecuteStatementAsync\norg.apache.hive.service.cli.TestEmbeddedThriftBinaryCLIService.testExecuteStatementParallel\norg.apache.hive.service.cli.TestEmbeddedThriftBinaryCLIService.testGetFunctions\norg.apache.hive.service.cli.TestEmbeddedThriftBinaryCLIService.testGetInfo\norg.apache.hive.service.cli.TestEmbeddedThriftBinaryCLIService.testGlobalCompileLockTimeout\norg.apache.hive.service.cli.TestEmbeddedThriftBinaryCLIService.testOpenSession\norg.apache.hive.service.cli.TestEmbeddedThriftBinaryCLIService.testTaskStatus\norg.apache.hive.service.cli.TestRetryingThriftCLIServiceClient.testSessionLifeAfterTransportClose\norg.apache.hive.service.cli.operation.TestOperationLoggingAPIWithMr.org.apache.hive.service.cli.operation.TestOperationLoggingAPIWithMr\norg.apache.hive.service.cli.operation.TestOperationLoggingAPIWithTez.org.apache.hive.service.cli.operation.TestOperationLoggingAPIWithTez\norg.apache.hive.service.cli.operation.TestOperationLoggingLayout.org.apache.hive.service.cli.operation.TestOperationLoggingLayout\norg.apache.hive.service.cli.session.TestSessionCleanup.testTempSessionFileCleanup\norg.apache.hive.service.cli.session.TestSessionGlobalInitFile.testSessionGlobalInitDir\norg.apache.hive.service.cli.session.TestSessionGlobalInitFile.testSessionGlobalInitFile\norg.apache.hive.service.cli.session.TestSessionGlobalInitFile.testSessionGlobalInitFileAndConfOverlay\norg.apache.hive.service.cli.session.TestSessionGlobalInitFile.testSessionGlobalInitFileWithUser\norg.apache.hive.service.cli.session.TestSessionHooks.testProxyUser\norg.apache.hive.service.cli.session.TestSessionHooks.testSessionHook\norg.apache.hive.service.cli.thrift.TestThriftCLIServiceWithBinary.testExecuteStatement\norg.apache.hive.service.cli.thrift.TestThriftCLIServiceWithBinary.testExecuteStatementAsync\norg.apache.hive.service.cli.thrift.TestThriftCLIServiceWithBinary.testGetFunctions\norg.apache.hive.service.cli.thrift.TestThriftCLIServiceWithBinary.testOpenSession\norg.apache.hive.service.cli.thrift.TestThriftCLIServiceWithHttp.testExecuteStatement\norg.apache.hive.service.cli.thrift.TestThriftCLIServiceWithHttp.testExecuteStatementAsync\norg.apache.hive.service.cli.thrift.TestThriftCLIServiceWithHttp.testGetFunctions\norg.apache.hive.service.cli.thrift.TestThriftCLIServiceWithHttp.testOpenSession\norg.apache.hive.service.cli.thrift.TestThriftHttpCLIServiceFeatures.testForwardedHeaders\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/623/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/623/console\nTest logs: http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-623/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 105 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12819724 - PreCommit-HIVE-MASTER-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2016-07-24T13:44:27.416+0000","updated":"2016-07-24T13:44:27.416+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15392367","id":"15392367","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"Is this patch still relevant? I would be interested in reviewing on RB if so ;)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-25T17:43:41.642+0000","updated":"2016-07-25T17:43:41.642+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15392370","id":"15392370","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"body":"Yew. It's still relevant. Of course from the unit test failures, EmbededThriftCliService e.g. doesn't create ServerContext which needs to be addressed. But I will create a RB so you can review and give suggestions.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-25T17:47:57.245+0000","updated":"2016-07-25T17:47:57.245+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15392731","id":"15392731","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgumashta","name":"vgumashta","key":"vgumashta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vaibhav Gumashta","active":true,"timeZone":"America/Los_Angeles"},"body":"[~aihuaxu] I think what [~szehon] is referring to here is that to implement session level failover, it will help if we don't close the session on the server, when the client tcp socket that opened the session gets closed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgumashta","name":"vgumashta","key":"vgumashta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vaibhav Gumashta","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-25T21:57:55.079+0000","updated":"2016-07-25T21:57:55.079+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15392735","id":"15392735","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgumashta","name":"vgumashta","key":"vgumashta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vaibhav Gumashta","active":true,"timeZone":"America/Los_Angeles"},"body":"[~aihuaxu] Thanks for the patch. Reviewing it today. Please note that we also have a way to send thrift payloads over http (in case that needs special consideration).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgumashta","name":"vgumashta","key":"vgumashta","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vaibhav Gumashta","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-25T21:59:42.460+0000","updated":"2016-07-25T21:59:42.460+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15392741","id":"15392741","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~vgumashta]. What I'm trying to do is to let session be aware of the connections. So if the session is bound to 3 connections, disconnecting 2 connections only unbind the session and the disconnection of the third connection will close the session. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-25T22:05:20.686+0000","updated":"2016-07-25T22:05:20.686+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15394188","id":"15394188","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=taoli-hwx","name":"taoli-hwx","key":"taoli-hwx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tao Li","active":true,"timeZone":"Etc/UTC"},"body":"Hi [~aihuaxu], I just started looking at this issue and related code. Looks like each instance of HiveConnection class holds a reference to a Transport instance (representing the underlying tcp/http connection) and a reference to SessionHandle. Like you mentioned, there is no binding between the Transport instance and SessionHandle. But I don't see how a new HiveConnection can hold a reference to an existing SessionHandle. Looks like when we need to create a new HiveConnection, we create a new HiveSessionImpl instance and attach the handle the HiveConnection. Also when we need to close a HiveConnection, we close the Hive session first. \n\nSo can you elaborate how a new HiveConnection can use an existing HiveSession? Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=taoli-hwx","name":"taoli-hwx","key":"taoli-hwx","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tao Li","active":true,"timeZone":"Etc/UTC"},"created":"2016-07-26T17:46:56.164+0000","updated":"2016-07-26T17:46:56.164+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15394197","id":"15394197","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"body":"[~taoli-hwx] This issue happens when you use thrift API directly, not from JDBC. One workflow can be as follows. Notice you need to pass sessionHandle to each request so you can pass in an existing sessionHandle created from another connection. Then when you close the connection, it will also close the session while the session is still used by another connection.\n\n{noformat}\n        final TSocket tSocket = new TSocket(host, port);\n        tSocket.open();\n        final Client client = new Client(new TBinaryProtocol(tSocket));\n\n        TOpenSessionReq req = new TOpenSessionReq();\n        Map<String, String> openConf = new HashMap<String, String>();\n        req.setConfiguration(openConf);\n        TOpenSessionResp resp = client.OpenSession(req);\n\n        TGetTablesReq getTablesReq = new TGetTablesReq(resp.getSessionHandle());\n        client.GetTables(getTablesReq);\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-26T17:53:14.823+0000","updated":"2016-07-26T17:53:14.823+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15394327","id":"15394327","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mohitsabharwal","name":"mohitsabharwal","key":"mohitsabharwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohit Sabharwal","active":true,"timeZone":"America/New_York"},"body":"SessionHandle is getting passed in most (all?) calls to HS2: https://github.com/apache/hive/blob/master/service-rpc/if/TCLIService.thrift\n\nIn TThreadPoolServer (https://github.com/apache/thrift/blob/master/lib/java/src/org/apache/thrift/server/TThreadPoolServer.java#L300)\nthe call order seems to be:\n\ncreateContext -> processContext -> openSession (where we capture and set sessionHandle in the context as context.setSessionHandle(sessionHandle) -> deleteContext\n\nSimilarly, could we do for, say ExecuteStatement:\n\ncreateContext -> processContext -> ExecuteStatement (where we capture and set sessionHandle like above) -> deleteContext\n\nIOW, you can attach the session to any connection for every request individually. And keep a count of number of connections for every session which you decrement in deleteContext. When it reaches 0, you can delete the session.\n\nAm I missing something ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mohitsabharwal","name":"mohitsabharwal","key":"mohitsabharwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mohit Sabharwal","active":true,"timeZone":"America/New_York"},"created":"2016-07-26T18:51:37.962+0000","updated":"2016-07-26T18:51:37.962+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12989134/comment/15395759","id":"15395759","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"body":"I think this is more like keeping track of the active operations for the session, not the number of connections.  We only call cerateContext() when the new connection is created, not ExecuteStatement() or getCatalog(), etc. \n\nCounting active operations may also not work since even if the count is 0, the user may want to keep the session open and submit additional operations.    ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-27T14:25:54.660+0000","updated":"2016-07-27T14:25:54.660+0000"}],"maxResults":15,"total":15,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-14227/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i30x5r:"}}