{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12819327","self":"https://issues.apache.org/jira/rest/api/2/issue/12819327","key":"HIVE-10261","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-04-08T16:02:30.438+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Apr 09 02:52:08 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-10261/watchers","watchCount":4,"isWatching":false},"created":"2015-04-08T14:00:29.771+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-04-09T02:52:08.174+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"With {{hive.stats.fetch.column.stats=true}}, we'll estimate data size with column  stats when annotating operators with statistics. However, when column stats is partial, we're likely to underestimate data size, which may hurt performance, e.g. picking an inappropriate small table for map join.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Data size can be underestimated when computed with partial column stats","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12819327/comment/14485439","id":"14485439","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmokhtar","name":"mmokhtar","key":"mmokhtar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mmokhtar&avatarId=21863","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mmokhtar&avatarId=21863","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mmokhtar&avatarId=21863","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mmokhtar&avatarId=21863"},"displayName":"Mostafa Mokhtar","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lirui]\n\nCan you please attach an explain plan along with query and actual number of rows for the operator with underestimation?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmokhtar","name":"mmokhtar","key":"mmokhtar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mmokhtar&avatarId=21863","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mmokhtar&avatarId=21863","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mmokhtar&avatarId=21863","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mmokhtar&avatarId=21863"},"displayName":"Mostafa Mokhtar","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-08T16:02:30.438+0000","updated":"2015-04-08T16:02:30.438+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12819327/comment/14486612","id":"14486612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"body":"Hi [~mmokhtar],\n\nHere's a simple query to reproduce it:\n{code}\nexplain select ss_sales_price from store_sales,customer where ss_customer_sk=c_customer_sk and ss_sold_date_sk between 2452633 and 2452642;\n{code}\nThe plan is:\n{noformat}\nSTAGE DEPENDENCIES:\n  Stage-1 is a root stage\n  Stage-0 depends on stages: Stage-1\n\nSTAGE PLANS:\n  Stage: Stage-1\n    Tez\n      Edges:\n        Map 2 <- Map 1 (BROADCAST_EDGE)\n      DagName: root_20150409032323_e100ede8-da5c-4b08-8693-cafc73a487b3:1\n      Vertices:\n        Map 1 \n            Map Operator Tree:\n                TableScan\n                  alias: store_sales\n                  Statistics: Num rows: 9602042 Data size: 826919856 Basic stats: COMPLETE Column stats: PARTIAL\n                  Filter Operator\n                    predicate: ss_customer_sk is not null (type: boolean)\n                    Statistics: Num rows: 4801021 Data size: 19204084 Basic stats: COMPLETE Column stats: PARTIAL\n                    Reduce Output Operator\n                      key expressions: ss_customer_sk (type: int)\n                      sort order: +\n                      Map-reduce partition columns: ss_customer_sk (type: int)\n                      Statistics: Num rows: 4801021 Data size: 19204084 Basic stats: COMPLETE Column stats: PARTIAL\n                      value expressions: ss_sales_price (type: float), ss_sold_date_sk (type: int)\n            Execution mode: vectorized\n        Map 2 \n            Map Operator Tree:\n                TableScan\n                  alias: customer\n                  Statistics: Num rows: 300000 Data size: 258006136 Basic stats: COMPLETE Column stats: NONE\n                  Filter Operator\n                    predicate: c_customer_sk is not null (type: boolean)\n                    Statistics: Num rows: 150000 Data size: 129003068 Basic stats: COMPLETE Column stats: NONE\n                    Map Join Operator\n                      condition map:\n                           Inner Join 0 to 1\n                      keys:\n                        0 ss_customer_sk (type: int)\n                        1 c_customer_sk (type: int)\n                      outputColumnNames: _col2, _col12, _col22, _col26\n                      input vertices:\n                        0 Map 1\n                      Statistics: Num rows: 5281123 Data size: 21124492 Basic stats: COMPLETE Column stats: NONE\n                      Filter Operator\n                        predicate: ((_col2 = _col26) and _col22 BETWEEN 2452633 AND 2452642) (type: boolean)\n                        Statistics: Num rows: 1320280 Data size: 5281120 Basic stats: COMPLETE Column stats: NONE\n                        Select Operator\n                          expressions: _col12 (type: float)\n                          outputColumnNames: _col0\n                          Statistics: Num rows: 1320280 Data size: 5281120 Basic stats: COMPLETE Column stats: NONE\n                          File Output Operator\n                            compressed: false\n                            Statistics: Num rows: 1320280 Data size: 5281120 Basic stats: COMPLETE Column stats: NONE\n                            table:\n                                input format: org.apache.hadoop.mapred.TextInputFormat\n                                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat\n                                serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe\n            Execution mode: vectorized\n\n  Stage: Stage-0\n    Fetch Operator\n      limit: -1\n      Processor Tree:\n        ListSink\n{noformat}\nI'm using 320GB TPC-DS and the 10 partitions from store_sales are over 380M in file size, while customer is 18M in file size. However, in the filter operator for store_sales, the data size is estimated with column stats. I suppose it underestimates the data size, because while num rows is half of the parent operator, the data size is only about 1/43 of the parent.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lirui","name":"lirui","key":"lirui","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rui Li","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-04-09T02:52:08.174+0000","updated":"2015-04-09T02:52:08.174+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-10261/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2cz3r:"}}