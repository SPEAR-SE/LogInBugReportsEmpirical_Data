{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12653159","self":"https://issues.apache.org/jira/rest/api/2/issue/12653159","key":"HIVE-4742","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324312","id":"12324312","description":"released","name":"0.12.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-06-17T09:18:22.405+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Dec 03 19:11:49 UTC 2013","customfield_12310420":"333482","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_5462641614_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-08-19T14:26:04.688+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4742/watchers","watchCount":5,"isWatching":false},"created":"2013-06-17T09:02:03.128+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323587","id":"12323587","description":"Hive 0.11.0","name":"0.11.0","archived":false,"released":true,"releaseDate":"2013-05-15"}],"issuelinks":[{"id":"12379375","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379375","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12647266","key":"HIVE-4547","self":"https://issues.apache.org/jira/rest/api/2/issue/12647266","fields":{"summary":"A complex create view statement fails with new Antlr 3.4","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-12-03T19:11:49.562+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"I create programmatically a script to create a view which is a union of all kind of event I have. To keep things simple, data are just blindly cast as STRING. It used to work with Hive 0.10, not anymore with 0.11.\n\nI tried to narrow down the simplest script. It seems that it only occurs if a least a view and an union is involved.\n\nHere is a failing script:\n{noformat}\nCREATE TABLE Event1 (d STRING, userid BIGINT, eventData1 STRING);\nCREATE TABLE Event2 (d STRING, userid BIGINT, eventData2 STRING);\nCREATE VIEW AllEventsTest\n  AS SELECT * FROM (\n    SELECT 'Event1' AS eventType, map('d', CAST(`d` AS STRING)) AS eventData FROM Event1\n    UNION ALL\n    SELECT 'Event2' AS eventType, map('d', CAST(`d` AS STRING)) AS eventData FROM Event2\n) d;\n{noformat}\n\nThere are warnings in the logs:\n{noformat}\no.a.h.h.q.parse.TypeCheckProcFactory - Invalid type entry TOK_STRING=null\no.a.h.h.q.parse.TypeCheckProcFactory - Invalid type entry TOK_STRING=null\n{noformat}\n\nAnd the error is:\n{noformat}\nFAILED: IllegalArgumentException replace op boundaries of <ReplaceOp@[@46,103:105='`d`',<26>,3:52]..[@46,103:105='`d`',<26>,3:52]:\"`event1`.`d`\"> overlap with previous <ReplaceOp@[@44,98:101='CAST',<48>,3:47]..[@51,116:116=')',<276>,3:65]:\"`event1`.`d`\">\n10:52:51.024 [scoopMapredScheduler_Worker-9 ] [ERROR] org.apache.hadoop.hive.ql.Driver - FAILED: IllegalArgumentException replace op boundaries of <ReplaceOp@[@46,103:105='`d`',<26>,3:52]..[@46,103:105='`d`',<26>,3:52]:\"`event1`.`d`\"> overlap with previous <ReplaceOp@[@44,98:101='CAST',<48>,3:47]..[@51,116:116=')',<276>,3:65]:\"`event1`.`d`\">\njava.lang.IllegalArgumentException: replace op boundaries of <ReplaceOp@[@46,103:105='`d`',<26>,3:52]..[@46,103:105='`d`',<26>,3:52]:\"`event1`.`d`\"> overlap with previous <ReplaceOp@[@44,98:101='CAST',<48>,3:47]..[@51,116:116=')',<276>,3:65]:\"`event1`.`d`\">\n    at org.antlr.runtime.TokenRewriteStream.reduceToSingleOperationPerIndex(TokenRewriteStream.java:504)\n    at org.antlr.runtime.TokenRewriteStream.toString(TokenRewriteStream.java:374)\n    at org.antlr.runtime.TokenRewriteStream.toString(TokenRewriteStream.java:358)\n    at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.saveViewDefinition(SemanticAnalyzer.java:8781)\n    at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:8689)\n    at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:278)\n    at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:433)\n    at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:337)\n    at org.apache.hadoop.hive.ql.Driver.run(Driver.java:902)\n    at org.apache.hadoop.hive.service.HiveServer$HiveServerHandler.execute(HiveServer.java:198)\n    at org.apache.hadoop.hive.jdbc.HiveStatement.executeQuery(HiveStatement.java:192)\n{noformat}\n\nHere is a working script:\n{noformat}\nCREATE TABLE Event1 (d STRING, userid BIGINT, eventData1 STRING);\nCREATE TABLE Event2 (d STRING, userid BIGINT, eventData2 STRING);\nCREATE VIEW AllEventsTest\n  AS SELECT * FROM (\n    SELECT 'Event1' AS eventType, map('d', `d`, 'userid', CAST(`userid` AS STRING)) AS eventData FROM Event1\n    UNION ALL\n    SELECT 'Event2' AS eventType, map('d', `d`, 'userid', CAST(`userid` AS STRING)) AS eventData FROM Event2\n) d;\n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"333810","customfield_12312823":null,"summary":"A useless CAST makes Hive fail to create a VIEW based on an UNION","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hibou","name":"hibou","key":"hibou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hibou&avatarId=15047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hibou&avatarId=15047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hibou&avatarId=15047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hibou&avatarId=15047"},"displayName":"Nicolas Lalevée","active":true,"timeZone":"Europe/Paris"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hibou","name":"hibou","key":"hibou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hibou&avatarId=15047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hibou&avatarId=15047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hibou&avatarId=15047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hibou&avatarId=15047"},"displayName":"Nicolas Lalevée","active":true,"timeZone":"Europe/Paris"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653159/comment/13685117","id":"13685117","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caofangkun","name":"caofangkun","key":"caofangkun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=caofangkun&avatarId=23151","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=caofangkun&avatarId=23151","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=caofangkun&avatarId=23151","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=caofangkun&avatarId=23151"},"displayName":"caofangkun","active":true,"timeZone":"Asia/Shanghai"},"body":"Simplify the query and generate the following SemanticException :\nhive (default)> select CAST(`d` AS STRING) from dual limit 1;\nFAILED: SemanticException [Error 10004]: Line 1:12 Invalid table alias or column reference '`d`': (possible column names are: dummy)\n\nI don't think this's a BUG.We'd better follow the Grammar rules.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caofangkun","name":"caofangkun","key":"caofangkun","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=caofangkun&avatarId=23151","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=caofangkun&avatarId=23151","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=caofangkun&avatarId=23151","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=caofangkun&avatarId=23151"},"displayName":"caofangkun","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-06-17T09:18:22.405+0000","updated":"2013-06-17T09:18:22.405+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653159/comment/13730556","id":"13730556","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hibou","name":"hibou","key":"hibou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hibou&avatarId=15047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hibou&avatarId=15047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hibou&avatarId=15047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hibou&avatarId=15047"},"displayName":"Nicolas Lalevée","active":true,"timeZone":"Europe/Paris"},"body":"Sorry for the late reply, but what you tried has nothing to do with my issues. My columns do exist. See the 'working script'. For some reason, if there's a cast, then it fails.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hibou","name":"hibou","key":"hibou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hibou&avatarId=15047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hibou&avatarId=15047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hibou&avatarId=15047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hibou&avatarId=15047"},"displayName":"Nicolas Lalevée","active":true,"timeZone":"Europe/Paris"},"created":"2013-08-06T09:13:08.539+0000","updated":"2013-08-06T09:13:08.539+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653159/comment/13743844","id":"13743844","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"I cannot sure of what it was, but it seemed fixed in trunk. Anyone may reopen this issue when it happens again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-08-19T14:26:04.725+0000","updated":"2013-08-19T14:26:04.725+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653159/comment/13796001","id":"13796001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-10-15T23:30:17.702+0000","updated":"2013-10-15T23:30:17.702+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653159/comment/13838009","id":"13838009","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasadm","name":"prasadm","key":"prasadm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Mujumdar","active":true,"timeZone":"Etc/UTC"},"body":"I guess its the same issue that is addressed by HIVE-4547","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasadm","name":"prasadm","key":"prasadm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Mujumdar","active":true,"timeZone":"Etc/UTC"},"created":"2013-12-03T18:37:05.559+0000","updated":"2013-12-03T18:37:05.559+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12653159/comment/13838052","id":"13838052","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hibou","name":"hibou","key":"hibou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hibou&avatarId=15047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hibou&avatarId=15047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hibou&avatarId=15047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hibou&avatarId=15047"},"displayName":"Nicolas Lalevée","active":true,"timeZone":"Europe/Paris"},"body":"FYI, I upgraded to Hive 0.12, and it is indeed fixed, at least for my use case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hibou","name":"hibou","key":"hibou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hibou&avatarId=15047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hibou&avatarId=15047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hibou&avatarId=15047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hibou&avatarId=15047"},"displayName":"Nicolas Lalevée","active":true,"timeZone":"Europe/Paris"},"created":"2013-12-03T19:11:49.562+0000","updated":"2013-12-03T19:11:49.562+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4742/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1lj0f:"}}