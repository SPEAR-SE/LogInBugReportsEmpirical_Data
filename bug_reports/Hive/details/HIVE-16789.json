{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13075925","self":"https://issues.apache.org/jira/rest/api/2/issue/13075925","key":"HIVE-16789","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-05-31T13:18:06.494+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jun 02 14:51:09 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-16789/watchers","watchCount":2,"isWatching":false},"created":"2017-05-30T18:42:51.692+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329444","id":"12329444","description":"Maintenance release for branch 1.0 (1)","name":"1.0.1","archived":false,"released":true,"releaseDate":"2015-05-20"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12332384","id":"12332384","name":"1.2.1","archived":false,"released":true,"releaseDate":"2015-06-26"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-06-02T14:51:09.620+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"When outer where clause found no matching records, queries like these are failing\n\n{code}\nselect \na,b,c,d,e,\nmin(c) over (partition by a,b order by d rows between 1 preceding and current row) prev_c\nfrom\n(\nselect '1234' a ,'abc' b,10 c,2 d,'test1' e\nunion all \nselect '1234' a ,'abc' b,9 c,1 d,'test2' e\nunion all\nselect '1234' a ,'abc' b,11 c,3 d,'test2' e\nunion all  \nselect '1234' a ,'abcd' b,1 c,5 d,'test2' e\nunion all \nselect '1234' a ,'abcd' b,6 c,9 d,'test1' e\n)X\nwhere e='test3'\n;\n{code}\n\nError:\n\nError: java.lang.RuntimeException: Hive Runtime Error while closing operators: null\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.close(ExecReducer.java:295)\n\tat org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:453)\n\tat org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:392)\n\tat org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:164)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Unknown Source)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1698)\n\tat org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)\nCaused by: java.util.NoSuchElementException\n\tat java.util.ArrayDeque.getFirst(Unknown Source)\n\tat org.apache.hadoop.hive.ql.udf.generic.GenericUDAFMax$MaxStreamingFixedWindow.terminate(GenericUDAFMax.java:280)\n\tat org.apache.hadoop.hive.ql.udf.ptf.WindowingTableFunction.finishPartition(WindowingTableFunction.java:413)\n\tat org.apache.hadoop.hive.ql.exec.PTFOperator$PTFInvocation.finishPartition(PTFOperator.java:337)\n\tat org.apache.hadoop.hive.ql.exec.PTFOperator.closeOp(PTFOperator.java:95)\n\tat org.apache.hadoop.hive.ql.exec.Operator.close(Operator.java:598)\n\tat org.apache.hadoop.hive.ql.exec.Operator.close(Operator.java:610)\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.close(ExecReducer.java:287)\n\t... 7 more","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Query with window function fails when where clause returns no records","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nbathula","name":"nbathula","key":"nbathula","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Narayana","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nbathula","name":"nbathula","key":"nbathula","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Narayana","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"OS: CentOS release 6.6 (Final)\nHDP: 2.7.3\nHive: 1.0.1,1.2.1","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13075925/comment/16031135","id":"16031135","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cartershanklin","name":"cartershanklin","key":"cartershanklin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carter Shanklin","active":true,"timeZone":"America/Chicago"},"body":"Does the error occur when using Tez instead of MapReduce\n\n{code}\nset hive.execution.engine=tez;\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cartershanklin","name":"cartershanklin","key":"cartershanklin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carter Shanklin","active":true,"timeZone":"America/Chicago"},"created":"2017-05-31T13:18:06.494+0000","updated":"2017-05-31T13:18:26.888+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13075925/comment/16031626","id":"16031626","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nbathula","name":"nbathula","key":"nbathula","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Narayana","active":true,"timeZone":"Etc/UTC"},"body":"Yes, It fails even with Tez engine.\n{code}\n--------------------------------------------------------------------------------\n        VERTICES      STATUS  TOTAL  COMPLETED  RUNNING  PENDING  FAILED  KILLED\n--------------------------------------------------------------------------------\nMap 1 ..........   SUCCEEDED      1          1        0        0       0       0\nMap 4 ..........   SUCCEEDED      1          1        0        0       0       0\nMap 5 ..........   SUCCEEDED      1          1        0        0       0       0\nMap 6 ..........   SUCCEEDED      1          1        0        0       0       0\nMap 7 ..........   SUCCEEDED      1          1        0        0       0       0\nReducer 3             FAILED      1          0        0        1       4       0\n--------------------------------------------------------------------------------\nVERTICES: 05/06  [=====================>>-----] 83%   ELAPSED TIME: 20.68 s\n--------------------------------------------------------------------------------\nStatus: Failed\nVertex failed, vertexName=Reducer 3, vertexId=vertex_1495311508015_0744_1_05, diagnostics=[Task failed, taskId=task_1495311508015_0744_1_05_000000, diagnostics=[TaskAttempt 0 failed, info=[Error: Failure while running task:java.lang.RuntimeException: java.lang.RuntimeException: Hive Runtime Error while closing operators: null\n\tat org.apache.hadoop.hive.ql.exec.tez.TezProcessor.initializeAndRunProcessor(TezProcessor.java:186)\n\tat org.apache.hadoop.hive.ql.exec.tez.TezProcessor.run(TezProcessor.java:138)\n\tat org.apache.tez.runtime.LogicalIOProcessorRuntimeTask.run(LogicalIOProcessorRuntimeTask.java:362)\n\tat org.apache.tez.runtime.task.TezTaskRunner$TaskRunnerCallable$1.run(TezTaskRunner.java:179)\n\tat org.apache.tez.runtime.task.TezTaskRunner$TaskRunnerCallable$1.run(TezTaskRunner.java:171)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Unknown Source)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1698)\n\tat org.apache.tez.runtime.task.TezTaskRunner$TaskRunnerCallable.callInternal(TezTaskRunner.java:171)\n\tat org.apache.tez.runtime.task.TezTaskRunner$TaskRunnerCallable.callInternal(TezTaskRunner.java:167)\n\tat org.apache.tez.common.CallableWithNdc.call(CallableWithNdc.java:36)\n\tat java.util.concurrent.FutureTask.run(Unknown Source)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n\tat java.lang.Thread.run(Unknown Source)\nCaused by: java.lang.RuntimeException: Hive Runtime Error while closing operators: null\n\tat org.apache.hadoop.hive.ql.exec.tez.ReduceRecordProcessor.close(ReduceRecordProcessor.java:214)\n\tat org.apache.hadoop.hive.ql.exec.tez.TezProcessor.initializeAndRunProcessor(TezProcessor.java:177)\n\t... 14 more\nCaused by: java.util.NoSuchElementException\n\tat java.util.ArrayDeque.getFirst(Unknown Source)\n\tat org.apache.hadoop.hive.ql.udf.generic.GenericUDAFMax$MaxStreamingFixedWindow.terminate(GenericUDAFMax.java:280)\n\tat org.apache.hadoop.hive.ql.udf.ptf.WindowingTableFunction.finishPartition(WindowingTableFunction.java:413)\n\tat org.apache.hadoop.hive.ql.exec.PTFOperator$PTFInvocation.finishPartition(PTFOperator.java:337)\n\tat org.apache.hadoop.hive.ql.exec.PTFOperator.closeOp(PTFOperator.java:95)\n\tat org.apache.hadoop.hive.ql.exec.Operator.close(Operator.java:598)\n\tat org.apache.hadoop.hive.ql.exec.Operator.close(Operator.java:610)\n\tat org.apache.hadoop.hive.ql.exec.tez.ReduceRecordProcessor.close(ReduceRecordProcessor.java:196)\n\t... 15 more\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nbathula","name":"nbathula","key":"nbathula","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Narayana","active":true,"timeZone":"Etc/UTC"},"created":"2017-05-31T18:21:44.205+0000","updated":"2017-05-31T18:21:44.205+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13075925/comment/16033094","id":"16033094","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cartershanklin","name":"cartershanklin","key":"cartershanklin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carter Shanklin","active":true,"timeZone":"America/Chicago"},"body":"This doesn't reproduce on HDP 2.5.3 (version = hive_2_5_3_0_37-1.2.1000.2.5.3.0-37) or on later versions. I didn't try going any further back.\n\n{code}\nhive> select\n    > a,b,c,d,e,\n    > min(c) over (partition by a,b order by d rows between 1 preceding and current row) prev_c\n    > from\n    > (\n    > select '1234' a ,'abc' b,10 c,2 d,'test1' e\n    > union all\n    > select '1234' a ,'abc' b,9 c,1 d,'test2' e\n    > union all\n    > select '1234' a ,'abc' b,11 c,3 d,'test2' e\n    > union all\n    > select '1234' a ,'abcd' b,1 c,5 d,'test2' e\n    > union all\n    > select '1234' a ,'abcd' b,6 c,9 d,'test1' e\n    > )X\n    > where e='test3'\n    > ;\nQuery ID = vagrant_20170601144546_60ec95f0-a4a1-4ee5-a265-3219a9cae780\nTotal jobs = 1\nLaunching Job 1 out of 1\n\n\nStatus: Running (Executing on YARN cluster with App id application_1496327868636_0004)\n\n--------------------------------------------------------------------------------\n        VERTICES      STATUS  TOTAL  COMPLETED  RUNNING  PENDING  FAILED  KILLED\n--------------------------------------------------------------------------------\nMap 1 ..........   SUCCEEDED      1          1        0        0       0       0\nMap 4 ..........   SUCCEEDED      1          1        0        0       0       0\nMap 5 ..........   SUCCEEDED      1          1        0        0       0       0\nMap 6 ..........   SUCCEEDED      1          1        0        0       0       0\nMap 7 ..........   SUCCEEDED      1          1        0        0       0       0\nReducer 3 ......   SUCCEEDED      1          1        0        0       0       0\n--------------------------------------------------------------------------------\nVERTICES: 06/06  [==========================>>] 100%  ELAPSED TIME: 0.83 s\n--------------------------------------------------------------------------------\nOK\nTime taken: 1.958 seconds\nhive>\n{code}\n\nIs it possible for you to upgrade?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cartershanklin","name":"cartershanklin","key":"cartershanklin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carter Shanklin","active":true,"timeZone":"America/Chicago"},"created":"2017-06-01T14:46:31.918+0000","updated":"2017-06-01T14:46:31.918+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13075925/comment/16034193","id":"16034193","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nbathula","name":"nbathula","key":"nbathula","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Narayana","active":true,"timeZone":"Etc/UTC"},"body":"I have tested this on hive(1.0.1 and 1.2.1) and it fails on both. It appears that you are using hortonworks platform which (according to their website) comes with hadoop 2.7.3(same as ours) but hive version says 1.2.1+ . Not exactly sure what additional fixes/optimization went into this and how it differs from apache build(that we use)\nAre you suggesting me to test it on latest apache GA release(v1.2.2) ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nbathula","name":"nbathula","key":"nbathula","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Narayana","active":true,"timeZone":"Etc/UTC"},"created":"2017-06-02T06:02:29.111+0000","updated":"2017-06-02T06:12:58.430+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13075925/comment/16034806","id":"16034806","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cartershanklin","name":"cartershanklin","key":"cartershanklin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carter Shanklin","active":true,"timeZone":"America/Chicago"},"body":"There's also a 2.1.1 release which may solve the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cartershanklin","name":"cartershanklin","key":"cartershanklin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carter Shanklin","active":true,"timeZone":"America/Chicago"},"created":"2017-06-02T14:51:09.620+0000","updated":"2017-06-02T14:51:09.620+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-16789/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3fnf3:"}}