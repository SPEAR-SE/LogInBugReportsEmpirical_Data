{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12852448","self":"https://issues.apache.org/jira/rest/api/2/issue/12852448","key":"HIVE-11481","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2015-11-02T20:40:44.625+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Dec 30 21:37:42 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_7665588039_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_26706449852","customfield_12312321":null,"resolutiondate":"2016-09-06T20:53:15.626+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-11481/watchers","watchCount":5,"isWatching":false},"created":"2015-08-06T01:05:58.515+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326450","id":"12326450","description":"released","name":"0.14.0","archived":false,"released":true,"releaseDate":"2014-11-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12329278","id":"12329278","description":"Branch 1.0 release","name":"1.0.0","archived":false,"released":true,"releaseDate":"2015-02-04"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12329345","id":"12329345","description":"Hive 1.2.0","name":"1.2.0","archived":false,"released":true,"releaseDate":"2015-05-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12329363","id":"12329363","name":"1.1.0","archived":false,"released":true,"releaseDate":"2015-03-07"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12332384","id":"12332384","name":"1.2.1","archived":false,"released":true,"releaseDate":"2015-06-26"}],"issuelinks":[{"id":"12479599","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12479599","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12977453","key":"HIVE-13989","self":"https://issues.apache.org/jira/rest/api/2/issue/12977453","fields":{"summary":"Extended ACLs are not handled according to specification","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12433822","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12433822","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12707839","key":"HIVE-6892","self":"https://issues.apache.org/jira/rest/api/2/issue/12707839","fields":{"summary":"Permission inheritance issues","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-09-06T20:53:15.954+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312584","id":"12312584","name":"Metastore","description":"Tracks issue dealing with metastore."}],"timeoriginalestimate":null,"description":"$ hadoop fs -chmod 700 /user/hive/warehouse\n$ hadoop fs -setfacl -m user:user1:rwx /user/hive/warehouse\n$ hadoop fs -setfacl -m default:user::rwx /user/hive/warehouse\n\n$ hadoop fs -ls /user/hive\nFound 1 items\ndrwxrwx---+  - hive hadoop          0 2015-08-05 10:29 /user/hive/warehouse\n$ hadoop fs -getfacl /user/hive/warehouse\n# file: /user/hive/warehouse\n# owner: hive\n# group: hadoop\nuser::rwx\nuser:user1:rwx\ngroup::---\nmask::rwx\nother::---\ndefault:user::rwx\ndefault:group::---\ndefault:other::---\n\nIn hive cli> create database testing;\n\n$ hadoop fs -ls /user/hive/warehouse\nFound 1 items\ndrwxrwx---+  - hive hadoop          0 2015-08-05 10:44 /user/hive/warehouse/testing.db\n$hadoop fs -getfacl /user/hive/warehouse/testing.db\n# file: /user/hive/warehouse/testing.db\n# owner: hive\n# group: hadoop\nuser::rwx\nuser:user1:rwx\ngroup::rwx\nmask::rwx\nother::---\ndefault:user::rwx\ndefault:group::---\ndefault:other::---\n\nSince the warehouse directory has default group permission set to ---, the group permissions for testing.db should also be ---\n\n\nThe warehouse directory permissions show drwxrwx---+ which corresponds to user:mask:other. The subdirectory group ACL is set by calling FsPermission.getGroupAction() from Hadoop, which retrieves the file status permission rwx instead of the actual ACL permission, which is ---. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12755493","id":"12755493","filename":"HIVE-11481.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-11T21:09:02.741+0000","size":3462,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12755493/HIVE-11481.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12770132","id":"12770132","filename":"HIVE-11481.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-02T18:23:15.297+0000","size":10248,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12770132/HIVE-11481.2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12780018","id":"12780018","filename":"HIVE-11481.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-12-30T17:56:55.407+0000","size":14210,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12780018/HIVE-11481.3.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"hive incorrectly set extended ACLs for unnamed group for new databases/tables with inheritPerms enabled","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12852448/comment/14741541","id":"14741541","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"body":"Problem:\nWhen creating a child directory, the ACLs of the new directory were set based on the file permissions of the parent directory instead of following the ACL-inheritance rules. As a result, the ACLs for the group as well as the default ACLs are not set correctly. \n\nProposed fix:\n1. If the parent directory has default ACL entries set, then the child directory will inherit from parent's ACL entries, including all named/unnamed user, group and default entries.\n2. If the parent directory does not have default ACL entries, but does have some ACL entries set such as a named user, by default the group ACL entry for the sub-directory is already set correctly in the current implementation. But we need to add the ACL entries for USER and OTHER. \n3. If the parent directory does not have any ACL entries, set the child directory permissions using the parent's file permissions.\n\nFor reference, here is some background info on the mask: \n1. From hadoop documentation: \"The mask is a special ACL entry that filters the permissions granted to all named user entries and named group entries, and also the unnamed group entry. If the user doesn't supply a mask while setting an ACL, then a mask is inserted automatically by calculating the union of permissions on all entries that would be filtered by the mask.\"\n2. From Linux acl manual, section CORRESPONDENCE BETWEEN ACL ENTRIES AND FILE PERMISSION BITS: \"If the ACL has an ACL_MASK entry, the group permissions correspond to the permissions of the ACL_MASK entry.  Otherwise, if the ACL has no ACL_MASK entry, the group permissions correspond to the permissions of the ACL_GROUP_OBJ entry.\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-11T21:12:15.865+0000","updated":"2015-09-11T21:12:15.865+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12852448/comment/14741547","id":"14741547","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"body":"I am working on adding some test cases to cover the ACL inheritance. If anyone has review comments to the proposed solution, please comment on the JIRA.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-11T21:16:20.064+0000","updated":"2015-09-11T21:16:20.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12852448/comment/14985688","id":"14985688","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"body":"Update patch to include testcase","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-02T18:23:15.301+0000","updated":"2015-11-02T18:23:15.301+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12852448/comment/14985769","id":"14985769","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"body":"Request for code review","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-02T19:02:05.748+0000","updated":"2015-11-02T19:02:05.748+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12852448/comment/14985989","id":"14985989","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12770132/HIVE-11481.2.patch\n\n{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 4 failed/errored test(s), 9770 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestHBaseCliDriver.testCliDriver_hbase_queries\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import\norg.apache.hadoop.hive.hwi.TestHWISessionManager.testHiveDriver\norg.apache.hive.jdbc.TestSSL.testSSLVersion\n{noformat}\n\nTest results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5890/testReport\nConsole output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5890/console\nTest logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5890/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 4 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12770132 - PreCommit-HIVE-TRUNK-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2015-11-02T20:40:44.625+0000","updated":"2015-11-02T20:40:44.625+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12852448/comment/14999302","id":"14999302","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szehon","name":"szehon","key":"szehon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Szehon Ho","active":true,"timeZone":"Europe/Paris"},"body":"Thanks for the patch Carita.  I am having some trouble how the patch solves the issue, it seems it is setting only the default ACL's on the target if there are any, and falls back to the old way if there are not?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szehon","name":"szehon","key":"szehon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Szehon Ho","active":true,"timeZone":"Europe/Paris"},"created":"2015-11-10T20:34:07.200+0000","updated":"2015-11-10T20:34:07.200+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12852448/comment/14999671","id":"14999671","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Szehon,\n\nThanks for reviewing the patch. Yes this patch sets the default ACLs if they exist, and if not, it sets the traditional user/group/other permissions. The difference between this patch and the old way is how we're setting the group permissions. \n\nWhen an ACL is set on a directory, the value returned from sourcePerm.getGroupAction() is not the actual group permissions, it is the mask. When we set a named user or named/unamed group ACL, the mask is automatically defined as the union of those permissions. For example, drwxrwx---+ is actually showing the user:mask:other. \n\nWhen there are ACLs set on a directory, the child directory is already created with the correct group ACL permissions in the current implementation. The issue is that the group file permissions are not set correctly because they were overwritten with the parent's mask (retrieved from sourcePerm.getGroupAction()). This patch fixes the issue by not overwriting the group with the parent's mask file permissions if there are ACLs for the directory, keeping the group value that was set earlier with the chgrp command in the method. We only need to set the group ACL entry if there are no ACL entries set.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-11T00:27:54.026+0000","updated":"2015-11-11T00:27:54.026+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12852448/comment/14999685","id":"14999685","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szehon","name":"szehon","key":"szehon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Szehon Ho","active":true,"timeZone":"Europe/Paris"},"body":"Thanks for explanation, I will have to play with this patch, I apologize for the delay ..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szehon","name":"szehon","key":"szehon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Szehon Ho","active":true,"timeZone":"Europe/Paris"},"created":"2015-11-11T00:37:44.505+0000","updated":"2015-11-11T00:37:44.505+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12852448/comment/15014672","id":"15014672","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szehon","name":"szehon","key":"szehon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Szehon Ho","active":true,"timeZone":"Europe/Paris"},"body":"Hi Carita, I spent some time reading up on default ACL's and taking a deeper look and have some review questions.\n\n1.  Shouldn't we also set default ACL's on the child, if they are a directory?  This code maybe called in situation where input is a nested directory (like multi-column partition tables).  \"When a directory is created inside a directory that has a default ACL, the new directory inherits the parent directory's default ACL both as its access ACL and default ACL.\"\n\n\n2.  Do we still need to remove the base ACL's regardless of whether there are no defaults?  If I recall correctly it was to prevent some duplicates (as you are again setting USER and OTHER). \n\n3.  Can you write a test case that uses DEFAULT Acl's?  The test you added seems to use AclEntryScope.ACCESS but not DEFAULT.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szehon","name":"szehon","key":"szehon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Szehon Ho","active":true,"timeZone":"Europe/Paris"},"created":"2015-11-19T23:01:43.424+0000","updated":"2015-11-19T23:01:43.424+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12852448/comment/15075266","id":"15075266","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Szehon, I updated the review board with the new patch.\n\n1. This is true. The child directory inherits the parent's default ACLs as its own default ACLs, and also as it access ACLs. I made some code changes for the child directory to inherit the parent's default ACL as its access ACL, overwriting the named user|group access ACL if exists. For example, the parent directory has following ACLs:\n{noformat}default:user:foo:r--\nuser:foo:rwx{noformat}\nafter inheritance, the child will have the following ACLs:\n{noformat}default:user:foo:r--\nuser:foo:r--{noformat}\nCan you please verify that this should be the case?\n\n2. We are removing the baseAclEntries if there are Default ACLs. This is to prevent the setfacl command from failing if there are duplicate ACL entries with the same scope, type, and name. For example, this following command {noformat}\"hadoop fs -setfacl -R --set 'user::rwx,user::r--' /path\"{noformat} will fail with \"setfacl: Invalid ACL: multiple entries with same scope, type and name.\"\nIf there are no default ACLs, we don't need to remove baseAclEntries. At this point, only the group access ACL is present in the ACL list, and the \"setfacl -R\" command requires the user, group and other entries. That is why I'm setting USER and OTHER again. For example, this following command {noformat}\"hadoop fs -setfacl -R --set 'user::r--' /path\"{noformat} will fail with \"setfacl: Invalid ACL: the user, group and other entries are required.\"\n\n3. I updated the testcase to include Default ACLs. Thank you for asking to include this. After including default ACLs, I found that more code changes were needed to address your question #1. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=caritaou","name":"caritaou","key":"caritaou","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carita Ou","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-12-30T18:05:00.307+0000","updated":"2015-12-30T18:05:00.307+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12852448/comment/15075424","id":"15075424","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12780018/HIVE-11481.3.patch\n\n{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 19 failed/errored test(s), 9978 tests executed\n*Failed tests:*\n{noformat}\nTestCliDriver-skewjoin_union_remove_2.q-cluster.q-udf_asin.q-and-12-more - did not produce a TEST-*.xml file\nTestHWISessionManager - did not produce a TEST-*.xml file\nTestSparkCliDriver-timestamp_lazy.q-bucketsortoptimize_insert_4.q-date_udf.q-and-12-more - did not produce a TEST-*.xml file\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_order2\norg.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_insert_partition_dynamic\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_columnstats_partlvl_multiple_part_clause\norg.apache.hadoop.hive.ql.exec.spark.session.TestSparkSessionManagerImpl.testMultiSessionMultipleUse\norg.apache.hadoop.hive.ql.exec.spark.session.TestSparkSessionManagerImpl.testSingleSessionMultipleUse\norg.apache.hadoop.hive.ql.security.authorization.plugin.TestHiveOperationType.checkHiveOperationTypeMatch\norg.apache.hive.jdbc.TestSSL.testSSLVersion\norg.apache.hive.spark.client.TestSparkClient.testAddJarsAndFiles\norg.apache.hive.spark.client.TestSparkClient.testCounters\norg.apache.hive.spark.client.TestSparkClient.testErrorJob\norg.apache.hive.spark.client.TestSparkClient.testJobSubmission\norg.apache.hive.spark.client.TestSparkClient.testMetricsCollection\norg.apache.hive.spark.client.TestSparkClient.testRemoteClient\norg.apache.hive.spark.client.TestSparkClient.testSimpleSparkJob\norg.apache.hive.spark.client.TestSparkClient.testSyncRpc\n{noformat}\n\nTest results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6503/testReport\nConsole output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6503/console\nTest logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6503/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 19 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12780018 - PreCommit-HIVE-TRUNK-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2015-12-30T21:37:42.286+0000","updated":"2015-12-30T21:37:42.286+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-11481/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2ied3:"}}