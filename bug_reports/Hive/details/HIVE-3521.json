{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12609834","self":"https://issues.apache.org/jira/rest/api/2/issue/12609834","key":"HIVE-3521","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-02-09T16:29:05.545+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jun 20 04:23:42 UTC 2013","customfield_12310420":"249445","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-3521/watchers","watchCount":9,"isWatching":false},"created":"2012-10-01T23:10:00.056+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317742","id":"12317742","description":"released","name":"0.9.0","archived":false,"released":true,"releaseDate":"2012-04-30"}],"issuelinks":[{"id":"12370873","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12370873","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12653802","key":"HIVE-4762","self":"https://issues.apache.org/jira/rest/api/2/issue/12653802","fields":{"summary":"HMS cannot handle concurrent requests","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-06-20T04:24:03.325+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312584","id":"12312584","name":"Metastore","description":"Tracks issue dealing with metastore."}],"timeoriginalestimate":null,"description":null,"customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"58624","customfield_12312823":null,"summary":"Concurrent metastore calls provoke Datanucleus IllegalStateException: \"Table object has not been been initialised\"","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609834/comment/13467293","id":"13467293","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"body":"I encountered this error while running a test fires metastore calls from approximately ten threads at the same time.\n\nHere is the exception stack trace:\n\n{noformat}\n12/10/01 14:46:53 ERROR hive.log: java.lang.IllegalStateException: Table object has not been been initialised : `TBLS`\n\tat org.datanucleus.store.rdbms.table.AbstractTable.assertIsInitialized(AbstractTable.java:625)\n\tat org.datanucleus.store.rdbms.table.ClassTable.getMemberMapping(ClassTable.java:2996)\n\tat org.datanucleus.store.mapped.expression.LogicSetExpression.newFieldExpression(LogicSetExpression.java:195)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQueryCompiler.compileIdentifier(JDOQLQueryCompiler.java:953)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQueryCompiler.compilePrimary(JDOQLQueryCompiler.java:774)\n\tat org.datanucleus.store.rdbms.query.legacy.QueryCompiler.compileUnaryExpressionNotPlusMinus(QueryCompiler.java:1333)\n\tat org.datanucleus.store.rdbms.query.legacy.QueryCompiler.compileUnaryExpression(QueryCompiler.java:1314)\n\tat org.datanucleus.store.rdbms.query.legacy.QueryCompiler.compileMultiplicativeExpression(QueryCompiler.java:1267)\n\tat org.datanucleus.store.rdbms.query.legacy.QueryCompiler.compileAdditiveExpression(QueryCompiler.java:1244)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQueryCompiler.compileRelationalExpression(JDOQLQueryCompiler.java:687)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQueryCompiler.compileEqualityExpression(JDOQLQueryCompiler.java:659)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQueryCompiler.compileAndExpression(JDOQLQueryCompiler.java:647)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQueryCompiler.compileExclusiveOrExpression(JDOQLQueryCompiler.java:635)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQueryCompiler.compileInclusiveOrExpression(JDOQLQueryCompiler.java:623)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQueryCompiler.compileConditionalAndExpression(JDOQLQueryCompiler.java:611)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQueryCompiler.compileConditionalOrExpression(JDOQLQueryCompiler.java:593)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQueryCompiler.compileExpression(JDOQLQueryCompiler.java:570)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQueryCompiler.compileExpressionFromString(JDOQLQueryCompiler.java:550)\n\tat org.datanucleus.store.rdbms.query.legacy.QueryCompiler.compileExpressionsFromString(QueryCompiler.java:1221)\n\tat org.datanucleus.store.rdbms.query.legacy.QueryCompiler.compileResult(QueryCompiler.java:876)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQueryCompiler.performCompile(JDOQLQueryCompiler.java:246)\n\tat org.datanucleus.store.rdbms.query.legacy.QueryCompiler.executionCompile(QueryCompiler.java:374)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQueryCompiler.compile(JDOQLQueryCompiler.java:225)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQuery.compileInternal(JDOQLQuery.java:175)\n\tat org.datanucleus.store.query.Query.executeQuery(Query.java:1628)\n\tat org.datanucleus.store.rdbms.query.legacy.JDOQLQuery.executeQuery(JDOQLQuery.java:245)\n\tat org.datanucleus.store.query.Query.executeWithArray(Query.java:1499)\n\tat org.datanucleus.jdo.JDOQuery.execute(JDOQuery.java:243)\n\tat org.apache.hadoop.hive.metastore.ObjectStore.getTables(ObjectStore.java:759)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.hadoop.hive.metastore.RetryingRawStore.invoke(RetryingRawStore.java:111)\n\tat $Proxy0.getTables(Unknown Source)\n\tat org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.get_tables(HiveMetaStore.java:1928)\n\tat org.apache.hadoop.hive.metastore.HiveMetaStoreClient.getTables(HiveMetaStoreClient.java:786)\n\tat org.apache.hadoop.hive.ql.metadata.Hive.getTablesByPattern(Hive.java:976)\n\tat org.apache.hadoop.hive.ql.metadata.Hive.getAllTables(Hive.java:950)\n\tat org.apache.hadoop.hive.ql.exec.DDLTask.showTables(DDLTask.java:2007)\n\tat org.apache.hadoop.hive.ql.exec.DDLTask.execute(DDLTask.java:324)\n\tat org.apache.hadoop.hive.ql.exec.Task.executeTask(Task.java:153)\n\tat org.apache.hadoop.hive.ql.exec.TaskRunner.runSequential(TaskRunner.java:57)\n\tat org.apache.hadoop.hive.ql.Driver.launchTask(Driver.java:1331)\n\tat org.apache.hadoop.hive.ql.Driver.execute(Driver.java:1117)\n\tat org.apache.hadoop.hive.ql.Driver.run(Driver.java:950)\n\tat org.apache.thrift.ProcessFunction.process(ProcessFunction.java:32)\n\tat org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:34)\n\tat org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:176)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:662)\n{noformat}\n\nI have seen this same exception mentioned several times before on the Hive mailing list, and it also looks like folks are encountering this while running the JPA performance benchmark:\n\nhttp://www.jpab.org/DataNucleus/MySQL/server.html\n\nAt this point I can't tell if this is a bug with DataNucleus, or if Hive is using DN incorrectly.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-01T23:17:26.256+0000","updated":"2012-10-01T23:17:26.256+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609834/comment/13575197","id":"13575197","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andy","name":"andy","key":"andy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andy Jefferson","active":true,"timeZone":"Etc/UTC"},"body":"I've never seen it, and that private company running that proprietary benchmark (for their proprietary product) didn't bother configuring DataNucleus (surprising?). \nUse of the DN persistence property \"datanucleus.PersistenceUnitLoadClasses\" at startup together with a persistence-unit, or alternatively use of an auto-start mechanism, as well as locking of your PMF/EMF until it was initialised would clearly mean that the internal schema was initialised. You seem to be executing a query and it is still discovering classes that map to your schema; not a good way of running","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andy","name":"andy","key":"andy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andy Jefferson","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-09T16:29:05.545+0000","updated":"2013-02-09T16:29:05.545+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609834/comment/13666256","id":"13666256","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=malyvelky","name":"malyvelky","key":"malyvelky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jakub Holy","active":true,"timeZone":"Europe/Berlin"},"body":"Thank you for the tips, Andy. I have seen similar problem in our Hive 0.9.0 logs regularly in the past few months and had no idea what to do about it. I did not bother configuring DataNucelus because there is nowhere any information about 1) Hive requiring that and 2) how it should be configured (nowhere = Google, Programming Hive).\n\nAnyway, from your comment and the sparse documentation I have figured out that setting datanucleus.autoStartMechanism to SchemaTable in hive-site.xml might help. After I restarted Hive, it has created NUCLEUS_TABLES in the database so it seems to have some effect. I will see in a few weeks/months if it will indeed fix the problem, i.e. if DataNucleus will load the list of tables from it on start, avoiding not knowing them later.\n\nFor other readers trying to interpret your comment:\n\n* PMF/EMF are JDO's PersistenceManagerFactory / JPA's EntityManagerFactory, i.e. the classes used to get hold of something actually usable for persisting / reading stuff\n* Regarding the advice of setting datanucleus.PersistenceUnitLoadClassesto true in hive-site.xml, I don't know enough to be able to apply it. If I read the docs correctly, it requires datanucleus.PersistenceUnitName to be set to a name of a persistence-unit defined in a persistence.xml file - but I haven't found any such file in Hive 0.9.0 (the only JDO-related thing I have found aside of the metastore connection properties is package.jdo in hive-metastore-0.9.0.jar. I would appreciate tips for how to use this setting with Hive.\n* To me, \"locking of your PMF/EMF\" seems to be out of question since all that code is inside Hive and I only use Hive via hiveserver","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=malyvelky","name":"malyvelky","key":"malyvelky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jakub Holy","active":true,"timeZone":"Europe/Berlin"},"created":"2013-05-24T12:27:33.298+0000","updated":"2013-05-24T12:27:33.298+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12609834/comment/13688853","id":"13688853","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"Nice work Jakub!  I am not able to reproduce once placing:\n\n{noformat}\n  <property>\n    <name>datanucleus.autoStartMechanism</name>\n    <value>SchemaTable</value>\n  </property>\n{noformat}\n\nin my hive-site.xml","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-20T04:23:42.057+0000","updated":"2013-06-20T04:23:42.057+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-3521/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0aeif:"}}