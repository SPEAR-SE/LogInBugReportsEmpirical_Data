{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12731323","self":"https://issues.apache.org/jira/rest/api/2/issue/12731323","key":"HIVE-7594","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-04-14T15:06:20.778+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Sep 29 15:05:08 UTC 2015","customfield_12310420":"409395","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-7594/watchers","watchCount":15,"isWatching":false},"created":"2014-08-01T14:11:27.471+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324986","id":"12324986","description":"released","name":"0.13.0","archived":false,"released":true,"releaseDate":"2014-04-21"}],"issuelinks":[{"id":"12502317","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12502317","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12707850","key":"HIVE-6893","self":"https://issues.apache.org/jira/rest/api/2/issue/12707850","fields":{"summary":"out of sequence error in HiveMetastore server","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-05-02T01:02:33.878+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312587","id":"12312587","name":"Clients","description":"Tracks issues dealing with CLI, Webclient, JDBC clients or other such clients."},{"self":"https://issues.apache.org/jira/rest/api/2/component/12320408","id":"12320408","name":"HiveServer2","description":"Tracks issues related to HiveServer2"}],"timeoriginalestimate":null,"description":"When executing a long running query in a JDBC client (Squirrel) to HiveServer2 after several minutes I get this error in the client:\n{code}\nError: org.apache.thrift.TApplicationException: ExecuteStatement failed: out of sequence response\nSQLState:  08S01\nErrorCode: 0\n{code}\nI've seen this before in, iirc when running 2 queries in 1 session but I've closed the client and run only this single query in a new session each time. I did a search and saw HIVE-6893 referring to a Metastore exception which I have in some older logs but not corresponding / recent in these recent instances, the error seems different in this case but may be related.\n\nThe query to reproduce is \"select count(*) from myTable\" where myTable is a 1TB table of 620 million rows. This happens in both MR and Tez execution engines running on Yarn.\n\nHere are all the jars I've added to the classpath (taken from Hortonworks doc http://docs.hortonworks.com/HDPDocuments/HDP2/HDP-2.1-latest/bk_dataintegration/content/ch_using-hive-2.html, plus added hadoop-common, hive-exec and slf4j-api to solve class not found issues on top of that):\n\ncommons-codec-1.4.jar\ncommons-logging-1.1.3.jar\nhadoop-common-2.4.0.2.1.3.0-563.jar\nhive-exec-0.13.0.2.1.3.0-563.jar\nhive-jdbc-0.13.0.2.1.3.0-563.jar\nhive-service-0.13.0.2.1.3.0-563.jar\nhttpclient-4.2.5.jar\nhttpcore-4.2.5.jar\nlibthrift-0.9.0.jar\nslf4j-api-1.7.5.jar\n\nI am seeing errors like this in the hiveserver2.log:\n{code}\n2014-08-01 15:04:31,358 ERROR [pool-5-thread-3]: server.TThreadPoolServer (TThreadPoolServer.java:run(215)) - Error occurred during processing of message.\njava.lang.RuntimeException: org.apache.thrift.transport.TTransportException\n        at org.apache.thrift.transport.TSaslServerTransport$Factory.getTransport(TSaslServerTransport.java:219)\n        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:189)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.apache.thrift.transport.TTransportException\n        at org.apache.thrift.transport.TIOStreamTransport.read(TIOStreamTransport.java:132)\n        at org.apache.thrift.transport.TTransport.readAll(TTransport.java:84)\n        at org.apache.thrift.transport.TSaslTransport.receiveSaslMessage(TSaslTransport.java:182)\n        at org.apache.thrift.transport.TSaslServerTransport.handleSaslStartMessage(TSaslServerTransport.java:125)\n        at org.apache.thrift.transport.TSaslTransport.open(TSaslTransport.java:253)\n        at org.apache.thrift.transport.TSaslServerTransport.open(TSaslServerTransport.java:41)\n        at org.apache.thrift.transport.TSaslServerTransport$Factory.getTransport(TSaslServerTransport.java:216)\n        ... 4 more\n\n...\n2014-08-01 15:06:31,520 ERROR [pool-5-thread-3]: server.TThreadPoolServer (TThreadPoolServer.java:run(215)) - Error occurred during processing of message.\njava.lang.RuntimeException: org.apache.thrift.transport.TTransportException\n        at org.apache.thrift.transport.TSaslServerTransport$Factory.getTransport(TSaslServerTransport.java:219)\n        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:189)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.apache.thrift.transport.TTransportException\n        at org.apache.thrift.transport.TIOStreamTransport.read(TIOStreamTransport.java:132)\n        at org.apache.thrift.transport.TTransport.readAll(TTransport.java:84)\n        at org.apache.thrift.transport.TSaslTransport.receiveSaslMessage(TSaslTransport.java:182)\n        at org.apache.thrift.transport.TSaslServerTransport.handleSaslStartMessage(TSaslServerTransport.java:125)\n        at org.apache.thrift.transport.TSaslTransport.open(TSaslTransport.java:253)\n        at org.apache.thrift.transport.TSaslServerTransport.open(TSaslServerTransport.java:41)\n        at org.apache.thrift.transport.TSaslServerTransport$Factory.getTransport(TSaslServerTransport.java:216)\n        ... 4 more\n\n...\n\n2014-08-01 15:05:41,096 ERROR [pool-4-thread-22]: operation.Operation (SQLOperation.java:run(202)) - Error running hive query:\norg.apache.hive.service.cli.HiveSQLException: Illegal Operation state transition\n        at org.apache.hive.service.cli.OperationState.validateTransition(OperationState.java:94)\n        at org.apache.hive.service.cli.OperationState.validateTransition(OperationState.java:99)\n        at org.apache.hive.service.cli.operation.Operation.setState(Operation.java:109)\n        at org.apache.hive.service.cli.operation.SQLOperation.runInternal(SQLOperation.java:158)\n        at org.apache.hive.service.cli.operation.SQLOperation.access$000(SQLOperation.java:68)\n        at org.apache.hive.service.cli.operation.SQLOperation$1$1.run(SQLOperation.java:199)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:415)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1594)\n        at org.apache.hadoop.hive.shims.HadoopShimsSecure.doAs(HadoopShimsSecure.java:500)\n        at org.apache.hive.service.cli.operation.SQLOperation$1.run(SQLOperation.java:208)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:262)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\n{code}\n\nRegards,\n\nHari Sekhon\nhttp://www.linkedin.com/in/harisekhon","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"409391","customfield_12312823":null,"summary":"Hive JDBC client: \"out of sequence response\" on large long running query","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=harisekhon","name":"harisekhon","key":"harisekhon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hari Sekhon","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"HDP2.1","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12731323/comment/14494217","id":"14494217","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=suniluiit","name":"suniluiit","key":"suniluiit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunil Kumar","active":true,"timeZone":"Asia/Kolkata"},"body":"Same issue is coming on Hive 1.0.0. can Any body update Please any workaround for this issue??","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=suniluiit","name":"suniluiit","key":"suniluiit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunil Kumar","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-04-14T15:06:20.778+0000","updated":"2015-04-14T15:06:20.778+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12731323/comment/14497954","id":"14497954","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreymehrotra","name":"shreymehrotra","key":"shreymehrotra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shrey Mehrotra","active":true,"timeZone":"Etc/UTC"},"body":"I am also facing same issue with Hive 1.0.0. Any patch or workaround available?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreymehrotra","name":"shreymehrotra","key":"shreymehrotra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shrey Mehrotra","active":true,"timeZone":"Etc/UTC"},"created":"2015-04-16T11:38:17.496+0000","updated":"2015-04-16T11:38:17.496+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12731323/comment/14601285","id":"14601285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wasperen","name":"wasperen","key":"wasperen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Willem van Asperen","active":true,"timeZone":"Europe/Berlin"},"body":"Same issue on Hive 0.14.0.2.2 from HDP 2.2.4","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wasperen","name":"wasperen","key":"wasperen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Willem van Asperen","active":true,"timeZone":"Europe/Berlin"},"created":"2015-06-25T14:42:46.518+0000","updated":"2015-06-25T14:42:46.518+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12731323/comment/14661855","id":"14661855","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nd7275","name":"nd7275","key":"nd7275","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Csaba Németi","active":true,"timeZone":"Etc/UTC"},"body":"Hi. I got the same error running a simple query that doesn't take minutes...\nWhat I discovered (I'm 1 month old in Hadoop & Hive so, take this in account please) is the following: I think SQL processing is asynchronous and this raise serious problems if you try to run two queries in parallel. So the way I fixed the problem was to synchronize the methods using Hive connection.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nd7275","name":"nd7275","key":"nd7275","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Csaba Németi","active":true,"timeZone":"Etc/UTC"},"created":"2015-08-07T13:57:21.369+0000","updated":"2015-08-07T13:57:21.369+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12731323/comment/14935294","id":"14935294","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hammamr","name":"hammamr","key":"hammamr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sidi RHIL","active":true,"timeZone":"Etc/UTC"},"body":"Hello,\n\nI have the same problem when using Talend to read a hive table (see the log below).\n\nDid anybody find a solution for this issue? \n\nException in component tHiveInput_1\njava.sql.SQLException: org.apache.thrift.TApplicationException: CloseOperation failed: out of sequence response\n\tat org.apache.hive.jdbc.HiveStatement.closeClientOperation(HiveStatement.java:172)\n\tat org.apache.hive.jdbc.HiveStatement.close(HiveStatement.java:191)\n\tat mon_projet.agregate_doxtl_0_1.agregate_doxtl.tHiveInput_1Process(agregate_doxtl.java:2540)\n\tat mon_projet.agregate_doxtl_0_1.agregate_doxtl.runJobInTOS(agregate_doxtl.java:3447)\n\tat mon_projet.agregate_doxtl_0_1.agregate_doxtl.main(agregate_doxtl.java:3304)\nCaused by: org.apache.thrift.TApplicationException: CloseOperation failed: out of sequence response\n\tat org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:76)\n\tat org.apache.hive.service.cli.thrift.TCLIService$Client.recv_CloseOperation(TCLIService.java:455)\n\tat org.apache.hive.service.cli.thrift.TCLIService$Client.CloseOperation(TCLIService.java:442)\n\tat org.apache.hive.jdbc.HiveStatement.closeClientOperation(HiveStatement.java:166)\n\t... 4 more\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hammamr","name":"hammamr","key":"hammamr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sidi RHIL","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-29T15:05:08.298+0000","updated":"2015-09-29T15:05:08.298+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-7594/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1yfuf:"}}