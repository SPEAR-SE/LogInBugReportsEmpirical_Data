{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13016817","self":"https://issues.apache.org/jira/rest/api/2/issue/13016817","key":"HIVE-15100","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-11-07T15:21:57.944+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Nov 18 03:53:06 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-15100/watchers","watchCount":6,"isWatching":false},"created":"2016-11-01T06:53:15.294+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332384","id":"12332384","name":"1.2.1","archived":false,"released":true,"releaseDate":"2015-06-26"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-11-18T03:53:06.060+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320408","id":"12320408","name":"HiveServer2","description":"Tracks issues related to HiveServer2"}],"timeoriginalestimate":null,"description":"I am using hue + hiveserver2. \nFirst I execute sql through Hue, this can be done correctly. But when I export the result as csv file or excel file, an exception will appear in hiveserver2.log:\n\n2016-11-01 14:54:11,622 WARN  [HiveServer2-Handler-Pool: Thread-47]: thrift.ThriftCLIService (ThriftCLIService.java:FetchResults(681)) - Error fetching results: \norg.apache.hive.service.cli.HiveSQLException: Invalid OperationHandle: OperationHandle [opType=EXECUTE_STATEMENT, getHandleIdentifier()=feb55386-72f0-445c-9774-dd8780acf442]\n\tat org.apache.hive.service.cli.operation.OperationManager.getOperation(OperationManager.java:154)\n\tat org.apache.hive.service.cli.CLIService.fetchResults(CLIService.java:456)\n\tat org.apache.hive.service.cli.thrift.ThriftCLIService.FetchResults(ThriftCLIService.java:672)\n\tat org.apache.hive.service.cli.thrift.TCLIService$Processor$FetchResults.getResult(TCLIService.java:1557)\n\tat org.apache.hive.service.cli.thrift.TCLIService$Processor$FetchResults.getResult(TCLIService.java:1542)\n\tat org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39)\n\tat org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39)\n\tat org.apache.hive.service.auth.TSetIpAddressProcessor.process(TSetIpAddressProcessor.java:56)\n\tat org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:285)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n\n\nI add a few session related configurations:\n\nhive.server2.idle.operatoin.timeout = 1 day\nhive.server2.idle.session.timeout = 3 days\nhive.server2.session.check.interval = 1 hour\n\nAnd my operations log config like this:\n\nhive.server2.loggging.operation.enabled=true\nhive.server2.loggging.operation.log.location=/tmp/hive/operation_logs\n\n\nI try to remove all files in my operation_logs dir(/tmp/hive/operation_logs)ï¼Œ and clean all session data in hue tables(beeswax_session, django_session), then restart hiveserver2 and hue. But nothing getting better..\n\nBegging for ur help~\n\nThanks.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"HiveSQLException: Invalid OperationHandle: OperationHandle [opType=EXECUTE_STATEMENT, getHandleIdentifier","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=WillCup","name":"WillCup","key":"willcup","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Will Chen","active":true,"timeZone":"Asia/Harbin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=WillCup","name":"WillCup","key":"willcup","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Will Chen","active":true,"timeZone":"Asia/Harbin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13016817/comment/15644462","id":"15644462","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andybraslavskiy","name":"andybraslavskiy","key":"andybraslavskiy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andy Braslavskiy","active":true,"timeZone":"Etc/UTC"},"body":"I have the same exceptions, when doing any interactions from Hue to Hive.\nThis problems I have only on kerberised cluster, with Hadoop in Classic mode, and Hue 3.10.\nBut, everything works fine with Hue 3.9 / non kerberised cluster / Hadoop in YARN mode.\n\n[~WillCup], can you provide any details, of your configuration?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andybraslavskiy","name":"andybraslavskiy","key":"andybraslavskiy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andy Braslavskiy","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-07T15:21:57.944+0000","updated":"2016-11-07T15:21:57.944+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13016817/comment/15647510","id":"15647510","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andybraslavskiy","name":"andybraslavskiy","key":"andybraslavskiy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andy Braslavskiy","active":true,"timeZone":"Etc/UTC"},"body":"This problem may be related to Hue.\n\nI found hack in Hortonworks community: https://community.hortonworks.com/answers/51998/view.html\n\nBy doing some research, I've found that in sasl library that is used in Hue for working with Kerberos, there is buffer with default size equals to 65535 bytes.\nBut sometimes, Hive produces more than 64 kilobytes of data (i.e. for query \"SET -v\").\nSo this problem may be caused by buffer overflow in sasl library.\n\nFor me this problem was fixed by modifying desktop/core/src/desktop/lib/thrift_util.py.\nInside function\n{quote}\ndef connect_to_thrift(conf):\n{quote}\nafter saslc creation\n{quote}\nsaslc = sasl.Client()\n{quote}\ni've added\n{quote}\nsaslc.setAttr(\"maxbufsize\", 2**17 - 1)\n{quote}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andybraslavskiy","name":"andybraslavskiy","key":"andybraslavskiy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andy Braslavskiy","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-08T13:03:08.688+0000","updated":"2016-11-08T13:03:08.688+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13016817/comment/15675650","id":"15675650","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=WillCup","name":"WillCup","key":"willcup","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Will Chen","active":true,"timeZone":"Asia/Harbin"},"body":"Thanks for ur attention. \n\nI think you are right : this is not related to hiveserver, but hue. I did nothing but rebuild hue, and deploy hue on another host, then everything works fine.....\n\n\nI don't know the exact reason for now, but not ur Kerberos problem.\n\nThanks for your suggestion","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=WillCup","name":"WillCup","key":"willcup","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Will Chen","active":true,"timeZone":"Asia/Harbin"},"created":"2016-11-18T03:53:06.060+0000","updated":"2016-11-18T03:53:06.060+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-15100/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i35nq7:"}}