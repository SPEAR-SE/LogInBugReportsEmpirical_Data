{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12938331","self":"https://issues.apache.org/jira/rest/api/2/issue/12938331","key":"HIVE-13037","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2016-02-10 20:51:47.912","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-13037/watchers","watchCount":1,"isWatching":false},"created":"2016-02-10T20:51:47.912+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329278","id":"12329278","description":"Branch 1.0 release","name":"1.0.0","archived":false,"released":true,"releaseDate":"2015-02-04"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-05-05T22:24:45.503+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320408","id":"12320408","name":"HiveServer2","description":"Tracks issues related to HiveServer2"}],"timeoriginalestimate":null,"description":"I am writing a client for HS2 that uses the JDBC interface. I can execute a simple select query. When I add a UDF to the query, the  client hangs. I looked at the logs (larger excerpt below) and there is this bit that looks suspect, and repeats ad infinitum\n\n{code}\n2016-02-10 20:26:49,571 INFO  [hiveServer2.async.multi_dest.batch_hiveServer2.async.multi_dest.batch.db_destWriter]: queue.AuditFileSpool (AuditFileSpool.java:runDoAs(780)) - Destination is down. sleeping for 30000 milli seconds. indexQueue=0, queueName=hiveServer2.async.multi_dest.batch, consumer=hiveServer2.async.multi_dest.batch.db\n{code}\n\nNo tez dag is ever submitted or executed, per log and web UI. The only special thing about this UDF may be that it accesses a file that has been added with ADD FILE from hdfs. \n\nLog from query submission to infinite loop first few iterations:\n\n{code}\n2016-02-10 20:24:32,695 INFO  [HiveServer2-Handler-Pool: Thread-4907]: parse.ParseDriver (ParseDriver.java:parse(185)) - Parsing command: SELECT count(*) FROM (SELECT `mpg`, `cyl`, \n`disp`, `hp`, `drat`, `wt`, `qsec`, `vs`, `am`, `gear`, `carb`, rudfdouble('/tmp/8d4a5fc1-a5d1-4048-81dc-e1e3b86b3074_resources/squareudf', `carb`) AS `sq`\nFROM `mtcars`) AS `master`\n2016-02-10 20:24:32,698 INFO  [HiveServer2-Handler-Pool: Thread-4907]: parse.ParseDriver (ParseDriver.java:parse(209)) - Parse Completed\n2016-02-10 20:24:32,699 INFO  [HiveServer2-Handler-Pool: Thread-4907]: log.PerfLogger (PerfLogger.java:PerfLogEnd(148)) - </PERFLOG method=parse start=1455135872695 end=145513587269\n9 duration=4 from=org.apache.hadoop.hive.ql.Driver>\n2016-02-10 20:24:32,704 INFO  [HiveServer2-Handler-Pool: Thread-4907]: log.PerfLogger (PerfLogger.java:PerfLogBegin(121)) - <PERFLOG method=semanticAnalyze from=org.apache.hadoop.hi\nve.ql.Driver>\n2016-02-10 20:24:32,704 INFO  [HiveServer2-Handler-Pool: Thread-4907]: parse.CalcitePlanner (SemanticAnalyzer.java:analyzeInternal(10105)) - Starting Semantic Analysis\n2016-02-10 20:24:32,704 INFO  [HiveServer2-Handler-Pool: Thread-4907]: parse.CalcitePlanner (SemanticAnalyzer.java:genResolvedParseTree(10052)) - Completed phase 1 of Semantic Analy\nsis\n2016-02-10 20:24:32,705 INFO  [HiveServer2-Handler-Pool: Thread-4907]: parse.CalcitePlanner (SemanticAnalyzer.java:getMetaData(1534)) - Get metadata for source tables\n2016-02-10 20:24:32,705 INFO  [HiveServer2-Handler-Pool: Thread-4907]: parse.CalcitePlanner (SemanticAnalyzer.java:getMetaData(1686)) - Get metadata for subqueries\n2016-02-10 20:24:32,705 INFO  [HiveServer2-Handler-Pool: Thread-4907]: parse.CalcitePlanner (SemanticAnalyzer.java:getMetaData(1534)) - Get metadata for source tables\n2016-02-10 20:24:32,706 INFO  [HiveServer2-Handler-Pool: Thread-4907]: metastore.ObjectStore (ObjectStore.java:initialize(290)) - ObjectStore, initialize called\n2016-02-10 20:24:32,708 WARN  [HiveServer2-Handler-Pool: Thread-4907]: metastore.MetaStoreDirectSql (MetaStoreDirectSql.java:determineDbType(160)) - DB Product name[MySQL] obtained,\n but not used to determine db type. Falling back to using SQL to determine which db we're using\n2016-02-10 20:24:32,713 INFO  [HiveServer2-Handler-Pool: Thread-4907]: metastore.MetaStoreDirectSql (MetaStoreDirectSql.java:<init>(140)) - Using direct SQL, underlying DB is MYSQL\n2016-02-10 20:24:32,713 INFO  [HiveServer2-Handler-Pool: Thread-4907]: metastore.ObjectStore (ObjectStore.java:setConf(273)) - Initialized ObjectStore\n2016-02-10 20:24:32,714 INFO  [HiveServer2-Handler-Pool: Thread-4907]: metastore.HiveMetaStore (HiveMetaStore.java:logInfo(747)) - 213: get_table : db=default tbl=mtcars\n2016-02-10 20:24:32,714 INFO  [HiveServer2-Handler-Pool: Thread-4907]: HiveMetaStore.audit (HiveMetaStore.java:logAuditEvent(372)) - ugi=hive   ip=unknown-ip-addr      cmd=get_table\n : db=default tbl=mtcars   \n2016-02-10 20:24:32,753 INFO  [HiveServer2-Handler-Pool: Thread-4907]: parse.CalcitePlanner (SemanticAnalyzer.java:getMetaData(1686)) - Get metadata for subqueries\n2016-02-10 20:24:32,753 INFO  [HiveServer2-Handler-Pool: Thread-4907]: parse.CalcitePlanner (SemanticAnalyzer.java:getMetaData(1710)) - Get metadata for destination tables\n2016-02-10 20:24:32,753 INFO  [HiveServer2-Handler-Pool: Thread-4907]: parse.CalcitePlanner (SemanticAnalyzer.java:getMetaData(1710)) - Get metadata for destination tables\n2016-02-10 20:24:32,772 INFO  [HiveServer2-Handler-Pool: Thread-4907]: ql.Context (Context.java:getMRScratchDir(330)) - New scratch dir is hdfs://sandbox.hortonworks.com:8020/tmp/hi\nve/hive/8d4a5fc1-a5d1-4048-81dc-e1e3b86b3074/hive_2016-02-10_20-24-32_695_972448943093277787-40\n2016-02-10 20:24:32,772 INFO  [HiveServer2-Handler-Pool: Thread-4907]: parse.CalcitePlanner (SemanticAnalyzer.java:genResolvedParseTree(10056)) - Completed getting MetaData in Seman\ntic Analysis\n2016-02-10 20:24:32,772 INFO  [HiveServer2-Handler-Pool: Thread-4907]: parse.BaseSemanticAnalyzer (CalcitePlanner.java:canCBOHandleAst(392)) - Not invoking CBO because the statement\n has too few joins\n2016-02-10 20:24:33,382 INFO  [HiveServer2-Handler-Pool: Thread-4907]: log.PerfLogger (PerfLogger.java:PerfLogEnd(148)) - </PERFLOG method=compile start=1455135872694 end=1455135873382 duration=688 from=org.apache.hadoop.hive.ql.Driver>\n2016-02-10 20:24:49,568 INFO  [hiveServer2.async.multi_dest.batch_hiveServer2.async.multi_dest.batch.db_destWriter]: queue.AuditFileSpool (AuditFileSpool.java:runDoAs(780)) - Destination is down. sleeping for 30000 milli seconds. indexQueue=0, queueName=hiveServer2.async.multi_dest.batch, consumer=hiveServer2.async.multi_dest.batch.db\n2016-02-10 20:24:52,083 INFO  [org.apache.ranger.audit.queue.AuditBatchQueue1]: provider.BaseAuditHandler (BaseAuditHandler.java:logStatus(301)) - Audit Status Log: name=hiveServer2.async.multi_dest.batch, finalDestination=hiveServer2.async.multi_dest.batch.hdfs, interval=01:00.009 minutes, events=14, succcessCount=5, totalEvents=420, totalSuccessCount=111, totalStashedCount=184\n2016-02-10 20:25:03,352 INFO  [org.apache.ranger.audit.queue.AuditBatchQueue0]: provider.BaseAuditHandler (BaseAuditHandler.java:logStatus(301)) - Audit Status Log: name=hiveServer2.async.multi_dest.batch, finalDestination=hiveServer2.async.multi_dest.batch.db, interval=01:02.999 minutes, events=5, succcessCount=2, totalEvents=717, totalSuccessCount=295\n2016-02-10 20:25:31,635 INFO  [HiveServer2-Handler-Pool: Thread-5400]: thrift.ThriftCLIService (ThriftCLIService.java:OpenSession(294)) - Client protocol version: HIVE_CLI_SERVICE_PROTOCOL_V8\n2016-02-10 20:25:31,653 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.SessionState (SessionState.java:createPath(641)) - Created local directory: /tmp/47f78843-0f14-4db5-ad7c-318b37ac44c9_resources\n2016-02-10 20:25:31,662 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.SessionState (SessionState.java:createPath(641)) - Created HDFS directory: /tmp/hive/hive/47f78843-0f14-4db5-ad7c-318b37ac44c9\n2016-02-10 20:25:31,665 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.SessionState (SessionState.java:createPath(641)) - Created local directory: /tmp/hive/47f78843-0f14-4db5-ad7c-318b37ac44c9\n2016-02-10 20:25:31,672 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.SessionState (SessionState.java:createPath(641)) - Created HDFS directory: /tmp/hive/hive/47f78843-0f14-4db5-ad7c-318b37ac44c9/_tmp_space.db\n2016-02-10 20:25:31,675 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.HiveSessionImpl (HiveSessionImpl.java:setOperationLogSessionDir(236)) - Operation log session directory is created: /home/hive/${system:java.io.tmpdir}/${system:user.name}/operation_logs/47f78843-0f14-4db5-ad7c-318b37ac44c9\n2016-02-10 20:25:49,569 INFO  [hiveServer2.async.multi_dest.batch_hiveServer2.async.multi_dest.batch.db_destWriter]: queue.AuditFileSpool (AuditFileSpool.java:runDoAs(780)) - Destination is down. sleeping for 30000 milli seconds. indexQueue=0, queueName=hiveServer2.async.multi_dest.batch, consumer=hiveServer2.async.multi_dest.batch.db\n2016-02-10 20:26:30,890 INFO  [HiveServer2-Handler-Pool: Thread-5400]: thrift.ThriftCLIService (ThriftCLIService.java:OpenSession(294)) - Client protocol version: HIVE_CLI_SERVICE_PROTOCOL_V8\n2016-02-10 20:26:30,902 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.SessionState (SessionState.java:createPath(641)) - Created local directory: /tmp/2ca839b8-f6e5-465d-9ae7-3cbe5418be64_resources\n2016-02-10 20:26:30,910 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.SessionState (SessionState.java:createPath(641)) - Created HDFS directory: /tmp/hive/hive/2ca839b8-f6e5-465d-9ae7-3cbe5418be64\n2016-02-10 20:26:30,914 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.SessionState (SessionState.java:createPath(641)) - Created local directory: /tmp/hive/2ca839b8-f6e5-465d-9ae7-3cbe5418be64\n2016-02-10 20:26:30,922 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.SessionState (SessionState.java:createPath(641)) - Created HDFS directory: /tmp/hive/hive/2ca839b8-f6e5-465d-9ae7-3cbe5418be64/_tmp_space.db\n2016-02-10 20:26:30,926 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.HiveSessionImpl (HiveSessionImpl.java:setOperationLogSessionDir(236)) - Operation log session directory is created: /home/hive/${system:java.io.tmpdir}/${system:user.name}/operation_logs/2ca839b8-f6e5-465d-9ae7-3cbe5418be64\n2016-02-10 20:26:49,571 INFO  [hiveServer2.async.multi_dest.batch_hiveServer2.async.multi_dest.batch.db_destWriter]: queue.AuditFileSpool (AuditFileSpool.java:runDoAs(780)) - Destination is down. sleeping for 30000 milli seconds. indexQueue=0, queueName=hiveServer2.async.multi_dest.batch, consumer=hiveServer2.async.multi_dest.batch.db\n2016-02-10 20:27:31,748 INFO  [HiveServer2-Handler-Pool: Thread-5400]: thrift.ThriftCLIService (ThriftCLIService.java:OpenSession(294)) - Client protocol version: HIVE_CLI_SERVICE_PROTOCOL_V8\n2016-02-10 20:27:31,763 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.SessionState (SessionState.java:createPath(641)) - Created local directory: /tmp/701b1cef-63c4-4c13-a275-fe28469eccc8_resources\n2016-02-10 20:27:31,771 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.SessionState (SessionState.java:createPath(641)) - Created HDFS directory: /tmp/hive/hive/701b1cef-63c4-4c13-a275-fe28469eccc8\n2016-02-10 20:27:31,776 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.SessionState (SessionState.java:createPath(641)) - Created local directory: /tmp/hive/701b1cef-63c4-4c13-a275-fe28469eccc8\n2016-02-10 20:27:31,783 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.SessionState (SessionState.java:createPath(641)) - Created HDFS directory: /tmp/hive/hive/701b1cef-63c4-4c13-a275-fe28469eccc8/_tmp_space.db\n2016-02-10 20:27:31,787 INFO  [HiveServer2-Handler-Pool: Thread-5400]: session.HiveSessionImpl (HiveSessionImpl.java:setOperationLogSessionDir(236)) - Operation log session directory is created: /home/hive/${system:java.io.tmpdir}/${system:user.name}/operation_logs/701b1cef-63c4-4c13-a275-fe28469eccc8\n2016-02-10 20:27:49,572 INFO  [hiveServer2.async.multi_dest.batch_hiveServer2.async.multi_dest.batch.db_destWriter]: queue.AuditFileSpool (AuditFileSpool.java:runDoAs(780)) - Destination is down. sleeping for 30000 milli seconds. indexQueue=0, queueName=hiveServer2.async.multi_dest.batch, consumer=hiveServer2.async.multi_dest.batch.db\n2016-02-10 20:28:31,397 INFO  [HiveServer2-Handler-Pool: Thread-5400]: thrift.ThriftCLIService (ThriftCLIService.java:OpenSession(294)) - Client protocol version: HIVE_CLI_SERVICE_PROTOCOL_V8\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Query with UDF never terminate","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=piccolbo","name":"piccolbo","key":"piccolbo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Antonio Piccolboni","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=piccolbo","name":"piccolbo","key":"piccolbo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Antonio Piccolboni","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-13037/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2sowv:"}}