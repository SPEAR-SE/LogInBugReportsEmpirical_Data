{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13090572","self":"https://issues.apache.org/jira/rest/api/2/issue/13090572","key":"HIVE-17186","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-07-27T17:32:58.303+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jul 27 17:37:23 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-17186/watchers","watchCount":3,"isWatching":false},"created":"2017-07-27T17:16:03.042+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-07-27T17:37:23.508+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"This might be an issue where Hive loses a precision and generates a wrong result when handling *double* constant operations. This was reported in the following environment.\n\n*ENVIRONMENT*\nhttps://github.com/hortonworks/hive-testbench/blob/hive14/tpch-gen/ddl/orc.sql\n\n*SQL*\n{code}\nhive> explain select l_discount from lineitem where l_discount between 0.06 - 0.01 and 0.06 + 0.01 limit 10;\nOK\nPlan not optimized by CBO.\n\nStage-0\n   Fetch Operator\n      limit:10\n      Stage-1\n         Map 1 vectorized\n         File Output Operator [FS_9]\n            compressed:false\n            Statistics:Num rows: 10 Data size: 80 Basic stats: COMPLETE Column stats: COMPLETE\n            table:{\"input format:\":\"org.apache.hadoop.mapred.TextInputFormat\",\"output format:\":\"org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat\",\"serde:\":\"org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe\"}\n            Limit [LIM_8]\n               Number of rows:10\n               Statistics:Num rows: 10 Data size: 80 Basic stats: COMPLETE Column stats: COMPLETE\n               Select Operator [OP_7]\n                  outputColumnNames:[\"_col0\"]\n                  Statistics:Num rows: 2999994854 Data size: 23999958832 Basic stats: COMPLETE Column stats: COMPLETE\n                  Filter Operator [FIL_6]\n                     predicate:l_discount BETWEEN 0.049999999999999996 AND 0.06999999999999999 (type: boolean)\n                     Statistics:Num rows: 2999994854 Data size: 23999958832 Basic stats: COMPLETE Column stats: COMPLETE\n                     TableScan [TS_0]\n                        alias:lineitem\n                        Statistics:Num rows: 5999989709 Data size: 4832986297043 Basic stats: COMPLETE Column stats: COMPLETE\n\nhive> select max(l_discount) from lineitem where l_discount between 0.06 - 0.01 and 0.06 + 0.01 limit 10;\nOK\n0.06\nTime taken: 314.923 seconds, Fetched: 1 row(s)\n{code}\n\nHive excludes 0.07 differently from the users' intuitiion. Also, this difference makes some users confused because they believe that Hive's result is the correct one. Is there any way for Hive to fix this?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"`double` type constant operation loses precision","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dongjoon","name":"dongjoon","key":"dongjoon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dongjoon&avatarId=25137","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dongjoon&avatarId=25137","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dongjoon&avatarId=25137","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dongjoon&avatarId=25137"},"displayName":"Dongjoon Hyun","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dongjoon","name":"dongjoon","key":"dongjoon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dongjoon&avatarId=25137","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dongjoon&avatarId=25137","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dongjoon&avatarId=25137","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dongjoon&avatarId=25137"},"displayName":"Dongjoon Hyun","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13090572/comment/16103551","id":"16103551","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=asherman","name":"asherman","key":"asherman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=asherman&avatarId=31918","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=asherman&avatarId=31918","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=asherman&avatarId=31918","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=asherman&avatarId=31918"},"displayName":"Andrew Sherman","active":true,"timeZone":"America/Los_Angeles"},"body":"This looks like an artifact of floating point arithmetic:\n\n{noformat}\ndouble d1 = 0.06D;\ndouble d2 = 0.01D;\ndouble d3 = d1 + d2;\ndouble d4 = d1 - d2;\nSystem.out.println(\"d3 = \" + d3);\nSystem.out.println(\"d4 = \" + d4);\n{noformat}\ngives\n{noformat}\nd3 = 0.06999999999999999\nd4 = 0.049999999999999996\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=asherman","name":"asherman","key":"asherman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=asherman&avatarId=31918","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=asherman&avatarId=31918","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=asherman&avatarId=31918","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=asherman&avatarId=31918"},"displayName":"Andrew Sherman","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-07-27T17:32:58.303+0000","updated":"2017-07-27T17:32:58.303+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13090572/comment/16103559","id":"16103559","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gopalv","name":"gopalv","key":"gopalv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gopal V","active":true,"timeZone":"Asia/Kolkata"},"body":"bq. Is there any way for Hive to fix this?\n\nNo, this is {{0.1+0.2 != 0.3}} problem with IEEE 754 arithmetic.\n\nDecimal and 0.1BD + 0.2BD wouldn't cause these rounding errors.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gopalv","name":"gopalv","key":"gopalv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gopal V","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-07-27T17:37:23.508+0000","updated":"2017-07-27T17:37:23.508+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-17186/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3i3l3:"}}