{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12432589","self":"https://issues.apache.org/jira/rest/api/2/issue/12432589","key":"HIVE-741","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315150","id":"12315150","description":"released","name":"0.7.0","archived":false,"released":true,"releaseDate":"2011-03-29"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-08-10T07:21:31.339+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Aug 24 22:21:00 UTC 2010","customfield_12310420":"73331","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_565489784_*|*_1_*:*_1_*:*_32419045732_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-08-24T22:21:00.676+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-741/watchers","watchCount":3,"isWatching":false},"created":"2009-08-08T03:58:45.160+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"9.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314524","id":"12314524","description":"released","name":"0.6.0","archived":false,"released":true,"releaseDate":"2010-10-29"}],"issuelinks":[{"id":"12326192","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12326192","type":{"id":"10020","name":"Cloners","inward":"is cloned by","outward":"is a clone of","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10020"},"outwardIssue":{"id":"12432443","key":"HIVE-734","self":"https://issues.apache.org/jira/rest/api/2/issue/12432443","fields":{"summary":"problem in dealing with null","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12332971","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12332971","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12469118","key":"HIVE-1460","self":"https://issues.apache.org/jira/rest/api/2/issue/12469118","fields":{"summary":"JOIN should not output rows for NULL values","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12333457","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12333457","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"outwardIssue":{"id":"12471879","key":"HIVE-1552","self":"https://issues.apache.org/jira/rest/api/2/issue/12471879","fields":{"summary":"Nulls are not handled in Sort Merge MapJoin","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12333441","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12333441","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12471879","key":"HIVE-1552","self":"https://issues.apache.org/jira/rest/api/2/issue/12471879","fields":{"summary":"Nulls are not handled in Sort Merge MapJoin","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12348278","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12348278","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12542970","key":"HIVE-2810","self":"https://issues.apache.org/jira/rest/api/2/issue/12542970","fields":{"summary":"Implement NULL-safe equality operator <=>","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}},{"id":"12333424","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12333424","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12471750","key":"HIVE-1544","self":"https://issues.apache.org/jira/rest/api/2/issue/12471750","fields":{"summary":"Filtering out NULL-keyed rows in ReduceSinkOperator when no outer join involved","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-02-16T23:42:41.206+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312585","id":"12312585","name":"Serializers/Deserializers","description":"Tracks issues dealing with serdes"}],"timeoriginalestimate":null,"description":"With the following data in table input4_cb:\n\nKey        Value\n------       --------\nNULL     325\n18          NULL\n\nThe following query:\n{code}\nselect * from input4_cb a join input4_cb b on a.key = b.value;\n{code}\n\nreturns the following result:\n\nNULL    325    18   NULL\n\nThe correct result should be empty set.\n\nWhen 'null' is replaced by '' it works.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12452838","id":"12452838","filename":"join_nulls.q.out","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-23T18:07:29.861+0000","size":27508,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12452838/join_nulls.q.out"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12452165","id":"12452165","filename":"patch-741.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-16T11:44:40.715+0000","size":7438,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12452165/patch-741.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12452383","id":"12452383","filename":"patch-741-1.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-18T09:11:28.268+0000","size":28025,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12452383/patch-741-1.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12452484","id":"12452484","filename":"patch-741-2.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-19T05:12:28.670+0000","size":33149,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12452484/patch-741-2.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12452613","id":"12452613","filename":"patch-741-3.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-20T07:24:31.198+0000","size":40093,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12452613/patch-741-3.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12452772","id":"12452772","filename":"patch-741-4.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-23T04:37:29.491+0000","size":41414,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12452772/patch-741-4.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12452782","id":"12452782","filename":"patch-741-5.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-23T06:36:13.627+0000","size":41413,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12452782/patch-741-5.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12452898","id":"12452898","filename":"patch-741-6.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-24T06:37:01.266+0000","size":42905,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12452898/patch-741-6.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12452384","id":"12452384","filename":"smbjoin_nulls.q.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-18T09:11:28.488+0000","size":650,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12452384/smbjoin_nulls.q.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"122513","customfield_12312823":null,"summary":"NULL is not handled correctly in join","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12896789","id":"12896789","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"bq. When 'null' is replaced by '' it works.\nI see the same result even if 'null' is replaced with ''.\n\nTo reproduce the above, I created a table input1 with\n{code}\nhive> create table input1 (key int, value int);\n{code}\n\nLoaded the following input using Load data command\n{noformat}\nin.txt\n^A35\n12^A\n10^A1000\n10^A100\n100^A100\n{noformat}\n\nI see the following output for join queries executed.\n{noformat}\n\nhive> select * from input1 a join input1 b on a.key=b.value;\n\nOutput:\nNULL    35      12      NULL\n100     100     10      100\n100     100     100     100\n\nExpected Output:\n100     100     10      100\n100     100     100     100\n\nhive> select * from input1 a left outer join input1 b on a.key=b.value;\n\nOUTPUT:\nNULL    35      12      NULL\n10      1000    NULL    NULL\n10      100     NULL    NULL\n12      NULL    NULL    NULL\n100     100     10      100\n100     100     100     100\n\nExpected Output:\nNULL    35      NULL    NULL\n10      1000    NULL    NULL\n10      100     NULL    NULL\n12      NULL    NULL    NULL\n100     100     10      100\n100     100     100     100\n\nhive> select * from input1 a right outer join input1 b on a.key=b.value;\n\nOUTPUT:\nNULL    35      12      NULL\nNULL    NULL    NULL    35\n100     100     10      100\n100     100     100     100\nNULL    NULL    10      1000\n\nExpectedOutput:\nNULL    NULL    NULL    35\nNULL    NULL    12      NULL\n100     100     10      100\n100     100     100     100\nNULL    NULL    10      1000\n\n{noformat}\n\nExpected output is obtained from mysql db for a similar query.\n\nNing, if you are not working on the fix for this, I would like to contribute. Would need your help understanding join code also, as I'm a new to hive. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-10T07:21:31.339+0000","updated":"2010-08-10T07:21:31.339+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12896792","id":"12896792","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"By adding logs to ExecReducer, I see that the input to reduce is the following:\n{noformat}\n{\"key\":{\"joinkey0\":null},\"value\":{\"_col0\":null,\"_col1\":35},\"alias\":0}\n{\"key\":{\"joinkey0\":null},\"value\":{\"_col0\":12,\"_col1\":null},\"alias\":1}\n{\"key\":{\"joinkey0\":10},\"value\":{\"_col0\":10,\"_col1\":1000},\"alias\":0}\n{\"key\":{\"joinkey0\":10},\"value\":{\"_col0\":10,\"_col1\":100},\"alias\":0}\n{\"key\":{\"joinkey0\":12},\"value\":{\"_col0\":12,\"_col1\":null},\"alias\":0}\n{\"key\":{\"joinkey0\":35},\"value\":{\"_col0\":null,\"_col1\":35},\"alias\":1}\n{\"key\":{\"joinkey0\":100},\"value\":{\"_col0\":100,\"_col1\":100},\"alias\":0}\n{\"key\":{\"joinkey0\":100},\"value\":{\"_col0\":10,\"_col1\":100},\"alias\":1}\n{\"key\":{\"joinkey0\":100},\"value\":{\"_col0\":100,\"_col1\":100},\"alias\":1}\n{\"key\":{\"joinkey0\":1000},\"value\":{\"_col0\":10,\"_col1\":1000},\"alias\":1}\n{noformat}\n\nAnd joinkey with null values are processed under same group, I think they should be processed in different groups, because comparison between nulls is not defined. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-10T07:36:24.721+0000","updated":"2010-08-10T07:36:24.721+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12896793","id":"12896793","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm not actively working on it. Please feel free to take it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-10T07:40:12.976+0000","updated":"2010-08-10T07:40:12.976+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12896974","id":"12896974","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"The joins are implemented in the JoinOperator and CommonJoinOperators for regular reduce-side joins. The map-side joins are implemented in the MapJoinOperator. \n\nIn the reduce side joins, the join keys are treated as distribution keys from the mappers to the reducers so that each group (marked by beginGroup() and endGroup()) will consists of rows with the same join keys. The reduce-side joins will cache all rows within a group except the last one (aka streaming table), which is scanned and cartesian producted with the cached rows of the other tables. I think the fix would be to check the NULL value of the join keys and do proper output based on the semantics of different types of joins. \n\nFor the map-side join, it's basically a hash join where the small table is read in entirety in a hash table and probed while scanning the streaming table. \n\nThere are other types of joins (bucketed map-side join, sort merge join etc.), but they all rely on the 3 classes mentioned above. \n\nLet me know if you have further questions for you to get started. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-10T17:37:40.874+0000","updated":"2010-08-10T17:37:40.874+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12898132","id":"12898132","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tedxu","name":"tedxu","key":"tedxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Xu","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks for Ning and Amareshwari, we are looking forward to see the bug fixed. I think it's Okay to solve it by modifying the *JoinOperators, but it will be great if we can filter the NULL values in mappers, say, in ReduceSinkOperator, provided if we can know which part of the reduce sink key is from join (other than from group by, distinct, etc,.).  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tedxu","name":"tedxu","key":"tedxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Xu","active":true,"timeZone":"Asia/Shanghai"},"created":"2010-08-13T08:29:48.476+0000","updated":"2010-08-13T08:29:48.476+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12898136","id":"12898136","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks Ning for the details.\n\nTo summarize the implementation of join: \n* In reduce-side join, rows with same join keys are grouped together; and  in MapSide join, rows with same join keys are added the same entry in the hash table. \n* CommonJoinOperator.checkAndGenObject: The rows with same join key are cartesian producted with each other(i.e. with rows of different aliases). If there are no rows in one table alias, the rows of other table alias are ignored (for inner join) or cartesian producted with nulls (outer joins). \n\nThe above implementation works fine except for null join keys ; Since these rows are grouped together/hashed to same entry, the current issue exists.\n \nbq. I think the fix would be to check the NULL value of the join keys and do proper output based on the semantics of different types of joins.\nThis would need special handling for each type of join (inner, left outer, right outer, full outer  an etc.). So, I'm thinking the better solution is not group rows with null join keys together. Then the above join algorithm works correctly for all types of joins.\n\nCurrently they are grouped together because HiveKey.compare compares the bytes of the key (in case of reduce-side join) and MapJoinObjectKey.equals returns true if both keys are null (in case of map-side join). I'm trying to see if can come up with a solution which does not group rows with null join keys together. Please correct me if am wrong.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-13T08:57:52.855+0000","updated":"2010-08-13T08:57:52.855+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12898141","id":"12898141","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"bq. but it will be great if we can filter the NULL values in mappers.\nTed, we should not filter out the NULL values in mappers. Because for outer joins, these rows should be cartesian producted with nulls as shown in expected output in the [comment | https://issues.apache.org/jira/browse/HIVE-741?focusedCommentId=12896789&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12896789]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-13T09:14:42.582+0000","updated":"2010-08-13T09:14:42.582+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12898194","id":"12898194","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tedxu","name":"tedxu","key":"tedxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Xu","active":true,"timeZone":"Asia/Shanghai"},"body":"Sorry I'm mistakenly expressed my idea, I mean values with NULL join keys shall be filtered out in mappers. \n\nI think values with NULL join keys shall be filtered out because NULL equals nothing, and Hive only support equal join.\n\nPlease correct me if I'm wrong. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tedxu","name":"tedxu","key":"tedxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Xu","active":true,"timeZone":"Asia/Shanghai"},"created":"2010-08-13T11:36:09.029+0000","updated":"2010-08-13T11:36:09.029+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12898374","id":"12898374","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jvs","name":"jvs","key":"jvs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Sichi","active":true,"timeZone":"Etc/UTC"},"body":"@Ted:  as Amareshwari mentioned, a left outer join preserves rows on the left side regardless of whether the ON clause evaluates true.  So in that case (and similar cases for right/full outer join), we can't filter out the rows with null join keys.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jvs","name":"jvs","key":"jvs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Sichi","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-13T19:14:38.813+0000","updated":"2010-08-13T19:14:38.813+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12898756","id":"12898756","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"@Amareshwar, currently we already distinguish different join types with different functions (take a look at CommonJoinOperator.joinObjects()). I look forward to seeing your proposal to avoid grouping null-keyed rows.\n\n@Ted, I agree with Amareshwar and John that we cannot avoid rows (or the value part of the key-value pairs) with null as a key. However you have a point in that if we know the join operator does not involve outer join at all (we already have a flag noOuterJoin in JoinDesc), then we could avoid sending rows will null keys from the mappers to the reducers. This will save bandwidth as well as processing time. Could you open another JIRA and be able to submit a patch?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-15T21:37:37.295+0000","updated":"2010-08-15T21:37:37.295+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12898772","id":"12898772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tedxu","name":"tedxu","key":"tedxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Xu","active":true,"timeZone":"Asia/Shanghai"},"body":"bq. a left outer join preserves rows on the left side regardless of whether the ON clause evaluates true\nThat's right, thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tedxu","name":"tedxu","key":"tedxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Xu","active":true,"timeZone":"Asia/Shanghai"},"created":"2010-08-16T01:01:23.390+0000","updated":"2010-08-16T01:01:23.390+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12898858","id":"12898858","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"Attaching a simple patch which fixes JoinOperator (for reduce-side joins) and MapJoinOperator (for map-side joins) to not group the null join keys together. \nAny comments on the approach/code are welcome.\nVerified that SMBMapJoinOperator already filters nulls properly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-16T11:44:40.773+0000","updated":"2010-08-16T11:44:40.773+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12898996","id":"12898996","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"the change looks good to me. Can you also add one or few tests for sort merge join?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-16T17:23:59.806+0000","updated":"2010-08-16T17:23:59.806+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12899044","id":"12899044","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"@Amareshwari, aside from adding new test cases for sort merge join, this patch also has some bugs. \n\nFor example in your test data:\n\n{code}\nhive> select * from myinput1\nNULL    356\n484 NULL\n10  10\n\n-- incorrect result below\nhive> select * FROM myinput1 a left outer JOIN myinput1 b ON a.value = b.value; \n484 NULL    484 NULL\n10  10  10  10\nNULL    356 NULL    NULL\n\nhive> select * FROM myinput1 a right outer JOIN myinput1 b ON a.value = b.value;\n484 NULL    484 NULL\n10  10  10  10\nNULL    NULL    NULL    356\n\nhive> select * FROM myinput1 a left outer JOIN myinput1 b right outer join myinput1 c ON a.value = b.value and b.value = c.value;\nNULL    NULL    NULL    NULL    484 NULL\nNULL    NULL    NULL    NULL    10  10\nNULL    NULL    NULL    NULL    NULL    356\n{code}\n\nCan you take a look? I'm not sure whether ending a group and starting a new group for each null-keyed row works for all cases particularly in joins involving more than 2 tables and mixture of left and right outer joins.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-16T19:27:59.112+0000","updated":"2010-08-16T19:27:59.112+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12899177","id":"12899177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"For inner, left and right outer joins, a simpler fix would be to add a filter on top.\n\nFor example, for \n\nA join B on A.c1 = B.c2\n\n\nadd a filter before A (A.c1 is not null) and B (B.c2 is not null)\n\nFor \n\nA left outer join B on A.c1 = B.c2, the filter before A is not needed and \nsimilarly, for \nA right outer join B on A.c1 = B.c2, the filter before B is not needed\n\n\n\nSome special handling might still be needed for full outer joins and sort-merge joins","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-16T23:12:49.671+0000","updated":"2010-08-16T23:12:49.671+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12899365","id":"12899365","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks Ning for your comments.\n\nbq.  select * FROM myinput1 a left outer JOIN myinput1 b ON a.value = b.value;\nbq.  select * FROM myinput1 a right outer JOIN myinput1 b ON a.value = b.value;\nThis is happening because I'm assuming nr.get(0) in JoinOperator is the join-key. It seems it not always true that key is the first element in the ArrayList. When I modified a the code to the following, above queries are giving correct results.\n{code}\n      StructObjectInspector soi = (StructObjectInspector) inputObjInspectors[tag];\n      StructField sf = soi.getStructFieldRef(Utilities.ReduceField.KEY\n          .toString());\n      Object keyObject = soi.getStructFieldData(row, sf);\n      if (SerDeUtils.isNullObject(keyObject, soi)) {\n        endGroup();\n        startGroup();\n     }\n{code}\nAdded method SerDeUtils.isNullObject(keyObject, soi) to know if the object passed is representing a NULL object.\n\nbq. select * FROM myinput1 a left outer JOIN myinput1 b right outer join myinput1 c ON a.value = b.value and b.value = c.value;\nLooking at Stage-1 of \"explain\" for the above query:\n{noformat}\nStage: Stage-1\n    Map Reduce\n      Alias -> Map Operator Tree:\n        a\n          TableScan\n            alias: a\n            Reduce Output Operator\n              sort order:\n              tag: 0\n              value expressions:\n                    expr: key\n                    type: int\n                    expr: value\n                    type: int\n        b\n          TableScan\n            alias: b\n            Reduce Output Operator\n              sort order:\n              tag: 1\n              value expressions:\n                    expr: key\n                    type: int\n                    expr: value\n                    type: int\n      Reduce Operator Tree:\n        Join Operator\n          condition map:\n               Left Outer Join0 to 1\n          condition expressions:\n            0 {VALUE._col0} {VALUE._col1}\n            1 {VALUE._col0} {VALUE._col1}\n          handleSkewJoin: false\n          outputColumnNames: _col0, _col1, _col4, _col5\n          Filter Operator\n            predicate:\n                expr: (_col1 = _col5)\n                type: boolean\n            File Output Operator\n              compressed: false\n              GlobalTableId: 0\n              table:\n                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat\n                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat\n{noformat}\nJoin happens without join key?  Here, join output is the Cartesian product of a and b on which FilterOperator is applied, Am I right? I see the semantics of inner/outer join on two tables without join condition is to produce Cartesian product. As a side note: \"MySql does not allow outer joins without join condition\". \nIf Join is allowed without join condition to produce Cartesian product of the two tables, then my patch should be changed to consider if join-key is defined for the join or not.  I could reproduce it by simple query \"select * FROM myinput1 a JOIN myinput1 b\". I think the same applies to MapJoin as well. \n\nbq. Verified that SMBMapJoinOperator already filters nulls properly. \nbq. Can you also add one or few tests for sort merge join? \nIt seems my verification was wrong here, I thought if the table is sorted and hive.optimize.bucketmapjoin, hive.optimize.bucketmapjoin.sortedmerge are set to true, MapJoin uses SMBMapJoinOperator. But it was using MapJoinOperator it self. When I created a table with \"sorted by\" column, I see it using SMBMapJoinOperator. Currently if there are any nulls in the input table, SMBJoin fails with NullPointerException:\n{noformat}\nCaused by: java.lang.NullPointerException\n\tat org.apache.hadoop.io.IntWritable.compareTo(IntWritable.java:60)\n\tat org.apache.hadoop.io.WritableComparator.compare(WritableComparator.java:115)\n\tat org.apache.hadoop.hive.ql.exec.SMBMapJoinOperator.compareKeys(SMBMapJoinOperator.java:389)\n\tat org.apache.hadoop.hive.ql.exec.SMBMapJoinOperator.processKey(SMBMapJoinOperator.java:438)\n\tat org.apache.hadoop.hive.ql.exec.SMBMapJoinOperator.processOp(SMBMapJoinOperator.java:205)\n\tat org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:458)\n\tat org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:698)\n\tat org.apache.hadoop.hive.ql.exec.TableScanOperator.processOp(TableScanOperator.java:45)\n\tat org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:458)\n\tat org.apache.hadoop.hive.ql.exec.SMBMapJoinOperator.fetchOneRow(SMBMapJoinOperator.java:479)\n\t... 17 more\n{noformat}\nWill look into this. \n\nbq. For inner, left and right outer joins, a simpler fix would be to add a filter on top. \nNow, I agree it would be simpler :). Will consider this also and see if i can do some special handling for full outer joins.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-17T10:14:40.975+0000","updated":"2010-08-17T10:14:40.975+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12899753","id":"12899753","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"@Amareshwari, sorry the syntax was wrong for the 3 table joins. Below is the correct syntax and plan.\n\n\n{code}\nexplain select * from src a left outer join src b on (a.value=b.value) right outer join src c on (b.value=c.value);\nOK\nABSTRACT SYNTAX TREE:\n  (TOK_QUERY (TOK_FROM (TOK_RIGHTOUTERJOIN (TOK_LEFTOUTERJOIN (TOK_TABREF src a) (TOK_TABREF src b) (= (. (TOK_TABLE_OR_COL a) value) (. (TOK_TABLE_OR_COL b) value))) (TOK_TABREF src c) (= (. (TOK_TABLE_OR_COL b) value) (. (TOK_TABLE_OR_COL c) value)))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR TOK_ALLCOLREF))))\n\nSTAGE DEPENDENCIES:\n  Stage-1 is a root stage\n  Stage-0 is a root stage\n\nSTAGE PLANS:\n  Stage: Stage-1\n    Map Reduce\n      Alias -> Map Operator Tree:\n        a \n          TableScan\n            alias: a\n            Reduce Output Operator\n              key expressions:\n                    expr: value\n                    type: string\n              sort order: +\n              Map-reduce partition columns:\n                    expr: value\n                    type: string\n              tag: 0\n              value expressions:\n                    expr: key\n                    type: string\n                    expr: value\n                    type: string\n        b \n          TableScan\n            alias: b\n            Reduce Output Operator\n              key expressions:\n                    expr: value\n                    type: string\n              sort order: +\n              Map-reduce partition columns:\n                    expr: value\n                    type: string\n              tag: 1\n              value expressions:\n                    expr: key\n                    type: string\n                    expr: value\n                    type: string\n        c \n          TableScan\n            alias: c\n            Reduce Output Operator\n              key expressions:\n                    expr: value\n                    type: string\n              sort order: +\n              Map-reduce partition columns:\n                    expr: value\n                    type: string\n              tag: 2\n              value expressions:\n                    expr: key\n                    type: string\n                    expr: value\n                    type: string\n      Reduce Operator Tree:\n        Join Operator\n          condition map:\n               Left Outer Join0 to 1\n               Right Outer Join1 to 2\n          condition expressions:\n            0 {VALUE._col0} {VALUE._col1}\n            1 {VALUE._col0} {VALUE._col1}\n            2 {VALUE._col0} {VALUE._col1}\n          handleSkewJoin: false\n          outputColumnNames: _col0, _col1, _col4, _col5, _col8, _col9\n          Select Operator\n            expressions:\n                  expr: _col0\n                  type: string\n                  expr: _col1\n                  type: string\n                  expr: _col4\n                  type: string\n                  expr: _col5\n                  type: string\n                  expr: _col8\n                  type: string\n                  expr: _col9\n                  type: string\n            outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5\n            File Output Operator\n              compressed: true\n              GlobalTableId: 0\n              table:\n                  input format: org.apache.hadoop.mapred.TextInputFormat\n                  output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat\n\n  Stage: Stage-0\n    Fetch Operator\n      limit: -1\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-18T06:24:48.406+0000","updated":"2010-08-18T06:24:48.406+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12899794","id":"12899794","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"Attaching patch that fixes the bugs in earlier patch, that Ning has found. Also adds more testcases.\n\nbq. Can you also add one or few tests for sort merge join? \nAttached file smbjoin_nulls.q.txt has tests for sort merge join. But it fails with NPE as mentioned as earlier. I tried to fix the NPE, but could not come up with a fix. Shall I do it on followup jira?\n\nbq. For inner, left and right outer joins, a simpler fix would be to add a filter on top.\nI think this can be done as part of HIVE-1544 as an improvement.\n\nbq. @Amareshwari, sorry the syntax was wrong for the 3 table joins. \nNing, Hive was not complaining about the syntax. So, included this also in the testcase. The results are fine with the latest patch.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-18T09:11:28.572+0000","updated":"2010-08-18T09:11:28.572+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12899795","id":"12899795","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"Submitting patch for the review of patch-741-1.txt ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-18T09:16:10.857+0000","updated":"2010-08-18T09:16:10.857+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12900174","id":"12900174","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"Patch fixes SMBMapJoinOperator also. I modified compareKeys(ArrayList<Object> k1, ArrayList<Object> k2) to do the following:\n{code}\n    if (hasNullElements(k1) && hasNullElements(k2)) {\n      return -1; // just return k1 is smaller than k2\n    } else if (hasNullElements(k1)) {\n      return (0 - k2.size());\n    } else if (hasNullElements(k2)) {\n      return k1.size();\n    }\n   ... //the existing code.\n{code}\n\nDoes the above make sense?\n\nUpdated the testcase with smb join queries. \n\nWhen I'm running smb join on my local machine (pseudo distributed mode), I'm getting different results. I think that is mostly because of HIVE-1561. Will update the issue with my findings.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-19T05:12:28.774+0000","updated":"2010-08-19T05:12:28.774+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12900198","id":"12900198","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"All the tests passed with latest patch : patch-741-2.txt","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-19T07:19:12.325+0000","updated":"2010-08-19T07:19:12.325+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12900570","id":"12900570","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Looks good in general. Some minor comments:\n 1) add more test cases for SMB joins. Currently the only test case has only 1 bucket which does not cover the most common use case. Can you add more test cases for more buckets? You can take a look at bucketed join queries included in the client positive tests.\n 2) SMBMapJoinOperator.compareKey() is called for each row so it is critical for performance. In your code the hasNullElement() could be called 4 times in the worse case. If you cache the result it can be called only twice. \n\nYongqiang, any further comments?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-20T04:19:19.233+0000","updated":"2010-08-20T04:19:19.233+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12900602","id":"12900602","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks Ning for the comments.\n\nPatch incorporates the review comments. Looked at smb_mapjoin* query files and updated smb join queries. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-20T07:24:31.290+0000","updated":"2010-08-20T07:24:31.290+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12900941","id":"12900941","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"The SMB test case still has a minor issue: the tables was created as 2 buckets but there is only 1 file in the tables. This is conflicting to the table schema. If a table is defined as bucketd 2, there should be 2 files in the partition or table. They SMB join takes the 1st file in T1 join the 1st file in T2, and 2nd file in T1 join 2nd file in T2. So the test case should cover this use case. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-21T00:20:33.945+0000","updated":"2010-08-21T00:20:33.945+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12901258","id":"12901258","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"Updated smb input with two files. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-23T04:37:29.634+0000","updated":"2010-08-23T04:37:29.634+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12901275","id":"12901275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Looks good except one mintor thing: SerDeUtils.java:369 should return true? Amareshwari, can you upload a new patch and I'll run unit tests. \n\nYongqiang, can you test this patch on the production SMB join queries?\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-23T06:06:59.417+0000","updated":"2010-08-23T06:06:59.417+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12901280","id":"12901280","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"Updated the patch. Thanks Ning for your help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-23T06:36:13.735+0000","updated":"2010-08-23T06:36:13.735+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12901503","id":"12901503","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"+1. The patch looks good to me. \n(Only have one minor comment on the name of \"hasNullElements\", should we rename it since this function is used to determine all keys are null?)\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-23T17:44:33.416+0000","updated":"2010-08-23T17:44:33.416+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12901508","id":"12901508","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"also about Ning's comments:\n>>2) SMBMapJoinOperator.compareKey() is called for each row so it is critical for performance. In your code the hasNullElement() could be called 4 times in the worse case. If you cache the result it can be called only twice.\nAgree. Not sure how much overhead is there, will try to estimate the overhead over production running. That will be great if you can try to cache the null check results, so that it can only happen one time for each key. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2010-08-23T17:52:38.341+0000","updated":"2010-08-23T17:52:38.341+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12901515","id":"12901515","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Amareshwari, aside from Yongqiang comment, join_null.q's result is not deterministic -- the SMB joins result in different orders. Can you make it deterministic by adding a 'order by' clause at the end of the queries? I'll attach my test run results","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-23T18:05:51.031+0000","updated":"2010-08-23T18:05:51.031+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12901517","id":"12901517","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"uploading test results join_null.q.out which has conflicts with the patch-741-5.txt.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-23T18:07:29.958+0000","updated":"2010-08-23T18:07:29.958+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12901747","id":"12901747","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"Patch with following changes:\n* Renamed the method hasNullElements to hasAllNulls\n* Added keyToHasNullsMap to SMBMapJoinOperator to cache whether key has nulls or not, which is populated when the key elements are computed.\n* Added appropriate \"order by\" clauses to smb join queries in the testcase","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-08-24T06:37:01.780+0000","updated":"2010-08-24T06:37:01.780+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12902004","id":"12902004","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"+1. Will commit if tests pass.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-24T18:28:10.036+0000","updated":"2010-08-24T18:28:10.036+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432589/comment/12902109","id":"12902109","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed. Thanks Amareshwari!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-08-24T22:21:00.604+0000","updated":"2010-08-24T22:21:00.604+0000"}],"maxResults":34,"total":34,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-741/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0lbhz:"}}