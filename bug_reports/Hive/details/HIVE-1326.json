{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12462969","self":"https://issues.apache.org/jira/rest/api/2/issue/12462969","key":"HIVE-1326","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314524","id":"12314524","description":"released","name":"0.6.0","archived":false,"released":true,"releaseDate":"2010-10-29"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-04-26T14:12:10.430+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Dec 21 04:28:02 UTC 2010","customfield_12310420":"72967","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_180165276_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-04-27T22:53:39.870+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-1326/watchers","watchCount":2,"isWatching":false},"created":"2010-04-25T20:50:54.594+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelklatt","name":"michaelklatt","key":"michaelklatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Klatt","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-12-17T00:03:30.240+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"In our production hadoop environment, the \"/tmp/\" is actually pretty small, and we encountered a problem when a query used the RowContainer class and filled up the /tmp/ partition.  I tracked down the cause to the RowContainer class putting temporary files in the '/tmp/' path instead of using the configured Hadoop temporary path.  I've attached a patch to fix this.\n\nHere's the traceback:\n\n2010-04-25 12:05:05,120 INFO org.apache.hadoop.hive.ql.exec.persistence.RowContainer: RowContainer created temp file /tmp/hive-rowcontainer-1244151903/RowContainer7816.tmp\n2010-04-25 12:05:06,326 INFO ExecReducer: ExecReducer: processing 10000000 rows: used memory = 385520312\n2010-04-25 12:05:08,513 INFO ExecReducer: ExecReducer: processing 11000000 rows: used memory = 341780472\n2010-04-25 12:05:10,697 INFO ExecReducer: ExecReducer: processing 12000000 rows: used memory = 301446768\n2010-04-25 12:05:12,837 INFO ExecReducer: ExecReducer: processing 13000000 rows: used memory = 399208768\n2010-04-25 12:05:15,085 INFO ExecReducer: ExecReducer: processing 14000000 rows: used memory = 364507216\n2010-04-25 12:05:17,260 INFO ExecReducer: ExecReducer: processing 15000000 rows: used memory = 332907280\n2010-04-25 12:05:19,580 INFO ExecReducer: ExecReducer: processing 16000000 rows: used memory = 298774096\n2010-04-25 12:05:21,629 INFO ExecReducer: ExecReducer: processing 17000000 rows: used memory = 396505408\n2010-04-25 12:05:23,830 INFO ExecReducer: ExecReducer: processing 18000000 rows: used memory = 362477288\n2010-04-25 12:05:25,914 INFO ExecReducer: ExecReducer: processing 19000000 rows: used memory = 327229744\n2010-04-25 12:05:27,978 INFO ExecReducer: ExecReducer: processing 20000000 rows: used memory = 296051904\n2010-04-25 12:05:28,155 FATAL ExecReducer: org.apache.hadoop.fs.FSError: java.io.IOException: No space left on device\n\tat org.apache.hadoop.fs.RawLocalFileSystem$LocalFSFileOutputStream.write(RawLocalFileSystem.java:199)\n\tat java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)\n\tat java.io.BufferedOutputStream.write(BufferedOutputStream.java:109)\n\tat org.apache.hadoop.fs.FSDataOutputStream$PositionCache.write(FSDataOutputStream.java:49)\n\tat java.io.DataOutputStream.write(DataOutputStream.java:90)\n\tat org.apache.hadoop.fs.ChecksumFileSystem$ChecksumFSOutputSummer.writeChunk(ChecksumFileSystem.java:346)\n\tat org.apache.hadoop.fs.FSOutputSummer.writeChecksumChunk(FSOutputSummer.java:150)\n\tat org.apache.hadoop.fs.FSOutputSummer.flushBuffer(FSOutputSummer.java:132)\n\tat org.apache.hadoop.fs.FSOutputSummer.flushBuffer(FSOutputSummer.java:121)\n\tat org.apache.hadoop.fs.FSOutputSummer.write1(FSOutputSummer.java:112)\n\tat org.apache.hadoop.fs.FSOutputSummer.write(FSOutputSummer.java:86)\n\tat org.apache.hadoop.fs.FSDataOutputStream$PositionCache.write(FSDataOutputStream.java:49)\n\tat java.io.DataOutputStream.write(DataOutputStream.java:90)\n\tat org.apache.hadoop.io.SequenceFile$Writer.append(SequenceFile.java:1013)\n\tat org.apache.hadoop.io.SequenceFile$Writer.append(SequenceFile.java:977)\n\tat org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat$1.write(HiveSequenceFileOutputFormat.java:70)\n\tat org.apache.hadoop.hive.ql.exec.persistence.RowContainer.spillBlock(RowContainer.java:343)\n\tat org.apache.hadoop.hive.ql.exec.persistence.RowContainer.add(RowContainer.java:163)\n\tat org.apache.hadoop.hive.ql.exec.JoinOperator.processOp(JoinOperator.java:118)\n\tat org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:456)\n\tat org.apache.hadoop.hive.ql.exec.ExecReducer.reduce(ExecReducer.java:244)\n\tat org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:436)\n\tat org.apache.hadoop.mapred.Child.main(Child.java:158)\nCaused by: java.io.IOException: No space left on device\n\tat java.io.FileOutputStream.writeBytes(Native Method)\n\tat java.io.FileOutputStream.write(FileOutputStream.java:260)\n\tat org.apache.hadoop.fs.RawLocalFileSystem$LocalFSFileOutputStream.write(RawLocalFileSystem.java:197)\n\t... 22 more\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12442971","id":"12442971","filename":"rowcontainer_v2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelklatt","name":"michaelklatt","key":"michaelklatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Klatt","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-27T16:44:10.625+0000","size":776,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12442971/rowcontainer_v2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12442794","id":"12442794","filename":"rowcontainer.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelklatt","name":"michaelklatt","key":"michaelklatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Klatt","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-25T20:52:44.178+0000","size":1035,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12442794/rowcontainer.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"123008","customfield_12312823":null,"summary":"RowContainer uses hard-coded '/tmp/' path for temporary files","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelklatt","name":"michaelklatt","key":"michaelklatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Klatt","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelklatt","name":"michaelklatt","key":"michaelklatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Klatt","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Hadoop 0.19.2 with Hive trunk.  We're using FreeBSD 7.0, but that doesn't seem relevant.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462969/comment/12860929","id":"12860929","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=appodictic","name":"appodictic","key":"appodictic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Capriolo","active":true,"timeZone":"Etc/UTC"},"body":"I am +1 on the concept.   Many times /tmp can be a ramdisk or mounted with some size restrictions. This type of bug an be very painful to track down when it happens.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=appodictic","name":"appodictic","key":"appodictic","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Edward Capriolo","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-26T14:12:10.430+0000","updated":"2010-04-26T14:12:10.430+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462969/comment/12861054","id":"12861054","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"The general idea of why we put temp files and directories under /tmp is two fold:\n 1) it allows easy clean up in case of any unexpected interruptions to the JVM. In the regular exits, these temp files/directories should be removed by JVM by deleteOnExit(), but if the JVM was killed/interrupted unexpected, these temp files could eventually take up all disk spaces and make the whole cluster hard to recover (imagine finding these temp files in thousands of machines). By putting it in /tmp, all these will be automatically removed whenever the machine is restarted, or cleaned up manually by just removing all files in /tmp. That's much easier in terms of Hadoop administration. \n 2) /tmp seems to be a universally writable mounted point on all unix-based systems. So it should be a safe place to put the temporary files. But I agree that it would a good idea to introduce a new Hive parameter to let the user choose a customizable tmp directory, which should address Edward's point. \n \nI think we use File.createTempFile() previously and Yongqiang added another directory structure (parentFile). I think we can use File.createTempFile to create this directory as well (Yongqiang, please correct me if I'm wrong), there there are several questions about the patch:\n\n1) File.createTempFile() will by default create temp files in java.io.tmpdir (/tmp or /var/tmp) according to JDK. I suspect most of the case JVM on Linux will use /tmp as the java.io.tmpdir, so in that caes your change won't achieve your purpose in most cases. \n2) the random number generator is not needed if you can use File.createTempFile to create parentFile, because File.createTempFile guarantees its uniqueness for this JVM. The only case you need to prevent is the collision between different JVMs. This is why there is a check for parentFile.mkdir(). It actually acts like a write lock to the directory so that other JVM won't overwrite it. So parentFile.delete() should not be added because it may delete the directory created by another JVM who is still running.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-04-26T19:08:31.053+0000","updated":"2010-04-26T19:08:31.053+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462969/comment/12861080","id":"12861080","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelklatt","name":"michaelklatt","key":"michaelklatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Klatt","active":true,"timeZone":"Etc/UTC"},"body":"\nIn my brief experiments, I found that File.createTempFile() used the work/tmp path for the individual task (in Hadoop).  I suspect that the java.io.tmpdir is being set by the TaskTracker.  This has the advantage of letting Hadoop do the temporary file cleanup when the task cleanup happens.  I think it would be great if this was the default behavior, but admins could override that with a hive specific parameter.\n\nI don't have any attachment to the actual implementation.  I can spend more time to produce a different patch if needed, but I suspected someone would want to implement it differently.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelklatt","name":"michaelklatt","key":"michaelklatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Klatt","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-26T20:17:49.623+0000","updated":"2010-04-26T20:17:49.623+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462969/comment/12861188","id":"12861188","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"I guess this is due to https://issues.apache.org/jira/browse/HADOOP-2735 which set java.io.tmpdir to be dependent on mapred.tmp.dir. In that case the change of using createTempFile looks fine with me. Also can you remove the parentFile.delete() in your patch? If we set java.io.tmpdir to work/tmp then we don't have file name conflicts, But if the user choose to use shared /tmp then it may remove files created by other tasks. \n\nYongqiang, any further comments?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-04-27T00:38:06.973+0000","updated":"2010-04-27T00:38:06.973+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462969/comment/12861370","id":"12861370","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"body":"Agreed with Ning, looks fine to me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=he+yongqiang","name":"he yongqiang","key":"he yongqiang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"He Yongqiang","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-27T11:24:46.306+0000","updated":"2010-04-27T11:24:46.306+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462969/comment/12861444","id":"12861444","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelklatt","name":"michaelklatt","key":"michaelklatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Klatt","active":true,"timeZone":"Etc/UTC"},"body":"\nThe reason the parentFile.delete() call is there is because the File.createTempFile method actually creates a file. The code, as it currently is, creates a temporary directory to hold the rowcontainer file and I made the smallest change possible to continue to support this behavior.\n\nLooking at the code, it appears that the createTempFile mechanism is used several lines down to actually create the temporary file (within the new temporary directory). I'm not sure why a temporary directory is created first, but I'll submit a new patch which doesn't try to create a temporary directory at all.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelklatt","name":"michaelklatt","key":"michaelklatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Klatt","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-27T16:16:06.376+0000","updated":"2010-04-27T16:16:06.376+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462969/comment/12861449","id":"12861449","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelklatt","name":"michaelklatt","key":"michaelklatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Klatt","active":true,"timeZone":"Etc/UTC"},"body":"\nHmm, on second thought, the parentFile (directory) is referenced in several places.  I'm not familiar enough with Hive to know what these lines do:\n\n          HiveConf.setVar(jobCloneUsingLocalFs,\n              HiveConf.ConfVars.HADOOPMAPREDINPUTDIR,\n              org.apache.hadoop.util.StringUtils.escapeString(parentFile\n              .getAbsolutePath()));\n\nIf it weren't for these lines I could remove the parentFile variable all together.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelklatt","name":"michaelklatt","key":"michaelklatt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Klatt","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-27T16:43:52.685+0000","updated":"2010-04-27T16:43:52.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462969/comment/12861467","id":"12861467","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Michael, the temporary directory is needed for a conditional task to handle skewed joins (that's why the JobConf is cloned but with a different path). The idea here is that whenever there many too many rows for a particular job key to be held in memory, they will be first write to local disk via RowContainer. If there are still too many rows to local disk, they will be write to a DFS location and a contitional task will be triggered to handle this skewed key. So if we create a temp directory in local disk and let all mappers write their temp files in that directory, then later when we want to move the data to HDFS, we just move the whole directory instead of moving individual files.\n\n+1 on v2. Will commit if tests pass. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-04-27T17:42:06.044+0000","updated":"2010-04-27T17:42:06.044+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462969/comment/12861608","id":"12861608","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed. Thanks Michael!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nzhang","name":"nzhang","key":"nzhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ning Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-04-27T22:53:39.837+0000","updated":"2010-04-27T22:53:39.837+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462969/comment/12973466","id":"12973466","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hammer","name":"hammer","key":"hammer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hammerbacher","active":true,"timeZone":"Etc/UTC"},"body":"Hey,\n\nCould a Hive committer assign this issue to Michael in order to keep the JIRA metadata up to date?\n\nThanks,\nJeff","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hammer","name":"hammer","key":"hammer","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hammerbacher","active":true,"timeZone":"Etc/UTC"},"created":"2010-12-21T04:28:02.065+0000","updated":"2010-12-21T04:28:02.065+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-1326/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0lejz:"}}