{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12927160","self":"https://issues.apache.org/jira/rest/api/2/issue/12927160","key":"HIVE-12774","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-01-05T04:23:06.144+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jan 05 22:40:57 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-12774/watchers","watchCount":2,"isWatching":false},"created":"2016-01-05T02:13:37.296+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332154","id":"12332154","description":"","name":"1.3.0","archived":false,"released":false}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-01-05T22:40:57.917+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12321300","id":"12321300","name":"Vectorization","description":"Vectorized query execution"}],"timeoriginalestimate":null,"description":"A query against a table with no data in partition X fails under vectorization.\n\nTable:\n{code}\nuse default;\ndrop table if exists test;\nCREATE TABLE default.test(\n  district_id bigint, \n  user_type string,\n  7d int)\nPARTITIONED BY\n  (partition_date string)\nROW FORMAT SERDE \n  'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe' \nSTORED AS INPUTFORMAT \n  'org.apache.hadoop.mapred.TextInputFormat' \nOUTPUTFORMAT \n  'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'\n{code}\n\nQuery:\n{code}\nset hive.vectorized.execution.enabled = true;\nselect partition_date, sum(teachers_7d)\nfrom\n(\nselect distinct ad1.partition_date, ad1.district_id, ad1.7d teachers_7d\nfrom default.test ad1\nleft join default.test ad2 on ad1.district_id = ad2.district_id and ad2.user_type = 'STUDENT' \nand ad2.partition_date = '2015-12-20'\nwhere ad1.user_type = 'TEACHER'\nand ad1.partition_date = '2015-12-20'\n) a\ngroup by partition_date\n;\n{code}\nThis will elicit a task that fails:\n{code}\nDiagnostic Messages for this Task:\nError: java.lang.RuntimeException: Error in configuring object\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:109)\n\tat org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:75)\n\tat org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:133)\n\tat org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:449)\n\tat org.apache.hadoop.mapred.MapTask.run(MapTask.java:343)\n\tat org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:163)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1671)\n\tat org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:106)\n\t... 9 more\nCaused by: java.lang.RuntimeException: Error in configuring object\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:109)\n\tat org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:75)\n\tat org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:133)\n\tat org.apache.hadoop.mapred.MapRunner.configure(MapRunner.java:38)\n\t... 14 more\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:106)\n\t... 17 more\nCaused by: java.lang.RuntimeException: Map operator initialization failed\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecMapper.configure(ExecMapper.java:147)\n\t... 22 more\nCaused by: java.lang.ClassCastException: org.apache.hadoop.hive.serde2.lazy.objectinspector.primitive.LazyLongObjectInspector cannot be cast to org.apache.hadoop.hive.serde2.objectinspector.primitive.SettableLongObjectInspector\n\tat org.apache.hadoop.hive.ql.exec.vector.expressions.VectorExpressionWriterFactory.genVectorExpressionWritable(VectorExpressionWriterFactory.java:410)\n\tat org.apache.hadoop.hive.ql.exec.vector.expressions.VectorExpressionWriterFactory.processVectorInspector(VectorExpressionWriterFactory.java:1102)\n\tat org.apache.hadoop.hive.ql.exec.vector.VectorReduceSinkOperator.initializeOp(VectorReduceSinkOperator.java:55)\n\tat org.apache.hadoop.hive.ql.exec.Operator.initialize(Operator.java:385)\n\tat org.apache.hadoop.hive.ql.exec.Operator.initialize(Operator.java:469)\n\tat org.apache.hadoop.hive.ql.exec.Operator.initializeChildren(Operator.java:425)\n\tat org.apache.hadoop.hive.ql.exec.vector.VectorFilterOperator.initializeOp(VectorFilterOperator.java:77)\n\tat org.apache.hadoop.hive.ql.exec.Operator.initialize(Operator.java:385)\n\tat org.apache.hadoop.hive.ql.exec.Operator.initialize(Operator.java:469)\n\tat org.apache.hadoop.hive.ql.exec.Operator.initializeChildren(Operator.java:425)\n\tat org.apache.hadoop.hive.ql.exec.TableScanOperator.initializeOp(TableScanOperator.java:193)\n\tat org.apache.hadoop.hive.ql.exec.Operator.initialize(Operator.java:385)\n\tat org.apache.hadoop.hive.ql.exec.MapOperator.initializeOp(MapOperator.java:431)\n\tat org.apache.hadoop.hive.ql.exec.Operator.initialize(Operator.java:385)\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecMapper.configure(ExecMapper.java:126)\n\t... 22 more\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Vectorization problem with empty partition","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lancenorskog","name":"lancenorskog","key":"lancenorskog","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lance Norskog","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lancenorskog","name":"lancenorskog","key":"lancenorskog","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lance Norskog","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12927160/comment/15082231","id":"15082231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lancenorskog","name":"lancenorskog","key":"lancenorskog","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lance Norskog","active":true,"timeZone":"Etc/UTC"},"body":"This is probably not the same bug as [HIVE-10308]. I'm using Cloudera Hadoop 5.5 and don't know if [HIVE-10308] has been applied to my binary.\n\nHowever, the final stack trace is the same. This bug may require a fix similar to [HIVE-10308]. I'm not up to speed on Hive internals and cannot contribute a fix or a unit test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lancenorskog","name":"lancenorskog","key":"lancenorskog","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lance Norskog","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-05T02:16:20.108+0000","updated":"2016-01-05T02:16:20.108+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12927160/comment/15082238","id":"15082238","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lancenorskog","name":"lancenorskog","key":"lancenorskog","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lance Norskog","active":true,"timeZone":"Etc/UTC"},"body":"This bug surfaced immediately after we switched from MapReduce v1 to YARN. However, post hoc does not mean propter hoc.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lancenorskog","name":"lancenorskog","key":"lancenorskog","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lance Norskog","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-05T02:21:16.491+0000","updated":"2016-01-05T02:21:16.491+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12927160/comment/15082342","id":"15082342","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gopalv","name":"gopalv","key":"gopalv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gopal V","active":true,"timeZone":"Asia/Kolkata"},"body":"Can't really figure out why it would try to vectorize a TextInputFormat file (LazySimpleSerDe isn't vectorized, yet).\n\nif the vectorizer is working correctly, this query should not contain a VectorFilterOperator at all.\n\nBut I'm guessing that it does generate a vectorized operator tree because it has no rows at all (NullInputFormat).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gopalv","name":"gopalv","key":"gopalv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gopal V","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-01-05T04:23:06.144+0000","updated":"2016-01-05T04:23:06.144+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12927160/comment/15083973","id":"15083973","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lancenorskog","name":"lancenorskog","key":"lancenorskog","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lance Norskog","active":true,"timeZone":"Etc/UTC"},"body":"If you simplify the example by removing the group by/SUM aspect, or by removing the partition, or by putting data in the table, the problem does not occur.\nIt seems to need all of these complications in order to trigger the bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lancenorskog","name":"lancenorskog","key":"lancenorskog","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lance Norskog","active":true,"timeZone":"Etc/UTC"},"created":"2016-01-05T22:40:57.917+0000","updated":"2016-01-05T22:40:57.917+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-12774/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2qsb3:"}}