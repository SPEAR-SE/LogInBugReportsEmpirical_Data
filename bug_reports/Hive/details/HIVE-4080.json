{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12634348","self":"https://issues.apache.org/jira/rest/api/2/issue/12634348","key":"HIVE-4080","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323587","id":"12323587","description":"Hive 0.11.0","name":"0.11.0","archived":false,"released":true,"releaseDate":"2013-05-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-02-27T05:58:12.075+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Feb 28 18:21:15 UTC 2013","customfield_12310420":"314841","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_139831911_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-02-28T18:21:15.838+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4080/watchers","watchCount":5,"isWatching":false},"created":"2013-02-27T03:30:43.963+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12364913","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12364913","type":{"id":"12310040","name":"Required","inward":"is required by","outward":"requires","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310040"},"inwardIssue":{"id":"12438744","key":"HIVE-896","self":"https://issues.apache.org/jira/rest/api/2/issue/12438744","fields":{"summary":"Add LEAD/LAG/FIRST/LAST analytical windowing functions to Hive.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-16T21:10:58.920+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320378","id":"12320378","name":"PTF-Windowing","description":"Partitioned Table Functions & Windowing"}],"timeoriginalestimate":null,"description":"Currently we support Lead/Lag as navigation UDFs usable with Windowing.\nTo be standard compliant we need to support Lead & Lag UDAFs.\nWill continue to support Lead/Lag UDFs as arguments to UDAFs when Windowing is in play. \nCurrently allow Lead/Lag expressions to appear in SelectLists even when they are not arguments to UDAFs. Support for this feature will probably be removed. Causes ambiguities when Query contains different partition clauses. Will provide more details with associated Jira to remove this feature.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12571143","id":"12571143","filename":"HIVE-4080.1.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-27T05:55:15.040+0000","size":29648,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12571143/HIVE-4080.1.patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12571145","id":"12571145","filename":"HIVE-4080.D8961.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-27T05:58:12.140+0000","size":29127,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12571145/HIVE-4080.D8961.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12571311","id":"12571311","filename":"HIVE-4080.D8961.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-27T23:55:11.306+0000","size":30472,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12571311/HIVE-4080.D8961.2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12571379","id":"12571379","filename":"HIVE-4080.D8961.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-28T08:33:14.498+0000","size":34855,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12571379/HIVE-4080.D8961.3.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"315185","customfield_12312823":null,"summary":"Add Lead & Lag UDAFs","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634348/comment/13588039","id":"13588039","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"hbutani requested code review of \"HIVE-4080 [jira] Add Lead & Lag UDAFs\".\n\nReviewers: JIRA\n\nadd Lead and Lag UDAFs\n\nCurrently we support Lead/Lag as navigation UDFs usable with Windowing.\nTo be standard compliant we need to support Lead & Lag UDAFs.\nWill continue to support Lead/Lag UDFs as arguments to UDAFs when Windowing is in play.\nCurrently allow Lead/Lag expressions to appear in SelectLists even when they are not arguments to UDAFs. Support for this feature will probably be removed. Causes ambiguities when Query contains different partition clauses. Will provide more details with associated Jira to remove this feature.\n\nTEST PLAN\n  EMPTY\n\nREVISION DETAIL\n  https://reviews.facebook.net/D8961\n\nAFFECTED FILES\n  ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java\n  ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDAFLag.java\n  ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDAFLead.java\n  ql/src/test/queries/clientpositive/leadlag_queries.q\n  ql/src/test/results/clientpositive/leadlag_queries.q.out\n\nMANAGE HERALD RULES\n  https://reviews.facebook.net/herald/view/differential/\n\nWHY DID I GET THIS EMAIL?\n  https://reviews.facebook.net/herald/transcript/21705/\n\nTo: JIRA, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-27T05:58:12.075+0000","updated":"2013-02-27T05:58:12.075+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634348/comment/13588041","id":"13588041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"body":"patch attached","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-27T05:59:34.863+0000","updated":"2013-02-27T05:59:34.863+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634348/comment/13588116","id":"13588116","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"bq.  Support for this feature will probably be removed. Causes ambiguities when Query contains different partition clauses. \nDo you mean feature which this patch is introducing (ability to have lead function independent of UDAFs in select expr) will be removed? Consider following query:\n{noformat}\n select p_mfgr, p_retailprice,\nlead(p_retailprice,1) as l1 over (partition by p_mfgr order by p_name),\nlead(p_retailprice,1, p_retailprice) as l2 over (partition by p_size order by p_name),\np_retailprice - lead(p_retailprice,1) \nfrom part;\n{noformat}\nMy guess is ambiguity you are referring to is once we start supporting different partitioning in same query than last lead() in above query becomes ambiguous as to which partitioning function it is refering to. But my understanding is sql standard says that lead and lag function must always be associated with over clause. So, above query is illegal in standard sql. It must be written as:\n{noformat}\n select p_mfgr, p_retailprice,\nlead(p_retailprice,1) as l1 over (partition by p_mfgr order by p_name),\nlead(p_retailprice,1, p_retailprice) as l2 over (partition by p_size order by p_name),\np_retailprice - lead(p_retailprice,1)as l3 over (partition by p_size order by p_name) \nfrom part;\n{noformat} \nNow we have this concept of default partitioning which would have made first query legal if partitioning scheme was identical for l1 and l2. I think long term:\n* We should keep functionality introduced in this patch to stay compliant.\n* Associate default partitioning with windowing function only if there is no ambiguity (i.e., there is only one partitioning clause in query).\n* Raise error if user doesn't specify partitioning and there are more than one partitioning scheme to choose from.\nSame argument stands for when lead/lag functions are used as arguments with UDAFs. Make sense ?\n\nFurther, I think this concept of default partitioning is only extra convenience we are offering to hive users which is non-standard. If it turns out its burdensome to support this I am fine with removing it and always requiring user to specify over clause.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-27T08:21:48.762+0000","updated":"2013-02-27T08:21:48.762+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634348/comment/13588515","id":"13588515","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"ashutoshc has requested changes to the revision \"HIVE-4080 [jira] Add Lead & Lag UDAFs\".\n\n  Some comments.\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java:533 Use LEAD_FUNC_NAME and LAG_FUNC_NAME here to be consistent.\n  ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java:871 This null check should be done outside of nesting if() block.\n  ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java:875 I don't see a case where fInfo is != null but udafResolver could be. If so, than this null check is redundant and should be removed.\n  ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java:890 We are already know that we are dealing with lead/lag udaf, it must be of type GenericUDAFResolver2.. no ?\n  ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java:866 I am wondering if this function can be rewritten as following:\n\n  WindowFunctionInfo finfo = windowFunctions.get(name.toLowerCase());\n  if (finfo == null) { return null;}\n  f ( !name.toLowerCase().equals(LEAD_FUNC_NAME) &&\n          !name.toLowerCase().equals(LAG_FUNC_NAME) ) {\n  return getGenericUDAFEvaluator(name, argumentOIs, isDistinct, isAllColumns);\n  }\n\n  // this must be lead/lag UDAF\n  GenericUDAFResolver udafResolver = finfo.getfInfo().getGenericUDAFResolver();\n  GenericUDAFParameterInfo paramInfo = new SimpleGenericUDAFParameterInfo(\n   argumentOIs.toArray(), isDistinct, isAllColumns);\n  return  ((GenericUDAFResolver2) udafResolver).getEvaluator(paramInfo);\n\n  If not, than I have specific questions. See next few comments.\n  ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java:1467 It will be good to comments for this new boolean registerAsUDAF. Something like following\n  There are certain UDAFs like lead/lag which we want as windowing functions, but don't want them to appear in mFunctions.\n  Why?\n  Because....\n  ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDAFLag.java:29 This and GenericUDAFLead share lots of common code. It might be good to have an abstract class for these two, just the way you have it in GenericUDFLeadLag.\n  ql/src/test/queries/clientpositive/leadlag_queries.q:20 I think currently we don't support over clause on expressions. Once we do, it will be good to add test like:\n  select p_retailprice - lead (p_retail) over (partition by p_mfgr) from part;\n  ql/src/test/queries/clientpositive/leadlag_queries.q:35 It will be good to add a test which has both lead and lag in same query.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D8961\n\nBRANCH\n  HIVE-4080\n\nARCANIST PROJECT\n  hive\n\nTo: JIRA, ashutoshc, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-27T17:01:12.232+0000","updated":"2013-02-27T17:01:12.232+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634348/comment/13588560","id":"13588560","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"body":"Yes, there are several related issues:\n\n1. Lead/Lag as UDAFs\n- this jira only addresses this\n- will work on your comments.\n\n2. Support expressions with over clause\n- filed JIRA 4081 for this\n- will work on this next\n\n3. Support for lead/lag UDFs. Based on our offline conversation and as you point out here the options are:\n- should we continue to support\n- should we completely remove support?\n- support lead/lag as UDFs, but only within argument expressions of other UDAFs.\nThe consensus seems to be option 3 is nice to have; 1 is problematic. \nWill address this in a separate JIRA\n\n4. The notion of default partitions\n- you have given more proof, why supporting lead/lag as UDFs generally (option 1) is problematic.\n- in general, should we continue to support this?\n- Your approach, makes sense\nWill address this in separate JIRA.\n\nDoes this break down of issues make sense? Will address the first 3 asap; and then work on supporting multiple partitions(4041). The 4th one will have to wait a bit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhbutani","name":"rhbutani","key":"rhbutani","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Harish Butani","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-27T17:55:15.082+0000","updated":"2013-02-27T17:55:15.082+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634348/comment/13588612","id":"13588612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"hbutani has commented on the revision \"HIVE-4080 [jira] Add Lead & Lag UDAFs\".\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java:866 Yes, i wanted to introduce a new fn to take a GenericUDAFResolver: public static GenericUDAFEvaluator getGenericUDAFEvaluator(GenericUDAFResolver,\n        List<ObjectInspector> argumentOIs, boolean isDistinct,\n        boolean isAllColumns)\n\n  and have the current getGenericUDAFEvaluator and getGenericWindowingEvaluator call it.\n\n  But backed out, because was not comfortable making this change and submitting the patch w/o running the entire test suite.\n\n  Ended up just doing a cut and paste. Your soln is much better\n  ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java:1467 Yes, meant to do this. Somehow forgot, sorry\n  ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDAFLag.java:29 yes, i was rushing this...\n  should refactor it.\n  ql/src/test/queries/clientpositive/leadlag_queries.q:20 yes exactly\n  ql/src/test/queries/clientpositive/leadlag_queries.q:35 will add\n\nREVISION DETAIL\n  https://reviews.facebook.net/D8961\n\nBRANCH\n  HIVE-4080\n\nARCANIST PROJECT\n  hive\n\nTo: JIRA, ashutoshc, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-27T18:43:12.124+0000","updated":"2013-02-27T18:43:12.124+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634348/comment/13588934","id":"13588934","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"hbutani updated the revision \"HIVE-4080 [jira] Add Lead & Lag UDAFs\".\n\n    - add Lead and Lag UDAFs, fix issues specified in review\n\nReviewers: ashutoshc, JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D8961\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D8961?vs=28749&id=28803#toc\n\nAFFECTED FILES\n  ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java\n  ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDAFLag.java\n  ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDAFLead.java\n  ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDAFLeadLag.java\n  ql/src/test/queries/clientpositive/leadlag_queries.q\n  ql/src/test/results/clientpositive/leadlag_queries.q.out\n\nTo: JIRA, ashutoshc, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-27T23:55:11.214+0000","updated":"2013-02-27T23:55:11.214+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634348/comment/13589076","id":"13589076","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"ashutoshc has requested changes to the revision \"HIVE-4080 [jira] Add Lead & Lag UDAFs\".\n\n  Mostly looks good.\n  * Missing apache headers.\n  * Request for couple more tests.\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDAFLead.java:1 Apache headers are missing.\n  ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDAFLeadLag.java:1 Apache headers missing.\n  ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDAFLag.java:1 Apache headers missing.\n  ql/src/test/queries/clientpositive/leadlag_queries.q:19 So, lead/lag can now take three params. First one is column, second one is offset, third is default value. Correct?\n  It will be good to have a test case with a constant default like lag (price,5,10) and one with implicit params like lag (price) which implies default of offset = 1 and NULL for default.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D8961\n\nBRANCH\n  HIVE-4080\n\nARCANIST PROJECT\n  hive\n\nTo: JIRA, ashutoshc, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-28T02:17:11.783+0000","updated":"2013-02-28T02:17:11.783+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634348/comment/13589345","id":"13589345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"hbutani updated the revision \"HIVE-4080 [jira] Add Lead & Lag UDAFs\".\n\n    - add Lead and Lag UDAFs, fix issues specified in review\n\nReviewers: ashutoshc, JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D8961\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D8961?vs=28803&id=28833#toc\n\nAFFECTED FILES\n  ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java\n  ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDAFLag.java\n  ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDAFLead.java\n  ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDAFLeadLag.java\n  ql/src/test/queries/clientpositive/leadlag_queries.q\n  ql/src/test/results/clientpositive/leadlag_queries.q.out\n\nTo: JIRA, ashutoshc, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-28T08:33:14.399+0000","updated":"2013-02-28T08:33:14.399+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634348/comment/13589612","id":"13589612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"ashutoshc has accepted the revision \"HIVE-4080 [jira] Add Lead & Lag UDAFs\".\n\n  +1\n\nREVISION DETAIL\n  https://reviews.facebook.net/D8961\n\nBRANCH\n  HIVE-4080\n\nARCANIST PROJECT\n  hive\n\nTo: JIRA, ashutoshc, hbutani\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-28T15:43:11.181+0000","updated":"2013-02-28T15:43:11.181+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634348/comment/13589749","id":"13589749","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to branch. Thanks, Harish!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-28T18:21:15.864+0000","updated":"2013-02-28T18:21:15.864+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4080/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1ibvz:"}}