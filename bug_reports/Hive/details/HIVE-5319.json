{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12669431","self":"https://issues.apache.org/jira/rest/api/2/issue/12669431","key":"HIVE-5319","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Sep 19 10:35:20 UTC 2013","customfield_12310420":"349363","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5319/watchers","watchCount":5,"isWatching":false},"created":"2013-09-19T10:32:06.654+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["avro"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323587","id":"12323587","description":"Hive 0.11.0","name":"0.11.0","archived":false,"released":true,"releaseDate":"2013-05-15"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-09-19T10:35:20.903+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"1 >> Created a table in Hive with AVRO data.\n\tCREATE EXTERNAL TABLE tweets (username string, tweet string, timestamp bigint)\n    COMMENT 'A table backed by Avro data with the Avro schema stored in HDFS'\n    ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.avro.AvroSerDe'\n    STORED AS\n    INPUTFORMAT  'org.apache.hadoop.hive.ql.io.avro.AvroContainerInputFormat'\n    OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.avro.AvroContainerOutputFormat'\n    LOCATION '/home/neha/test_data/avro_create_data'\n    TBLPROPERTIES ('avro.schema.literal'='{\"namespace\":\"com.miguno.avro\",\"name\":\"Tweet\",\"type\":\"record\",\"fields\":[ {\"name\" : \"username\",\"type\" : \"string\",\"doc\" : \"Name of the user account on Twitter.com\"},{\"name\" : \"tweet\",\"type\":\"string\",\"doc\" : \"The content of the Twitter message\"}, {\"name\" : \"timestamp\", \"type\" : \"long\", \"doc\" : \"Unix epoch time in seconds\"}]}');\n\n2 >> Altered type of a column (to a compatible type) using ALTER TABLE. In this example, altered type for column \"timestamp\" from \"long\" to \"int\".\n\n\tALTER TABLE tweets SET TBLPROPERTIES ('avro.schema.literal'='{\"namespace\":\"com.miguno.avro\",\"name\":\"Tweet\",\"type\":\"record\",\"fields\":[ {\"name\" : \"username\",\"type\" : \"string\",\"doc\" : \"Name of the user account on Twitter.com\"},{\"name\" : \"tweet\",\"type\":\"string\",\"doc\" : \"The content of the Twitter message\"}, {\"name\" : \"timestamp\", \"type\" : \"int\", \"doc\" : \"Unix epoch time in seconds\"}]}');\n\n3 >> Now, a select query on this table fails with following error.\n\nhive> select * from tweets;\nOK\nFailed with exception java.io.IOException:org.apache.avro.AvroTypeException: Found \"long\", expecting \"int\"\nTime taken: 4.514 seconds\n\n\n\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"349661","customfield_12312823":null,"summary":"Executing SELECT on an AVRO table fails after executing ALTER to modify type of an existing column","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=neha_tomar","name":"neha_tomar","key":"neha_tomar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Neha Tomar","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=neha_tomar","name":"neha_tomar","key":"neha_tomar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Neha Tomar","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Linux Ubuntu","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12669431/comment/13771780","id":"13771780","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=neha_tomar","name":"neha_tomar","key":"neha_tomar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Neha Tomar","active":true,"timeZone":"Asia/Kolkata"},"body":"Pasting the exception trace below.\n\nFailed with exception java.io.IOException:org.apache.avro.AvroTypeException: Found \"long\", expecting \"int\"\n13/09/19 16:03:46 ERROR CliDriver: Failed with exception java.io.IOException:org.apache.avro.AvroTypeException: Found \"long\", expecting \"int\"\njava.io.IOException: org.apache.avro.AvroTypeException: Found \"long\", expecting \"int\"\n\tat org.apache.hadoop.hive.ql.exec.FetchOperator.getNextRow(FetchOperator.java:544)\n\tat org.apache.hadoop.hive.ql.exec.FetchOperator.pushRow(FetchOperator.java:488)\n\tat org.apache.hadoop.hive.ql.exec.FetchTask.fetch(FetchTask.java:136)\n\tat org.apache.hadoop.hive.ql.Driver.getResults(Driver.java:1412)\n\tat org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:271)\n\tat org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:216)\n\tat org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:413)\n\tat org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:756)\n\tat org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:614)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)\n\tat java.lang.reflect.Method.invoke(Method.java:611)\n\tat org.apache.hadoop.util.RunJar.main(RunJar.java:212)\nCaused by: org.apache.avro.AvroTypeException: Found \"long\", expecting \"int\"\n\tat org.apache.avro.io.ResolvingDecoder.doAction(ResolvingDecoder.java:231)\n\tat org.apache.avro.io.parsing.Parser.advance(Parser.java:88)\n\tat org.apache.avro.io.ValidatingDecoder.readInt(ValidatingDecoder.java:82)\n\tat org.apache.avro.generic.GenericDatumReader.readInt(GenericDatumReader.java:341)\n\tat org.apache.avro.generic.GenericDatumReader.read(GenericDatumReader.java:146)\n\tat org.apache.avro.generic.GenericDatumReader.readRecord(GenericDatumReader.java:166)\n\tat org.apache.avro.generic.GenericDatumReader.read(GenericDatumReader.java:138)\n\tat org.apache.avro.generic.GenericDatumReader.read(GenericDatumReader.java:129)\n\tat org.apache.avro.file.DataFileStream.next(DataFileStream.java:233)\n\tat org.apache.avro.file.DataFileStream.next(DataFileStream.java:220)\n\tat org.apache.hadoop.hive.ql.io.avro.AvroGenericRecordReader.next(AvroGenericRecordReader.java:140)\n\tat org.apache.hadoop.hive.ql.io.avro.AvroGenericRecordReader.next(AvroGenericRecordReader.java:49)\n\tat org.apache.hadoop.hive.ql.exec.FetchOperator.getNextRow(FetchOperator.java:514)\n\t... 13 more\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=neha_tomar","name":"neha_tomar","key":"neha_tomar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Neha Tomar","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-09-19T10:35:20.903+0000","updated":"2013-09-19T10:35:20.903+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5319/votes","votes":3,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1o8nj:"}}