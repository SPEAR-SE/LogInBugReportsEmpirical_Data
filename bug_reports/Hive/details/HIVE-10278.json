{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12819609","self":"https://issues.apache.org/jira/rest/api/2/issue/12819609","key":"HIVE-10278","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"2015-04-09 08:54:17.003","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-10278/watchers","watchCount":3,"isWatching":false},"created":"2015-04-09T08:54:17.003+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":["performance"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329278","id":"12329278","description":"Branch 1.0 release","name":"1.0.0","archived":false,"released":true,"releaseDate":"2015-02-04"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-04-15T08:03:25.073+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320633","id":"12320633","name":"File Formats","description":"File Formats"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12325007","id":"12325007","name":"Hive"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12323401","id":"12323401","name":"Physical Optimizer","description":"Optimizations which are dependent on runtime"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12324798","id":"12324798","name":"Query Planning"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."},{"self":"https://issues.apache.org/jira/rest/api/2/component/12317305","id":"12317305","name":"Types","description":"Issues related to Hive Query Languages type system"}],"timeoriginalestimate":null,"description":"Selection from table stored in Parquet format with structures does not uses projections as per Parquet specification. This means that reading just one item from structure results in reading the whole structure. It was found by following test:\n\nTwo tables (one flat one with structures) were created as follows:\n\ndrop table if exists test_flat;\ncreate table test_flat\n  (urlurl string,\n   urlvalid boolean,\n   urlhost string,\n   urldomain string,\n   urlsubdomain string,\n   urlprotocol string,\n   urlsuffix string,\n   urlmiddomain string,   \n   refererurl string,\n   referervalid boolean,\n   refererhost string,\n   refererdomain string,\n   referersubdomain string,\n   refererprotocol string,\n   referersuffix string,\n   referermiddomain string)\nstored as parquet\n; \n\ndrop table if exists test_struct;\ncreate table test_struct\n  (url struct<url:string, valid:boolean, host:string, domain:string, subdomain:string, protocol:string, suffix:string, middomain:string>,\n   referer struct<url:string, valid:boolean, host:string, domain:string, subdomain:string, protocol:string, suffix:string, middomain:string>)\nstored as parquet; \n\nSize of these tables is:\n\n[havlik@ams07-015 ~]$ hdfs dfs -du -s -h /results/havlik/new_calibration/test_flat/\n820.4 G  1.6 T  /results/havlik/new_calibration/test_flat\n\n[havlik@ams07-015 ~]$ hdfs dfs -du -s -h /results/havlik/new_calibration/test_struct/\n822.6 G  1.6 T  /results/havlik/new_calibration/test_struct\n\nFlat SELECT:\n\nselect \n    count(*)\nfrom \n    test_struct\nwhere\n    url.valid = true\n    and referer.valid = true;\n\nStruct SELECT:\n\nselect \n    count(*)\nfrom \n    test_flat\nwhere\n    urlvalid = true\n    and referervalid = true;\n\nCPU time:\nflat: 11785 seconds\nstruct: 38004 seconds\n\nHDFS bytes read:\nflat: 1 812 148 468\nstruct: 883 774 856 844 (which is total size of the table)\n\nUsing own MapReduce it is possible to use projections into structures to get results similar to flat table. It is clear that Hive needs to implement it as it creates unnecessary disk reading and CPU time overhead and cripples performance.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Hive does not use Parquet projection to access structures","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jakub_havlik","name":"jakub_havlik","key":"jakub_havlik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jakub Havlík","active":true,"timeZone":"Europe/Prague"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jakub_havlik","name":"jakub_havlik","key":"jakub_havlik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jakub Havlík","active":true,"timeZone":"Europe/Prague"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"CentOS 6.5, Cloudera 2.5.0-cdh5.3.0, 120 nodes in a cluster.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-10278/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2d0sv:"}}