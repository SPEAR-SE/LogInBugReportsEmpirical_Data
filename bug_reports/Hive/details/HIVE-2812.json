{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12543123","self":"https://issues.apache.org/jira/rest/api/2/issue/12543123","key":"HIVE-2812","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2012-02-21T21:30:47.517+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Dec 18 00:18:32 UTC 2012","customfield_12310420":"228409","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-2812/watchers","watchCount":3,"isWatching":false},"created":"2012-02-18T01:07:28.648+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-12-18T06:08:52.488+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"In multi insert queries where one subquery involves an aggregation with no distinct or group by keys and is followed by a query without any aggregations, like the following, Hive will attempt to add a group by operator for the query without aggregations, causing semantic analysis to fail.\n\nFROM src\nINSERT OVERWRITE TABLE table1 SELECT count(*)\nINSERT OVERWRITE TABLE table2 SELECT key;","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12515489","id":"12515489","filename":"ASF.LICENSE.NOT.GRANTED--HIVE-2812.D1821.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-21T21:30:48.183+0000","size":109692,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12515489/ASF.LICENSE.NOT.GRANTED--HIVE-2812.D1821.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12561377","id":"12561377","filename":"HIVE-2812.2.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-12-18T00:18:24.350+0000","size":106558,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12561377/HIVE-2812.2.patch.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12561376","id":"12561376","filename":"HIVE-2812.D1821.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2012-12-18T00:18:11.476+0000","size":106348,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12561376/HIVE-2812.D1821.2.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"124159","customfield_12312823":null,"summary":"Hive multi group by single reducer optimization fails when aggregation with no keys followed by query with no aggregations","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543123/comment/13212971","id":"13212971","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"kevinwilfong requested code review of \"HIVE-2812 [jira] Hive multi group by single reducer optimization fails when aggregation with no keys followed by query with no aggregations\".\nReviewers: JIRA\n\n  https://issues.apache.org/jira/browse/HIVE-2812\n\n  In multi insert queries, subqueries with aggregations but no group by keys were being grouped with subqueries without any aggregations.  This meant if a subquery without aggregations came first, the subqueries without group by keys were not benefitting from the optimization.  More imporantly, if a subquery without group by keys came first, the Semantic Analyzer tried to add group by operators for queries without group by clauses resulting in an error during semantic analysis.  This patch fixes this by ensuring the two types of subqueries are grouped separately.\n\n  In multi insert queries where one subquery involves an aggregation with no distinct or group by keys and is followed by a query without any aggregations, like the following, Hive will attempt to add a group by operator for the query without aggregations, causing semantic analysis to fail.\n\n  FROM src\n  INSERT OVERWRITE TABLE table1 SELECT count\n  INSERT OVERWRITE TABLE table2 SELECT key;\n\nTEST PLAN\n  EMPTY\n\nREVISION DETAIL\n  https://reviews.facebook.net/D1821\n\nAFFECTED FILES\n  ql/src/test/results/clientpositive/groupby_multi_single_reducer3.q.out\n  ql/src/test/queries/clientpositive/groupby_multi_single_reducer3.q\n  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java\n\nMANAGE HERALD DIFFERENTIAL RULES\n  https://reviews.facebook.net/herald/view/differential/\n\nWHY DID I GET THIS EMAIL?\n  https://reviews.facebook.net/herald/transcript/3879/\n\nTip: use the X-Herald-Rules header to filter Herald messages in your client.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-21T21:30:47.517+0000","updated":"2012-02-21T21:30:47.517+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543123/comment/13526338","id":"13526338","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"Can you refresh this ? It has been very long since it was visited.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2012-12-07T11:57:28.551+0000","updated":"2012-12-07T11:57:28.551+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543123/comment/13534450","id":"13534450","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"kevinwilfong updated the revision \"HIVE-2812 [jira] Hive multi group by single reducer optimization fails when aggregation with no keys followed by query with no aggregations\".\nReviewers: JIRA, njain\n\n  Updated.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D1821\n\nAFFECTED FILES\n  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java\n  ql/src/test/queries/clientpositive/groupby_multi_single_reducer3.q\n  ql/src/test/results/clientpositive/groupby_multi_single_reducer3.q.out\n\nTo: JIRA, njain, kevinwilfong\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2012-12-18T00:18:11.388+0000","updated":"2012-12-18T00:18:11.388+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12543123/comment/13534452","id":"13534452","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"body":"Refreshed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-12-18T00:18:32.409+0000","updated":"2012-12-18T00:18:32.409+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-2812/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0llnr:"}}