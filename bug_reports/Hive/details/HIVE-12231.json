{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12906991","self":"https://issues.apache.org/jira/rest/api/2/issue/12906991","key":"HIVE-12231","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-10-22T18:52:07.914+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Dec 01 09:26:51 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-12231/watchers","watchCount":6,"isWatching":false},"created":"2015-10-22T07:00:21.408+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332384","id":"12332384","name":"1.2.1","archived":false,"released":true,"releaseDate":"2015-06-26"}],"issuelinks":[{"id":"12447517","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12447517","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12907059","key":"HIVE-12232","self":"https://issues.apache.org/jira/rest/api/2/issue/12907059","fields":{"summary":"Create external table failed when enabled StorageBasedAuthorization","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjtufighter","name":"sjtufighter","key":"sjtufighter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjtufighter&avatarId=24965","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjtufighter&avatarId=24965","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjtufighter&avatarId=24965","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjtufighter&avatarId=24965"},"displayName":"WangMeng","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-12-01T09:26:51.981+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[],"timeoriginalestimate":null,"description":"Please look at the stacktrace, when enabled StorageBasedAuthorization, I set external location to create database. However, it will also check write permission of default warehouse \"/user/hive/warehouse\"  :\n> CREATE DATABASE test LOCATION  '/tmp/wangmeng/test'  ;\nError: Error while compiling statement: FAILED: HiveException java.security.AccessControlException: Permission denied: user=wangmeng, access=WRITE, inode=\"/user/hive/warehouse\":hive:hive:drwxr-x--t\n\tat org.apache.hadoop.hdfs.server.namenode.DefaultAuthorizationProvider.checkFsPermission(DefaultAuthorizationProvider.java:255)\n\tat org.apache.hadoop.hdfs.server.namenode.DefaultAuthorizationProvider.check(DefaultAuthorizationProvider.java:236)\n\tat org.apache.hadoop.hdfs.server.namenode.DefaultAuthorizationProvider.checkPermission(DefaultAuthorizationProvider.java:151)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12767983","id":"12767983","filename":"HIVE-12231.01.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjtufighter","name":"sjtufighter","key":"sjtufighter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjtufighter&avatarId=24965","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjtufighter&avatarId=24965","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjtufighter&avatarId=24965","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjtufighter&avatarId=24965"},"displayName":"WangMeng","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-10-22T07:03:58.850+0000","size":3051,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12767983/HIVE-12231.01.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"StorageBasedAuthorization requires write permission of default Warehouse when create external database","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjtufighter","name":"sjtufighter","key":"sjtufighter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjtufighter&avatarId=24965","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjtufighter&avatarId=24965","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjtufighter&avatarId=24965","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjtufighter&avatarId=24965"},"displayName":"WangMeng","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjtufighter","name":"sjtufighter","key":"sjtufighter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjtufighter&avatarId=24965","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjtufighter&avatarId=24965","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjtufighter&avatarId=24965","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjtufighter&avatarId=24965"},"displayName":"WangMeng","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12906991/comment/14968670","id":"14968670","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjtufighter","name":"sjtufighter","key":"sjtufighter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjtufighter&avatarId=24965","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjtufighter&avatarId=24965","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjtufighter&avatarId=24965","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjtufighter&avatarId=24965"},"displayName":"WangMeng","active":true,"timeZone":"Asia/Shanghai"},"body":"[~xuefuz] [~thejas] :\nPlease take a look about this small bug. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjtufighter","name":"sjtufighter","key":"sjtufighter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjtufighter&avatarId=24965","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjtufighter&avatarId=24965","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjtufighter&avatarId=24965","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjtufighter&avatarId=24965"},"displayName":"WangMeng","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-10-22T07:12:37.566+0000","updated":"2015-10-22T07:12:37.566+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12906991/comment/14969642","id":"14969642","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"[~sjtufighter] Thanks for looking into this.\nHowever, the idea behind StorageBasedAuthorization is to control/limit what the user can do to metadata, based on the permissions the user has on the storage (file system). \nChecking for permissions on the warehouse base directory helps to restrict the set of people who can create new databases.\nThis is similar to other checks, here are some examples -\n # For creation of a table , the db dir permissions would be checked, even if the table being created is an external table.\n # For creation of a partition in a table, the table dir permission is checked even if the new partition has a location outside the table directory.\n\nThis patch would take away a access control that is enforced by StorageBasedAuthorization.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-22T18:52:07.914+0000","updated":"2015-10-22T18:52:07.914+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12906991/comment/14970294","id":"14970294","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjtufighter","name":"sjtufighter","key":"sjtufighter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjtufighter&avatarId=24965","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjtufighter&avatarId=24965","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjtufighter&avatarId=24965","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjtufighter&avatarId=24965"},"displayName":"WangMeng","active":true,"timeZone":"Asia/Shanghai"},"body":"[~thejas] Thanks for your detailed clarification.\nHowever, if user has write permission on the external path which is used in creating external database, this check mechanism maybe a little inappropriate. User should own the right to create database in path which user owns write permission such as his own dir. How about checking the destination path of external database directly? In production environment, creating external database in permission dir is relative common.\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjtufighter","name":"sjtufighter","key":"sjtufighter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjtufighter&avatarId=24965","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjtufighter&avatarId=24965","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjtufighter&avatarId=24965","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjtufighter&avatarId=24965"},"displayName":"WangMeng","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-10-23T02:07:31.318+0000","updated":"2015-10-23T02:07:31.318+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12906991/comment/14970447","id":"14970447","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12767983/HIVE-12231.01.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 5 failed/errored test(s), 9700 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_bitmap_auto_partitioned\norg.apache.hadoop.hive.ql.io.orc.TestColumnStatistics.testHasNull\norg.apache.hadoop.hive.ql.io.orc.TestJsonFileDump.testJsonDump\norg.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation\norg.apache.hive.jdbc.TestSSL.testSSLVersion\n{noformat}\n\nTest results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5744/testReport\nConsole output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5744/console\nTest logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5744/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 5 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12767983 - PreCommit-HIVE-TRUNK-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2015-10-23T05:02:51.885+0000","updated":"2015-10-23T05:02:51.885+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12906991/comment/14983505","id":"14983505","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"[~sjtufighter]\nUnfortunately there is no other way to restrict creation of databases if the cluster admin wants to. This is certainly a flexibility that storagebasedauthorization lacks. However, we can't change that behavior as many admins would be relying on this to control who gets to create a new database. \n\nA workaround is to have admin create a database for such users, and allow them to create external tables instead of external databases.\nIf you strongly see a need for being able to create external databases without having permissions on the warehouse directory, it should be through a configuration setting for StorageBasedAuthorization. Please make sure that there is test coverage for both config being enabled and disabled.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-30T22:31:57.182+0000","updated":"2015-10-30T22:31:57.182+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12906991/comment/15033397","id":"15033397","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjtufighter","name":"sjtufighter","key":"sjtufighter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjtufighter&avatarId=24965","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjtufighter&avatarId=24965","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjtufighter&avatarId=24965","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjtufighter&avatarId=24965"},"displayName":"WangMeng","active":true,"timeZone":"Asia/Shanghai"},"body":"[~thejas] Many thanks for your detailed explaination.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sjtufighter","name":"sjtufighter","key":"sjtufighter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sjtufighter&avatarId=24965","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sjtufighter&avatarId=24965","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sjtufighter&avatarId=24965","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sjtufighter&avatarId=24965"},"displayName":"WangMeng","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-12-01T09:26:51.981+0000","updated":"2015-12-01T09:26:51.981+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-12231/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2nd5j:"}}