{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12736949","self":"https://issues.apache.org/jira/rest/api/2/issue/12736949","key":"HIVE-7886","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Nov 04 23:34:42 UTC 2014","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-7886/watchers","watchCount":1,"isWatching":false},"created":"2014-08-26T22:06:58.113+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326829","id":"12326829","description":"0.13 maintenance release 1","name":"0.13.1","archived":false,"released":true,"releaseDate":"2014-06-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-11-04T23:34:42.047+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320633","id":"12320633","name":"File Formats","description":"File Formats"}],"timeoriginalestimate":null,"description":"Aggregation queries on Hive tables which use RCFile format and S3 storage are failing.\n\nMy setup is Hadoop 2.5.0 and Hive 0.13.1.\n\nI create a table with following schema:-\nCREATE EXTERNAL TABLE `testtable`(\n  `col1` string, \n  `col2` tinyint, \n  `col3` int, \n  `col4` float, \n  `col5` boolean, \n  `col6` smallint)\nROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.columnar.ColumnarSerDe' \nWITH SERDEPROPERTIES (\n  'serialization.format'='\\t',\n  'line.delim'='\\n',\n  'field.delim'='\\t'\n)\nSTORED AS INPUTFORMAT \n  'org.apache.hadoop.hive.ql.io.RCFileInputFormat' \nOUTPUTFORMAT \n  'org.apache.hadoop.hive.ql.io.RCFileOutputFormat'\nLOCATION\n  's3n://<testbucket>/testtable';\n\nWhen I run 'select count(*) from testtable', it gives the following exception stack:-\n\nError: java.io.IOException: java.io.IOException: java.io.EOFException: Attempted to seek or read past the end of the file\n\tat org.apache.hadoop.hive.io.HiveIOExceptionHandlerChain.handleRecordReaderNextException(HiveIOExceptionHandlerChain.java:121)\n\tat org.apache.hadoop.hive.io.HiveIOExceptionHandlerUtil.handleRecordReaderNextException(HiveIOExceptionHandlerUtil.java:77)\n\tat org.apache.hadoop.hive.shims.HadoopShimsSecure$CombineFileRecordReader.doNextWithExceptionHandler(HadoopShimsSecure.java:256)\n\tat org.apache.hadoop.hive.shims.HadoopShimsSecure$CombineFileRecordReader.next(HadoopShimsSecure.java:171)\n\tat org.apache.hadoop.mapred.MapTask$TrackedRecordReader.moveToNext(MapTask.java:198)\n\tat org.apache.hadoop.mapred.MapTask$TrackedRecordReader.next(MapTask.java:184)\n\tat org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:52)\n\tat org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:430)\n\tat org.apache.hadoop.mapred.MapTask.run(MapTask.java:342)\n\tat org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:168)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1614)\n\tat org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:163)\nCaused by: java.io.IOException: java.io.EOFException: Attempted to seek or read past the end of the file\n\tat org.apache.hadoop.hive.io.HiveIOExceptionHandlerChain.handleRecordReaderNextException(HiveIOExceptionHandlerChain.java:121)\n\tat org.apache.hadoop.hive.io.HiveIOExceptionHandlerUtil.handleRecordReaderNextException(HiveIOExceptionHandlerUtil.java:77)\n\tat org.apache.hadoop.hive.ql.io.HiveContextAwareRecordReader.doNext(HiveContextAwareRecordReader.java:344)\n\tat org.apache.hadoop.hive.ql.io.CombineHiveRecordReader.doNext(CombineHiveRecordReader.java:101)\n\tat org.apache.hadoop.hive.ql.io.CombineHiveRecordReader.doNext(CombineHiveRecordReader.java:41)\n\tat org.apache.hadoop.hive.ql.io.HiveContextAwareRecordReader.next(HiveContextAwareRecordReader.java:122)\n\tat org.apache.hadoop.hive.shims.HadoopShimsSecure$CombineFileRecordReader.doNextWithExceptionHandler(HadoopShimsSecure.java:254)\n\t... 11 more\nCaused by: java.io.EOFException: Attempted to seek or read past the end of the file\n\tat org.apache.hadoop.fs.s3native.Jets3tNativeFileSystemStore.processException(Jets3tNativeFileSystemStore.java:462)\n\tat org.apache.hadoop.fs.s3native.Jets3tNativeFileSystemStore.handleException(Jets3tNativeFileSystemStore.java:411)\n\tat org.apache.hadoop.fs.s3native.Jets3tNativeFileSystemStore.retrieve(Jets3tNativeFileSystemStore.java:234)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:601)\n\tat org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:187)\n\tat org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:102)\n\tat org.apache.hadoop.fs.s3native.$Proxy17.retrieve(Unknown Source)\n\tat org.apache.hadoop.fs.s3native.NativeS3FileSystem$NativeS3FsInputStream.seek(NativeS3FileSystem.java:205)\n\tat org.apache.hadoop.fs.BufferedFSInputStream.seek(BufferedFSInputStream.java:96)\n\tat org.apache.hadoop.fs.BufferedFSInputStream.skip(BufferedFSInputStream.java:67)\n\tat java.io.DataInputStream.skipBytes(DataInputStream.java:220)\n\tat org.apache.hadoop.hive.ql.io.RCFile$ValueBuffer.readFields(RCFile.java:739)\n\tat org.apache.hadoop.hive.ql.io.RCFile$Reader.currentValueBuffer(RCFile.java:1720)\n\tat org.apache.hadoop.hive.ql.io.RCFile$Reader.getCurrentRow(RCFile.java:1898)\n\tat org.apache.hadoop.hive.ql.io.RCFileRecordReader.next(RCFileRecordReader.java:149)\n\tat org.apache.hadoop.hive.ql.io.RCFileRecordReader.next(RCFileRecordReader.java:44)\n\tat org.apache.hadoop.hive.ql.io.HiveContextAwareRecordReader.doNext(HiveContextAwareRecordReader.java:339)\n\t... 15 more\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Aggregation queries fail with RCFile based Hive tables with S3 storage","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vravuri%40ea.com","name":"vravuri@ea.com","key":"vravuri@ea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Venkata Puneet Ravuri","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vravuri%40ea.com","name":"vravuri@ea.com","key":"vravuri@ea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Venkata Puneet Ravuri","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12736949/comment/14111429","id":"14111429","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vravuri%40ea.com","name":"vravuri@ea.com","key":"vravuri@ea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Venkata Puneet Ravuri","active":true,"timeZone":"America/Los_Angeles"},"body":"The data files are in correct RCFile format. When I run 'select *' on this table, the data is returned correctly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vravuri%40ea.com","name":"vravuri@ea.com","key":"vravuri@ea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Venkata Puneet Ravuri","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-26T22:08:18.132+0000","updated":"2014-08-26T22:08:18.132+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12736949/comment/14111436","id":"14111436","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vravuri%40ea.com","name":"vravuri@ea.com","key":"vravuri@ea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Venkata Puneet Ravuri","active":true,"timeZone":"America/Los_Angeles"},"body":"The same issue occurs in Hive 0.12. But it worked when column pruning was disabled by setting the property 'hive.optimize.cp' to false.\nFor Hive 0.13 this property was disabled as part of [HIVE-4113|https://issues.apache.org/jira/browse/HIVE-4113].\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vravuri%40ea.com","name":"vravuri@ea.com","key":"vravuri@ea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Venkata Puneet Ravuri","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-08-26T22:12:03.878+0000","updated":"2014-08-26T22:12:03.878+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12736949/comment/14197129","id":"14197129","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vravuri%40ea.com","name":"vravuri@ea.com","key":"vravuri@ea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Venkata Puneet Ravuri","active":true,"timeZone":"America/Los_Angeles"},"body":"The reason is the difference in behavior of InputStream between HDFS and S3. For a HDFS file, the input stream used is DFSInputStream and for an S3 file, the input stream used is NativeS3FsInputStream. Filed a JIRA in Hadoop Common - [HADOOP-11270|https://issues.apache.org/jira/browse/HADOOP-11270].\n\nWill close this ticket once the Hadoop issue is fixed and the Hive query is verified.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vravuri%40ea.com","name":"vravuri@ea.com","key":"vravuri@ea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Venkata Puneet Ravuri","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-11-04T23:34:42.047+0000","updated":"2014-11-04T23:34:42.047+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-7886/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1zd7j:"}}