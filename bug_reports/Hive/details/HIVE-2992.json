{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12553481","self":"https://issues.apache.org/jira/rest/api/2/issue/12553481","key":"HIVE-2992","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317742","id":"12317742","description":"released","name":"0.9.0","archived":false,"released":true,"releaseDate":"2012-04-30"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-07-03T18:26:03.398+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jul 10 07:47:50 UTC 2012","customfield_12310420":"237645","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_6029747271_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-07-10T07:48:36.404+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-2992/watchers","watchCount":4,"isWatching":false},"created":"2012-05-01T12:52:49.467+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319268","id":"12319268","description":"released","name":"0.8.1","archived":false,"released":true,"releaseDate":"2012-02-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-07-12T11:23:40.948+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Okay first off; I know JOIN + LATERAL VIEW together isn't working so I moved my JOIN into a subquery and that makes the query work properly\n\nHowever when I added a MAPJOIN hint for the JOIN in the subquery it will also stop doing the reducer for the main query!\nThis only happens when there's a LATERAL VIEW in there though, if I remove the LATERAL VIEW then the main query still get's a reducer to do grouping\n\n\nHere's a gist: https://gist.github.com/2499436 Containing the queries and a PHP script which you can run to execute the test case I'm using, which does;\n  - setup a database called hive_mapjoin\n  - setup tables\n  - load some test data\n  - do the selects\nYou'll need the https://github.com/rcongiu/Hive-JSON-Serde/downloads json-serde-1.1-jar-with-dependencies.jar with it though and change the path ;)\nI guess looking at the queries you guys can probally figure out a better testcase, but maybe it's helpful :-)\n\n\nNot sure if this is a bug or me doing something that just isn't supposed to be working, but I can't seem to find any pointers that this wouldn't be supported...\n\n\nHere's another gist with the plan.xml: https://gist.github.com/2499658","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"124264","customfield_12312823":null,"summary":"JOIN + LATERAL VIEW + MAPJOIN fails to return result (seems to stop halfway through and no longer do the final reduce part)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruben.devries","name":"ruben.devries","key":"ruben.devries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruben de Vries","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruben.devries","name":"ruben.devries","key":"ruben.devries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruben de Vries","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"ubuntu - hadoop 0.20.2-cdh3u0 - hive 0.8.1","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553481/comment/13405965","id":"13405965","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lukeforehand","name":"lukeforehand","key":"lukeforehand","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Forehand","active":true,"timeZone":"America/Chicago"},"body":"I'm experiencing the same issue, thank you for documenting this!  Can someone at least explain why the reduce step is never happening?  It seems to simply ignore the LATERAL VIEW part of the query and everything after.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lukeforehand","name":"lukeforehand","key":"lukeforehand","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Luke Forehand","active":true,"timeZone":"America/Chicago"},"created":"2012-07-03T18:26:03.398+0000","updated":"2012-07-03T18:26:03.398+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553481/comment/13406338","id":"13406338","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"Could you try it again with cp disabled? (set hive.optimize.cp=false;)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2012-07-04T07:46:02.624+0000","updated":"2012-07-04T07:46:02.624+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553481/comment/13406355","id":"13406355","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruben.devries","name":"ruben.devries","key":"ruben.devries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruben de Vries","active":true,"timeZone":"Etc/UTC"},"body":"tried, didn't help :(\n\nI added a log (with `-hiveconf hive.root.logger=INFO,console -v`) to the gist","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruben.devries","name":"ruben.devries","key":"ruben.devries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruben de Vries","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-04T08:14:33.046+0000","updated":"2012-07-04T08:14:33.046+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553481/comment/13406550","id":"13406550","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"Could you upload explain result for that query? It seemed to be a genMR order issue which was thought to be resolved already.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2012-07-04T14:28:31.483+0000","updated":"2012-07-04T14:28:31.483+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553481/comment/13406570","id":"13406570","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruben.devries","name":"ruben.devries","key":"ruben.devries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruben de Vries","active":true,"timeZone":"Etc/UTC"},"body":"same script but without using the JSON Serde: https://gist.github.com/3047737\n\nI found another query that was failing, but with the `set hive.optimize.cp=false` that one was fixed, but the one that was failing before is still failing!\nAnd with `set hive.optimize.cp=false` the mapjoin seems to fail (crash)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruben.devries","name":"ruben.devries","key":"ruben.devries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruben de Vries","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-04T14:58:14.769+0000","updated":"2012-07-04T14:58:14.769+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553481/comment/13406584","id":"13406584","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruben.devries","name":"ruben.devries","key":"ruben.devries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruben de Vries","active":true,"timeZone":"Etc/UTC"},"body":"Here are the queries with their explain: https://gist.github.com/3047871","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruben.devries","name":"ruben.devries","key":"ruben.devries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruben de Vries","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-04T15:23:04.030+0000","updated":"2012-07-04T15:23:04.030+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553481/comment/13406833","id":"13406833","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"HIVE-3226 is one of the bugs which caused your problem. I'm working on it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2012-07-05T03:49:36.034+0000","updated":"2012-07-05T03:49:36.034+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553481/comment/13406840","id":"13406840","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"This seemed to be solved by HIVE-2642. Could you consider using hive-0.9?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2012-07-05T04:32:37.668+0000","updated":"2012-07-05T04:32:37.668+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553481/comment/13410101","id":"13410101","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruben.devries","name":"ruben.devries","key":"ruben.devries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruben de Vries","active":true,"timeZone":"Etc/UTC"},"body":"hmm, I'm using hadoop-0.20.2 and can't really upgrade to higher versions of hadoop atm because of jobs running on the same clusters developed and maintained by other teams.\nI do have control over the version of hive however, do you know if 0.9 plays nice with hadoop-0.20.2 ?\n\nAnyway, I'll grab 0.9 for my local development cluster and check if it solves the problem :-)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruben.devries","name":"ruben.devries","key":"ruben.devries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruben de Vries","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-10T07:18:25.017+0000","updated":"2012-07-10T07:18:25.017+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12553481/comment/13410115","id":"13410115","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruben.devries","name":"ruben.devries","key":"ruben.devries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruben de Vries","active":true,"timeZone":"Etc/UTC"},"body":"Both test cases pass using hive-0.9","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ruben.devries","name":"ruben.devries","key":"ruben.devries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ruben de Vries","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-10T07:47:50.475+0000","updated":"2012-07-10T07:47:50.475+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-2992/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0lmb3:"}}