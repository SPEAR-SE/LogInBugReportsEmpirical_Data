{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12696758","self":"https://issues.apache.org/jira/rest/api/2/issue/12696758","key":"HIVE-6489","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Mar 17 18:38:24 UTC 2014","customfield_12310420":"375233","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-6489/watchers","watchCount":2,"isWatching":false},"created":"2014-02-22T23:10:26.808+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":86400,"aggregatetimeoriginalestimate":86400,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317742","id":"12317742","description":"released","name":"0.9.0","archived":false,"released":true,"releaseDate":"2012-04-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12320745","id":"12320745","description":"released","name":"0.10.0","archived":false,"released":true,"releaseDate":"2013-01-11"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323587","id":"12323587","description":"Hive 0.11.0","name":"0.11.0","archived":false,"released":true,"releaseDate":"2013-05-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324312","id":"12324312","description":"released","name":"0.12.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-03-17T18:42:05.738+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12317307","id":"12317307","name":"Import/Export"}],"timeoriginalestimate":86400,"description":"Data uploaded by <user> via the Hive client with the \"LOAD DATA LOCAL INPATH\" method will have group ownership of the hdfs://tmp/hive-<user> instead of the group ownership of the table directory.  The group ownership of the hdfs://tmp/hive-<user> is, by default, the group that the user running the hadoop daemons run under.  This means that, on a Hadoop system with default file permissions of 770, any data loaded to hive via the LOAD DATA LOCAL INPATH method by one user cannot be seen by another user in the same group until the group ownership is manually changed in Hive's internal directory, or the group ownership is manually changed on hdfs://tmp/hive-<user>.  This problem is not present with the LOAD DATA INPATH method, or by using regular HDFS loads.\n\nSteps to reproduce the problem on a pseudodistributed Hadoop cluster:\n- In hdfs-site.xml, modify the umask to 007 (meaning that default permissions on files are 770).  The property changes names in Hadoop 2.0 but used to be called \"dfs.umaskmode\".\n- Restart hdfs\n- Create a group called \"testgroup\".\n- Create two users that have testgroup as their primary group.  Call them \"testuser1\" and \"testuser2\"\n- Create a test file containing \"Hello World\" and call it \"test.txt\".  It should be stored on the local filesystem.\n- Create a table called \"testtable\" in Hive using testuser1.  Give it a single string column, textfile format, comma delimited fields.\n- Have testuser1 use the LOAD DATA LOCAL INPATH command to load \"test.txt\" into testtable.\n- Attempt to read testtable using testuser2.  The read will fail on a permissions error, when it should not.\n- Examine the contents of the hdfs://apps/hive/warehouse/testtable directory.  The file will belong to the \"hadoop\" or \"users\" or analogous group, instead of the correct group \"testgroup\".  It will have correct permissions of 770.\n- Change the group ownership of the folder \"hdfs://tmp/hive-testuser1\" to \"testgroup\".\n- Repeat the data load.  testuser2 will now be able to correctly read the data, and the file will have the correct group ownership.","customfield_10010":null,"timetracking":{"originalEstimate":"24h","remainingEstimate":"24h","originalEstimateSeconds":86400,"remainingEstimateSeconds":86400},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":86400,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"375529","customfield_12312823":null,"summary":"Data loaded with LOAD DATA LOCAL INPATH has incorrect group ownership","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joeraoiv","name":"joeraoiv","key":"joeraoiv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10453"},"displayName":"Juan Hernandez","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joeraoiv","name":"joeraoiv","key":"joeraoiv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10453"},"displayName":"Juan Hernandez","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":86400,"percent":0},"customfield_12311024":null,"environment":"OS and hardware are irrelevant.  Tested and reproduced on multiple configurations, including SLES, RHEL, VM, Teradata Hadoop Appliance, HDP 1.1, HDP 1.3.2, HDP 2.0.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":86400,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12696758/comment/13938184","id":"13938184","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joeraoiv","name":"joeraoiv","key":"joeraoiv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10453"},"displayName":"Juan Hernandez","active":true,"timeZone":"America/New_York"},"body":"A succinct way of wording the problem is:\n- Hadoop daemons create the /tmp/hive-<username> directory with their group ownership\n- User data loaded via LOAD DATA LOCAL INPATH is staged in /tmp/hive-<username>, inheriting its group ownership\n- User data is moved to the table directory, but keeps the group ownership of /tmp/hive-<username>\n\nThe desired behavior is:\n- Data loaded with LOAD DATA LOCAL INPATH inherits the group ownership of the table directory\n\nThis could be solved by:\n- Removing the need to stage the data in /tmp, OR\n- Adding a step to LOAD DATA LOCAL INPATH to change the group ownership, after the load completes (this one is probably an easier solution)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joeraoiv","name":"joeraoiv","key":"joeraoiv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10453"},"displayName":"Juan Hernandez","active":true,"timeZone":"America/New_York"},"created":"2014-03-17T18:38:24.154+0000","updated":"2014-03-17T18:38:24.154+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-6489/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1sntj:"}}