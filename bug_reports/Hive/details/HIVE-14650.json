{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13000208","self":"https://issues.apache.org/jira/rest/api/2/issue/13000208","key":"HIVE-14650","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-08-26T20:46:36.567+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 26 21:22:12 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-14650/watchers","watchCount":2,"isWatching":false},"created":"2016-08-25T23:09:15.011+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332384","id":"12332384","name":"1.2.1","archived":false,"released":true,"releaseDate":"2015-06-26"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-07-20T10:21:11.592+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"When SELECTing from a Hive ORC table, the following IndexOutOfBoundsException is thrown if the underlying ORC file has 4 or more columns than the Hive schema (where N is the number of columns in the ORC file).\r\n{noformat}\r\nFailed with exception java.io.IOException:java.lang.IndexOutOfBoundsException: toIndex = N\r\n16/08/25 15:22:19 ERROR CliDriver: Failed with exception java.io.IOException:java.lang.IndexOutOfBoundsException: toIndex = N\r\njava.io.IOException: java.lang.IndexOutOfBoundsException: toIndex = N\r\n        at org.apache.hadoop.hive.ql.exec.FetchOperator.getNextRow(FetchOperator.java:507)\r\n        at org.apache.hadoop.hive.ql.exec.FetchOperator.pushRow(FetchOperator.java:414)\r\n        at org.apache.hadoop.hive.ql.exec.FetchTask.fetch(FetchTask.java:140)\r\n        at org.apache.hadoop.hive.ql.Driver.getResults(Driver.java:1686)\r\n        at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:233)\r\n        at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:165)\r\n        at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:376)\r\n        at org.apache.hadoop.hive.cli.CliDriver.executeDriver(CliDriver.java:736)\r\n        at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:681)\r\n        at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:621)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.lang.reflect.Method.invoke(Method.java:498)\r\n        at org.apache.hadoop.util.RunJar.run(RunJar.java:221)\r\n        at org.apache.hadoop.util.RunJar.main(RunJar.java:136)\r\nCaused by: java.lang.IndexOutOfBoundsException: toIndex = 6\r\n        at java.util.ArrayList.subListRangeCheck(ArrayList.java:1004)\r\n        at java.util.ArrayList.subList(ArrayList.java:996)\r\n        at org.apache.hadoop.hive.ql.io.orc.RecordReaderFactory.getSchemaOnRead(RecordReaderFactory.java:161)\r\n        at org.apache.hadoop.hive.ql.io.orc.RecordReaderFactory.createTreeReader(RecordReaderFactory.java:66)\r\n        at org.apache.hadoop.hive.ql.io.orc.RecordReaderImpl.<init>(RecordReaderImpl.java:202)\r\n        at org.apache.hadoop.hive.ql.io.orc.ReaderImpl.rowsOptions(ReaderImpl.java:541)\r\n        at org.apache.hadoop.hive.ql.io.orc.OrcRawRecordMerger$ReaderPair.<init>(OrcRawRecordMerger.java:183)\r\n        at org.apache.hadoop.hive.ql.io.orc.OrcRawRecordMerger$OriginalReaderPair.<init>(OrcRawRecordMerger.java:226)\r\n        at org.apache.hadoop.hive.ql.io.orc.OrcRawRecordMerger.<init>(OrcRawRecordMerger.java:437)\r\n        at org.apache.hadoop.hive.ql.io.orc.OrcInputFormat.getReader(OrcInputFormat.java:1216)\r\n        at org.apache.hadoop.hive.ql.io.orc.OrcInputFormat.getRecordReader(OrcInputFormat.java:1113)\r\n        at org.apache.hadoop.hive.ql.exec.FetchOperator$FetchInputFormatSplit.getRecordReader(FetchOperator.java:673)\r\n        at org.apache.hadoop.hive.ql.exec.FetchOperator.getRecordReader(FetchOperator.java:323)\r\n        at org.apache.hadoop.hive.ql.exec.FetchOperator.getNextRow(FetchOperator.java:445)\r\n        ... 15 more\r\n{noformat}\r\nThis error appears to be related to the patch of HIVE-10591.\r\n\r\nSteps to reproduce (Hive QL):\r\n{noformat}\r\nDROP TABLE IF EXISTS orc_drop_column;\r\nCREATE TABLE orc_drop_column (`id` int, `name` string, `description` string, `somevalue` double, `someflag` boolean, `somedate` timestamp) STORED AS ORC;\r\nINSERT INTO TABLE orc_drop_column select * from (select 1, 'my_name', 'my_desc', 5.5, true, '2016-08-25 06:00:00') a;\r\n\r\nALTER TABLE orc_drop_column SET SERDE 'org.apache.hadoop.hive.serde2.columnar.ColumnarSerDe';\r\nALTER TABLE orc_drop_column REPLACE COLUMNS (\r\n  `id` int,\r\n  `name` string\r\n);\r\nALTER TABLE orc_drop_column SET SERDE 'org.apache.hadoop.hive.ql.io.orc.OrcSerde';\r\nSELECT id, name FROM orc_drop_column;\r\n{noformat}\r\nÂ ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Select fails when ORC file has more columns than table schema","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jxmink","name":"jxmink","key":"jxmink","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Mink","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jxmink","name":"jxmink","key":"jxmink","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Mink","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13000208/comment/15439805","id":"15439805","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"I don't think column removal is supported by schema evolution yet. cc [~mmccline]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-08-26T20:46:36.567+0000","updated":"2016-08-26T20:46:36.567+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13000208/comment/15439888","id":"15439888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jxmink","name":"jxmink","key":"jxmink","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Mink","active":true,"timeZone":"Etc/UTC"},"body":"I used column removal as an easy example of how to recreate the problem. A user would also run into in in a scenario where there are multiple tables pointing to the same location. If, for example, there is one managed table and one external table pointing to the same location, and columns are added to the managed table, this error would occur on any SELECT to the external table.\n\nThis behavior was introduced in 1.2 (as mentioned in the description)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jxmink","name":"jxmink","key":"jxmink","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Mink","active":true,"timeZone":"Etc/UTC"},"created":"2016-08-26T21:22:12.907+0000","updated":"2016-08-26T21:22:12.907+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-14650/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i32thb:"}}