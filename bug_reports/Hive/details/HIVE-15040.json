{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13014677","self":"https://issues.apache.org/jira/rest/api/2/issue/13014677","key":"HIVE-15040","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-11-10T10:11:51.591+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Nov 11 08:10:29 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-15040/watchers","watchCount":2,"isWatching":false},"created":"2016-10-24T10:20:01.458+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332641","id":"12332641","description":"Hive 2.0.0","name":"2.0.0","archived":false,"released":true,"releaseDate":"2016-02-15"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-11-11T08:10:29.399+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"This query:\n\n{code}\nSELECT \n  COUNT(1)\nFROM (\n  SELECT 1 as c1 , Array(1, 2, 3) as c2 \n  UNION ALL \n  SELECT 2 as c1 , Array(2, 3, 4) as c2 \n) T\nLATERAL VIEW explode(c2) LV AS c\nWHERE c = 42\nAND T.c1 NOT IN (SELECT 1 UNION ALL SELECT 3) \n;\n{code}\n\nreturns {{3}} in Hive 1.1.0 and 2.0.0\n\nBut obviously it should return 0, since {{c = 42}} is false.\nIt seems that the clause is ignored.\n\nSpark-SQL does return {{0}}.\n\nP.S. The UNION ALL is not causing the bug, I just wanted to demonstrate is with a standalone query. Using regular tables instead still causes the same bug.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"LATERAL VIEW + WHERE IN ...= WRONG RESULT","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpin","name":"fpin","key":"fpin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Furcy Pin","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpin","name":"fpin","key":"fpin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Furcy Pin","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13014677/comment/15653654","id":"15653654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tzenmyo","name":"tzenmyo","key":"tzenmyo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teruyoshi Zenmyo","active":true,"timeZone":"Etc/UTC"},"body":"Hi [~fpin], I have found similar (maybe same) issue (HIVE-15175).\nI had tried the example query with hive.optimize.ppd=false and got 0 as result.\n\nWould you confirm this workaround?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tzenmyo","name":"tzenmyo","key":"tzenmyo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teruyoshi Zenmyo","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-10T10:11:51.591+0000","updated":"2016-11-10T10:11:51.591+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13014677/comment/15654694","id":"15654694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpin","name":"fpin","key":"fpin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Furcy Pin","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~tzenmyo], \n\nyes, I confirm that after disabling predicate pushdown, I get the correct result (tested on Hive 1.1.0 and 2.0.0)\n\nThis is quite concerning, as predicate pushdown is one of the most central feature of any SQL engine...\nDisabling it by default on every query might result in an import performance downgrade.\n\nYour issue HIVE-15175 seems to involve partition pruning as well, so i don't think this is the same bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpin","name":"fpin","key":"fpin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Furcy Pin","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-10T17:59:42.427+0000","updated":"2016-11-10T17:59:42.427+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13014677/comment/15656464","id":"15656464","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tzenmyo","name":"tzenmyo","key":"tzenmyo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teruyoshi Zenmyo","active":true,"timeZone":"Etc/UTC"},"body":"Sorry, my previous comment is incorrect.\nHIVE-15175 is a dup of HIVE-14652, however, I have confirmed the HIVE-14652 patch does not fix this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tzenmyo","name":"tzenmyo","key":"tzenmyo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teruyoshi Zenmyo","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-11T08:10:29.399+0000","updated":"2016-11-11T08:10:29.399+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-15040/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i35aj3:"}}