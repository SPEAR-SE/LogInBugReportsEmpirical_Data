{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12773560","self":"https://issues.apache.org/jira/rest/api/2/issue/12773560","key":"HIVE-9625","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332154","id":"12332154","description":"","name":"1.3.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12332641","id":"12332641","description":"Hive 2.0.0","name":"2.0.0","archived":false,"released":true,"releaseDate":"2016-02-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2015-02-09T21:21:00.086+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jun 29 02:52:26 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_9512733_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_11990189120","customfield_12312321":null,"resolutiondate":"2015-06-28T17:23:00.199+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-9625/watchers","watchCount":10,"isWatching":false},"created":"2015-02-09T20:07:58.453+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12423342","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12423342","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12826600","key":"HIVE-10574","self":"https://issues.apache.org/jira/rest/api/2/issue/12826600","fields":{"summary":"Metastore to handle expired tokens inline","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-02-16T23:52:19.889+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320408","id":"12320408","name":"HiveServer2","description":"Tracks issues related to HiveServer2"}],"timeoriginalestimate":null,"description":"AFAICT the delegation tokens stored in [HiveSessionImplwithUGI |https://github.com/apache/hive/blob/trunk/service/src/java/org/apache/hive/service/cli/session/HiveSessionImplwithUGI.java#L45] for HMS + Impersonation are never renewed.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12742370","id":"12742370","filename":"HIVE-9625.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-28T03:54:38.309+0000","size":4775,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12742370/HIVE-9625.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12741908","id":"12741908","filename":"HIVE-9625.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-25T18:03:40.494+0000","size":4775,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12741908/HIVE-9625.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12697589","id":"12697589","filename":"HIVE-9625.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-02-09T22:46:22.006+0000","size":5259,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12697589/HIVE-9625.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12742392","id":"12742392","filename":"HIVE-9625.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-28T13:42:54.350+0000","size":4786,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12742392/HIVE-9625.2.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Delegation tokens for HMS are not renewed","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14312777","id":"14312777","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"[~thejas] [~prasadm] - do agree that these tokens do not have a renew process at present? If so, I think we can add a background thread to renew them in [SessionManager|https://github.com/apache/hive/blob/trunk/service/src/java/org/apache/hive/service/cli/session/SessionManager.java#L150].","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-02-09T20:10:07.695+0000","updated":"2015-02-09T20:10:07.695+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14312902","id":"14312902","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"Yes, this does look like a problem. \nRegarding the way to renew it, I think it would be better if we can renew it from a HMS client implementation on a failure-retry, similar to how reloginFromKeyTab was added to the client in HIVE-4233.  This way any client of HMS could potentially benefit from this change. I haven't explored this fully, so I am not sure if there are any impediments for this,  this is just something to consider.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-02-09T21:21:00.086+0000","updated":"2015-02-09T21:21:00.086+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14312907","id":"14312907","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"The renewal of credentials done in HIVE-4233 is similar to how I believe its done in HDFS/MR/Yarn clients.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-02-09T21:22:19.421+0000","updated":"2015-02-09T21:22:19.421+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14313065","id":"14313065","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"I think the attached might work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-02-09T22:48:24.172+0000","updated":"2015-02-09T22:48:24.172+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14314028","id":"14314028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12697589/HIVE-9625.1.patch\n\n{color:green}SUCCESS:{color} +1 7540 tests passed\n\nTest results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2736/testReport\nConsole output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2736/console\nTest logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2736/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12697589 - PreCommit-HIVE-TRUNK-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2015-02-10T11:20:43.755+0000","updated":"2015-02-10T11:20:43.755+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14315237","id":"14315237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasadm","name":"prasadm","key":"prasadm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Mujumdar","active":true,"timeZone":"Etc/UTC"},"body":"[~brocknoland] Are you able to verify the patch on with secure HS2, HMS ? \nI suspect that just calling getDelegationToken() on error won't help. AFAIR the expired tokens are not auto renewed. There's a GC thread that runs every hour to remove the expired token. You might have to renew or drop the token before re acquiring it.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasadm","name":"prasadm","key":"prasadm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Mujumdar","active":true,"timeZone":"Etc/UTC"},"created":"2015-02-11T00:10:34.846+0000","updated":"2015-02-11T00:10:34.846+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14329278","id":"14329278","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"Before calling {{getDelegationToken}} we call {{Hive.closeCurrent}} for this reason. I'll test it and see what happens.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-02-20T18:03:17.915+0000","updated":"2015-02-20T18:03:17.915+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14330449","id":"14330449","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"body":"I think that getting a new token on failure is going to be pretty difficult. The only places I can see retrying are in the metastore package in {{HMSC}} or {{RetryingMetastore}} but there is no way to get a new token there. Additionally I believe the token needs to be acquired outside of a {{doas(user)}} call.\n\nLooks like a non-trivial change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brocknoland","name":"brocknoland","key":"brocknoland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brock Noland","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-02-21T21:43:37.655+0000","updated":"2015-02-21T21:43:37.655+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14358052","id":"14358052","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~brocknoland], [~prasadm], could we move this forward?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-12T03:43:40.353+0000","updated":"2015-03-12T03:43:40.353+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14523509","id":"14523509","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasadm","name":"prasadm","key":"prasadm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Mujumdar","active":true,"timeZone":"Etc/UTC"},"body":"[~xuefuz] My apologies for late response. \nThe patch look fine to me. It will handle cases when a long running client sessions, metastore restart or cancellation of ticket by another session etc .\nMetastore has a garbage collection thread that removes expired tokens. However that still leaves a window (1 hour by default) where clients could retrieve a token that's expired or about to expire. I guess an option is for metastore handle expired tokens inline. We can do that in a followup patch.\n\n+1\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasadm","name":"prasadm","key":"prasadm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Mujumdar","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-01T17:42:58.637+0000","updated":"2015-05-01T17:42:58.637+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14523518","id":"14523518","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks, Prasad. I created HIVE-10574 for the followup and it's linked here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-01T17:51:07.167+0000","updated":"2015-05-01T17:51:07.167+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14601641","id":"14601641","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch is rebased with the latest master and branch-1.\n[~prasadm], could you give it another look? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-25T18:05:37.557+0000","updated":"2015-06-25T18:10:07.189+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14601725","id":"14601725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasadm","name":"prasadm","key":"prasadm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Mujumdar","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~xuefuz] for rebasing the patch!\n\n+1 for both master and branch-1 patches.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasadm","name":"prasadm","key":"prasadm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Mujumdar","active":true,"timeZone":"Etc/UTC"},"created":"2015-06-25T18:54:16.765+0000","updated":"2015-06-25T18:54:16.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14602324","id":"14602324","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks all for working on this.\nSeeing the same issue.We then add a re-acquire token step during reconnect and it works.The limitation is that you have to use RetryingMetaStoreClient.\nAnd the benefits is it both works for hiveserver2 and hcatalog(and others that use RetryingMetaStoreClient).Hope this idea can be accepted,too.\nHere is the piece of code changed in HiveMetaStoreClient.java:\n{code:java}\n  @Override\n  public void reconnect() throws MetaException {\n    if (localMetaStore) {\n      // For direct DB connections we don't yet support reestablishing connections.\n      throw new MetaException(\"For direct MetaStore DB connections, we don't support retries\" +\n          \" at the client level.\");\n    } else {\n      // Swap the first element of the metastoreUris[] with a random element from the rest\n      // of the array. Rationale being that this method will generally be called when the default\n      // connection has died and the default connection is likely to be the first array element.\n      promoteRandomMetaStoreURI();\n      reacquireToken();\n      open();\n    }\n  }\n\nprivate void reacquireToken() throws MetaException {\n      if (!conf.getBoolVar(ConfVars.METASTORE_USE_THRIFT_SASL)) {\n        return;\n      }\n\n      String preTokenSig = conf.get(\"hive.metastore.token.signature\");\n      String token = null;\n      try  {\n        token = Utils.getTokenStrForm(preTokenSig);\n      } catch (IOException ex) {\n        LOG.warn(\"Could not get token.\", ex);\n        throw new MetaException(\"Could not get token: \" + ex.getMessage());\n      }\n\n      if (null == preTokenSig || null == token) {\n        return;\n      }\n\n      try {\n        conf.unset(\"hive.metastore.token.signature\");\n        int retriesLeft = RETRY_LIMIT;\n        while (true) {\n          try {\n            final String curUser = conf.getUser();\n            token = UserGroupInformation.getLoginUser().doAs(new PrivilegedExceptionAction<String> () {\n              @Override\n              public String run() throws Exception {\n                HiveMetaStoreClient client = new HiveMetaStoreClient(conf);\n                return client.getDelegationToken(curUser, curUser);\n              }\n            });\n            break;\n          } catch (Exception ex) {\n            if (retriesLeft > 0) {\n              LOG.error(\"Could not get a new token. Attempts left: \" + retriesLeft--, ex);\n              try {\n                Thread.sleep(THIRTY_SECONDS);\n              } catch (InterruptedException ex2) {\n                LOG.debug(\"Sleep is interrupted.\");\n              }\n              continue;\n            }\n            throw new MetaException(\"Could not get a new token: \" + ex.getMessage());\n          }\n        }\n      } finally {\n        conf.set(\"hive.metastore.token.signature\", preTokenSig);\n      }\n      try {\n          Utils.setTokenStr(UserGroupInformation.getCurrentUser(), token, preTokenSig);\n      } catch (IOException e) {\n        LOG.error(\"Couldn't setup delegation token in the ugi\", e);\n        throw new MetaException(\"Couldn't setup delegation token in the ugi: \" + e.getMessage());\n      }\n    }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-06-26T02:57:33.605+0000","updated":"2015-06-26T02:57:33.605+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14604605","id":"14604605","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 no tests executed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12742370/HIVE-9625.1.patch\n\nTest results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4423/testReport\nConsole output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4423/console\nTest logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4423/\n\nMessages:\n{noformat}\n**** This message was trimmed, see log for full details ****\n[INFO] Excluding org.apache.hadoop:hadoop-yarn-common:jar:2.4.0 from the shaded jar.\n[INFO] Excluding com.google.inject.extensions:guice-servlet:jar:3.0 from the shaded jar.\n[INFO] Excluding com.google.inject:guice:jar:3.0 from the shaded jar.\n[INFO] Excluding javax.inject:javax.inject:jar:1 from the shaded jar.\n[INFO] Excluding aopalliance:aopalliance:jar:1.0 from the shaded jar.\n[INFO] Excluding com.sun.jersey.contribs:jersey-guice:jar:1.9 from the shaded jar.\n[INFO] Excluding org.apache.commons:commons-collections4:jar:4.0 from the shaded jar.\n[INFO] Excluding org.apache.tez:tez-runtime-library:jar:0.5.2 from the shaded jar.\n[INFO] Excluding org.apache.tez:tez-common:jar:0.5.2 from the shaded jar.\n[INFO] Excluding org.apache.tez:tez-runtime-internals:jar:0.5.2 from the shaded jar.\n[INFO] Excluding org.apache.tez:tez-mapreduce:jar:0.5.2 from the shaded jar.\n[INFO] Excluding commons-collections:commons-collections:jar:3.2.1 from the shaded jar.\n[INFO] Excluding org.apache.spark:spark-core_2.10:jar:1.3.1 from the shaded jar.\n[INFO] Excluding com.twitter:chill_2.10:jar:0.5.0 from the shaded jar.\n[INFO] Excluding com.twitter:chill-java:jar:0.5.0 from the shaded jar.\n[INFO] Excluding org.apache.hadoop:hadoop-client:jar:1.2.1 from the shaded jar.\n[INFO] Excluding org.apache.spark:spark-network-common_2.10:jar:1.3.1 from the shaded jar.\n[INFO] Excluding org.apache.spark:spark-network-shuffle_2.10:jar:1.3.1 from the shaded jar.\n[INFO] Excluding net.java.dev.jets3t:jets3t:jar:0.7.1 from the shaded jar.\n[INFO] Excluding org.apache.curator:curator-recipes:jar:2.6.0 from the shaded jar.\n[INFO] Excluding org.eclipse.jetty.orbit:javax.servlet:jar:3.0.0.v201112011016 from the shaded jar.\n[INFO] Excluding org.apache.commons:commons-math3:jar:3.1.1 from the shaded jar.\n[INFO] Excluding org.slf4j:jul-to-slf4j:jar:1.7.10 from the shaded jar.\n[INFO] Excluding org.slf4j:jcl-over-slf4j:jar:1.7.10 from the shaded jar.\n[INFO] Excluding com.ning:compress-lzf:jar:1.0.0 from the shaded jar.\n[INFO] Excluding net.jpountz.lz4:lz4:jar:1.2.0 from the shaded jar.\n[INFO] Excluding org.roaringbitmap:RoaringBitmap:jar:0.4.5 from the shaded jar.\n[INFO] Excluding commons-net:commons-net:jar:2.2 from the shaded jar.\n[INFO] Excluding org.spark-project.akka:akka-remote_2.10:jar:2.3.4-spark from the shaded jar.\n[INFO] Excluding org.spark-project.akka:akka-actor_2.10:jar:2.3.4-spark from the shaded jar.\n[INFO] Excluding com.typesafe:config:jar:1.2.1 from the shaded jar.\n[INFO] Excluding org.spark-project.protobuf:protobuf-java:jar:2.5.0-spark from the shaded jar.\n[INFO] Excluding org.uncommons.maths:uncommons-maths:jar:1.2.2a from the shaded jar.\n[INFO] Excluding org.spark-project.akka:akka-slf4j_2.10:jar:2.3.4-spark from the shaded jar.\n[INFO] Excluding org.scala-lang:scala-library:jar:2.10.4 from the shaded jar.\n[INFO] Excluding org.json4s:json4s-jackson_2.10:jar:3.2.10 from the shaded jar.\n[INFO] Excluding org.json4s:json4s-core_2.10:jar:3.2.10 from the shaded jar.\n[INFO] Excluding org.json4s:json4s-ast_2.10:jar:3.2.10 from the shaded jar.\n[INFO] Excluding org.scala-lang:scalap:jar:2.10.0 from the shaded jar.\n[INFO] Excluding org.scala-lang:scala-compiler:jar:2.10.0 from the shaded jar.\n[INFO] Excluding org.apache.mesos:mesos:jar:shaded-protobuf:0.21.0 from the shaded jar.\n[INFO] Excluding com.clearspring.analytics:stream:jar:2.7.0 from the shaded jar.\n[INFO] Excluding io.dropwizard.metrics:metrics-graphite:jar:3.1.0 from the shaded jar.\n[INFO] Excluding com.fasterxml.jackson.module:jackson-module-scala_2.10:jar:2.4.4 from the shaded jar.\n[INFO] Excluding org.scala-lang:scala-reflect:jar:2.10.4 from the shaded jar.\n[INFO] Excluding oro:oro:jar:2.0.8 from the shaded jar.\n[INFO] Excluding org.tachyonproject:tachyon-client:jar:0.5.0 from the shaded jar.\n[INFO] Excluding org.tachyonproject:tachyon:jar:0.5.0 from the shaded jar.\n[INFO] Excluding org.spark-project:pyrolite:jar:2.0.1 from the shaded jar.\n[INFO] Excluding net.sf.py4j:py4j:jar:0.8.2.1 from the shaded jar.\n[INFO] Excluding org.spark-project.spark:unused:jar:1.0.0 from the shaded jar.\n[INFO] Excluding org.apache.hadoop:hadoop-core:jar:1.2.1 from the shaded jar.\n[INFO] Excluding xmlenc:xmlenc:jar:0.52 from the shaded jar.\n[INFO] Excluding com.sun.jersey:jersey-core:jar:1.14 from the shaded jar.\n[INFO] Excluding com.sun.jersey:jersey-json:jar:1.14 from the shaded jar.\n[INFO] Excluding org.codehaus.jettison:jettison:jar:1.1 from the shaded jar.\n[INFO] Excluding com.sun.xml.bind:jaxb-impl:jar:2.2.3-1 from the shaded jar.\n[INFO] Excluding org.codehaus.jackson:jackson-jaxrs:jar:1.9.2 from the shaded jar.\n[INFO] Excluding org.codehaus.jackson:jackson-xc:jar:1.9.2 from the shaded jar.\n[INFO] Excluding com.sun.jersey:jersey-server:jar:1.14 from the shaded jar.\n[INFO] Excluding asm:asm:jar:3.1 from the shaded jar.\n[INFO] Excluding commons-configuration:commons-configuration:jar:1.6 from the shaded jar.\n[INFO] Excluding commons-digester:commons-digester:jar:1.8 from the shaded jar.\n[INFO] Excluding commons-beanutils:commons-beanutils:jar:1.7.0 from the shaded jar.\n[INFO] Excluding commons-beanutils:commons-beanutils-core:jar:1.8.0 from the shaded jar.\n[INFO] Excluding org.mortbay.jetty:jetty:jar:6.1.26 from the shaded jar.\n[INFO] Excluding org.mortbay.jetty:servlet-api:jar:2.5-20081211 from the shaded jar.\n[INFO] Excluding org.mortbay.jetty:jetty-util:jar:6.1.26 from the shaded jar.\n[INFO] Excluding tomcat:jasper-runtime:jar:5.5.12 from the shaded jar.\n[INFO] Excluding tomcat:jasper-compiler:jar:5.5.12 from the shaded jar.\n[INFO] Excluding org.mortbay.jetty:jsp-api-2.1:jar:6.1.14 from the shaded jar.\n[INFO] Excluding org.mortbay.jetty:servlet-api-2.5:jar:6.1.14 from the shaded jar.\n[INFO] Excluding org.mortbay.jetty:jsp-2.1:jar:6.1.14 from the shaded jar.\n[INFO] Excluding ant:ant:jar:1.6.5 from the shaded jar.\n[INFO] Excluding commons-el:commons-el:jar:1.0 from the shaded jar.\n[INFO] Excluding hsqldb:hsqldb:jar:1.8.0.10 from the shaded jar.\n[INFO] Excluding org.eclipse.jdt:core:jar:3.1.1 from the shaded jar.\n[INFO] Excluding org.apache.hadoop:hadoop-tools:jar:1.2.1 from the shaded jar.\n[INFO] Excluding org.slf4j:slf4j-api:jar:1.7.5 from the shaded jar.\n[INFO] Excluding org.slf4j:slf4j-log4j12:jar:1.7.5 from the shaded jar.\n[INFO] Replacing original artifact with shaded artifact.\n[INFO] Replacing /data/hive-ptest/working/apache-github-source-source/ql/target/hive-exec-2.0.0-SNAPSHOT.jar with /data/hive-ptest/working/apache-github-source-source/ql/target/hive-exec-2.0.0-SNAPSHOT-shaded.jar\n[INFO] Dependency-reduced POM written at: /data/hive-ptest/working/apache-github-source-source/ql/dependency-reduced-pom.xml\n[INFO] Dependency-reduced POM written at: /data/hive-ptest/working/apache-github-source-source/ql/dependency-reduced-pom.xml\n[INFO] \n[INFO] --- maven-install-plugin:2.4:install (default-install) @ hive-exec ---\n[INFO] Installing /data/hive-ptest/working/apache-github-source-source/ql/target/hive-exec-2.0.0-SNAPSHOT.jar to /home/hiveptest/.m2/repository/org/apache/hive/hive-exec/2.0.0-SNAPSHOT/hive-exec-2.0.0-SNAPSHOT.jar\n[INFO] Installing /data/hive-ptest/working/apache-github-source-source/ql/dependency-reduced-pom.xml to /home/hiveptest/.m2/repository/org/apache/hive/hive-exec/2.0.0-SNAPSHOT/hive-exec-2.0.0-SNAPSHOT.pom\n[INFO] Installing /data/hive-ptest/working/apache-github-source-source/ql/target/hive-exec-2.0.0-SNAPSHOT-tests.jar to /home/hiveptest/.m2/repository/org/apache/hive/hive-exec/2.0.0-SNAPSHOT/hive-exec-2.0.0-SNAPSHOT-tests.jar\n[INFO] Installing /data/hive-ptest/working/apache-github-source-source/ql/target/hive-exec-2.0.0-SNAPSHOT-core.jar to /home/hiveptest/.m2/repository/org/apache/hive/hive-exec/2.0.0-SNAPSHOT/hive-exec-2.0.0-SNAPSHOT-core.jar\n[INFO]                                                                         \n[INFO] ------------------------------------------------------------------------\n[INFO] Building Hive Service 2.0.0-SNAPSHOT\n[INFO] ------------------------------------------------------------------------\n[INFO] \n[INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hive-service ---\n[INFO] Deleting /data/hive-ptest/working/apache-github-source-source/service/target\n[INFO] Deleting /data/hive-ptest/working/apache-github-source-source/service (includes = [datanucleus.log, derby.log], excludes = [])\n[INFO] \n[INFO] --- maven-enforcer-plugin:1.3.1:enforce (enforce-no-snapshots) @ hive-service ---\n[INFO] \n[INFO] --- build-helper-maven-plugin:1.8:add-source (add-source) @ hive-service ---\n[INFO] Source directory: /data/hive-ptest/working/apache-github-source-source/service/src/model added.\n[INFO] Source directory: /data/hive-ptest/working/apache-github-source-source/service/src/gen/thrift/gen-javabean added.\n[INFO] \n[INFO] --- maven-remote-resources-plugin:1.5:process (default) @ hive-service ---\n[INFO] \n[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hive-service ---\n[INFO] Using 'UTF-8' encoding to copy filtered resources.\n[INFO] skip non existing resourceDirectory /data/hive-ptest/working/apache-github-source-source/service/src/main/resources\n[INFO] Copying 3 resources\n[INFO] \n[INFO] --- maven-antrun-plugin:1.7:run (define-classpath) @ hive-service ---\n[INFO] Executing tasks\n\nmain:\n[INFO] Executed tasks\n[INFO] \n[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hive-service ---\n[INFO] Compiling 177 source files to /data/hive-ptest/working/apache-github-source-source/service/target/classes\n[INFO] -------------------------------------------------------------\n[WARNING] COMPILATION WARNING : \n[INFO] -------------------------------------------------------------\n[WARNING] /data/hive-ptest/working/apache-github-source-source/service/src/java/org/apache/hive/service/cli/operation/SQLOperation.java: Some input files use or override a deprecated API.\n[WARNING] /data/hive-ptest/working/apache-github-source-source/service/src/java/org/apache/hive/service/cli/operation/SQLOperation.java: Recompile with -Xlint:deprecation for details.\n[WARNING] /data/hive-ptest/working/apache-github-source-source/service/src/gen/thrift/gen-javabean/org/apache/hive/service/cli/thrift/TByteColumn.java: Some input files use unchecked or unsafe operations.\n[WARNING] /data/hive-ptest/working/apache-github-source-source/service/src/gen/thrift/gen-javabean/org/apache/hive/service/cli/thrift/TByteColumn.java: Recompile with -Xlint:unchecked for details.\n[INFO] 4 warnings \n[INFO] -------------------------------------------------------------\n[INFO] -------------------------------------------------------------\n[ERROR] COMPILATION ERROR : \n[INFO] -------------------------------------------------------------\n[ERROR] /data/hive-ptest/working/apache-github-source-source/service/src/java/org/apache/hive/service/cli/session/HiveSessionImplwithUGI.java:[150,73] cannot find symbol\n  symbol:   method getUsername()\n  location: class org.apache.hive.service.cli.session.HiveSessionImplwithUGI\n[ERROR] /data/hive-ptest/working/apache-github-source-source/service/src/java/org/apache/hive/service/cli/session/HiveSessionImplwithUGI.java:[150,88] cannot find symbol\n  symbol:   method getUsername()\n  location: class org.apache.hive.service.cli.session.HiveSessionImplwithUGI\n[INFO] 2 errors \n[INFO] -------------------------------------------------------------\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary:\n[INFO] \n[INFO] Hive .............................................. SUCCESS [15.086s]\n[INFO] Hive Shims Common ................................. SUCCESS [12.831s]\n[INFO] Hive Shims 0.20S .................................. SUCCESS [3.294s]\n[INFO] Hive Shims 0.23 ................................... SUCCESS [11.064s]\n[INFO] Hive Shims Scheduler .............................. SUCCESS [1.999s]\n[INFO] Hive Shims ........................................ SUCCESS [2.147s]\n[INFO] Hive Common ....................................... SUCCESS [16.677s]\n[INFO] Hive Serde ........................................ SUCCESS [17.541s]\n[INFO] Hive Metastore .................................... SUCCESS [37.672s]\n[INFO] Hive Ant Utilities ................................ SUCCESS [2.014s]\n[INFO] Spark Remote Client ............................... SUCCESS [21.695s]\n[INFO] Hive Query Language ............................... SUCCESS [2:49.986s]\n[INFO] Hive Service ...................................... FAILURE [9.339s]\n[INFO] Hive Accumulo Handler ............................. SKIPPED\n[INFO] Hive JDBC ......................................... SKIPPED\n[INFO] Hive Beeline ...................................... SKIPPED\n[INFO] Hive CLI .......................................... SKIPPED\n[INFO] Hive Contrib ...................................... SKIPPED\n[INFO] Hive HBase Handler ................................ SKIPPED\n[INFO] Hive HCatalog ..................................... SKIPPED\n[INFO] Hive HCatalog Core ................................ SKIPPED\n[INFO] Hive HCatalog Pig Adapter ......................... SKIPPED\n[INFO] Hive HCatalog Server Extensions ................... SKIPPED\n[INFO] Hive HCatalog Webhcat Java Client ................. SKIPPED\n[INFO] Hive HCatalog Webhcat ............................. SKIPPED\n[INFO] Hive HCatalog Streaming ........................... SKIPPED\n[INFO] Hive HWI .......................................... SKIPPED\n[INFO] Hive ODBC ......................................... SKIPPED\n[INFO] Hive Shims Aggregator ............................. SKIPPED\n[INFO] Hive TestUtils .................................... SKIPPED\n[INFO] Hive Packaging .................................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 5:24.160s\n[INFO] Finished at: Sun Jun 28 05:41:06 EDT 2015\n[INFO] Final Memory: 171M/752M\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.1:compile (default-compile) on project hive-service: Compilation failure: Compilation failure:\n[ERROR] /data/hive-ptest/working/apache-github-source-source/service/src/java/org/apache/hive/service/cli/session/HiveSessionImplwithUGI.java:[150,73] cannot find symbol\n[ERROR] symbol:   method getUsername()\n[ERROR] location: class org.apache.hive.service.cli.session.HiveSessionImplwithUGI\n[ERROR] /data/hive-ptest/working/apache-github-source-source/service/src/java/org/apache/hive/service/cli/session/HiveSessionImplwithUGI.java:[150,88] cannot find symbol\n[ERROR] symbol:   method getUsername()\n[ERROR] location: class org.apache.hive.service.cli.session.HiveSessionImplwithUGI\n[ERROR] -> [Help 1]\n[ERROR] \n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR] \n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException\n[ERROR] \n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR]   mvn <goals> -rf :hive-service\n+ exit 1\n'\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12742370 - PreCommit-HIVE-TRUNK-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2015-06-28T09:41:08.529+0000","updated":"2015-06-28T09:41:08.529+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14604719","id":"14604719","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 at least one tests failed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12742392/HIVE-9625.2.patch\n\n{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 9020 tests executed\n*Failed tests:*\n{noformat}\nTestCliDriver-protectmode2.q-authorization_create_temp_table.q-tez_self_join.q-and-12-more - did not produce a TEST-*.xml file\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_mult_tables\norg.apache.hive.jdbc.TestSSL.testSSLFetchHttp\n{noformat}\n\nTest results: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4426/testReport\nConsole output: http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4426/console\nTest logs: http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4426/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 3 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12742392 - PreCommit-HIVE-TRUNK-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2015-06-28T15:16:03.864+0000","updated":"2015-06-28T15:16:03.864+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14604786","id":"14604786","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"The above test failures seems rather infrastructural. Patch #2 is committed to both master and branch-1. Thanks to Brock and Prasad.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-28T17:19:09.014+0000","updated":"2015-06-28T17:19:09.014+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14604791","id":"14604791","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~nemon], could you please describe what problem your proposal is addressing? I'm not sure if that's for the same problem here or an enhancement to the current solution. Please feel free to create a follow-up JIRA if necessary. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-28T17:22:31.738+0000","updated":"2015-06-28T17:22:31.738+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12773560/comment/14605057","id":"14605057","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"body":"[~xuefuz],thanks for your attention.What i propose is a workaround for the lack of renewing HMS tokens (not only for HiveServer2).The solution has been used in our production environment,and quite follow Thejas M Nair 's advice:\n{quote}\nI think it would be better if we can renew it from a HMS client implementation on a failure-retry, similar to how reloginFromKeyTab was added to the client in HIVE-4233. This way any client of HMS could potentially benefit from this change. \n{quote}\nHere,\"any client of HMS\" can be HiveServer2,WebHcat,Impala,SparkSQL,etc in my opinion.\nSince HIVE-9625 already has its solution and accepted by the Hive community,I think it's ok to fix this problem without the solution i provided.\nAnd thanks Brock Noland and Xuefu Zhang for working on this.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nemon","name":"nemon","key":"nemon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nemon&avatarId=22931","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nemon&avatarId=22931","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nemon&avatarId=22931","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nemon&avatarId=22931"},"displayName":"Nemon Lou","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-06-29T02:52:26.197+0000","updated":"2015-06-29T02:52:26.197+0000"}],"maxResults":19,"total":19,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-9625/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i25dsn:"}}