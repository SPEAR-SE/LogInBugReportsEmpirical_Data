{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12519372","self":"https://issues.apache.org/jira/rest/api/2/issue/12519372","key":"HIVE-2395","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2011-08-23T17:41:50.882+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Sep 01 16:26:55 UTC 2012","customfield_12310420":"42137","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_32786340702_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-09-01T16:26:55.525+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-2395/watchers","watchCount":3,"isWatching":false},"created":"2011-08-19T05:07:54.852+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316336","id":"12316336","description":"released","name":"0.7.1","archived":false,"released":true,"releaseDate":"2011-06-21"}],"issuelinks":[{"id":"12350418","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12350418","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12409298","key":"HIVE-80","self":"https://issues.apache.org/jira/rest/api/2/issue/12409298","fields":{"summary":"Add testcases for concurrent query execution","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/6","id":"6","description":"A new unit, integration or system test.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/requirement.png","name":"Test","subtask":false}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-09-01T16:26:55.553+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312585","id":"12312585","name":"Serializers/Deserializers","description":"Tracks issues dealing with serdes"}],"timeoriginalestimate":null,"description":"We have a {{/tables/}} directory containing .lzo files with our data, compressed using lzop.\n\nWe {{CREATE EXTERNAL TABLE}} on top of this directory, using {{STORED AS INPUTFORMAT \"com.hadoop.mapred.DeprecatedLzoTextInputFormat\"}}.\n\n.lzo files require that an LzoIndexer is run on them. When this is done, .lzo.index file is created for every .lzo file, so we end up with:\n\n{noformat}\n/tables/ourdata_2011-08-19.lzo\n/tables/ourdata_2011-08-19.lzo.index\n/tables/ourdata_2011-08-18.lzo\n/tables/ourdata_2011-08-18.lzo.index\n..etc\n{noformat}\n\nThe issue is that org.apache.hadoop.hive.ql.io.CombineHiveRecordReader is attempting to getRecordReader() for .lzo.index files. This throws a pretty confusing exception:\n\n{noformat}\nCaused by: java.io.IOException: No LZO codec found, cannot run.\n        at com.hadoop.mapred.DeprecatedLzoLineRecordReader.<init>(DeprecatedLzoLineRecordReader.java:53)\n        at com.hadoop.mapred.DeprecatedLzoTextInputFormat.getRecordReader(DeprecatedLzoTextInputFormat.java:128)\n        at org.apache.hadoop.hive.ql.io.CombineHiveRecordReader.<init>(CombineHiveRecordReader.java:68)\n{noformat}\n\nMore precisely, it dies on second invocation of getRecordReader() - here is some System.out.println() output:\n\n{noformat}\nDeprecatedLzoTextInputFormat.getRecordReader(): split=/tables/ourdata_2011-08-19.lzo:0+616479\nDeprecatedLzoTextInputFormat.getRecordReader(): split=/tables/ourdata_2011-08-19.lzo.index:0+64\n{noformat}\n\nDeprecatedLzoTextInputFormat contains the following code which causes the ultimate exception and death of query, as it obviously doesn't have a codec to read .lzo.index files.\n\n{noformat}\n    final CompressionCodec codec = codecFactory.getCodec(file);\n    if (codec == null) {\n      throw new IOException(\"No LZO codec found, cannot run.\");\n    }\n{noformat}\n\nSo I understand that the way things are right now is that Hive considers all files within a directory to be part of a table. There is an open patch HIVE-951 which would allow a quick workaround for this problem.\n\nDoes it make sense to add some hooks so that CombineHiveRecordReader or its parents are more aware of what files should be considered instead of blindly trying to read everything?\n\nAny suggestions for a quick workaround to make it skip .index files?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"123860","customfield_12312823":null,"summary":"Misleading \"No LZO codec found, cannot run.\" exception when using external table and LZO / DeprecatedLzoTextInputFormat","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vitaliy.fuks","name":"vitaliy.fuks","key":"vitaliy.fuks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vitaliy Fuks","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vitaliy.fuks","name":"vitaliy.fuks","key":"vitaliy.fuks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vitaliy Fuks","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Cloudera 3u1 with https://github.com/kevinweil/hadoop-lzo or https://github.com/kevinweil/elephant-bird","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519372/comment/13089612","id":"13089612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"body":"> .lzo files require that an LzoIndexer is run on them.\n\nThis is not a requirement. You need the index file only if you want split large lzo files. You could just remove the index files as a quick workaround (in which case you might as well use just TextInputFormat ).\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-08-23T17:41:50.882+0000","updated":"2011-08-23T17:41:50.882+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519372/comment/13089907","id":"13089907","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vitaliy.fuks","name":"vitaliy.fuks","key":"vitaliy.fuks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vitaliy Fuks","active":true,"timeZone":"America/New_York"},"body":"Right, of course, and that's the workaround we went with. With smaller-than-block files it really doesn't matter.\n\nAfter I filed this ticket I did a quick and dirty hack on DeprecatedLzoTextInputFormat to ignore .lzo.index files. However, I actually found that it doesn't read larger-than-block-size .lzo files correctly at all - it either crashes with things like ArrayIndexOutOfBoundsException in LzoDecompressor.setInput() or just outright ignores all data beyond the block size. This would happen even if .lzo.index files were absent.\n\nSo then I recreated tables without using INPUTFORMAT \"DeprecatedLzoTextInputFormat\" and it's returning correct data. It still attempts to read .lzo.index files as data so we are going un-indexed as a workaround (with the lack of splitting as the side effect, obviously). At this point, I wasn't sure why we were using DeprecatedLzoTextInputFormat in the first place, other than Google \"told\" us to. Maybe Hive codebase moved beyond needing it?\n\nI will try code changes from https://github.com/kevinweil/hadoop-lzo/pull/28 when I have some free time.\n\nPS. Our hadoop-lzo.jar is from January 2011 release (v0.4.8) built by Gerrit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vitaliy.fuks","name":"vitaliy.fuks","key":"vitaliy.fuks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vitaliy Fuks","active":true,"timeZone":"America/New_York"},"created":"2011-08-24T00:47:03.397+0000","updated":"2011-08-24T00:47:03.397+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519372/comment/13446757","id":"13446757","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vitaliy.fuks","name":"vitaliy.fuks","key":"vitaliy.fuks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vitaliy Fuks","active":true,"timeZone":"America/New_York"},"body":"Latest hadoop-lzo libraries do not exhibit this behavior.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vitaliy.fuks","name":"vitaliy.fuks","key":"vitaliy.fuks","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vitaliy Fuks","active":true,"timeZone":"America/New_York"},"created":"2012-09-01T16:26:55.534+0000","updated":"2012-09-01T16:26:55.534+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-2395/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ljtb:"}}