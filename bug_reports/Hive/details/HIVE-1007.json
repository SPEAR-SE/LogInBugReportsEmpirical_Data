{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12444022","self":"https://issues.apache.org/jira/rest/api/2/issue/12444022","key":"HIVE-1007","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2009-12-22T16:33:25.200+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jun 16 00:38:14 UTC 2010","customfield_12310420":"42657","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-1007/watchers","watchCount":1,"isWatching":false},"created":"2009-12-22T15:19:44.279+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314225","id":"12314225","description":"released","name":"0.4.1","archived":false,"released":true,"releaseDate":"2009-12-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlerman","name":"dlerman","key":"dlerman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Lerman","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-06-16T00:38:14.523+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"In a multi-stage query, when one stage returns no data (resulting in a bunch of output files with size 0), the next stage creates a job with 0 mappers which just sits in the Hadoop task track forever and hangs the query at 0%.  The issue is that CombineHiveInputFormat looks for blocks to populate splits, find nones (since input is all 0 bytes), and then returns an empty array from getSplits.\n\nThere may be good a way to just skip that job altogether, but as a quick hack to get it working, when there are no splits, I just create a single empty one using the first path so that the job doesn't hang.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12428736","id":"12428736","filename":"hive.1007.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlerman","name":"dlerman","key":"dlerman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Lerman","active":true,"timeZone":"Etc/UTC"},"created":"2009-12-22T15:20:21.026+0000","size":1203,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12428736/hive.1007.1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"122744","customfield_12312823":null,"summary":"CombinedHiveInputFormat fails with empty input","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlerman","name":"dlerman","key":"dlerman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Lerman","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlerman","name":"dlerman","key":"dlerman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Lerman","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12444022/comment/12793660","id":"12793660","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"The patch is getting a bunch of compile errors.\n\nAlso, shouldn't the job have 1 split, since an empty file is present - I mean, how is it different from running a job with a empty\ndirectory (or a directory with 0 size files). Seems like the code in HiveInputFormat and CombineFileInputFormat should be same\nthere.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-12-22T16:33:25.200+0000","updated":"2009-12-22T16:33:25.200+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12444022/comment/12793675","id":"12793675","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlerman","name":"dlerman","key":"dlerman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Lerman","active":true,"timeZone":"Etc/UTC"},"body":"Sorry about the non-compiling patch -  it requires a few changes to get working and I thought I'd check on the approach before I do that. \n\nI believe the underlying issue is in Hadoop. FileInputFormat.getSplits actually creates an empty InputSplit for each empty input file: \n\n{code} \nif (length != 0) { \n        ... \n} else { \n  //Create empty hosts array for zero length files \n  splits.add(new FileSplit(path, 0, length, new String[0])); \n} \n{code} \n\nso if you pass all empty files, you'll still get a mapper per input file. However, with CombineFileInputFormat.getSplits, it looks at the list of blocks and creates splits made up of all the blocks it finds, so if you pass all empty files, it returns an empty list which hangs Hadoop. \n\nI'm using Cloudera's hadoop-0.20.1+152, so maybe this is fixed in a more recent Hadoop, but if not, I can file a bug in Hadoop and/or could add a workaround in Hive which creates an empty split if CombineFileInputFormat.getSplits returns an empty list.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlerman","name":"dlerman","key":"dlerman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Lerman","active":true,"timeZone":"Etc/UTC"},"created":"2009-12-22T17:08:58.065+0000","updated":"2009-12-22T17:08:58.065+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12444022/comment/12793779","id":"12793779","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":" jar -xvf ./build/hadoopcore/hadoop-0.20.0/hadoop-0.20.0-core.jar\n\nUsing hadoop.version 0.20.0,\n\nThe following test works fine:\n\n t hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;\n\nDROP TABLE nullscript;\nCREATE TABLE nullscript(KEY STRING, VALUE STRING) STORED AS TEXTFILE;\n\nLOAD DATA LOCAL INPATH '../data/files/nullfile.txt' INTO TABLE nullscript;\n\nselect transform(key) using '/bin/cat' as key1 from nullscript;\n\n\nDROP TABLE nullscript;\n\n\n\nand we can 1 split:\n\n    [junit] 09/12/22 10:45:24 INFO io.CombineHiveInputFormat: number of splits 1\n\n\nSeems like a hadoop bug","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-12-22T20:52:51.210+0000","updated":"2009-12-22T20:52:51.210+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12444022/comment/12795792","id":"12795792","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlerman","name":"dlerman","key":"dlerman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Lerman","active":true,"timeZone":"Etc/UTC"},"body":"Here's steps to reproduce:\n\nUsing Cloudera's Hadoop 0.20.1+152 (since the CombineFile functionality doesn't work in 0.20.1 without the extra patches), and latest Hive trunk (895060)\n\nSET hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;\nDROP TABLE nullscript;\nCREATE TABLE nullscript(KEY STRING, VALUE STRING) STORED AS TEXTFILE;\nLOAD DATA LOCAL INPATH 'data/files/nullfile.txt' INTO TABLE nullscript;\nselect key from nullscript group by key;\n\nFrom the log:\n2010-01-01 15:36:18,372 INFO  io.CombineHiveInputFormat (CombineHiveInputFormat.java:getSplits(252)) - CombineHiveInputSplit creating pool for /user/hive/warehouse/nullscript\n2010-01-01 15:36:18,584 INFO  mapred.FileInputFormat (FileInputFormat.java:listStatus(192)) - Total input paths to process : 1\n2010-01-01 15:36:18,781 INFO  io.CombineHiveInputFormat (CombineHiveInputFormat.java:getSplits(262)) - number of splits 0\n\nThis yields a MR job with 0 mappers and 1 reducer which hangs in Hadoop at 0%.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlerman","name":"dlerman","key":"dlerman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Lerman","active":true,"timeZone":"Etc/UTC"},"created":"2010-01-01T20:42:41.230+0000","updated":"2010-01-01T20:42:41.230+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12444022/comment/12879140","id":"12879140","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"Is this still a problem - I think this problem has been fixed in open source some time back.\nIf yes, can you close the jira ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2010-06-15T22:07:35.720+0000","updated":"2010-06-15T22:07:35.720+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12444022/comment/12879206","id":"12879206","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlerman","name":"dlerman","key":"dlerman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Lerman","active":true,"timeZone":"Etc/UTC"},"body":"Tried the steps above on Hadoop 0.20.2.  It still logs \"number of splits 0\", but instead of hanging at 0%, it completes the map, then fails with a \"Shuffle Error: Exceeded MAX_FAILED_UNIQUE_FETCHES; bailing-out.\" in the reduce.  This is clearly preferable to hanging and doesn't seem like a totally unreasonable result when asking for data from an empty file -- should I close the ticket?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlerman","name":"dlerman","key":"dlerman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Lerman","active":true,"timeZone":"Etc/UTC"},"created":"2010-06-16T00:38:14.451+0000","updated":"2010-06-16T00:38:14.451+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-1007/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0lcxb:"}}