{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12932103","self":"https://issues.apache.org/jira/rest/api/2/issue/12932103","key":"HIVE-12884","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2016-07-22T11:08:21.045+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Aug 09 18:29:58 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_17658955738_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2016-08-09T18:29:58.492+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-12884/watchers","watchCount":2,"isWatching":false},"created":"2016-01-18T09:14:02.992+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329557","id":"12329557","name":"1.1.1","archived":false,"released":true,"releaseDate":"2015-05-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gszadovszky","name":"gszadovszky","key":"gszadovszky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gszadovszky&avatarId=29443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gszadovszky&avatarId=29443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gszadovszky&avatarId=29443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gszadovszky&avatarId=29443"},"displayName":"Gabor Szadovszky","active":true,"timeZone":"Europe/Budapest"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-08-09T18:29:58.727+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"When I make a query like the following in Hive CLI I get a NullPointerException in HiveParser.regularBody().\n\n{code}\ncreate table some_table\n(\n    day_timestamp bigint,\n    guid_count bigint\n)\nrow format delimited fields terminated by ',' stored as textfile;\n\nSET hive.merge.mapredfiles=true;\nSET mapreduce.input.fileinputformat.split.maxsize=5368709120;\n\nSET hivevar:tz_offset=8;\nSET hivevar:day_in_millis=86400000;\n\nSET hivevar:year=2015;\nSET hivevar:month=02;\nSET hivevar:next_month=03;\n\ninsert into table some_table\nselect\n  day_timestamp\n  count(*) as guid_count\nfrom (\n  select distinct\n    guid,\n    floor((`timestamp` / ${day_in_millis}) - ${tz_offset}) * ${day_in_millis} as day_timestamp,\n  from source_table\n  where year = ${year} and ((month = ${month}) or ((month = ${next_month}) and (day = '01')))\n) guids\ngroup by day_timestamp;\n{code}\n\n/tmp/username/hive.log:\n\n{code}\n2016-01-18 10:05:40,505 ERROR [main]: ql.Driver (SessionState.java:printError(861)) - FAILED: NullPointerException null\njava.lang.NullPointerException\n        at org.apache.hadoop.hive.ql.parse.HiveParser.regularBody(HiveParser.java:40975)\n        at org.apache.hadoop.hive.ql.parse.HiveParser.queryStatementExpressionBody(HiveParser.java:40183)\n        at org.apache.hadoop.hive.ql.parse.HiveParser.queryStatementExpression(HiveParser.java:40059)\n        at org.apache.hadoop.hive.ql.parse.HiveParser.execStatement(HiveParser.java:1519)\n        at org.apache.hadoop.hive.ql.parse.HiveParser.statement(HiveParser.java:1057)\n        at org.apache.hadoop.hive.ql.parse.ParseDriver.parse(ParseDriver.java:199)\n        at org.apache.hadoop.hive.ql.parse.ParseDriver.parse(ParseDriver.java:166)\n        at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:393)\n        at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:307)\n        at org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:1112)\n        at org.apache.hadoop.hive.ql.Driver.runInternal(Driver.java:1160)\n        at org.apache.hadoop.hive.ql.Driver.run(Driver.java:1049)\n        at org.apache.hadoop.hive.ql.Driver.run(Driver.java:1039)\n        at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:207)\n        at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:159)\n        at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:370)\n        at org.apache.hadoop.hive.cli.CliDriver.executeDriver(CliDriver.java:754)\n        at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:675)\n        at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:615)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:606)\n        at org.apache.hadoop.util.RunJar.run(RunJar.java:221)\n        at org.apache.hadoop.util.RunJar.main(RunJar.java:136)\n{code}\n\nHive 1.1.1 compiled from source with checksum c2d70ca009729fb13c073d599b4e5193.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12819591","id":"12819591","filename":"HIVE-12884.q","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gszadovszky","name":"gszadovszky","key":"gszadovszky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gszadovszky&avatarId=29443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gszadovszky&avatarId=29443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gszadovszky&avatarId=29443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gszadovszky&avatarId=29443"},"displayName":"Gabor Szadovszky","active":true,"timeZone":"Europe/Budapest"},"created":"2016-07-22T11:08:21.040+0000","size":1271,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12819591/HIVE-12884.q"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"NullPointerException in HiveParser.regularBody()","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bzamecnik","name":"bzamecnik","key":"bzamecnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bohumir Zamecnik","active":true,"timeZone":"Europe/Prague"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bzamecnik","name":"bzamecnik","key":"bzamecnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bohumir Zamecnik","active":true,"timeZone":"Europe/Prague"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12932103/comment/15105015","id":"15105015","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bzamecnik","name":"bzamecnik","key":"bzamecnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bohumir Zamecnik","active":true,"timeZone":"Europe/Prague"},"body":"So the query was malformed. There's missing comma between day_timestamp and count(*) as guid_count.\n\nAnyway the parser should report a syntax error, not fail on a NPE.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bzamecnik","name":"bzamecnik","key":"bzamecnik","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bohumir Zamecnik","active":true,"timeZone":"Europe/Prague"},"created":"2016-01-18T09:47:05.141+0000","updated":"2016-01-18T09:47:05.141+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12932103/comment/15389327","id":"15389327","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gszadovszky","name":"gszadovszky","key":"gszadovszky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gszadovszky&avatarId=29443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gszadovszky&avatarId=29443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gszadovszky&avatarId=29443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gszadovszky&avatarId=29443"},"displayName":"Gabor Szadovszky","active":true,"timeZone":"Europe/Budapest"},"body":"Actually, there are two mistakes in the query. One is mentioned above, the other one is an extra ',' at the end of line \"floor((`timestamp` ...\".\nWas not able to reproduce the NPE with any combinations of the mentioned mistakes on the latest Hive 2.2.0. In any combinations ParseExceptions were thrown.\nSee the attached query file created to reproduce the issue. \n(After correcting the mentioned mistakes the query runs smoothly.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gszadovszky","name":"gszadovszky","key":"gszadovszky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gszadovszky&avatarId=29443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gszadovszky&avatarId=29443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gszadovszky&avatarId=29443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gszadovszky&avatarId=29443"},"displayName":"Gabor Szadovszky","active":true,"timeZone":"Europe/Budapest"},"created":"2016-07-22T11:08:21.045+0000","updated":"2016-07-22T11:08:21.045+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12932103/comment/15413977","id":"15413977","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gszadovszky","name":"gszadovszky","key":"gszadovszky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gszadovszky&avatarId=29443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gszadovszky&avatarId=29443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gszadovszky&avatarId=29443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gszadovszky&avatarId=29443"},"displayName":"Gabor Szadovszky","active":true,"timeZone":"Europe/Budapest"},"body":"Closed as I was not able to reproduce. Feel free to reopen if reproduced or additional information is available.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gszadovszky","name":"gszadovszky","key":"gszadovszky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gszadovszky&avatarId=29443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gszadovszky&avatarId=29443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gszadovszky&avatarId=29443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gszadovszky&avatarId=29443"},"displayName":"Gabor Szadovszky","active":true,"timeZone":"Europe/Budapest"},"created":"2016-08-09T18:29:58.590+0000","updated":"2016-08-09T18:29:58.590+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-12884/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2rmsf:"}}