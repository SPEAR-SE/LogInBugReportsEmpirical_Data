{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12764101","self":"https://issues.apache.org/jira/rest/api/2/issue/12764101","key":"HIVE-9223","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-01-02T20:03:14.463+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jun 15 04:34:42 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-9223/watchers","watchCount":22,"isWatching":false},"created":"2014-12-30T00:36:04.461+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-06-15T04:34:42.441+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12320408","id":"12320408","name":"HiveServer2","description":"Tracks issues related to HiveServer2"}],"timeoriginalestimate":null,"description":"When a user submits multiple queries in the same HS2 session (using thrift interface) concurrently, the query goes through the same TezSessionState and ends up being submitted to the same Tez AM, and the second query fails with the error \"App master already running a DAG\"\n\nIs this by design? I looked into the code, and the comments as well as the code suggest support only for serial execution of queries within the same HiveServer2 session (on tez). \n\nThis works for CLI environment but in a server, it is plausible that client sends multiple concurrent queries under the same session (e.g: a web app that executes queries for user, such as Cloudera Hue). So shouldn't HS2 on Tez implementation support concurrent queries?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"HiveServer2 on Tez doesn't support concurrent queries within one session","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pala","name":"pala","key":"pala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pala M Muthaia","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pala","name":"pala","key":"pala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pala M Muthaia","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764101/comment/14260599","id":"14260599","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pala","name":"pala","key":"pala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pala M Muthaia","active":true,"timeZone":"America/Los_Angeles"},"body":"[~hagleitn] & [~vikram.dixit], could you comment? I am trying to get the big picture to determine what the right fix should be. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pala","name":"pala","key":"pala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pala M Muthaia","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-12-30T00:37:25.977+0000","updated":"2014-12-30T00:37:25.977+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764101/comment/14263199","id":"14263199","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"body":"[~pala] can you let us know what is the scenario here? Do you mean to say that you have a single hs2 session that multiple queries are concurrently being fired to? How are you doing that? Does this work in mapreduce? Any light on this matter would be useful for identifying the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-02T20:03:14.463+0000","updated":"2015-01-02T20:03:14.463+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764101/comment/14265151","id":"14265151","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pala","name":"pala","key":"pala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pala M Muthaia","active":true,"timeZone":"America/Los_Angeles"},"body":"Yes, single HS2 session that receive multiple queries. I can do that by using the Cloudera Hue UI for Hadoop. Basically i open multiple tabs after logging in -  and submit queries concurrently. Internally, it submits the queries to HS2 thrift interface using the same session id header/cookie, and HS2 uses the same session state for both queries, and hit this issue.\n\nYes this works in mapreduce. Each query, despite being in the same HS2 session, are submitted as different MR application to YARN naturally, because there is no notion of application reuse for MR. For Tez, on the other hand, a Tez application is tied to HS2 session and an attempt to reuse the Tez application is done (and fails in this case).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pala","name":"pala","key":"pala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pala M Muthaia","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-05T21:39:27.442+0000","updated":"2015-01-05T21:39:27.442+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764101/comment/14265300","id":"14265300","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pala","name":"pala","key":"pala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pala M Muthaia","active":true,"timeZone":"America/Los_Angeles"},"body":"[~vikram.dixit]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pala","name":"pala","key":"pala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pala M Muthaia","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-05T23:09:52.809+0000","updated":"2015-01-05T23:09:52.809+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764101/comment/14277829","id":"14277829","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"body":"[~pala] I see how this can happen now. In tez only one DAG is allowed to run at a time. MR subverts this issue by just launching multiple jobs when such a parallel submission is done. However, this change is not easy to do in case of tez right now and we need to have a design to support concurrency at this level. I am exploring some options with the tez folks and will get back to you on this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-14T22:48:53.860+0000","updated":"2015-01-14T22:48:53.860+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764101/comment/14481514","id":"14481514","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pala","name":"pala","key":"pala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pala M Muthaia","active":true,"timeZone":"America/Los_Angeles"},"body":"[~vikram.dixit], did anything come out of this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pala","name":"pala","key":"pala","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pala M Muthaia","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-06T18:01:49.351+0000","updated":"2015-04-06T18:01:49.351+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764101/comment/14482490","id":"14482490","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rbains","name":"rbains","key":"rbains","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Raj Bains","active":true,"timeZone":"America/Los_Angeles"},"body":"Queries within the same session should execute serially. Hue should open a new session when you use a new tab. Each tab can be considered a script where queries run sequentially. Otherwise how can I guarantee that a query creating a temporary table and the one following it that reads the temporary table are processed in order? Are we depending on UI tabs for that? The previous MR behavior seems to be a bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rbains","name":"rbains","key":"rbains","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10438","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10438","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10438","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10438"},"displayName":"Raj Bains","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-07T02:56:19.131+0000","updated":"2015-04-07T02:56:19.131+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764101/comment/14902535","id":"14902535","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejan.menges","name":"dejan.menges","key":"dejan.menges","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Menges","active":true,"timeZone":"Etc/UTC"},"body":"Hi,\n\nIs there any progress on this one? Or at least some plans when this could be solved?\n\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dejan.menges","name":"dejan.menges","key":"dejan.menges","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dejan Menges","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-22T12:52:04.687+0000","updated":"2015-09-22T12:52:04.687+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12764101/comment/16513323","id":"16513323","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jason4zz","name":"jason4zz","key":"jason4zz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Z","active":true,"timeZone":"Etc/UTC"},"body":"[~pala] hi, any progress or workaround on this issue? I'm facing exactly the same scenario as described here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jason4zz","name":"jason4zz","key":"jason4zz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Z","active":true,"timeZone":"Etc/UTC"},"created":"2018-06-15T04:34:42.441+0000","updated":"2018-06-15T04:34:42.441+0000"}],"maxResults":9,"total":9,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-9223/votes","votes":9,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i23tzb:"}}