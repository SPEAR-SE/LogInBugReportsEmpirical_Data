{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13175750","self":"https://issues.apache.org/jira/rest/api/2/issue/13175750","key":"HIVE-20276","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-07-31T15:29:41.283+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Aug 01 05:39:16 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-20276/watchers","watchCount":3,"isWatching":false},"created":"2018-07-31T07:00:44.531+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332384","id":"12332384","name":"1.2.1","archived":false,"released":true,"releaseDate":"2015-06-26"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335838","id":"12335838","description":"Maintenance branch for 2.1 ","name":"2.1.1","archived":false,"released":true,"releaseDate":"2016-12-08"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-08-01T05:41:22.379+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"* I have created One Hive UDF class and register its function in spark.\r\n * In hive query inside spark session object  i call this function\r\n * Now when i run my code i observe on each time when function called it create new instance of UDF class.\r\n * Is it normal behavior? On each call should it create new instance?\r\n * Is it version specific issue? ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Hive UDF class getting Instantiated for each call of function","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hardik1808","name":"hardik1808","key":"hardik1808","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hardik Trivedi","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hardik1808","name":"hardik1808","key":"hardik1808","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hardik Trivedi","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13175750/comment/16563838","id":"16563838","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~hardik1808] Could you give some code examples of the usage of your UDF in your code? In Hive, one usually registers a UDF and uses it in the query. Thus, I'm not sure what you meant by calling the UDF in your code or spark session object.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-07-31T15:29:41.283+0000","updated":"2018-07-31T15:29:41.283+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13175750/comment/16564763","id":"16564763","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hardik1808","name":"hardik1808","key":"hardik1808","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hardik Trivedi","active":true,"timeZone":"Etc/UTC"},"body":"[~xuefuz] many thanks for your quick respond. \r\n\r\n*I can provide overview of what i implement as bellow.*\r\n\r\n*we have create one class which extends USD class as bellow*\r\n\r\n{color:#59afe1}public class Strip extends UDF \\{    private static int count = 0;     public Strip()\\{       System.out.println(count);       count++;     }\r\n \r\n      public String evaluate(String str) \\{        ...............         .........  return \"...\" ;    }\r\n }{color} \r\n\r\n*Also create and Register Temporary function as bellow*\r\n {color:#59afe1}sparkSession.sql(\"CREATE TEMPORARY FUNCTION STRIP AS 'org.packageName.Strip'\");\r\n  {color}\r\n\r\n*And use this function in query while creating table*\r\n  \r\n {color:#59afe1}create external table XYZ location ABC \r\n AS select STRIP(firstName) AS FirstName,STRIP(lastName) AS LastName,age AS AGE,STRIP(address) AS Address from PQRTable;{color}\r\n  \r\n Now if i run my code it is working fine it create new table XYZ on particular location, but if you note that i have create one constrictor in Strip class which increase counter and print it.\r\n So if PQRTable have 10 rows with 40 records then my temp function is called 30 times that is fine but each time it create new instance of Strip class. On console it will print 30.\r\n what if PQRTable have 40,000,000 records then it will create 30,000,000 instance which is vulnerable thing.\r\n\r\n*{color:#654982}I want that, this Strip class should work as singleton class, Because this class extends UDF class, I can not make it externally singleton it will throw accessRestricted exception and i can not use UDF functionality.{color}*\r\n  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hardik1808","name":"hardik1808","key":"hardik1808","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hardik Trivedi","active":true,"timeZone":"Etc/UTC"},"created":"2018-08-01T05:39:16.247+0000","updated":"2018-08-01T05:41:22.373+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-20276/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3wi9j:"}}