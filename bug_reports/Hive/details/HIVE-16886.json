{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13079310","self":"https://issues.apache.org/jira/rest/api/2/issue/13079310","key":"HIVE-16886","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12340268","id":"12340268","name":"3.0.0","archived":false,"released":true,"releaseDate":"2018-05-21"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-06-13T02:20:51.843+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jul 27 05:14:21 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_6057801543_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_1758671841","customfield_12312321":null,"resolutiondate":"2017-09-11T08:14:45.787+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-16886/watchers","watchCount":11,"isWatching":false},"created":"2017-06-12T21:00:12.489+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["TODOC3.0","pull-request-available"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"9.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12340268","id":"12340268","name":"3.0.0","archived":false,"released":true,"releaseDate":"2018-05-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12342053","id":"12342053","name":"2.3.2","archived":false,"released":true,"releaseDate":"2017-11-13"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12342162","id":"12342162","name":"2.3.3","archived":false,"released":false,"releaseDate":"2018-04-03"}],"issuelinks":[{"id":"12512848","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12512848","type":{"id":"12310361","name":"Blocked","inward":"Blocked","outward":"Blocked","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310361"},"inwardIssue":{"id":"13095122","key":"SENTRY-1885","self":"https://issues.apache.org/jira/rest/api/2/issue/13095122","fields":{"summary":"Remove unused NOTIFICATION_ID from the SENTRY_PATH_CHANGE table","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12511528","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12511528","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"13074098","key":"HIVE-16738","self":"https://issues.apache.org/jira/rest/api/2/issue/13074098","fields":{"summary":"Notification ID generation in DBNotification might not be unique across HS2 instances.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12512669","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12512669","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"13088777","key":"SENTRY-1855","self":"https://issues.apache.org/jira/rest/api/2/issue/13088777","fields":{"summary":"Improve scalability of permission delta updates","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12525144","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12525144","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"13126846","key":"SENTRY-2109","self":"https://issues.apache.org/jira/rest/api/2/issue/13126846","fields":{"summary":"Fix the logic of identifying HMS out of Sync and handle gaps and out-of-sequence notifications.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12522526","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12522526","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"13125770","key":"HIVE-18300","self":"https://issues.apache.org/jira/rest/api/2/issue/13125770","fields":{"summary":"Use LAST_INSERT_ID for Sequence Tables for MySQL","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/5","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/trivial.svg","name":"Trivial","id":"5"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}},{"id":"12512640","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12512640","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13096782","key":"SENTRY-1895","self":"https://issues.apache.org/jira/rest/api/2/issue/13096782","fields":{"summary":"Sentry should handle the case of multiple notifications with the same ID","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}},{"id":"12529215","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12529215","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13144595","key":"HIVE-18940","self":"https://issues.apache.org/jira/rest/api/2/issue/13144595","fields":{"summary":"Hive notifications serialize all write DDL operations","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12527727","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12527727","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13140102","key":"HIVE-18768","self":"https://issues.apache.org/jira/rest/api/2/issue/13140102","fields":{"summary":"Use Datanucleus to serialize notification updates","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12506359","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12506359","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13074098","key":"HIVE-16738","self":"https://issues.apache.org/jira/rest/api/2/issue/13074098","fields":{"summary":"Notification ID generation in DBNotification might not be unique across HS2 instances.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12516766","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12516766","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13107663","key":"HIVE-17735","self":"https://issues.apache.org/jira/rest/api/2/issue/13107663","fields":{"summary":"ObjectStore.addNotificationEvent is leaking queries","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12517043","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12517043","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13108283","key":"HIVE-17758","self":"https://issues.apache.org/jira/rest/api/2/issue/13108283","fields":{"summary":"NOTIFICATION_SEQUENCE_LOCK_RETRY_SLEEP_INTERVAL.defaultLongVal is -1","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12525258","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12525258","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13126340","key":"SENTRY-2106","self":"https://issues.apache.org/jira/rest/api/2/issue/13126340","fields":{"summary":"If Sentry is ahead do not trigger a full snapshot","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-07-27T05:14:21.849+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12325007","id":"12325007","name":"Hive"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312584","id":"12312584","name":"Metastore","description":"Tracks issue dealing with metastore."}],"timeoriginalestimate":null,"description":"When running multiple Hive Metastore servers and DB notifications are enabled, I could see that notifications can be persisted with a duplicated event ID. \n\nThis does not happen when running multiple threads in a single HMS node due to the locking acquired on the DbNotificationsLog class, but multiple HMS could cause conflicts.\n\nThe issue is in the ObjectStore#addNotificationEvent() method. The event ID fetched from the datastore is used for the new notification, incremented in the server itself, then persisted or updated back to the datastore. If 2 servers read the same ID, then these 2 servers write a new notification with the same ID.\n\nThe event ID is not unique nor a primary key.\n\nHere's a test case using the TestObjectStore class that confirms this issue:\n\n{noformat}\n@Test\n  public void testConcurrentAddNotifications() throws ExecutionException, InterruptedException {\n    final int NUM_THREADS = 2;\n    CountDownLatch countIn = new CountDownLatch(NUM_THREADS);\n    CountDownLatch countOut = new CountDownLatch(1);\n\n    HiveConf conf = new HiveConf();\n    conf.setVar(HiveConf.ConfVars.METASTORE_EXPRESSION_PROXY_CLASS, MockPartitionExpressionProxy.class.getName());\n\n    ExecutorService executorService = Executors.newFixedThreadPool(NUM_THREADS);\n    FutureTask<Void> tasks[] = new FutureTask[NUM_THREADS];\n    for (int i=0; i<NUM_THREADS; i++) {\n      final int n = i;\n\n      tasks[i] = new FutureTask<Void>(new Callable<Void>() {\n        @Override\n        public Void call() throws Exception {\n          ObjectStore store = new ObjectStore();\n          store.setConf(conf);\n\n          NotificationEvent dbEvent =\n              new NotificationEvent(0, 0, EventMessage.EventType.CREATE_DATABASE.toString(), \"CREATE DATABASE DB\" + n);\n\n          System.out.println(\"ADDING NOTIFICATION\");\n          countIn.countDown();\n          countOut.await();\n          store.addNotificationEvent(dbEvent);\n          System.out.println(\"FINISH NOTIFICATION\");\n\n          return null;\n        }\n      });\n\n      executorService.execute(tasks[i]);\n    }\n\n    countIn.await();\n    countOut.countDown();\n\n    for (int i = 0; i < NUM_THREADS; ++i) {\n      tasks[i].get();\n    }\n\n    NotificationEventResponse eventResponse = objectStore.getNextNotification(new NotificationEventRequest());\n    Assert.assertEquals(2, eventResponse.getEventsSize());\n    Assert.assertEquals(1, eventResponse.getEvents().get(0).getEventId());\n\n    // This fails because the next notification has an event ID = 1\n    Assert.assertEquals(2, eventResponse.getEvents().get(1).getEventId());\n  }\n{noformat}\n\nThe last assertion fails expecting an event ID 1 instead of 2. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12883195","id":"12883195","filename":"datastore-identity-holes.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"created":"2017-08-22T21:36:53.381+0000","size":6876,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12883195/datastore-identity-holes.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12883016","id":"12883016","filename":"HIVE-16886.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-21T23:43:14.437+0000","size":41461,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12883016/HIVE-16886.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12883836","id":"12883836","filename":"HIVE-16886.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-26T00:06:50.380+0000","size":55457,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12883836/HIVE-16886.2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12884096","id":"12884096","filename":"HIVE-16886.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-28T18:47:16.497+0000","size":59014,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12884096/HIVE-16886.3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12884156","id":"12884156","filename":"HIVE-16886.4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-29T00:21:38.729+0000","size":59034,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12884156/HIVE-16886.4.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12884316","id":"12884316","filename":"HIVE-16886.5.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-29T18:42:19.040+0000","size":61156,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12884316/HIVE-16886.5.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12884341","id":"12884341","filename":"HIVE-16886.6.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-29T21:00:27.228+0000","size":61318,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12884341/HIVE-16886.6.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12884510","id":"12884510","filename":"HIVE-16886.7.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-30T17:41:16.016+0000","size":61846,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12884510/HIVE-16886.7.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12886343","id":"12886343","filename":"HIVE-16886.8.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-09-11T04:56:02.890+0000","size":61019,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12886343/HIVE-16886.8.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"HMS log notifications may have duplicated event IDs if multiple HMS are running concurrently","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"subtasks":[{"id":"13133481","key":"HIVE-18526","self":"https://issues.apache.org/jira/rest/api/2/issue/13133481","fields":{"summary":"Backport HIVE-16886 to Hive 2","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16047058","id":"16047058","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"body":"[~thejas] [~sushanth] Have you experience this issue before? Do you have multiple HMS running in parallel?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"created":"2017-06-12T21:01:54.325+0000","updated":"2017-06-12T21:01:54.325+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16047344","id":"16047344","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek] created HIVE-16738 where he commented that this is possible in a single metastore case itself. However, I am not sure if we have seen that in practice so far.\nI guess you are right about the multi-metastore case as well. \n\nWhat happens when the table goes into that state ? Does DbNotifcationListener start erroring out ?\n\ncc [~anishek] [~sushanth] [~sankarh] \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-13T02:20:51.843+0000","updated":"2017-06-13T02:20:51.843+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16047347","id":"16047347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"FYI, A different issue that we observed in a production system was slowness in UPDATE queries in this table. We haven't got to the bottom of that issue yet -\n\nThere was slowness seen around the following query -\n\nPasting from slow query logs in that jira -\n{code}\nUPDATE `NOTIFICATION_SEQUENCE` SET `NEXT_EVENT_ID`=XXXX94 WHERE `NNI_ID`=1;\n# Query_time: 236.294821  Lock_time: 0.000044 Rows_sent: 0  Rows_examined: 1\nUPDATE `NOTIFICATION_SEQUENCE` SET `NEXT_EVENT_ID`=XXXX94 WHERE `NNI_ID`=1;\n# Query_time: 222.241997  Lock_time: 0.000049 Rows_sent: 0  Rows_examined: 1\n{code}\n\nThere is also lot updates that was happening with same next_event_id seen in that -\n\n{code}\ngrep NOTIFICATION_SEQUENCE  mysql-slowquery.log  |sort | uniq -c\n 830 UPDATE `NOTIFICATION_SEQUENCE` SET `NEXT_EVENT_ID`=XXXX43 WHERE `NNI_ID`=1;\n  13 UPDATE `NOTIFICATION_SEQUENCE` SET `NEXT_EVENT_ID`=XXXX44 WHERE `NNI_ID`=1;\n..\n..\n{code}\n(masked some digits in what is pasted above)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-13T02:25:59.696+0000","updated":"2017-06-13T02:26:31.559+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16047409","id":"16047409","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"HIVE-16738 also refers to the problem of multiple events getting same id in case of multiple Hive metastore instances. The lock has to be at the db level to get unique ids.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-06-13T04:38:41.076+0000","updated":"2017-06-13T04:38:41.076+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16047411","id":"16047411","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"The problem when this happens is that some events are lost and consumers who depend on them may get into an inconsistent state.\n\nThe slowness may be caused by the fact that such Read-Modify-Write on a single row involves a row lock, so concurrent threads doing updates contend on the same row lock.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-13T04:42:45.215+0000","updated":"2017-06-13T04:42:45.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16047678","id":"16047678","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"[~akolb] In DBNotificationListener the events will still get logged with some of them having the same id, If the consumer of the events is using the event id (which is reasonable) and processing them assuming there is going to be unique event ids per event then such consumers will lead to inconsistent data. We definitely need this fixing as part of replication v2.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-06-13T10:06:26.690+0000","updated":"2017-06-13T10:06:26.690+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16048558","id":"16048558","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek] This means that some events may not have a defined order - correct? This also makes consumer job very tricky since it doesn't know whether it processed all events or not. Consumers may be running on different processes - the only thing they may know is what event ID they processed. If we have multiple events with the same ID they will not know that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-14T00:43:00.742+0000","updated":"2017-06-14T00:43:00.742+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16048694","id":"16048694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"[~akolb] yeh agree with it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-06-14T04:27:53.105+0000","updated":"2017-06-14T04:27:53.105+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16048842","id":"16048842","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"A reasonable way to make it unique is \n\n* Declare a unique constraint\n* Add a new value into a separate row\n\nIt would be good to have some retry transaction logic, but it may be a bigger change. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-14T08:16:03.005+0000","updated":"2017-06-14T08:16:03.005+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16050043","id":"16050043","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"Another mode to achieve the same would be the way hibernate versioning works, there seems to be a jdo versioning available which looks the same. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-06-15T06:13:23.426+0000","updated":"2017-06-15T06:13:23.426+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16050065","id":"16050065","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"Can you clarify what versioning scheme you have in mind?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-15T06:39:44.644+0000","updated":"2017-06-15T06:39:44.644+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16050122","id":"16050122","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"http://www.datanucleus.org/products/accessplatform_4_1/jdo/versioning.html\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-06-15T07:57:40.356+0000","updated":"2017-06-15T07:57:40.356+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16051154","id":"16051154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"This is used in connection with Optimistic transactions are they used by ObjectStore? I was investigating the use of application-based versioning a while ago but couldn't find a single example of how it could be used.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-15T22:14:37.066+0000","updated":"2017-06-15T22:14:37.066+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16051390","id":"16051390","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"Not sure which transaction isolation level across sql db's (that metastore supports) translates to optimistic transactions. I have used this with hibernate versioning and it worked very well. I saw this on DataNucleus as well so I think will require some work to identify how well it fits our use case. \n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-06-16T05:19:24.216+0000","updated":"2017-06-16T05:19:24.216+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16051394","id":"16051394","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"For DataNucleus this is orthogonal to transaction isolation level and can be enabled for specific transactions. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-16T05:25:56.545+0000","updated":"2017-06-16T05:25:56.545+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16051522","id":"16051522","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"just to understand it better, isolation level is for updates where as locking seems to be for reads and i can get later with specific sql constructs within a isolation level. \n\nfor ex with mysql:\n{code}\n    <name>datanucleus.transactionIsolation</name>\n    <value>read-committed</value>\n{code}\n\nbut then fire a {{select ... for lock in share mode}}  rather than \n\n{code}\n    <name>datanucleus.transactionIsolation</name>\n    <value>serializable</value>\n{code}\n\nwould be same right ?\n\nanyways jdo versioning \nhttp://www.datanucleus.org/products/accessplatform_4_1/jdo/versioning.html\nwith transaction locking _*\"Optimistic Locking\"*_ in\nhttp://www.datanucleus.org/products/accessplatform_4_1/jdo/transactions.html\n\nso we should be able to get it by adding a column \n{code}\n      <version strategy=\"version-number\" column=\"VERSION\">\n      <field name=\"version\">\n              <column name=\"VERSION\" jdbc-type=\"BIGINT\" allows-null=\"false\"/>\n            </field>\n      </version>\n{code}\nin  {{MNotificationNextId}}\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-06-16T07:31:44.897+0000","updated":"2017-06-16T07:33:30.478+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16065643","id":"16065643","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek] What is the default isolation used by HMS? I think it is read-committed - right?\nI suspect that select ... for update is pretty heavy lock. In similar situations in Apache Sentry we rely on uniqueness constraint on the primary key (or on the unique key), effectively simulating optimistic locking.\n\nWhen I looked at DataNucleus optimistic support, it wasn't clear how to use it with the column that is managed by the application rather then DN itself.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-27T23:09:59.814+0000","updated":"2017-06-27T23:09:59.814+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16105271","id":"16105271","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"body":"[~anishek] [~thejas] While running some tests with duplicated events IDs in HMS HA mode, I see that the NL_ID is never duplicated and is always consecutive and in order. Do you know why we're not using this ID instead? Seems more consistent and better to use.\n\n[~akolb] FYI\n\n{noformat}\n[hive1]> select NL_ID, EVENT_ID, EVENT_TIME, EVENT_TYPE, DB_NAME from NOTIFICATION_LOG where NL_ID >= 5431 and NL_ID <= 5440;\n+-------+----------+------------+-----------------+----------------------------------------+\n| NL_ID | EVENT_ID | EVENT_TIME | EVENT_TYPE      | DB_NAME                                |\n+-------+----------+------------+-----------------+----------------------------------------+\n|  5431 |     5094 | 1501109698 | CREATE_DATABASE | metastore_test_db_HIVE_HIVEMETASTORE_2 |\n|  5432 |     5097 | 1501109698 | CREATE_TABLE    | metastore_test_db_HIVE_HIVEMETASTORE_2 |\n|  5433 |     5098 | 1501109699 | ADD_PARTITION   | metastore_test_db_HIVE_HIVEMETASTORE_2 |\n|  5434 |     5101 | 1501109791 | DROP_TABLE      | metastore_test_db_HIVE_HIVEMETASTORE_2 |\n|  5435 |     5104 | 1501109792 | DROP_DATABASE   | metastore_test_db_HIVE_HIVEMETASTORE_2 |\n|  5436 |     5096 | 1501109698 | CREATE_DATABASE | metastore_test_db_HIVE_HIVEMETASTORE_1 |\n|  5437 |     5097 | 1501109698 | CREATE_TABLE    | metastore_test_db_HIVE_HIVEMETASTORE_1 |\n|  5438 |     5100 | 1501109699 | ADD_PARTITION   | metastore_test_db_HIVE_HIVEMETASTORE_1 |\n|  5439 |     5102 | 1501109791 | DROP_TABLE      | metastore_test_db_HIVE_HIVEMETASTORE_1 |\n|  5440 |     5105 | 1501109792 | DROP_DATABASE   | metastore_test_db_HIVE_HIVEMETASTORE_1 |\n+-------+----------+------------+-----------------+----------------------------------------+\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"created":"2017-07-28T16:39:06.997+0000","updated":"2017-07-28T16:39:06.997+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16105274","id":"16105274","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"body":"Btw, the getNextNotification() method fetches all notifications after an EVENT_ID > X, so if we already fetched EVENT_ID = 5098, then the getNextNotification won't fetch those events after 5098 that are less than 5098. Seems we can get it better with NL_ID","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"created":"2017-07-28T16:40:31.158+0000","updated":"2017-07-28T16:40:31.158+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16106834","id":"16106834","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"[~spena] I am not exactly sure why we dont use the NotificationLog Id, i think there is some limitation when we use ORACLE db as metastore RDBMS, I think [~thejas] might be able to provide a more definitive answer, but \n\n* the test above would be more comprehensive if you can provide an example of unique NL_ID with duplicate EVENT_ID.\n* looking at the mapping NL_ID is generated using *native* strategy which falls back to sequence/identity/increment for different DB, the default values for these strategies will differ based on which underlying db is used, if *increment* gets used anywhere then in HMS HA mode there will be a cache of 10 sequence numbers that Datanuclues will maintain and this will definitely lead to duplicates / failues( since we have PK constraint), we might want to add additional retry logic in that case.\n* if we can move to *sequence* based identity strategy generation for NL_ID that will be great, though might have to look if all supported rdbms will work with them.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-07-31T05:51:05.190+0000","updated":"2017-07-31T05:51:05.190+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16107393","id":"16107393","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"body":"[~anishek] Got it, I will run some tests with ORACLE db as well to see if we have the same behavior. Btw, the above example has a duplicated EVENT_ID with a different NL_ID, here're the lines:\n{noformat}\n|  5432 |     5097 | 1501109698 | CREATE_TABLE    | metastore_test_db_HIVE_HIVEMETASTORE_2 |\n\n|  5437 |     5097 | 1501109698 | CREATE_TABLE    | metastore_test_db_HIVE_HIVEMETASTORE_1 |\n{noformat}\n\nThe {{HIVE_HIVEMETASTORE_N}} is a row written by a different HMS. In this cases we have HMS 1 and HMS 2 writing the same event ID.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"created":"2017-07-31T15:00:52.766+0000","updated":"2017-07-31T15:00:52.766+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16111172","id":"16111172","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~spena] i didnt realize there were additional rows in between the two.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-02T16:09:56.509+0000","updated":"2017-08-02T16:09:56.509+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16111366","id":"16111366","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lina.li] This issue may be interesting for you as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-02T17:26:42.464+0000","updated":"2017-08-02T17:26:42.464+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16119497","id":"16119497","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"[~spena] are you working on this one ? if not i am planning to have a go at it.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-09T06:52:07.930+0000","updated":"2017-08-09T06:52:07.930+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16121179","id":"16121179","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"for the supported database NL_ID will be generated either using the *auto_increment* or *identity* column, the problem though is column mappings of type *datastore-identity* cannot be mapped by datanucleus to the java representation of the notification log member variable, which means replication will not work since the event id is serialized to a file.  hence we cant use NL_ID.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-10T07:10:31.681+0000","updated":"2017-08-10T07:10:31.681+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16126371","id":"16126371","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"body":"I read on the datanucleus doc that those datastore-identity objects may be accessed by something like {{Object id = pm.getObjectId(obj);}}, do you know how if that would work? can we read and add the NL_ID into the object to be returned back to the client?\n\nhttp://www.datanucleus.org/products/datanucleus/jdo/datastore_identity.html","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"created":"2017-08-14T20:50:09.444+0000","updated":"2017-08-14T20:50:09.444+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16128384","id":"16128384","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"Yeh we can do that though  we have to explicitly parse and typecast the data-store identity in metastore code. Additionally sql query in datanuclues has to be used instead of object query for \n\n{code}public NotificationEventResponse getNextNotification(NotificationEventRequest rqst){code} in object store. \n\nI have the code in place which will address the current issue with the use of {{NL_ID}} as event id and remove the use of \n* {{MNotificationNextId}} \n* {{EVENT_ID}} from {{MNotificationLog}} such that without modifying the metastore db schema, we just populate a default of value \"0\" for this column in db.\n\nthough the problem is how do we manage deployments who are using repl v1 who are dependent on {{EVENT_ID}} and with the new release suddenly will move to {{NL_ID}}\n* -one way is we map both {{NL_ID}} and {{EVENT_ID}}  in {{MNotificationLog}} and the external tool based on the value of {{EVENT_ID=0}} switches to using id's from {{NL_ID}}- looking at the code dont think this is possible as for getCurrentNotificationId we wont be able to make a distinction. \n* other way is to completely redo the whole replication deployment with repl v2 rather than repl v1. \n* if we make an assumption that the {{NL_ID}} is always  > {{EVENT_ID}} in existing metastore rdbms then we can do something to automatically shift user to new mapping by writing some additional code in the hivemetastore which looks at all previous events and if nothing found start using the new mapping. \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-16T06:20:45.325+0000","updated":"2017-08-16T08:35:42.151+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16133389","id":"16133389","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"body":"[~anishek] I think we should keep the EVENT_ID as it is for now, and can add a new variable to the MNotificationLog that tracks the NL_ID. Then when getting new notifications, we can check for the NL_ID if the new variable has a value or fall back to the EVENT_ID if not. This way we can keep the compatibility with current clients using these notifications.\n\nBtw, in the Sentry side, we're going to request HMS notifications in a time window so that we can fetch these duplicated events IDs and reapply them in the client. Currently, HMS guarantees that IDs are committed in order but duplicated events could exist and committed later if an HMS server has delayed the transaction commit on the DB. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"created":"2017-08-18T18:18:08.705+0000","updated":"2017-08-18T18:18:08.705+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16133437","id":"16133437","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"body":"I think due to the flaws with current EVENT_ID, the NL_ID would be right value (from db) to use. Longer term we should just have one value and remove the EVENT_ID sourced information.\nThere are two possible approaches to switch to the new 'fixed' value.\nOne is to introduce a new NL_ID field at api level (maybe EVENT_ID_V2 for clarity ?) and eventually drop EVENT_ID field from API. Other option is to just switch EVENT_ID field to values sourced from NL_ID. With second approach, no changes to applications are needed for the deprecation. Applications would get a bump in the event id numbers due to it being sourced from NL_ID which would be >= EVENT_ID nos (due to the duplicate issue).\n\n[~spena] What are your thoughts ? \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thejas","name":"thejas","key":"thejas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thejas&avatarId=15902","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thejas&avatarId=15902","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thejas&avatarId=15902","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thejas&avatarId=15902"},"displayName":"Thejas M Nair","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-18T18:39:22.744+0000","updated":"2017-08-18T18:39:22.744+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16135433","id":"16135433","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"I am just going to provide some more detail information so that we all get to understand what is happening with this bug.\n\nAs of now the plan is to hopefully have a backward compatibility with replication v1, though primary focus is going to be fixing the issue of duplicate event ids with multiple HMS, which is specifically detrimental for replication v2, which is now going to replication point-in-time state of the database rather than the latest state as was  in repl v1. \n\nAs for the fix, there are few tests i am going to fix and have a patch for all of you, hopefully today/tomorrow,  to review. \n* mapping for {{NOTIFICATION_SEQUENCE}}  has been removed.\n* there are effectively two class mappings for {{NOTIFICATION_LOG}} , one representing the current state namely using {{EVENT_ID}} as event id and new implementation that will use {{NL_ID}}, with the new mapping putting a default value of 0 for {{EVENT_ID}}. \n* Backward compatibility in terms of replication v1 not being broken, should be possible if the following assumption holds in the metastore rdmbs : ??value of NL_ID is greater than the EVENT_ID for same rows, including only events that are not yet replicated to replica warehouse.??\n* Code to switch mappings in the metastore from {{EVENT_ID}} to {{ND_ID}} is in place, depending on what is required, For ex for existing repl v1, it will first provide all the events using the {{EVENT_ID}} and post that start providing events with {{NL_ID}} since {{NL_ID > EVENT_ID}} it would allow existing setup to continue working.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-21T16:58:27.255+0000","updated":"2017-08-21T16:58:27.255+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16135733","id":"16135733","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"body":"[~anishek] [~thejas] Thanks for starting working on this. I have a few of comments about using NL_ID that we should keep in mind on the patch. This is based on some other tests we have done with datastore incremental IDs.\n\n1. Use the {{sequence}} strategy on the NL_ID. This should keep increments atomic. However, we have found that these increments do not guarantee an order when committing them. We have seen commits ID of order 1,3,2 because of some delay in the transaction commit. We call this out-of-order as 'holes' because when fetching updates we may get 1,3 only (2 is not there because will be committed later).\n\n2. To solve the holes problem on our client requests when getting new notifications, we should request them in a temporal order instead of ID order. To do that, we should write a new API to get notifications based on a timestamp instead of an ID. Timestamps will keep the order correctly.\n\n3. Use a SQL timestamp instead of using the one on DbNotificationListener#now() method. If possible, use a milliseconds timestamp, such as {{current_timestamp(6)}} from SQL. The now() method run in different HMS servers may be different and may be out-of-sync having a weird order sometimes. We found that {{current_timestamp(6)}} is executed at the moment of the SQL execution; so it is the best time we can get of the transaction.\n\nThis next section only applies to what we do as a client requesting notifications (not part for the patch, but useful to know).\n\nOn the client side, we sometimes do not request notifications for a period higher than the HMS clean-up thread. This means that we may miss notifications that were removed during that time. To avoid this issue on our side, we're requesting HMS notifications for a time window period and reapplying all of them for that time. If for some reason we get fewer notifications than expected, then we assume that older events were purged, and we may request a new HMS snapshot if necessary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"created":"2017-08-21T20:07:50.282+0000","updated":"2017-08-21T20:07:50.282+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16135840","id":"16135840","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"[~spena] thanks for your insights.\n\n* Sequence is not present in Mysql 5.6 and MS SQL and hence using that as the datastore-identity strategy will not work for all supported databases (https://cwiki.apache.org/confluence/display/Hive/AdminManual+MetastoreAdmin).\n* leaving it to \"native\" should work for us since the underlying column is a bigint and should result in numeric generation, I am not aware of a database generating, out of order numeric values when using \"auto-increment\", do you know of any such use case ?\n* I like the sequential guarantee that point 3, provides, but this should happen only for concurrent transactions / queries / modifying disjoint operations. In such cases it should not matter if one is applied before the other or vice versa, the database would still be in valid state ? even if we use the current_timestamp from db it would result in similar order of events as we do currently such that you can get 1,3,2 because it will be enforced at database insert time and not when the operation started. From what I see point 1, looks like clients want the order of events to be the order in which they were started rather than the order which they were committed, where in the latter makes sense since at the database level that is how the events were applied. \n\nPlease let me know what you think ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-21T21:09:55.578+0000","updated":"2017-08-21T21:09:55.578+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16136027","id":"16136027","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"attaching patch for test run.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-21T23:43:26.614+0000","updated":"2017-08-21T23:43:26.614+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16136029","id":"16136029","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"From what I saw all mechanisms supported by DataNucleus can not guarantee that there are no holes (although tehy deal with duplicates). There may be two kinds of holes - temporary ones (that will be filled later when transaction is committed) and permanent ones (which will be never filled in). \n\nMySQL InnoDB has a mechanism to provide no-holes semantics (https://dev.mysql.com/doc/refman/5.7/en/innodb-auto-increment-handling.html) but ir seems that Oracle and PostgreSQL don't have similar mechanisms.\n\nHoles create troubles for consumers. E.g. when consumer reads notification ID 10 some earlier IDs may be committed later so they may be skipped or not processed properly. Also, consumers have no way of knowing whether the hole will be filled in later (when corresponding transaction commits) or never (if the transaction that allocated ID fails).\n\nThere is a way to guarantee that there re no holes and duplicates:\n\na) Make the ID primary key (which doesn't allow duplicates)\nb) As part of the transaction, read the value of ID, increment it by 1 and persist it.\n\nThis approach guarantees that there are no holes or duplicates, but transactions can fail because of the ID conflicts, so it is important to retry such transactions. HMS doesn't provide per-transaction retries, but may be per-operation retries are Ok as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-21T23:46:47.271+0000","updated":"2017-08-21T23:46:47.271+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16136555","id":"16136555","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12883016/HIVE-16886.1.patch\n\n{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 26 failed/errored test(s), 10995 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[unionDistinct_1] (batchId=143)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=235)\norg.apache.hadoop.hive.common.TestFileUtils.testCopyWithDistCpAs (batchId=250)\norg.apache.hadoop.hive.common.TestFileUtils.testCopyWithDistcp (batchId=250)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testAlters (batchId=218)\norg.apache.hive.hcatalog.api.TestHCatClient.testPartitionRegistrationWithCustomSchema (batchId=180)\norg.apache.hive.hcatalog.api.TestHCatClient.testPartitionSpecRegistrationWithCustomSchema (batchId=180)\norg.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation (batchId=180)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.addPartition (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.alterIndex (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.alterPartition (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.alterTable (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.createDatabase (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.createFunction (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.createIndex (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.createTable (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.dropDatabase (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.dropFunction (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.dropIndex (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.dropPartition (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.dropTable (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.exchangePartition (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.filter (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.insertPartition (batchId=233)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.insertTable (batchId=233)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/6480/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/6480/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6480/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 26 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12883016 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-08-22T09:22:52.907+0000","updated":"2017-08-22T09:22:52.907+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16137459","id":"16137459","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"body":"[~anishek] I attached a patch that probes we can have holes when using datastore identity IF delays happen during the commit() transaction call. I made some modifications on the ObjectStore to allow seeing this behavior:\n\ngetNextNotification() reads the NL_ID and replaces EVENT_ID with NL_ID so that I can read what the actual NL_ID was persisted.\n\naddNotificationEvent() has some count down latches that signal the persist and commit order. \n\nThe problem we saw is that NL_ID is created on the {{makePersistent}} call (sql execution), but it is not seen by getNextNotification() until is committed. This commit() may be delayed due to issues on network, GC or anything else. We run into this problem in Sentry when we were running several stress tests on a cluster with Sentry HA.\n\nApply the patch on master, and run the test case:\n{noformat}\n$ mvn test -Dtest=TestObjectStore#testDatanucleusHoles\n{noformat}\n\nThe test case have assertions to probe the hole, but to look at the actual holes, you can take a look at the log:\n{noformat}\n$ cat metastore/target/surefire-reports/org.apache.hadoop.hive.metastore.TestObjectStore-output.txt\n\n2017-08-22T14:36:06,090  INFO [main] metastore.TestObjectStore: 1st notification request will get only one event with ID = 2\n2017-08-22T14:36:06,090  INFO [main] metastore.TestObjectStore: ID = 2, TYPE = null\n2017-08-22T14:36:06,092  INFO [main] metastore.TestObjectStore: 2nd notification request should get last event ID = 2 and a new event with ID = 1\n2017-08-22T14:36:06,092  INFO [main] metastore.TestObjectStore: ID = 1, TYPE = null\n2017-08-22T14:36:06,092  INFO [main] metastore.TestObjectStore: ID = 2, TYPE = null\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"created":"2017-08-22T21:43:57.774+0000","updated":"2017-08-22T21:43:57.774+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16137596","id":"16137596","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"[~spena]/[~akolb] I agree to the  points you have made and i have been thinking, if we introduce another column with auto-increment and primary key constraint  at the db level and datanuclues having no mapping for the field, in this case the id will be given at commit time and not at makePersistent done in our code. only thing that kept me from doing this was doing db schema change for metastore but i think we need it here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-22T23:27:40.704+0000","updated":"2017-08-22T23:27:40.704+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16137616","id":"16137616","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek] I was investigating this some time ago and seems like only MySQL with InnoDB has a mechanism to guarantee precise auto-increment without holes. Seems that neither Oracle nor PostgreSQL provide such mechanisms (please correct me if I am wrong - I am in no way a DB expert). I didn't find any generic way to achieve this without manually simulating \"optimistic transactions\" which means a combination of defining ID as a primary key and using something along these lines:\n\n{code}\nOPEN TRANSACTION\nperform_some_work()\nid = retrieve max(id)\npersist(id+1)\nCLOSE TRANSACTION\n{code}\n\nBecause of the uniqueness constraint, this either succeeds and increments the value or fails due to a duplicate value. In both cases we have neither duplicates nor holes. We can never have a case where fort two IDs K and N where K < N, and K is committed after N.\n\nThe current situation is bad not only because we have duplicates but also because when we read some value N, a smaller value K<N may still appear later and go undetected.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-22T23:40:23.062+0000","updated":"2017-08-22T23:40:45.870+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16137620","id":"16137620","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek] To clarify - what we discovered is that auto-increment allocates IDs not at commit time, so later values may be committed earlier then earlier values.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-22T23:42:19.974+0000","updated":"2017-08-22T23:42:19.974+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16137621","id":"16137621","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"There is some discussions of pros and cons of alternative approaches in SENTRY-1855.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-22T23:44:36.065+0000","updated":"2017-08-22T23:44:36.065+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16137642","id":"16137642","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12883195/datastore-identity-holes.diff\n\n{color:green}SUCCESS:{color} +1 due to 1 test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 33 failed/errored test(s), 10860 tests executed\n*Failed tests:*\n{noformat}\nTestCommands - did not produce a TEST-*.xml file (likely timed out) (batchId=180)\nTestDbNotificationListener - did not produce a TEST-*.xml file (likely timed out) (batchId=233)\nTestEximReplicationTasks - did not produce a TEST-*.xml file (likely timed out) (batchId=180)\nTestExport - did not produce a TEST-*.xml file (likely timed out) (batchId=218)\nTestHCatClient - did not produce a TEST-*.xml file (likely timed out) (batchId=180)\nTestHCatClientNotification - did not produce a TEST-*.xml file (likely timed out) (batchId=233)\nTestHCatHiveCompatibility - did not produce a TEST-*.xml file (likely timed out) (batchId=233)\nTestHCatHiveThriftCompatibility - did not produce a TEST-*.xml file (likely timed out) (batchId=233)\nTestLocationQueries - did not produce a TEST-*.xml file (likely timed out) (batchId=218)\nTestNoopCommand - did not produce a TEST-*.xml file (likely timed out) (batchId=180)\nTestObjectStore - did not produce a TEST-*.xml file (likely timed out) (batchId=201)\nTestReplicationScenarios - did not produce a TEST-*.xml file (likely timed out) (batchId=218)\nTestReplicationScenariosAcrossInstances - did not produce a TEST-*.xml file (likely timed out) (batchId=218)\nTestReplicationTask - did not produce a TEST-*.xml file (likely timed out) (batchId=180)\nTestRetriesInRetryingHMSHandler - did not produce a TEST-*.xml file (likely timed out) (batchId=201)\nTestSemanticAnalyzerHookLoading - did not produce a TEST-*.xml file (likely timed out) (batchId=218)\nTestSequenceFileReadWrite - did not produce a TEST-*.xml file (likely timed out) (batchId=233)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_dynamic_partition_pruning] (batchId=169)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[repl_dump_requires_admin] (batchId=90)\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[repl_load_requires_admin] (batchId=90)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=235)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=235)\norg.apache.hadoop.hive.common.TestFileUtils.testCopyWithDistCpAs (batchId=250)\norg.apache.hadoop.hive.common.TestFileUtils.testCopyWithDistcp (batchId=250)\norg.apache.hive.jdbc.TestJdbcWithMiniHS2.testReplDumpResultSet (batchId=228)\norg.apache.hive.minikdc.TestJdbcWithDBTokenStore.testConnection (batchId=241)\norg.apache.hive.minikdc.TestJdbcWithDBTokenStore.testIsValid (batchId=241)\norg.apache.hive.minikdc.TestJdbcWithDBTokenStore.testIsValidNeg (batchId=241)\norg.apache.hive.minikdc.TestJdbcWithDBTokenStore.testNegativeProxyAuth (batchId=241)\norg.apache.hive.minikdc.TestJdbcWithDBTokenStore.testNegativeTokenAuth (batchId=241)\norg.apache.hive.minikdc.TestJdbcWithDBTokenStore.testProxyAuth (batchId=241)\norg.apache.hive.minikdc.TestJdbcWithDBTokenStore.testTokenAuth (batchId=241)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/6492/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/6492/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6492/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 33 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12883195 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-08-23T00:01:57.308+0000","updated":"2017-08-23T00:01:57.308+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16138741","id":"16138741","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"auto increments can have holes if\n\n* a transaction was aborted.\n* or the sequence generation is happening in code by explicitly calling the next_val on the sequence behind the auto increment and then doing the insert from the application in which case the problem mentioned by [~spena] with GC in app can cause holes or unordered inserts.\n\nholes can happen and are not guaranteed because of the above cases, however we should not care about the case 1 of aborted transactions until we get increasing ordered unique numbers. \n\nas for the second case if we use the auto_increment at DB and not use datanuclues datastore-identity with auto-increment, we should be able to get them in order. \n\nthe test provided by  [~spena]  works on mysql with both positive and negative mapping. \n\nnegative mapping -- existing mapping with mysql.\npositive mapping -- auto increment as part of create table for notification log, on NL_ID, on a fresh db. \n\nfor the patch rather than using the existing columns i think i will create another column that will be auto increment at db level.  I will try the fix on a postgres sql db also to see if there is separate behavior, however if the race condition happens at the db level such that two transactions are committed from the application (HMS) at the same time but the db will order them depending on which acquires the lock to auto_increment first. how ever since replication is not realtime this lag of a few nano/micro secs should not be a problem. \n\nretrying the whole metastore operation with optimistic locking in application code is just calling for a lot of retries on HMS side with the possibility of retrying complete metastore operations to be redone if something fails when one commit is larger than other commits. additionally this will need us to do perfect distributed transactions on rdbms + hdfs. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-23T17:45:58.640+0000","updated":"2017-08-23T17:45:58.640+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16138864","id":"16138864","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"There are two types of holes that can be observed:\n\n1. Temporary hole - the transaction allocated the ID and is in progress but not committed yet. The hole will be filled at some time in the future when transaction commits.\n2. Persistent hole in case when transaction was aborted.\n\nBoth cases present some problems for consumers. Suppose consumers process IDs in order and they read 1, 3. What should they do? If they continue going forward, ID 2 will not be handled at all. They don't know whether 2 will appear later or will never appear. Usually it will appear (in most cases transactions go through) but clients don't know when. Should they process 3 or not? If they do and 2 appears later and they detect it, they will apply operations out of order.\n\nThat said, it is better then having duplicate IDs. But this still creates hard problems for consumers who rely on accurate stream of IDs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-23T18:42:45.016+0000","updated":"2017-08-23T18:42:45.016+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16138921","id":"16138921","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"1. this will not happen as the id will *not* be allocated before commit, its at DB commit level, that id is generated and *not* at some future time when commit is happening.\n2. this can happen.\n\nsince 1 is not happening consumers should keep processing elements in order 1,3 etc and not wait for 2 to appear later. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-23T19:22:26.033+0000","updated":"2017-08-23T19:22:26.033+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16138927","id":"16138927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek] We actually observed this behavior. Seems that DBs allocate this ID not at commit time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-23T19:30:12.933+0000","updated":"2017-08-23T19:30:12.933+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16138939","id":"16138939","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"Here is some discussion of the issue on the Oracle side - I don't know how accurate this is. https://dba.stackexchange.com/questions/3945/can-i-implement-a-gapless-identity-column-in-oracle\n\nThe statement there is that not only it is impossible to have gapless sequence, it is also impossible to guarantee ordering which means that earlier ID values may appear after later ones.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-23T19:36:28.052+0000","updated":"2017-08-23T19:37:23.257+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16139246","id":"16139246","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"link seems to be discussing sequences and like i mentioned earlier the subsequent transactions will be in commit phase in db when ids get generated so unless something is happening as a trigger on new insert into notification log there is no problem with replication.\n\nDoing retry with optimistic transactions in application code is not something we want to do since it will affect performance of straggle some users. do you have any other ideas ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-23T22:26:38.836+0000","updated":"2017-08-23T22:26:38.836+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16139346","id":"16139346","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"Thinking more on this, might be we just do \"select for update' for getting the next event id from notification_sequence. this should work on most of the problems we have but will make metastore operations slow. \n\nalso just wondering even in single standalone HMS we can have this issue, as the NOTIFICATION_TBL_LOCK is within a nested transaction and multiple threads can still read the same value across threads and update it separately.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-23T23:55:42.501+0000","updated":"2017-08-23T23:55:42.501+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16139403","id":"16139403","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"{{select for update}} will work, but is, indeed a hammer, plus now we might have deadlocks. But I am not aware of any solution that guarantees the semantics we need and doesn't hurt performance.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-24T00:48:27.416+0000","updated":"2017-08-24T00:48:27.416+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16140650","id":"16140650","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"[~akolb] the {{select for update}} will be on {{notification_sequence}} and since its an *exclusive* lock ,so why would there be deadlocks ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-24T20:37:09.303+0000","updated":"2017-08-24T20:37:09.303+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16140668","id":"16140668","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek] I am not saying there would be a deadlock, it all depends on specifics - the notification id is updated as part of a larger transaction where lock ordering may be not that easy to enforce - but it may be a non-issue here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-24T20:45:11.249+0000","updated":"2017-08-24T20:45:11.249+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16142585","id":"16142585","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12883836/HIVE-16886.2.patch\n\n{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 15 failed/errored test(s), 11005 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=100)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=235)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=235)\norg.apache.hadoop.hive.ql.parse.TestExport.shouldExportImportATemporaryTable (batchId=218)\norg.apache.hive.beeline.TestSchemaTool.testHiveMetastoreDbPropertiesTable (batchId=222)\norg.apache.hive.beeline.TestSchemaTool.testMetastoreDbPropertiesAfterUpgrade (batchId=222)\norg.apache.hive.beeline.TestSchemaTool.testSchemaInit (batchId=222)\norg.apache.hive.beeline.TestSchemaTool.testSchemaUpgrade (batchId=222)\norg.apache.hive.beeline.TestSchemaTool.testValidateLocations (batchId=222)\norg.apache.hive.beeline.TestSchemaTool.testValidateNullValues (batchId=222)\norg.apache.hive.beeline.TestSchemaTool.testValidateSchemaTables (batchId=222)\norg.apache.hive.beeline.TestSchemaTool.testValidateSchemaVersions (batchId=222)\norg.apache.hive.beeline.TestSchemaTool.testValidateSequences (batchId=222)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/6550/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/6550/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6550/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 15 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12883836 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-08-26T03:14:07.992+0000","updated":"2017-08-26T03:14:07.992+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16143221","id":"16143221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=LinaAtAustin","name":"LinaAtAustin","key":"linaataustin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=linaataustin&avatarId=31361","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=linaataustin&avatarId=31361","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=linaataustin&avatarId=31361","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=linaataustin&avatarId=31361"},"displayName":"Na Li","active":true,"timeZone":"America/Chicago"},"body":"We did testing and it shows when executing SQL command in transactions concurrently, the result is determined by the order of SQL execution order (if SQL1 is executed before SQL2 and both set value of the same column in the same row and same table, the result is the same as the value set by SQL2, i.e., the last executed wins). The result is NOT determined by the transaction commit order.\n\nWhen Sentry gets notifications and apply them, it should apply them in the same order as hive applies those changes. Otherwise, sentry may end up getting different path state from what hive has. It is undesirable.\n\nIn order to achieve consistent synchronization, could hive make sure that the event ID order is the same as the path sql execution order? One way to achieve this is to keep the notification log in the same transaction of the path sql statement, and the order in the transaction is to persist notification log after the path SQL statement\n{\nExecute path SQL statements,\nPersist notification log\n}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=LinaAtAustin","name":"LinaAtAustin","key":"linaataustin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=linaataustin&avatarId=31361","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=linaataustin&avatarId=31361","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=linaataustin&avatarId=31361","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=linaataustin&avatarId=31361"},"displayName":"Na Li","active":true,"timeZone":"America/Chicago"},"created":"2017-08-27T20:59:08.660+0000","updated":"2017-08-27T20:59:08.660+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16143952","id":"16143952","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"[~lina.li] changes to notification log are in nested transactions with enclosing transaction executing the necessary statements for the user initiated operations, its as you have stated in you example { Execute path SQL statements, Persist notification log }.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-28T16:12:26.529+0000","updated":"2017-08-28T16:12:26.529+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16144191","id":"16144191","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"fixing errors for derby schema and removing the java lock for updating notification logs since we do a db lock for multiple HMS","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-28T18:47:51.216+0000","updated":"2017-08-28T18:47:51.216+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16144269","id":"16144269","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12884096/HIVE-16886.3.patch\n\n{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 11013 tests executed\n*Failed tests:*\n{noformat}\nTestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/6565/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/6565/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6565/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 3 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12884096 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-08-28T20:11:33.497+0000","updated":"2017-08-28T20:11:33.497+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16144586","id":"16144586","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"fixing oracle schema upgrades","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-29T00:21:47.217+0000","updated":"2017-08-29T00:21:47.217+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16144587","id":"16144587","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"Failing tests are from older builds.\n\n[~thejas]/[~daijy]/[~sankarh] please review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-29T00:22:58.761+0000","updated":"2017-08-29T00:22:58.761+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16144590","id":"16144590","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek] Would you mind adding a link to reviewboard?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-29T00:24:42.344+0000","updated":"2017-08-29T00:24:42.344+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16144596","id":"16144596","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user anishek opened a pull request:\n\n    https://github.com/apache/hive/pull/237\n\n    HIVE-16886: HMS log notifications may have duplicated event IDs if multiple HMS are running concurrently\n\n    …ltiple HMS are running concurrently\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/anishek/hive HIVE-16886\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/hive/pull/237.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #237\n    \n----\ncommit 1d358291c5c5fc46e3d921d74967e51d1a7418b5\nAuthor: Anishek Agarwal <anishek@gmail.com>\nDate:   2017-08-24T00:10:00Z\n\n    HIVE-16886: HMS log notifications may have duplicated event IDs if multiple HMS are running concurrently\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-29T00:33:22.470+0000","updated":"2017-08-29T00:33:22.470+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16144623","id":"16144623","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"Is there any reason you don't want to use\n\nQuery q = pm.newQuery(...);\nq.setSerializeRead(true);\n\nwhich does convert to appropriate SELECT FOR UPDATE statements? See http://www.datanucleus.org/products/accessplatform_3_0/jdo/transaction_types.html for some description.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-29T01:11:02.856+0000","updated":"2017-08-29T01:11:02.856+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16144682","id":"16144682","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12884156/HIVE-16886.4.patch\n\n{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 4 failed/errored test(s), 11014 tests executed\n*Failed tests:*\n{noformat}\nTestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_sortmerge_join_2] (batchId=46)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/6572/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/6572/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6572/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 4 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12884156 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-08-29T03:07:17.789+0000","updated":"2017-08-29T03:07:17.789+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16145772","id":"16145772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"[~akolb] the transaction for handling the dbnotification update is a nested transaction and i didnt want to set the whole transaction to setSerializedRead, as even though currently this is done as the last set of actions in HMS, it might change in future and then every additional queries run in the transaction will be serializedRead. Setting the same on the query was again confusing as the result of change should not be visible to other transactions till commit and hence even though we are setting is on the query object, it might just be internally doing it on the current open transactions which brings us back to the first problem.\n\nAlso since code to handle {{select.. for update}} was already there as part of ACID, i just reused the same, as it gives more confidence that there are no problems with this semantics rather than the setSerializedRead on Datanucleus.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-29T17:51:19.640+0000","updated":"2017-08-29T17:51:19.640+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16145843","id":"16145843","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"adding configurations to manage retry limit and sleep time for acquiring the lock on the notification sequence.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-29T18:26:19.605+0000","updated":"2017-08-29T18:26:19.605+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16145845","id":"16145845","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"add {{NOTIFICATION_SEQUENCE_LOCK_MAX_RETRIES}} and {{NOTIFICATION_SEQUENCE_LOCK_RETRY_SLEEP_INTERVAL}} to docs","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-29T18:26:58.829+0000","updated":"2017-08-29T18:26:58.829+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16145883","id":"16145883","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"configurations for sleep and retry intervals for notification sequence lock","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-29T18:42:37.826+0000","updated":"2017-08-29T18:42:37.826+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16146028","id":"16146028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12884316/HIVE-16886.5.patch\n\n{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 80 failed/errored test(s), 11000 tests executed\n*Failed tests:*\n{noformat}\nTestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=234)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.org.apache.hadoop.hive.cli.TestSparkCliDriver (batchId=109)\norg.apache.hadoop.hive.metastore.TestObjectStore.testNotificationOps (batchId=201)\norg.apache.hadoop.hive.ql.parse.TestExport.shouldExportImportATemporaryTable (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testAlters (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testBasic (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testBasicWithCM (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testBootstrapLoadOnExistingDb (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testBootstrapWithConcurrentDropPartition (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testBootstrapWithConcurrentDropTable (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testConcatenatePartitionedTable (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testConcatenateTable (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testConstraints (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testDrops (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testDropsWithCM (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testDumpLimit (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testEventTypesForDynamicAddPartitionByInsert (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testExchangePartition (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalAdds (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalInsertDropPartitionedTable (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalInsertDropUnpartitionedTable (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalInsertToPartition (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalInserts (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalLoad (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalLoadFailAndRetry (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalLoadWithVariableLengthEventId (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalRepeatEventOnExistingObject (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalRepeatEventOnMissingObject (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testInsertOverwriteOnPartitionedTableWithCM (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testInsertOverwriteOnUnpartitionedTableWithCM (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testInsertToMultiKeyPartition (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testRenamePartitionWithCM (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testRenameTableWithCM (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testStatus (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testTruncatePartitionedTable (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testTruncateTable (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testTruncateWithCM (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testViewsReplication (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcrossInstances.testBootstrapFunctionReplication (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcrossInstances.testCreateFunctionIncrementalReplication (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcrossInstances.testCreateFunctionWithFunctionBinaryJarsOnHDFS (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcrossInstances.testDropFunctionIncrementalReplication (batchId=218)\norg.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcrossInstances.testMultipleStagesOfReplicationLoadTask (batchId=218)\norg.apache.hive.hcatalog.api.TestHCatClient.testReplicationTaskIter (batchId=180)\norg.apache.hive.hcatalog.api.TestHCatClientNotification.addPartition (batchId=232)\norg.apache.hive.hcatalog.api.TestHCatClientNotification.createDatabase (batchId=232)\norg.apache.hive.hcatalog.api.TestHCatClientNotification.createTable (batchId=232)\norg.apache.hive.hcatalog.api.TestHCatClientNotification.dropDatabase (batchId=232)\norg.apache.hive.hcatalog.api.TestHCatClientNotification.dropPartition (batchId=232)\norg.apache.hive.hcatalog.api.TestHCatClientNotification.dropTable (batchId=232)\norg.apache.hive.hcatalog.api.TestHCatClientNotification.filter (batchId=232)\norg.apache.hive.hcatalog.api.TestHCatClientNotification.filterWithMax (batchId=232)\norg.apache.hive.hcatalog.api.TestHCatClientNotification.getOnlyMaxEvents (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.addPartition (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.alterIndex (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.alterPartition (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.alterTable (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.cleanupNotifs (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.createDatabase (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.createFunction (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.createIndex (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.createTable (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.dropDatabase (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.dropFunction (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.dropIndex (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.dropPartition (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.dropTable (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.exchangePartition (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.filter (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.filterWithMax (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.getOnlyMaxEvents (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.insertPartition (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.insertTable (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.sqlCTAS (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.sqlDb (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.sqlInsertPartition (batchId=232)\norg.apache.hive.hcatalog.listener.TestDbNotificationListener.sqlInsertTable (batchId=232)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/6586/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/6586/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6586/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 80 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12884316 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-08-29T20:14:45.222+0000","updated":"2017-08-29T20:14:45.222+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16146113","id":"16146113","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"fixing the Configuration object reference","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-29T20:59:47.118+0000","updated":"2017-08-29T20:59:47.118+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16146116","id":"16146116","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"fixing configuration object reference","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-29T21:00:33.364+0000","updated":"2017-08-29T21:00:33.364+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16146257","id":"16146257","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12884341/HIVE-16886.6.patch\n\n{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 6 failed/errored test(s), 11014 tests executed\n*Failed tests:*\n{noformat}\nTestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_remove_15] (batchId=82)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=234)\norg.apache.hive.jdbc.TestJdbcWithMiniHS2.testHttpRetryOnServerIdleTimeout (batchId=227)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/6588/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/6588/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6588/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 6 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12884341 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-08-29T22:30:23.260+0000","updated":"2017-08-29T22:30:23.260+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16146384","id":"16146384","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"Looks like SQLGenerator.createInsertValuesStmt() may be subject to SQL injection attack since it uses provided values to generate SQL statements. Perhaps it should use prepared statements instead?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-30T00:12:06.485+0000","updated":"2017-08-30T00:12:06.485+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16146512","id":"16146512","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12884341/HIVE-16886.6.patch\n\n{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 7 failed/errored test(s), 11000 tests executed\n*Failed tests:*\n{noformat}\nTestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[transform_acid] (batchId=19)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=234)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=234)\norg.apache.hadoop.hive.cli.TestSparkCliDriver.org.apache.hadoop.hive.cli.TestSparkCliDriver (batchId=102)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/6592/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/6592/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6592/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 7 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12884341 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-08-30T02:56:27.737+0000","updated":"2017-08-30T02:56:27.737+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16147592","id":"16147592","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"[~akolb] {{SQLGenerator}} is a artifact of the ACID implementation and we are just reusing the clause, from the looks of it SQL injection might be possible but i am not an expert in that area so I will let [~ekoifman] have a look at it, also may be track this as a separate bug.\n\nI am just running the failed test to see if there are any problems, will upload a patch soon with log comment fixes suggested by [~spena]\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-30T16:47:33.160+0000","updated":"2017-08-30T16:47:33.160+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16147667","id":"16147667","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"* org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[transform_acid] : works fine on local machine\n* org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] : fails on local, only order of the first two statements is in correct which was specifically changed as part of HIVE-17037 not sure why its failing now and its not part of the current set of changes.\n*  org.apache.hadoop.hive.cli.TestSparkCliDriver.org.apache.hadoop.hive.cli.TestSparkCliDriver : seems like a disk IO operation that failed, not a test failure, running this on local machine for the last 10 mins and there is no end to it, so stopping it.\n\n\nOther tests are failing from older build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-30T17:40:53.051+0000","updated":"2017-08-30T17:40:53.051+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16147669","id":"16147669","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"fixing log comments","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-08-30T17:41:20.265+0000","updated":"2017-08-30T17:41:20.265+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16147865","id":"16147865","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12884510/HIVE-16886.7.patch\n\n{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 7 failed/errored test(s), 11014 tests executed\n*Failed tests:*\n{noformat}\nTestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_sortmerge_join_5] (batchId=84)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[load_dyn_part5] (batchId=154)\norg.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=234)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=234)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/6606/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/6606/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6606/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 7 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12884510 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-08-30T19:13:26.397+0000","updated":"2017-08-30T19:13:26.397+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16154054","id":"16154054","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ekoifman","name":"ekoifman","key":"ekoifman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eugene Koifman","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek], [~akolb] I think SQL injection would be an issue if the class allowed you to run a query.  It does not.  It just manipulates text.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ekoifman","name":"ekoifman","key":"ekoifman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eugene Koifman","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-09-05T17:48:50.337+0000","updated":"2017-09-05T17:48:50.337+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16157813","id":"16157813","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daijy","name":"daijy","key":"daijy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Dai","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch looks good to me. [~akolb], [~lina.li], I am going to commit in next 24h if I don't hear further comments from you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daijy","name":"daijy","key":"daijy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Dai","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-09-07T22:52:28.482+0000","updated":"2017-09-07T22:52:28.482+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16159113","id":"16159113","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"body":"It looks good [~daijy] [~anishek]. I run the Mysql tests in a cluster with HMS HA and execute several DDL statements. There are no duplicates nor gaps, this is a good approach. I haven't tested the performance, though, but that's something we would handle later if we see something bad with it.\n\n+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=spena","name":"spena","key":"spena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergio Peña","active":true,"timeZone":"America/Chicago"},"created":"2017-09-08T18:59:17.567+0000","updated":"2017-09-08T18:59:17.567+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16159467","id":"16159467","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daijy","name":"daijy","key":"daijy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Dai","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek], the patch is out of sync especially in TestObjectStore.java. Can you rebase?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daijy","name":"daijy","key":"daijy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Dai","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-09-08T22:35:03.155+0000","updated":"2017-09-08T22:35:03.155+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16160686","id":"16160686","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"rebased from master [~daijy] ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2017-09-11T04:56:16.118+0000","updated":"2017-09-11T04:56:16.118+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16160853","id":"16160853","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12886343/HIVE-16886.8.patch\n\n{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 6 failed/errored test(s), 11033 tests executed\n*Failed tests:*\n{noformat}\nTestAccumuloCliDriver - did not produce a TEST-*.xml file (likely timed out) (batchId=230)\nTestDummy - did not produce a TEST-*.xml file (likely timed out) (batchId=230)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[char_udf1] (batchId=86)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=234)\norg.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=234)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/6763/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/6763/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-6763/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 6 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12886343 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-09-11T07:47:00.836+0000","updated":"2017-09-11T07:47:00.836+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16160901","id":"16160901","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daijy","name":"daijy","key":"daijy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Dai","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch pushed to master.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daijy","name":"daijy","key":"daijy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Dai","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-09-11T08:14:45.843+0000","updated":"2017-09-11T08:14:45.843+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16169484","id":"16169484","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=leftylev","name":"leftylev","key":"lefty@hortonworks.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lefty%40hortonworks.com&avatarId=15906","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lefty%40hortonworks.com&avatarId=15906","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lefty%40hortonworks.com&avatarId=15906","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lefty%40hortonworks.com&avatarId=15906"},"displayName":"Lefty Leverenz","active":true,"timeZone":"America/New_York"},"body":"Doc note:  This adds *hive.notification.sequence.lock.max.retries* and *hive.notification.sequence.lock.retry.sleep.interval* to HiveConf.java, so they need to be documented in the wiki.\n\nApparently they belong in the metastore section.\n\n* [Configuration Properties -- MetaStore | https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-MetaStore]\n\nAdded a TODOC3.0 label.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=leftylev","name":"leftylev","key":"lefty@hortonworks.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lefty%40hortonworks.com&avatarId=15906","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lefty%40hortonworks.com&avatarId=15906","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lefty%40hortonworks.com&avatarId=15906","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lefty%40hortonworks.com&avatarId=15906"},"displayName":"Lefty Leverenz","active":true,"timeZone":"America/New_York"},"created":"2017-09-18T00:19:47.198+0000","updated":"2017-09-18T00:19:47.198+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16340466","id":"16340466","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek] [~thejas] What do you think about implementing SELECT FOR UPDATE using the mechanism from HIVE-18526? It is much simpler and uses documented DataNucleus semantics.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-01-26T02:17:20.017+0000","updated":"2018-01-26T02:17:20.017+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16342893","id":"16342893","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"[http://www.datanucleus.org/products/accessplatform_4_1/jdo/transactions.html]\r\n{quote}By default DataNucleus does not currently lock the objects fetched with pessimistic locking, but you can configure this behaviour for RDBMS datastores by setting the persistence property datanucleus.SerializeRead to true. This will result in all \"SELECT ... FROM ...\" statements being changed to be \"SELECT ... FROM ... FOR UPDATE\". *This will be applied only where the underlying RDBMS supports the \"FOR UPDATE\" syntax.*\r\n{quote}\r\nfor SQLServer this will not work since the syntax is different. the code shows us using datanuclues 4.1 version btw.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2018-01-29T04:31:43.986+0000","updated":"2018-01-29T04:31:43.986+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16343724","id":"16343724","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=LinaAtAustin","name":"LinaAtAustin","key":"linaataustin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=linaataustin&avatarId=31361","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=linaataustin&avatarId=31361","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=linaataustin&avatarId=31361","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=linaataustin&avatarId=31361"},"displayName":"Na Li","active":true,"timeZone":"America/Chicago"},"body":"* This will be effective only where the underlying RDBMS supports the \"FOR UPDATE\" syntax. [http://www.datanucleus.org/products/accessplatform_4_1/jdo/transactions.html]\r\n * {color:#0000ff}MySql, Oracle,  DB2, Derby{color} {color:#0000ff}support this \"SELECT FOR UPDATE\" syntax.{color}\r\n * {color:#333333}[https://dev.mysql.com/doc/refman/5.7/en/innodb-locking-reads.html]{color}\r\n * {color:#333333}[https://www.toadworld.com/platforms/oracle/w/wiki/1875.select-for-update]\r\n{color}\r\n * {color:#333333}[https://www.ibm.com/support/knowledgecenter/en/SSEPEK_11.0.0/sqlref/src/tpc/db2z_sql_selectstatementexamples.html]\r\n{color}\r\n * {color:#333333}[https://www.postgresql.org/docs/9.0/static/sql-select.html]\r\n{color}\r\n * {color:#333333}[https://db.apache.org/derby/docs/10.2/ref/rrefsqlj31783.html]\r\n{color}\r\n * {color:#333333}The SQL standard specifies a {{FOR UPDATE}} clause to be applicable for cursors. Most databases interpret this as being applicable for all {{SELECT}}statements. An {color:#ff9900}exception{color} to this rule are the {color:#ff9900}CUBRID{color} and {color:#ff9900}SQL Server{color} databases, that do not allow for any {{FOR UPDATE}} clause in a regular SQL [https://www.jooq.org/doc/3.6/manual/sql-building/sql-statements/select-statement/for-update-clause/]{color}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=LinaAtAustin","name":"LinaAtAustin","key":"linaataustin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=linaataustin&avatarId=31361","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=linaataustin&avatarId=31361","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=linaataustin&avatarId=31361","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=linaataustin&avatarId=31361"},"displayName":"Na Li","active":true,"timeZone":"America/Chicago"},"created":"2018-01-29T18:02:02.456+0000","updated":"2018-01-29T18:02:02.456+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16343970","id":"16343970","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek] [~LinaAtAustin] \r\n\r\nThe documentation isn't telling the whole story. Actual MSSQLServerAdapter does implement it. Looking at \r\n\r\ngetSelectStatement() we see:\r\n{code:java}\r\nif (lock && dba.supportsOption(DatastoreAdapter.LOCK_OPTION_PLACED_AFTER_FROM))\r\n{\r\n    sql.append(\" WITH \").append(dba.getSelectWithLockOption());\r\n}\r\n{code}\r\n \r\n\r\nNow, looking at MSSQLServerAdapter, it has:\r\n{code:java}\r\npublic String getSelectWithLockOption()\r\n{\r\n    return \"(UPDLOCK, ROWLOCK)\";\r\n}\r\n{code}\r\nSo it is implemented for MS SQL Server as well by Data Nucleus.\r\n\r\n \r\n\r\nAnd MS SQL adapter does define \r\n{code:java}\r\nLOCK_OPTION_PLACED_AFTER_FROM{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-01-29T20:30:51.730+0000","updated":"2018-01-29T20:36:15.423+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16344530","id":"16344530","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"[~akolb] seems to work based on code as you suggest, if you could test this as well against a mssqlserver that will be great, I am ok with reimplementing this patch.\r\n\r\n[~thejas] anything else we need to take care of ?\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2018-01-30T05:41:21.063+0000","updated":"2018-01-30T05:41:21.063+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16344546","id":"16344546","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek] I don't have access to MS SQL server - do you have something? The test requires tables created for HMS (at least two notification tables, the rest are irrelevant).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-01-30T06:05:16.845+0000","updated":"2018-01-30T06:05:16.845+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16344606","id":"16344606","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"nope i dont have one either.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2018-01-30T07:22:05.067+0000","updated":"2018-01-30T07:22:05.067+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16346006","id":"16346006","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek] I verified that the DataNucleus based patch works on MS SQL server (and that test fails without the patch). How should we proceed?\r\n\r\nI'm mostly interested in branch-2 patch for now, but it would be best to have similar code in branch-2 and branch-3. Would the following work for you:\r\n * We put DataNucleus based patch in branch-2\r\n * We figure out the way to update branch 3 to have the same fix.\r\n\r\nOr you'd rather prefer some other way forward?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-01-30T23:50:55.300+0000","updated":"2018-01-30T23:50:55.300+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16348354","id":"16348354","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"body":"[~akolb] i would rather not have difference between the two branches, if you could make sure that the branch 3 is also updated with the fix very soon, in near future that would be great, assuming you are doing branch-2 fix first. \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anishek","name":"anishek","key":"anishek","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anishek","active":true,"timeZone":"Asia/Kolkata"},"created":"2018-02-01T10:30:14.286+0000","updated":"2018-02-01T10:30:14.286+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16349622","id":"16349622","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~anishek] I am fine with updating branch 3 as well. Do you want to do it yourself or you'd like me to do it? I think we need to do the following:\r\n * Make sure you are Ok with the suggested fix\r\n * Revert the original fix\r\n * Apply new fix.\r\n\r\nSo this will be two commits on branch-3 and one commit on branch-2.\r\n\r\nPlease4 let me know what you think about it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=akolb","name":"akolb","key":"akolb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alexander Kolbasov","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-02T01:17:36.154+0000","updated":"2018-02-02T01:17:36.154+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16486441","id":"16486441","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"body":"Hive 3.0.0 has been released so closing this jira.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vgarg","name":"vgarg","key":"vgarg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vgarg&avatarId=30430","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vgarg&avatarId=30430","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vgarg&avatarId=30430","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vgarg&avatarId=30430"},"displayName":"Vineet Garg","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-05-23T00:00:41.765+0000","updated":"2018-05-23T00:00:41.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13079310/comment/16559265","id":"16559265","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user anishek closed the pull request at:\n\n    https://github.com/apache/hive/pull/237\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2018-07-27T05:14:21.849+0000","updated":"2018-07-27T05:14:21.849+0000"}],"maxResults":96,"total":96,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-16886/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3g6nz:"}}