{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12646157","self":"https://issues.apache.org/jira/rest/api/2/issue/12646157","key":"HIVE-4502","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324312","id":"12324312","description":"released","name":"0.12.0","archived":false,"released":true,"releaseDate":"2013-10-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-05-09T11:33:15.220+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Oct 15 23:29:30 UTC 2013","customfield_12310420":"326515","customfield_12312320":null,"customfield_12310222":"10002_*:*_5_*:*_6311374418_*|*_1_*:*_5_*:*_410114005_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-07-23T00:53:23.728+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4502/watchers","watchCount":9,"isWatching":false},"created":"2013-05-06T05:48:35.334+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"9.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323587","id":"12323587","description":"Hive 0.11.0","name":"0.11.0","archived":false,"released":true,"releaseDate":"2013-05-15"}],"issuelinks":[{"id":"12370273","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12370273","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12650797","key":"HIVE-4650","self":"https://issues.apache.org/jira/rest/api/2/issue/12650797","fields":{"summary":"Getting Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.MapRedTask on auto convert to MapJoin after upgrade to Hive-0.11.0.x from hive-0.10.0.x","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-10-15T23:29:30.739+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"Found this issue while running some SMB joins. Attaching test case that causes this error.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12593432","id":"12593432","filename":"HIVE-4502.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2013-07-21T20:46:57.039+0000","size":136314,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12593432/HIVE-4502.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12582449","id":"12582449","filename":"HIVE-4502.D10695.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-05-09T11:33:15.373+0000","size":98851,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12582449/HIVE-4502.D10695.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12587021","id":"12587021","filename":"HIVE-4502.D10695.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-06-10T04:52:20.480+0000","size":117284,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12587021/HIVE-4502.D10695.2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12592133","id":"12592133","filename":"HIVE-4502.D10695.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-13T08:49:46.776+0000","size":117808,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12592133/HIVE-4502.D10695.3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12592916","id":"12592916","filename":"HIVE-4502.D10695.4.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-18T05:08:47.987+0000","size":124619,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12592916/HIVE-4502.D10695.4.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12593431","id":"12593431","filename":"HIVE-4502.incremental.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2013-07-21T20:36:15.092+0000","size":5622,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12593431/HIVE-4502.incremental.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12593370","id":"12593370","filename":"HIVE-4502.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-21T00:06:38.482+0000","size":126467,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12593370/HIVE-4502.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12586024","id":"12586024","filename":"smb_mapjoin_25.q","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-04T02:07:31.199+0000","size":6437,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12586024/smb_mapjoin_25.q"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12581848","id":"12581848","filename":"smb_mapjoin_25.q","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-05-06T05:49:20.815+0000","size":2463,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12581848/smb_mapjoin_25.q"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"326860","customfield_12312823":null,"summary":"NPE - subquery smb joins fails","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13649536","id":"13649536","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"body":"java.lang.NullPointerException\n    [junit] \tat org.apache.hadoop.hive.ql.exec.ExprNodeColumnEvaluator.initialize(ExprNodeColumnEvaluator.java:82)\n    [junit] \tat org.apache.hadoop.hive.ql.exec.JoinUtil.getObjectInspectorsFromEvaluators(JoinUtil.java:68)\n    [junit] \tat org.apache.hadoop.hive.ql.exec.CommonJoinOperator.initializeOp(CommonJoinOperator.java:224)\n    [junit] \tat org.apache.hadoop.hive.ql.exec.JoinOperator.initializeOp(JoinOperator.java:61)\n    [junit] \tat org.apache.hadoop.hive.ql.exec.Operator.initialize(Operator.java:375)\n    [junit] \tat org.apache.hadoop.hive.ql.exec.ExecReducer.configure(ExecReducer.java:154)\n    [junit] \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    [junit] \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n    [junit] \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n    [junit] \tat java.lang.reflect.Method.invoke(Method.java:597)\n    [junit] \tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:88)\n    [junit] \tat org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:64)\n    [junit] \tat org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:117)\n    [junit] \tat org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:486)\n    [junit] \tat org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:421)\n    [junit] \tat org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:262)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-05-06T06:05:36.176+0000","updated":"2013-05-06T06:05:36.176+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13652880","id":"13652880","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"navis requested code review of \"HIVE-4502 [jira] NPE - subquery smb joins fails\".\n\nReviewers: JIRA\n\nHIVE-4502 NPE - subquery smb joins fails\n\nFound this issue while running some SMB joins. Attaching test case that causes this error.\n\nTEST PLAN\n  EMPTY\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10695\n\nAFFECTED FILES\n  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java\n  ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultGraphWalker.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink3.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinProcessor.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/GenMapRedWalker.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java\n  ql/src/test/queries/clientpositive/smb_mapjoin_25.q\n  ql/src/test/results/clientpositive/auto_smb_mapjoin_14.q.out\n  ql/src/test/results/clientpositive/auto_sortmerge_join_6.q.out\n  ql/src/test/results/clientpositive/auto_sortmerge_join_9.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin1.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin2.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin3.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin4.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin_negative.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin_negative2.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_2.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_4.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_5.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_6.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_7.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_8.q.out\n  ql/src/test/results/clientpositive/mapjoin_distinct.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin9.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_11.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_12.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_14.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_25.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_6.q.out\n\nMANAGE HERALD RULES\n  https://reviews.facebook.net/herald/view/differential/\n\nWHY DID I GET THIS EMAIL?\n  https://reviews.facebook.net/herald/transcript/25653/\n\nTo: JIRA, navis\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-05-09T11:33:15.220+0000","updated":"2013-05-09T11:33:15.220+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13655799","id":"13655799","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~navis]\n\nMy attached patch actually retains the SMB join and I feel it is a better plan over-all than converting all of the joins to reduce side joins. It would be great if you could take a look and let me know your opinion. All existing unit tests pass with this patch.\n\nThanks\nVikram.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-05-13T06:38:19.849+0000","updated":"2013-05-13T06:38:19.849+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13662539","id":"13662539","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"body":"Review board request:\n\nhttps://reviews.apache.org/r/11082/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-05-21T01:02:46.691+0000","updated":"2013-05-21T01:02:46.691+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13673578","id":"13673578","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"[~navis] Would you like to take a look at Vikram's patch? I think if we can retain SMBJoin instead of converting them to reduce-side join, thats better.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-03T21:12:59.847+0000","updated":"2013-06-03T21:12:59.847+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13673856","id":"13673856","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"I've not converted any SMBJoins to RS-joins and just changed creation order of those. The difference is that my patch adds a root task only when all of the join aliases are handled, which is contrary to trunk (add root whenever possible and remove if it's not afterwards). The patch I've attached seemed easier but it is just my call.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-06-04T00:28:36.975+0000","updated":"2013-06-04T00:28:36.975+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13673946","id":"13673946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"body":"[~navis] I misread the results of the test case from your patch. I was going through your patch more meticulously and found that a few of the tests have different results. Particularly those in auto_sortmerge_join_6.q. The count results seem to have changed.\n\nHIVE-3891 converts SMB joins to map-joins when possible. Although that seems orthogonal to this change, any idea as to why the join is still SMB?\n\nAlso attached a few more tests for this. The plans seem valid after applying your patch. I will continue to review the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-04T02:09:29.646+0000","updated":"2013-06-04T02:09:29.646+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13678314","id":"13678314","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"[~navis] Sorry earlier I didnt look at the patch closely. Now, I see you indeed are doing the right thing. We should move forward on this. Did you get a chance to see why results have changed for auto_sortmerge_join_6.q Perhaps, earlier results are wrong ? Also, it will be good to add [~vikram.dixit] 's testcases (or some simplified version of it)in the patch, if its easy enough. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-07T19:00:52.476+0000","updated":"2013-06-07T19:00:52.476+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13678926","id":"13678926","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brucenelson6655","name":"brucenelson6655","key":"brucenelson6655","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Nelson","active":true,"timeZone":"America/Los_Angeles"},"body":"I verified that HIVE-4502-1.patch for HIVE-4650 has been applied to HWorx hive-0.11.0.1.3.0.0-170 and the MapJoin issue in HIVE-4650 still exits. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brucenelson6655","name":"brucenelson6655","key":"brucenelson6655","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Nelson","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-09T03:44:04.108+0000","updated":"2013-06-09T03:44:04.108+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13678929","id":"13678929","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brucenelson6655","name":"brucenelson6655","key":"brucenelson6655","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Nelson","active":true,"timeZone":"America/Los_Angeles"},"body":"Correction - typo on my part its hive-0.11.0.1.3.0.0-107 not *-170","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brucenelson6655","name":"brucenelson6655","key":"brucenelson6655","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bruce Nelson","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-06-09T03:48:56.428+0000","updated":"2013-06-09T03:48:56.428+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13679262","id":"13679262","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"Sorry to all. I've seen this assigned to Vikram days ago and completely forgot.\n\nIt's my bad to have missed the changed result of auto_sortmerge_join_6.q. And I've looked into this today. It seemed another bug in trunk which does not handle joining plan in some particular order. For example,\n\n{noformat}\nset hive.auto.convert.sortmerge.join=true;\nset hive.optimize.bucketmapjoin = true;\nset hive.optimize.bucketmapjoin.sortedmerge = true;\nset hive.auto.convert.join=true;\nset hive.auto.convert.join.noconditionaltask=true;\nset hive.auto.convert.join.noconditionaltask.size=200;\nset hive.auto.convert.sortmerge.join.to.mapjoin=false;\n\nselect * FROM tbl1 a JOIN tbl2 b ON a.key = b.key join src c on c.value = a.value;\n{noformat}\n\nThe above query is from auto_sortmerge_join_6.q and works well. But if we change alias 'c' to 'd', it will fail. The former makes MAPJOIN first and JOIN later but the latter makes JOIN first and MAPJOIN later, making strange plan which does not work. I should fix that, too.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-06-10T02:28:08.880+0000","updated":"2013-06-10T02:28:08.880+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13679305","id":"13679305","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"navis updated the revision \"HIVE-4502 [jira] NPE - subquery smb joins fails\".\n\n  Fixed changed results & add test cases for that.\n\nReviewers: JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10695\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D10695?vs=33447&id=34479#toc\n\nAFFECTED FILES\n  ql/src/java/org/apache/hadoop/hive/ql/QueryPlan.java\n  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java\n  ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultGraphWalker.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink3.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinProcessor.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/GenMapRedWalker.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java\n  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java\n  ql/src/test/queries/clientpositive/auto_sortmerge_join_6.q\n  ql/src/test/queries/clientpositive/smb_mapjoin_25.q\n  ql/src/test/results/clientpositive/auto_smb_mapjoin_14.q.out\n  ql/src/test/results/clientpositive/auto_sortmerge_join_6.q.out\n  ql/src/test/results/clientpositive/auto_sortmerge_join_9.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin1.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin2.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin3.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin4.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin_negative.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin_negative2.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_2.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_4.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_5.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_6.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_7.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_8.q.out\n  ql/src/test/results/clientpositive/mapjoin_distinct.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin9.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_11.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_12.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_14.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_25.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_6.q.out\n  ql/src/test/results/clientpositive/stats11.q.out\n\nTo: JIRA, navis\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-06-10T04:52:20.411+0000","updated":"2013-06-10T04:52:20.411+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13679307","id":"13679307","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"Running test","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-06-10T04:58:10.739+0000","updated":"2013-06-10T04:58:10.739+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13679315","id":"13679315","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"brock has commented on the revision \"HIVE-4502 [jira] NPE - subquery smb joins fails\".\n\n  One minor question\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinProcessor.java:265 What do you think of passing the exception into the constructor of the SemanticException instead of printing it to standard error?\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10695\n\nTo: JIRA, navis\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-06-10T05:10:20.866+0000","updated":"2013-06-10T05:10:20.866+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13679321","id":"13679321","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"navis has commented on the revision \"HIVE-4502 [jira] NPE - subquery smb joins fails\".\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinProcessor.java:265 I prefer that way, too. But I've just fixed typo because it's not related to this issue. Can I do that?\n  ql/src/java/org/apache/hadoop/hive/ql/QueryPlan.java:619 I should de-comment this. Sorry.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10695\n\nTo: JIRA, navis\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-06-10T05:16:22.986+0000","updated":"2013-06-10T05:16:22.986+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13680090","id":"13680090","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"passed all tests","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-06-11T00:24:06.818+0000","updated":"2013-06-11T00:24:06.818+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13707699","id":"13707699","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"navis updated the revision \"HIVE-4502 [jira] NPE - subquery smb joins fails\".\n\n  Rebased to trunk\n\nReviewers: JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10695\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D10695?vs=34479&id=35697#toc\n\nAFFECTED FILES\n  ql/src/java/org/apache/hadoop/hive/ql/QueryPlan.java\n  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java\n  ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultGraphWalker.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink3.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinProcessor.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/GenMapRedWalker.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/MapReduceCompiler.java\n  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java\n  ql/src/test/queries/clientpositive/auto_sortmerge_join_6.q\n  ql/src/test/queries/clientpositive/smb_mapjoin_25.q\n  ql/src/test/results/clientpositive/auto_smb_mapjoin_14.q.out\n  ql/src/test/results/clientpositive/auto_sortmerge_join_6.q.out\n  ql/src/test/results/clientpositive/auto_sortmerge_join_9.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin1.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin2.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin3.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin4.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin_negative.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin_negative2.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_2.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_4.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_5.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_6.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_7.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_8.q.out\n  ql/src/test/results/clientpositive/mapjoin_distinct.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin9.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_11.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_12.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_14.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_25.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_6.q.out\n  ql/src/test/results/clientpositive/stats11.q.out\n\nTo: JIRA, navis\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-13T08:49:46.602+0000","updated":"2013-07-13T08:49:46.602+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13709352","id":"13709352","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"ashutoshc has requested changes to the revision \"HIVE-4502 [jira] NPE - subquery smb joins fails\".\n\n  I dont like the idea of tracking operators in the task thereby tasks getting involved in plan manipulation but in absence of alternatives, this may be the way to move forward for now.\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/QueryPlan.java:619 I guess this is unintentional.\n  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java:72 I am little hesistant about task being aware of operators. Ideally if we have good demarkation of different layers, task (which is sort of a driver to execute a plan) need not be aware of operators contained in its plan. Planner shouldn't wait so late that it needs to track operators in task to generate plan correctly. I don't have a proposal on how to do this better though. At the very least, it will help to add comment explaining the purpose of this list.\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java:70 I think its better to do following:\n  If (op.getNumChild() != 1){\n    throw new IllegalStateException(\"Expecting operator \" + op + \"to have one child. Found: \" + op.getNumChild());\n  }\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:261 It will be good to add comments on what this method intends to do. Also, I guess you can make this protected, since all the callers of this method are in same package.\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:281 Does this method need to be public?\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:310 I didnt get this part. Can you add comments why old and curr tasks need to be of type ExecDriver. What about MapredLocalWork?\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:318 Does this method need to be public? Also, please add javadocs for the method.\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:851 throw IllegalStateException in case # of parents != 1\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:949 I didnt get why did you remove this if check. We shall be needing tagging only for joins. Right? Removing this check implies we will tag always, is that needed?\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:942 Better name: hasBranchFinished() ?\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java:228 Why is this function call needed here? Can you please add comment for it?\n  ql/src/test/results/clientpositive/auto_smb_mapjoin_14.q.out:165 I see that there is no Stage-2 at all. What caused this? Its little weird that we have stages 0,1 and 3 in plan and no stage-2 at all.\n  ql/src/test/results/clientpositive/auto_smb_mapjoin_14.q.out:349 No stage-2 here either. Probably the same cause?\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10695\n\nBRANCH\n  HIVE-4502\n\nARCANIST PROJECT\n  hive\n\nTo: JIRA, ashutoshc, navis\nCc: brock\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-16T01:52:48.173+0000","updated":"2013-07-16T01:52:48.173+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13710519","id":"13710519","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12592133/HIVE-4502.D10695.3.patch\n\n{color:green}SUCCESS:{color} +1 all tests passed\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/8/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/8/console\n\nMessages:\nExecuting org.apache.hive.ptest.execution.CleanupPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-07-17T00:16:51.731+0000","updated":"2013-07-17T00:16:51.731+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13711534","id":"13711534","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"vikram has commented on the revision \"HIVE-4502 [jira] NPE - subquery smb joins fails\".\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java:72 Maybe this can be moved to GenMRProcCtx and a hashmap used there can provide the same functionality.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10695\n\nBRANCH\n  HIVE-4502\n\nARCANIST PROJECT\n  hive\n\nTo: JIRA, ashutoshc, navis\nCc: brock, vikram\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-17T19:46:46.878+0000","updated":"2013-07-17T19:46:46.878+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13711560","id":"13711560","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"body":"Left some comments on Phabricator. [~navis] could you please take a look.\n\nThanks\nVikram.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vikram.dixit","name":"vikram.dixit","key":"vikram.dixit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vikram Dixit K","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-17T20:16:37.297+0000","updated":"2013-07-17T20:16:37.297+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13711561","id":"13711561","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"vikram has commented on the revision \"HIVE-4502 [jira] NPE - subquery smb joins fails\".\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java:72 You could have a hashmap from task to seenOp in the GenMRProCtx that maps a task to its corresponding operator(s). Map<Task, List<Operator<?>>> should do the trick. This should address Ashutosh's concern.\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10695\n\nBRANCH\n  HIVE-4502\n\nARCANIST PROJECT\n  hive\n\nTo: JIRA, ashutoshc, navis\nCc: brock, vikram\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-17T20:16:47.333+0000","updated":"2013-07-17T20:16:47.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13711935","id":"13711935","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"body":"Addressing comments","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=navis","name":"navis","key":"navis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=navis&avatarId=19885","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=navis&avatarId=19885","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=navis&avatarId=19885","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=navis&avatarId=19885"},"displayName":"Navis","active":true,"timeZone":"Asia/Seoul"},"created":"2013-07-18T02:01:49.836+0000","updated":"2013-07-18T02:01:49.836+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13712016","id":"13712016","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"navis has commented on the revision \"HIVE-4502 [jira] NPE - subquery smb joins fails\".\n\nINLINE COMMENTS\n  ql/src/java/org/apache/hadoop/hive/ql/QueryPlan.java:619 Ah sorry. This was throwing NPE when debugging.\n  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java:72 Ok, sure.\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java:70 I think it's not possible to have 2 or more children for RS, but might be possible for Tez. I'll do that.\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:261 ok\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:281 No. Will be changed to package local.\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:310 MapRedTask in fact. If any of MapRedTask need BucketizedInputFormat, use BucketizedInputFormat. It's fix for https://issues.apache.org/jira/browse/HIVE-4502?focusedCommentId=13679262&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13679262\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:851 ok.\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:942 done\n  ql/src/test/results/clientpositive/auto_smb_mapjoin_14.q.out:165 If Task-A is merged into Task-B, task-A will not be visible anywhere. I've changed not to walk further when all parents are not walked, which changed stage-ids in result.\n\n  TS1  TS2\n      SMB\n       RS\n      GBY\n       RS\n      GBY\n       FS\n\n  before :\n  TS1(stage-1)-SMB-RS-GBY[split]RS(stage-2)-GBY-FS\n  TS2(stage-3)-SMB[merge into stage-1]-RS-GBY-RS-GBY-RS-FS\n\n  after :\n  TS1(stage-1)-SMB\n  TS2(stage-2)-SMB[merged into stage-1]-RS-GBY[split]RS(stage-3)-GBY-FS\n\n  I'll make a issue for rearranging Stage-IDs. (and order of explain output, too)\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java:228 It's just a refactoring. setupBucketMapJoinInfo() was called both in initMapJoinPlan() and joinMapJoinPlan().\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:318 ok\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:949 It's called in join-checked block.\n  if (reducer.getClass() == JoinOperator.class) {\n    ....\n    cplan.setNeedsTagging(true);\n  }\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10695\n\nBRANCH\n  HIVE-4502\n\nARCANIST PROJECT\n  hive\n\nTo: JIRA, ashutoshc, navis\nCc: brock, vikram\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-18T05:06:47.546+0000","updated":"2013-07-18T05:06:47.546+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13712017","id":"13712017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"navis updated the revision \"HIVE-4502 [jira] NPE - subquery smb joins fails\".\n\n  Addressed comments\n\nReviewers: ashutoshc, JIRA\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10695\n\nCHANGE SINCE LAST DIFF\n  https://reviews.facebook.net/D10695?vs=35697&id=35865#toc\n\nAFFECTED FILES\n  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java\n  ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultGraphWalker.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink3.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java\n  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinProcessor.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/GenMapRedWalker.java\n  ql/src/java/org/apache/hadoop/hive/ql/parse/MapReduceCompiler.java\n  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java\n  ql/src/test/queries/clientpositive/auto_sortmerge_join_6.q\n  ql/src/test/queries/clientpositive/smb_mapjoin_25.q\n  ql/src/test/results/clientpositive/auto_smb_mapjoin_14.q.out\n  ql/src/test/results/clientpositive/auto_sortmerge_join_6.q.out\n  ql/src/test/results/clientpositive/auto_sortmerge_join_9.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin1.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin2.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin3.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin4.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin_negative.q.out\n  ql/src/test/results/clientpositive/bucketmapjoin_negative2.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_2.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_4.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_5.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_6.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_7.q.out\n  ql/src/test/results/clientpositive/bucketsortoptimize_insert_8.q.out\n  ql/src/test/results/clientpositive/mapjoin_distinct.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin9.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_11.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_12.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_14.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_25.q.out\n  ql/src/test/results/clientpositive/smb_mapjoin_6.q.out\n  ql/src/test/results/clientpositive/stats11.q.out\n\nTo: JIRA, ashutoshc, navis\nCc: brock, vikram\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-18T05:08:47.852+0000","updated":"2013-07-18T05:08:47.852+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13714573","id":"13714573","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"body":"ashutoshc has accepted the revision \"HIVE-4502 [jira] NPE - subquery smb joins fails\".\n\n  +1\n\nREVISION DETAIL\n  https://reviews.facebook.net/D10695\n\nBRANCH\n  HIVE-4502\n\nARCANIST PROJECT\n  hive\n\nTo: JIRA, ashutoshc, navis\nCc: brock, vikram\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=phabricator%40reviews.facebook.net","name":"phabricator@reviews.facebook.net","key":"phabricator@reviews.facebook.net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phabricator","active":true,"timeZone":"Etc/UTC"},"created":"2013-07-20T23:52:48.575+0000","updated":"2013-07-20T23:52:48.575+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13714575","id":"13714575","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Canceling patch to trigger pre-commit test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-21T00:05:00.045+0000","updated":"2013-07-21T00:05:00.045+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13714576","id":"13714576","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"[~navis] I rebased your patch on trunk. Attaching here for reference.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-21T00:06:38.484+0000","updated":"2013-07-21T00:06:38.484+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13714652","id":"13714652","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 at least one tests failed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12593370/HIVE-4502.patch\n\n{color:red}ERROR:{color} -1 due to 2 failed/errored test(s), 2647 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_correlationoptimizer6\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_correlationoptimizer3\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/117/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/117/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.CleanupPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests failed with: TestsFailedException: 2 tests failed\n{noformat}\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-07-21T06:24:58.018+0000","updated":"2013-07-21T06:24:58.018+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13714656","id":"13714656","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"I will take a look at these two failed tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2013-07-21T07:08:02.055+0000","updated":"2013-07-21T07:08:02.055+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13714762","id":"13714762","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"The failed query in correlationoptimizer3.q is ...\n{code:sql}\nset hive.optimize.correlation=true;\nset hive.auto.convert.join=true;\nset hive.optimize.mapjoin.mapreduce=true;\n\nSELECT d.key AS key, d.cnt AS cnt, b.value as value\nFROM (SELECT x.key as key, x.value as value FROM src1 x JOIN src y ON (x.key = y.key)) b\nJOIN (SELECT x.key as key, count(1) AS cnt FROM src1 x JOIN src y ON (x.key = y.key) group by x.key) d\nON (b.key = d.key);\n{\\code}\nand here is the stack trace ...\n{code}\n2013-07-21 10:14:04,440 INFO  lazybinary.LazyBinaryStruct (LazyBinaryStruct.java:parse(172)) - Missing fields! Expected 1 fields but only got 0! Ignoring similar problems.\n2013-07-21 10:14:04,444 FATAL ExecReducer (ExecReducer.java:reduce(269)) - org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row (tag=0) {\"key\":{\"joinkey0\":\"128\"},\"value\":{\"_col1\":\"\"}}\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.reduce(ExecReducer.java:258)\n\tat org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:520)\n\tat org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:421)\n\tat org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:262)\nCaused by: java.lang.ArrayIndexOutOfBoundsException\n\tat java.lang.System.arraycopy(Native Method)\n\tat org.apache.hadoop.io.Text.set(Text.java:205)\n\tat org.apache.hadoop.hive.serde2.lazybinary.LazyBinaryString.init(LazyBinaryString.java:48)\n\tat org.apache.hadoop.hive.serde2.lazybinary.LazyBinaryStruct.uncheckedGetField(LazyBinaryStruct.java:216)\n\tat org.apache.hadoop.hive.serde2.lazybinary.LazyBinaryStruct.getField(LazyBinaryStruct.java:197)\n\tat org.apache.hadoop.hive.serde2.lazybinary.objectinspector.LazyBinaryStructObjectInspector.getStructFieldData(LazyBinaryStructObjectInspector.java:61)\n\tat org.apache.hadoop.hive.serde2.SerDeUtils.buildJSONString(SerDeUtils.java:371)\n\tat org.apache.hadoop.hive.serde2.SerDeUtils.buildJSONString(SerDeUtils.java:371)\n\tat org.apache.hadoop.hive.serde2.SerDeUtils.getJSONString(SerDeUtils.java:236)\n\tat org.apache.hadoop.hive.serde2.SerDeUtils.getJSONString(SerDeUtils.java:222)\n\tat org.apache.hadoop.hive.ql.exec.MuxOperator.processOp(MuxOperator.java:249)\n\tat org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:504)\n\tat org.apache.hadoop.hive.ql.exec.DemuxOperator.processOp(DemuxOperator.java:245)\n\tat org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:504)\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.reduce(ExecReducer.java:249)\n\t... 3 more\n{\\code}\n\nAt here, DemuxOperator only replaces the tag (the tag seems correct at here) and forward the row to MuxOperator. Then, MuxOperator will just forward the row to the JoinOperator. Seems we cannot get the value in this case... Still looking for the root cause... Seems related to MapJoin because the query with hive.optimize.correlation=true and hive.auto.convert.join=false is fine.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2013-07-21T18:07:14.645+0000","updated":"2013-07-21T18:07:14.645+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13714791","id":"13714791","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"Problem found. It's because in 'splitTasks' the new patch (uploaded at 20/Jul/13 17:06) did not set needsTagging for the MR job which has DemuxOperator. Will upload a incremental patch later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2013-07-21T19:55:14.581+0000","updated":"2013-07-21T19:55:14.581+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13714800","id":"13714800","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"HIVE-4502.incremental.patch has extra changes I made based on HIVE-4502.patch (uploaded at 20/Jul/13 17:06). Since in GenMapRedUtils there are three places that we need to check if we need to need to do tagging, I add a utility method to check the class of the reducer. We will set needsTagging when the reducer is JoinOperator or DemuxOperator. Also, some small updates are needed for test results of those queries related to Correlation Optimizer. Those updates just replace '#### A masked pattern was here ####' with '$INTNAME'.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2013-07-21T20:42:37.770+0000","updated":"2013-07-21T20:42:37.770+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13714802","id":"13714802","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"body":"I merged my incremental patch with Ashutosh's patch. Attaching it (HIVE-4502.1.patch) at here as a reference.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhuai","name":"yhuai","key":"yhuai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=yhuai&avatarId=23452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yhuai&avatarId=23452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yhuai&avatarId=23452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yhuai&avatarId=23452"},"displayName":"Yin Huai","active":true,"timeZone":"America/New_York"},"created":"2013-07-21T20:46:57.042+0000","updated":"2013-07-21T20:46:57.042+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13714876","id":"13714876","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12593432/HIVE-4502.1.patch\n\n{color:green}SUCCESS:{color} +1 2647 tests passed\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/122/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/122/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.CleanupPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n{noformat}\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-07-22T03:09:59.194+0000","updated":"2013-07-22T03:09:59.194+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13715773","id":"13715773","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 Thanks [~yhuai] for taking a look.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-22T22:17:57.164+0000","updated":"2013-07-22T22:17:57.164+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13715936","id":"13715936","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to trunk. Thanks, Navis for the fix! Thanks, Vikram for review and testcases. Thanks, Yin for fixing failing test cases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-07-23T00:53:23.750+0000","updated":"2013-07-23T00:53:23.750+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646157/comment/13795904","id":"13795904","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-10-15T23:29:30.735+0000","updated":"2013-10-15T23:29:30.735+0000"}],"maxResults":38,"total":38,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4502/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1kbwf:"}}