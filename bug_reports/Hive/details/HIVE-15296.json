{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13023866","self":"https://issues.apache.org/jira/rest/api/2/issue/13023866","key":"HIVE-15296","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12335837","id":"12335837","name":"2.2.0","archived":false,"released":true,"releaseDate":"2017-07-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2016-12-02T20:22:37.151+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jan 04 00:03:49 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_181389919_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_590354057","customfield_12312321":null,"resolutiondate":"2016-12-07T19:42:23.364+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-15296/watchers","watchCount":3,"isWatching":false},"created":"2016-11-28T21:20:01.155+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-07-26T00:03:27.465+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"First attempt and failure detection:\n{noformat}\n2016-11-18 20:20:01,980 [INFO] [TaskSchedulerEventHandlerThread] |tezplugins.LlapTaskSchedulerService|: Received allocateRequest. task=attempt_1478967587833_2622_1_06_000031_0, priority=65, capability=&lt;memory:4096, vCores:1&gt;, hosts=[3n01]\n2016-11-18 20:20:01,982 [INFO] [LlapScheduler] |tezplugins.LlapTaskSchedulerService|: Assigned task TaskInfo{task=attempt_1478967587833_2622_1_06_000031_0, priority=65, startTime=0, containerId=null, assignedInstance=null, uniqueId=55, localityDelayTimeout=9223372036854775807} to container container_222212222_2622_01_000056 on node=DynamicServiceInstance [alive=true, host=3n01:15001 with resources=&lt;memory:59392, vCores:16&gt;, shufflePort=15551, servicesAddress=http://3n01:15002, mgmtPort=15004]\n2016-11-18 20:20:01,982 [INFO] [LlapScheduler] |tezplugins.LlapTaskSchedulerService|: ScheduleResult for Task: TaskInfo{task=attempt_1478967587833_2622_1_06_000031_0, priority=65, startTime=10550817928, containerId=container_222212222_2622_01_000056, assignedInstance=DynamicServiceInstance [alive=true, host=3n01:15001 with resources=&lt;memory:59392, vCores:16&gt;, shufflePort=15551, servicesAddress=http://3n01:15002, mgmtPort=15004], uniqueId=55, localityDelayTimeout=9223372036854775807} = SCHEDULED\n2016-11-18 20:20:03,427 [INFO] [Dispatcher thread {Central}] |impl.TaskAttemptImpl|: TaskAttempt: [attempt_1478967587833_2622_1_06_000031_0] started. Is using containerId: [container_222212222_2622_01_000056] on NM: [3n01:15001]\n2016-11-18 20:20:03,427 [INFO] [Dispatcher thread {Central}] |history.HistoryEventHandler|: [HISTORY][DAG:dag_1478967587833_2622_1][Event:TASK_ATTEMPT_STARTED]: vertexName=Map 1, taskAttemptId=attempt_1478967587833_2622_1_06_000031_0, startTime=1479500403427, containerId=container_222212222_2622_01_000056, nodeId=3n01:15001\n2016-11-18 20:20:03,430 [INFO] [TaskCommunicator # 1] |tezplugins.LlapTaskCommunicator|: Successfully launched task: attempt_1478967587833_2622_1_06_000031_0\n2016-11-18 20:20:03,434 [INFO] [IPC Server handler 11 on 43092] |impl.TaskImpl|: TaskAttempt:attempt_1478967587833_2622_1_06_000031_0 sent events: (0-1).\n2016-11-18 20:20:03,434 [INFO] [IPC Server handler 11 on 43092] |impl.VertexImpl|: Sending attempt_1478967587833_2622_1_06_000031_0 24 events [0,24) total 24 vertex_1478967587833_2622_1_06 [Map 1]\n2016-11-18 20:25:43,249 [INFO] [Dispatcher thread {Central}] |history.HistoryEventHandler|: [HISTORY][DAG:dag_1478967587833_2622_1][Event:TASK_ATTEMPT_FINISHED]: vertexName=Map 1, taskAttemptId=attempt_1478967587833_2622_1_06_000031_0, creationTime=1479500401929, allocationTime=1479500403426, startTime=1479500403427, finishTime=1479500743249, timeTaken=339822, status=FAILED, taskFailureType=NON_FATAL, errorEnum=TASK_HEARTBEAT_ERROR, diagnostics=AttemptID:attempt_1478967587833_2622_1_06_000031_0 Timed out after 300 secs, nodeHttpAddress=http://3n01:15002, counters=Counters: 1, org.apache.tez.common.counters.DAGCounter, DATA_LOCAL_TASKS=1\n2016-11-18 20:25:43,255 [INFO] [TaskSchedulerEventHandlerThread] |tezplugins.LlapTaskSchedulerService|: Processing de-allocate request for task=attempt_1478967587833_2622_1_06_000031_0, state=ASSIGNED, endReason=OTHER\n2016-11-18 20:25:43,259 [INFO] [Dispatcher thread {Central}] |node.AMNodeImpl|: Attempt failed on node: 3n01:15001 TA: attempt_1478967587833_2622_1_06_000031_0 failed: true container: container_222212222_2622_01_000056 numFailedTAs: 7\n2016-11-18 20:25:43,262 [INFO] [Dispatcher thread {Central}] |impl.VertexImpl|: Source task attempt completed for vertex: vertex_1478967587833_2622_1_07 [Reducer 2] attempt: attempt_1478967587833_2622_1_06_000031_0 with state: FAILED vertexState: RUNNING\n{noformat}\nSecond attempt:\n{noformat}\n2016-11-18 20:25:43,267 [INFO] [TaskSchedulerEventHandlerThread] |tezplugins.LlapTaskSchedulerService|: Received allocateRequest. task=attempt_1478967587833_2622_1_06_000031_1, priority=64, capability=&lt;memory:4096, vCores:1&gt;, hosts=null\n2016-11-18 20:25:43,297 [INFO] [LlapScheduler] |tezplugins.LlapTaskSchedulerService|: ScheduleResult for Task: TaskInfo{task=attempt_1478967587833_2622_1_06_000031_1, priority=64, startTime=0, containerId=null, assignedInstance=null, uniqueId=318, localityDelayTimeout=9223372036854775807} = DELAYED_RESOURCES\n2016-11-18 20:25:43,297 [INFO] [LlapScheduler] |tezplugins.LlapTaskSchedulerService|: Preempting for task=attempt_1478967587833_2622_1_06_000031_1 on any available host\n2016-11-18 20:25:43,298 [INFO] [LlapScheduler] |tezplugins.LlapTaskSchedulerService|: ScheduleResult for Task: TaskInfo{task=attempt_1478967587833_2622_1_06_000031_1, priority=64, startTime=0, containerId=null, assignedInstance=null, uniqueId=318, localityDelayTimeout=9223372036854775807} = DELAYED_RESOURCES\n2016-11-18 20:25:43,299 [INFO] [LlapScheduler] |tezplugins.LlapTaskSchedulerService|: Assigned task TaskInfo{task=attempt_1478967587833_2622_1_06_000031_1, priority=64, startTime=0, containerId=null, assignedInstance=null, uniqueId=318, localityDelayTimeout=9223372036854775807} to container container_222212222_2622_01_000164 on node=DynamicServiceInstance [alive=true, host=1n02:15001 with resources=&lt;memory:59392, vCores:16&gt;, shufflePort=15551, servicesAddress=http://1n02:15002, mgmtPort=15004]\n2016-11-18 20:25:43,300 [INFO] [LlapScheduler] |tezplugins.LlapTaskSchedulerService|: ScheduleResult for Task: TaskInfo{task=attempt_1478967587833_2622_1_06_000031_1, priority=64, startTime=10551159245, containerId=container_222212222_2622_01_000164, assignedInstance=DynamicServiceInstance [alive=true, host=1n02:15001 with resources=&lt;memory:59392, vCores:16&gt;, shufflePort=15551, servicesAddress=http://1n02:15002, mgmtPort=15004], uniqueId=318, localityDelayTimeout=9223372036854775807} = SCHEDULED\n2016-11-18 20:25:43,301 [INFO] [Dispatcher thread {Central}] |impl.TaskAttemptImpl|: TaskAttempt: [attempt_1478967587833_2622_1_06_000031_1] started. Is using containerId: [container_222212222_2622_01_000164] on NM: [1n02:15001]\n2016-11-18 20:25:43,301 [INFO] [Dispatcher thread {Central}] |history.HistoryEventHandler|: [HISTORY][DAG:dag_1478967587833_2622_1][Event:TASK_ATTEMPT_STARTED]: vertexName=Map 1, taskAttemptId=attempt_1478967587833_2622_1_06_000031_1, startTime=1479500743301, containerId=container_222212222_2622_01_000164, nodeId=1n02:15001\n2016-11-18 20:25:43,485 [INFO] [TaskCommunicator # 7] |tezplugins.LlapTaskCommunicator|: Successfully launched task: attempt_1478967587833_2622_1_06_000031_1\n2016-11-18 20:25:43,500 [INFO] [IPC Server handler 5 on 43092] |impl.TaskImpl|: TaskAttempt:attempt_1478967587833_2622_1_06_000031_1 sent events: (0-1).\n2016-11-18 20:25:43,500 [INFO] [IPC Server handler 5 on 43092] |impl.VertexImpl|: Sending attempt_1478967587833_2622_1_06_000031_1 24 events [0,24) total 24 vertex_1478967587833_2622_1_06 [Map 1]\n{noformat}\nThe IPC thread logs some other activity 250ms later, so it's not stuck nor did it log an error.\nAfter this, there are no mentions of any tasks for 2622_1_06_000031 in the log.\nThe attempt was not running in LLAP.\n\nHowever, the attempt does come up again when the DAG is killed, long time after it was stuck; presumably, AM failed to detect the failure (or heartbeat failure for that matter?) and never tried to reschedule.\n{noformat}\n2016-11-22 08:45:14,228 [INFO] [Dispatcher thread {Central}] |history.HistoryEventHandler|: [HISTORY][DAG:dag_1478967587833_2622_1][Event:TASK_ATTEMPT_FINISHED]: vertexName=Map 1, taskAttemptId=attempt_1478967587833_2622_1_06_000031_1, creationTime=1479500743255, allocationTime=1479500743300, startTime=1479500743301, finishTime=1479804314228, timeTaken=303570927, status=KILLED, errorEnum=TERMINATED_BY_CLIENT, diagnostics=Task KILL is received. Killing attempt. Diagnostics: Killing tasks in vertex: vertex_1478967587833_2622_1_06 [Map 1] due to trigger: DAG_TERMINATED, nodeHttpAddress=http://1n02:15002, counters=Counters: 1, org.apache.tez.common.counters.DAGCounter, OTHER_LOCAL_TASKS=1\n{noformat}\n\nI do see some errors elsewhere to this node (w/Connection refused), but they happen later. Let me know if you need anything else from AM log.\n{noformat}\n2016-11-18 20:27:15,902 [WARN] [TaskCommunicator # 8] |ipc.Client|: Failed to connect to server: 1n02/(snip).2:15001: retries get failed due to exceeded maximum allowed time (in MILLISECONDS): 16000\n2016-11-18 20:27:34,517 [WARN] [TaskCommunicator # 3] |ipc.Client|: Failed to connect to server: 1n02/(snip).2:15001: retries get failed due to exceeded maximum allowed time (in MILLISECONDS): 16000\n{noformat}\n\nIt seems like a parallel query caused the memory exhaustion on LLAP; most mappers for this job eventually completed successfully, a few were lost as per above, and the DAG got stuck because of that.\nRelevant slider containers and restarts (the last one seems to be the one where the attempt was running).\nUnfortunately the logs from relevant LLAP containers are missing from aggregation.\n{noformat}\n2016-11-18 20:20:24,822 [AMRM Callback Handler Thread] ERROR appmaster.SliderAppMaster - Role instance RoleInstance{role='LLAP', id='container_e55_1478967587833_2465_01_000005', container=ContainerID=container_e55_1478967587833_2465_01_000005 nodeID=3n01:45454  ... diagnostics='Container [pid=1636544,containerID=container_e55_1478967587833_2465_01_000005] is running beyond physical memory limits. Current usage: 140.3 GB of 140.3 GB physical memory used; 141.8 GB of 294.5 GB virtual memory used. Killing container.\n2016-11-18 20:20:31,912 [AMRM Callback Handler Thread] ERROR appmaster.SliderAppMaster - Role instance RoleInstance{role='LLAP', id='container_e55_1478967587833_2465_01_000003', container=ContainerID=container_e55_1478967587833_2465_01_000003 nodeID=1n02:45454  ... diagnostics='Container [pid=607173,containerID=container_e55_1478967587833_2465_01_000003] is running beyond physical memory limits. Current usage: 141.0 GB of 140.3 GB physical memory used; 142.5 GB of 294.5 GB virtual memory used. Killing container.\n2016-11-18 20:25:39,248 [AMRM Callback Handler Thread] ERROR appmaster.SliderAppMaster - Role instance RoleInstance{role='LLAP', id='container_e55_1478967587833_2465_01_000007', container=ContainerID=container_e55_1478967587833_2465_01_000007 nodeID=3n01:45454  ... diagnostics='Container [pid=1227721,containerID=container_e55_1478967587833_2465_01_000007] is running beyond physical memory limits. Current usage: 140.3 GB of 140.3 GB physical memory used; 143.2 GB of 294.5 GB virtual memory used. Killing container.\n2016-11-18 20:26:30,250 [AMRM Callback Handler Thread] ERROR appmaster.SliderAppMaster - Role instance RoleInstance{role='LLAP', id='container_e55_1478967587833_2465_01_000009', container=ContainerID=container_e55_1478967587833_2465_01_000009 nodeID=1n02:45454  ... diagnostics='Container [pid=1893586,containerID=container_e55_1478967587833_2465_01_000009] is running beyond physical memory limits. Current usage: 141.2 GB of 140.3 GB physical memory used; 144.4 GB of 294.5 GB virtual memory used. Killing container.\n\n2016-11-18 20:20:41,060 [145589505@qtp-14633842-4] INFO  agent.AgentProviderService - Component operation. Status: COMPLETED; new container state: HEALTHY; new component state: STARTED\n2016-11-18 20:20:49,171 [145589505@qtp-14633842-4] INFO  agent.AgentProviderService - Component operation. Status: COMPLETED; new container state: HEALTHY; new component state: STARTED\n2016-11-18 20:25:55,942 [145589505@qtp-14633842-4] INFO  agent.AgentProviderService - Component operation. Status: COMPLETED; new container state: HEALTHY; new component state: STARTED\n2016-11-18 20:26:47,019 [145589505@qtp-14633842-4] INFO  agent.AgentProviderService - Component operation. Status: COMPLETED; new container state: HEALTHY; new component state: STARTED\n{noformat}\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12842074","id":"12842074","filename":"HIVE-15296.01.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-12-07T02:27:38.480+0000","size":40064,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12842074/HIVE-15296.01.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12841541","id":"12841541","filename":"HIVE-15296.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-12-02T19:13:19.537+0000","size":39988,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12841541/HIVE-15296.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12841170","id":"12841170","filename":"HIVE-15296.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-11-30T23:38:13.794+0000","size":39988,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12841170/HIVE-15296.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"AM may lose task failures and not reschedule when scheduling to LLAP","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13023866/comment/15703167","id":"15703167","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"[~prasanth_j] [~sseth]  [~hagleitn] fyi","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-11-28T21:22:50.027+0000","updated":"2016-11-28T21:24:30.123+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13023866/comment/15703631","id":"15703631","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"fixing the NPE in the latest patch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-11-29T00:04:27.868+0000","updated":"2016-11-29T00:04:27.868+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13023866/comment/15703736","id":"15703736","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"er, wrong jira","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-11-29T00:53:38.037+0000","updated":"2016-11-29T00:53:38.037+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13023866/comment/15710217","id":"15710217","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"Not 100% sure of the root cause.\n1) The difference in heartbeat mechanisms before and after the task is running is actually irrelevant, since it is only present on LLAP side.\n2) The tracking and killing itself is done by Tez AM. Unless there's a bug in Tez, which I cannot see in the code, it should work.\n\nThe problem must be in the part that connects these together. Upon examination, I wonder if having heartbeats from the node (host+port) blindly heartbeat all the tasks that AM *thinks* are on the node is the culrpit? The restarted LLAP can heartbeat in time. \nThis patch propagates unique daemonId usage to node heartbeats (and submit task response, to know the original unique node ID for the task in the first place).\nI left some TODO comments to improve the handling for this, but for now I'd rather not rewrite EntityTracker entirely to use unique ID everywhere.\n\n[~sseth] [~prasanth_j] can you take a look?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-11-30T23:38:13.799+0000","updated":"2016-11-30T23:38:13.799+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13023866/comment/15716180","id":"15716180","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12841541/HIVE-15296.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 8 failed/errored test(s), 10758 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestCliDriver.org.apache.hadoop.hive.cli.TestCliDriver (batchId=50)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample2] (batchId=5)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample4] (batchId=15)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample6] (batchId=61)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample7] (batchId=60)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample9] (batchId=38)\norg.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=134)\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=92)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/2385/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/2385/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2385/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 8 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12841541 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2016-12-02T20:22:37.151+0000","updated":"2016-12-02T20:22:37.151+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13023866/comment/15716556","id":"15716556","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"[~gopalv] can you take a look? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-12-02T21:22:41.527+0000","updated":"2016-12-02T21:22:41.527+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13023866/comment/15727006","id":"15727006","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gopalv","name":"gopalv","key":"gopalv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gopal V","active":true,"timeZone":"Asia/Kolkata"},"body":"The patch fixes an actual issue of in-place restarts, but I've left an RB comment about the possibility of a race condition on thi.uniqueid.\n\nCommit with warnings/caveats on that - +1.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gopalv","name":"gopalv","key":"gopalv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gopal V","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-12-06T23:01:36.621+0000","updated":"2016-12-06T23:01:36.621+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13023866/comment/15727444","id":"15727444","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"Minor update","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-12-07T02:27:38.485+0000","updated":"2016-12-07T02:27:38.485+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13023866/comment/15729365","id":"15729365","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12842074/HIVE-15296.01.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 14 failed/errored test(s), 10741 tests executed\n*Failed tests:*\n{noformat}\nTestHS2ImpersonationWithRemoteMS - did not produce a TEST-*.xml file (likely timed out) (batchId=211)\nTestMiniSparkOnYarnCliDriver - did not produce a TEST-*.xml file (likely timed out) (batchId=158)\n\t[infer_bucket_sort_reducers_power_two.q,list_bucket_dml_10.q,orc_merge9.q,orc_merge6.q,leftsemijoin_mr.q,bucket6.q,bucketmapjoin7.q,uber_reduce.q,empty_dir_in_table.q,vector_outer_join3.q,index_bitmap_auto.q,vector_outer_join2.q,vector_outer_join1.q,orc_merge1.q,orc_merge_diff_fs.q,load_hdfs_file_with_space_in_the_name.q,scriptfile1_win.q,quotedid_smb.q,truncate_column_buckets.q,orc_merge3.q]\nTestOperationLoggingAPIWithMr - did not produce a TEST-*.xml file (likely timed out) (batchId=211)\nTestOperationLoggingLayout - did not produce a TEST-*.xml file (likely timed out) (batchId=211)\nTestXSRFFilter - did not produce a TEST-*.xml file (likely timed out) (batchId=211)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[dbtxnmgr_showlocks] (batchId=71)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample2] (batchId=5)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample4] (batchId=15)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample6] (batchId=61)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample7] (batchId=60)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample9] (batchId=38)\norg.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=134)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[stats_based_fetch_decision] (batchId=150)\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=92)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/2463/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/2463/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-2463/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 14 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12842074 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2016-12-07T17:41:40.417+0000","updated":"2016-12-07T17:41:40.417+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13023866/comment/15729714","id":"15729714","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to master. Thanks for the review!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-12-07T19:42:24.879+0000","updated":"2016-12-07T19:42:24.879+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13023866/comment/15796623","id":"15796623","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sseth","name":"sseth","key":"sseth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Siddharth Seth","active":true,"timeZone":"America/Los_Angeles"},"body":"[~sershe] - thanks for catching this and fixing it. https://issues.apache.org/jira/browse/HIVE-15163 is related to a large extent. Didn't see the potential problem with the wait-queue unfortunately :(\nThe eventual plan was to have a custom NodeId possible in Tez, which can then be defined by LLAP (linked to the ZK registered nodeId). That's essentially why LlapNodeId differs from YARN NodeId, which is used all over the place in Tez. Think this fixes it nicely for now though.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sseth","name":"sseth","key":"sseth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Siddharth Seth","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-04T00:03:49.567+0000","updated":"2017-01-04T00:03:49.567+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-15296/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i36v7z:"}}