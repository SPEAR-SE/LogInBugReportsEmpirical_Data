{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13166081","self":"https://issues.apache.org/jira/rest/api/2/issue/13166081","key":"HIVE-19896","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-06-14T14:11:33.060+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jun 14 14:44:03 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-19896/watchers","watchCount":8,"isWatching":false},"created":"2018-06-14T11:55:04.291+0000","customfield_12310192":"Create view no longer malforms original SQL text","customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332384","id":"12332384","name":"1.2.1","archived":false,"released":true,"releaseDate":"2015-06-26"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12340269","id":"12340269","name":"2.3.0","archived":false,"released":true,"releaseDate":"2017-07-18"}],"issuelinks":[{"id":"12536428","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12536428","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13094433","key":"HIVE-17312","self":"https://issues.apache.org/jira/rest/api/2/issue/13094433","fields":{"summary":"Escaped qualified names in view are parsed incorrectly and result in broken views","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-06-18T08:49:40.350+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12317304","id":"12317304","name":"Views"}],"timeoriginalestimate":null,"description":"We perform additional processing on some of our view definitions and we've found that in some cases Hive actually stores malformed representations of the original source SQL text definition of the view. We have examples where the stored original view text is in fact an unparsable statement. This prevents later processing of the view (recompiling for column adjustments for example) and is counter intuitive to the user.\r\n\r\nSpecifically the failure appears to be focused on the removal of necessary back-tick quoting from the original text on aliases (but possibly other identifiers).\r\nh2. Steps to reproduce (abridged/formatted for clarity):\r\nCreate a view that is subject to malformation:\r\n{code}\r\nhive> create view v as select * from (select 1) as `a.b`;\r\nOK\r\n{code}\r\n\r\nDescribe view definition to obtain original text:\r\n{code}\r\ndescribe extended v;\r\n...\r\nDetailed Table Information\tTable(\r\n  tableName:v,\r\n  dbName:default,\r\n  viewOriginalText:select * from (select 1) as a.b,\r\n  viewExpandedText:select `a.b`.`_c0` from (select 1) as `a.b`,\r\n  tableType:VIRTUAL_VIEW)\r\n{code}\r\nNote that {{viewOriginalText}} value does not equal the text supplied on the first step, specifically {{`a.b`}} â†’ {{a.b}}.\r\n\r\nExecuting {{viewOriginalText}} value results in failure:\r\n{code}\r\nhive> select * from (select 1) as a.b;\r\nNoViableAltException(17@[215:51: ( KW_AS )?])\r\n\tat org.antlr.runtime.DFA.noViableAlt(DFA.java:158)\r\n...\r\nFAILED: ParseException line 1:29 cannot recognize input near 'as' 'a' '.' in subquery source\r\n{code}\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12342162","id":"12342162","name":"2.3.3","archived":false,"released":false,"releaseDate":"2018-04-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12343294","id":"12343294","name":"3.0.1","archived":false,"released":false}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Create view stores invalid, malformed version of original SQL text","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teabot","name":"teabot","key":"teabot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Elliot West","active":true,"timeZone":"Europe/London"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teabot","name":"teabot","key":"teabot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Elliot West","active":true,"timeZone":"Europe/London"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13166081/comment/16512514","id":"16512514","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ddcprg","name":"ddcprg","key":"ddcprg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel del Castillo","active":true,"timeZone":"Etc/UTC"},"body":"Seems duplicate of [HIVE-17312|https://issues.apache.org/jira/browse/HIVE-17312]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ddcprg","name":"ddcprg","key":"ddcprg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel del Castillo","active":true,"timeZone":"Etc/UTC"},"created":"2018-06-14T14:11:33.060+0000","updated":"2018-06-14T14:11:33.060+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13166081/comment/16512561","id":"16512561","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teabot","name":"teabot","key":"teabot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Elliot West","active":true,"timeZone":"Europe/London"},"body":"I think it's related, but strictly speaking doesn't seem to be the same. Probably both share the same root cause. The views are still usable in HIVE-19896 and we're seeing malformation specifically on the 'original' text, which as I understand it is not on any query execution path.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=teabot","name":"teabot","key":"teabot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Elliot West","active":true,"timeZone":"Europe/London"},"created":"2018-06-14T14:44:03.255+0000","updated":"2018-06-14T14:44:03.255+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-19896/votes","votes":5,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3uuwv:"}}