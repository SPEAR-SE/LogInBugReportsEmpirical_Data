{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13061425","self":"https://issues.apache.org/jira/rest/api/2/issue/13061425","key":"HIVE-16370","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-07-12T02:07:11.406+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jul 12 02:07:11 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-16370/watchers","watchCount":5,"isWatching":false},"created":"2017-04-04T13:01:41.202+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329363","id":"12329363","name":"1.1.0","archived":false,"released":true,"releaseDate":"2015-03-07"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335838","id":"12335838","description":"Maintenance branch for 2.1 ","name":"2.1.1","archived":false,"released":true,"releaseDate":"2016-12-08"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-07-12T02:07:11.406+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"I was attempting to create hive tables over some partitioned Avro files. It seems the void data type (Avro null) is not supported on partitioned tables (i could not replicate the bug on an un-partitioned table).\n\n---------------\n\ni managed to replicate the bug on two different hive versions.\n\nHive 1.1.0-cdh5.10.0\nHive 2.1.1-amzn-0\n----------------\n\nhow to replicate (avro tools are required to create the avro files):\n\n$ wget http://mirror.serversupportforum.de/apache/avro/avro-1.8.1/java/avro-tools-1.8.1.jar\n\n$ mkdir /tmp/avro\n$ mkdir /tmp/avro/null\n$ echo \"{ \\\n  \\\"type\\\" : \\\"record\\\", \\\n  \\\"name\\\" : \\\"null_failure\\\", \\\n  \\\"namespace\\\" : \\\"org.apache.avro.null_failure\\\", \\\n  \\\"doc\\\":\\\"the purpose of this schema is to replicate the hive avro null failure\\\", \\\n  \\\"fields\\\" : [{\\\"name\\\":\\\"one\\\", \\\"type\\\":\\\"null\\\",\\\"default\\\":null}] \\\n} \" > /tmp/avro/null/schema.avsc\n$ echo \"{\\\"one\\\":null}\" > /tmp/avro/null/data.json\n$ java -jar avro-tools-1.8.1.jar fromjson --schema-file /tmp/avro/null/schema.avsc /tmp/avro/null/data.json > /tmp/avro/null/data.avro\n\n$ hdfs dfs -mkdir /tmp/avro\n$ hdfs dfs -mkdir /tmp/avro/null\n$ hdfs dfs -mkdir /tmp/avro/null/schema\n$ hdfs dfs -mkdir /tmp/avro/null/data\n$ hdfs dfs -mkdir /tmp/avro/null/data/foo=bar\n$ hdfs dfs -copyFromLocal /tmp/avro/null/schema.avsc /tmp/avro/null/schema/schema.avsc\n$ hdfs dfs -copyFromLocal /tmp/avro/null/data.avro /tmp/avro/null/data/foo=bar/data.avro\n\n$ hive \n\n\nhive> CREATE EXTERNAL TABLE avro_null\nPARTITIONED BY (foo string)\n  ROW FORMAT SERDE\n  'org.apache.hadoop.hive.serde2.avro.AvroSerDe'\n  STORED as INPUTFORMAT\n  'org.apache.hadoop.hive.ql.io.avro.AvroContainerInputFormat'\n  OUTPUTFORMAT\n  'org.apache.hadoop.hive.ql.io.avro.AvroContainerOutputFormat'\nLOCATION\n'/tmp/avro/null/data/'\n  TBLPROPERTIES (\n    'avro.schema.url'='/tmp/avro/null/schema/schema.avsc')\n;\n\n\n\nOK\nTime taken: 3.127 seconds\n\n\n\nhive> msck repair table avro_null;\nOK\nPartitions not in metastore:\tavro_null:foo=bar\nRepair: Added partition to metastore avro_null:foo=bar\nTime taken: 0.712 seconds, Fetched: 2 row(s)\n\n\n\nhive> select * from avro_null;\nFAILED: RuntimeException org.apache.hadoop.hive.ql.metadata.HiveException: Failed with exception Hive internal error inside isAssignableFromSettablePrimitiveOI void not supported yet.java.lang.RuntimeException: Hive internal error inside isAssignableFromSettablePrimitiveOI void not supported yet.\n\n\nhive> select foo, count(1)  from avro_null group by foo;\n\nOK\nbar\t1\nTime taken: 29.806 seconds, Fetched: 1 row(s)\n\n\n\n\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Avro data type null not supported on partitioned tables","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iamwrong","name":"iamwrong","key":"iamwrong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"rui miranda","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iamwrong","name":"iamwrong","key":"iamwrong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"rui miranda","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13061425/comment/16083316","id":"16083316","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=asears","name":"asears","key":"asears","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew Sears","active":true,"timeZone":"America/New_York"},"body":"This is something that can be handled in Avro by unioning the null type with another type in the avro file.\n\n[http://apache-avro.679487.n3.nabble.com/Support-for-null-in-String-primitive-types-td4025659.html]\n\nObjectInspectorUtils.java might be updated to handle \"void\" primitive category as it does in other cases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=asears","name":"asears","key":"asears","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew Sears","active":true,"timeZone":"America/New_York"},"created":"2017-07-12T02:07:11.406+0000","updated":"2017-07-12T02:07:11.406+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-16370/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3d6mn:"}}