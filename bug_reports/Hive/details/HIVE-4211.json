{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12638207","self":"https://issues.apache.org/jira/rest/api/2/issue/12638207","key":"HIVE-4211","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-04-07T00:38:05.666+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Sep 04 11:43:12 UTC 2013","customfield_12310420":"318683","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4211/watchers","watchCount":4,"isWatching":false},"created":"2013-03-21T10:56:36.788+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["patch"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317742","id":"12317742","description":"released","name":"0.9.0","archived":false,"released":true,"releaseDate":"2012-04-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323587","id":"12323587","description":"Hive 0.11.0","name":"0.11.0","archived":false,"released":true,"releaseDate":"2013-05-15"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-09-04T11:43:12.768+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12315100","id":"12315100","name":"SQL","description":"Issues related to Hive Query Language and its conformance with ANSI SQL."}],"timeoriginalestimate":null,"description":"create table UnionBoolA (id boolean, no boolean) row format delimited fields terminated by ' ';\nload data local inpath '/opt/files/unionboola.txt' into table UnionBoolA;\ncreate table UnionPartionBool (id int) partitioned by (no boolean) row format delimited fields terminated by ' ';\nload data local inpath '/opt/files/unionpartint.txt' into table UnionPartionBool partition(no=true);\n\nunionboola.txt:\ntrue true\nfalse true\ntrue true\nfalse true\n\nunionpartint.txt:\n111\n444\n1122\n44\n\nwhen I execute\n\"select * from( select no from UnionBoolA union all select no from UnionPartionBool) unionResult\", it is failed. The exception info is as follows:\nFAILED: Error in semantic analysis: 1:66 Schema of both sides of union should match: Column no is of type boolean on first table and type string on second table. Error encountered near token 'UnionPartionBool'\norg.apache.hadoop.hive.ql.parse.SemanticException: 1:66 Schema of both sides of union should match: Column no is of type boolean on first table and type string on second table. Error encountered near token 'UnionPartionBool'\n        at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genUnionPlan(SemanticAnalyzer.java:6295)\n        at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genPlan(SemanticAnalyzer.java:6733)\n        at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genPlan(SemanticAnalyzer.java:6748)\n        at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:7556)\n        at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:244)\n        at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:621)\n        at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:525)\n        at org.apache.hadoop.hive.ql.Driver.run(Driver.java:1153)\n        at org.apache.hadoop.hive.service.HiveServer$HiveServerHandler.execute(HiveServer.java:226)\n        at org.apache.hadoop.hive.service.ThriftHive$Processor$execute.getResult(ThriftHive.java:630)\n        at org.apache.hadoop.hive.service.ThriftHive$Processor$execute.getResult(ThriftHive.java:618)\n        at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:32)\n        at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:34)\n        at org.apache.hadoop.hive.thrift.HadoopThriftAuthBridge20S$Server$TUGIAssumingProcessor$1.run(HadoopThriftAuthBridge20S.java:535)\n        at org.apache.hadoop.hive.thrift.HadoopThriftAuthBridge20S$Server$TUGIAssumingProcessor$1.run(HadoopThriftAuthBridge20S.java:532)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:396)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1232)\n        at org.apache.hadoop.hive.thrift.HadoopThriftAuthBridge20S$Server$TUGIAssumingProcessor.process(HadoopThriftAuthBridge20S.java:532)\n        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:176)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:662)\n\n\nSo I execute \"explain select no from  UnionPartionBool\" to see the partition column, and find the partition column type is string.\nAnd all the partition column type is changed to be TypeInfoFactory.stringTypeInfo. It is in org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genTablePlan(). And it is todo task. Now I modify it to be TypeInfoFactory.getPrimitiveTypeInfo(part_col.getType()).It can fix this bug. \nAnd you can see what I modified in the patch.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12601307","id":"12601307","filename":"HIVE-4211.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisy_yu","name":"daisy_yu","key":"daisy_yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10436"},"displayName":"Daisy.Yuan","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-09-04T02:10:31.262+0000","size":644,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12601307/HIVE-4211.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12574771","id":"12574771","filename":"PartitionColumnTypInfo.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisy_yu","name":"daisy_yu","key":"daisy_yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10436"},"displayName":"Daisy.Yuan","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-03-21T10:57:52.506+0000","size":894,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12574771/PartitionColumnTypInfo.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"319024","customfield_12312823":null,"summary":"Common column and partition column are defined the same type and union them, it will hints Schema of both sides of union should match. ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisy_yu","name":"daisy_yu","key":"daisy_yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10436"},"displayName":"Daisy.Yuan","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisy_yu","name":"daisy_yu","key":"daisy_yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10436"},"displayName":"Daisy.Yuan","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12638207/comment/13624553","id":"13624553","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"I remember this TODO was added by [~namit] while trying to fix something with partition column types handling. He will have more insights on how to handle these kind of scenarios.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-07T00:38:05.666+0000","updated":"2013-04-07T00:38:05.666+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12638207/comment/13626722","id":"13626722","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"body":"Seems like a old bug - dont remember the exact reason.\nCan you fix it ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=namit","name":"namit","key":"namit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Namit Jain","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-04-09T15:33:48.024+0000","updated":"2013-04-09T15:33:48.024+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12638207/comment/13757377","id":"13757377","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisy_yu","name":"daisy_yu","key":"daisy_yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10436"},"displayName":"Daisy.Yuan","active":true,"timeZone":"Asia/Shanghai"},"body":"I think it is possible not a problem. Partition column as a part of path name should be string type, or its type can be converted to string type. When genUnionPlan, FunctionRegistry.getCommonClassForUnionAll(TypeInfo a, TypeInfo b) will check the type of both side and set the foward type. In FunctionRegistry.getCommonClassForUnionAll, it will call FunctionRegistry.implicitConvertable(TypeInfo from, TypeInfo to) to check whether it is possible to implicitly convert an object of Class from to Class to. At present, it allows implicit String to Double, String to Timestamp, String to Numeric Typesï¼Œand Void Type to any type conversion. The problem in the Description is actually  a problem that it dose not allow Boolean to string conversion. So is there the scenario that union the boolean\npartition column and the boolean column?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daisy_yu","name":"daisy_yu","key":"daisy_yu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10436","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10436","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10436","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10436"},"displayName":"Daisy.Yuan","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-09-04T02:10:04.425+0000","updated":"2013-09-04T02:10:04.425+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12638207/comment/13757686","id":"13757686","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:red}Overall{color}: -1 no tests executed\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12601307/HIVE-4211.patch\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/607/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/607/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nTests failed with: NonZeroExitCodeException: Command 'bash /data/hive-ptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ [[ -n '' ]]\n+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128'\n+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128'\n+ cd /data/hive-ptest/working/\n+ tee /data/hive-ptest/logs/PreCommit-HIVE-Build-607/source-prep.txt\n+ mkdir -p maven ivy\n+ [[ svn = \\s\\v\\n ]]\n+ [[ -n '' ]]\n+ [[ -d apache-svn-trunk-source ]]\n+ [[ ! -d apache-svn-trunk-source/.svn ]]\n+ [[ ! -d apache-svn-trunk-source ]]\n+ cd apache-svn-trunk-source\n+ svn revert -R .\nReverted 'build-common.xml'\n++ awk '{print $2}'\n++ egrep -v '^X|^Performing status on external'\n++ svn status --no-ignore\n+ rm -rf build hcatalog/build hcatalog/core/build hcatalog/storage-handlers/hbase/build hcatalog/server-extensions/build hcatalog/webhcat/svr/build hcatalog/webhcat/java-client/build hcatalog/hcatalog-pig-adapter/build common/src/gen\n+ svn update\n\nFetching external item into 'hcatalog/src/test/e2e/harness'\nExternal at revision 1519988.\n\nAt revision 1519988.\n+ patchCommandPath=/data/hive-ptest/working/scratch/smart-apply-patch.sh\n+ patchFilePath=/data/hive-ptest/working/scratch/build.patch\n+ [[ -f /data/hive-ptest/working/scratch/build.patch ]]\n+ chmod +x /data/hive-ptest/working/scratch/smart-apply-patch.sh\n+ /data/hive-ptest/working/scratch/smart-apply-patch.sh /data/hive-ptest/working/scratch/build.patch\nThe patch does not appear to apply with p0 to p2\n+ exit 1\n'\n{noformat}\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-09-04T11:43:12.768+0000","updated":"2013-09-04T11:43:12.768+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4211/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1izkn:"}}