{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13081421","self":"https://issues.apache.org/jira/rest/api/2/issue/13081421","key":"HIVE-16932","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-06-22T18:16:42.279+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Jun 25 13:05:48 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-16932/watchers","watchCount":6,"isWatching":false},"created":"2017-06-21T13:13:32.542+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332384","id":"12332384","name":"1.2.1","archived":false,"released":true,"releaseDate":"2015-06-26"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-06-25T13:05:48.722+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313604","id":"12313604","name":"CLI","description":"Command-line interpreter for Hive.\n"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12325007","id":"12325007","name":"Hive"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12328244","id":"12328244","name":"ORC"}],"timeoriginalestimate":null,"description":"hive returns incorrect number of rows when BETWEEN and NOT BETWEEN operators are used in WHERE clause while querying a table that uses ORC as a storage format.\n\nscript to replicate the issue on HDP 2.6:\n\n{code}\n\nSET hive.exec.compress.output=false;\nSET hive.vectorized.execution.enabled=false;\nSET hive.optimize.ppd=true;\nSET hive.optimize.ppd.storage=true;\nSET N=100000;\n\nSET TTT=default.tmp_tbl_text;\nSET TTO=default.tmp_tbl_orc;\n\nDROP TABLE IF EXISTS ${hiveconf:TTT};\nDROP TABLE IF EXISTS ${hiveconf:TTO};\n\ncreate table ${hiveconf:TTT}\nstored as textfile\nas\nselect pos as c\nfrom (\n    select posexplode(split(repeat(',', ${hiveconf:N}), ','))\n) as t;\n\n\ncreate table ${hiveconf:TTO}\nstored as orc\nas\nselect c\nfrom ${hiveconf:TTT};\n\n\nSELECT count(c) as cnt\nFROM ${hiveconf:TTT}\nWHERE\n    c between 0 and ${hiveconf:N}\n    and c not between ${hiveconf:N} div 4 and ${hiveconf:N} div 2\n;\n\n\nSELECT count(c) as cnt\nFROM ${hiveconf:TTO}\nWHERE\n    c between 0 and ${hiveconf:N}\n    and c not between ${hiveconf:N} div 4 and ${hiveconf:N} div 2\n;\n\nDROP TABLE IF EXISTS ${hiveconf:TTT};\nDROP TABLE IF EXISTS ${hiveconf:TTO};\n\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"incorrect predicate evaluation","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hopperjim","name":"hopperjim","key":"hopperjim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hopperjim&avatarId=31925","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hopperjim&avatarId=31925","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hopperjim&avatarId=31925","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hopperjim&avatarId=31925"},"displayName":"Jim Hopper","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hopperjim","name":"hopperjim","key":"hopperjim","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hopperjim&avatarId=31925","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hopperjim&avatarId=31925","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hopperjim&avatarId=31925","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hopperjim&avatarId=31925"},"displayName":"Jim Hopper","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"CentOS, HDP 2.6","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13081421/comment/16059805","id":"16059805","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcamachorodriguez","name":"jcamachorodriguez","key":"jcamachorodriguez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jesus Camacho Rodriguez","active":true,"timeZone":"America/Los_Angeles"},"body":"[~hopperjim], I have run this with multiple versions and it does not seem to be a problem (for given example I get 75000). What is the result that you get?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcamachorodriguez","name":"jcamachorodriguez","key":"jcamachorodriguez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jesus Camacho Rodriguez","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-22T18:16:42.279+0000","updated":"2017-06-22T18:16:42.279+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13081421/comment/16062321","id":"16062321","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Rajkumar+Singh","name":"Rajkumar Singh","key":"rajkumar singh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajkumar Singh","active":true,"timeZone":"Etc/UTC"},"body":"[~jcamachorodriguez] it seems you have disabled the hive.optimize.index.filter that's why you are getting a correct result every time, with ppd enable and hive.optimize.index.filter true you will get the count 14999 for query over orc table because the ORC predicate expression pushed to ORC Split is wrong for NOT BETWEEN operator.\n{code}\n [INFO] [InputInitializer {Map 1} #0] |orc.OrcInputFormat|: ORC pushdown predicate: leaf-0 = (BETWEEN c 0 100000), leaf-1 = (BETWEEN c 25000 50000), expr = (and leaf-0 leaf-1)\n\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Rajkumar+Singh","name":"Rajkumar Singh","key":"rajkumar singh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajkumar Singh","active":true,"timeZone":"Etc/UTC"},"created":"2017-06-25T13:05:48.722+0000","updated":"2017-06-25T13:05:48.722+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-16932/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3gjof:"}}