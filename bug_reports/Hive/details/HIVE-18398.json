{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13129392","self":"https://issues.apache.org/jira/rest/api/2/issue/13129392","key":"HIVE-18398","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-01-17T00:44:48.206+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Apr 22 21:40:04 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-18398/watchers","watchCount":4,"isWatching":false},"created":"2018-01-08T23:23:57.950+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332384","id":"12332384","name":"1.2.1","archived":false,"released":true,"releaseDate":"2015-06-26"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-04-22T21:40:04.620+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12325007","id":"12325007","name":"Hive"}],"timeoriginalestimate":null,"description":"*Steps to reproduce:*\r\n1. Create table \r\n{code}\r\ncreate table test_serde(id int,value string) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' ESCAPED BY '\\\\' \r\n{code}\r\n2. show create table produce following output\r\n{code}\r\nCREATE TABLE `test_serde`(\r\n  `id` int, \r\n  `value` string)\r\nROW FORMAT DELIMITED \r\n  FIELDS TERMINATED BY '|' \r\nWITH SERDEPROPERTIES ( \r\n  'escape.delim'='\\\\') \r\nSTORED AS INPUTFORMAT \r\n  'org.apache.hadoop.mapred.TextInputFormat' \r\nOUTPUTFORMAT \r\n  'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'\r\nLOCATION\r\n  'hdfs://hdp262a.hdp.local:8020/apps/hive/warehouse/test_serde'\r\nTBLPROPERTIES (\r\n  'COLUMN_STATS_ACCURATE'='{\\\"BASIC_STATS\\\":\\\"true\\\"}', \r\n  'numFiles'='0', \r\n  'numRows'='0', \r\n  'rawDataSize'='0', \r\n  'totalSize'='0', \r\n  'transient_lastDdlTime'='1515448894')\r\n{code}\r\n\r\n3. once you run the  create table using the output of show create it ran into the parsing error\r\n\r\n{code}\r\nNoViableAltException(296@[1876:103: ( tableRowFormatMapKeysIdentifier )?])\r\n\tat org.antlr.runtime.DFA.noViableAlt(DFA.java:158)\r\n\tat org.antlr.runtime.DFA.predict(DFA.java:116)\r\n\t.....\r\nFAILED: ParseException line 6:0 cannot recognize input near 'WITH' 'SERDEPROPERTIES' '(' in serde properties specification\r\n{code}\r\n\r\n4. table create with LazySimpleSerde don't have any such issue.\r\n\r\n{code}\r\nhive> CREATE TABLE `foo`( \r\n    > `col` string) \r\n    > ROW FORMAT SERDE \r\n    > 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe' \r\n    > WITH SERDEPROPERTIES ( \r\n    > 'serialization.encoding'='UTF-8') \r\n    > STORED AS INPUTFORMAT \r\n    > 'org.apache.hadoop.mapred.TextInputFormat' \r\n    > OUTPUTFORMAT \r\n    > 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat' ;\r\nOK\r\nTime taken: 0.375 seconds\r\n{code}\r\n\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"WITH SERDEPROPERTIES option is broken without org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Rajkumar+Singh","name":"Rajkumar Singh","key":"rajkumar singh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajkumar Singh","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Rajkumar+Singh","name":"Rajkumar Singh","key":"rajkumar singh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajkumar Singh","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13129392/comment/16328070","id":"16328070","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Mahapatra","name":"Mahapatra","key":"mahapatra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jyoti","active":true,"timeZone":"America/Los_Angeles"},"body":"We are also hitting the same issue on Hive 1.2.2\r\n\r\nRepro steps:\r\n\r\n1. Create a table like below:\r\n\r\n \r\n{code:java}\r\nCREATE external TABLE `sample5`(`id1` int,`id2` int) ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' ESCAPED BY '\\\\'\r\nLOCATION \r\n'hdfs://localhost:9000/user/hive/warehouse/sample';\r\n{code}\r\n2. Get the table schema\r\n\r\n \r\n\r\n \r\n{code:java}\r\nshow create table sample5\r\n{code}\r\nResult: \r\n\r\n \r\n\r\n \r\n{code:java}\r\n+-----------------------------------------------------------------+--+\r\n| createtab_stmt |\r\n+-----------------------------------------------------------------+--+\r\n| CREATE EXTERNAL TABLE `sample5`( |\r\n| `id1` int, |\r\n| `id2` int) |\r\n| ROW FORMAT DELIMITED |\r\n| FIELDS TERMINATED BY ',' |\r\n| WITH SERDEPROPERTIES ( |\r\n| 'escape.delim'='\\\\') |\r\n| STORED AS INPUTFORMAT |\r\n| 'org.apache.hadoop.mapred.TextInputFormat' |\r\n| OUTPUTFORMAT |\r\n| 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat' |\r\n| LOCATION |\r\n| 'hdfs://localhost:9000/user/hive/warehouse/sample' |\r\n| TBLPROPERTIES ( |\r\n| 'COLUMN_STATS_ACCURATE'='false', |\r\n| 'numFiles'='0', |\r\n| 'numRows'='-1', |\r\n| 'rawDataSize'='-1', |\r\n| 'totalSize'='0', |\r\n| 'transient_lastDdlTime'='1515808983') |\r\n+-----------------------------------------------------------------+--+\r\n{code}\r\nUsing the above create table command throws the same exception explained above.\r\n\r\n \r\n\r\n \r\n\r\nSome more observations:\r\n # The issue doesnt happen in hive 2.3\r\n # However the show table command outputs the below result\r\n\r\n{code:java}\r\n+----------------------------------------------------+\r\n| createtab_stmt |\r\n+----------------------------------------------------+\r\n| CREATE EXTERNAL TABLE `sample5`( |\r\n| `id1` int, |\r\n| `id2` int) |\r\n| ROW FORMAT SERDE |\r\n| 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe' |\r\n| WITH SERDEPROPERTIES ( |\r\n| 'escape.delim'='\\\\', |\r\n| 'field.delim'=',', |\r\n| 'serialization.format'=',') |\r\n| STORED AS INPUTFORMAT |\r\n| 'org.apache.hadoop.mapred.TextInputFormat' |\r\n| OUTPUTFORMAT |\r\n| 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat' |\r\n| LOCATION |\r\n| 'hdfs://localhost:9000/user/hive/warehouse/sample' |\r\n| TBLPROPERTIES ( |\r\n| 'transient_lastDdlTime'='1515807845') |\r\n+----------------------------------------------------+\r\n{code}\r\n\r\n \r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Mahapatra","name":"Mahapatra","key":"mahapatra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jyoti","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-01-17T00:44:48.206+0000","updated":"2018-01-17T00:44:48.206+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13129392/comment/16447382","id":"16447382","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mnarayanan2018","name":"mnarayanan2018","key":"mnarayanan2018","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Narayanan","active":true,"timeZone":"Etc/UTC"},"body":"Looks like this behavior is different in Hive 2.X version due to fix done in https://issues.apache.org/jira/browse/HIVE-12506. That Jira says that fix was committed to branch 2.1, 2.0.0 and 1.3. I am not sure if 1.3 ever went out.\r\n\r\nAnyhow As per [https://cwiki.apache.org/confluence/display/Hive/HowToContribute#HowToContribute-UnderstandingHiveBranches]   and [https://cwiki.apache.org/confluence/display/Hive/Home#Home-HiveVersionsandBranches] what I understand is that branch-1 acts as source of all 1.X releases now. branch-1 or branch-1.X doesn't contain that commit.\r\n\r\n \r\n\r\nSo I think commit for above Jira\r\n\r\n[https://github.com/apache/hive/commit/ed9736080aa960ad7d7c2af58d692e6b4f9d6df5]\r\n\r\nwould need to be back ported to latest hive 1.X branch (branch-1)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mnarayanan2018","name":"mnarayanan2018","key":"mnarayanan2018","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manoj Narayanan","active":true,"timeZone":"Etc/UTC"},"created":"2018-04-22T21:40:04.620+0000","updated":"2018-04-22T21:40:04.620+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-18398/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3ontz:"}}