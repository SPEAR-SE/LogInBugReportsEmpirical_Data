{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13071925","self":"https://issues.apache.org/jira/rest/api/2/issue/13071925","key":"HIVE-16666","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-05-18T09:37:01.200+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon May 22 02:48:53 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-16666/watchers","watchCount":3,"isWatching":false},"created":"2017-05-15T09:03:58.375+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12340268","id":"12340268","name":"3.0.0","archived":false,"released":true,"releaseDate":"2018-05-21"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangfang","name":"yangfang","key":"yangfang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yangfang","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-05-22T03:03:08.796+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"Set hive.exec.stagingdir=./*,  for example set hive.exec.stagingdir=./opq8.\nThen excute a query like this:\ninsert overwrite table test2 select * from test3; \nYou will get the error like this:\nhive> set hive.exec.stagingdir=./opq8;\nhive> insert overwrite table test2 select * from test3;\nQuery ID = mr_20170515134831_28ee392d-0d5a-4e47-b80c-dfcd31691b02\nTotal jobs = 3\nLaunching Job 1 out of 3\nNumber of reduce tasks is set to 0 since there's no reduce operator\nStarting Job = job_1494818119523_0008, Tracking URL = http://zdh77:8088/proxy/application_1494818119523_0008/\nKill Command = /opt/ZDH/parcels/lib/hadoop/bin/hadoop job  -kill job_1494818119523_0008\nHadoop job information for Stage-1: number of mappers: 0; number of reducers: 0\n2017-05-15 13:48:51,487 Stage-1 map = 0%,  reduce = 0%\nEnded Job = job_1494818119523_0008\nStage-3 is selected by condition resolver.\nStage-2 is filtered out by condition resolver.\nStage-4 is filtered out by condition resolver.\nMoving data to directory hdfs://nameservice/hive/test2/opqt8_hive_2017-05-15_13-48-31_558_6151032330134038151-1/-ext-10000\nLoading data to table default.test2\nMoved: 'hdfs://nameservice/hive/test2/opqt8_hive_2017-05-15_13-48-31_558_6151032330134038151-1' to trash at: hdfs://nameservice/user/mr/.Trash/Current\nFailed with exception Unable to move source hdfs://nameservice/hive/test2/opqt8_hive_2017-05-15_13-48-31_558_6151032330134038151-1/-ext-10000 to destination hdfs://nameservice/hive/test2\nFAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.MoveTask. Unable to move source hdfs://nameservice/hive/test2/opqt8_hive_2017-05-15_13-48-31_558_6151032330134038151-1/-ext-10000 to destination hdfs://nameservice/hive/test2\nMapReduce Jobs Launched: \nStage-Stage-1:  HDFS Read: 0 HDFS Write: 0 SUCCESS\nTotal MapReduce CPU Time Spent: 0 msec\nhive>\n\nhive.exec.stagingdir=./opq8 is a relative path for destination write directory  /hive/test2.  Hive will create a temporary directory /hive/test2/opq8_hive* for intermediate query results.  Later in the move staging, Hive will delete or trash the sub directory under the /hive/test2 who's name does not begin with \"_\" or \".\"  in order to move data to this directory. You can see its processing logic in org.apache.hadoop.hive.ql.metadata.trashFilesUnderDir.\n\nMy modification method is: if  stagingdir is a sub directory of the destination write directory. I add a \".\"   in front of stagingdir. now temporary directory will be /hive/test2/.opq8_hive* , because the sub directory .opq8_hive* starts with \".\",  Hive will not delete it.\nhive> set hive.exec.stagingdir=./opq8;\nhive>  insert overwrite table test2 select * from test3;\nQuery ID = mr_20170515143940_ae48a65e-42be-4f50-b974-b713ca902867\nTotal jobs = 3\nLaunching Job 1 out of 3\nNumber of reduce tasks is set to 0 since there's no reduce operator\nStarting Job = job_1494818119523_0012, Tracking URL = http://zdh77:8088/proxy/application_1494818119523_0012/\nKill Command = /opt/ZDH/parcels/lib/hadoop/bin/hadoop job  -kill job_1494818119523_0012\nHadoop job information for Stage-1: number of mappers: 0; number of reducers: 0\n2017-05-15 14:40:04,547 Stage-1 map = 0%,  reduce = 0%\nEnded Job = job_1494818119523_0012\nStage-3 is selected by condition resolver.\nStage-2 is filtered out by condition resolver.\nStage-4 is filtered out by condition resolver.\nMoving data to directory hdfs://nameservice/hive/test2/.opqt8_hive_2017-05-15_14-39-40_751_1221840798987515724-1/-ext-10000\nLoading data to table default.test2\nMapReduce Jobs Launched: \nStage-Stage-1:  HDFS Read: 0 HDFS Write: 0 SUCCESS\nTotal MapReduce CPU Time Spent: 0 msec\nOK\nTime taken: 26.751 seconds\nhive> ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12868659","id":"12868659","filename":"HIVE-16666.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangfang","name":"yangfang","key":"yangfang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yangfang","active":true,"timeZone":"Etc/UTC"},"created":"2017-05-18T02:20:26.085+0000","size":1322,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12868659/HIVE-16666.1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Set hive.exec.stagingdir a relative directory or a sub directory of distination data directory will cause Hive to delete the intermediate query results","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangfang","name":"yangfang","key":"yangfang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yangfang","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangfang","name":"yangfang","key":"yangfang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yangfang","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13071925/comment/16010237","id":"16010237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangfang","name":"yangfang","key":"yangfang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yangfang","active":true,"timeZone":"Etc/UTC"},"body":"I have tested it locally, please review it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangfang","name":"yangfang","key":"yangfang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yangfang","active":true,"timeZone":"Etc/UTC"},"created":"2017-05-15T09:35:57.559+0000","updated":"2017-05-15T09:35:57.559+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13071925/comment/16015098","id":"16015098","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangfang","name":"yangfang","key":"yangfang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yangfang","active":true,"timeZone":"Etc/UTC"},"body":"hello,[~pvary],[~aihuaxu],can you plz take a review?Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangfang","name":"yangfang","key":"yangfang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yangfang","active":true,"timeZone":"Etc/UTC"},"created":"2017-05-18T02:26:57.429+0000","updated":"2017-05-18T02:26:57.429+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13071925/comment/16015496","id":"16015496","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12868659/HIVE-16666.1.patch\n\n{color:red}ERROR:{color} -1 due to no test(s) being added or modified.\n\n{color:red}ERROR:{color} -1 due to 21 failed/errored test(s), 10730 tests executed\n*Failed tests:*\n{noformat}\norg.apache.hadoop.hive.cli.TestBlobstoreCliDriver.testCliDriver[ctas_blobstore_to_blobstore] (batchId=239)\norg.apache.hadoop.hive.cli.TestBlobstoreCliDriver.testCliDriver[ctas_hdfs_to_blobstore] (batchId=239)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[crtseltbl_serdeprops] (batchId=76)\norg.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ctas_uses_table_location] (batchId=1)\norg.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_auto_purge_tables] (batchId=162)\norg.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_ctas] (batchId=162)\norg.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_drop_partition] (batchId=162)\norg.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_drop_table] (batchId=163)\norg.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_insert_partition_dynamic] (batchId=164)\norg.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_insert_partition_static] (batchId=161)\norg.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_insert_values] (batchId=163)\norg.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_join_unencrypted_tbl] (batchId=165)\norg.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_load_data_to_encrypted_tables] (batchId=162)\norg.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_move_tbl] (batchId=162)\norg.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver[encryption_select_read_only_encrypted_tbl] (batchId=163)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[columnstats_part_coltype] (batchId=156)\norg.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=144)\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_3] (batchId=97)\norg.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainuser_3] (batchId=97)\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[ctas_noemptyfolder] (batchId=88)\norg.apache.hadoop.hive.llap.security.TestLlapSignerImpl.testSigning (batchId=287)\n{noformat}\n\nTest results: https://builds.apache.org/job/PreCommit-HIVE-Build/5322/testReport\nConsole output: https://builds.apache.org/job/PreCommit-HIVE-Build/5322/console\nTest logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-5322/\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.TestCheckPhase\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\nTests exited with: TestsFailedException: 21 tests failed\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12868659 - PreCommit-HIVE-Build","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2017-05-18T09:37:01.200+0000","updated":"2017-05-18T09:37:01.200+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13071925/comment/16017080","id":"16017080","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangfang","name":"yangfang","key":"yangfang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yangfang","active":true,"timeZone":"Etc/UTC"},"body":"These failed tests are not relevant to the patch ,[~aihuaxu],[~pvary] ,can you plz take a review?Thanks! ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangfang","name":"yangfang","key":"yangfang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yangfang","active":true,"timeZone":"Etc/UTC"},"created":"2017-05-19T08:56:13.161+0000","updated":"2017-05-19T08:56:13.161+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13071925/comment/16017320","id":"16017320","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pvary","name":"pvary","key":"pvary","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Vary","active":true,"timeZone":"Europe/Budapest"},"body":"[~yangfang]: Thanks for the patch! Nice catch!\n\nI am not entirely sure, that we should create different staging directory than provided by the user. My first reaction would be, that we should throw an exception in case of an invalid staging dir name.\n\nThe staging path generation process is starting to become complicated. It would be good to have a unit test for checking the expected results.\n\nCould you please check the code against the coding conventions?\nhttps://cwiki.apache.org/confluence/display/Hive/HowToContribute#HowToContribute-CodingConventions\nI know that the current code often not adheres the excepted format :(, but I think it would be good to keep it at least for the new code. :)\n\nThanks again for the catch,\nPeter\n\n\n\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pvary","name":"pvary","key":"pvary","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Vary","active":true,"timeZone":"Europe/Budapest"},"created":"2017-05-19T12:22:21.607+0000","updated":"2017-05-19T12:22:21.607+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13071925/comment/16017592","id":"16017592","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"body":"I agree with Peter. We probably should add a validation against the configurations and throw exception before query compilation starts, rather than changing the property value internally. How do you think [~yangfang]?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aihuaxu","name":"aihuaxu","key":"aihuaxu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aihua Xu","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-05-19T16:01:11.975+0000","updated":"2017-05-19T16:01:11.975+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13071925/comment/16019097","id":"16019097","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangfang","name":"yangfang","key":"yangfang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yangfang","active":true,"timeZone":"Etc/UTC"},"body":"[~aihuaxu],[~pvary], thanks for your advice.\n In my opinion, staging directory is just a temporary directory, users may not be concerned with where the directory is, they only care about the success of the query and the final result. For users, any staging directory name may be allowed, throw an exception may be a  little rough.\n Even if we add a validation against the configuration, for example suppose /tmp/hive/.hive-staging is a valide directory because it's a empty directory that no one has used, but now, someone may create table like this:\n create table test(a int, b string) location '/tmp'\nNow the staging directory is a sub directory of  table data directory, this will still to delete the intermediate query results in execution.\n Looking forward to your comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yangfang","name":"yangfang","key":"yangfang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"yangfang","active":true,"timeZone":"Etc/UTC"},"created":"2017-05-22T02:48:53.377+0000","updated":"2017-05-22T03:03:08.787+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-16666/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3eyrr:"}}