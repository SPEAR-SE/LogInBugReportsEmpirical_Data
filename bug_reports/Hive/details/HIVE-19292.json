{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13154952","self":"https://issues.apache.org/jira/rest/api/2/issue/13154952","key":"HIVE-19292","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2018-06-24T02:29:59.878+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Jun 24 02:29:59 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1279746720_*|*_3_*:*_1_*:*_3921207525_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-06-24T02:29:59.843+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-19292/watchers","watchCount":2,"isWatching":false},"created":"2018-04-24T21:47:25.648+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12340268","id":"12340268","name":"3.0.0","archived":false,"released":true,"releaseDate":"2018-05-21"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcamachorodriguez","name":"jcamachorodriguez","key":"jcamachorodriguez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jesus Camacho Rodriguez","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-06-24T02:29:59.889+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12325007","id":"12325007","name":"Hive"}],"timeoriginalestimate":null,"description":"When there are more than one materialized view query rewrite fails to pick the materialized view, which it picks otherwise\r\n\r\n{noformat}\r\n1: jdbc:hive2://<host-name>> show materialized views;\r\nINFO  : Compiling command(queryId=hive_20180424204708_e39107e4-ae65-4e3e-a73f-19e0519b515c): show materialized views\r\nINFO  : Semantic Analysis Completed\r\nINFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:tab_name, type:string, comment:from deserializer)], properties:null)\r\nINFO  : Completed compiling command(queryId=hive_20180424204708_e39107e4-ae65-4e3e-a73f-19e0519b515c); Time taken: 0.021 seconds\r\nINFO  : Executing command(queryId=hive_20180424204708_e39107e4-ae65-4e3e-a73f-19e0519b515c): show materialized views\r\nINFO  : Starting task [Stage-0:DDL] in serial mode\r\nINFO  : Completed executing command(queryId=hive_20180424204708_e39107e4-ae65-4e3e-a73f-19e0519b515c); Time taken: 0.174 seconds\r\nINFO  : OK\r\n+----------------------+\r\n|       tab_name       |\r\n+----------------------+\r\n| cmv_mat_view         |\r\n| mv_agg               |\r\n| source_table_001_mv  |\r\n+----------------------+\r\n3 rows selected (0.3 seconds)\r\n1: jdbc:hive2://<host-name>> drop materialized view cmv_mat_view;\r\nINFO  : Compiling command(queryId=hive_20180424204724_5d4f3aaf-ed22-4828-a1a8-d8fe9f6bd9af): drop materialized view cmv_mat_view\r\nINFO  : Semantic Analysis Completed\r\nINFO  : Returning Hive schema: Schema(fieldSchemas:null, properties:null)\r\nINFO  : Completed compiling command(queryId=hive_20180424204724_5d4f3aaf-ed22-4828-a1a8-d8fe9f6bd9af); Time taken: 0.029 seconds\r\nINFO  : Executing command(queryId=hive_20180424204724_5d4f3aaf-ed22-4828-a1a8-d8fe9f6bd9af): drop materialized view cmv_mat_view\r\nINFO  : Starting task [Stage-0:DDL] in serial mode\r\nINFO  : Completed executing command(queryId=hive_20180424204724_5d4f3aaf-ed22-4828-a1a8-d8fe9f6bd9af); Time taken: 0.312 seconds\r\nINFO  : OK\r\nNo rows affected (0.369 seconds)\r\n1: jdbc:hive2://<host-name>> explain\r\n. . . . . . . . . . . . . . . . . . . . . . .> select\r\n. . . . . . . . . . . . . . . . . . . . . . .> SUM(A.DOWN_VOLUME) AS DOWNLOAD_VOLUME_BYTES,\r\n. . . . . . . . . . . . . . . . . . . . . . .> FLOOR(A.MY_DATE to hour),A.MY_ID2,A.ENVIRONMENT\r\n. . . . . . . . . . . . . . . . . . . . . . .> FROM source_table_001 AS A\r\n. . . . . . . . . . . . . . . . . . . . . . .> group by A.MY_ID,A.MY_ID2,A.ENVIRONMENT,FLOOR(A.MY_DATE to hour);\r\nINFO  : Compiling command(queryId=hive_20180424204736_76958a4d-0f08-4e22-93c6-67e3a1493b92): explain\r\nselect\r\nSUM(A.DOWN_VOLUME) AS DOWNLOAD_VOLUME_BYTES,\r\nFLOOR(A.MY_DATE to hour),A.MY_ID2,A.ENVIRONMENT\r\nFROM source_table_001 AS A\r\ngroup by A.MY_ID,A.MY_ID2,A.ENVIRONMENT,FLOOR(A.MY_DATE to hour)\r\nINFO  : Semantic Analysis Completed\r\nINFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:Explain, type:string, comment:null)], properties:null)\r\nINFO  : Completed compiling command(queryId=hive_20180424204736_76958a4d-0f08-4e22-93c6-67e3a1493b92); Time taken: 0.374 seconds\r\nINFO  : Executing command(queryId=hive_20180424204736_76958a4d-0f08-4e22-93c6-67e3a1493b92): explain\r\nselect\r\nSUM(A.DOWN_VOLUME) AS DOWNLOAD_VOLUME_BYTES,\r\nFLOOR(A.MY_DATE to hour),A.MY_ID2,A.ENVIRONMENT\r\nFROM source_table_001 AS A\r\ngroup by A.MY_ID,A.MY_ID2,A.ENVIRONMENT,FLOOR(A.MY_DATE to hour)\r\nINFO  : Starting task [Stage-3:EXPLAIN] in serial mode\r\nINFO  : Completed executing command(queryId=hive_20180424204736_76958a4d-0f08-4e22-93c6-67e3a1493b92); Time taken: 0.006 seconds\r\nINFO  : OK\r\n+----------------------------------------------------+\r\n|                      Explain                       |\r\n+----------------------------------------------------+\r\n| Plan optimized by CBO.                             |\r\n|                                                    |\r\n| Vertex dependency in root stage                    |\r\n| Reducer 2 <- Map 1 (SIMPLE_EDGE)                   |\r\n|                                                    |\r\n| Stage-0                                            |\r\n|   Fetch Operator                                   |\r\n|     limit:-1                                       |\r\n|     Stage-1                                        |\r\n|       Reducer 2 vectorized, llap                   |\r\n|       File Output Operator [FS_13]                 |\r\n|         Select Operator [SEL_12] (rows=1 width=143) |\r\n|           Output:[\"_col0\",\"_col1\",\"_col2\",\"_col3\"] |\r\n|           Group By Operator [GBY_11] (rows=1 width=151) |\r\n|             Output:[\"_col0\",\"_col1\",\"_col2\",\"_col3\",\"_col4\"],aggregations:[\"sum(VALUE._col0)\"],keys:KEY._col0, KEY._col1, KEY._col2, KEY._col3 |\r\n|           <-Map 1 [SIMPLE_EDGE] vectorized, llap   |\r\n|             SHUFFLE [RS_10]                        |\r\n|               PartitionCols:_col0, _col1, _col2, _col3 |\r\n|               Group By Operator [GBY_9] (rows=1 width=151) |\r\n|                 Output:[\"_col0\",\"_col1\",\"_col2\",\"_col3\",\"_col4\"],aggregations:[\"sum(_col4)\"],keys:_col0, _col1, _col2, _col3 |\r\n|                 Select Operator [SEL_8] (rows=1 width=151) |\r\n|                   Output:[\"_col0\",\"_col1\",\"_col2\",\"_col3\",\"_col4\"] |\r\n|                   TableScan [TS_0] (rows=1 width=151) |\r\n|                     default@source_table_001,a, ACID table,Tbl:COMPLETE,Col:COMPLETE,Output:[\"my_id\",\"my_id2\",\"environment\",\"my_date\",\"down_volume\"] |\r\n|                                                    |\r\n+----------------------------------------------------+\r\n25 rows selected (0.41 seconds)\r\n1: jdbc:hive2://<host-name>> drop materialized view mv_agg;\r\nINFO  : Compiling command(queryId=hive_20180424204752_149cc1fd-b21e-4b35-955a-67e019a34e98): drop materialized view mv_agg\r\nINFO  : Semantic Analysis Completed\r\nINFO  : Returning Hive schema: Schema(fieldSchemas:null, properties:null)\r\nINFO  : Completed compiling command(queryId=hive_20180424204752_149cc1fd-b21e-4b35-955a-67e019a34e98); Time taken: 0.036 seconds\r\nINFO  : Executing command(queryId=hive_20180424204752_149cc1fd-b21e-4b35-955a-67e019a34e98): drop materialized view mv_agg\r\nINFO  : Starting task [Stage-0:DDL] in serial mode\r\nINFO  : Completed executing command(queryId=hive_20180424204752_149cc1fd-b21e-4b35-955a-67e019a34e98); Time taken: 0.234 seconds\r\nINFO  : OK\r\nNo rows affected (0.297 seconds)\r\n1: jdbc:hive2://<host-name>> explain\r\n. . . . . . . . . . . . . . . . . . . . . . .> select\r\n. . . . . . . . . . . . . . . . . . . . . . .> SUM(A.DOWN_VOLUME) AS DOWNLOAD_VOLUME_BYTES,\r\n. . . . . . . . . . . . . . . . . . . . . . .> FLOOR(A.MY_DATE to hour),A.MY_ID2,A.ENVIRONMENT\r\n. . . . . . . . . . . . . . . . . . . . . . .> FROM source_table_001 AS A\r\n. . . . . . . . . . . . . . . . . . . . . . .> group by A.MY_ID,A.MY_ID2,A.ENVIRONMENT,FLOOR(A.MY_DATE to hour);\r\nINFO  : Compiling command(queryId=hive_20180424204759_4bdef3d8-0f06-49fb-876e-fab8100359b6): explain\r\nselect\r\nSUM(A.DOWN_VOLUME) AS DOWNLOAD_VOLUME_BYTES,\r\nFLOOR(A.MY_DATE to hour),A.MY_ID2,A.ENVIRONMENT\r\nFROM source_table_001 AS A\r\ngroup by A.MY_ID,A.MY_ID2,A.ENVIRONMENT,FLOOR(A.MY_DATE to hour)\r\nINFO  : Semantic Analysis Completed\r\nINFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:Explain, type:string, comment:null)], properties:null)\r\nINFO  : Completed compiling command(queryId=hive_20180424204759_4bdef3d8-0f06-49fb-876e-fab8100359b6); Time taken: 0.369 seconds\r\nINFO  : Executing command(queryId=hive_20180424204759_4bdef3d8-0f06-49fb-876e-fab8100359b6): explain\r\nselect\r\nSUM(A.DOWN_VOLUME) AS DOWNLOAD_VOLUME_BYTES,\r\nFLOOR(A.MY_DATE to hour),A.MY_ID2,A.ENVIRONMENT\r\nFROM source_table_001 AS A\r\ngroup by A.MY_ID,A.MY_ID2,A.ENVIRONMENT,FLOOR(A.MY_DATE to hour)\r\nINFO  : Starting task [Stage-3:EXPLAIN] in serial mode\r\nINFO  : Completed executing command(queryId=hive_20180424204759_4bdef3d8-0f06-49fb-876e-fab8100359b6); Time taken: 0.006 seconds\r\nINFO  : OK\r\n+----------------------------------------------------+\r\n|                      Explain                       |\r\n+----------------------------------------------------+\r\n| Plan optimized by CBO.                             |\r\n|                                                    |\r\n| Vertex dependency in root stage                    |\r\n| Reducer 2 <- Map 1 (SIMPLE_EDGE)                   |\r\n|                                                    |\r\n| Stage-0                                            |\r\n|   Fetch Operator                                   |\r\n|     limit:-1                                       |\r\n|     Stage-1                                        |\r\n|       Reducer 2 vectorized, llap                   |\r\n|       File Output Operator [FS_13]                 |\r\n|         Select Operator [SEL_12] (rows=1 width=143) |\r\n|           Output:[\"_col0\",\"_col1\",\"_col2\",\"_col3\"] |\r\n|           Group By Operator [GBY_11] (rows=1 width=151) |\r\n|             Output:[\"_col0\",\"_col1\",\"_col2\",\"_col3\",\"_col4\"],aggregations:[\"sum(VALUE._col0)\"],keys:KEY._col0, KEY._col1, KEY._col2, KEY._col3 |\r\n|           <-Map 1 [SIMPLE_EDGE] vectorized, llap   |\r\n|             SHUFFLE [RS_10]                        |\r\n|               PartitionCols:_col0, _col1, _col2, _col3 |\r\n|               Group By Operator [GBY_9] (rows=1 width=151) |\r\n|                 Output:[\"_col0\",\"_col1\",\"_col2\",\"_col3\",\"_col4\"],aggregations:[\"sum(_col0)\"],keys:_col1, _col2, _col3, _col4 |\r\n|                 Select Operator [SEL_8] (rows=1 width=151) |\r\n|                   Output:[\"_col0\",\"_col1\",\"_col2\",\"_col3\",\"_col4\"] |\r\n|                   TableScan [TS_0] (rows=1 width=151) |\r\n|                     default@source_table_001_mv,default.source_table_001_mv,Tbl:COMPLETE,Col:COMPLETE,Output:[\"down_volume_sum\",\"my_id\",\"my_id2\",\"environment\",\"my_date\"] |\r\n|                                                    |\r\n+----------------------------------------------------+\r\n25 rows selected (0.403 seconds)\r\n1: jdbc:hive2://<host-name>> show materialized views;\r\nINFO  : Compiling command(queryId=hive_20180424204948_16bcffca-f716-49b0-94f5-d088231dba5a): show materialized views\r\nINFO  : Semantic Analysis Completed\r\nINFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:tab_name, type:string, comment:from deserializer)], properties:null)\r\nINFO  : Completed compiling command(queryId=hive_20180424204948_16bcffca-f716-49b0-94f5-d088231dba5a); Time taken: 0.013 seconds\r\nINFO  : Executing command(queryId=hive_20180424204948_16bcffca-f716-49b0-94f5-d088231dba5a): show materialized views\r\nINFO  : Starting task [Stage-0:DDL] in serial mode\r\nINFO  : Completed executing command(queryId=hive_20180424204948_16bcffca-f716-49b0-94f5-d088231dba5a); Time taken: 0.147 seconds\r\nINFO  : OK\r\n+----------------------+\r\n|       tab_name       |\r\n+----------------------+\r\n| source_table_001_mv  |\r\n+----------------------+\r\n1 row selected (0.219 seconds)\r\n{noformat}\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"More than one materialized view in DB affecting query rewrite","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=asreekumar","name":"asreekumar","key":"asreekumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aswathy Chellammal Sreekumar","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=asreekumar","name":"asreekumar","key":"asreekumar","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aswathy Chellammal Sreekumar","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13154952/comment/16521347","id":"16521347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcamachorodriguez","name":"jcamachorodriguez","key":"jcamachorodriguez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jesus Camacho Rodriguez","active":true,"timeZone":"America/Los_Angeles"},"body":"Closing for the time being as I cannot reproduce it. Please reopen if it is still an issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcamachorodriguez","name":"jcamachorodriguez","key":"jcamachorodriguez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jesus Camacho Rodriguez","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-06-24T02:29:59.878+0000","updated":"2018-06-24T02:29:59.878+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-19292/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3sz9r:"}}