{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12679838","self":"https://issues.apache.org/jira/rest/api/2/issue/12679838","key":"HIVE-5845","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324986","id":"12324986","description":"released","name":"0.13.0","archived":false,"released":true,"releaseDate":"2014-04-21"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-11-19T15:17:53.698+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Nov 21 02:21:19 UTC 2013","customfield_12310420":"359196","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_42385340_*|*_1_*:*_1_*:*_142032915_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-11-21T02:21:19.913+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5845/watchers","watchCount":2,"isWatching":false},"created":"2013-11-18T23:07:41.691+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12378871","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12378871","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12680410","key":"HIVE-5863","self":"https://issues.apache.org/jira/rest/api/2/issue/12680410","fields":{"summary":"INSERT OVERWRITE TABLE fails in vectorized mode for ORC format target table","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-11-21T18:02:47.239+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Following query fails:\n create table store_sales_2 stored as orc as select * from alltypesorc;","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12614892","id":"12614892","filename":"HIVE-5845.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"created":"2013-11-20T14:26:28.083+0000","size":52788,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12614892/HIVE-5845.1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"359495","customfield_12312823":null,"summary":"CTAS failed on vectorized code path","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679838/comment/13825924","id":"13825924","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Stack-trace:\n{code}\nCaused by: java.lang.ClassCastException: org.apache.hadoop.hive.ql.io.orc.OrcStruct cannot be cast to [Ljava.lang.Object;\n        at org.apache.hadoop.hive.serde2.objectinspector.StandardStructObjectInspector.getStructFieldData(StandardStructObjectInspector.java:173)\n        at org.apache.hadoop.hive.ql.io.orc.WriterImpl$StructTreeWriter.write(WriterImpl.java:1349)\n        at org.apache.hadoop.hive.ql.io.orc.WriterImpl.addRow(WriterImpl.java:1962)\n        at org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat$OrcRecordWriter.write(OrcOutputFormat.java:78)\n        at org.apache.hadoop.hive.ql.exec.vector.VectorFileSinkOperator.processOp(VectorFileSinkOperator.java:159)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:489)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:827)\n        at org.apache.hadoop.hive.ql.exec.vector.VectorSelectOperator.processOp(VectorSelectOperator.java:129)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:489)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:827)\n        at org.apache.hadoop.hive.ql.exec.TableScanOperator.processOp(TableScanOperator.java:91)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:489)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:827)\n        at org.apache.hadoop.hive.ql.exec.vector.VectorMapOperator.process(VectorMapOperator.java:43)\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-11-18T23:10:06.331+0000","updated":"2013-11-18T23:10:06.331+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679838/comment/13826577","id":"13826577","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"body":"The VectorFileSinkOperator uses an optimized path for the VectorizedSerde which creates OrcStruct values, but attaches to it the Standard input object inspector. When it comes to consume this value/inspector combo, the code bombs as the inspector is not actually appropriate to crack an OrcStruct","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"created":"2013-11-19T15:17:53.698+0000","updated":"2013-11-19T15:17:53.698+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679838/comment/13826719","id":"13826719","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"body":"Hello Ashutosh,\n\nI’ve looked at this and my opinion is that the problem is with the Orc’ VectorizedSerde.serialize. Despite the fact that we’re writing an OrcStruct field, it adds to the OrcSerde object created the passed in object inspector, which is for the input struct, instead of the OrcStructInspectr which should be used with the created OrcStruct.\n\nI tried this patch:\n\ndiff --git ql/src/java/org/apache/hadoop/hive/ql/io/orc/OrcSerde.java ql/src/java/org/apache/hadoop/hive/ql/io/orc/OrcSerde.java\nindex d765353..c4268c1 100644\n--- ql/src/java/org/apache/hadoop/hive/ql/io/orc/OrcSerde.java\n+++ ql/src/java/org/apache/hadoop/hive/ql/io/orc/OrcSerde.java\n@@ -143,9 +143,9 @@ public SerDeStats getSerDeStats() {\n   public Writable serializeVector(VectorizedRowBatch vrg, ObjectInspector objInspector)\n       throws SerDeException {\n     if (vos == null) {\n-      vos = new VectorizedOrcSerde(objInspector);\n+      vos = new VectorizedOrcSerde(getObjectInspector());\n     }\n-    return vos.serialize(vrg, objInspector);\n+    return vos.serialize(vrg, getObjectInspector());\n   }\n\nHowever, with this fix I’m hitting other (very familiar…) cast exceptions:\n\nCaused by: java.lang.ClassCastException: org.apache.hadoop.hive.serde2.io.TimestampWritable cannot be cast to java.sql.Timestamp\n        at org.apache.hadoop.hive.serde2.objectinspector.primitive.JavaTimestampObjectInspector.getPrimitiveJavaObject(JavaTimestampObjectInspector.java:39)\n        at org.apache.hadoop.hive.ql.io.orc.WriterImpl$TimestampTreeWriter.write(WriterImpl.java:1172)\n        at org.apache.hadoop.hive.ql.io.orc.WriterImpl$StructTreeWriter.write(WriterImpl.java:1349)\n        at org.apache.hadoop.hive.ql.io.orc.WriterImpl.addRow(WriterImpl.java:1962)\n        at org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat$OrcRecordWriter.write(OrcOutputFormat.java:78)\n        at org.apache.hadoop.hive.ql.exec.vector.VectorFileSinkOperator.processOp(VectorFileSinkOperator.java:159)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:489)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:827)\n        at org.apache.hadoop.hive.ql.exec.vector.VectorSelectOperator.processOp(VectorSelectOperator.java:129)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:489)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:827)\n        at org.apache.hadoop.hive.ql.exec.TableScanOperator.processOp(TableScanOperator.java:91)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:489)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:827)\n        at org.apache.hadoop.hive.ql.exec.vector.VectorMapOperator.process(VectorMapOperator.java:43)\n\nCaused by: java.lang.ClassCastException: org.apache.hadoop.hive.serde2.io.ByteWritable cannot be cast to org.apache.hadoop.io.IntWritable\n        at org.apache.hadoop.hive.serde2.objectinspector.primitive.WritableIntObjectInspector.get(WritableIntObjectInspector.java:36)\n        at org.apache.hadoop.hive.ql.io.orc.WriterImpl$IntegerTreeWriter.write(WriterImpl.java:762)\n        at org.apache.hadoop.hive.ql.io.orc.WriterImpl$StructTreeWriter.write(WriterImpl.java:1349)\n        at org.apache.hadoop.hive.ql.io.orc.WriterImpl.addRow(WriterImpl.java:1962)\n        at org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat$OrcRecordWriter.write(OrcOutputFormat.java:78)\n        at org.apache.hadoop.hive.ql.exec.vector.VectorFileSinkOperator.processOp(VectorFileSinkOperator.java:159)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:489)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:827)\n        at org.apache.hadoop.hive.ql.exec.vector.VectorSelectOperator.processOp(VectorSelectOperator.java:129)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:489)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:827)\n        at org.apache.hadoop.hive.ql.exec.TableScanOperator.processOp(TableScanOperator.java:91)\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:489)\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:827)\n        at org.apache.hadoop.hive.ql.exec.vector.VectorMapOperator.process(VectorMapOperator.java:43)\n\nBefore I go and hack through code I’m only vaguely familiar with (the Orc serdes), do you have someone more experienced in this area at HW to have a look too?\nIt seems that the Orc writer expects Java primitive types where the vector file sink creates Writables instead… I’m afraid if I ‘fix’ this one way, some other place will break.\n\nThanks,\n~Remus\n\n\nFrom: Ashutosh Chauhan (JIRA) [mailto:jira@apache.org]\nSent: Tuesday, November 19, 2013 1:11 AM\nTo: Remus Rusanu\nSubject: [jira] [Commented] (HIVE-5845) CTAS failed on vectorized code path\n\n[https://issues.apache.org/jira/secure/useravatar?avatarId=10452]\n\nAshutosh Chauhan<https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc> commented on an issue\n\n\n\n\nRe: CTAS failed on vectorized code path<https://issues.apache.org/jira/browse/HIVE-5845>\n\n\n\nStack-trace:\n\n\n\nCaused by: java.lang.ClassCastException: org.apache.hadoop.hive.ql.io.orc.OrcStruct cannot be cast to [Ljava.lang.Object;\n\n        at org.apache.hadoop.hive.serde2.objectinspector.StandardStructObjectInspector.getStructFieldData(StandardStructObjectInspector.java:173)\n\n        at org.apache.hadoop.hive.ql.io.orc.WriterImpl$StructTreeWriter.write(WriterImpl.java:1349)\n\n        at org.apache.hadoop.hive.ql.io.orc.WriterImpl.addRow(WriterImpl.java:1962)\n\n        at org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat$OrcRecordWriter.write(OrcOutputFormat.java:78)\n\n        at org.apache.hadoop.hive.ql.exec.vector.VectorFileSinkOperator.processOp(VectorFileSinkOperator.java:159)\n\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:489)\n\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:827)\n\n        at org.apache.hadoop.hive.ql.exec.vector.VectorSelectOperator.processOp(VectorSelectOperator.java:129)\n\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:489)\n\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:827)\n\n        at org.apache.hadoop.hive.ql.exec.TableScanOperator.processOp(TableScanOperator.java:91)\n\n        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:489)\n\n        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:827)\n\n        at org.apache.hadoop.hive.ql.exec.vector.VectorMapOperator.process(VectorMapOperator.java:43)\n\n\n[Add Comment]<https://issues.apache.org/jira/browse/HIVE-5845#add-comment>\n\nAdd Comment<https://issues.apache.org/jira/browse/HIVE-5845#add-comment>\n\n\n\n\n\n\nHive<https://issues.apache.org/jira/browse/HIVE> / [Bug] <https://issues.apache.org/jira/browse/HIVE-5845> HIVE-5845<https://issues.apache.org/jira/browse/HIVE-5845>\n\nCTAS failed on vectorized code path<https://issues.apache.org/jira/browse/HIVE-5845>\n\n\nFollowing query fails:\n create table store_sales_2 stored as orc as select * from alltypesorc;\n\n\n\nThis message was sent by Atlassian JIRA (v6.1#6144-sha1:2e50328)\n\n[Atlassian logo]\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"created":"2013-11-19T17:35:19.568+0000","updated":"2013-11-19T17:35:19.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679838/comment/13826881","id":"13826881","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":" [~owen.omalley] is obvious expert on Orc. Lets tap into him for some advice here.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-11-19T20:02:06.096+0000","updated":"2013-11-19T20:02:06.096+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679838/comment/13827437","id":"13827437","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"body":"The root cause is not in OrcStruct/OrcSerde, but instead is in the VectorExpressionWriterFactory which does not honor properly the object inspectors passed in, assumes always to be a WritableXXObjectInspector and creates an WritableXXX object value. I am fixing this.\n\nWhy this was exposed is that OrcStruct.VectorExpressionWriterFactory creates writable object inspectors for most primitives, but for TIMESTAMP uses a native Java object inspector (also for DATE). I don't know why Orc does that, but none the less the VectorExpressionWriterFactory should handle this in a robust manner.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"created":"2013-11-20T08:34:09.858+0000","updated":"2013-11-20T08:34:09.858+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679838/comment/13827438","id":"13827438","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"body":" OrcStruct.createObjectInspector(TypeInfo info) that is (Eclipse copy/paste ...)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"created":"2013-11-20T08:35:12.831+0000","updated":"2013-11-20T08:35:12.831+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679838/comment/13827694","id":"13827694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"body":"https://reviews.apache.org/r/15716/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"created":"2013-11-20T14:29:14.104+0000","updated":"2013-11-20T14:29:14.104+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679838/comment/13827703","id":"13827703","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"body":"The uploaded fix addresses all the issues I found:\n\n - changes the OrcStruct serialization to use the correct object inspector (the one that writes into the OrcStruct fields)\n - the VectorExpressionWriterFactory was refactored to handle all assignments/writes and new object creation via the object inspectors, rather than assumming Writable types\n - a new API is available on the VectorExpressionWritter: setValue, which writes the value into the passed in object rather that returning a mutated the per-writer singleton. This was necessary for the OrcStruct vector serialization, which would end up reusing the same instance on all rows in the vector otherwise\n - changed the VectorExpressionWriter to use TypeInfo Category and PrimitiveCategory rather than type name string comparison\n - Have the VectorExpressionWriter generate writers from ObjectInspector and derive the OI from ExprNodeDesc rather than the other way around\n - extended the TestVectorExpressionWriter unit tests to cover the setValue API and struct fields assignment","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rusanu","name":"rusanu","key":"rusanu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rusanu&avatarId=16791","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rusanu&avatarId=16791","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rusanu&avatarId=16791","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rusanu&avatarId=16791"},"displayName":"Remus Rusanu","active":true,"timeZone":"Europe/Bucharest"},"created":"2013-11-20T14:34:44.339+0000","updated":"2013-11-20T14:34:44.339+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679838/comment/13828056","id":"13828056","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-11-20T20:06:36.063+0000","updated":"2013-11-20T20:06:36.063+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679838/comment/13828393","id":"13828393","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"body":"\n\n{color:green}Overall{color}: +1 all checks pass\n\nHere are the results of testing the latest attachment:\nhttps://issues.apache.org/jira/secure/attachment/12614892/HIVE-5845.1.patch\n\n{color:green}SUCCESS:{color} +1 4679 tests passed\n\nTest results: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/378/testReport\nConsole output: http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/378/console\n\nMessages:\n{noformat}\nExecuting org.apache.hive.ptest.execution.PrepPhase\nExecuting org.apache.hive.ptest.execution.ExecutionPhase\nExecuting org.apache.hive.ptest.execution.ReportingPhase\n{noformat}\n\nThis message is automatically generated.\n\nATTACHMENT ID: 12614892","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hiveqa","name":"hiveqa","key":"hiveqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hiveqa&avatarId=17060","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hiveqa&avatarId=17060","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hiveqa&avatarId=17060","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hiveqa&avatarId=17060"},"displayName":"Hive QA","active":true,"timeZone":"America/Chicago"},"created":"2013-11-21T01:59:12.112+0000","updated":"2013-11-21T01:59:12.112+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12679838/comment/13828403","id":"13828403","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to trunk. Thanks, Remus!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-11-21T02:21:19.937+0000","updated":"2013-11-21T02:21:19.937+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-5845/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1px7r:"}}