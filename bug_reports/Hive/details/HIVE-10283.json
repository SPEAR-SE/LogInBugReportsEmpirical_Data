{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12819798","self":"https://issues.apache.org/jira/rest/api/2/issue/12819798","key":"HIVE-10283","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-05-29T18:41:52.948+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri May 29 21:40:56 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-10283/watchers","watchCount":5,"isWatching":false},"created":"2015-04-09T19:26:46.079+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12426185","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12426185","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"outwardIssue":{"id":"12833804","key":"HIVE-10866","self":"https://issues.apache.org/jira/rest/api/2/issue/12833804","fields":{"summary":"Give a error when client try to insert into bucketed table for SMB","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-05-29T21:40:56.889+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12325007","id":"12325007","name":"Hive"}],"timeoriginalestimate":null,"description":"I suspect that by removing the reducer, HIVE-4240, may be causing issues. Because of this inserts will not consolidate 'buckets' into single files which is problematic when attempting to use bucketmapjoin.\n\nCREATE TABLE IF NOT EXISTS buckettestinput( \ndata string \n) \nROW FORMAT DELIMITED FIELDS TERMINATED BY ','; \n\n\nCREATE TABLE IF NOT EXISTS buckettestoutput1( \ndata string \n)CLUSTERED BY(data) \nINTO 2 BUCKETS \nROW FORMAT DELIMITED FIELDS TERMINATED BY ','; \n\n\nCREATE TABLE IF NOT EXISTS buckettestoutput2( \ndata string \n)CLUSTERED BY(data) \nINTO 2 BUCKETS \nROW FORMAT DELIMITED FIELDS TERMINATED BY ','; \n\nThen I inserted the following data into the \"buckettestinput\" table \n\nfirstinsert1 \nfirstinsert2 \nfirstinsert3 \nfirstinsert4 \nfirstinsert5 \nfirstinsert6 \nfirstinsert7 \nfirstinsert8 \nsecondinsert1 \nsecondinsert2 \nsecondinsert3 \nsecondinsert4 \nsecondinsert5 \nsecondinsert6 \nsecondinsert7 \nsecondinsert8 \n\nset hive.enforce.bucketing = true; \nset hive.enforce.sorting=true; \n\ninsert into table buckettestoutput1 \nselect * from buckettestinput where data like 'first%' \n\nSELECT * \nFROM buckettestoutput1 TABLESAMPLE(BUCKET 1 OUT OF 1 ON data) s; \n\n\ninsert into table buckettestoutput1 \nselect * from buckettestinput where data like 'second%' \n\ncheck the results of the table sample query. \n\nfor sort merge bucket map join \n\nset hive.auto.convert.sortmerge.join=true; \nset hive.optimize.bucketmapjoin = true; \nset hive.optimize.bucketmapjoin.sortedmerge = true; \nset hive.auto.convert.sortmerge.join.noconditionaltask=true; \n\n\nselect * from buckettestoutput1 a join buckettestoutput2 b on (a.data=b.data) \n\nhive> select * from buckettestoutput1 a join buckettestoutput2 b on (a.data=b.data); \nFAILED: SemanticException [Error 10141]: Bucketed table metadata is not correct. Fix the metadata or don't use bucketed mapjoin, by setting hive.enforce.bucketmapjoin to false. The number of buckets for table buckettestoutput1 is 2, whereas the number of files is 4 \n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"HIVE-4240 may be causing issue with bucketed tables ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Ryan+P","name":"Ryan P","key":"ryan p","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ryan+p&avatarId=22394","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ryan+p&avatarId=22394","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ryan+p&avatarId=22394","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ryan+p&avatarId=22394"},"displayName":"Ryan P","active":true,"timeZone":"Etc/GMT+4"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Ryan+P","name":"Ryan P","key":"ryan p","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ryan+p&avatarId=22394","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ryan+p&avatarId=22394","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ryan+p&avatarId=22394","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ryan+p&avatarId=22394"},"displayName":"Ryan P","active":true,"timeZone":"Etc/GMT+4"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12819798/comment/14565200","id":"14565200","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"body":"[~xuefuz] && [~szehon], could you find someone who know this part well work on the issue. Currently, in upstream master code , number of buckets is not respected even with insert overwrite. (insert overwrite only create 1 bucket file while the table definition is 2. \nReproduce:\n{noformat}\ncreate table buckettest (data string) partitioned by (state string) clustered by (data) into 2 buckets;\nset hive.enforce.bucketing = true;\ninsert overwrite table buckettest partition(state='MA') select code from jsmall limit 10;\nset hive.auto.convert.sortmerge.join=true;\nset hive.optimize.bucketmapjoin = true; \nset hive.optimize.bucketmapjoin.sortedmerge = true;\n0: jdbc:hive2://localhost:10000> select * from buckettest a join buckettestoutput2 b on (a.data=b.data);\nselect * from buckettest a join buckettestoutpu \nt2 b on (a.data=b.data);\nError: Error while compiling statement: FAILED: SemanticException [Error 10141]: Bucketed table metadata is not correct. Fix the metadata or don't use bucketed mapjoin, by setting hive.enforce.bucketmapjoin to false. The number of buckets for table buckettest partition state=MA is 2, whereas the number of files is 1 (state=42000,code=10141)\n{noformat}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-29T18:41:52.948+0000","updated":"2015-05-29T21:29:43.363+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12819798/comment/14565467","id":"14565467","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"body":"If this is the case, then it's a serious issue. My guess is that the number of reducer isn't set correctly. This seems to be a different issue than this JIRA. Could you please create a new JIRA. If this also happens to 1.2 release, then we need to mark it as a blocker for 1.2.1 release as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xuefuz","name":"xuefuz","key":"xuefuz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xuefu Zhang","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-29T21:40:56.889+0000","updated":"2015-05-29T21:40:56.889+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-10283/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2d1yf:"}}