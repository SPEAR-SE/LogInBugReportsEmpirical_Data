{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12559223","self":"https://issues.apache.org/jira/rest/api/2/issue/12559223","key":"HIVE-3084","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323587","id":"12323587","description":"Hive 0.11.0","name":"0.11.0","archived":false,"released":true,"releaseDate":"2013-05-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-07-26T00:10:23.969+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jan 09 10:24:20 UTC 2013","customfield_12310420":"259059","customfield_12312320":null,"customfield_12310222":"10002_*:*_2_*:*_7377678447_*|*_1_*:*_2_*:*_8836821074_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2012-12-09T09:09:15.284+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-3084/watchers","watchCount":6,"isWatching":false},"created":"2012-06-04T17:07:35.788+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-16T21:10:44.934+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Hive's [CI job|https://builds.apache.org/job/Hive-trunk-h0.21/] regularly fails due to this test:\n\n{code}\norg.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_script_broken_pipe1\n{code}\n\nRunning just that test in a loop I'm not able to reproduce the issue locally. This may be related to state from a previous test causing this one to fail?\n\n{code}\nant clean package\nfor x in $(seq 1 10); \n  do ant test -Dtestcase=TestNegativeCliDriver -Dqfile=script_broken_pipe1.q;\ndone\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12531186","id":"12531186","filename":"HIVE-3084_disable_failing_test.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-06-06T23:38:13.605+0000","size":1023,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12531186/HIVE-3084_disable_failing_test.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12559836","id":"12559836","filename":"HIVE-3084_two_script_operators.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-12-07T10:15:00.218+0000","size":4151,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12559836/HIVE-3084_two_script_operators.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"124305","customfield_12312823":null,"summary":"Hive CI failing due to script_broken_pipe1.q","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13288957","id":"13288957","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"body":"Here's the query that's failing. It hasn't been touched since 2009 so likely the change happened elsewhere.\n\n{code}\n$ cat ql/src/test/queries/clientnegative/script_broken_pipe1.q\nset hive.exec.script.allow.partial.consumption = false;\n-- Tests exception in ScriptOperator.close() by passing to the operator a small amount of data\nSELECT TRANSFORM(*) USING 'true' AS a, b, c FROM (SELECT * FROM src LIMIT 1) tmp;\n{code}\n\nThe logs are a little difficult to read since other tests throw errors too, but I think this is the actual error. The line number doesn't make sense though because looking at that class it has many fewer lines.\n\n{code}\njunit.framework.AssertionFailedError: Client Execution failed with error code = 0\nSee build/ql/tmp/hive.log, or try \"ant test ... -Dtest.silent=false\" to get more logs.\n\tat junit.framework.Assert.fail(Assert.java:50)\n\tat org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_script_broken_pipe1(TestNegativeCliDriver.java:10737)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat junit.framework.TestCase.runTest(TestCase.java:168)\n\tat junit.framework.TestCase.runBare(TestCase.java:134)\n\tat junit.framework.TestResult$1.protect(TestResult.java:110)\n\tat junit.framework.TestResult.runProtected(TestResult.java:128)\n\tat junit.framework.TestResult.run(TestResult.java:113)\n\tat junit.framework.TestCase.run(TestCase.java:124)\n\tat junit.framework.TestSuite.runTest(TestSuite.java:243)\n\tat junit.framework.TestSuite.run(TestSuite.java:238)\n\tat org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:518)\n\tat org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:1052)\n\tat org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:906){code}\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-06-04T22:18:01.875+0000","updated":"2012-06-04T22:18:01.875+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13288963","id":"13288963","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"body":"The line number discrepancy is because TestNegativeCliDriver.java is generated from {{ql/src/test/templates/TestNegativeCliDriver.vm}}. When running just a single query the generated test driver is much smaller.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-06-04T22:29:14.631+0000","updated":"2012-06-04T22:29:14.631+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13288990","id":"13288990","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"body":"Curiously, the MR job is failing as expected:\n\nhttps://builds.apache.org/job/Hive-trunk-h0.21/1467/artifact/hive/build/ql/test/logs/clientnegative/script_broken_pipe1.q.out.orig/*view*/\n\n{code}\nPREHOOK: query: -- Tests exception in ScriptOperator.close() by passing to the operator a small amount of data\nSELECT TRANSFORM(*) USING 'true' AS a, b, c FROM (SELECT * FROM src LIMIT 1) tmp\nPREHOOK: type: QUERY\nPREHOOK: Input: default@src\nPREHOOK: Output: file:/tmp/jenkins/hive_2012-06-04_14-38-51_416_5197288142356377226/-mr-10000\nExecution failed with exit status: 2\nObtaining error information\n\nTask failed!\nTask ID:\n  Stage-1\n\nLogs:\n\n/home/jenkins/jenkins-slave/workspace/Hive-trunk-h0.21/hive/build/ql/tmp//hive.log\nFAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.MapRedTask\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-06-04T23:37:20.266+0000","updated":"2012-06-04T23:37:20.266+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13289044","id":"13289044","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"body":"The MR job is definitely failing. From hive.log:\n\n{code}\n2012-06-03 14:14:00,753 ERROR ql.Driver (SessionState.java:printError(400)) - FAILED: Execution Error, return code 20003 from org.apache.hadoop.hive.ql.exec.MapRedTask. An error occurred when trying to close the Operator running your custom script.\n{code}\n\nAt this point I'm pretty stumped. Poking through the code and all available logs it looks like this test should be failing on Jenkins, and I can't reproduce locally.\n\nAny objections to disabling the test and leaving this bug open in case anyone wants to revisit looking at why its failing? Since it already fails there's no loss in coverage.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-06-05T01:10:48.208+0000","updated":"2012-06-05T01:10:48.208+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13289057","id":"13289057","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"body":"Not sure if this is relevant, but {{build/ql/test/logs/clientnegative/script_broken_pipe1.q.out.orig}} appears to be the output of the test query. This might be obvious with someone more familiar with the tests. Looking at builds that passed, the file always exists and looks like the one I copy/pasted above. All builds that failed do not have the file.\n\nFor example, the most recent build 1467 passed and this file exists:\n\nhttps://builds.apache.org/job/Hive-trunk-h0.21/1467/artifact/hive/build/ql/test/logs/clientnegative/script_broken_pipe1.q.out.orig/*view*/\n\n\nBuild 1465 throws a 404 for that same file (build 1464 failed for what looks like a jenkins issue?):\n\nhttps://builds.apache.org/job/Hive-trunk-h0.21/1465/artifact/hive/build/ql/test/logs/clientnegative/script_broken_pipe1.q.out.orig/*view*/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-06-05T01:26:40.945+0000","updated":"2012-06-05T01:26:40.945+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13289061","id":"13289061","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"body":"This file always exists, for both tests that pass and fail, but looks different based on the return status:\n\nSUCCESSFUL JOB: https://builds.apache.org/job/Hive-trunk-h0.21/1467/artifact/hive/build/ql/test/logs/clientnegative/script_broken_pipe1.q.out/*view*/\n\n{code}\nPREHOOK: query: -- Tests exception in ScriptOperator.close() by passing to the operator a small amount of data\nSELECT TRANSFORM(*) USING 'true' AS a, b, c FROM (SELECT * FROM src LIMIT 1) tmp\nPREHOOK: type: QUERY\nPREHOOK: Input: default@src\n#### A masked pattern was here ####\nExecution failed with exit status: 2\nObtaining error information\n\nTask failed!\nTask ID:\n  Stage-1\n\nLogs:\n\n#### A masked pattern was here ####\nFAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.MapRedTask\n{code}\n\n\nFAILED JOB: https://builds.apache.org/job/Hive-trunk-h0.21/1465/artifact/hive/build/ql/test/logs/clientnegative/script_broken_pipe1.q.out/*view*/\n\n{code}\nPREHOOK: query: -- Tests exception in ScriptOperator.close() by passing to the operator a small amount of data\nSELECT TRANSFORM(*) USING 'true' AS a, b, c FROM (SELECT * FROM src LIMIT 1) tmp\nPREHOOK: type: QUERY\nPREHOOK: Input: default@src\nPREHOOK: Output: file:/tmp/jenkins/hive_2012-06-03_14-10-42_578_7952591156793146133/-mr-10000\nPOSTHOOK: query: -- Tests exception in ScriptOperator.close() by passing to the operator a small amount of data\nSELECT TRANSFORM(*) USING 'true' AS a, b, c FROM (SELECT * FROM src LIMIT 1) tmp\nPOSTHOOK: type: QUERY\nPOSTHOOK: Input: default@src\nPOSTHOOK: Output: file:/tmp/jenkins/hive_2012-06-03_14-10-42_578_7952591156793146133/-mr-10000\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-06-05T01:30:06.759+0000","updated":"2012-06-05T01:30:06.759+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13290591","id":"13290591","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"body":"This patch disables {{script_broken_pipe1.q}} which from the Jenkins build history should cause the build to start passing.\n\nhttps://reviews.facebook.net/D3525\n\nOf course, disabling tests is not ideal but since this will cause the build to pass the benefit seems there. A followup issue could be opened to fix it if there's interest.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-06-06T23:36:45.775+0000","updated":"2012-06-06T23:36:45.775+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13422752","id":"13422752","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Yeah its really annoying that irregular and inconsistent failure of this test introduce huge irregularity in hudson test outputs. Quite a few svn commits are reported as failure where actual culprit is this test which makes hudson less reliable. If no one wants to investigate this further, I will commit Travis's patch and will open a follow-up jira for later investigation.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-07-26T00:10:23.969+0000","updated":"2012-07-26T00:10:23.969+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13426240","id":"13426240","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Looks like no-one is up for it. So, lets disable this.\n\n@Travis, the way we disable the test is via EXCLUDE_MAJOR_VERSION macro. Lets disable this on all versions. See, example on HIVE-3303. I will test and commit your patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-08-01T00:24:37.215+0000","updated":"2012-08-01T00:24:37.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13426242","id":"13426242","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"body":"Sg, I'll take a look at how disabling works and update the patch. Thanks! I'm really excited about having a reliable test suite so I have more confidence changes we're making don't break things :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=traviscrawford","name":"traviscrawford","key":"traviscrawford","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=traviscrawford&avatarId=26745","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=traviscrawford&avatarId=26745","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=traviscrawford&avatarId=26745","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=traviscrawford&avatarId=26745"},"displayName":"Travis Crawford","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-08-01T00:29:32.195+0000","updated":"2012-08-01T00:29:32.195+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13443941","id":"13443941","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"body":"I think it would nice to continue running this test and simply ignore the cases where it fails. It looks like this can be accomplished with JUnit's @Ignore annotation: http://kentbeck.github.com/junit/javadoc/latest/org/junit/Ignore.html\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwsteinbach","name":"cwsteinbach","key":"cwsteinbach","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carl Steinbach","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-08-29T10:06:11.770+0000","updated":"2012-08-29T10:06:11.770+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13526278","id":"13526278","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"body":"I ran into the same issue. It affects both script_broken_pipe1.q as well as minimr_broken_pipe.q. script_broken_pipe3.q has the same problem, but it won't cause the test to fail - just to not test what it was intended to do.\n\nThe test seems to assume that the user process (bash's \"true\") exits and closes its stdin before the ScriptOperator closes the associated output (in the close method). There is however no guarantee that things happen in this sequence and if they don't there will be no exception thrown.\n\nI have rewritten the tests using two ScriptOperators in the pipeline. The first one will exit properly, the second one will throw the exception. Closing the first ScriptOperator (flushing buffers, waitFor...) should ensure that the second user process had a chance to exit, although strictly speaking there is still no guarantee. I've run this a number of time and wasn't able to reproduce the issue with the fix. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-12-07T10:14:36.002+0000","updated":"2012-12-07T10:14:36.002+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13527240","id":"13527240","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-12-08T19:19:51.267+0000","updated":"2012-12-08T19:19:51.267+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13527376","id":"13527376","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to trunk. Thanks, Gunther!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-12-09T09:09:15.302+0000","updated":"2012-12-09T09:09:15.302+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13527575","id":"13527575","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hive-trunk-h0.21 #1845 (See [https://builds.apache.org/job/Hive-trunk-h0.21/1845/])\n    HIVE-3084 : Hive CI failing due to script_broken_pipe1.q (Gunther Hagleitner via Ashutosh Chauhan) (Revision 1418841)\n\n     Result = FAILURE\nhashutosh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1418841\nFiles : \n* /hive/trunk/ql/src/test/queries/clientnegative/minimr_broken_pipe.q\n* /hive/trunk/ql/src/test/queries/clientnegative/script_broken_pipe1.q\n* /hive/trunk/ql/src/test/queries/clientnegative/script_broken_pipe3.q\n* /hive/trunk/ql/src/test/results/clientnegative/minimr_broken_pipe.q.out\n* /hive/trunk/ql/src/test/results/clientnegative/script_broken_pipe1.q.out\n* /hive/trunk/ql/src/test/results/clientnegative/script_broken_pipe3.q.out\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2012-12-09T18:39:52.103+0000","updated":"2012-12-09T18:39:52.103+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559223/comment/13548089","id":"13548089","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hive-trunk-hadoop2 #54 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/54/])\n    HIVE-3084 : Hive CI failing due to script_broken_pipe1.q (Gunther Hagleitner via Ashutosh Chauhan) (Revision 1418841)\n\n     Result = ABORTED\nhashutosh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1418841\nFiles : \n* /hive/trunk/ql/src/test/queries/clientnegative/minimr_broken_pipe.q\n* /hive/trunk/ql/src/test/queries/clientnegative/script_broken_pipe1.q\n* /hive/trunk/ql/src/test/queries/clientnegative/script_broken_pipe3.q\n* /hive/trunk/ql/src/test/results/clientnegative/minimr_broken_pipe.q.out\n* /hive/trunk/ql/src/test/results/clientnegative/script_broken_pipe1.q.out\n* /hive/trunk/ql/src/test/results/clientnegative/script_broken_pipe3.q.out\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-09T10:24:20.952+0000","updated":"2013-01-09T10:24:20.952+0000"}],"maxResults":16,"total":16,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-3084/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0lmk7:"}}