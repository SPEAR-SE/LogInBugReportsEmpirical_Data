{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13036742","self":"https://issues.apache.org/jira/rest/api/2/issue/13036742","key":"HIVE-15687","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-03-17T08:55:07.883+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Aug 29 02:44:24 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-15687/watchers","watchCount":4,"isWatching":false},"created":"2017-01-21T00:16:36.897+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cltlfcjin","name":"cltlfcjin","key":"cltlfcjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cltlfcjin&avatarId=26058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cltlfcjin&avatarId=26058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cltlfcjin&avatarId=26058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cltlfcjin&avatarId=26058"},"displayName":"Lantao Jin","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-08-29T02:44:24.014+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[],"timeoriginalestimate":null,"description":"The documentation states https://cwiki.apache.org/confluence/display/Hive/SQL+Standard+Based+Hive+Authorization#SQLStandardBasedHiveAuthorization-ObjectPrivilegeCommands that there are privilege types of INSERT | SELECT | UPDATE | DELETE | ALL.\n\nExperience suggests otherwise:\n\n{code}\n: jdbc:hive2://localhost:10000/default> grant select on table secured_table to role my_role;\nNo rows affected (0.034 seconds)\n0: jdbc:hive2://localhost:10000/default> grant insert on table secured_table to role my_role;\nError: Error while compiling statement: FAILED: SemanticException Undefined privilege Insert (state=42000,code=40000)\n0: jdbc:hive2://localhost:10000/default> grant update on table secured_table to role my_role;\nNo rows affected (0.037 seconds)\n0: jdbc:hive2://localhost:10000/default> grant delete on table secured_table to role my_role;\nError: Error while compiling statement: FAILED: SemanticException Undefined privilege Delete (state=42000,code=40000)\n\n0: jdbc:hive2://localhost:10000/default> select version();\n+--------------------------------------------------------------+--+\n|                             _c0                              |\n+--------------------------------------------------------------+--+\n| 2.1.0.2.6.0.0-369 r434bfeb707d21f6b44121ac7dfe5adbadb746387  |\n+--------------------------------------------------------------+--+\n{code}\n\nIt would be good to support these, especially since Hive supports updates and deletions.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"SQL Standard auth: INSERT and DELETE privileges don't actually exist.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cartershanklin","name":"cartershanklin","key":"cartershanklin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carter Shanklin","active":true,"timeZone":"America/Chicago"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cartershanklin","name":"cartershanklin","key":"cartershanklin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Carter Shanklin","active":true,"timeZone":"America/Chicago"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036742/comment/15929598","id":"15929598","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cltlfcjin","name":"cltlfcjin","key":"cltlfcjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cltlfcjin&avatarId=26058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cltlfcjin&avatarId=26058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cltlfcjin&avatarId=26058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cltlfcjin&avatarId=26058"},"displayName":"Lantao Jin","active":true,"timeZone":"Asia/Shanghai"},"body":"If you want to grant {{insert}} | {{delete}} to a role under default authorization provider. You can run grant {{all}} for instead.\n\nThat's not a but. If you set {{hive.security.authorization.manager}} to {{DefaultHiveAuthorizationProvider}}(default) or {{StorageBasedAuthorizationProvider}} which are the subclass of {{HiveAuthorizationProvider}}. The privilege {{insert}} | {{delete}} aren't support. \nWe can get the evidence from PrivilegeRegistry:\n{code:java}\nstatic {\n    Registry = new HashMap<PrivilegeType, Privilege>();\n\n    //add the privileges supported in authorization mode V1\n    Registry.put(Privilege.ALL.getPriv(), Privilege.ALL);\n    Registry.put(Privilege.ALTER_DATA.getPriv(), Privilege.ALTER_DATA);\n    Registry.put(Privilege.ALTER_METADATA.getPriv(), Privilege.ALTER_METADATA);\n    Registry.put(Privilege.CREATE.getPriv(), Privilege.CREATE);\n    Registry.put(Privilege.DROP.getPriv(), Privilege.DROP);\n    Registry.put(Privilege.INDEX.getPriv(), Privilege.INDEX);\n    Registry.put(Privilege.LOCK.getPriv(), Privilege.LOCK);\n    Registry.put(Privilege.SELECT.getPriv(), Privilege.SELECT);\n    Registry.put(Privilege.SHOW_DATABASE.getPriv(),\n        Privilege.SHOW_DATABASE);\n\n    //add the privileges not supported in V1\n    //The list of privileges supported in V2 is implementation defined,\n    //so just pass everything that syntax supports.\n    RegistryV2 = new HashMap<PrivilegeType, Privilege>();\n    RegistryV2.putAll(Registry);\n    RegistryV2.put(Privilege.INSERT.getPriv(), Privilege.INSERT);\n    RegistryV2.put(Privilege.DELETE.getPriv(), Privilege.DELETE);\n  }\n{code} \n\n{code:java}\n  private static Privilege getPrivilegeFromRegistry(PrivilegeType ptype) {\n    return SessionState.get().isAuthorizationModeV2() ? RegistryV2.get(ptype) : Registry.get(ptype);\n  }\n\n  public boolean isAuthorizationModeV2(){\n    return getAuthorizationMode() == AuthorizationMode.V2;\n  }\n  \n  public AuthorizationMode getAuthorizationMode(){\n    setupAuth();\n    if(authorizer != null){\n      return AuthorizationMode.V1;\n    }else if(authorizerV2 != null){\n      return AuthorizationMode.V2;\n    }\n    //should not happen - this should not get called before this.start() is called\n    throw new AssertionError(\"Authorization plugins not initialized!\");\n  }\n{code}\n\nOnly when object {{authorizer}} is null and {{authorizerV2}} isn't null, we can grant {{INSERT | DELET}}, otherwise {{ALL}} instead.\nFor more details, Go into org.apache.hadoop.hive.ql.session.SessionState\n{code:java}\n   private void setupAuth() {\n      String clsStr = HiveConf.getVar(conf, HiveConf.ConfVars.HIVE_AUTHORIZATION_MANAGER);\n      authorizer = HiveUtils.getAuthorizeProviderManager(conf,\n          clsStr, authenticator, true);\n\n      if (authorizer == null) {\n        ..\n        authorizerV2 = authorizerFactory.createHiveAuthorizer(new HiveMetastoreClientFactoryImpl(),\n            conf, authenticator, authzContextBuilder.build());\n      }\n  }\n\n  public static HiveAuthorizationProvider getAuthorizeProviderManager(\n      Configuration conf, String authzClassName,\n      HiveAuthenticationProvider authenticator, boolean nullIfOtherClass) throws HiveException {\n\n    HiveAuthorizationProvider ret = null;\n    try {\n      Class<? extends HiveAuthorizationProvider> cls = null;\n      if (authzClassName == null || authzClassName.trim().equals(\"\")) {\n        cls = DefaultHiveAuthorizationProvider.class;\n      } else {\n        Class<?> configClass = Class.forName(authzClassName, true, JavaUtils.getClassLoader());\n        if(nullIfOtherClass && !HiveAuthorizationProvider.class.isAssignableFrom(configClass) ){\n          return null;        /*  ====>    notice the condition how to return null        <======*/\n        }\n        cls = (Class<? extends HiveAuthorizationProvider>)configClass;\n      }\n      if (cls != null) {\n        ret = ReflectionUtils.newInstance(cls, conf);\n      }\n    } catch (Exception e) {\n      throw new HiveException(e);\n    }\n    ret.setAuthenticator(authenticator);\n    return ret;\n  }\n{code}\n{{nullIfOtherClass}} is always true, and only the {{authzClassName}} which stand for the value of {{hive.security.authorization.manager}} is not the subclass of {{HiveAuthorizationProvider}}, it will return null.\n\nSo please set {{hive.security.authorization.manager}} to {{org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdConfOnlyAuthorizerFactory}} to get v2 authorization to grant INSERT | DELETE.\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cltlfcjin","name":"cltlfcjin","key":"cltlfcjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cltlfcjin&avatarId=26058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cltlfcjin&avatarId=26058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cltlfcjin&avatarId=26058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cltlfcjin&avatarId=26058"},"displayName":"Lantao Jin","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-03-17T08:55:07.883+0000","updated":"2017-03-17T08:55:07.883+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13036742/comment/16144672","id":"16144672","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wmky_kk","name":"wmky_kk","key":"wmky_kk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"youchuikai","active":true,"timeZone":"Asia/Shanghai"},"body":"[~cltlfcjin] Do you have method to solved the question of HIVE-15687?\nYou say：set hive.security.authorization.manager to org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdConfOnlyAuthorizerFactory to get v2 authorization to grant INSERT | DELETE，Is this method able to sovle the problem?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wmky_kk","name":"wmky_kk","key":"wmky_kk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"},"displayName":"youchuikai","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-08-29T02:44:24.014+0000","updated":"2017-08-29T02:44:24.014+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-15687/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i390uv:"}}