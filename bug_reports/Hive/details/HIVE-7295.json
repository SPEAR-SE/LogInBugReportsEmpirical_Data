{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12723800","self":"https://issues.apache.org/jira/rest/api/2/issue/12723800","key":"HIVE-7295","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-06-26T05:10:59.343+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jun 27 16:31:08 UTC 2014","customfield_12310420":"401985","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-7295/watchers","watchCount":3,"isWatching":false},"created":"2014-06-26T03:49:22.305+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324986","id":"12324986","description":"released","name":"0.13.0","archived":false,"released":true,"releaseDate":"2014-04-21"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-07-21T21:56:18.029+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12317300","id":"12317300","name":"Authorization","description":"Security Subcomponent"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12320409","id":"12320409","name":"HCatalog","description":"Tracks issues related to the HCatalog"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313866","id":"12313866","name":"Security"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12318904","id":"12318904","name":"Windows","description":"Issues related to running Hive on Windows (not including Cygwin, MSYS, etc)"}],"timeoriginalestimate":null,"description":"Unit test in TestHdfsAuthorizationProvider, e.g. org.apache.hcatalog.security.TestHdfsAuthorizationProvider.testTableOps. fails to run.\n\nRunning org.apache.hcatalog.security.TestHdfsAuthorizationProvider\nTests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 15.799 sec <<< FAILURE! - in org.apache.hcatalog.security.TestHdfsAuthorizationProvider\ntestTableOps(org.apache.hcatalog.security.TestHdfsAuthorizationProvider)  Time elapsed: 15.546 sec  <<< FAILURE!\njunit.framework.AssertionFailedError: FAILED: AuthorizationException org.apache.hadoop.security.AccessControlException: action WRITE not permitted on path pfile:/Users/xz\nhou/hworks/workspace/hwx-hive-ws/hive/hcatalog/core/target/warehouse for user xzhou expected:<0> but was:<40000>\n        at junit.framework.Assert.fail(Assert.java:50)\n        at junit.framework.Assert.failNotEquals(Assert.java:287)\n        at junit.framework.Assert.assertEquals(Assert.java:67)\n        at junit.framework.Assert.assertEquals(Assert.java:199)\n        at org.apache.hcatalog.security.TestHdfsAuthorizationProvider.exec(TestHdfsAuthorizationProvider.java:172)\n        at org.apache.hcatalog.security.TestHdfsAuthorizationProvider.testTableOps(TestHdfsAuthorizationProvider.java:307)\n        ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"402051","customfield_12312823":null,"summary":"automatically set ownership of new files/dirs to Administrators group instead of individual user","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaobingo","name":"xiaobingo","key":"xiaobingo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobing Zhou","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaobingo","name":"xiaobingo","key":"xiaobingo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobing Zhou","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows Server 2008 R2","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723800/comment/14044328","id":"14044328","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaobingo","name":"xiaobingo","key":"xiaobingo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobing Zhou","active":true,"timeZone":"America/Los_Angeles"},"body":"After digging, AuthorizationException is thrown inside HdfsAuthorizationProvider.checkPermissions(final FileSystem fs...) because permissions to operate on DB path are not met. FileStatus.getOwner gives out name of group, not user name expected for permission check going through. e.g. Administrators, not xzhou. \n\nFileStatus.getGroup also returns group like machine-name\\None, which does not match group the user running program belongs to, operation on the path not permitted.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaobingo","name":"xiaobingo","key":"xiaobingo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobing Zhou","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-26T04:02:33.302+0000","updated":"2014-06-26T04:02:33.302+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723800/comment/14044330","id":"14044330","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaobingo","name":"xiaobingo","key":"xiaobingo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobing Zhou","active":true,"timeZone":"America/Los_Angeles"},"body":"This is a bug from HDFS, I guess. \nIt was reported that permissions check would go through if a dedicated user detached from administrators group is used to login windows and run the unit tests. I will try that and get back.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaobingo","name":"xiaobingo","key":"xiaobingo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobing Zhou","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-26T04:06:10.727+0000","updated":"2014-06-26T04:06:10.727+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723800/comment/14044354","id":"14044354","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi, [~xiaobingo].  Yes, this is something particular to Windows.  If you're logged in as a user in the administrators group, then files you create on the local file system will be owned by the administrators group, not your individual user.  Here is an example running winutils ls on a file I created while logged in as a member of the administrators group:\n\n{code}\nC:\\test>C:\\hdc\\hadoop-common-project\\hadoop-common\\target\\bin\\winutils.exe ls C:\\test\\hello\n-rwx------ 1 BUILTIN\\Administrators CNAUROTH-VM-1\\None 8 Jan 14 2014 C:\\test\\hello\n{code}\n\nHere is the same thing run on a different VM, where my user is not a member of the administrators group:\n\n{code}\nC:\\test>C:\\hdc\\hadoop-common-project\\hadoop-common\\target\\bin\\winutils.exe ls C:\\test\\hello\n-rwx------ 1 WIN-NCDLEQLC13J\\cnauroth WIN-NCDLEQLC13J\\None 8 Jun 26 2014 C:\\test\\hello\n{code}\n\nThere isn't really any way to change code to work around this.  The only workaround is to run unit tests as a user who is not a member of the administrators group.\n\nNote that when you set up a non-admin user for yourself, you'll need to make sure that user has Create Symbolic Links permission.  The code in Hadoop core relies on creating symlinks for a couple of important things, notably {{MiniYARNCluster}}.  Admins get this permission automatically, but regular users don't.  This page describes how to grant the permission to a regular user:\n\nhttp://superuser.com/questions/104845/permission-to-make-symbolic-links-in-windows-7\n\nHope this helps.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-26T05:10:59.343+0000","updated":"2014-06-26T05:10:59.343+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723800/comment/14044947","id":"14044947","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaobingo","name":"xiaobingo","key":"xiaobingo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobing Zhou","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~cnauroth]. \n\nSince this is Windows specific, we can use this code snippet for work-around.\n\n if (user.equals(stat.getOwner())) {\n        if (dirPerms.getUserAction().implies(action)) {\n          continue;\n        }\n      }\n\nif (ArrayUtils.contains(groups, stat.getGroup())) {\n        if (dirPerms.getGroupAction().implies(action)) {\n          continue;\n        }\n      }\n\n if (dirPerms.getOtherAction().implies(action)) {\n        continue;\n      }\n\n//windows specific add-on\nif (Shell.WINDOWS) {\n        if (ArrayUtils.contains(groups, stat.getOwner())) { //stat.getOwner returns administrators \n          if (dirPerms.getUserAction().implies(action)) {\n            continue;\n          }\n        }\n      }\n\n\nThis passes all failed test cases affected, even if login user is a member of admin group.\n\n   ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaobingo","name":"xiaobingo","key":"xiaobingo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobing Zhou","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-26T17:59:57.266+0000","updated":"2014-06-26T17:59:57.266+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723800/comment/14045014","id":"14045014","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi, [~xiaobingo].  Overall, I recommend running tests as a non-admin user.  If you really prefer to put a workaround in the code, then I recommend limiting the scope of the special case.  This code won't be capable of telling the difference between a user named \"foo\" and a group named \"foo\".  It's common for files to have greater permissions for the owner vs. the group, so if an attacker named \"bar\" somehow manages to sneak \"foo\" into his group memberships, then it could cause elevation of privileges.  (This is probably unlikely, but I wanted to point it out.)\n\nA couple of suggestions:\n# Only trigger the special case if running on Windows and the {{FileSystem}} represents a local file system.  This Administrators special case does not apply to other file systems (HDFS or S3 for example).\n# Only allow it for Administrators, not any group.  This behavior of setting ownership of new files to Administrators is a special case for members of the Administrators group only.\n\nBTW, there is also a Windows policy setting that can be changed so that it won't automatically set ownership of new files to Administrators.  This might be another option if you prefer to keep running tests as an admin.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-26T18:55:27.427+0000","updated":"2014-06-26T18:55:27.427+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12723800/comment/14046119","id":"14046119","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaobingo","name":"xiaobingo","key":"xiaobingo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobing Zhou","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~cnauroth] for pointing-out.\nNot setting ownership of new files to Administrators is preferable, this is loose constraint as compared.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaobingo","name":"xiaobingo","key":"xiaobingo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaobing Zhou","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-27T16:31:08.595+0000","updated":"2014-06-27T16:31:08.595+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-7295/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1x6w7:"}}