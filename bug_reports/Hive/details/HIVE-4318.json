{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12641535","self":"https://issues.apache.org/jira/rest/api/2/issue/12641535","key":"HIVE-4318","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323587","id":"12323587","description":"Hive 0.11.0","name":"0.11.0","archived":false,"released":true,"releaseDate":"2013-05-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-04-09T20:32:32.840+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sun Apr 21 09:24:01 UTC 2013","customfield_12310420":"321951","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_117489344_*|*_1_*:*_1_*:*_818295303_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-04-20T03:33:40.865+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4318/watchers","watchCount":7,"isWatching":false},"created":"2013-04-09T07:37:16.247+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12367617","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12367617","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"inwardIssue":{"id":"12643336","key":"HIVE-4378","self":"https://issues.apache.org/jira/rest/api/2/issue/12643336","fields":{"summary":"Counters hit performance even when not used","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-16T21:09:57.944+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312586","id":"12312586","name":"Query Processor","description":"Tracks issues dealing with query processing."}],"timeoriginalestimate":null,"description":"Operator Hooks inserted into Operator.java cause a performance hit even when it is not being used.\n\nFor a count(1) query tested with & without the operator hook calls.\n\n{code:title=with}\n2013-04-09 07:33:58,920 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 84.07 sec\nTotal MapReduce CPU Time Spent: 1 minutes 24 seconds 70 msec\nOK\n28800991\nTime taken: 40.407 seconds, Fetched: 1 row(s)\n{code}\n\n{code:title=without}\n2013-04-09 07:33:02,355 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 68.48 sec\n...\nTotal MapReduce CPU Time Spent: 1 minutes 8 seconds 480 msec\nOK\n28800991\nTime taken: 35.907 seconds, Fetched: 1 row(s)\n{code}\n\nThe effect is multiplied by the number of operators in the pipeline that has to forward the row - the more operators there are the, the slower the query.\n\nThe modification made to test this was \n\n{code:title=Operator.java}\n--- ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java\n+++ ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java\n@@ -526,16 +526,16 @@ public void process(Object row, int tag) throws HiveException {\n       return;\n     }\n     OperatorHookContext opHookContext = new OperatorHookContext(this, row, tag);\n-    preProcessCounter();\n-    enterOperatorHooks(opHookContext);\n+    //preProcessCounter();\n+    //enterOperatorHooks(opHookContext);\n     processOp(row, tag);\n-    exitOperatorHooks(opHookContext);\n-    postProcessCounter();\n+    //exitOperatorHooks(opHookContext);\n+    //postProcessCounter();\n   }\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12577904","id":"12577904","filename":"HIVE-4318.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-09T22:08:11.880+0000","size":71230,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12577904/HIVE-4318.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12578498","id":"12578498","filename":"HIVE-4318.2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-12T20:37:44.415+0000","size":75586,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12578498/HIVE-4318.2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12579391","id":"12579391","filename":"HIVE-4318.3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-18T18:52:16.894+0000","size":71913,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12579391/HIVE-4318.3.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12578558","id":"12578558","filename":"HIVE-4318.patch.pam.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pamelavagata","name":"pamelavagata","key":"pamelavagata","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pamela Vagata","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-13T00:18:54.810+0000","size":2796,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12578558/HIVE-4318.patch.pam.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"322296","customfield_12312823":null,"summary":"OperatorHooks hit performance even when not used","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gopalv","name":"gopalv","key":"gopalv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gopal V","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gopalv","name":"gopalv","key":"gopalv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gopal V","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Ubuntu LXC (64 bit)","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13627063","id":"13627063","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"body":"Nice find! Thanks! I can see how that will be problematic in the inner loop. Just glancing at it:\n\n- the only place where we use operator-hooks seems to be the home-grown profiler. Neat to have, but not a good reason to slow down performance.\n- this seems to add the following overhead to the inner loop:\n  - allocation of context per row\n  - iteration through empty list of hooks (utils always sets empty list)\n  - two additional virtual calls\n\nIs anyone really using/planning on using this? The easiest fix would be to just remove it, which seems the right thing to do. It doesn't seem useful to have a feature that adds a lot of overhead in the inner loop. There are ways to cut down on the overhead for when there are no hooks, but I'd like to know if there's opposition to removing it first.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-09T20:32:32.840+0000","updated":"2013-04-09T20:32:32.840+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13627096","id":"13627096","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"I agree with Gunther's analysis and suggestion to remove them altogether. If only reason to introduce operator level hook was to measure performance that we have failed in that objective by actually making system slower not faster. Profiling should be done using jvm toolkits like yourkit, jvisualvm etc., not by modifying code.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-09T20:56:42.815+0000","updated":"2013-04-09T20:56:42.815+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13627793","id":"13627793","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gopalv","name":"gopalv","key":"gopalv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gopal V","active":true,"timeZone":"Asia/Kolkata"},"body":"I agree with Gunther's conclusion - moving this out would be the immediate fix for performance reasons.\n\nBut a built-in profiler is an advantage in many ways, considering how something like yourkit takes ~45 mins to run through a 2 min query & requires a license key to inspect the output.\n\nThere is definitely middle ground to be found here.\n\nThe operator base-class hooks need to be removed for sure since it pollutes the common code-path and allocates objects in the inner loop. \n\nBut the feature is a good idea & should be set aside for an implementation revisit later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gopalv","name":"gopalv","key":"gopalv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gopal V","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-04-10T13:44:58.091+0000","updated":"2013-04-10T13:44:58.091+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13628261","id":"13628261","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Till we find a middle ground for this, we need to remove this to avoid loosing performance. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-10T21:17:43.787+0000","updated":"2013-04-10T21:17:43.787+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13629241","id":"13629241","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pamelavagata","name":"pamelavagata","key":"pamelavagata","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pamela Vagata","active":true,"timeZone":"America/Los_Angeles"},"body":"The operator level hooks were introduced to allow a user to profile their query and see which operator was taking the most time in order to determine whether or not there are query improvements to be made, not for measuring the performance of the overall system. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pamelavagata","name":"pamelavagata","key":"pamelavagata","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pamela Vagata","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-11T19:12:26.139+0000","updated":"2013-04-11T19:12:26.139+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13629242","id":"13629242","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"body":"The preProcessCounter and postProcessCounter weren't added for operator hooks, they were preexisting, and it doesn't look like they were modified by the diff either.\nhttp://svn.apache.org/viewvc/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java?r1=1404933&r2=1438825\n\nCould you try your experiment again just removing those two method calls and not enterOperatorHooks and exitOperatorHooks.  Those two methods look really cheap if there are not operator hooks (they just check if the list is null and return).\n\nI just want to make sure if anything is removed, we're not removing too much.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-11T19:13:33.119+0000","updated":"2013-04-11T19:13:33.119+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13629247","id":"13629247","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"body":"It looks like the performance cost of those methods was recognized shortly after they were added\nhttps://issues.apache.org/jira/browse/HIVE-768\n\nIt's possible the config hive.task.progress isn't as effective at countering it as expected.\n\nCan you make sure it is set to false in your run.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-11T19:19:55.794+0000","updated":"2013-04-11T19:19:55.794+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13629474","id":"13629474","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"body":"[~kevinwilfong]: Good point, I didn't see that the counters were removed as well in the original run. I'll get more numbers.\n\nHowever in general, I think the process method is a bad place to put hooks into (or anything other than processing rows really). If the profiler is the only thing that uses it (and there seems to be agreement that it's useful), we should still remove it for now and re-write that in a way that has no effect on production systems.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-11T22:15:18.492+0000","updated":"2013-04-11T22:15:18.492+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13629957","id":"13629957","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"body":"[~kevinwilfong]: Here are the additional numbers. \n\nSummary: You were right about counters having a significant effect despite the flag, but OperatorHooks are definitely expensive too.\n\nAll tests were run on EC2, single node setup. I used ~3m rows, single table, stored in rc file. Query was count\\(*\\) with a simple not very selective where clause. I've ran each different build 5 times and averaged the last 3 runs. There was little difference between the runs. Hive.task.progress was off in all runs, no actual operator hooks were installed.\n\nI've also tested both removing counters and a fixed version of counters. The fixed version places the check for the flag at the right place to avoid unnecessary calls to System.currentTimeMillis(), as well as unnecessary counting of the rows, etc.\n\nNumbers:\n\n{noformat}\nCurrent trunk: 44.5 seconds\nFix for counters, unchanged operator hooks: 33.5 seconds (Kevin, that's the run you asked for)\nFix for counters, removal of operator hooks: 29.3 seconds\nRemoval of both operator hooks and counters completely: 27.9 seconds\n{noformat}\n\nProposal:\n\n- Remove operator hooks and backport to 0.11 branch. That's a regression that was introduced between 0.10 and 0.11, I believe.\n- Remove profiler for now and backport to 0.11 branch. Profiler doesn't work without operator hooks right now. I'll open a jira to re-introduce profiler in a way that doesn't add any code to the inner loop (maybe hidden behind static final var that is false, so compiler removes it).\n- Counters: Change this patch to include my fix for counters and backport to 0.11. This gives us a significant boost, but isn't a regression from the last version. I'll open a jira to dig deeper and see if we can get even closer to the result with the counters completely removed.\n\nHow does that sound?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-12T10:03:31.023+0000","updated":"2013-04-12T10:03:31.023+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13630511","id":"13630511","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pamelavagata","name":"pamelavagata","key":"pamelavagata","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pamela Vagata","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for running these separately :) I just looked in OperatorHookUtils.java which is where the opHooks list is being initialized - it looks like the opHooks list is always being initialized even if there are no OperatorHooks installed. My suspicion is that if we returned null instead of an empty list, the numbers would be different since a null check should be much cheaper. Would you mind modifying OperatorHookUtils.getOperatorHooks to return null instead of an empty list and then rerun the MBM with the code for the OperatorHooks left in and also commented out to see what the difference is?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pamelavagata","name":"pamelavagata","key":"pamelavagata","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pamela Vagata","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-12T19:11:53.379+0000","updated":"2013-04-12T19:11:53.379+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13630607","id":"13630607","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"body":"[~pamelavagata]: I saw that too and I am sure it would make the numbers slightly better. There's also the issue with allocating a new object for each invocation which is probably even worse than the empty list. My point though is this: Even if we get it down to where I fixed counters too, you would still pay a price for the feature. No counters v fixed counters is still faster (see above). \n\nFrom this thread it seems that the profiler is a valuable feature for keeping taps on performance in the dev cycle, operator hooks on the other hand are not that useful. Anything you add there has a tremendously bad effect on performance.\n\nFrom that I concluded that we should change the profiler not to rely on operator hooks and also not to contribute to run time in production. The best way to me is to remove it temporarily and handle it in a new jira (where we can discuss the how in more detail).\n\nDoes that make sense?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-12T20:36:51.602+0000","updated":"2013-04-12T20:36:51.602+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13630608","id":"13630608","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"body":"Here's the patch that goes with the proposal","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-12T20:37:44.418+0000","updated":"2013-04-12T20:37:44.418+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13630637","id":"13630637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"body":"It's not clear to me that we can't cut down the cost added by operator hooks when there are no operator hooks present to the point where it does not significantly affect performance.\n\nPam, could you provide Gunther a patch which sets the list of operator hooks to null rather than the empty list, and initializes the OperatorHookContext in the calls to enterOperatorHooks and exitOperatorHooks after the check if the list is null.  This should limit the impact of operator hooks, to two method calls and two null checks.  We could even put the check if this.operatorHooks==null around the method calls themselves, in case the Java compiler isn't inlining it for some reason.\n\nIf after that, they still introduce a substantial amount of overhead, there's not much more we can do, and I'd be ok with removing operator hooks. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-12T21:17:33.894+0000","updated":"2013-04-12T21:17:33.894+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13630665","id":"13630665","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pamelavagata","name":"pamelavagata","key":"pamelavagata","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pamela Vagata","active":true,"timeZone":"America/Los_Angeles"},"body":"Will do, I'll be able to get a patch out soon","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pamelavagata","name":"pamelavagata","key":"pamelavagata","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pamela Vagata","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-12T21:43:55.227+0000","updated":"2013-04-12T21:43:55.227+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13630703","id":"13630703","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"body":"What I was trying to say is that you'll end up in the exact same place that you are with \"removing counters\" v \"fixing counters\". Two method calls, two null checks. And from my testing there *is* still overhead (29.3 v 27.9). If you think that's not a valid conclusion, I'll rerun the stuff, but otherwise we should just skip that step.\n\nAm I missing something?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-12T22:37:22.644+0000","updated":"2013-04-12T22:37:22.644+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13630814","id":"13630814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm just really surprised that a couple of null checks increase the amount of time by ~5% especially given that we do maybe 4 null checks in the FileSinkOperator's process method alone.\n\nOf course, I can't argue with facts, so if you could try such a patch once it's available and post your results I'd really appreciate it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kevinwilfong","name":"kevinwilfong","key":"kevinwilfong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin Wilfong","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-13T00:23:31.494+0000","updated":"2013-04-13T00:23:31.494+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13630820","id":"13630820","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pamelavagata","name":"pamelavagata","key":"pamelavagata","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pamela Vagata","active":true,"timeZone":"America/Los_Angeles"},"body":"I agree - I've just posted the patch, it would be great if you could post some results with this one too :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pamelavagata","name":"pamelavagata","key":"pamelavagata","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pamela Vagata","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-13T00:27:43.570+0000","updated":"2013-04-13T00:27:43.570+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13632523","id":"13632523","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"body":"I've repeated the experiments with [~pamelavagata]'s patch. Summary: Sorry, but I am *still* consistently measuring a difference.\n\nI've re-setup the experiment (didn't have the EC2 instance from last week anymore). I've setup the same data, same query, same codebase etc, but I wasn't running on the same machine, so we should be careful with comparisons between these runs and the previous ones. I did use the same method as above to get the numbers.\n\nFirst I created two builds: One by applying Pamela's patch (\"fixed hooks\") and one where I additionally commented out the operator hooks (\"no hooks\"). The results I got were:\n\nno hooks: 44.4 seconds\nfixed hooks: 46.2 seconds\n\nThen I created two more builds: One by applying Pamela's patch and commenting out the counters (\"fixed hooks no counters\") and one by commenting out both the operator hoos and the counters (\"no hooks no counters\"). The result I got was:\n\nno hooks no counters: 29.6 seconds\nfixed hooks no counters: 32.3 seconds","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-16T03:01:39.174+0000","updated":"2013-04-16T03:01:39.174+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13634350","id":"13634350","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"body":"[~kevinwilfong]/[~pamelavagata]: Given the latest run, are you ok with the proposal, or do you have another suggestion?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-17T19:44:53.480+0000","updated":"2013-04-17T19:44:53.480+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13634621","id":"13634621","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pamelavagata","name":"pamelavagata","key":"pamelavagata","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pamela Vagata","active":true,"timeZone":"America/Los_Angeles"},"body":"Gunther, thanks for taking the time to run the patch: given the results - I'm ok with the proposal.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pamelavagata","name":"pamelavagata","key":"pamelavagata","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pamela Vagata","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-17T23:43:57.996+0000","updated":"2013-04-17T23:43:57.996+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13635527","id":"13635527","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks. I've rebased the patch and split it into two. HIVE-4378 has the changes for the counters, this one is about operator hooks/profiler. This way I am hoping it's easier to start the work on re-introducing the profiler, because only relevant changes are captured in this patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hagleitn","name":"hagleitn","key":"hagleitn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hagleitn&avatarId=16035","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hagleitn&avatarId=16035","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hagleitn&avatarId=16035","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hagleitn&avatarId=16035"},"displayName":"Gunther Hagleitner","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-18T18:55:24.209+0000","updated":"2013-04-18T18:55:24.209+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13635922","id":"13635922","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 will commit if tests pass.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-19T01:21:18.338+0000","updated":"2013-04-19T01:21:18.338+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13637103","id":"13637103","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to trunk. Thanks, Gunther!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ashutoshc","name":"ashutoshc","key":"ashutoshc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ashutosh Chauhan","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-04-20T03:33:40.886+0000","updated":"2013-04-20T03:33:40.886+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13637323","id":"13637323","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hive-trunk-hadoop2 #167 (See [https://builds.apache.org/job/Hive-trunk-hadoop2/167/])\n    HIVE-4318 : OperatorHooks hit performance even when not used (Gunther Hagleitner via Ashutosh Chauhan) (Revision 1470101)\n\n     Result = FAILURE\nhashutosh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1470101\nFiles : \n* /hive/trunk/build-common.xml\n* /hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n* /hive/trunk/conf/hive-default.xml.template\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecMapper.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorHook.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorHookContext.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorHookUtils.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfilePublisher.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfilePublisherInfo.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfiler.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfilerAggregateStat.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfilerConnectionInfo.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfilerStats.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfilerStatsAggregator.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfilerUtils.java\n* /hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TstOperatorHook.java\n* /hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TstOperatorHookUtils.java\n* /hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/hooks/HiveProfilerResultsHook.java\n* /hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/hooks/PostTestOperatorHook.java\n* /hive/trunk/ql/src/test/queries/clientpositive/hiveprofiler0.q\n* /hive/trunk/ql/src/test/queries/clientpositive/hiveprofiler_script0.q\n* /hive/trunk/ql/src/test/queries/clientpositive/hiveprofiler_union0.q\n* /hive/trunk/ql/src/test/queries/clientpositive/operatorhook.q\n* /hive/trunk/ql/src/test/results/clientpositive/hiveprofiler0.q.out\n* /hive/trunk/ql/src/test/results/clientpositive/hiveprofiler_script0.q.out\n* /hive/trunk/ql/src/test/results/clientpositive/hiveprofiler_union0.q.out\n* /hive/trunk/ql/src/test/results/clientpositive/operatorhook.q.out\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-20T19:09:55.542+0000","updated":"2013-04-20T19:09:55.542+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12641535/comment/13637514","id":"13637514","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hive-trunk-h0.21 #2072 (See [https://builds.apache.org/job/Hive-trunk-h0.21/2072/])\n    HIVE-4318 : OperatorHooks hit performance even when not used (Gunther Hagleitner via Ashutosh Chauhan) (Revision 1470101)\n\n     Result = ABORTED\nhashutosh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1470101\nFiles : \n* /hive/trunk/build-common.xml\n* /hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n* /hive/trunk/conf/hive-default.xml.template\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecMapper.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ExecReducer.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorHook.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorHookContext.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorHookUtils.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfilePublisher.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfilePublisherInfo.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfiler.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfilerAggregateStat.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfilerConnectionInfo.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfilerStats.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfilerStatsAggregator.java\n* /hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/profiler/HiveProfilerUtils.java\n* /hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TstOperatorHook.java\n* /hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/exec/TstOperatorHookUtils.java\n* /hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/hooks/HiveProfilerResultsHook.java\n* /hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/hooks/PostTestOperatorHook.java\n* /hive/trunk/ql/src/test/queries/clientpositive/hiveprofiler0.q\n* /hive/trunk/ql/src/test/queries/clientpositive/hiveprofiler_script0.q\n* /hive/trunk/ql/src/test/queries/clientpositive/hiveprofiler_union0.q\n* /hive/trunk/ql/src/test/queries/clientpositive/operatorhook.q\n* /hive/trunk/ql/src/test/results/clientpositive/hiveprofiler0.q.out\n* /hive/trunk/ql/src/test/results/clientpositive/hiveprofiler_script0.q.out\n* /hive/trunk/ql/src/test/results/clientpositive/hiveprofiler_union0.q.out\n* /hive/trunk/ql/src/test/results/clientpositive/operatorhook.q.out\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-04-21T09:24:01.482+0000","updated":"2013-04-21T09:24:01.482+0000"}],"maxResults":25,"total":25,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-4318/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1jjrb:"}}