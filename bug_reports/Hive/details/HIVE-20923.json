{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13198580","self":"https://issues.apache.org/jira/rest/api/2/issue/13198580","key":"HIVE-20923","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2018-11-15T11:29:50.618+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Nov 19 08:18:36 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_125803579_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-11-16T21:20:47.725+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-20923/watchers","watchCount":3,"isWatching":false},"created":"2018-11-15T10:24:04.187+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-11-19T08:18:36.454+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12324798","id":"12324798","name":"Query Planning"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12327562","id":"12327562","name":"Test"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12317406","id":"12317406","name":"Tests"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12317304","id":"12317304","name":"Views"}],"timeoriginalestimate":null,"description":"It appears this qtest expects the wrong behavior, and should fail but doesn't.\r\n\r\nBelow Queries 3 and 4 should not include default@src as Input \r\n\r\nQuery 1\r\n{noformat}\r\nPREHOOK: query: create table `masking_test_subq_n1` as select cast(key as int) as key, value from src\r\nPREHOOK: type: CREATETABLE_AS_SELECT\r\nPREHOOK: Input: default@src\r\nPREHOOK: Output: database:default\r\nPREHOOK: Output: default@masking_test_subq_n1\r\nPOSTHOOK: query: create table `masking_test_subq_n1` as select cast(key as int) as key, value from src\r\nPOSTHOOK: type: CREATETABLE_AS_SELECT\r\nPOSTHOOK: Input: default@src\r\nPOSTHOOK: Output: database:default\r\nPOSTHOOK: Output: default@masking_test_subq_n1\r\nPOSTHOOK: Lineage: masking_test_subq_n1.key EXPRESSION [(src)src.FieldSchema(name:key, type:string, comment:default), ]\r\nPOSTHOOK: Lineage: masking_test_subq_n1.value SIMPLE [(src)src.FieldSchema(name:value, type:string, comment:default), ]{noformat}\r\nQuery 2\r\n{noformat}\r\nPREHOOK: query: create view `v1_n9` as select * from `masking_test_subq_n1`\r\nPREHOOK: type: CREATEVIEW\r\nPREHOOK: Input: default@masking_test_subq_n1\r\nPREHOOK: Output: database:default\r\nPREHOOK: Output: default@v1_n9\r\nPOSTHOOK: query: create view `v1_n9` as select * from `masking_test_subq_n1`\r\nPOSTHOOK: type: CREATEVIEW\r\nPOSTHOOK: Input: default@masking_test_subq_n1\r\nPOSTHOOK: Output: database:default\r\nPOSTHOOK: Output: default@v1_n9\r\nPOSTHOOK: Lineage: v1_n9.key SIMPLE [(masking_test_subq_n1)masking_test_subq_n1.FieldSchema(name:key, type:int, comment:null), ]\r\nPOSTHOOK: Lineage: v1_n9.value SIMPLE [(masking_test_subq_n1)masking_test_subq_n1.FieldSchema(name:value, type:string, comment:null), ]\r\n{noformat}\r\nQuery 3 (the explain output here describes a TableScan on table src)\r\n{noformat}\r\nPREHOOK: query: explain\r\nselect * from `v1_n9`\r\nlimit 20\r\nPREHOOK: type: QUERY\r\nPREHOOK: Input: default@masking_test_subq_n1\r\nPREHOOK: Input: default@src\r\nPREHOOK: Input: default@v1_n9\r\n#### A masked pattern was here ####\r\nPOSTHOOK: query: explain\r\nselect * from `v1_n9`\r\nlimit 20\r\nPOSTHOOK: type: QUERY\r\nPOSTHOOK: Input: default@masking_test_subq_n1\r\nPOSTHOOK: Input: default@src\r\nPOSTHOOK: Input: default@v1_n9\r\n{noformat}\r\nQuery 4\r\n{noformat}\r\nPREHOOK: query: select * from `v1_n9`\r\nlimit 20\r\nPREHOOK: type: QUERY\r\nPREHOOK: Input: default@masking_test_subq_n1\r\nPREHOOK: Input: default@src\r\nPREHOOK: Input: default@v1_n9\r\n#### A masked pattern was here ####\r\nPOSTHOOK: query: select * from `v1_n9`\r\nlimit 20\r\nPOSTHOOK: type: QUERY\r\nPOSTHOOK: Input: default@masking_test_subq_n1\r\nPOSTHOOK: Input: default@src\r\nPOSTHOOK: Input: default@v1_n9\r\n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"masking_12 qtest expects wrong inputs","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=klcopp","name":"klcopp","key":"klcopp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"Karen Coppage","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=klcopp","name":"klcopp","key":"klcopp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"Karen Coppage","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13198580/comment/16687773","id":"16687773","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=klcopp","name":"klcopp","key":"klcopp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"Karen Coppage","active":true,"timeZone":"Etc/UTC"},"body":"[~daijy] since you exposed this problem, and [~jcamachorodriguez] since you created the test, and [~ychena]: Can you tell me if I am incorrect, and if not then any insights into what the issue might be? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=klcopp","name":"klcopp","key":"klcopp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"Karen Coppage","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-15T10:31:06.897+0000","updated":"2018-11-15T10:31:06.897+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13198580/comment/16687877","id":"16687877","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"body":"[~klcopp], I think you are right, default@src should not be the input for query select * from `v1_n9` .\r\nThe issue might be CTAS' dependencies (input) should only be checked when parse the CTAS statement (itself), it should not be checked when the created table used in other queries. The issue looks like masking_test_subq_n1 is checked as part of  CTAS in the query, but should not: it is only an ordinary table.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ychena","name":"ychena","key":"ychena","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yongzhi Chen","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-15T11:29:50.618+0000","updated":"2018-11-15T11:29:50.618+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13198580/comment/16688553","id":"16688553","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcamachorodriguez","name":"jcamachorodriguez","key":"jcamachorodriguez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jesus Camacho Rodriguez","active":true,"timeZone":"America/Los_Angeles"},"body":"[~klcopp], this does not seem to be a bug, as behavior conforms with the masking policies defined for the test: https://github.com/apache/hive/blob/6340a81f487c407f63cf2a00e39b2f905328d74e/itests/util/src/main/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAuthorizationValidatorForTest.java#L146\r\nExplain plan should shed more light into what is going on underneath.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcamachorodriguez","name":"jcamachorodriguez","key":"jcamachorodriguez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jesus Camacho Rodriguez","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-11-15T19:33:35.116+0000","updated":"2018-11-15T19:33:35.116+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13198580/comment/16690017","id":"16690017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcamachorodriguez","name":"jcamachorodriguez","key":"jcamachorodriguez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jesus Camacho Rodriguez","active":true,"timeZone":"America/Los_Angeles"},"body":"Closing as not a problem, please reopen if you still believe this is an issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jcamachorodriguez","name":"jcamachorodriguez","key":"jcamachorodriguez","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jesus Camacho Rodriguez","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-11-16T21:20:47.747+0000","updated":"2018-11-16T21:20:47.747+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13198580/comment/16691371","id":"16691371","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=klcopp","name":"klcopp","key":"klcopp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"Karen Coppage","active":true,"timeZone":"Etc/UTC"},"body":"Thank you, [~jcamachorodriguez] and [~ychena] for answering, this was enlightening :) ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=klcopp","name":"klcopp","key":"klcopp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"Karen Coppage","active":true,"timeZone":"Etc/UTC"},"created":"2018-11-19T08:18:36.454+0000","updated":"2018-11-19T08:18:36.454+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-20923/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|s00iwo:"}}