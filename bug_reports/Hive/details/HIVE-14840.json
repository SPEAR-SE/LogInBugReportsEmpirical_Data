{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13007582","self":"https://issues.apache.org/jira/rest/api/2/issue/13007582","key":"HIVE-14840","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310843","id":"12310843","key":"HIVE","name":"Hive","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-09-26T19:03:35.046+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Nov 03 13:47:05 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-14840/watchers","watchCount":4,"isWatching":false},"created":"2016-09-26T13:59:35.649+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":["hive"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332384","id":"12332384","name":"1.2.1","archived":false,"released":true,"releaseDate":"2015-06-26"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-11-16T13:56:19.850+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12325007","id":"12325007","name":"Hive"}],"timeoriginalestimate":null,"description":"Hi,\n  There's is a bug while running MSCK REPAIR TABLE EXTERNAL_TABLE_NAME on Hive 1.2.1, all the partition that are not present in the metastore are being listed but not added if the partition names are not in lowercase, in other words if an external path has a camel case based name and value i.e s3n://some_external_path/myPartition=01 it just gets listed as partition not found in metastore but doesnâ€™t add it.\n\nHowever, am not able to run ALTER TABLE MY_EXTERNAL_TABLE RECOVER PARTITIONS; on hive 1.2 and based on the source code from hive-exec am able to see under org/apache/hadoop/hive/ql/parse/HiveParser.g:1001:1 that there's no token matching in the grammar for RECOVER PARTITIONS.\n\nExample:\n\n- When external path = s3n://some_external_path/myPartition=01\n\n       hive> MSCK REPAIR TABLE my_external_table;\n       Partitions not in metastore: my_external_table:mypartition=01\n       Time taken: 1.729 seconds, Fetched: 2 row(s)\n\n        hive> show partitions foster.ola_raven_raven_users_raw;\n        OK\n        Time taken: 0.901 seconds, Fetched: 0 row(s)\n\n- When external path = s3n://some_external_path/mypartition=01\n\n        hive> MSCK REPAIR TABLE my_external_table;\n        Partitions not in metastore: my_external_table:mypartition=01\n        Repair: Added partition to metastore my_external_table:mypartition=01\n        Time taken: 1.729 seconds, Fetched: 2 row(s)\n\n         hive> show partitions my_external_table;\n         OK\n         mypartition=01\n         Time taken: 1.101 seconds, Fetched: 1 row(s)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"MSCK not adding the missing partitions to Hive Metastore when the partition names are not in lowercase","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Sushil-K-S","name":"Sushil-K-S","key":"sushil-k-s","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sushil Ks","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Sushil-K-S","name":"Sushil-K-S","key":"sushil-k-s","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sushil Ks","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13007582/comment/15523902","id":"15523902","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"body":"This is by design if the FS is case sensitive iirc. Metastore won't be able to find this partition later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sershe","name":"sershe","key":"sershe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sergey Shelukhin","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-09-26T19:03:35.046+0000","updated":"2016-09-26T19:03:35.046+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13007582/comment/15525288","id":"15525288","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Sushil-K-S","name":"Sushil-K-S","key":"sushil-k-s","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sushil Ks","active":true,"timeZone":"Etc/UTC"},"body":"But through DDL CREATE EXTERNAL statement when we have case sensitive partition names, everything is being treated as lowercase(verified from SHOW CREATE TABLE) right? so shouldn't the case sensitive partition names when adding to metastore be also be converted to lowercase and repaired?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Sushil-K-S","name":"Sushil-K-S","key":"sushil-k-s","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sushil Ks","active":true,"timeZone":"Etc/UTC"},"created":"2016-09-27T06:54:24.774+0000","updated":"2016-09-27T06:54:24.774+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13007582/comment/15632759","id":"15632759","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Sushil-K-S","name":"Sushil-K-S","key":"sushil-k-s","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sushil Ks","active":true,"timeZone":"Etc/UTC"},"body":"[~sershe] Hey, since this is due to FS case sensitivity , am planning to move this ticket as an improvement where I am thinking of adding the partitions that are not in Metastore as follows :\n\nFor all the partitions that are not in Metastore from MSCK:\n  - check if the partition name matches with the name stored in the Metastore ignoring the case \n     - if matches add to a temporary list else ignore that path\n\nFinally bulk add all the partitions from the temporary list to Metastore with the case-sensitive path corresponding to that parition as location\n\nKindly, give me your suggestion. \n   ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Sushil-K-S","name":"Sushil-K-S","key":"sushil-k-s","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sushil Ks","active":true,"timeZone":"Etc/UTC"},"created":"2016-11-03T13:47:05.194+0000","updated":"2016-11-03T13:47:59.562+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HIVE-14840/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i342wn:"}}