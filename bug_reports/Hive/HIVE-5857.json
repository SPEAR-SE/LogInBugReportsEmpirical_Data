{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kawaa&avatarId=22332",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kawaa&avatarId=22332",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kawaa&avatarId=22332",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kawaa&avatarId=22332"
            },
            "displayName": "Adam Kawa",
            "key": "kawaa",
            "name": "kawaa",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=kawaa",
            "timeZone": "Etc/UTC"
        },
        "components": [{
            "description": "Tracks issues dealing with query processing.",
            "id": "12312586",
            "name": "Query Processor",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12312586"
        }],
        "created": "2013-11-20T01:12:54.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kawaa&avatarId=22332",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kawaa&avatarId=22332",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kawaa&avatarId=22332",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kawaa&avatarId=22332"
            },
            "displayName": "Adam Kawa",
            "key": "kawaa",
            "name": "kawaa",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=kawaa",
            "timeZone": "Etc/UTC"
        },
        "customfield_10010": null,
        "customfield_12310191": null,
        "customfield_12310192": null,
        "customfield_12310220": "2013-11-20T18:34:41.715+0000",
        "customfield_12310222": "3_*:*_1_*:*_22873_*|*_10002_*:*_4_*:*_23571285011_*|*_1_*:*_3_*:*_1373767893_*|*_5_*:*_1_*:*_0",
        "customfield_12310230": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "4.0",
        "customfield_12310320": null,
        "customfield_12310420": "359428",
        "customfield_12310920": "359727",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i1pyn3:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Thu Sep 04 18:24:10 UTC 2014",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "A Hive query fails when it tries to run a reduce task in uber mode in YARN.\n\nThe NullPointerException is thrown in the ExecReducer.configure method, because the plan file (reduce.xml) for a reduce task is not found.\n\nThe Utilities.getBaseWork method is expected to return BaseWork object, but it returns NULL due to FileNotFoundException. \n{code}\n// org.apache.hadoop.hive.ql.exec.Utilities\npublic static BaseWork getBaseWork(Configuration conf, String name) {\n  ...\n    try {\n    ...\n      if (gWork == null) {\n        Path localPath;\n        if (ShimLoader.getHadoopShims().isLocalMode(conf)) {\n          localPath = path;\n        } else {\n          localPath = new Path(name);\n        }\n        InputStream in = new FileInputStream(localPath.toUri().getPath());\n        BaseWork ret = deserializePlan(in);\n        ....\n      }\n      return gWork;\n    } catch (FileNotFoundException fnf) {\n      // happens. e.g.: no reduce work.\n      LOG.debug(\"No plan file found: \"+path);\n      return null;\n    } ...\n}\n{code}\n\nIt happens because, the ShimLoader.getHadoopShims().isLocalMode(conf)) method returns true, because immediately before running a reduce task, org.apache.hadoop.mapred.LocalContainerLauncher changes its configuration to local mode (\"mapreduce.framework.name\" is changed from\" \"yarn\" to \"local\"). On the other hand map tasks run successfully, because its configuration is not changed and still remains \"yarn\".\n\n{code}\n// org.apache.hadoop.mapred.LocalContainerLauncher\nprivate void runSubtask(..) {\n  ...\n  conf.set(MRConfig.FRAMEWORK_NAME, MRConfig.LOCAL_FRAMEWORK_NAME);\n  conf.set(MRConfig.MASTER_ADDRESS, \"local\");  // bypass shuffle\n\n  ReduceTask reduce = (ReduceTask)task;\n  reduce.setConf(conf);          \n\n  reduce.run(conf, umbilical);\n}\n{code}\n\nA super quick fix could just an additional if-branch, where we check if we run a reduce task in uber mode, and then look for a plan file in a different location.\n\n*Java stacktrace*\n\n{code}\n2013-11-20 00:50:56,862 INFO [uber-SubtaskRunner] org.apache.hadoop.hive.ql.exec.Utilities: No plan file found: hdfs://namenode.c.lon.spotify.net:54310/var/tmp/kawaa/hive_2013-11-20_00-50-43_888_3938384086824086680-2/-mr-10003/e3caacf6-15d6-4987-b186-d2906791b5b0/reduce.xml\n2013-11-20 00:50:56,862 WARN [uber-SubtaskRunner] org.apache.hadoop.mapred.LocalContainerLauncher: Exception running local (uberized) 'child' : java.lang.RuntimeException: Error in configuring object\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:109)\n\tat org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:75)\n\tat org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:133)\n\tat org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:427)\n\tat org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:408)\n\tat org.apache.hadoop.mapred.LocalContainerLauncher$SubtaskRunner.runSubtask(LocalContainerLauncher.java:340)\n\tat org.apache.hadoop.mapred.LocalContainerLauncher$SubtaskRunner.run(LocalContainerLauncher.java:225)\n\tat java.lang.Thread.run(Thread.java:662)\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:106)\n\t... 7 more\nCaused by: java.lang.NullPointerException\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.configure(ExecReducer.java:116)\n\t... 12 more\n\n2013-11-20 00:50:56,862 INFO [uber-SubtaskRunner] org.apache.hadoop.mapred.TaskAttemptListenerImpl: Status update from attempt_1384392632998_34791_r_000000_0\n2013-11-20 00:50:56,862 INFO [uber-SubtaskRunner] org.apache.hadoop.mapred.TaskAttemptListenerImpl: Progress of TaskAttempt attempt_1384392632998_34791_r_000000_0 is : 0.0\n2013-11-20 00:50:56,862 INFO [uber-SubtaskRunner] org.apache.hadoop.mapred.Task: Runnning cleanup for the task\n2013-11-20 00:50:56,863 INFO [uber-SubtaskRunner] org.apache.hadoop.mapred.TaskAttemptListenerImpl: Diagnostics report from attempt_1384392632998_34791_r_000000_0: java.lang.RuntimeException: Error in configuring object\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:109)\n\tat org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:75)\n\tat org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:133)\n\tat org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:427)\n\tat org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:408)\n\tat org.apache.hadoop.mapred.LocalContainerLauncher$SubtaskRunner.runSubtask(LocalContainerLauncher.java:340)\n\tat org.apache.hadoop.mapred.LocalContainerLauncher$SubtaskRunner.run(LocalContainerLauncher.java:225)\n\tat java.lang.Thread.run(Thread.java:662)\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:106)\n\t... 7 more\nCaused by: java.lang.NullPointerException\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.configure(ExecReducer.java:116)\n\t... 12 more\n\n2013-11-20 00:50:56,863 INFO [uber-SubtaskRunner] org.apache.hadoop.mapred.LocalContainerLauncher: Processing the event EventType: CONTAINER_REMOTE_CLEANUP for container container_1384392632998_34791_01_000001 taskAttempt attempt_1384392632998_34791_m_000000_0\n2013-11-20 00:50:56,863 INFO [AsyncDispatcher event handler] org.apache.hadoop.mapreduce.v2.app.job.impl.TaskAttemptImpl: Diagnostics report from attempt_1384392632998_34791_r_000000_0: java.lang.RuntimeException: Error in configuring object\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:109)\n\tat org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:75)\n\tat org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:133)\n\tat org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:427)\n\tat org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:408)\n\tat org.apache.hadoop.mapred.LocalContainerLauncher$SubtaskRunner.runSubtask(LocalContainerLauncher.java:340)\n\tat org.apache.hadoop.mapred.LocalContainerLauncher$SubtaskRunner.run(LocalContainerLauncher.java:225)\n\tat java.lang.Thread.run(Thread.java:662)\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:106)\n\t... 7 more\nCaused by: java.lang.NullPointerException\n\tat org.apache.hadoop.hive.ql.exec.mr.ExecReducer.configure(ExecReducer.java:116)\n\t... 12 more\n{code}\n",
        "duedate": null,
        "environment": null,
        "fixVersions": [{
            "archived": false,
            "description": "released",
            "id": "12324986",
            "name": "0.13.0",
            "releaseDate": "2014-04-21",
            "released": true,
            "self": "https://issues.apache.org/jira/rest/api/2/version/12324986"
        }],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [
            "plan",
            "uber-jar",
            "uberization",
            "yarn"
        ],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/critical.svg",
            "id": "2",
            "name": "Critical",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/2"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935"
            },
            "id": "12310843",
            "key": "HIVE",
            "name": "Hive",
            "projectCategory": {
                "description": "Scalable Distributed Computing",
                "id": "10292",
                "name": "Hadoop",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10292"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12310843"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kawaa&avatarId=22332",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kawaa&avatarId=22332",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kawaa&avatarId=22332",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kawaa&avatarId=22332"
            },
            "displayName": "Adam Kawa",
            "key": "kawaa",
            "name": "kawaa",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=kawaa",
            "timeZone": "Etc/UTC"
        },
        "resolution": {
            "description": "A fix for this issue is checked into the tree and tested.",
            "id": "1",
            "name": "Fixed",
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1"
        },
        "resolutiondate": "2014-09-04T18:24:10.000+0000",
        "status": {
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "id": "5",
            "name": "Resolved",
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "statusCategory": {
                "colorName": "green",
                "id": 3,
                "key": "done",
                "name": "Done",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3"
            }
        },
        "subtasks": [],
        "summary": "Reduce tasks do not work in uber mode in YARN",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2014-09-04T18:24:10.000+0000",
        "versions": [
            {
                "archived": false,
                "description": "released",
                "id": "12324312",
                "name": "0.12.0",
                "releaseDate": "2013-10-15",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12324312"
            },
            {
                "archived": false,
                "description": "released",
                "id": "12324986",
                "name": "0.13.0",
                "releaseDate": "2014-04-21",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12324986"
            },
            {
                "archived": false,
                "description": "0.13 maintenance release 1",
                "id": "12326829",
                "name": "0.13.1",
                "releaseDate": "2014-06-06",
                "released": true,
                "self": "https://issues.apache.org/jira/rest/api/2/version/12326829"
            }
        ],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-5857/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-5857/watchers",
            "watchCount": 8
        },
        "workratio": -1
    },
    "id": "12680071",
    "key": "HIVE-5857",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/12680071"
}