[+1 for this one.. We have 350 nodes so they span two subnets/VLANs, but we forward the Ganglia multicast between them. We just upgraded to CDH5 (Hadoop 2.5) and now we've lost our Ganglia metrics for half of the cluster (because the TTL is set to 1) depending on which half of the cluster you ask (as they will not span the two subnets) 

(Given we now have a tonne of missing metrics I would say this is more than Minor, as the alternative is use Unicast Ganglia and that is not ideal for other reasons) , We've been running the attached patch in our production cluster for a few days now.  It has fixed the issue., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12693319/HADOOP-10181.001.patch
  against trunk revision c94c0d2.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:red}-1 findbugs{color}.  The patch appears to introduce 1 new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common:

                  org.apache.hadoop.ha.TestZKFailoverController

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/5434//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/5434//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/5434//console

This message is automatically generated., I can fix the findbugs warning, but I'm not sure what's up with that test.  It passed locally for me., This fixes the findbugs warning from the previous patch., I can get the same test timeout locally, but it happens both with and without my patch.  I don't think it's related., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12693340/HADOOP-10181.002.patch
  against trunk revision c94c0d2.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common:

                  org.apache.hadoop.ha.TestZKFailoverController

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/5436//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/5436//console

This message is automatically generated., Hi, [~ajsquared].  Thank you for providing this patch.  This mostly looks good to me.  Here are a few minor comments:

# It appears the existing strategy for validation of configuration input in this class is to use a default if the property is unspecified, but let it throw {{NumberFormatException}} if there is a value specified, and it is non-numeric.  (For example, see {{getDmax}}.)  While perhaps not ideal, it's probably best to keep the validation handling consistent for the new property.
# It's odd that the existing exception handling code used {{printStackTrace}} even though a logger is available.  Even though it's not directly related to your patch, let's take this opportunity to change it to use the {{LOG}}.
# Thank you for updating package.html too.

The test failure reported by Jenkins is unrelated.  I confirmed that the test passes locally for me.

I also reviewed {{GangliaContext31}} (unchanged in this patch) and it appears the subclass will work just fine with your changes in the base class.

I'll be +1 after points 1 and 2 above are addressed.  However, this is my first time looking at this part of the codebase.  I'd prefer if we could get one more review by someone who has experience with this code before I commit it.  [~tucu00] and [~tlipcon], I noticed your names in the change log.  Are you interested in reviewing?, Thanks for the feedback, [~cnauroth]!  I've submitted a new patch to address your comments., {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12694776/HADOOP-10181.003.patch
  against trunk revision 0da53a3.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-common.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/5507//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/5507//console

This message is automatically generated., +1 for patch v003.  Andrew, thank you for addressing the feedback.

I plan to wait until Monday, 2/2, to commit this, in case any committer who has prior experience with this code also wants to review., SUCCESS: Integrated in Hadoop-trunk-Commit #6979 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/6979/])
HADOOP-10181. GangliaContext does not work with multicast ganglia setup. Contributed by Andrew Johnson. (cnauroth: rev 8004a002307940176cc188657c68e85171a5b5a8)
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics/ganglia/GangliaContext.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/sink/ganglia/AbstractGangliaSink.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/sink/ganglia/TestGangliaSink.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics/ganglia/TestGangliaContext.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics/ganglia/package.html
, I committed this to trunk and branch-2.  Andrew, thank you for contributing this patch., Great, thanks!, FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #93 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/93/])
HADOOP-10181. GangliaContext does not work with multicast ganglia setup. Contributed by Andrew Johnson. (cnauroth: rev 8004a002307940176cc188657c68e85171a5b5a8)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics/ganglia/GangliaContext.java
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics/ganglia/TestGangliaContext.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/sink/ganglia/AbstractGangliaSink.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/sink/ganglia/TestGangliaSink.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics/ganglia/package.html
, SUCCESS: Integrated in Hadoop-Yarn-trunk #827 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/827/])
HADOOP-10181. GangliaContext does not work with multicast ganglia setup. Contributed by Andrew Johnson. (cnauroth: rev 8004a002307940176cc188657c68e85171a5b5a8)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/sink/ganglia/TestGangliaSink.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics/ganglia/GangliaContext.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics/ganglia/package.html
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/sink/ganglia/AbstractGangliaSink.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics/ganglia/TestGangliaContext.java
* hadoop-common-project/hadoop-common/CHANGES.txt
, FAILURE: Integrated in Hadoop-Hdfs-trunk #2025 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2025/])
HADOOP-10181. GangliaContext does not work with multicast ganglia setup. Contributed by Andrew Johnson. (cnauroth: rev 8004a002307940176cc188657c68e85171a5b5a8)
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/sink/ganglia/AbstractGangliaSink.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/sink/ganglia/TestGangliaSink.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics/ganglia/TestGangliaContext.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics/ganglia/package.html
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics/ganglia/GangliaContext.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #90 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/90/])
HADOOP-10181. GangliaContext does not work with multicast ganglia setup. Contributed by Andrew Johnson. (cnauroth: rev 8004a002307940176cc188657c68e85171a5b5a8)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/sink/ganglia/TestGangliaSink.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics/ganglia/TestGangliaContext.java
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics/ganglia/GangliaContext.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/sink/ganglia/AbstractGangliaSink.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics/ganglia/package.html
, FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #94 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/94/])
HADOOP-10181. GangliaContext does not work with multicast ganglia setup. Contributed by Andrew Johnson. (cnauroth: rev 8004a002307940176cc188657c68e85171a5b5a8)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics/ganglia/package.html
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics/ganglia/TestGangliaContext.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics/ganglia/GangliaContext.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/sink/ganglia/TestGangliaSink.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/sink/ganglia/AbstractGangliaSink.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #2044 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2044/])
HADOOP-10181. GangliaContext does not work with multicast ganglia setup. Contributed by Andrew Johnson. (cnauroth: rev 8004a002307940176cc188657c68e85171a5b5a8)
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/sink/ganglia/AbstractGangliaSink.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/sink/ganglia/TestGangliaSink.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics/ganglia/GangliaContext.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics/ganglia/package.html
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics/ganglia/TestGangliaContext.java
, Sorry for the late reply, I was on vacation the last few weeks. The patch looks fine to me. Thanks for reviewing and committing, Chris., [~tlipcon], no worries.  Thanks for following up.]