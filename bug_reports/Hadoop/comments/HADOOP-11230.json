[The patch replaces the sun code with code from bouncycastle. Tests in other modules are depending on hadoop-common's test-jar, and unfortunately, maven doesn't include transitive dependencies with test-jars, so I had to add the bouncycastle test dependency to a few other pom files.

I verified that all tests using {{KeyStoreTestUtil}} pass with Java 7 and Java 8 on both trunk and branch-2., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12676981/HADOOP-11230.patch
  against trunk revision 86ac0d4.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The test build failed in hadoop-hdfs-project/hadoop-hdfs-httpfs 

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4949//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4949//console

This message is automatically generated., I ran it again: https://builds.apache.org/job/PreCommit-HADOOP-Build/4963/
Looks like Jenkins kills it after 5 hours.  I think everything is fine and it's just taking so long because it's going through so many modules.  I did verify that all tests that actually use KeyStoreTestUtil succeed., Just a heads up. HADOOP-10847 was recently committed to trunk and overlaps with some of this work. , I've updated the Title and Description for this JIRA to repurpose it to fix the {{NoClassDefFoundError}} caused by HADOOP-10847, which this was originally a duplicate of., The new patch fixes the {{NoClassDefFoundError}}., +1 pending jenkins., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12679325/HADOOP-11230-2.patch
  against trunk revision 1eed102.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The test build failed in hadoop-hdfs-project/hadoop-hdfs-httpfs hadoop-hdfs-project/hadoop-hdfs hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-applicationhistoryservice 

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/5018//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/5018//console

This message is automatically generated., +1. I'll commit it shortly., I've committed the patch to trunk and branch-2. Thanks [~rkanter] for the contribution., SUCCESS: Integrated in Hadoop-trunk-Commit #6446 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/6446/])
HADOOP-11230. Add missing dependency of bouncycastle for kms, httpfs, hdfs, MR and YARN. Contributed by Robert Kanter. (wheat9: rev d794f785defe4b49905f90542cd210aa2f119dfd)
* hadoop-common-project/hadoop-kms/pom.xml
* hadoop-hdfs-project/hadoop-hdfs/pom.xml
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-applicationhistoryservice/pom.xml
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/pom.xml
* hadoop-hdfs-project/hadoop-hdfs-httpfs/pom.xml
, SUCCESS: Integrated in Hadoop-Yarn-trunk #734 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/734/])
HADOOP-11230. Add missing dependency of bouncycastle for kms, httpfs, hdfs, MR and YARN. Contributed by Robert Kanter. (wheat9: rev d794f785defe4b49905f90542cd210aa2f119dfd)
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-applicationhistoryservice/pom.xml
* hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/pom.xml
* hadoop-hdfs-project/hadoop-hdfs/pom.xml
* hadoop-hdfs-project/hadoop-hdfs-httpfs/pom.xml
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-kms/pom.xml
, FAILURE: Integrated in Hadoop-Hdfs-trunk #1923 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1923/])
HADOOP-11230. Add missing dependency of bouncycastle for kms, httpfs, hdfs, MR and YARN. Contributed by Robert Kanter. (wheat9: rev d794f785defe4b49905f90542cd210aa2f119dfd)
* hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/pom.xml
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/pom.xml
* hadoop-hdfs-project/hadoop-hdfs-httpfs/pom.xml
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-applicationhistoryservice/pom.xml
* hadoop-common-project/hadoop-kms/pom.xml
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #1948 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1948/])
HADOOP-11230. Add missing dependency of bouncycastle for kms, httpfs, hdfs, MR and YARN. Contributed by Robert Kanter. (wheat9: rev d794f785defe4b49905f90542cd210aa2f119dfd)
* hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/pom.xml
* hadoop-hdfs-project/hadoop-hdfs-httpfs/pom.xml
* hadoop-hdfs-project/hadoop-hdfs/pom.xml
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-kms/pom.xml
* hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-applicationhistoryservice/pom.xml
]