[* Undocumented. ;)
* hadoop_secure_verify_prereq is broken
* su in hadoop_start_secure_daemon_wrapper assumes privilege
* priv and non-priv out and pid files are swapped?
* jsvc should set -java-home, Fixed hadoop_secure_verify_prereq as part of HADOOP-11052., pid files are still a bit wacky but investigation into them post- HADOOP-11055 seems to show they are doing the correct thing in the daemon, non-daemon, and jsvc cases.  , For documentation, an example showing how to use HADOOP_SECURE_COMMAND to run the datanode, etc, securely as the hdfs user would be good to have... but it's too much to put into hadoop-user-functions.sh, etc.  So it might be worthwhile to have a "shell environment user's guide" to cover this as an advance topic as well as cover just general shell function replacement.  (Big message: this stuff is still unstable, risking your own data, etc, etc.)

Since this JIRA was filed, a lot of related fixes have gone in (esp the verify_prereq fix), so my quick 'n dirty sudo test works well in non-daemonized-daemon mode under some specific conditions (JAVA_HOME defined, etc).  It isn't quite as clean it should be, primarily due to do hadoop_start_secure_daemon_wrapper.  But progress!
, Is HADOOP_SECURE_COMMAND used at all? After HADOOP-13673 the only usage is in {{hadoop_verify_secure_prereq}}. Even if it is set we will never read its value.
, It's used when user provided functions replace jsvc.  e.g., on Solaris, one could define a role that allows the datanode to run on a privileged port without actually running as root just by launching it with pfexec.  It's also possible to use this to launch the datanode via sudo such that you don't actually need to be root to use jsvc.  In all these cases, the system needs to do things differently because jsvc+root aren't being used.

The code has changed quite a bit since I last tested this, so I should probably sit down and write it up again.
]