[The code is working correctly and there are substantial problems with changing it.]