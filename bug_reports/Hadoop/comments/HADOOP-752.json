[
DFSNodesStatus() locks 'heartBeats' and 'datanodeMap'.  As you noted these are not locked in registerDatanode().

I think we should have explicitly stated policy about the locking, which locks are held to protect which state. This will help anyone writing new code or reading the code.
, Added locking to setReplication, datanodeReport & DFSNodesStatus, Added locking to setReplication(), datanodeReport & DFSNodesStatus, +1, http://issues.apache.org/jira/secure/attachment/12346375/namenodelocking.patch applied and successfully tested against trunk revision 482393, I just committed this.  Thanks, Dhruba!]