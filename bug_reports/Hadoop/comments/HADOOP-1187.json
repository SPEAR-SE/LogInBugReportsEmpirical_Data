[Hairong is adding map for hostname to datanode map. Would that help?
, It could help. But if we store it in the pendingCreates, then we avoid this lookup completely.

, A reference to the client's datanode descriptor is stored in pendingCreates. This avoids a hash-lookup in getAdditionalBlock., +1 The code looks good., Merged with latest code., +1, because http://issues.apache.org/jira/secure/attachment/12354888/clientPendingCreate2.patch applied and successfully tested against trunk revision http://svn.apache.org/repos/asf/lucene/hadoop/trunk/525290. Results are at http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch, I've just committed this. Thanks Dhruba!, Integrated in Hadoop-Nightly #48 (See http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Nightly/48/)]