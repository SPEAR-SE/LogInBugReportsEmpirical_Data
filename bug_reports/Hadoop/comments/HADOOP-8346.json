[Let's revert and re-open HADOOP-6941 since that's dependent on other changes that are not yet complete anyway., I'll take a look at this..
@Alejandro, can you please provide some more detail if you have on where the extra element to the principal is getting added.  Thanks!, @Devaraj,

trunk, *KerberosAuthenticator* class, line 200. The *servicePrincipal* var is 'HTTP/localhost' and if you inspect the created GSSName object you'll find that internally it become 'HTTP/localhost/<CURRENTHOSTNAME>'. Attached you'll see a debug session of it.

To run the Kerberos testcases in hadoop-auth I do the following:

create a test.properties file in hadoop-auth/ with the following contents:


{code}
httpfs.authentication.type=kerberos
httpfs.authentication.kerberos.principal=HTTP/localhost@LOCALHOST
httpfs.authentication.kerberos.keytab=/Users/tucu/httpfs.keytab
{code}

assumes your realm is LOCALHOST, your SPNEGO principal for httpfs is HTTP/localhost and the keytab has that principal in it. also you have to kinit with a user. Then run

{code}
mvn test -PtestKerberos -Dtest=TestKerberosAuthenticator
{code}, Reverted back to original oid names., Alejandro, can you please check whether the tests pass with this patch. Thanks!, Test passes in a Sun based JVM

+1. Looks good, just a couple of NITs/suggestions:

* KerberosAuthentication.java has an unused import 'import java.lang.reflect.Field;'
* KerberosUtil.java, getOidInstance() the if/else for IBM JVM's, should this check also for Sun in an ifelse and have a follow up else that that throws an exception? Also why the first 2 parameters of getOidInstance() method?, they don't seem used
, Patch with some of the nits from Alejandro addressed. Currently, everywhere we just check for IBM's JDK and in the 'else' part we assume Oracle's. I agree that its better to do an explicit check for Oracle's but I think that can be a follow up (change everywhere in one sweep)., +1, tested again with Sun JVM, still works :), Thanks, Devaraj.  Please commit to branch-1 and branch-1.0., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12525464/8346-trunk.patch
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 1 new or modified test files.

    -1 javadoc.  The javadoc tool appears to have generated 2 warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed unit tests in hadoop-common-project/hadoop-auth.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/928//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/928//console

This message is automatically generated., Integrated in Hadoop-Hdfs-trunk-Commit #2253 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/2253/])
    HADOOP-8346. Makes oid changes to make SPNEGO work. Was broken due to fixes introduced by the IBM JDK compatibility patch. Contributed by Devaraj Das. (Revision 1333557)

     Result = SUCCESS
ddas : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1333557
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/client/KerberosAuthenticator.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/util/KerberosUtil.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/server/TestKerberosAuthenticationHandler.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
, Integrated in Hadoop-Common-trunk-Commit #2179 (See [https://builds.apache.org/job/Hadoop-Common-trunk-Commit/2179/])
    HADOOP-8346. Makes oid changes to make SPNEGO work. Was broken due to fixes introduced by the IBM JDK compatibility patch. Contributed by Devaraj Das. (Revision 1333557)

     Result = SUCCESS
ddas : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1333557
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/client/KerberosAuthenticator.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/util/KerberosUtil.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/server/TestKerberosAuthenticationHandler.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
, Committed everywhere. Thanks, Alejandro for the test help., Integrated in Hadoop-Mapreduce-trunk-Commit #2197 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/2197/])
    HADOOP-8346. Makes oid changes to make SPNEGO work. Was broken due to fixes introduced by the IBM JDK compatibility patch. Contributed by Devaraj Das. (Revision 1333557)

     Result = ABORTED
ddas : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1333557
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/client/KerberosAuthenticator.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/util/KerberosUtil.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/server/TestKerberosAuthenticationHandler.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
, Integrated in Hadoop-Hdfs-trunk #1034 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1034/])
    HADOOP-8346. Makes oid changes to make SPNEGO work. Was broken due to fixes introduced by the IBM JDK compatibility patch. Contributed by Devaraj Das. (Revision 1333557)

     Result = FAILURE
ddas : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1333557
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/client/KerberosAuthenticator.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/util/KerberosUtil.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/server/TestKerberosAuthenticationHandler.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
, Integrated in Hadoop-Mapreduce-trunk #1069 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1069/])
    HADOOP-8346. Makes oid changes to make SPNEGO work. Was broken due to fixes introduced by the IBM JDK compatibility patch. Contributed by Devaraj Das. (Revision 1333557)

     Result = SUCCESS
ddas : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1333557
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/client/KerberosAuthenticator.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/util/KerberosUtil.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/server/TestKerberosAuthenticationHandler.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
, Closed upon release of Hadoop-1.0.3., Integrated in Hadoop-Hdfs-0.23-Build #512 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/512/])
    HADOOP-8346. Changes to support Kerberos with non Sun JVM (HADOOP-6941) broke SPNEGO (Devaraj Das via tgraves) (Revision 1441227)

     Result = SUCCESS
tgraves : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1441227
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/client/KerberosAuthenticator.java
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/util/KerberosUtil.java
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/server/TestKerberosAuthenticationHandler.java
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/CHANGES.txt
]