[Each addStoredBlock() invokes processOverReplicatedBlock(), which can be made a no-op in common case easily. Currently it does some allocation and iterations. But it does not seem more than rest of addStoredBlock(). Did you find processOverReplicatedBlock() in stack trace most of the time when you observed this?

Let me know when you suspect this again, and we can check the trace. 
, I agree with you observation. I am surprised why processOverReplicatedBlock() was called so often on one of my test runs. if you think it is worthwhile, please go ahead an make the change to make processOverReplicatedBlock() a no-op if blocks are not over-replicated., 
Dhruba, attached patch calls processOverReplicatedBloc() only if numCurReplica is larger than expected number. Also has couple of minor changes. 

Please review it and may you could use this patch in your test case.
Thanks., +1. Code reviewed. , will make patch available after HADOOP-702 and friends are checked in., +1, because http://issues.apache.org/jira/secure/attachment/12354802/HADOOP-1149.patch applied and successfully tested against trunk revision http://svn.apache.org/repos/asf/lucene/hadoop/trunk/525290. Results are at http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch, Raghu, I think this one needs regenerating too due to FSNamesystem conflicts., hm. I tried this patch again and it applied fine to latest trunk (revision 526263). Can you try it again?

, +1, because http://issues.apache.org/jira/secure/attachment/12354802/HADOOP-1149.patch applied and successfully tested against trunk revision http://svn.apache.org/repos/asf/lucene/hadoop/trunk/526215. Results are at http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch, I've just committed this. Thanks Raghu!, Integrated in Hadoop-Nightly #50 (See http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Nightly/50/)]