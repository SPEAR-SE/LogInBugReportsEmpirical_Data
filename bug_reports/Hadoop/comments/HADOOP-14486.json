[Assume that HADOOP-14430  has done this, it being the most recent change to SFTP.

What's probably happening is that the remote FS has a different granularity than expected.

Sonia, can you supply a patch which relaxes the equality somewhat? We could probably allow for +-60s to avoid breaking against any FS I can imagine.

If you can do that along with a declaration of which OS/FTP server you tested against. (that's there as our due diligence check), I'll get the fix in, this may runs at windows system? some system may got access time in millions, but most got in seconds.
the sftp api can got time in seconds.Sure, modify code can avoid this.
 [~stevel@apache.org]. I will solve this including modifitime test unit., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m  0s{color} | {color:blue} Docker mode activated. {color} |
| {color:red}-1{color} | {color:red} patch {color} | {color:red}  0m  9s{color} | {color:red} HADOOP-14486 does not apply to trunk. Rebase required? Wrong Branch? See https://wiki.apache.org/hadoop/HowToContribute for help. {color} |
\\
\\
|| Subsystem || Report/Notes ||
| JIRA Issue | HADOOP-14486 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12871464/HADOOP-14486-001.patch |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/12447/console |
| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, [~brahmareddy] [~stevel@apache.org]  on trunk and branch-2 ,seemed that HADOOP-14431 patch has not submitted. what happened?  , will check and update in HADOOP-14431., will update patch soon after checking it in ubuntu os, will test on ubuntu 14.04 using openjdk 1.8 and oracle jdk. , [~Sonia] i checked this issue with the same environment and found out that the oracle jdk and openjdk's implements of code below is different.
{code}
Files.readAttributes(path, BasicFileAttributes.class)
{code}
That does not relate to the os system except the windows os.
Futhermore, openjdk 1.7 acts the same as oracle jdk.
So, two suggestions to solve this :
1、use oracle jdk 1.8
2、if you want to use openjdk 1.8, you can modify the TestSFTPFileSystem#testGetAccessTime  code  like code below：
{code}
  @Test
  public void testGetAccessTime() throws IOException {
    Path file = touch(localFs, name.getMethodName().toLowerCase());
    LocalFileSystem local = (LocalFileSystem)localFs;
    java.nio.file.Path path = (local).pathToFile(file).toPath();
    long accessTime1 = Files.readAttributes(path, BasicFileAttributes.class)
        .lastAccessTime().toMillis();
    accessTime1 = accessTime1 / 1000 * 1000;
    long accessTime2 = sftpFs.getFileStatus(file).getAccessTime();
    assertEquals(accessTime1, accessTime2);
  }
{code}

 [~stevel@apache.org], close the issue or submit code above as a patch?, [~Hongyuan Li] I made the code change you have suggested above and ran the test multiple times. The test passed consistently. This seems to resolve the error. Does this change work with Oracle JDK 1.8 and OpenJDK 1.7 as well?, Submit the new changes as a patch here, declare which OS/filesystem & jVM you used & we'll build up some understanding of which ones are causing problems., [~Sonia] this change work with opendjk 1.7 and oracle 1.8 as well.The oracle jdk and openJDK 1.7's Files.readAttributes(path, BasicFileAttributes.class) method get time in second accuracy, the value of which is like XXXXX000,but openJDK 1.8 and WindowFileAttributes don't.

[~stevel@apache.org] i will submit the patch here soon.
my test environment lists below:
{{os : ubuntu-14.04.5-server-amd64}}
jdks:
{code}
 java-7-1.7.0_131(java version "1.7.0_131", OpenJDK Runtime Environment (IcedTea 2.6.9) (7u131-2.6.9-0ubuntu0.14.04.2)  OpenJDK 64-Bit Server VM (build 24.131-b00, mixed mode));
{code}
{code}
        oracle jdk1.8.0_131(java version "1.8.0_131",  Java(TM) SE Runtime Environment (build 1.8.0_131-b11), Java HotSpot(TM) 64-Bit Server VM (build 25.131-b11, mixed mode)) ;
{code}
{code}
     openjdk version "1.8.0_111"(openjdk version "1.8.0_111",OpenJDK Runtime Environment (build 1.8.0_111-8u111-b14-3~14.04.1-b14),OpenJDK 64-Bit Server VM (build 25.111-b14, mixed mode))
{code}

Only by using {{openjdk version "1.8.0_111"}} will encounter this problem.

, [~stevel@apache.org] i have submit the patch and the test environment in near comment.
By the way,can you give me a code review about HADOOP-14469, HADOOP-14470 and HADOOP-14429. If you've no time, forget this., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 20s{color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 1 new or modified test files. {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 15m 40s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 20m 50s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 43s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 23s{color} | {color:green} trunk passed {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red}  1m 45s{color} | {color:red} hadoop-common-project/hadoop-common in trunk has 19 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 59s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 49s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 15m 14s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 15m 14s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 41s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 14s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 50s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m  2s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 10m  0s{color} | {color:green} hadoop-common in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 56s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 75m 36s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:14b5c93 |
| JIRA Issue | HADOOP-14486 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12871602/HADOOP-14486-001.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |
| uname | Linux 53ccad070368 3.13.0-107-generic #154-Ubuntu SMP Tue Dec 20 09:57:27 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / 855e047 |
| Default Java | 1.8.0_131 |
| findbugs | v3.1.0-RC1 |
| findbugs | https://builds.apache.org/job/PreCommit-HADOOP-Build/12451/artifact/patchprocess/branch-findbugs-hadoop-common-project_hadoop-common-warnings.html |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/12451/testReport/ |
| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/12451/console |
| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, [~stevel@apache.org] i have submit the patch and the test environment in near comment. Any time to review it ?, No, time,  I've been away. I can assure you, we are all behind reviewing things. And, equally: all waiting for others to review our own work.

Looking at the patch, I think I'd be happier with

1000 * (accessTime1 % 1000)

It's integer division (hence the % operator) and avoids confusion about what the evaluateion of  {{accessTime1 / 1000 * 1000 }} is. I misread at first as {{accessTime1 / (1000 * 1000)).

*Update/Correction*. No, % is entirely the wrong operator. It'd have to be {{accessTime -  (accessTime1 % 1000)}}, which isn't that good. 

Let's go with: {{(accessTime1 / 1000) * 1000}} with the braces to make it obvious, even to me, Sorry for so confusing you, i would be more patient. Submit the patch as you suggested., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 17s{color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 1 new or modified test files. {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 13m 36s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 13m 41s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 36s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  6s{color} | {color:green} trunk passed {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red}  1m 24s{color} | {color:red} hadoop-common-project/hadoop-common in trunk has 19 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 50s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 39s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 16s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 10m 16s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 35s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  5s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 33s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 50s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  8m  0s{color} | {color:green} hadoop-common in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 35s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 56m 51s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:14b5c93 |
| JIRA Issue | HADOOP-14486 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12873203/HADOOP-14486-002.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |
| uname | Linux 6bc0fdc4ddf6 3.13.0-116-generic #163-Ubuntu SMP Fri Mar 31 14:13:22 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / fb68980 |
| Default Java | 1.8.0_131 |
| findbugs | v3.1.0-RC1 |
| findbugs | https://builds.apache.org/job/PreCommit-HADOOP-Build/12538/artifact/patchprocess/branch-findbugs-hadoop-common-project_hadoop-common-warnings.html |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/12538/testReport/ |
| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/12538/console |
| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, bq. Sorry for so confusing you, i would be more patient. Submit the patch as you suggested.

hey, don't apologise. My mistake :). We just need to write code so that in years to come, it will be obvious to all. I think I misread it because there's a lot of code where we do constants of the form
{code}
static final timeout = 60 * 60 * 1000;
{code}
...so I tend to group together the multiplying of two constants to produce another constant. If they'd been variables I'd (hopefully) have parsed it correctly., +1
committed to branch-2 & trunk.

Thanks for tracking this down!, :)  That's Ok. During this, i learned a lot of about how to make code obvious and gracefully., SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #11874 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/11874/])
HADOOP-14486 TestSFTPFileSystem#testGetAccessTime test failure using (stevel: rev 942ecbbc9876427051965ddd167df5cc1cc253e3)
* (edit) hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/sftp/TestSFTPFileSystem.java
]