[Hello [~wuyuren].  I believe this issue is a duplicate of what was reported in HADOOP-12954, which has a patch committed for release 2.9.0, and MAPREDUCE-6565, which remains unresolved.  I'm going to close this issue as a duplicate., Looking through the code and i think in this particular case I think the best place to setup the value for useIp is in DFSUtil.createKeyProvider method  
This static method has visibility of job confiig and can easily setup the boolean value . Given KMS is a generic service to provide keys, the best place to handle this is to take the parameter into KMSClientProvider and cascading this flag until it reach the point to call SecurityUtil. However, that will affect too many APIs. At this moment the KMS is used by HDFS . therefore it can be done using this single fix.  

The fix code is in the attachment. 
]