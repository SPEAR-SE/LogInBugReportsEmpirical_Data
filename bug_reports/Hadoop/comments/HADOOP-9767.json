[I just realized that this is basically a duplicate of HADOOP-9507, so I'll post patches over there.]