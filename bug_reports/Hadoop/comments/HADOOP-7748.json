[When client fails to move a path to trash, the exception is retained, but the message is not propagated to the new exception text, which becomes simply
rmr: Failed to move to trash: hdfs://namenode:9000/test/foo

The attached patch will change such message to include that of the nested exception, such as
rmr: Failed to move to trash: hdfs://namenode:9000/test/foo error: org.apache.hadoop.security.AccessControlException: org.apache.hadoop.security.AccessControlException: Permission denied: user=xxx, access=WRITE, inode="test":hadoop:supergroup:rwxr-xr-x

Then it will be very helpful to diagnosis problems., +1 change looks acceptable. Could you also add a simple test so we do not regress? Also, lets target trunk for this if its a problem there too -- not 1.x alone (we can backport to 1.x, but new features go to trunk first)., It seems to be fixed in trunk, as it throws the IOException directly rather than catching it., My bad, the trunk also has the issue, but in different class (TrashPolicyDefault)., Moved to 1.2.0 upon release of 1.1.0., Changed Target Version to 1.3.0 upon release of 1.2.0. Please change to 1.2.1 if you intend to submit a fix for branch-1.2., I have attached a patch for trunk., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12592711/HADOOP-7748.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:red}-1 javac{color:red}.  The patch appears to cause the build to fail.

Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/2795//console

This message is automatically generated., Sorry, I had attached wrong a wrong patch.
Now, I have attached a new patch which is successfully compiled.
And I have added no test code because this change is only about exception message., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12593112/HADOOP-7748.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-common.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/2817//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/2817//console

This message is automatically generated., Not a problem on branch-2 and trunk (anymore). Resolving. Below is what we get now, if .Trash is not writable/etc.

{code}
[test@host ~]$ hadoop fs -rm foo
rm: Failed to move to trash: hdfs://host:8020/user/test/foo: Permission denied: user=test, access=EXECUTE, inode="/user/test/.Trash":test:test:d---------
{code}]