[Patch for issue., No test included; obvious way to test this is to run lots of subprocesses; if the system doesn't die, the patch worked.
But this would be a distinctly heavyweight test with unpleasant consequences if it failed.  Further, it wouldn't be very reliable since there's no way of knowing what any particular system's file descriptor limit is., Looks good.  Important patch.  +1, I committed this. Thanks, Ari, No release note for "just a bug."]