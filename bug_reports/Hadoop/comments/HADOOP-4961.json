[TestLeaseExpire.java: a unit test for the problem., This exception is found in the name-node *.out file:
{code}
Exception in thread "org.apache.hadoop.dfs.LeaseManager$Monitor@2244d990" java.util.ConcurrentModificationException
        at java.util.TreeMap$PrivateEntryIterator.nextEntry(TreeMap.java:1100)
        at java.util.TreeMap$KeyIterator.next(TreeMap.java:1154)
        at org.apache.hadoop.dfs.LeaseManager.checkLeases(LeaseManager.java:371)
        at org.apache.hadoop.dfs.LeaseManager.access$800(LeaseManager.java:51)
        at org.apache.hadoop.dfs.LeaseManager$Monitor.run(LeaseManager.java:346)
        at java.lang.Thread.run(Thread.java:619)
{code}
, This fixes the problem. The test provided by Nicholas fails on with current code but succeeds with the changes., +1 patch looks good, {noformat}
     [exec] +1 overall.  
     [exec] 
     [exec]     +1 @author.  The patch does not contain any @author tags.
     [exec] 
     [exec]     +1 tests included.  The patch appears to include 3 new or modified tests.
     [exec] 
     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.
     [exec] 
     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.
     [exec] 
     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.
     [exec] 
     [exec]     +1 Eclipse classpath. The patch retains Eclipse classpath integrity.
{noformat}, Unit tests: BUILD SUCCESSFUL
, A separate patch for branch 0.19 is required., I just committed this.
Thank you Nicholas and Sameer., Integrated in Hadoop-trunk #706 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-trunk/706/])
    . Fix ConcurrentModificationException in lease recovery of empty files. Contributed by Konstantin Shvachko and Nicholas.
]