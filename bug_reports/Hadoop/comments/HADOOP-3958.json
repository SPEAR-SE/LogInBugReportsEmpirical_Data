[This patch fixes the problem in the test program and makes failures fail the test case.

It also includes some private static utility functions that I needed to figure out what was going on., Putting into queue for hudson, I just committed this. Thanks, Owen!, Integrated in Hadoop-trunk #581 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-trunk/581/])]