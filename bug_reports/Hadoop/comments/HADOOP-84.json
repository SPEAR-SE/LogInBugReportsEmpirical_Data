[This patch does file name and offset reporting for the failed block.
I also removed 2 unused variables.
Should be ok to include into the release., I just committed this. I removed the unused code rather than just commenting it out, and also removed some spurious empty comments inserted by the patch.

Thanks, Konstantin!]