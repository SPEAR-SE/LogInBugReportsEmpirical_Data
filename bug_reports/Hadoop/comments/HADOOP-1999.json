[The situation was worse than initially reported. Some DataNodes became dead nodes about at the same time, and some blocks became missing because of that. I attached the jstack of one of the dead DataNodes.

Concerning missing blocks, It looks to me that the block id goes missing as well (at least fsck does not report it anymore). If this is true, I would argue that this should be fixed, because it can always happen that some DataNodes go off-line at the same time because of bugs or network problems, and could be brought on-line just by restarting., finalize removes hard links previously created by upgrade. The removal is done in a separate thread, but if there is a lot of blocks, 
then data-nodes are likely to be blocked on IOs, that is data transmission will be slow. This is what you observed here. 
A solution would be to remove the links lazily, e.g. remove 100 files per second or so. Then finalizing will go slower, but 
the data-nodes will be able to proceed with normal activities.

The jstack you attached: I do not see that data-node is doing any file deletes. Are you sure this thread dump was done 
during finalize? I see that one of the threads is doing DU though. Could the slowdown be related to HADOOP-1946?
Before this was fixed I've seen drastic slowdown of data-nodes, some of them would become dead even with insignificant load. 
Finalize would make things even worse.

Missing blocks: I suspect that you get these because many io operation were not complete. Some blocks were not replicated,
some files were not closed., Konstantin, I got he jstack much later after the -finalizeUpgrade, and the datanode was declared a dead node by the nameserver a long time before.
But the issue might be fixed by HADOOP-1946., I will retest this issue using a more recent release. , Could not reproduce it anymore with the 0.16.x releases.]