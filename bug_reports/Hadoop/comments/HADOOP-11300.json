[Uploading patch.., Umm, given this is a -D setting, doesn't that also mean it's passed on the command line...  which in turn means that anyone doing a ps/reading /proc will also see the password?  It sounds like this security service has a pretty major security hole..., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12681179/HADOOP-11300.1.patch
  against trunk revision b0a9cd3.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-kms.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/5075//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/5075//console

This message is automatically generated., Aah.. thanks for pointing that out [~aw],

Updating the patch with the following change :
Tomcat allows only 2 ways to specify the passwords.. either as a {{-D}} System property (which would make it visible on {{ps}} as you mentioned) or directly specifying it in the {{ssl-server.xml}} file.. 
I have modified the earlier patch to put placeholders in the {{ssl-server.xml}} and populate it with the provided passwords before passing it on to the tomcat bootstrap class..

, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12681516/HADOOP-11300.2.patch
  against trunk revision d005404.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-kms.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/5083//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/5083//console

This message is automatically generated., This approach seems reasonable to me, and the latest patch looks pretty good to me as well. Arun, can you comment on what you testing you've done of this patch?

[~aw] - does this approach seem like it'll be sufficient to you?, [~atm], thanks for the review..

I tested the patch as follows :
* I did a {{mvn package -Pdist}}
* I ran the {{kms.sh}} script with {{KMS_SSL_KEYSTORE_PASS}} env variable set and {{-Djavax.net.ssl.trustStorePassword=}} key value appended to the {{CATALINA_OPTS}} env variable.
* I verified that the kms server started up with the new {{ssl-server.xml}} populated with the correct passwords and no passwords were that the passwords were masked out in the sysout and {{ps}} displays., This feels extremely fragile, but since it's tomcat there's only so much we can do. :(  Hopefully in the future we can dump tomcat and all of its extra baggage/issues. , +1 LGTM too, thanks for working on this Arun, and thanks for reviewing ATM and Allen. I've committed this to trunk and branch-2., FAILURE: Integrated in Hadoop-trunk-Commit #6604 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/6604/])
HADOOP-11300. KMS startup scripts must not display the keystore / truststore passwords. Contributed by Arun Suresh. (wang: rev 56f3eecc129486d3297d082d9b97f26b40d0a2c6)
* hadoop-common-project/hadoop-kms/src/main/sbin/kms.sh
* hadoop-common-project/hadoop-kms/src/main/libexec/kms-config.sh
* hadoop-common-project/hadoop-kms/src/main/tomcat/ssl-server.xml
* hadoop-common-project/hadoop-kms/src/main/tomcat/ssl-server.xml.conf
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-kms/pom.xml
, FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #17 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/17/])
HADOOP-11300. KMS startup scripts must not display the keystore / truststore passwords. Contributed by Arun Suresh. (wang: rev 56f3eecc129486d3297d082d9b97f26b40d0a2c6)
* hadoop-common-project/hadoop-kms/src/main/tomcat/ssl-server.xml
* hadoop-common-project/hadoop-kms/src/main/libexec/kms-config.sh
* hadoop-common-project/hadoop-kms/src/main/sbin/kms.sh
* hadoop-common-project/hadoop-kms/src/main/tomcat/ssl-server.xml.conf
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-kms/pom.xml
, SUCCESS: Integrated in Hadoop-Yarn-trunk #755 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/755/])
HADOOP-11300. KMS startup scripts must not display the keystore / truststore passwords. Contributed by Arun Suresh. (wang: rev 56f3eecc129486d3297d082d9b97f26b40d0a2c6)
* hadoop-common-project/hadoop-kms/src/main/tomcat/ssl-server.xml.conf
* hadoop-common-project/hadoop-kms/pom.xml
* hadoop-common-project/hadoop-kms/src/main/sbin/kms.sh
* hadoop-common-project/hadoop-kms/src/main/libexec/kms-config.sh
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-kms/src/main/tomcat/ssl-server.xml
, FAILURE: Integrated in Hadoop-Hdfs-trunk #1945 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1945/])
HADOOP-11300. KMS startup scripts must not display the keystore / truststore passwords. Contributed by Arun Suresh. (wang: rev 56f3eecc129486d3297d082d9b97f26b40d0a2c6)
* hadoop-common-project/hadoop-kms/src/main/tomcat/ssl-server.xml
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-kms/src/main/libexec/kms-config.sh
* hadoop-common-project/hadoop-kms/src/main/tomcat/ssl-server.xml.conf
* hadoop-common-project/hadoop-kms/pom.xml
* hadoop-common-project/hadoop-kms/src/main/sbin/kms.sh
, FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #17 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/17/])
HADOOP-11300. KMS startup scripts must not display the keystore / truststore passwords. Contributed by Arun Suresh. (wang: rev 56f3eecc129486d3297d082d9b97f26b40d0a2c6)
* hadoop-common-project/hadoop-kms/pom.xml
* hadoop-common-project/hadoop-kms/src/main/tomcat/ssl-server.xml
* hadoop-common-project/hadoop-kms/src/main/sbin/kms.sh
* hadoop-common-project/hadoop-kms/src/main/tomcat/ssl-server.xml.conf
* hadoop-common-project/hadoop-kms/src/main/libexec/kms-config.sh
* hadoop-common-project/hadoop-common/CHANGES.txt
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #1969 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1969/])
HADOOP-11300. KMS startup scripts must not display the keystore / truststore passwords. Contributed by Arun Suresh. (wang: rev 56f3eecc129486d3297d082d9b97f26b40d0a2c6)
* hadoop-common-project/hadoop-kms/pom.xml
* hadoop-common-project/hadoop-kms/src/main/tomcat/ssl-server.xml.conf
* hadoop-common-project/hadoop-kms/src/main/tomcat/ssl-server.xml
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-kms/src/main/sbin/kms.sh
* hadoop-common-project/hadoop-kms/src/main/libexec/kms-config.sh
, SUCCESS: Integrated in Hadoop-Mapreduce-trunk-Java8 #17 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/17/])
HADOOP-11300. KMS startup scripts must not display the keystore / truststore passwords. Contributed by Arun Suresh. (wang: rev 56f3eecc129486d3297d082d9b97f26b40d0a2c6)
* hadoop-common-project/hadoop-kms/pom.xml
* hadoop-common-project/hadoop-kms/src/main/libexec/kms-config.sh
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-kms/src/main/tomcat/ssl-server.xml
* hadoop-common-project/hadoop-kms/src/main/sbin/kms.sh
* hadoop-common-project/hadoop-kms/src/main/tomcat/ssl-server.xml.conf
]