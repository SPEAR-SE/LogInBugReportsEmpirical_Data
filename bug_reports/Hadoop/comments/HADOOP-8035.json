[This patch fixes a number of the issues, and a run of "mvn site package -Pdist -DskipTests -Dmaven.javadoc.skip=true" with this applied took 4m45s, versus 9m45s without it., Similar speed improvements were seen when running "mvn -Dsnappy.prefix=x -Dbundle.snappy=true -Dsnappy.lib=/usr/lib64 -Dcontainer-executor.conf.dir=/etc/hadoop/conf -Pdist -Pnative -Psrc -Dtar -DskipTests -DskipTest -DskipITs install" (10m39s to 5m43s) and "mvn site site:stage -DskipTests -DskipTest -DskipITs" (4m42s to 1m33s)., Marking as patch available for Andrew., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12513741/HADOOP-8035.patch.txt
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/572//console

This message is automatically generated., Oops - original patch was against branch-0.23, and it didn't have the javadoc jar for the dist profile properly moved to hadoop-project. I've done that and a couple other little tweaks., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12513824/HADOOP-8035.mk2.patch.txt
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/573//console

This message is automatically generated., Argh. Patch applies locally, but not in the test build - is some special magic needed to do a patch against the root?, The test-patch.sh has issues when applying patches that touch certain parts of the tree, like files directly under the root or some subtrees like hadoop-tools.  You can verify it manually by running {{./dev-support/test-patch.sh _pathtopatchfilehere_}} from the root of the tree.

I was able to apply the patch successfully., Andrew,

I'm having problems running the patch, doing:

{code}
$ mvn clean site package -DskipTests -Pdist,docs
{code}

the build gets stuck multiple times and I have to press enter to continue, then it fails at:

{code}
....
[INFO] Apache Hadoop Distributed Copy .................... SUCCESS [13.064s]
[INFO] Apache Hadoop Archives ............................ SUCCESS [3.452s]
[INFO] Apache Hadoop Rumen ............................... SUCCESS [7.196s]
[INFO] Apache Hadoop Extras .............................. SUCCESS [4.199s]
[INFO] Apache Hadoop Tools Dist .......................... FAILURE [0.708s]
[INFO] Apache Hadoop Tools ............................... SKIPPED
[INFO] Apache Hadoop Distribution ........................ SKIPPED
[INFO] Apache Hadoop Client .............................. SKIPPED
[INFO] Apache Hadoop Mini-Cluster ........................ SKIPPED
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 38:15.361s
[INFO] Finished at: Wed Feb 08 12:33:14 PST 2012
[INFO] Final Memory: 94M/298M
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-antrun-plugin:1.6:run (site) on project hadoop-tools-dist: An Ant BuildException has occured: /Volumes/SSD/src/apache/hadoop/git/hadoop-tools/hadoop-tools-dist/src/main/docs does not exist. -> [Help 1]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException
[ERROR] 
[ERROR] After correcting the problems, you can resume the build with the command
[ERROR]   mvn <goals> -rf :hadoop-tools-dist
dontknow:git tucu$ 
{code}

Thxs, Hmm - might be something I'm missing in hadoop-project-dist in re: inheritance. I'll play around with it., Ok, I think this is because hadoop-project-dist/pom.xml expects things like src/main/docs to be present in the project inheriting from it, and unlike the other two cases of inheriting from hadoop-project-dist (hadoop-common-project/hadoop-common and hadoop-hdfs-project/hadoop-hdfs), hadoop-tools/hadoop-tools-dist is an empty project. But I'm not sure why it's even trying - theoretically, it wouldn't run if "is.hadoop.component" is false, but I think that may only function if "is.hadoop.component" isn't set at all., Yup, removing the <is.hadoop.component> line from hadoop-tools/hadoop-tools-dist fixes the build. Will update the patch., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12513866/HADOOP-8035.mk3.patch.txt
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/575//console

This message is automatically generated., +1, Integrated in Hadoop-Hdfs-trunk-Commit #1779 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/1779/])
    HADOOP-8035 Hadoop Maven site is inefficient and runs phases redundantly (abayer via tucu)

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1242505
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-project/pom.xml
* /hadoop/common/trunk/hadoop-tools/hadoop-tools-dist/pom.xml
* /hadoop/common/trunk/pom.xml
, Integrated in Hadoop-Common-trunk-Commit #1704 (See [https://builds.apache.org/job/Hadoop-Common-trunk-Commit/1704/])
    HADOOP-8035 Hadoop Maven site is inefficient and runs phases redundantly (abayer via tucu)

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1242505
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-project/pom.xml
* /hadoop/common/trunk/hadoop-tools/hadoop-tools-dist/pom.xml
* /hadoop/common/trunk/pom.xml
, Integrated in Hadoop-Mapreduce-trunk-Commit #1715 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/1715/])
    HADOOP-8035 Hadoop Maven site is inefficient and runs phases redundantly (abayer via tucu)

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1242505
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-project/pom.xml
* /hadoop/common/trunk/hadoop-tools/hadoop-tools-dist/pom.xml
* /hadoop/common/trunk/pom.xml
, Thanks Andrew.

Committed to trunk and branch-0.23., Integrated in Hadoop-Hdfs-0.23-Commit #520 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Commit/520/])
    Merge -r 1242504:1242505 from trunk to branch. FIXES: HADOOP-8035

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1242515
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-project/pom.xml
* /hadoop/common/branches/branch-0.23/hadoop-tools/hadoop-tools-dist/pom.xml
* /hadoop/common/branches/branch-0.23/pom.xml
, Integrated in Hadoop-Common-0.23-Commit #531 (See [https://builds.apache.org/job/Hadoop-Common-0.23-Commit/531/])
    Merge -r 1242504:1242505 from trunk to branch. FIXES: HADOOP-8035

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1242515
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-project/pom.xml
* /hadoop/common/branches/branch-0.23/hadoop-tools/hadoop-tools-dist/pom.xml
* /hadoop/common/branches/branch-0.23/pom.xml
, Integrated in Hadoop-Mapreduce-0.23-Commit #535 (See [https://builds.apache.org/job/Hadoop-Mapreduce-0.23-Commit/535/])
    Merge -r 1242504:1242505 from trunk to branch. FIXES: HADOOP-8035

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1242515
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-project/pom.xml
* /hadoop/common/branches/branch-0.23/hadoop-tools/hadoop-tools-dist/pom.xml
* /hadoop/common/branches/branch-0.23/pom.xml
, Integrated in Hadoop-Hdfs-trunk #952 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/952/])
    HADOOP-8035 Hadoop Maven site is inefficient and runs phases redundantly (abayer via tucu)

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1242505
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-project/pom.xml
* /hadoop/common/trunk/hadoop-tools/hadoop-tools-dist/pom.xml
* /hadoop/common/trunk/pom.xml
, Integrated in Hadoop-Hdfs-0.23-Build #165 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/165/])
    Merge -r 1242504:1242505 from trunk to branch. FIXES: HADOOP-8035

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1242515
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-project/pom.xml
* /hadoop/common/branches/branch-0.23/hadoop-tools/hadoop-tools-dist/pom.xml
* /hadoop/common/branches/branch-0.23/pom.xml
, Integrated in Hadoop-Mapreduce-0.23-Build #187 (See [https://builds.apache.org/job/Hadoop-Mapreduce-0.23-Build/187/])
    Merge -r 1242504:1242505 from trunk to branch. FIXES: HADOOP-8035

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1242515
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-project/pom.xml
* /hadoop/common/branches/branch-0.23/hadoop-tools/hadoop-tools-dist/pom.xml
* /hadoop/common/branches/branch-0.23/pom.xml
, Integrated in Hadoop-Mapreduce-trunk #985 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/985/])
    HADOOP-8035 Hadoop Maven site is inefficient and runs phases redundantly (abayer via tucu)

tucu : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1242505
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-project/pom.xml
* /hadoop/common/trunk/hadoop-tools/hadoop-tools-dist/pom.xml
* /hadoop/common/trunk/pom.xml
]