[Details about a potential solution:
1. On failed task, remove the task from runningJobs, but do not delete runningJobs job entry even if it's the only task of the job;  (which means we should NOT call TaskTracker.removeTaskFromJob)

2. JobTracker should keep another data structure: jobsToTracker, for recording all the TaskTrackers that a job has started a task on.

3. When the job finished, JobTracker will send "KILL" job command to the TaskTrackers, based on jobsToTracker data structure.


An alternative:
On failed task, remove the task from runningJobs, AND if it's the only task of the job, remove the job directory (which means we should call TaskTracker.removeTaskFromJob, PLUS delete the job directory)
, Simple fix. I also included code to show the content of runningTasks on http interface., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12381804/3370-1.patch
  against trunk revision 654973.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2444/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2444/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2444/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2444/console

This message is automatically generated., Zheng, apologies for being late to get to this - couple of comments:

1. Please do not comment out code which is no longer required, just delete it.
2. HADOOP-3297 changed the way we get TaskCompletionEvents, it is no longer once in 5s. Just FYI.
3. If you don't mind, please do not use this.<func> whenever calling <func> suffices.
4. As you mentioned, the other option is to send a KillJobAction for all trackers on which tasks ran at the end of the job. This is a really useful feature and would make me very happy if you took that route! *smile* - however, I won't hold it against this patch; we could do it as a separate issue., 1. removed commented code;
2. removed extra "this." where not necessary.

I will put that "KILLJOB" thing in a separate issue - which helps cleaning out the local dirs of the job in corner cases.
, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12382012/3370-2.patch
  against trunk revision 656122.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2460/console

This message is automatically generated., Thanks Arun for reviewing this one. Really appreciate it.

I think the HadoopQA pach process had some problem in applying and merging this patch with trunk. Maybe I will cancel and re-submit this issue to re-trigger another Hudson test., my fault. regenerated the patch., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12382014/3370-3.patch
  against trunk revision 656122.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    -1 core tests.  The patch failed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2462/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2462/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2462/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2462/console

This message is automatically generated., can somebody help me restart the hudson test? It seems there are some transient errors.
, Looks like org.apache.hadoop.mapred.TestMiniMRMapRedDebugScript.testMapDebugScript failed:

{noformat}
junit.framework.ComparisonFailure: expected:<...> but was:<...
{noformat}

Looks like it might have broken the feature where u can added a debug-script for your map/reduce tasks, look at TestMiniMRMapRedDebugScript for an example.
Does it succeed on your machine?, Looks like the failure is due logger intialization warnings.
{noformat}
-------------------- DEBUG OUT---------------------
Test Script
Bailing out
log4j:WARN No appenders could be found for logger (org.apache.hadoop.mapred.TaskRunner).
log4j:WARN Please initialize the log4j system properly.
{noformat}, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12382024/3370-4.patch
  against trunk revision 656270.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2466/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2466/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2466/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2466/console

This message is automatically generated., I just committed this. Thanks, Zheng!, Patch for 0.17, All the tests passed on branch 0.17, on my machine , I merged this into branch-0.17 also., Integrated in Hadoop-trunk #581 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-trunk/581/])]