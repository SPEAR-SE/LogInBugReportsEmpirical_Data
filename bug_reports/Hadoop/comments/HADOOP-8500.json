[Patch required to fix the javadoc jars completely such that they aren't extremely big., Upon further inspection - it seems that this is fixed in trunk already with a very similar tweak to the maven-javadoc-plugin...

Testing a bit further locally...., ...and I can still see some 60+ mv javadoc jars.  Patch is go in my book :-), What is wrong with the default of ${project.build.directory}/apidocs by not specifying <destDir> at all?, That would be ideal - and truthfully - that's where I started too.

BUT - it's WAY easier to fix maven then the entire site generated around it (forrest).  That changes things from a one line fix to a touch-a-ton-of-files fix.  I was told the patch would be accepted by the community faster/easier if it was small (for my first time).

What's sad is while exploring this fix, there are several places where the live apache hadoop site is broken but I refrained from fixing them as well.  

In fact, I was so frustrated with the site, I rewrote several of the pages in apt, just to see how easy it'd be (I have the main site complete now)., Here are all the apt/images for redoing the maven site.  You should be able to drop these in place of the current site output and join up all the other site's that have been generated., Removing Fix-version. Please use Target-version for the intended release and let committers set the fix-version at commit time., Here's a version that just uses the default version. [~ejciramella] or other watchers, could you explain a bit more the site issues? I looked at the staging site before and after this patch, and the filestructure was the same and the javadoc links still seemed to work., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 14s{color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  8m 10s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m  9s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 11s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m  9s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m  9s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m  7s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m  6s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  0m  6s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m  8s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m  7s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} xml {color} | {color:green}  0m  2s{color} | {color:green} The patch has no ill-formed XML file. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m  7s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m  6s{color} | {color:green} hadoop-project in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 16s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 10m 39s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:9560f25 |
| JIRA Issue | HADOOP-8500 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12831897/HADOOP-8500.001.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  xml  |
| uname | Linux 9b269c15b5a2 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / 2023254 |
| Default Java | 1.8.0_101 |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/10684/testReport/ |
| modules | C: hadoop-project U: hadoop-project |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/10684/console |
| Powered by | Apache Yetus 0.4.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, Ping, could use a review on this., Thanks [~andrew.wang] for the patch. 

I tried to build before and after patch on trunk, with {{mvn clean site -Preleasedocs; mvn site:stage -DstagingDirectory=/tmp/hadoop-site}} and {{mvn clean package -Dtar -Pdist -DskipTests}}.

The 1st command didn't show any difference in the output, and I also verified the links work correctly (spot checked some pages including hadoop FileSystem's javadoc).

The 2nd command also successfully completes. Excitingly, the previously 72M {{hadoop-common-3.0.0-alpha2-SNAPSHOT-javadoc.jar}} becomes 5.8M.


However, listing the hadoop-dist/target shows this:
{noformat}
before:
drwxr-xr-x   2 xiao  staff    68B Oct 21 17:33 test-dir
drwxr-xr-x   3 xiao  staff   102B Oct 21 17:33 test-classes
drwxr-xr-x   3 xiao  staff   102B Oct 21 17:33 maven-shared-archive-resources
drwxr-xr-x   3 xiao  staff   102B Oct 21 17:33 classes
drwxr-xr-x   3 xiao  staff   102B Oct 21 17:33 antrun
drwxr-xr-x  11 xiao  staff   374B Oct 21 17:33 hadoop-3.0.0-alpha2-SNAPSHOT
drwxr-xr-x   3 xiao  staff   102B Oct 21 17:33 maven-archiver
drwxr-xr-x   3 xiao  staff   102B Oct 21 17:33 javadoc-bundle-options
-rw-r--r--   1 xiao  staff    29K Oct 21 17:33 hadoop-dist-3.0.0-alpha2-SNAPSHOT.jar
-rw-r--r--   1 xiao  staff    27K Oct 21 17:33 hadoop-dist-3.0.0-alpha2-SNAPSHOT-test-sources.jar
-rw-r--r--   1 xiao  staff    27K Oct 21 17:33 hadoop-dist-3.0.0-alpha2-SNAPSHOT-sources.jar
-rw-r--r--   1 xiao  staff   180M Oct 21 17:33 hadoop-dist-3.0.0-alpha2-SNAPSHOT-javadoc.jar
-rw-r--r--   1 xiao  staff   179M Oct 21 17:33 hadoop-3.0.0-alpha2-SNAPSHOT.tar.gz

after:
drwxr-xr-x   2 xiao  staff    68B Oct 21 17:39 test-dir
drwxr-xr-x   3 xiao  staff   102B Oct 21 17:39 test-classes
drwxr-xr-x   3 xiao  staff   102B Oct 21 17:39 maven-shared-archive-resources
drwxr-xr-x   3 xiao  staff   102B Oct 21 17:39 classes
drwxr-xr-x   3 xiao  staff   102B Oct 21 17:39 antrun
drwxr-xr-x  11 xiao  staff   374B Oct 21 17:39 hadoop-3.0.0-alpha2-SNAPSHOT
drwxr-xr-x   3 xiao  staff   102B Oct 21 17:39 maven-archiver
drwxr-xr-x   3 xiao  staff   102B Oct 21 17:39 javadoc-bundle-options
-rw-r--r--   1 xiao  staff    29K Oct 21 17:39 hadoop-dist-3.0.0-alpha2-SNAPSHOT.jar
-rw-r--r--   1 xiao  staff    27K Oct 21 17:39 hadoop-dist-3.0.0-alpha2-SNAPSHOT-test-sources.jar
-rw-r--r--   1 xiao  staff    27K Oct 21 17:39 hadoop-dist-3.0.0-alpha2-SNAPSHOT-sources.jar
-rw-r--r--   1 xiao  staff   179M Oct 21 17:39 hadoop-3.0.0-alpha2-SNAPSHOT.tar.gz
{noformat}
That is, the final javadoc.jar is gone....?&%^!?, So one thing to note is that the various hadoop-dist JARs are dummies, they don't have meaningful contents:

{noformat}
-> % jar -tf ./hadoop-dist/target/hadoop-dist-3.0.0-alpha2-SNAPSHOT.jar
META-INF/
META-INF/MANIFEST.MF
META-INF/LICENSE.txt
META-INF/NOTICE.txt
META-INF/maven/
META-INF/maven/org.apache.hadoop/
META-INF/maven/org.apache.hadoop/hadoop-dist/
META-INF/maven/org.apache.hadoop/hadoop-dist/pom.xml
META-INF/maven/org.apache.hadoop/hadoop-dist/pom.properties
{noformat}

So, I'm not sure what exactly people expect to find in this javadoc jar. Downstreams typically reference our hadoop-client artifact, not hadoop-dist, and the per-module javadocs are still being generated.

If anything, it might be a mistake that we're generating JARs in hadoop-dist at all. I believe the purpose of hadoop-dist is to call dist-layout-stitching to assemble the tarball layout from the other modules. However, since it inherits maven-jar-plugin from a parent pom, the default-jar execution is generating these dummy jars.

I'll play with a patch that cleans this up too., Patch attached, I disable the artifacts attached by the "dist" profile by binding the executions to a non-existent phase., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 16s{color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 18s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  8m 14s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  8m 41s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 28s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 23s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 19s{color} | {color:green} trunk passed {color} |
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 18s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:red}-1{color} | {color:red} mvninstall {color} | {color:red}  0m 10s{color} | {color:red} hadoop-dist in the patch failed. {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  8m 36s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  8m 36s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 27s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 24s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} xml {color} | {color:green}  0m  3s{color} | {color:green} The patch has no ill-formed XML file. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 21s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m  9s{color} | {color:green} hadoop-project in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 12s{color} | {color:green} hadoop-dist in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 25s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 30m 41s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:9560f25 |
| JIRA Issue | HADOOP-8500 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12836229/HADOOP-8500.002.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  xml  |
| uname | Linux dd6a87b8944e 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / a1761a8 |
| Default Java | 1.8.0_101 |
| mvninstall | https://builds.apache.org/job/PreCommit-HADOOP-Build/10933/artifact/patchprocess/patch-mvninstall-hadoop-dist.txt |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/10933/testReport/ |
| modules | C: hadoop-project hadoop-dist U: . |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/10933/console |
| Powered by | Apache Yetus 0.4.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, Thanks Andrew for the explanation! I haven't heard of any use case of the hadoop-dist javadoc jar either. So +1 to remove the dummy jars.

It seems {{mvn clean install -DskipTests}} is broken though. :(
, My bad, should have tested install too. 003 disables the install plugin too, since we don't need to install these dummy artifacts., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 15s{color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 15s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  8m 34s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  8m  8s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 25s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 22s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 19s{color} | {color:green} trunk passed {color} |
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 15s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 16s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  6m 49s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  6m 49s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 25s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 22s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} xml {color} | {color:green}  0m  2s{color} | {color:green} The patch has no ill-formed XML file. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 19s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m  9s{color} | {color:green} hadoop-project in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 11s{color} | {color:green} hadoop-dist in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 21s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 28m  9s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:9560f25 |
| JIRA Issue | HADOOP-8500 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12836238/HADOOP-8500.003.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  xml  |
| uname | Linux c40efd284c9b 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / 90dd3a8 |
| Default Java | 1.8.0_101 |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/10937/testReport/ |
| modules | C: hadoop-project hadoop-dist U: . |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/10937/console |
| Powered by | Apache Yetus 0.4.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, Thanks Andrew, +1 from me., Committed to trunk, thanks Xiao for reviewing!, SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #10739 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/10739/])
HADOOP-8500. Fix javadoc jars to not contain entire target directory. (wang: rev 7ba74befcff2f1836c2d5123d64e92a3c7a8898c)
* (edit) hadoop-project/pom.xml
* (edit) hadoop-dist/pom.xml
, {code}
$ git status
On branch h13397
Untracked files:
  (use "git add <file>..." to include in what will be committed)

	hadoop-common-project/hadoop-common/api/
	hadoop-hdfs-project/hadoop-hdfs-client/api/
	hadoop-hdfs-project/hadoop-hdfs/api/
{code}

:(, Thanks for the catch Allen, filed HADOOP-13784 with a fix.]