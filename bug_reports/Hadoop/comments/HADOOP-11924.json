[[~mingma], are you interested in finishing this JIRA?, Attaching a first patch., [~mingma] [~jira.shegalov] let me succeed this issue. Could you check a first patch?, Hi [~ozawa], I will be on a break for a week. 

I like that you added {{catch (Throwable t)}} after IOException. How about we don't have the elaborate behavior all the time, but just turned on for this one test. We probably should not hide it in production although for sure it will surface in another call stack anyways.

In test we can set something like  {{Shell.ignoreJDK8047340 = true; }}

Then you can && it with your other conditions.

, Thanks [~jira.shegalov] for the suggestion and [~ozawa] for picking this up. There are many places that call ShellCommandExecutor execute. So people will find out quickly hadoop doesn't work on Turkish FreeBSD or MAC after isSetsidSupported swallows the Error., \\
\\
| (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  15m  5s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 1 new or modified test files. |
| {color:green}+1{color} | javac |   7m 52s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |   9m 43s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 22s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m  7s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 34s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 33s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   1m 40s | The patch does not introduce any new Findbugs (version 2.0.3) warnings. |
| {color:green}+1{color} | common tests |  23m 19s | Tests passed in hadoop-common. |
| | |  61m 18s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12732422/HADOOP-11924.001.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / f24452d |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/6678/artifact/patchprocess/testrun_hadoop-common.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/6678/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf904.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/6678/console |


This message was automatically generated., [~ozawa], are you going to work on 002? I think at the very least we should change the log level when swallowing the exception. The exception itself should also be included in the LOG statement:
{code}
 LOG.info("Avoiding JDK-8047340 on BSD-based systems.", t);
{code}, Thanks [~jira.shegalov] and [~mingma] for your reviews. Updating a patch to change the log level for a message., \\
\\
| (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  16m 36s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 1 new or modified test files. |
| {color:green}+1{color} | javac |   7m 33s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |   9m 38s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 22s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m  8s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 36s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 33s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   1m 50s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | common tests |  23m 25s | Tests passed in hadoop-common. |
| | |  62m 45s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12737103/HADOOP-11924.002.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 54f83d9 |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/6903/artifact/patchprocess/testrun_hadoop-common.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/6903/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf901.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/6903/console |


This message was automatically generated., Thanks for 002 [~ozawa]!

A couple of points I missed previously:

The patch uses {{t.getLocalizedMessage}}. Would not this mean that in an unlikely case that JDK implemented localization for java.lang.Error "contains" for the English description won't work. Can we switch to {{getMessage()}}. 

We also log the exception itself.

Instead of doing instanceof check we can rely on catch. 

In summary:
{code}
    }  catch (Error err) {
      if (err.getMessage().contains("posix_spawn is not " +
              "a supported process launch mechanism")
          && (Shell.FREEBSD || Shell.MAC)) {
        // HADOOP-11924: This is a workaround to avoid failure of class init
        // by JDK issue on TR locale(JDK-8047340).
        LOG.info("Avoiding JDK-8047340 on BSD-based systems.", err);
        setsidSupported = false;
      }
    }  finally { // handle the exit code
{code}, [~jira.shegalov] thank you for the review. Agreeing with you and attaching a updated patch. , +1 pending Jenkins., \\
\\
| (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  16m 15s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 1 new or modified test files. |
| {color:green}+1{color} | javac |   7m 30s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |   9m 37s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 22s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m  5s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 36s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 32s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   1m 48s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | common tests |  23m 56s | Tests passed in hadoop-common. |
| | |  62m 45s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12737627/HADOOP-11924.003.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / dbed757 |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/6923/artifact/patchprocess/testrun_hadoop-common.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/6923/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf901.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/6923/console |


This message was automatically generated., FAILURE: Integrated in Hadoop-trunk-Commit #7969 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/7969/])
HADOOP-11924. Tolerate JDK-8047340-related exceptions in Shell#isSetSidAvailable preventing class init. (Tsuyoshi Ozawa via gera) (gera: rev 9f6d67844da3c6ca1de66d426790e741e77f8038)
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/util/TestStringUtils.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/Shell.java
, Thanks [~ozawa] for contribution! Committed to trunk and branch-2., Thanks Gera and Ming for your reviews and committing!, FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #219 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/219/])
HADOOP-11924. Tolerate JDK-8047340-related exceptions in Shell#isSetSidAvailable preventing class init. (Tsuyoshi Ozawa via gera) (gera: rev 9f6d67844da3c6ca1de66d426790e741e77f8038)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/Shell.java
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/util/TestStringUtils.java
, SUCCESS: Integrated in Hadoop-Yarn-trunk #949 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/949/])
HADOOP-11924. Tolerate JDK-8047340-related exceptions in Shell#isSetSidAvailable preventing class init. (Tsuyoshi Ozawa via gera) (gera: rev 9f6d67844da3c6ca1de66d426790e741e77f8038)
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/util/TestStringUtils.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/Shell.java
, SUCCESS: Integrated in Hadoop-Hdfs-trunk #2147 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2147/])
HADOOP-11924. Tolerate JDK-8047340-related exceptions in Shell#isSetSidAvailable preventing class init. (Tsuyoshi Ozawa via gera) (gera: rev 9f6d67844da3c6ca1de66d426790e741e77f8038)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/Shell.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/util/TestStringUtils.java
* hadoop-common-project/hadoop-common/CHANGES.txt
, FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #208 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/208/])
HADOOP-11924. Tolerate JDK-8047340-related exceptions in Shell#isSetSidAvailable preventing class init. (Tsuyoshi Ozawa via gera) (gera: rev 9f6d67844da3c6ca1de66d426790e741e77f8038)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/Shell.java
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/util/TestStringUtils.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #2165 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2165/])
HADOOP-11924. Tolerate JDK-8047340-related exceptions in Shell#isSetSidAvailable preventing class init. (Tsuyoshi Ozawa via gera) (gera: rev 9f6d67844da3c6ca1de66d426790e741e77f8038)
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/util/TestStringUtils.java
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/Shell.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #217 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/217/])
HADOOP-11924. Tolerate JDK-8047340-related exceptions in Shell#isSetSidAvailable preventing class init. (Tsuyoshi Ozawa via gera) (gera: rev 9f6d67844da3c6ca1de66d426790e741e77f8038)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/Shell.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/util/TestStringUtils.java
* hadoop-common-project/hadoop-common/CHANGES.txt
]