[Stack traces of any NPEs would be handy. , Uses sh, id, sed, cut instead of whoami, Currently, we don't require sh, cut and sed.  These changes may break existing systems.  BTW, we do assume bash., ok, good to know...

bash might be missing on systems like Solaris and BSD though and/or in a different path., I think a better change is for Hadoop to simply try /usr/ucb/whoami if exec whoami fails. This code executes only once, so I don't see any downside of trying multiple locations for better user experience.

Another possibility is to use JNA (http://jna.dev.java.net/) and make a libc call from within Java., A patch to call /usr/ucb/whoami is at http://github.com/kohsuke/hadoop/commit/0fe42e97df3a3d4fec9bb503f3eee266eadd1e02, Patch extracted from Git, Calling /usr/ucb/whoami directly is definitely the way to go, IMO.  It is going to exist on all but the most hardened of Solaris boxes., Hey Allen, if you can +1, we can commit changes similar to Kohsuke's into the trunk to at least have whoami working on Solaris (its a startâ€¦).

Let me know if there really is no better way for sure., 
This is essentially fixed by using the native libraries in newer releases of Hadoop.  The problem is that the native code is completely non-portable and the committer community has shown no real desire to make that code portable.  I don't believe we should encourage folks to run without the native code because the performance is likely to be seriously horrendous.  (My anecdotal experience says the NN in 0.20.20x is 10-15% slower compared to 0.20.2).

At this point, I'd close this as won't fix, just like I did all of my portability JIRAs (including some with patches).  I think pretending that we care about portability is sort of silly at this point when it has been demonstrated over and over that we don't., Now I really am going to close this as Won't Fix, especially since we finally removed the requirement for whoami.]