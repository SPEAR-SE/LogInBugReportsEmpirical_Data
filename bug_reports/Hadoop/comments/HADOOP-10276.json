[Cloned from HADOOP-9652, as that JIRA lays the groundwork but does not completely fix the originally reported issue.]