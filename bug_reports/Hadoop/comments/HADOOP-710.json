[This is a bug in DFSClient.DFSOutputStream.write(byte[], int, int). It calls endBlock only when the buffer becomes full., Patch attached. This patch fixes the bug in DFSOutputStream. It also contains a unit test to reproduce the bug in the absence of this bug-fix.
, Patch available., You should parenthesize that subtraction.  (a - b) -c is not the same as a - (b - c), and we shouldn't require developers to remember which a - b -c is (i.e., I can't)., Updated patch attached., Patch available., I just committed this.  Thanks, Milind!]