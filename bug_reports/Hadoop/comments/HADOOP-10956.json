[The script should also copy LICENSE, NOTICE and README txt files to the top-level directory. , Fixed the script to include docs and the necessary txt files. , [~tucu00], [~acmurthy] - I believe you are the most familiar with these scripts. 

With this fix, one just needs to fire the build, sign and deploy mvn artifacts, sign and host an RC. , Posted it too soon. Was hoping either of Alejandro/Arun could review this patch. , Here is an updated patch that includes the docs only once and hence keeps the binary tarball small. , Would reviewers prefer me hosting src and binary tarballs generated using this script somewhere public? , To get the CHANGES.txt, releasenotes.html, NOTICE.txt, README.txt, LICENCE.txt files, we should do it via assembly descriptors, for example:


{code}
    <fileSet>
      <useStrictFiltering>true</useStrictFiltering>
      <outputDirectory>/</outputDirectory>
      <includes>
        <include>NOTICE.txt</include>
        <include>README.txt</include>
        <include>LICENSE.txt</include>
      </includes>
    </fileSet>
{code}

For the source tarball this should be in:

hadoop-assemblies/src/main/resources/assemblies/hadoop-src.xml

For the binary tarball this should be in the hadoop-dist/pom.xml, in the dist profile where the run cp calls are done.
, http://people.apache.org/~kasha/newscript-hadoop-2.5.0/ has the tarballs generated with the latest script. , Thanks Tucu. Will look into doing it through descriptors. , {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12663540/hadoop-10956-2.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

        {color:red}-1 release audit{color}.  The applied patch generated 3 release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in .

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4530//testReport/
Release audit warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/4530//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4530//console

This message is automatically generated., I updated hadoop-dist/pom.xml to copy LICENSE, NOTICE and README into the binary tarball. 

However, I couldn't get the assembly plugin to work. I tried bumping it to 2.4.1, removing useStrictFiltering, and changing NOTICE.txt to **/NOTICE.txt but couldn't get those files to copy into the tarball. [~tucu00] - can you help me with this? Or, is it okay to leave the patch as is? 

The tarballs generated like this are here: http://people.apache.org/~kasha/newscript-hadoop-2.5.0/, the bin tarball has an api/ dir with the javadocs at top level (the hdfs javadocs seem missing from there, didn't check if other ones are missing), the share/docs/.. dir has only CHANGES/LICENSE/NOTICE/README files (there is no need for those there as they are at top level), all other docs are missing., Thanks for looking into it [~tucu00]. 

In the bin tarball, I should move the docs/site to share/doc/hadoop/ - will do that shortly. 

It appears the HDFS javadocs are not generated by the site plugin. See http://hadoop.apache.org/docs/r2.2.0/api/index.html . It appears this has been the case since HADOOP-7782, the pom.xml has the following to skip anything HDFS - 
{code}
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-javadoc-plugin</artifactId>
        <version>2.8.1</version>
        <inherited>false</inherited>
       ..................
              <reportOutputDirectory>${project.build.directory}/site</reportOutputDirectory>
              <destDir>hadoop-project/api</destDir>
              <!-- Non-public APIs -->
              <excludePackageNames>org.apache.hadoop.authentication*,org.apache.hadoop.hdfs*,org.apache.hadoop.mapreduce.v2.proto,org.apache.hadoop.yarn.proto,org.apache.hadoop.yarn.server*,org.apache.hadoop.yarn.webapp*</excludePackageNames>
{code}

[~tomwhite], [~acmurthy] - any ideas on if there is a way to include Public-Stable HDFS API docs? , {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12663574/hadoop-10956-3.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-dist.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4534//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4534//console

This message is automatically generated., Updated patch to copy site/docs to share/doc/hadoop

Will wait to hear from others on how to handle HDFS javadocs. , {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12663772/hadoop-10956-4.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-dist.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4536//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4536//console

This message is automatically generated., The jars generated using the latest patch are at: http://people.apache.org/~kasha/newscript-hadoop-2.5.0, [~kasha],

We should move the LICENSE/README/NOTICE TXT files from common/hdfs/yarn/mapred down to the root of the source.

The attached assemby-src-tweak.patch will make the src packing to pick them up.

A fast way of creating the SRC tarball is {{mvn clean package -Psrc -N}}

You'll have to modify the BIN tarball building to include the TXT files. that is hadoop-dist POM TAR stitching., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12665426/assembly-src-tweak.patch
  against trunk revision c60da4d.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:red}-1 javac{color:red}.  The patch appears to cause the build to fail.

Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4601//console

This message is automatically generated., Thanks Alejandro. The latest patch incorporates your suggestions. 

http://people.apache.org/~kasha/HADOOP-10956-out/ has the output from the v5 patch. , +1, LGTM, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12666063/hadoop-10956-5.patch
  against trunk revision 727331b.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-assemblies hadoop-common-project/hadoop-common hadoop-dist hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.metrics2.impl.TestMetricsSystemImpl
                  org.apache.hadoop.hdfs.server.balancer.TestBalancerWithSaslDataTransfer
                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover
                  org.apache.hadoop.hdfs.web.TestWebHdfsFileSystemContract
                  org.apache.hadoop.hdfs.server.balancer.TestBalancer

                                      The following test timeouts occurred in hadoop-assemblies hadoop-common-project/hadoop-common hadoop-dist hadoop-hdfs-project/hadoop-hdfs:

org.apache.hadoop.hdfs.TestDFSClientRetries

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4632//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4632//console

This message is automatically generated., All the tests pass locally for me. 

Thanks for the review, Alejandro. I ll go ahead and commit this. , Just committed this to trunk through branch-2.5.1, FAILURE: Integrated in Hadoop-Yarn-trunk #670 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/670/])
HADOOP-10956. Fix create-release script to include docs and necessary txt files. (kasha) (kasha: rev ce0462129fe09898fd9b169cae0564cb6d9bc419)
* hadoop-common-project/hadoop-common/README.txt
* NOTICE.txt
* README.txt
* LICENSE.txt
* hadoop-common-project/hadoop-common/LICENSE.txt
* hadoop-yarn-project/NOTICE.txt
* dev-support/create-release.sh
* hadoop-yarn-project/LICENSE.txt
* hadoop-mapreduce-project/LICENSE.txt
* hadoop-common-project/hadoop-common/NOTICE.txt
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-assemblies/src/main/resources/assemblies/hadoop-src.xml
* hadoop-mapreduce-project/NOTICE.txt
* hadoop-dist/pom.xml
* hadoop-hdfs-project/hadoop-hdfs/LICENSE.txt
* hadoop-hdfs-project/hadoop-hdfs/NOTICE.txt
, FAILURE: Integrated in Hadoop-Hdfs-trunk #1861 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1861/])
HADOOP-10956. Fix create-release script to include docs and necessary txt files. (kasha) (kasha: rev ce0462129fe09898fd9b169cae0564cb6d9bc419)
* hadoop-hdfs-project/hadoop-hdfs/LICENSE.txt
* hadoop-mapreduce-project/LICENSE.txt
* README.txt
* hadoop-yarn-project/NOTICE.txt
* LICENSE.txt
* hadoop-common-project/hadoop-common/README.txt
* dev-support/create-release.sh
* hadoop-hdfs-project/hadoop-hdfs/NOTICE.txt
* hadoop-yarn-project/LICENSE.txt
* NOTICE.txt
* hadoop-common-project/hadoop-common/LICENSE.txt
* hadoop-dist/pom.xml
* hadoop-mapreduce-project/NOTICE.txt
* hadoop-common-project/hadoop-common/NOTICE.txt
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-assemblies/src/main/resources/assemblies/hadoop-src.xml
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #1886 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1886/])
HADOOP-10956. Fix create-release script to include docs and necessary txt files. (kasha) (kasha: rev ce0462129fe09898fd9b169cae0564cb6d9bc419)
* LICENSE.txt
* README.txt
* hadoop-hdfs-project/hadoop-hdfs/LICENSE.txt
* hadoop-yarn-project/LICENSE.txt
* hadoop-common-project/hadoop-common/README.txt
* hadoop-mapreduce-project/NOTICE.txt
* hadoop-hdfs-project/hadoop-hdfs/NOTICE.txt
* hadoop-common-project/hadoop-common/LICENSE.txt
* dev-support/create-release.sh
* hadoop-mapreduce-project/LICENSE.txt
* NOTICE.txt
* hadoop-assemblies/src/main/resources/assemblies/hadoop-src.xml
* hadoop-yarn-project/NOTICE.txt
* hadoop-common-project/hadoop-common/NOTICE.txt
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-dist/pom.xml
]