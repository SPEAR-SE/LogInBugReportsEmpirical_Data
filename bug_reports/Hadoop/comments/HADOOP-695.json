[This patch avoids a NPE by performing a null pointer check before the pointer is read., I just committed this.  Thanks, Hairong!]