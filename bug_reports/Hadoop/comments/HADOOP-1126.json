[This patch fixed the described problem. It also changed the name of the class by incorporating the suggestion in HADOOP-1026.

I tested the patch at a one-node cluster and saw 0 block in the underReplicatedBlocks when the namenode restarted and left the safe mode., +1. Code reviewed., I've just committed this. Thanks Hairong!, Integrated in Hadoop-Mapreduce-trunk #208 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-Mapreduce-trunk/208/])
    , Integrated in Hadoop-Mapreduce-trunk-Commit #225 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-Mapreduce-trunk-Commit/225/])
    ]