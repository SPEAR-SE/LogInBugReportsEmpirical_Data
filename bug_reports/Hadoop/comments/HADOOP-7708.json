[hadoop-metrics2.propreties and log4j.properties don't get replaced if those configuration files already exist in the HADOOP_CONF_DIR directory.  The intended fix is to always replace existing configuration files when hadoop-setup-conf.sh is called.  , Replace log4j.properties and hadoop-metrics2.properties if they already existed., Does it make sense to make the option to replace an existing file or not behave the same for all files not just some specific files?

May be we can take an input from the user whether he wants to replace the configs or not? That way he only gets the new config files?, This may make sense to be optional, similar as in RPMs you would flag these as %config files =you don't always want your custom settings to get stamped on. Maybe the tactic is to warn that the copies don't get copied. the Gnu cp command supports the -b option to do a backup too.

, oh, and the problem with asking the user (e.g. cp --interactive) is that it doesn't work on automated rollouts. You really want the action option (overwrite/preserve) to be passed down, We should keep the operation idempotent.  Therefore, the result of the hadoop-setup-conf script should be consistent when same parameters are passed to the script.  The optional parameter to diverge the configuration state, seems dangerous for upgrade case., Same patch for trunk., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12497551/HADOOP-7708-trunk.patch
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed unit tests in .

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/259//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/259//console

This message is automatically generated., Eric this block also needs to be added to the block when its not automated. Other than that everything looks good., - Revised template generation code to be consistent for all config files for 0.20 security and 0.20.205 branch, Same patch for trunk., +1 tested the new script on a 205 cluster and it replaced the log4j.properties with a new one and moved the old one to .bak, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12497704/HADOOP-7708-trunk-1.patch
  against trunk revision .

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed unit tests in .

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/265//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/265//console

This message is automatically generated., I just committed this to 0.20.205, 0.20 security, 0.23 and trunk.  Thanks Arpit., Integrated in Hadoop-Common-trunk-Commit #1013 (See [https://builds.apache.org/job/Hadoop-Common-trunk-Commit/1013/])
    HADOOP-7708. Fixed hadoop-setup-conf.sh to handle config file
consistently.  (Eric Yang)
HADOOP-7708. Fixed hadoop-setup-conf.sh to handle config files
consistently.  (Eric Yang)

eyang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1178969
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/packages/hadoop-setup-conf.sh

eyang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1178965
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/packages/hadoop-setup-conf.sh
, Integrated in Hadoop-Hdfs-trunk-Commit #1091 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/1091/])
    HADOOP-7708. Fixed hadoop-setup-conf.sh to handle config file
consistently.  (Eric Yang)
HADOOP-7708. Fixed hadoop-setup-conf.sh to handle config files
consistently.  (Eric Yang)

eyang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1178969
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/packages/hadoop-setup-conf.sh

eyang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1178965
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/packages/hadoop-setup-conf.sh
, Integrated in Hadoop-Mapreduce-trunk-Commit #1031 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/1031/])
    HADOOP-7708. Fixed hadoop-setup-conf.sh to handle config file
consistently.  (Eric Yang)
HADOOP-7708. Fixed hadoop-setup-conf.sh to handle config files
consistently.  (Eric Yang)

eyang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1178969
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/packages/hadoop-setup-conf.sh

eyang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1178965
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/packages/hadoop-setup-conf.sh
, Integrated in Hadoop-Hdfs-trunk #821 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/821/])
    HADOOP-7708. Fixed hadoop-setup-conf.sh to handle config file
consistently.  (Eric Yang)
HADOOP-7708. Fixed hadoop-setup-conf.sh to handle config files
consistently.  (Eric Yang)

eyang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1178969
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/packages/hadoop-setup-conf.sh

eyang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1178965
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/packages/hadoop-setup-conf.sh
, Integrated in Hadoop-Hdfs-0.23-Build #30 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/30/])
    HADOOP-7708. Fixed hadoop-setup-conf.sh to handle config file
consistently.  (Eric Yang)
HADOOP-7708. Fixed hadoop-setup-conf.sh to handle config file
consistently.  (Eric Yang)

eyang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1178967
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/src/main/packages/hadoop-setup-conf.sh

eyang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1178966
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/src/main/packages/hadoop-setup-conf.sh
, Integrated in Hadoop-Mapreduce-0.23-Build #37 (See [https://builds.apache.org/job/Hadoop-Mapreduce-0.23-Build/37/])
    HADOOP-7708. Fixed hadoop-setup-conf.sh to handle config file
consistently.  (Eric Yang)
HADOOP-7708. Fixed hadoop-setup-conf.sh to handle config file
consistently.  (Eric Yang)

eyang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1178967
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/src/main/packages/hadoop-setup-conf.sh

eyang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1178966
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/src/main/packages/hadoop-setup-conf.sh
, Integrated in Hadoop-Mapreduce-trunk #851 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/851/])
    HADOOP-7708. Fixed hadoop-setup-conf.sh to handle config file
consistently.  (Eric Yang)
HADOOP-7708. Fixed hadoop-setup-conf.sh to handle config files
consistently.  (Eric Yang)

eyang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1178969
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/packages/hadoop-setup-conf.sh

eyang : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1178965
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/packages/hadoop-setup-conf.sh
, Closed upon release of 0.20.205.0]