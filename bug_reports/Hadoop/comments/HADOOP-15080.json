[Based on today's activity on LEGAL-349, this dependency needs to be removed.

What's the next step? [~Sammi] do you have a patch to either replace json-lib or revert out Aliyun OSS?, Just to make sure we have at least one legal option to proceed here, attaching a patch that removes the aliyun-oss module by reverting all of the commits that affect hadoop-tools/hadoop-aliyun. Of course if we can just replace the dependency with another option, I'm obviously all for that instead. Just putting this up here if there's no other option in the near future.

A couple of Maven version updates and some more general test modifications (6a52b5e14495c5b2e0257aec65e61acd43aef309, 0d5c8ed8e0176909ee4d68b2969a882c21c0df55) were not reverted directly (hence the conflicts below), and one other removal from the hadoop-cloud-storage module was needed to compile (see HADOOP-13687). Here's a summary of all the other commit messages to document what would need to be added back if we can figure this out later on a slower timeframe:

{quote}
    Revert "HADOOP-14787. AliyunOSS: Implement the `createNonRecursive` operator."
    
    This reverts commit 27ab5f7385c70f16fd593edc336c573c69f19331.
    
    Revert "HADOOP-14194. Aliyun OSS should not use empty endpoint as default. Contributed by Genmao Yu"
    
    This reverts commit 267e19a09f366a965b30c8d4dc75e377b0d92fff.
    
    Revert "HADOOP-14466. Remove useless document from TestAliyunOSSFileSystemContract.java. Contributed by Chen Liang."
    
    This reverts commit 6e6e96583f1ee3c8a8775480f41c3adcdd5e2c45.
    
    Revert "HADOOP-14458. Add missing imports to TestAliyunOSSFileSystemContract.java. Contributed by Mingliang Liu."
    
    This reverts commit 07e60f85d87ca9a585d351a308ee0ecfa9293750.
    
    Revert "HADOOP-14192. Aliyun OSS FileSystem contract test should implement getTestBaseDir(). Contributed by Mingliang Liu"
    
    This reverts commit 86035c16447eb0ad7989975639f83bc4b4b26a27.
    
    Revert "HADOOP-14072. AliyunOSS: Failed to read from stream when seek beyond the download size. Contributed by Genmao Yu"
    
    This reverts commit cd3e59a3dcc69f68711777d448da5228a55846b3.
    
    Revert "HADOOP-14069. AliyunOSS: listStatus returns wrong file info. Contributed by Fei Hui"
    
    This reverts commit 01be4503c3b053d2cff0b179774dabfd267877db.
    
    Conflicts:
        hadoop-tools/hadoop-aliyun/src/test/java/org/apache/hadoop/fs/aliyun/oss/TestAliyunOSSFileSystemContract.java
    
    Revert "HADOOP-13768. AliyunOSS: handle the failure in the batch delete operation `deleteDirs`. Contributed by Genmao Yu"
    
    This reverts commit 5b151290ae2916dc04d6a4338085fcefafa21982.
    
    Revert "HADOOP-14065. AliyunOSS: oss directory filestatus should use meta time. Contributed by Fei Hui"
    
    This reverts commit a8a594b4c89319bef294534755f0e4ed6198ec88.
    
    Revert "HADOOP-13723. AliyunOSSInputStream#read() should update read bytes stat correctly. Contributed by Mingliang Liu"
    
    This reverts commit d9f73f1b7cd893a7d88baa9bfd1b809a5dec9e59.
    
    Revert "HADOOP-13701. AbstractContractRootDirectoryTest can fail when handling delete "/". Contributed by Genmao Yu"
    
    This reverts commit c31b5e61b1f09949548116309218a2b3e9c0beda.
    
    Revert "HADOOP-13634. Some configuration in doc has been outdated. Contributed by Genmao Yu"
    
    This reverts commit 26d5df390cf976dcc1d17fc68d0fed789dc34e84.
    
    Revert "HADOOP-13624. Rename TestAliyunOSSContractDispCp. Contributed by Genmao Yu"
    
    This reverts commit 22af6f8db3a44cd51514b4851b99adcfad42751d.
    
    Revert "HADOOP-13591. Unit test failure in TestOSSContractGetFileStatus and TestOSSContractRootDir. Contributed by Genmao Yu"
    
    This reverts commit 08b37603d9c0be67c4e0790c1ad266551ef21f5e.
    
    Revert "HADOOP-13609. Refine credential provider related codes for AliyunOss integration. Contributed by Genmao Yu"
    
    This reverts commit 9cd47602576cd01a905e27642b685905a88eee72.
    
    Revert "HADOOP-13610. Clean up AliyunOss integration tests. Contributed by Genmao Yu"
    
    This reverts commit a1940464a498d1e662e5c3843f2d31ce63ec726b.
    
    Conflicts:
        hadoop-tools/hadoop-aliyun/src/test/java/org/apache/hadoop/fs/aliyun/oss/TestOSSFileSystemContract.java
    
    Revert "HADOOP-13481. User documents for Aliyun OSS FileSystem. Contributed by Genmao Yu."
    
    This reverts commit e671a0f52b5488b8453e1a3258ea5e6477995648.
    
    Revert "HADOOP-13529. Do some code refactoring. Contributed by Genmao Yu."
    
    This reverts commit d33e928fbeb1764a724c8f3c051bb0d8be82bbff.
    
    Conflicts:
        hadoop-tools/hadoop-aliyun/src/test/java/org/apache/hadoop/fs/aliyun/oss/TestOSSFileSystemContract.java
    
    Revert "HADOOP-13498. The number of multi-part upload part should not bigger than 10000. Contributed by Genmao Yu."
    
    This reverts commit cdb77110e77b70ed0c1125b2a6a422a8c7c28ec7.
    
    Revert "HADOOP-13499. Support session credentials for authenticating with Aliyun. Contributed by Genmao Yu."
    
    This reverts commit 6bb741b9f811d3a1c0ce4ecc91a78ac47513bb8e.
    
    Revert "HADOOP-13483. File create should throw error rather than overwrite directories. Contributed by Genmao Yu."
    
    This reverts commit bd2d97adeea55bf2c7e4ab475bcc90f3a14e751a.
    
    Revert "HADOOP-13491. Fix several warnings from findbugs. Contributed by Genmao Yu."
    
    This reverts commit 4d84c814fcaf074022593c057d8f8dec4cd461fa.
    
    Revert "HADOOP-12756. Incorporate Aliyun OSS file system implementation. Contributed by Mingfei Shi and Lin Zhou"
    
    This reverts commit a5d5342228050a778b20e95adf7885bdba39985d.
    
    Conflicts:
        hadoop-project/pom.xml
        hadoop-tools/hadoop-aliyun/pom.xml
        hadoop-tools/hadoop-aliyun/src/test/java/org/apache/hadoop/fs/aliyun/oss/TestOSSFileSystemContract.java
{quote}, Just "submitting" to get a Pre-Commit run - I'm not proposing we move forward with this until we've considered less drastic options., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m  0s{color} | {color:blue} Docker mode activated. {color} |
| {color:red}-1{color} | {color:red} patch {color} | {color:red}  0m  7s{color} | {color:red} HADOOP-15080 does not apply to trunk. Rebase required? Wrong Branch? See https://wiki.apache.org/hadoop/HowToContribute for help. {color} |
\\
\\
|| Subsystem || Report/Notes ||
| JIRA Issue | HADOOP-15080 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12900584/HADOOP-15080.001.patch |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/13780/console |
| Powered by | Apache Yetus 0.7.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, Hi [~andrew.wang],  I'm working with Aliyun oss team to find the solutions.  The good news is that the json-lib library is only used in oss sdk test functions. Currently it's marked as "compile dependency" while actually it only requires "test dependency".   So basically two solutions,
1. A new oss sdk which marks "json-lib" as "test dependency".  As test dependency is intransitive.  Hadoop will not been impacted. 
2. A new oss sdk, use "jersey-json" 1.9 version.  "jersey-json" is also "test dependency".  
Solution 2 is preferred for it solve the problem once-at-all.  It will takes 2~3 days to prepare the new oss sdk.  Do you have any concerns about solution 2? 

In the meantime, I agree we should prepare a patch to revert out Aliyun OSS support to not block the release. But if we still have time, may I ask a favor to hold the revert for several days?   Also thanks [~mackrorysd] for prepare the patch. , | (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  2m 48s{color} | {color:blue} Docker mode activated. {color} |
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 19 new or modified test files. {color} |
|| || || || {color:brown} branch-3.0.0 Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 21s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 22m 27s{color} | {color:green} branch-3.0.0 passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 12m 30s{color} | {color:green} branch-3.0.0 passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  1m 58s{color} | {color:green} branch-3.0.0 passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  3m 14s{color} | {color:green} branch-3.0.0 passed {color} |
| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 15m 20s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m  0s{color} | {color:blue} Skipped patched modules with no Java source: hadoop-project hadoop-cloud-storage-project/hadoop-cloud-storage hadoop-tools hadoop-tools/hadoop-tools-dist {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m 35s{color} | {color:green} branch-3.0.0 passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  2m 21s{color} | {color:green} branch-3.0.0 passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 14s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  2m 54s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 39s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 10m 39s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  1m 58s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  2m 45s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} xml {color} | {color:green}  0m  4s{color} | {color:green} The patch has no ill-formed XML file. {color} |
| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green}  9m 45s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m  0s{color} | {color:blue} Skipped patched modules with no Java source: hadoop-project hadoop-tools/hadoop-tools-dist hadoop-tools hadoop-cloud-storage-project/hadoop-cloud-storage {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m  0s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m 54s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 18s{color} | {color:green} hadoop-project in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 22s{color} | {color:green} hadoop-tools-dist in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 47m 30s{color} | {color:green} hadoop-tools in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 21s{color} | {color:green} hadoop-cloud-storage in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 34s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black}137m 32s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:20ca677 |
| JIRA Issue | HADOOP-15080 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12900585/HADOOP-15080-branch-3.0.0.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  xml  findbugs  checkstyle  |
| uname | Linux 14dcd0ea5abe 3.13.0-135-generic #184-Ubuntu SMP Wed Oct 18 11:55:51 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/patchprocess/precommit/personality/provided.sh |
| git revision | branch-3.0.0 / c938a54 |
| maven | version: Apache Maven 3.3.9 |
| Default Java | 1.8.0_151 |
| findbugs | v3.1.0-RC1 |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/13781/testReport/ |
| Max. process+thread count | 995 (vs. ulimit of 5000) |
| modules | C: hadoop-project hadoop-tools/hadoop-tools-dist hadoop-tools hadoop-cloud-storage-project/hadoop-cloud-storage U: . |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/13781/console |
| Powered by | Apache Yetus 0.7.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, | (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 11s{color} | {color:blue} Docker mode activated. {color} |
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 19 new or modified test files. {color} |
|| || || || {color:brown} branch-3.0.0 Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 20s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 20m 42s{color} | {color:green} branch-3.0.0 passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 11m 50s{color} | {color:green} branch-3.0.0 passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  1m 59s{color} | {color:green} branch-3.0.0 passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  3m 14s{color} | {color:green} branch-3.0.0 passed {color} |
| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 15m 18s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m  0s{color} | {color:blue} Skipped patched modules with no Java source: hadoop-project hadoop-cloud-storage-project/hadoop-cloud-storage hadoop-tools hadoop-tools/hadoop-tools-dist {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m 35s{color} | {color:green} branch-3.0.0 passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  2m 20s{color} | {color:green} branch-3.0.0 passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 13s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  2m 51s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 41s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 10m 41s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  1m 58s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  2m 44s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} xml {color} | {color:green}  0m  4s{color} | {color:green} The patch has no ill-formed XML file. {color} |
| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green}  9m 38s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m  0s{color} | {color:blue} Skipped patched modules with no Java source: hadoop-project hadoop-tools/hadoop-tools-dist hadoop-tools hadoop-cloud-storage-project/hadoop-cloud-storage {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m  0s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m 52s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 18s{color} | {color:green} hadoop-project in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 21s{color} | {color:green} hadoop-tools-dist in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 46m 49s{color} | {color:green} hadoop-tools in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 22s{color} | {color:green} hadoop-cloud-storage in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 34s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black}131m 39s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:20ca677 |
| JIRA Issue | HADOOP-15080 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12900594/HADOOP-15080-branch-3.0.0.001.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  xml  findbugs  checkstyle  |
| uname | Linux 5f6d0d29efee 3.13.0-135-generic #184-Ubuntu SMP Wed Oct 18 11:55:51 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/patchprocess/precommit/personality/provided.sh |
| git revision | branch-3.0.0 / c938a54 |
| maven | version: Apache Maven 3.3.9 |
| Default Java | 1.8.0_151 |
| findbugs | v3.1.0-RC1 |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/13782/testReport/ |
| Max. process+thread count | 987 (vs. ulimit of 5000) |
| modules | C: hadoop-project hadoop-tools/hadoop-tools-dist hadoop-tools hadoop-cloud-storage-project/hadoop-cloud-storage U: . |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/13782/console |
| Powered by | Apache Yetus 0.7.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, Someone can correct me if a higher authority has already clarified this differently from me, but my interpretation is that solution 2 is acceptable, but solution 1 is not. json-lib is not allowed because of a clause that it only be used for "good, not evil", which would seem to me to apply to it's use in tests just as much as it would to a distribution. So I think even in test-scope we would not be allowed to use it. jersey-json is dual-licensed under CDDL (which can be used in binary form for tests, etc.) and GPL (which is also category-x), and although I can't find where the authors specify that the dual-licensing allows you to abide by either license instead of by both licenses, jersey-json is already in use elsewhere in Hadoop so I would assume this question has already been settled and we can safely use jersey-json in test scope.

So I would vote for solution 2, if we can get that done within a couple of days., I thought we'd got rid of this with the move to the later AWS-SDKs. 

If the dependency is only test time, we can modify the oss SDK import to exclude the json lib, and then explicitly add it as a test-scoped dependency with some big warnings on the import about DO NOT INCLUDE IN COMPILE. 

, Sean: you make some good points. 

If it was just about build/test, then it's not being distributed, so the distribution itself isn't tainted. I'd argue its like using GPL code in test runs, *especially as there is no explicit build against that code in our projects*. If we were using the library directly, we'd be more tightly coupled and justification would be harder.

GPL is special though in that it transitively taints all code. I don't know whether the morality of json "don't be evil" applies downstream. Especially if you don't run the the OSS tests before a release. If, however, the maven artifact of the test module is published, *and* that exports the json requirement, we'd be passing on the problem downstream. A <provided> marker would address that.

# we could do the relabelling of the json dependency as provided immediately, so not keep it away from redistributables of any form
# while Sammi & others work on the OSS release. They've put a lot of effort into this, and I don't want it to be held up just at the last minute....I know how they'd feel

, {quote}explicitly add it as a test-scoped dependency{quote}
Ah - I was wondering if you could conditionally exclude a dependency or change the scope of a transitive one. I guess that's how you do it.

I thought I had seen a specific exception for "weak copyleft" licenses for use in build, development and testing, hence my idea that Jersey's CDDL was much safer than category X. But if we're already using category X in testing, then perhaps the explicit test-scoped dependency is okay (plus I can't find that exception now). My only remaining concern then is that most category X licenses dictate how you're allowed to distribute stuff. json-lib dictates how you *use* stuff, so there's still the ambiguity as far as ASF's liability is concerned. But if it's okay with whoever needs to make that call, then yeah, just a maven hack to prevent this from being included while the OSS folks work on a more elegant solution is fine by me too., scopes: https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Scope, [~mackrorysd], please raise these points on LEGAL-349. I'm sure they'll come up again for other derived projects and it'd be useful to have the decision recorded., Good idea - done., Hi Sammi,

2-3 days is fine, it means we can still cut an RC by end of the week (or maybe a little into next week). Thanks for working with the Aliyun OSS folks to quickly get this resolved! , Hi [~chris.douglas],  [~stevel@apache.org] and [~mackrorysd], thanks all for the information here.  I also have gone through the discussion in LEGAL-349. Here I want to further explain the dependency chain. The decision we made this time might be the guide for further issues.  

Currently aliyun oss sdk requires json-lib as compile dependency on maven repository. Assume we change the dependency scope to "test" as it should be. Here is the dependency chain after that. 

{noformat}
                                                          compile dependency                                     test dependency 
Hadoop oss storage support module   ----------------------------------> aliyun oss sdk  ---------------------------------->  json-lib
{noformat}

json-lib is used in oss sdk test functions, not used in any Hadoop oss storage support module code, including test code. Hadoop project doesn't import any class from json-lib, and not include it in any pom.xml file.  So basically the impact is if when you build Hadoop, maven will download the json-lib library to your local maven repository. That's all. 

From the discussion in LEGAL-349, clearly it's prohibited if json-lib is directly used in Hadoop oss storage support module test code. I'm not sure if  the above case is allowed or not. 

In the meanwhile, jersey-json is picked to replace json-lib. It is currently the number one used json library in Hadoop. So we assume it's safe to use. If anyone do have other opinion, please let me known ASAP.  I will go on with solution 2, try to deliver the new oss sdk to catch up the RC. Thanks [~andrew.wang]!

 

, I think what you're suggesting sounds good: if Hadoop itself can be developed, built and tested without json-lib being on the machine, it's a very big stretch to argue that the ASF is "using" it by any definition. Aliyun is using it, so it's Aliyun's call and a separate issue. Moving to jersey-json sounds good, but isn't required to unblock the release if we can get an SDK that already has the correctly limited SDK, in my opinion. I don't think we got an unambiguous answer, but it sounds like declaring a test-only dependency on json-lib in hadoop-aliyunoss to prevent it from being distributed to end-users might still be considered "use" in the sense that the license refers to., bq.  if Hadoop itself can be developed, built and tested without json-lib being on the machine, it's a very big stretch to argue that the ASF is "using" it by any definition

I agree. It's like saying "we need gcc to build the native code on linux". We do, we just don't redistribute it.

Interesting point about that explicit references though. Doing a grep for gcc in our source, while we don't call it out as the required compiler, we certainly have explicit support for it being used throughout the native libs.


, {quote}I agree. It's like saying "we need gcc to build the native code on linux". We do, we just don't redistribute it.{quote}

I'm still uncomfortable with the comparison to gcc, which is what I don't think is being understood on LEGAL-349: they're both category X licenses, but the GPL restricts distribution, and json-lib is not approved because it restricts usage. I feel like if this library was GPL it would actually be fair game for use as a test dependency. But it's academic now - it sounds like we're all in agreement on the right paths to pursue both immediately and long-term., Aliyun OSS team provides oss sdk 2.8.3 to replace 2.8.1.  json-lib is replaced by Jersey-json 1.9 as "test" scope dependency of oss sdk 2.8.3.  Here is my verification steps, 

1. delete json-lib in local maven repository
2. clean build Hadoop
3. all Hadoop OSS module UT passed
4. check local maven repository, json-lib is not downloaded
, Thanks [~Sammi] for the quick tweak on this! The change LGTM and +1, also having a check on the new sdk and it looks clean., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 10s{color} | {color:blue} Docker mode activated. {color} |
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |
|| || || || {color:brown} branch-3.0.0 Compile Tests {color} ||
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 16m 31s{color} | {color:green} branch-3.0.0 passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m 11s{color} | {color:green} branch-3.0.0 passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 15s{color} | {color:green} branch-3.0.0 passed {color} |
| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 26m 31s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 12s{color} | {color:green} branch-3.0.0 passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 12s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  0m  8s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  0m  8s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 11s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} xml {color} | {color:green}  0m  1s{color} | {color:green} The patch has no ill-formed XML file. {color} |
| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 11m 13s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 11s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  0m 10s{color} | {color:green} hadoop-project in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 19s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 40m  4s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:20ca677 |
| JIRA Issue | HADOOP-15080 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12901021/HADOOP-15080-branch-3.0.0.002.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  xml  |
| uname | Linux 706eed3ae3f5 3.13.0-135-generic #184-Ubuntu SMP Wed Oct 18 11:55:51 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/patchprocess/precommit/personality/provided.sh |
| git revision | branch-3.0.0 / 7f35409 |
| maven | version: Apache Maven 3.3.9 |
| Default Java | 1.8.0_151 |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/13800/testReport/ |
| Max. process+thread count | 298 (vs. ulimit of 5000) |
| modules | C: hadoop-project U: hadoop-project |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/13800/console |
| Powered by | Apache Yetus 0.7.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, Thanks [~drankye] for the review.  I will commit it later.  Thanks [~chris.douglas], [~stevel@apache.org] ,  [~mackrorysd] and [~andrew.wang] for all your support. , SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #13340 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/13340/])
HADOOP-15080.  Aliyun OSS: update oss sdk from 2.8.1 to 2.8.3 to remove (sammi.chen: rev 67b2661e3d73a68ba7ca73b112bf6baea128631e)
* (edit) hadoop-project/pom.xml
, Thanks for the quick turn-around on the new SDK - I can confirm the dependency is gone in trunk. Are you also going to backport branch-3.0 and branch-3.0.0? Happy to do it if you're not already on it., Let's get this backported to branch-3.0 and branch-3.0.0, based on the prior discussion (and that precommit ran against branch-3.0.0) I think it's clear the intent was to get this in for 3.0.0., I just checked and Sammi already backported it. I expected to see Hudson messages for the branch-3* lines as well as trunk. I'll mark this as resolved..., This needs to go to 2.9.1 also right?, Yes, you're right. Cherry-picked to branch-2.9 and branch-2. I checked for any other branches containing references to Aliyun to confirm that's it., Thanks for taking care of this, [~Sammi]. And thanks [~mackrorysd] for following up here and on LEGAL-349, Thanks [~mackrorysd] for backport to branch-2 & branch-2.9. , Hi Andrew,


One simple question. I see there are branches  trunk, branch-3.0 and branch-3.0.0.    

So I assume 3.1.0 is for trunk,    3.0.0 is for branch-3.0.0, and 3.0.1 is for branch-3.0.   

3.0.1 for branch-3.0 is not correct, right? And why? 


Bests,
Sammi

, Your understanding is correct for branches to versions. If your question is about setting fix versions on JIRA, this may be helpful:

https://hadoop.apache.org/versioning.html

In this particular case, setting both 3.0.1 and 3.0.0 is confusing since when a user looks at the 3.0.1 release notes, they want to see the diff since 3.0.0., I see.  Thanks for the explanation [~andrew.wang] .]