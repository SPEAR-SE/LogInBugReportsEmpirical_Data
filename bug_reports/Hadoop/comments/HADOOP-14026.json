[bq.  the current user name can contains some not english characters and upper letters (after all this is usually the name/nickname of the owner)

http://unix.stackexchange.com/questions/76354/who-sets-user-and-username-environment-variables is a quick link to provide more info, but the sum of it is that $USER is almost always set to the user's login name via the login(1) process.  I honestly can't remember the last time I saw a system that didn't do that.  Now there are cases where $USER isn't set (e.g., didn't go in through login), and the appropriate response is to set $USER to the name (e.g., output of id -u -n).

What is your environment that this is not true? , [~aw] Yeah, but we can't assume that somebody's login name not contains any non-english characters nor any upper case english characters. Docker's rule for image names is much more strict than a usual OS's rule for login names. Check out this for example: http://stackoverflow.com/a/25388074

I spent some hours to debug what's the problem with the script, because the error message was misleading. I found out that my user name contains an upper case english character. I can imagine that I'm not the only one who fell into this trap., bq. not contains any non-english characters

That's a violation of POSIX: http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap03.html#tag_03_437 which references http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap03.html#tag_03_278 .

bq. nor any upper case english characters

it's easier then to just pass it through tr.

, Good to know that some Linux are ignoring/extending the POSIX standard. :)
I think it should be better to support every OS and prevent as much failures as we can. If we think for this image name postfix as an input from the environment it's okey to validate the value and ask for another input if it's invalid. But if you disagree with me I can modify the patch., Rather than go through all that work, why not just use the uid instead of the username for the docker name?

ie.

{code}
 docker build -t "hadoop-build-$(id -u)" - <<UserSpecificDocker
{code}, Good idea! :), Attached., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 12s{color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 13m 33s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  9m  6s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  9m  8s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} shellcheck {color} | {color:green}  0m 11s{color} | {color:green} There were no new shellcheck issues. {color} |
| {color:green}+1{color} | {color:green} shelldocs {color} | {color:green}  0m  8s{color} | {color:green} There were no new shelldocs issues. {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 14m 49s{color} | {color:green} root in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 36s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 48m 13s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:a9ad5d6 |
| JIRA Issue | HADOOP-14026 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12850024/HADOOP-14026_v2.patch |
| Optional Tests |  asflicense  mvnsite  unit  shellcheck  shelldocs  |
| uname | Linux 02e9b3f9539b 3.13.0-106-generic #153-Ubuntu SMP Tue Dec 6 15:44:32 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / 312b36d |
| shellcheck | v0.4.5 |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/11532/testReport/ |
| modules | C: . U: . |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/11532/console |
| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, [~aw] Please review it!, LGTM.  +1.  I'll wait a little while to commit to give [~aw] a chance to respond., Committed to branch-2.8, branch-2, and trunk.  Thanks, [~pairg], for the patch, and [~aw] for the reviews., SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #11350 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/11350/])
HADOOP-14026. start-build-env.sh: invalid docker image name (Contributed (templedf: rev c8bd8ac7f9642b8db5949a914f209d5de3d4ef9b)
* (edit) start-build-env.sh
, 2.8.1 became a security release. Moving fix-version to 2.8.2 after the fact., SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #14057 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/14057/])
HADOOP-14026. start-build-env.sh: invalid docker image name (Contributed (aengineer: rev c854e859eb9d2348ab2f3d516c81deca479c2949)
* (edit) start-build-env.sh
]