[Code uploaded for code review. Unit test coming soon., +1. The logic looks correct. This makes sure that only invalid blocks will be deleted. , Does this warrant a 0.12.2 release?  It sounds like it could cause data loss..., I agree that this could cause data loss. , I've just committed this. Thanks Dhruba!

(I've marked it as fixed in 0.13.0, but there is still an open question as to whether this merits a 0.12.2 release.), IMHO this should go to a 0.12.2 release - this looks like pretty serious issue, and at the moment it's still well isolated from other changes in the trunk.]