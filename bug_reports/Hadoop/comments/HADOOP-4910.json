[Is this only in 0.17.0, or later versions as well?, I am still working on a junit testcase, but attaching the fix first.

Yes, this bug affects 0.17 as well as later releases., This patch has a unit test. Without the fix, the unit test will fail, showing that the block gets lost., +1 patch looks good. Simple but important fix.
minor nit : I would suggest removing reference to this jira in comments. Otherwise it gives an impression that reader should read this jira to understand what is happening, which is not necessary. , This is a patch for 0.18. Incorporated Raghu's comment., Patch for the trunk., Ant test-patch passed
     [exec] +1 overall.
     [exec]
     [exec]     +1 @author.  The patch does not contain any @author tags.
     [exec]
     [exec]     +1 tests included.  The patch appears to include 9 new or modified tests.
     [exec]
     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.
     [exec]
     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.
     [exec]
     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.
     [exec]
     [exec]     +1 Eclipse classpath. The patch retains Eclipse classpath integrity.
     [exec]
Ant test-core failed with a known junit test failure reported at HADOOP-4907. All other unit tests passed., I've just committed this.]