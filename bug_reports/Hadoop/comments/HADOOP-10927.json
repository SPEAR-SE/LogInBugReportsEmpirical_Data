[This exception happened due to the following code in CredentialShell.java. The init() function returns 0 instead of -1 if the args is empty, which causes the run() failed.
{code}
  private int init(String[] args) throws IOException {
    for (int i = 0; i < args.length; i++) { // parse command line
      .........
    }
    return 0;
  }
{code}, Yep, I'm about to put up a patch. Writing a test for it., Fix the {{init()}} method to print the help message and return -1 instead of 0. Also fixed malformed and incorrect Javadocs on {{init()}}. Loosened {{init()}} visibility to protected over private so that I could test just that method., Regarding the return value, could you take a look at HADOOP-10816? Returning -1 is probably not right. This would be a good opportunity to fix this issue as well., Sure thing. I thought it was a bit odd to be returning a negative number, but figured I'd just follow suit with what was already there :). I'll get a new patch up later today., Returns code of 1 instead of -1. Updated javadoc too., {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12659523/HADOOP-10927-1.diff
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-common.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4412//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4412//console

This message is automatically generated., Hi Josh, thanks for fixing this.

Nit: In TestCredShell.java, the patch imports java.util.Collections but I don't see it being used. Should it be removed?

Another useful improvement (though not necessary for this patch if you prefer not to) would be to add "hadoop credential" to the main bin/hadoop usage. Right now, when users execute bin/hadoop with no args to see the categories of commands, credential does not show up. It'd be useful to let newer users know of its existence. 
, Thanks for the info, [~schu]! I didn't re-open the code in an IDE to catch the missing import :)

I also took a second to add an extra line to the {{hadoop}} usage message, too., {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12659554/HADOOP-10927-2.diff
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-common.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4415//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4415//console

This message is automatically generated., LGTM. +1 (non-binding). Thank you, Josh., Just one nitty nit from me, if the arg is -help and we print the help, that sounds like successful operation to me. We should return 0 in these cases (I see 3 in init).

+1 pending that., New patch for {{-help}} on a credential command to set a normal exit code. Added a new test case to ensure that the help messages set an exit code of zero., {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12659745/HADOOP-10927-3.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-common.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4424//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4424//console

This message is automatically generated., LGTM will commit this shortly, Committed to trunk and branch-2, thanks Josh., Sweet. Thanks again, [~andrew.wang]. Btw, did you mean to re-assign this to yourself?, Oops, my bad, some kind of JIRA shortcut gone wrong. Assigned it back to you., FAILURE: Integrated in Hadoop-trunk-Commit #6013 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/6013/])
HADOOP-10927. Fix CredentialShell help behavior and error codes. Contributed by Josh Elser. (wang: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1615827)
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/bin/hadoop
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/alias/CredentialShell.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/security/alias/TestCredShell.java
, FAILURE: Integrated in Hadoop-Yarn-trunk #634 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/634/])
HADOOP-10927. Fix CredentialShell help behavior and error codes. Contributed by Josh Elser. (wang: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1615827)
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/bin/hadoop
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/alias/CredentialShell.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/security/alias/TestCredShell.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk #1828 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1828/])
HADOOP-10927. Fix CredentialShell help behavior and error codes. Contributed by Josh Elser. (wang: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1615827)
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/bin/hadoop
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/alias/CredentialShell.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/security/alias/TestCredShell.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #1853 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1853/])
HADOOP-10927. Fix CredentialShell help behavior and error codes. Contributed by Josh Elser. (wang: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1615827)
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/bin/hadoop
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/alias/CredentialShell.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/security/alias/TestCredShell.java
]