[I am running into same issue on Ubuntu, surfacing again on jenkins
{code}
java.lang.Exception: test timed out after 25000 milliseconds
	at java.lang.Object.wait(Native Method)
	at org.apache.hadoop.ha.ZKFailoverController.waitForActiveAttempt(ZKFailoverController.java:472)
	at org.apache.hadoop.ha.ZKFailoverController.doGracefulFailover(ZKFailoverController.java:679)
	at org.apache.hadoop.ha.ZKFailoverController.access$400(ZKFailoverController.java:62)
	at org.apache.hadoop.ha.ZKFailoverController$3.run(ZKFailoverController.java:607)
	at org.apache.hadoop.ha.ZKFailoverController$3.run(ZKFailoverController.java:604)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:415)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1667)
	at org.apache.hadoop.ha.ZKFailoverController.gracefulFailoverToYou(ZKFailoverController.java:604)
	at org.apache.hadoop.ha.ZKFCRpcServer.gracefulFailover(ZKFCRpcServer.java:94)
	at org.apache.hadoop.ha.TestZKFailoverController.testGracefulFailover(TestZKFailoverController.java:448)
{code}, Note that the test is being killed in JUnit as the test hangs, It's doing that as the failover is spinning for 60s in {{ZKFailoverController.doGracefulFailover()}}

{code}
waitForActiveAttempt(timeout + 60000);
{code}

It may be that the test is working, but the 25s timeout is too short. Setting it to 120000 millis would  ensure that the test at least failed with a meaningful exception raised from the ZKFailoverController., Actually TestZKFailoverController is more broken than you'd think. Most of the tests don't run as they lack the Java4 {{@Test}} annotation, (ignore that last comment), Patch --001. 

# Adds a Test rule giving all tests a timeout of 3 minutes
# culls the various timeouts attached to specific tests for a uniform value.
# removes the try/finally cleanup logic for {{cluster.stop}}, instead putting it into an {{@After}} method, so guaranteeing the cluster gets stopped even on a test timeout failure., \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |   7m 25s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 1 new or modified test files. |
| {color:green}+1{color} | javac |   7m 46s | There were no new javac warning messages. |
| {color:red}-1{color} | release audit |   0m 18s | The applied patch generated 1 release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m  3s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  1s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 26s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 32s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   1m 50s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | common tests |   6m 44s | Tests passed in hadoop-common. |
| | |  27m  8s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12765984/HADOOP-11149-001.patch |
| Optional Tests | javac unit findbugs checkstyle |
| git revision | trunk / 7e2c971 |
| Release Audit | https://builds.apache.org/job/PreCommit-HADOOP-Build/7793/artifact/patchprocess/patchReleaseAuditProblems.txt |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7793/artifact/patchprocess/testrun_hadoop-common.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/7793/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf902.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7793/console |


This message was automatically generated., The RAT test should have been fixed by HDFS-9215; if this isn't taking then I'll re-open that, Adding rule for all tests and unifying the @After method is good.

Just one comment, 
Some tests, not even start the cluster. For such tests, @After method will log NPE. I think simple null check inside {{MiniZKFCCluster.stop}} would be better,
{noformat}2015-10-16 15:36:47,043 WARN  ha.ClientBaseWithFixes (TestZKFailoverController.java:teardown(92)) - When stopping the cluster
java.lang.NullPointerException
	at org.apache.hadoop.ha.MiniZKFCCluster.stop(MiniZKFCCluster.java:136)
	at org.apache.hadoop.ha.TestZKFailoverController.teardown(TestZKFailoverController.java:90)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method){noformat}

Rest looks good., Do you think it makes sense to reduce the timeouts of the ZKFC so that the test can run faster as well., # yes, we should add a check for null in zk shutdown
# Haohui, anything which reduces test times without triggering false failures would be welcome. I'll let you suggest those as a followup, patch -002 adds the check for null in the {{stop()}} method, GitHub user steveloughran opened a pull request:

    https://github.com/apache/hadoop/pull/51

    HADOOP-11149 

    zk failover controller test improvements -maybe this'll stop jenkins failing so often

You can merge this pull request into a Git repository by running:

    $ git pull https://github.com/steveloughran/hadoop jenkins/HADOOP-11149-ZKFailoverController

Alternatively you can review and apply these changes as the patch at:

    https://github.com/apache/hadoop/pull/51.patch

To close this pull request, make a commit to your master/trunk branch
with (at least) the following in the commit message:

    This closes #51
    
----
commit be684eff15d8c055aca10ef0fe90be82f74d84cf
Author: Steve Loughran <stevel@hortonworks.com>
Date:   2015-10-10T12:05:26Z

    HADOOP-11149 TestZKFailoverController times out	patch 001

commit 6ede0842a3d4012e1e9c370cc8442c25ebd09410
Author: Steve Loughran <stevel@hortonworks.com>
Date:   2015-10-26T20:20:04Z

    HADOOP-11149-002: MiniZKFCCluster stop() robust against NPE

----
, +1, after Jenkins passes, checking this in., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 0m 0s {color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green} 0m 0s {color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green} 0m 0s {color} | {color:green} The patch appears to include 2 new or modified test files. {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 9m 8s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 40s {color} | {color:green} trunk passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 20s {color} | {color:green} trunk passed with JDK v1.7.0_85 {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 18s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green} 1m 8s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 15s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 2m 8s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 5s {color} | {color:green} trunk passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 12s {color} | {color:green} trunk passed with JDK v1.7.0_85 {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 1m 43s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 9m 56s {color} | {color:green} the patch passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 9m 56s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 2s {color} | {color:green} the patch passed with JDK v1.7.0_85 {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 10m 2s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 17s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green} 1m 12s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 16s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green} 0m 0s {color} | {color:green} Patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 2m 16s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 7s {color} | {color:green} the patch passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 17s {color} | {color:green} the patch passed with JDK v1.7.0_85 {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red} 8m 54s {color} | {color:red} hadoop-common in the patch failed with JDK v1.8.0_66. {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red} 8m 26s {color} | {color:red} hadoop-common in the patch failed with JDK v1.7.0_85. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green} 0m 23s {color} | {color:green} Patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 83m 20s {color} | {color:black} {color} |
\\
\\
|| Reason || Tests ||
| JDK v1.8.0_66 Failed junit tests | hadoop.metrics2.impl.TestGangliaMetrics |
|   | hadoop.ipc.TestIPC |
| JDK v1.7.0_85 Failed junit tests | hadoop.metrics2.impl.TestGangliaMetrics |
|   | hadoop.fs.shell.TestCopyPreserveFlag |
|   | hadoop.ipc.TestIPC |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:0ca8df7 |
| JIRA Issue | HADOOP-11149 |
| GITHUB PR | https://github.com/apache/hadoop/pull/51 |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |
| uname | Linux 88d0e2a3c278 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / a6f20d8 |
| findbugs | v3.0.0 |
| unit | https://builds.apache.org/job/PreCommit-HADOOP-Build/8121/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common-jdk1.8.0_66.txt |
| unit | https://builds.apache.org/job/PreCommit-HADOOP-Build/8121/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common-jdk1.7.0_85.txt |
| unit test logs |  https://builds.apache.org/job/PreCommit-HADOOP-Build/8121/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common-jdk1.8.0_66.txt https://builds.apache.org/job/PreCommit-HADOOP-Build/8121/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common-jdk1.7.0_85.txt |
| JDK v1.7.0_85  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/8121/testReport/ |
| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |
| Max memory used | 75MB |
| Powered by | Apache Yetus   http://yetus.apache.org |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/8121/console |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/8121/console |


This message was automatically generated.

, +1. Committing., Checking this in since the patch of this issue only includes TestZKFailoverController and MiniZKFCCluster. TestGangliaMetrics, TestIPC,  TestCopyPreserveFlag pass locally, and they should be tracked on another jiras.
* TestIPC.testIpcWithReaderQueuing: reopened HADOOP-10406 
* TestGangliaMetrics: HADOOP-12588
* TestCopyPreserveFlag: it looks like to be permission issue or timing issue. Opened HADOOP-12589

, Github user asfgit closed the pull request at:

    https://github.com/apache/hadoop/pull/51
, I've committed the patch to trunk and branch-2. Thanks [~stevel@apache.org] for the contribution., [~wheat9] FYI: I committed to trunk by using github integration: https://wiki.apache.org/hadoop/GithubIntegration.  It works well :-) Thanks you for committing to branch-2.

Thanks [~stevel@apache.org] for the contribution!

, [~wheat9] oh, we crossed the {{git push}}. It can cause the conflicts against CHANGES.txt - should I revert my commit?, FAILURE: Integrated in Hadoop-trunk-Commit #8855 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/8855/])
HADOOP-11149. TestZKFailoverController times out. Contributed by Steve (ozawa: rev 053a5119197db3aef1842d1fa16c0f0872fffcac)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/TestZKFailoverController.java
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/MiniZKFCCluster.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #700 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/700/])
HADOOP-11149. TestZKFailoverController times out. Contributed by Steve (ozawa: rev 053a5119197db3aef1842d1fa16c0f0872fffcac)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/MiniZKFCCluster.java
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/TestZKFailoverController.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #2641 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2641/])
HADOOP-11149. TestZKFailoverController times out. Contributed by Steve (ozawa: rev 053a5119197db3aef1842d1fa16c0f0872fffcac)
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/TestZKFailoverController.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/MiniZKFCCluster.java
, FAILURE: Integrated in Hadoop-Yarn-trunk #1435 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/1435/])
HADOOP-11149. TestZKFailoverController times out. Contributed by Steve (ozawa: rev 053a5119197db3aef1842d1fa16c0f0872fffcac)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/TestZKFailoverController.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/MiniZKFCCluster.java
* hadoop-common-project/hadoop-common/CHANGES.txt
, SUCCESS: Integrated in Hadoop-Yarn-trunk-Java8 #711 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/711/])
HADOOP-11149. TestZKFailoverController times out. Contributed by Steve (ozawa: rev 053a5119197db3aef1842d1fa16c0f0872fffcac)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/TestZKFailoverController.java
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/MiniZKFCCluster.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #629 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/629/])
HADOOP-11149. TestZKFailoverController times out. Contributed by Steve (ozawa: rev 053a5119197db3aef1842d1fa16c0f0872fffcac)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/MiniZKFCCluster.java
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/TestZKFailoverController.java
* hadoop-common-project/hadoop-common/CHANGES.txt
, Please ping me if something goes wrong., FAILURE: Integrated in Hadoop-Hdfs-trunk #2568 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2568/])
HADOOP-11149. TestZKFailoverController times out. Contributed by Steve (ozawa: rev 053a5119197db3aef1842d1fa16c0f0872fffcac)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/TestZKFailoverController.java
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/MiniZKFCCluster.java
, Thanks, Steve!  I committed this to branch-2.7 as well.]