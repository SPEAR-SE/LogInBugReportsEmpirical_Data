[Manual local permission unit test source code and test output.

Can't check in the unit test because it requires user to manually set up some local files and directories with different permissions in dir */tmp*., Patch 001:
* Print meaningful error message when there is no permission to read the local source directory in "fs -put"., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 0m 0s {color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green} 0m 0s {color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:red}-1{color} | {color:red} test4tests {color} | {color:red} 0m 0s {color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 7m 41s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 6m 27s {color} | {color:green} trunk passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 7m 2s {color} | {color:green} trunk passed with JDK v1.7.0_91 {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 20s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green} 1m 3s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 13s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 1m 52s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 53s {color} | {color:green} trunk passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 4s {color} | {color:green} trunk passed with JDK v1.7.0_91 {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 1m 38s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 5m 55s {color} | {color:green} the patch passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 5m 55s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 6m 57s {color} | {color:green} the patch passed with JDK v1.7.0_91 {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 6m 57s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 20s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green} 1m 0s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 14s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green} 0m 0s {color} | {color:green} Patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 2m 0s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 53s {color} | {color:green} the patch passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 1s {color} | {color:green} the patch passed with JDK v1.7.0_91 {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 6m 24s {color} | {color:green} hadoop-common in the patch passed with JDK v1.8.0_66. {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red} 6m 11s {color} | {color:red} hadoop-common in the patch failed with JDK v1.7.0_91. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green} 0m 23s {color} | {color:green} Patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 60m 46s {color} | {color:black} {color} |
\\
\\
|| Reason || Tests ||
| JDK v1.7.0_91 Failed junit tests | hadoop.fs.TestSymlinkLocalFSFileContext |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:0ca8df7 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12784303/HADOOP-12718.001.patch |
| JIRA Issue | HADOOP-12718 |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |
| uname | Linux 17743e26888c 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / 2085e60 |
| Default Java | 1.7.0_91 |
| Multi-JDK versions |  /usr/lib/jvm/java-8-oracle:1.8.0_66 /usr/lib/jvm/java-7-openjdk-amd64:1.7.0_91 |
| findbugs | v3.0.0 |
| unit | https://builds.apache.org/job/PreCommit-HADOOP-Build/8469/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common-jdk1.7.0_91.txt |
| unit test logs |  https://builds.apache.org/job/PreCommit-HADOOP-Build/8469/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common-jdk1.7.0_91.txt |
| JDK v1.7.0_91  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/8469/testReport/ |
| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |
| Max memory used | 77MB |
| Powered by | Apache Yetus 0.2.0-SNAPSHOT   http://yetus.apache.org |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/8469/console |


This message was automatically generated.

, To run the manual unit test:
# In */tmp*, create 2 files *f1* and *f2* with permission *0600*. *f1* should be owned by another user.
# In */tmp", create 2 dirs *d1* and *d2* with permission *0700*. *d1* should be owned by another user. Create some files in these 2 dirs.
# Apply the manual unit test patch, run the unit test *TestFsShellCopyPermission*., HI [~jzhuge],

Thanks for working on this. One little thing:

Currently the patch does:

{{throw new AccessDeniedException("Permission denied to read " + f);}}

On linux, I saw
{code}
[systest@nightly-1 ~]$ ls -l /root/tempfile1
ls: cannot access /root/tempfile1: Permission denied
[systest@nightly-1 ~]$ ls -l /lost+found
ls: cannot open directory /lost+found: Permission denied
{code}

Can we try to make the output similar to linux?
Would you please post your test result on a real cluster with this fix?

Thanks.
, Thanks for the review, [~yzhangal]. Will do., Patch 002:
* Change error message
* Upload manual unit test output

Test the patch on a cdh5.7 cluster:
{noformat}
$ ls -l
total 12
drwx------ 2 hdfs    systest 4096 Jan 26 10:29 d1
drwx------ 2 systest systest 4096 Jan 26 10:29 d2
-rw------- 1 hdfs    systest    0 Jan 26 10:29 f1
-rw------- 1 systest systest    0 Jan 26 10:29 f2
-rw-r--r-- 1 root    root     173 Jan 25 22:17 log4j.log
$ hadoop fs -put f1 /tmp
put: /home/systest/f1 (Permission denied)
$ hadoop fs -put f2 /tmp
$ hadoop fs -put d1 /tmp
put: cannot open directory file:/home/systest/d1: Permission denied
$ hadoop fs -put d2 /tmp
{noformat}, Thanks [~jzhuge] for the new rev. +1 pending jenkins.
, Please note this jira focuses on local dir, not local file. The error message for local file is not confusing, but different from local dir. If we want to ensure consistent error message for both, we'd have to modify a different code path for the local file., Thanks John, yes, I'm aware of that difference based the output you posted. I think it's ok for this jira. If we really want to remove the parenthesis in the message for the local file code path, we can do it later.

, Agree with you.

John Zhuge

, HI [~jzhuge],

I saw
https://builds.apache.org/job/PreCommit-HADOOP-Build/8471/console
tries to apply 

Processing: HADOOP-12718
HADOOP-12718 patch is being downloaded at Tue Jan 26 18:48:49 UTC 2016 from
https://issues.apache.org/jira/secure/attachment/12784460/TestFsShellCopyPermission-output.002.txt
ERROR: Unsure how to process HADOOP-12718.

instead  of your v2, because the last patch you submitted is TestFsShellCopyPermission-output.002.txt. Can you remove HADOOP-12718.002.patch and resubmit it so it will appear as the last file uploaded?

Thanks.

, Re-upload 002 patch., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 0m 0s {color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green} 0m 0s {color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:red}-1{color} | {color:red} test4tests {color} | {color:red} 0m 0s {color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 7m 38s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 5m 59s {color} | {color:green} trunk passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 6m 49s {color} | {color:green} trunk passed with JDK v1.7.0_91 {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 22s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green} 1m 2s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 14s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 1m 49s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 50s {color} | {color:green} trunk passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 1s {color} | {color:green} trunk passed with JDK v1.7.0_91 {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 1m 38s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 6m 2s {color} | {color:green} the patch passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 6m 2s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 6m 47s {color} | {color:green} the patch passed with JDK v1.7.0_91 {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 6m 47s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 20s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green} 1m 0s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 13s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green} 0m 0s {color} | {color:green} Patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 2m 2s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 53s {color} | {color:green} the patch passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 3s {color} | {color:green} the patch passed with JDK v1.7.0_91 {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 6m 27s {color} | {color:green} hadoop-common in the patch passed with JDK v1.8.0_66. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 6m 39s {color} | {color:green} hadoop-common in the patch passed with JDK v1.7.0_91. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green} 0m 22s {color} | {color:green} Patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 60m 21s {color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:0ca8df7 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12784541/HADOOP-12718.002.patch |
| JIRA Issue | HADOOP-12718 |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |
| uname | Linux 6060ec808e69 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / d323639 |
| Default Java | 1.7.0_91 |
| Multi-JDK versions |  /usr/lib/jvm/java-8-oracle:1.8.0_66 /usr/lib/jvm/java-7-openjdk-amd64:1.7.0_91 |
| findbugs | v3.0.0 |
| JDK v1.7.0_91  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/8476/testReport/ |
| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |
| Max memory used | 76MB |
| Powered by | Apache Yetus 0.2.0-SNAPSHOT   http://yetus.apache.org |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/8476/console |


This message was automatically generated.

, Committed to trunk, branch-2, and branch-2.8.

Thanks [~jzhuge] for the contribution.
, FAILURE: Integrated in Hadoop-trunk-Commit #9191 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/9191/])
HADOOP-12718. Incorrect error message by fs -put local dir without (yzhang: rev 97056c3355810a803f07baca89b89e2bf6bb7201)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/RawLocalFileSystem.java
* hadoop-common-project/hadoop-common/CHANGES.txt
, Thanks a lot [~yzhangal]., I'm considering reverting this patch for a few reasons.

First, the patch was not coded to handle Windows correctly.  Changing it to use {{FileUtil#canRead}} would solve that.

However, the larger issue is that this might be backwards-incompatible.  Prior to the patch, lack of access would return {{null}}.  After the patch, lack of access throws an exception.  Although this matches HDFS semantics, applications often have different expectations of the local file system.  If an application was coded to check for {{null}}, but not handle {{AccessDeniedException}}, then there is a risk of breaking that application.

Cc [~stevel@apache.org] for a second opinion from the file system contract perspective.  The current spec for {{listStatus}} does not explicitly require a pre-condition check that lack of access results in {{AccessDeniedException}}.

http://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-common/filesystem/filesystem.html

If we revert this, then something will have to be done about YARN-4842, which included tests that depended on the new exception message.  Cc [~xgong].

I won't revert immediately.  I'll wait until next week so that others get time to consider and comment., [~cnaude] Good point on that the patch alters {{FileSystem#listStatus}} interface to throw a new exception {{AccessDeniedException}}. If we'd keep the patch, we need to make sure all callers can handle the new exception.

On the other hand, nothing indicates {{listStatus}} can return {{null}} and some callers do not test {{null}} before use. See examples below. IMHO, {{listStatus}} should return empty list instead of {{null}}. This probably needs a separate jira to either change {{RawLocalFileSystem#listStatus}} not to return null or fix the callers. 

AbstractContractGetFileStatusTest#testListStatusEmptyDirectory:
{code}
    assertEquals("ls on an empty directory not of length 0", 0,
        fs.listStatus(subfolder).length);
{code}

ChecksumFileSystem#copyToLocalFile:
{code}
      FileStatus[] srcs = listStatus(src);
      for (FileStatus srcFile : srcs) {
{code}

SimpleCopyLIsting#getFileStatus:
{code}
      FileStatus[] fileStatuses = fileSystem.listStatus(path);
      if (excludeList != null && excludeList.size() > 0) {
        ArrayList<FileStatus> fileStatusList = new ArrayList<>();
        for(FileStatus status : fileStatuses) {
{code}, Patch 003:
* Use {{FileUtil#canRead}} instead of {{File#canRead}}
* Update javadoc of {{FileSystem#listStatus}}
* Update filesystem.md

Fix the issues discovered by [~cnauroth]., # There's a {{PathAccessDeniedException}} in Hadoop, not sure if its the one to use or not...my IDE isn't showing much (any?) use of that exception. Given it's obscurity, I'd stick with what the patch has: the java.nio one. (Looking at HADOOP-13130 I See that I'd just picked it up...I'll go to {{java.nio.AccessDeniedException}} there.



I think to tighten the specification properly you're going to have follow the full process
# look at what HDFS does. write a test for this if needed
# Look at what the other filesystems do, such as azure, webHDFS. Ignore S3A, I'm setting that up right now.
# If any of the others return null, they'll need to be fixed.
# then we should consider having a permissions test. This is trickier than it looks, as permissions is where things vary, and setting them can be hard to do in a cross-platform, cross-FS way.

Finally, I'd make the FS requirement, {{throws AccessDeniedException, IOException}} so that it is considered acceptable to raise other exceptions. This will avoid having to fix every other FS so that it is consistent with this tightening of the spec., [~stevel@apache.org], I agree with those suggestions for tightening up the spec if we keep this patch, but first I have a more fundamental question about whether or not we keep the patch at all.

Users of the local file system might not always expect the semantics of the spec and contract tests (as mostly reverse engineered from HDFS).  In some cases, the caller is seeking to emulate HDFS semantics, such as mini-cluster based tests.  In other cases, such as {{LocalDirAllocator}}, a caller explicitly calls {{FileSystem#getLocal}} and expects to work with the semantics of the local file system.  For example, I mentioned on HADOOP-9507/HADOOP-13082 that there had been a case in the past of Hive expecting very particular semantics from the local file system.

Unfortunately, aside from full testing of the whole ecosystem, it's hard to know for sure that this change won't break something, because it's going to start throwing an exception that users of the local file system hadn't seen before.  This is why I was inclined to revert, at least within the 2.x line.  I'd appreciate your thoughts on whether or not this makes sense or I'm being overly paranoid.  Thanks!, yeah, local is trouble. People assume that it just is their local FS.

, I think the patch should use {{o.a.h.security.AccessControlException}} (many usages) instead of {{java.nio.AccessDeniedException}}., I'd like to proceed with this plan:

# Revert the patch previously committed from all branches.
# If you'd still like to pursue this patch, I'd agree to retargeting it to 3.x, where we can mark it backwards-incompatible.
# If continuing on trunk, then we'll fold in the Windows compatibility fix.
# Let's also firm up the spec and contract tests as Steve suggested.  I think you could achieve common testing for HDFS and possibly the local file system.  The test likely can't work in any meaningful way against S3A/WASB/etc., because they enforce authorization to a whole S3 bucket/Azure Storage account/etc. without any meaningful per-file authorization after that.

I'll wait a few days for further comment before I start reverting., The plan sounds good.

I will use this jira to extend the contract with a new {{AccessControlException}} exception to indicate "permission denied".

Created HADOOP-13191 to discuss whether {{null}} is a valid return for {{FileSystem#listStatus}}., I'm going to reopen the issue now and attach a patch to do the revert.  This is just the outcome of running {{git revert --no-commit 97056c3355810a803f07baca89b89e2bf6bb7201}}.  It has been a while since this patch was committed though, so I'd like to take the revert through pre-commit as a precaution.  I'm also going to temporarily raise this to blocker for 2.8.0, just so we don't forget to complete the revert before that release., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m  0s{color} | {color:blue} Docker mode activated. {color} |
| {color:red}-1{color} | {color:red} docker {color} | {color:red}  0m  5s{color} | {color:red} Docker failed to build yetus/hadoop:2c91fd8. {color} |
\\
\\
|| Subsystem || Report/Notes ||
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12808090/HADOOP-12718.004.patch |
| JIRA Issue | HADOOP-12718 |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/9661/console |
| Powered by | Apache Yetus 0.4.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m  0s{color} | {color:blue} Docker mode activated. {color} |
| {color:red}-1{color} | {color:red} docker {color} | {color:red}  0m  4s{color} | {color:red} Docker failed to build yetus/hadoop:2c91fd8. {color} |
\\
\\
|| Subsystem || Report/Notes ||
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12808090/HADOOP-12718.004.patch |
| JIRA Issue | HADOOP-12718 |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/9662/console |
| Powered by | Apache Yetus 0.4.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m  0s{color} | {color:blue} Docker mode activated. {color} |
| {color:red}-1{color} | {color:red} docker {color} | {color:red}  0m  5s{color} | {color:red} Docker failed to build yetus/hadoop:2c91fd8. {color} |
\\
\\
|| Subsystem || Report/Notes ||
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12808090/HADOOP-12718.004.patch |
| JIRA Issue | HADOOP-12718 |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/9670/console |
| Powered by | Apache Yetus 0.4.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 15s{color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  7m 27s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  7m 18s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 25s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  2s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 12s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 26s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 47s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 42s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  6m 55s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  6m 55s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 24s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 53s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 12s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  1s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 30s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 46s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  7m 54s{color} | {color:green} hadoop-common in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 21s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 39m 16s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:e2f6409 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12808090/HADOOP-12718.004.patch |
| JIRA Issue | HADOOP-12718 |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |
| uname | Linux 69908b0a79d4 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / 0761379 |
| Default Java | 1.8.0_91 |
| findbugs | v3.0.0 |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/9822/testReport/ |
| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/9822/console |
| Powered by | Apache Yetus 0.4.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, I have reverted the prior commits from trunk, branch-2 and branch-2.8.  I have downgraded the priority of the issue and retargeted it to 3.0.0-alpha1., SUCCESS: Integrated in Hadoop-trunk-Commit #9982 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/9982/])
Revert "HADOOP-12718. Incorrect error message by fs -put local dir (cnauroth: rev 5f6bc65bb31270f2b5dfdfd941a0568fc1f3337f)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/RawLocalFileSystem.java
, Patch 005:
* Fix {{RawLocalFileSystem#listStatus}} to throw ACE when a dir exists but is not readable
* Add unit test {{testPutSrcDirNoPerm}} and {{testPutSrcFileNoPerm}} to {{TestFsShellCopy}}

Manual test output:
{noformat}
$ ls -ld /tmp/d1
drwx------  2 root  wheel  68 Oct 23 00:50 /tmp/d1
$ hdfs dfs -put /tmp/d1 /tmp
put: Permission denied for dir: /tmp/d1

$ ls -ld /tmp/f1
----------  1 root  wheel  0 Oct 23 22:40 /tmp/f1
$ hdfs dfs -put /tmp/f1 /tmp
put: /tmp/f1 (Permission denied)
{noformat}, | (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 15s{color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 1 new or modified test files. {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  7m  2s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  8m 40s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 27s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  7s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 14s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 35s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 46s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 48s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  8m 17s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  8m 17s{color} | {color:green} the patch passed {color} |
| {color:orange}-0{color} | {color:orange} checkstyle {color} | {color:orange}  0m 25s{color} | {color:orange} hadoop-common-project/hadoop-common: The patch generated 2 new + 57 unchanged - 0 fixed = 59 total (was 57) {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  5s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 12s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 40s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 44s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  8m 18s{color} | {color:green} hadoop-common in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 21s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 43m 24s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:9560f25 |
| JIRA Issue | HADOOP-12718 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12834878/HADOOP-12718.005.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |
| uname | Linux c04873e4755f 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / d0a3479 |
| Default Java | 1.8.0_101 |
| findbugs | v3.0.0 |
| checkstyle | https://builds.apache.org/job/PreCommit-HADOOP-Build/10864/artifact/patchprocess/diff-checkstyle-hadoop-common-project_hadoop-common.txt |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/10864/testReport/ |
| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/10864/console |
| Powered by | Apache Yetus 0.4.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, -1 as is. Afraid you're going to have to adopt Chris's recommendations of using {{FileUtil.canRead()}}. I think we could also take the opportunity to tighten the docs: "this is what you do if you can't read' a path". 

Ideally, I'd like some results on what happens on a windows test run, though that's going to depend on HADOOP-13586. Maybe now is a good time to fix that.

We really need the full FS shell command suite pulled out into its own abstract suite and then implemented  by the subclasses, just as any other contract. I'll leave that for another time., [~stevel@apache.org], Thanks a lot for catching the mistake.

Filed HADOOP-13751 Contract test for FS shell commands.

What do you think of placing the permission check into {{FileUtil#list}}?
{code}
  public static String[] list(File dir) throws IOException {
    if (!canRead(dir)) {
      throw new AccessControlException("Permission denied for dir: " +
          dir.toString());
    }
    String[] fileNames = dir.list();
    if(fileNames == null) {
      throw new IOException("Invalid directory or I/O error occurred for dir: "
                + dir.toString());
    }
    return fileNames;
  }
{code}
Currently {{FileUtil#list}} is only called by:
{code}
        hadoop-common  (1 usage found)
            org.apache.hadoop.fs  (1 usage found)
                RawLocalFileSystem  (1 usage found)
                    listStatus(Path)  (1 usage found)
                        474String[] names = FileUtil.list(localf);
        hadoop-hdfs  (3 usages found)
            org.apache.hadoop.hdfs.server.datanode  (2 usages found)
                BlockPoolSliceStorage  (1 usage found)
                    cleanupDetachDir(File)  (1 usage found)
                        518if (FileUtil.list(detachDir).length != 0) {
                DataStorage  (1 usage found)
                    cleanupDetachDir(File)  (1 usage found)
                        910if (FileUtil.list(detachDir).length != 0 ) {
            org.apache.hadoop.hdfs.server.datanode.fsdataset.impl  (1 usage found)
                FsVolumeImpl  (1 usage found)
                    isBPDirEmpty(String)  (1 usage found)
                        1035if (rbwDir.exists() && FileUtil.list(rbwDir).length != 0) {
{code}
They seem ok with the change but I am a little reluctant to widen the scope to modify a static utility function., looked through that code too. why not post a query on to hdfs-dev to see what they thing.

Looking at those uses, raising a new exception isn't going to make a difference —the read is going to fail anyway, isn't it? All that is happening is there's a tighter error message.

my main concern there is that being windows, things will break if the native lib isn't on the path. Which going to happen in production anyway. I'm just curious what happens during testing, I will post a question to hdfs-dev.

Unfortunately I don't have access to Windows env. Will solicit community help upon the next patch., Patch 006:
* Move canRead() check and throws ACE from {{RawLocalFileSystem#listStatus}} to {{FileUtil#list}} which already throws IOE
* All current callers of {{FileUtil#list}} can handle the change, | (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 13s{color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 1 new or modified test files. {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  7m 30s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  7m 28s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 25s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  2s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 14s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 34s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 46s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 39s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  7m  9s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  7m  9s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 23s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 54s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 12s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 26s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 43s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  8m 38s{color} | {color:green} hadoop-common in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 23s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 41m  2s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:9560f25 |
| JIRA Issue | HADOOP-12718 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12835448/HADOOP-12718.006.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |
| uname | Linux fd4f4068fdf3 3.13.0-95-generic #142-Ubuntu SMP Fri Aug 12 17:00:09 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / 22ff0ef |
| Default Java | 1.8.0_101 |
| findbugs | v3.0.0 |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/10904/testReport/ |
| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/10904/console |
| Powered by | Apache Yetus 0.4.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, Thanks [~cnauroth] and [~stevel@apache.org] for finding the potential incompatibility of the earlier patch and the review/discussion, and thanks [~jzhuge] for the continued work here.

I think patch rev 006 addressed the windows issue pointed out by Chris. One minor comment, we should change the javadoc description to indicate that ACE will be thrown when the given dir can't be read. I'm +1 after that's addressed. And this will be marked as an incompatible change.

Hi Chris and Steve, do you have further comment?

Thanks.





, Patch 007:
* Add javadoc for the new ACE to throw, | (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 19s{color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 1 new or modified test files. {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  9m  1s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  8m 38s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 29s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  9s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 14s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 44s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 51s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 46s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  8m 50s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  8m 50s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 27s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  6s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 15s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 51s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 45s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  9m 49s{color} | {color:green} hadoop-common in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 24s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 48m  1s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:9560f25 |
| JIRA Issue | HADOOP-12718 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12837289/HADOOP-12718.007.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |
| uname | Linux bc496429f4ae 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / de01327 |
| Default Java | 1.8.0_101 |
| findbugs | v3.0.0 |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/10998/testReport/ |
| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/10998/console |
| Powered by | Apache Yetus 0.4.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, Thanks [~jzhuge] for the new rev. +1. 

Hi [~cnauroth] or [~stevel@apache.org], I will commit by tomorrow, would you please let me know if you have more comments? Best.


, Looking at this patch. I think I'd prefer it if the tests (a) looked for a constant string declared in {{FSExceptionMessages}}, rather than "permission denied". Tests look for strings are always so, so brittle. And we should be looking at a consistent error message for all those documentation and support call issues.
I think the asserts could also include the full text

{code}
private void assertPermissionDenied(String text){
  assertTrue(text + " does not contain " + FSExceptionMessages.NO_PERMISSION, text.contains(FSExceptionMessages.NO_PERMISSION)
}



One thing to consider —and I don't think there's a right or wrong here— is whether to make the exception an {{java.nio.file.AccessDeniedException}}, or a {{org.apache.hadoop.fs.PathPermissionException}}. Both of these separate out the path for analysis later.

I've just checked S3AFileSystem; there we through the {{AccessDeniedException}}; I don't know if that's good —or should it switch to {{org.apache.hadoop.fs.PathPermissionException}}.

That's really a separate issue; I'd go through the blobstores and make them consistent if we ever chose one exception & message.
, Javadoc for {{AccessDeniedException}}:
{noformat}
 * Checked exception thrown when a file system operation is denied, typically
 * due to a file permission or other access check.
 *
 * <p> This exception is not related to the {@link
 * java.security.AccessControlException AccessControlException} or {@link
 * SecurityException} thrown by access controllers or security managers when
 * access to a file is denied.
{noformat}
{{AccessDeniedException}} seems to be a better choice than {{AccessControlException}}. ACE is widely used while ADE is only used in hadoop-aws and hadoop-yarn-common, probably because it was introduced in 1.7. {{PathPermissionException}} is only used 3 times in tests., Patch 008:
* Use {{AccessDeniedException}} instead of {{AccessControlException}}
* Add constant {{FSExceptionMessages.PERMISSION_DENIED}}
* Please note {{testPutSrcFileNoPerm}} should not use the constant because JDK FileInputStream#open raises FNFE exception containing "Permission denied" message., | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 16s{color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 1 new or modified test files. {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  7m 18s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 11m 37s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 35s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  7s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 23s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 30s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 57s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 39s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 29s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 10m 29s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 34s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  8s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 23s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 50s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 57s{color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red}  8m 51s{color} | {color:red} hadoop-common in the patch failed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 42s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 51m 22s{color} | {color:black} {color} |
\\
\\
|| Reason || Tests ||
| Failed junit tests | hadoop.ha.TestZKFailoverController |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:e809691 |
| JIRA Issue | HADOOP-12718 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12838105/HADOOP-12718.008.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |
| uname | Linux 1a4bb458d8e4 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / 62d8c17 |
| Default Java | 1.8.0_101 |
| findbugs | v3.0.0 |
| unit | https://builds.apache.org/job/PreCommit-HADOOP-Build/11040/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common.txt |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/11040/testReport/ |
| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/11040/console |
| Powered by | Apache Yetus 0.4.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, TestZKFailoverController failure is unrelated., I saw quite a lot places refer to the string "Permission denied", which large mean the same thing referred to in the case here. We can replace the other places that refer to "Permission denied" with the constant defined in the patch here gradually when appropriate.  

About
{quote}
Please note test testPutSrcFileNoPerm should not use the constant
{quote}
I think we could actually use the constant in the above test now, but I'm ok to defer it when doing replacement in the source code that produce the message.

Thanks.
, In testPutSrcFileNoPerm, JDK FileInputStream#open raises the exception containing "Permission denied" message. That's why I didn't use the constant., Thanks [~jzhuge], I thought the exception is from some of the places in hadoop code base that use hard coded string "Permission denied" (I saw quite a lot), if it's from JDK, we don't have control.  So I'm +1 with the current patch. 

Since now we introduce the constant, it'd be nice to use it in hadoop code base, by replacing hardcoded strings to referring to the constant. But I think we don't need to do that in this jira. 

Any further comment [~stevel@apache.org]? If not, I will commit by tomorrow. Thanks.



, Committed trunk and marked as incompatible change.

Thanks [~jzhuge] for the patch and [~stevel@apache.org] for the review.
, SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #10817 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/10817/])
HADOOP-12718. Incorrect error message by fs -put local dir without (yzhang: rev 470bdaa27a771467fcd44dfa9c9c951501642ac6)
* (edit) hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/FileUtil.java
* (edit) hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/FSExceptionMessages.java
* (edit) hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestFsShellCopy.java
, Thanks [~yzhangal] for the review and commit. Thanks [~stevel@apache.org] for the review.]