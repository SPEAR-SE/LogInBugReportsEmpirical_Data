[Can you see if you had any DataNode already running before running this test?, I just successfully ran it on trunk.
What platform are you running it on?, Looks that the failed test was caused by a datanode running on the same machine., No other unit test fails when there is hadoop running on the same machine. It is better if this one tolerates it too (at least with very high probability).
, The address binding error is caused by the datanode rpc server port which uses the default port number 50020 instead of the free port 0., This is a patch that fixes the problem., +1 patch looks good., It is quite possible that another (stale) datanode was running on that machine. I tried it again on my box and it worked., I just committed this. Thanks, Hairong!, Integrated in Hadoop-trunk #586 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-trunk/586/])]