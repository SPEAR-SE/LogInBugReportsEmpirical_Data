[build file log: 

Hadoop.compile-core-classes:
[jsp-compile] log4j:WARN No appenders could be found for logger (org.apache.jasper.compiler.JspRuntimeContext).
[jsp-compile] log4j:WARN Please initialize the log4j system properly.
    [javac] Compiling 138 source files to /home/slo/Java/Apache/hadoop-core/build/classes
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:48: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]   final INodeDirectoryWithQuota rootDir;
    [javac]         ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:61: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]     rootDir = new INodeDirectoryWithQuota(INodeDirectory.ROOT_NAME,
    [javac]                   ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:215: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]         newNode = new INodeDirectoryWithQuota(
    [javac]                       ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:761: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]     List<INodeDirectoryWithQuota> inodesWithQuota = 
    [javac]          ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:762: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]       new ArrayList<INodeDirectoryWithQuota>(numOfINodes);
    [javac]                     ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:767: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]           INodeDirectoryWithQuota quotaINode =(INodeDirectoryWithQuota)inodes[i]; 
    [javac]           ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:767: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]           INodeDirectoryWithQuota quotaINode =(INodeDirectoryWithQuota)inodes[i]; 
    [javac]                                                ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:773: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]       for (INodeDirectoryWithQuota quotaINode:inodesWithQuota) {
    [javac]            ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:969: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]         ((INodeDirectoryWithQuota)dNode).setCount(count);
    [javac]           ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:997: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]         if (dirNode instanceof INodeDirectoryWithQuota) { 
    [javac]                                ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:999: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]           ((INodeDirectoryWithQuota)dirNode).setQuota(quota);
    [javac]             ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:1002: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]           INodeDirectoryWithQuota newNode = 
    [javac]           ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:1003: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]             new INodeDirectoryWithQuota(quota, dirNode);
    [javac]                 ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:1036: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]       } else if (targetNode instanceof INodeDirectoryWithQuota) {
    [javac]                                        ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:1039: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]         INodeDirectoryWithQuota dirNode = (INodeDirectoryWithQuota)targetNode;
    [javac]         ^
    [javac] /home/slo/Java/Apache/hadoop-core/src/hdfs/org/apache/hadoop/hdfs/server/namenode/FSDirectory.java:1039: cannot find symbol
    [javac] symbol  : class INodeDirectoryWithQuota
    [javac] location: class org.apache.hadoop.hdfs.server.namenode.FSDirectory
    [javac]         INodeDirectoryWithQuota dirNode = (INodeDirectoryWithQuota)targetNode;
    [javac]                                            ^
    [javac] Note: Some input files use or override a deprecated API.
    [javac] Note: Recompile with -Xlint:deprecation for details.
    [javac] 16 errors

, Looking at the log of INodeDirectory, this isn't a recent change. The problem -a toplevel class in the wrong file- has existed for a while, it just hasn't surfaced.

The only recent change is that I've updated and rebuilt ant; this is triggering the problem, which means that it is handing off FSDirectory.java to get compiled before INodeDirectory.java gets built; some changes in filesets. However, I can be reasonably confident that the Ant team aren't going to change their fileset logic to handle this specific problem, not if this is the only symptom. Changing the title and environment to qualify the issue, if its my problem alone, downgrading. easy to patch, but it doesnt (yet) matter to anyone else., I also want to fix this for a long time.

3907_20080806.patch: moved INodeDirectoryWithQuota codes to a new file., 3907_20080806b.patch: I used eclipse to do copying and it cleverly renamed some INodeDirectory to INodeDirectoryWithQuota.  The patch fixed the problem., +1. This patch looks good to me., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12387682/3907_20080806b.patch
  against trunk revision 683448.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3028/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3028/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3028/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3028/console

This message is automatically generated., Only refactored INodeDirectoryWithQuota to a new file.  No new tests added., I just committed this. Thanks, Nicholas!, Integrated in Hadoop-trunk #581 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-trunk/581/]), Integrated in Hadoop-Hdfs-0.23-Build #309 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/309/])
    Backport HADOOP-3907 from trunk (svn merge -c 1358892). (harsh) (Revision 1359179)

     Result = SUCCESS
bobby : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1359179
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-core/src/main/resources/mapred-default.xml
, Please ignore the above message. It is meant for MAPREDUCE-3907, bobby seems to have made a typo.]