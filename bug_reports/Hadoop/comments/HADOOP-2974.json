[sigh. this fails with Java 1.5 but not with Java 1.6 on windows.

Only change from HADOOP-2346  that matters is that Socket used in the following trace is create with "SocketChannel.open().socket()" instead of "new Socket()". So its an NIO socket. I don't know why it does not work. Any one know if NIO supposed to be stable in 1.5?

exception :
{noformat}
Cannot assign requested address: no further information
java.net.BindException: Cannot assign requested address: no further information
        at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)
        at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:527)
        at sun.nio.ch.SocketAdaptor.connect(SocketAdaptor.java:100)
        at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:161)
        at org.apache.hadoop.ipc.Client.getConnection(Client.java:578)
        at org.apache.hadoop.ipc.Client.call(Client.java:501)
        at org.apache.hadoop.ipc.RPC$Invoker.invoke(RPC.java:198)
        at $Proxy0.getProtocolVersion(Unknown Source)
        at org.apache.hadoop.ipc.RPC.getProxy(RPC.java:291)
        at org.apache.hadoop.ipc.RPC.getProxy(RPC.java:278)
        at org.apache.hadoop.ipc.RPC.getProxy(RPC.java:315)
        at org.apache.hadoop.ipc.TestRPC.testSlowRpc(TestRPC.java:179)
{noformat}, given this jira and HADOOP-2971 , it might be better to revert HADOOP-2346 for now. Some of these might not be in our hands to fix. HADOOP-2346 is implemented based on JavaDoc for SelectableChannels stuff. I will see., 
As a temporary work around, StandardSocketFactory.createSocket() could return 'new Socket()' (either on all platforms or on just windows). This implies client sockets will not have write timeout on these platforms. Any preferences?, The relevant Java bug seems to be http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6269047

These tests essentially invoke connect("0.0.0.0:port") which does not work with channels before Java 1.6. We could change the address to 127.0.0.1 in the test, which seems to work.
, Patch attached. This adds a static method {{NetUtils.getConnectAddress(Server)}}. It returns "127.0.0.1:port" when server binds to "0.0.0.0:port". The failing tests now use this method instead of server.getListeningAddress().

Note that NameNode, JobTracker also use server.getListeningAddress(), but it is not strictly correct. I didn't change that., +1 on the patch. For the problem in JobTracker and NameNode, could you file a bug if it does not get solved in this jira?, Thanks Hairong. filed HADOOP-2989 for NameNode and JobTracker., -1 overall.  Here are the results of testing the latest attachment 
http://issues.apache.org/jira/secure/attachment/12377542/HADOOP-2974.patch
against trunk revision 619744.

    @author +1.  The patch does not contain any @author tags.

    tests included +1.  The patch appears to include 9 new or modified tests.

    patch -1.  The patch command could not apply the patch.

Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1936/console

This message is automatically generated., Fixed conflicts with trunk. I should have suspected this earlier., +1 overall.  Here are the results of testing the latest attachment 
http://issues.apache.org/jira/secure/attachment/12377623/HADOOP-2974.patch
against trunk revision 619744.

    @author +1.  The patch does not contain any @author tags.

    tests included +1.  The patch appears to include 9 new or modified tests.

    javadoc +1.  The javadoc tool did not generate any warning messages.

    javac +1.  The applied patch does not generate any new javac compiler warnings.

    release audit +1.  The applied patch does not generate any new release audit warnings.

    findbugs +1.  The patch does not introduce any new Findbugs warnings.

    core tests +1.  The patch passed core unit tests.

    contrib tests +1.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1946/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1946/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1946/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/1946/console

This message is automatically generated., I just committed this., Integrated in Hadoop-trunk #427 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-trunk/427/])]