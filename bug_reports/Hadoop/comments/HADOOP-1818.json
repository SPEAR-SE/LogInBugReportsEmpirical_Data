[Returning empty splits is useless. Here is a patch., +1

http://issues.apache.org/jira/secure/attachment/12365351/HADOOP-1818.patch applied and successfully tested against trunk revision r573513.

Test results:   http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/709/testReport/
Console output: http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/709/console, A few minor things : 
1. MultiFileSplit actually is intended to be used in cases where numPaths >> numSplits, so this issue is an extreme case (just for the record)
2. The argument intToWrite in {{TestFileInputFormat#initFiles()}} is not used effectively, so please remove it. , {quote}
1. MultiFileSplit actually is intended to be used in cases where numPaths >> numSplits, so this issue is an extreme case (just for the record)
{quote}
In our case: we are using MultiFileSplit because the number of input paths is unknown before the job is running. It can vary from 0 to thousands paths.

{quote}
2. The argument intToWrite in TestFileInputFormat#initFiles() is not used effectively, so please remove it.
{quote}
Yes it is used:

{noformat}
if (intToWrite == -1) {
    intToWrite = rand.nextInt();
}
out.write(intToWrite);
{noformat}

and called from the unit test:
{noformat}
public void testFormatWithLessPathsThanSplits() throws Exception {
  MultiFileInputFormat format = new DummyMultiFileInputFormat();
  FileSystem fs = FileSystem.getLocal(job);     
  
  // Test with no path
  initFiles(fs, 0, -1, -1);    
  assertEquals(0, format.getSplits(job, 2).length);
  
  // Test with 2 path and 4 splits
  initFiles(fs, 2, 500, 20);
  assertEquals(2, format.getSplits(job, 4).length);
}
{noformat}, Yes, it is used however writing 20 instead of random integers does not make any difference, so it is not needed? right ? , Yes you are right. I should have been garbled when writing this code ;-)
Here is a new patch., +1

http://issues.apache.org/jira/secure/attachment/12365454/HADOOP-1818.patch applied and successfully tested against trunk revision r573777.

Test results:   http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/723/testReport/
Console output: http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/723/console, I committed this. Thanks Thomas. ]