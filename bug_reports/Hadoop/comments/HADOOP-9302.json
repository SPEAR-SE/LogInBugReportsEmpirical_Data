[Thomas,

Can you confirm the build+stage commands that you're using to test the docs build?  I see broken links as well, but I just want to make sure I'm testing the real build process or at least a well-understood version of it.

Currently I run {{mvn clean site; mvn -o site:stage -DstagingDirectory=/tmp/hadoop-site}} and I'm wondering if I'm missing anything., Attaching patch to fix links in the navigation menu., yes I was just running:
$ mvn site
$ mvn site:stage

results in the target/staging directory.

thanks for working on this, I'll try out the patch., Sorry perhaps I'm missing something but the patch touches the site.xml in the xdocs directory. I didn't think that was used anywhere since converting to apt.  I also don't see any change to the top level menu (perhaps there is sub-menu or another page I'm missing?).  after staging I just go to the link at staging/hadoop-project/index.html - which is similar page as http://hadoop.apache.org/docs/current/.

I thought perhaps adding some of links to the hdfs section in hadoop-project/src/site/site.xml would make sense., I'm sure I'm the one missing something, not you. :)  I have essentially no idea how any of this works and am just poking at things until they behave how I want.

I thought that my edits fixed some broken links, but having re-tested, I think I was comparing against a previous build left over from before HADOOP-9221 and related commits.  New patch coming shortly., {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12567475/hdfs4460.txt
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+0 tests included{color}.  The patch appears to be a documentation patch that doesn't require tests.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-hdfs-project/hadoop-hdfs.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3929//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3929//console

This message is automatically generated., bq. after staging I just go to the link at staging/hadoop-project/index.html - which is similar page as http://hadoop.apache.org/docs/current/.

When I visit file:///tmp/hadoop-site/hadoop-project/index.html I get a fair number of links in the left navigation bar.

The navigation bar links to the following: {{BuildingIt CLIMiniCluster CapacityScheduler ClusterSetup CommandsManual Configuration DeprecatedProperties EncryptedShuffle Examples Federation FileSystemShell HDFSHighAvailabilityWithNFS HDFSHighAvailabilityWithQJM HistoryServerRest MapredAppMasterRest NodeManagerRest ResourceManagerRest SingleCluster WebApplicationProxy WebHDFS WebServicesIntro WritingYarnApplications YARN YarnCommands}}

The following {{.apt.vm}} files in the tree are not linked in the navigation bar:
{noformat}
hadoop-common-project/hadoop-common/src/site/apt/HttpAuthentication.apt.vm
hadoop-common-project/hadoop-common/src/site/apt/NativeLibraries.apt.vm
hadoop-common-project/hadoop-common/src/site/apt/ServiceLevelAuth.apt.vm
hadoop-common-project/hadoop-common/src/site/apt/SingleNodeSetup.apt.vm
hadoop-common-project/hadoop-common/src/site/apt/Superusers.apt.vm
hadoop-hdfs-project/hadoop-hdfs-httpfs/src/site/apt/ServerSetup.apt.vm
hadoop-hdfs-project/hadoop-hdfs-httpfs/src/site/apt/UsingHttpTools.apt.vm
hadoop-hdfs-project/hadoop-hdfs/src/site/apt/FaultInjectFramework.apt.vm
hadoop-hdfs-project/hadoop-hdfs/src/site/apt/HdfsDesign.apt.vm
hadoop-hdfs-project/hadoop-hdfs/src/site/apt/HdfsEditsViewer.apt.vm
hadoop-hdfs-project/hadoop-hdfs/src/site/apt/HdfsImageViewer.apt.vm
hadoop-hdfs-project/hadoop-hdfs/src/site/apt/HdfsPermissionsGuide.apt.vm
hadoop-hdfs-project/hadoop-hdfs/src/site/apt/HdfsQuotaAdminGuide.apt.vm
hadoop-hdfs-project/hadoop-hdfs/src/site/apt/HdfsUserGuide.apt.vm
hadoop-hdfs-project/hadoop-hdfs/src/site/apt/Hftp.apt.vm
hadoop-hdfs-project/hadoop-hdfs/src/site/apt/LibHdfs.apt.vm
hadoop-hdfs-project/hadoop-hdfs/src/site/apt/SLGUserGuide.apt.vm
hadoop-yarn-project/hadoop-yarn/hadoop-yarn-site/src/site/apt/FairScheduler.apt.vm
{noformat}

At a quick glance I'm inclined to add links to the following: {{FairScheduler HdfsDesign HdfsEditsViewer HdfsImageViewer HdfsPermissionsGuide HdfsQuotaAdminGuide HdfsUserGuide Hftp HttpAuthentication LibHdfs NativeLibraries ServerSetup Superusers UsingHttpTools}}

and leave the following unlinked:  {{FaultInjectFramework SLGUserGuide ServiceLevelAuth SingleNodeSetup}}, This patch adds links to the following pages:
{{NativeLibraries Superusers HdfsUserGuide HdfsDesign HdfsEditsViewer HdfsImageViewer HdfsPermissionsGuide HdfsQuotaAdminGuide Hftp LibHdfs FairScheduler}}

leaving unlinked (at least in the navbar) the following: {{FaultInjectFramework HttpAuthentication SLGUserGuide ServerSetup ServiceLevelAuth SingleNodeSetup UsingHttpTools}}

These are either very specialized pages that are already linked appropriately from other pages (UsingHttpTools, ServerSetup) or badly out of date / irrelevant (SLGUserGuide).  Happy to add them back in if I've mistaken any on this list., {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12567505/hdfs4460-1.txt
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+0 tests included{color}.  The patch appears to be a documentation patch that doesn't require tests.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in .

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3932//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3932//console

This message is automatically generated., Thanks Andy, looks much better now.  A few minor comments.

I think we should add in the links to ServiceLevelAuth and HttpAuthentication. 
Also can you rename HDFS Design in the table to be HDFS Achitecture since that is what the title of the doc is when you click the link.  Similar can you rename LibHDFS to C API libhdfs.

Some of the docs need to be updated to mrv2 still but that is a separate jira.

, Hey Tom, thanks a lot for the feedback. How does this updated patch look to you? The difference between this and the last patch that Andy posted is just the following:

{noformat}
diff --git hadoop-project/src/site/site.xml hadoop-project/src/site/site.xml
index c78eefe..8b2a138 100644
--- hadoop-project/src/site/site.xml
+++ hadoop-project/src/site/site.xml
@@ -55,6 +55,8 @@
       <item name="Native Libraries" href="hadoop-project-dist/hadoop-common/NativeLibraries.html"/>
       <item name="Superusers" href="hadoop-project-dist/hadoop-common/Superusers.html"/>
       <item name="Hadoop Commands Reference" href="hadoop-project-dist/hadoop-common/CommandsManual.html"/>
+      <item name="Service Level Authorization" href="hadoop-project-dist/hadoop-common/ServiceLevelAuth.html"/>
+      <item name="HTTP Authentication" href="hadoop-project-dist/hadoop-common/HttpAuthentication.html"/>
     </menu>
     
     <menu name="HDFS" inherit="top">
@@ -62,13 +64,13 @@
       <item name="High Availability With QJM" href="hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html"/>
       <item name="High Availability With NFS" href="hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithNFS.html"/>
       <item name="Federation" href="hadoop-project-dist/hadoop-hdfs/Federation.html"/>
-      <item name="HDFS Design" href="hadoop-project-dist/hadoop-hdfs/HdfsDesign.html"/>
+      <item name="HDFS Architecture" href="hadoop-project-dist/hadoop-hdfs/HdfsDesign.html"/>
       <item name="Edits Viewer" href="hadoop-project-dist/hadoop-hdfs/HdfsEditsViewer.html"/>
       <item name="Image Viewer" href="hadoop-project-dist/hadoop-hdfs/HdfsImageViewer.html"/>
       <item name="Permissions and HDFS" href="hadoop-project-dist/hadoop-hdfs/HdfsPermissionsGuide.html"/>
       <item name="Quotas and HDFS" href="hadoop-project-dist/hadoop-hdfs/HdfsQuotaAdminGuide.html"/>
       <item name="HFTP" href="hadoop-project-dist/hadoop-hdfs/Hftp.html"/>
-      <item name="LibHDFS" href="hadoop-project-dist/hadoop-hdfs/LibHdfs.html"/>
+      <item name="C API libhdfs" href="hadoop-project-dist/hadoop-hdfs/LibHdfs.html"/>
       <item name="WebHDFS REST API" href="hadoop-project-dist/hadoop-hdfs/WebHDFS.html"/>
       <item name="HttpFS Gateway" href="hadoop-hdfs-httpfs/index.html"/>
     </menu>
{noformat}, {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12569139/hdfs4460-2.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+0 tests included{color}.  The patch appears to be a documentation patch that doesn't require tests.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in .

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/3968//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/3968//console

This message is automatically generated., Sorry, I missed the updated patch. Looks good to me. +1.  Thanks Andy!, Moved to Hadoop common jira bucket since it touches the top level project., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12569139/hdfs4460-2.patch
  against trunk revision .

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/2185//console

This message is automatically generated., Integrated in Hadoop-trunk-Commit #3351 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/3351/])
    HADOOP-9302. HDFS docs not linked from top level (Andy Isaacson via tgraves) (Revision 1445635)

     Result = SUCCESS
tgraves : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1445635
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-project/src/site/site.xml
, Integrated in Hadoop-Yarn-trunk #127 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/127/])
    HADOOP-9302. HDFS docs not linked from top level (Andy Isaacson via tgraves) (Revision 1445635)

     Result = SUCCESS
tgraves : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1445635
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-project/src/site/site.xml
, Integrated in Hadoop-Hdfs-0.23-Build #525 (See [https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/525/])
    HADOOP-9302. HDFS docs not linked from top level (Andy Isaacson via tgraves) (Revision 1445649)

     Result = SUCCESS
tgraves : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1445649
Files : 
* /hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/branches/branch-0.23/hadoop-project/src/site/site.xml
, Integrated in Hadoop-Hdfs-trunk #1316 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1316/])
    HADOOP-9302. HDFS docs not linked from top level (Andy Isaacson via tgraves) (Revision 1445635)

     Result = FAILURE
tgraves : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1445635
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-project/src/site/site.xml
, Integrated in Hadoop-Mapreduce-trunk #1344 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1344/])
    HADOOP-9302. HDFS docs not linked from top level (Andy Isaacson via tgraves) (Revision 1445635)

     Result = SUCCESS
tgraves : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1445635
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-project/src/site/site.xml
]