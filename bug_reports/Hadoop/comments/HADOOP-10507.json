[setfacl command with "-m" option took include permission by default as true.so if we doesn't provide the permissions it will through the ArrayIndexoutofboundexception.
{code}
    if (includePermission) {
      if (split.length < index) {
        throw new HadoopIllegalArgumentException("Invalid <aclSpec> : "
            + aclStr);
      }
      String permission = split[index];
{code}

actually we are not giving the permision right so we have only two index.so it is checking for third index and throwing the arrayindexout of bound exception, Attaching a patch with small fix.Please review it, {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12639364/HDFS-6205.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-common.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/6671//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/6671//console

This message is automatically generated., Thank you, [~schu] for reporting this, and thank you [~sathish.gurram] for providing a patch.

Note that {{setfacl -x user:user1: /file1}} is valid usage.  Linux setfacl tolerates a trailing ':' with the -x option, so we'll want to remain consistent with that.  The patch has a new test that asserts failure for this case, but it's actually failing for a different reason (/path not found on local file system).  It isn't really testing this change.

I recommend writing a test that calls {{AclEntry#parseAclSpec}} directly.  There are a few existing tests in {{TestAclCommands}} that do this, and you can add something similar.  That avoids accidentally testing the wrong thing due to local file system interactions through calling the shell command directly., I moved this issue from HDFS to HADOOP, because the bug fix is in hadoop-common code., One more minor nitpick: please camel-case method names.  Thanks!, {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12639364/HDFS-6205.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-common.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/3798//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/3798//console

This message is automatically generated., I accept your comments chris Nauroth.
Attaching the patch by changing the patch according to the comments.
Please review  the patch, {color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12640791/HDFS-6205-0001.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-common.

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/3811//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/3811//console

This message is automatically generated., This looks good, [~sathish.gurram].  Thanks!

Just one more minor nitpick.  {{TestAclCommands}} has some non-standard indentation.  The project standard is indentation by 2 spaces.

+1 after that's addressed., Hi, [~sathish.gurram], do you have time to fix the indentation? If not, I can update your patch for you., Updated Sathish's patch to fix indenting. I kept the runCommand assertion consistent with the rest of the test though (4 spaces for next line instead of 2). LMK if it should technically be 2.

[~cnauroth], it's been a while since you reviewed, but I think this patch is still valid. Compiled successfully and ran TestAclCommands successfully., +1 for the patch.  After Jenkins runs the latest version, I'll commit it and co-credit the two of you.  Thanks!, Thank you, [~cnauroth]. Hadoop QA jenkins job did not run properly yesterday because of the svn upgrade issue.

Reattaching the same patch to trigger Hadoop QA., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12654818/HADOOP-10507.002.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:red}-1 javac{color:red}.  The patch appears to cause the build to fail.

Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4237//console

This message is automatically generated., I think the above is not a problem with the patch, but a Hadoop QA/jenkins issue that is hitting other PreCommit-HADOOP-Builds., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12654818/HADOOP-10507.002.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common:

                  org.apache.hadoop.fs.TestSymlinkLocalFSFileContext
                  org.apache.hadoop.ipc.TestIPC
                  org.apache.hadoop.fs.TestSymlinkLocalFSFileSystem

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4238//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4238//console

This message is automatically generated., The failing tests are unrelated to this patch. Other than that, the jenkins job looks good.

Thank you, [~cnauroth] and [~gkesavan] for fixing the jenkins build issues., FAILURE: Integrated in Hadoop-trunk-Commit #5857 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/5857/])
HADOOP-10507. FsShell setfacl can throw ArrayIndexOutOfBoundsException when no perm is specified. Contributed by Stephen Chu and Sathish Gurram. (cnauroth: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1609503)
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/permission/AclEntry.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/shell/TestAclCommands.java
, I committed this to trunk and branch-2.  Thank you for the contribution, Sathish and Stephen., FAILURE: Integrated in Hadoop-Yarn-trunk #610 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/610/])
HADOOP-10507. FsShell setfacl can throw ArrayIndexOutOfBoundsException when no perm is specified. Contributed by Stephen Chu and Sathish Gurram. (cnauroth: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1609503)
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/permission/AclEntry.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/shell/TestAclCommands.java
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #1828 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1828/])
HADOOP-10507. FsShell setfacl can throw ArrayIndexOutOfBoundsException when no perm is specified. Contributed by Stephen Chu and Sathish Gurram. (cnauroth: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1609503)
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/permission/AclEntry.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/shell/TestAclCommands.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk #1801 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1801/])
HADOOP-10507. FsShell setfacl can throw ArrayIndexOutOfBoundsException when no perm is specified. Contributed by Stephen Chu and Sathish Gurram. (cnauroth: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1609503)
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/permission/AclEntry.java
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/shell/TestAclCommands.java
]