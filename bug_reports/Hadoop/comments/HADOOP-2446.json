[Its not related to running DFS. I don't know why Hudson is not failing. The attached patch fixes the problem.

Konstantin, could you check if the fix is ok? I am not really sure what exactly the test is doing and this patch might just be hiding the problem. Thanks.
, The attached patch fixes TestHDFSServerPorts and TestMRServerPorts so that they do not rely on statically configured ports.  These tests also now will shutdown the NameNode if another error is encountered., Submitting patch.  Konstantine, can you please code review?, +1 overall.  Here are the results of testing the latest attachment 
http://issues.apache.org/jira/secure/attachment/12372543/HADOOP-2446.patch
against trunk revision .

    @author +1.  The patch does not contain any @author tags.

    javadoc +1.  The javadoc tool did not generate any warning messages.

    javac +1.  The applied patch does not generate any new compiler warnings.

    findbugs +1.  The patch does not introduce any new Findbugs warnings.

    core tests +1.  The patch passed core unit tests.

    contrib tests +1.  The patch passed contrib unit tests.

Test results: http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/1472/testReport/
Findbugs warnings: http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/1472/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/1472/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/1472/console

This message is automatically generated., +1 on Nigel's patch
Yes this the right fix. 
The test failed not because something was running on a specific port but since the server did not close on the previous run., I just committed this.]