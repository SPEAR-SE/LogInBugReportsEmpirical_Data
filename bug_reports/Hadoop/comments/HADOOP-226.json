[This sounds like more than one bug.  (1) should be a separate bug.  (2) and (3) are minor: the error message is simply not very informative.  (4) calls for use of something like http://jakarta.apache.org/commons/cli/.  And 2-4 are somewhat related to HADOOP-59., I like Commons CLI. I think we should use it.
Except that we have sort of just one command, which is hadoop,
with hierarchical options, arguments, and sub-options.
Yes HADOOP-59 has other related issues.
I agree we should combine all of them in one new issue specifically
dedicated to DFSShell.
, We should not try to parse all command line options in one place.  A generic class should parse out -D, -conf, -fs, etc. options, build a configuration, then the per-command class should parse the rest of the command line.  That's what HADOOP-59 is about.  Commons CLI could be used to implement the generic option parser and/or each command's option parser., Here's a fix to make "fsck" count over/under replicated blocks according to the per-file value, rather than the global one., I just committed this.  Thanks Bryan!

Please submit new issues for the other aspects of this that remain unfixed.]