[This is a regression caused by HADOOP-6683. Reverting that patch allows the test to patch.

Haven't looked into it yet whether the tests are faulty or that patch is faulty., There could be two possibilities. 
# in some of the TFile tests, we hard-coded the sizes of the compressed blocks. HADOOP-6683 may have affected the compressed sizes. 
# TFile closes a block when it observes the compressed size of the block exceeds the configured minimum block size. HADOOP-6683 waits until a full-buffer if raw bytes before compressing, and thus changes the behavior., Something in trunk just changed such that the native libs are on the classpath when the tests run, so the tests are now failing:

https://builds.apache.org/job/Hadoop-Common-trunk/721/testReport/junit/org.apache.hadoop.io.file.tfile/TestTFileByteArrays/testOneBlockPlusOneEntry/, Strange, bi-secting on my host leads to HADOOP-7206 but that was committed after these tests started failing, must be triggering something.
, Patch which addresses the issue. Hong's theory #2 was correct.

The only change which actually fixes the tests is the change to the initialization of {{records1stBlock}} and {{records2ndBlock}} to be dependent upon whether or not the native libs are present.

While I was in the file, I also took the opportunity to do a little cleanup by:

# Converting to the new style of test annotations.
# Refactoring some methods which had unused parameters.
# Fixing up some formatting.
# Reducing some code duplication in {{TestTFileJClassComparatorByteArrays}}
# Fixing some "unused variable" compiler warnings.

I've tested both {{TestTFileJClassComparatorByteArrays}} and {{TestTFileByteArrays}} both with and without native code being present., +1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12487068/hadoop-7111.0.patch
  against trunk revision 1147971.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 9 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 system test framework.  The patch passed system test framework compile.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/750//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/750//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/750//console

This message is automatically generated., +1

The TODO you added should be removed along with the assertNull on the following line, since the Assert.fail is sufficient., Thanks a lot, Tom. Here's a patch removing the TODO and the useless assert., I've just committed this. Looking forward to a green Common build!

Thanks again for the review, Tom., +1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12487211/hadoop-7111.1.patch
  against trunk revision 1147971.

    +1 @author.  The patch does not contain any @author tags.

    +1 tests included.  The patch appears to include 9 new or modified tests.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 system test framework.  The patch passed system test framework compile.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/754//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/754//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/754//console

This message is automatically generated., Integrated in Hadoop-Common-trunk-Commit #695 (See [https://builds.apache.org/job/Hadoop-Common-trunk-Commit/695/])
    HADOOP-7111. Several TFile tests failing when native libraries are present. (atm)

atm : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1148933
Files : 
* /hadoop/common/trunk/common/src/test/core/org/apache/hadoop/io/file/tfile/TestTFileStreams.java
* /hadoop/common/trunk/common/CHANGES.txt
* /hadoop/common/trunk/common/src/test/core/org/apache/hadoop/io/file/tfile/TestTFileJClassComparatorByteArrays.java
* /hadoop/common/trunk/common/src/test/core/org/apache/hadoop/io/file/tfile/TestTFileByteArrays.java
, Integrated in Hadoop-Common-trunk #753 (See [https://builds.apache.org/job/Hadoop-Common-trunk/753/])
    HADOOP-7111. Several TFile tests failing when native libraries are present. (atm)

atm : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1148933
Files : 
* /hadoop/common/trunk/common/src/test/core/org/apache/hadoop/io/file/tfile/TestTFileStreams.java
* /hadoop/common/trunk/common/CHANGES.txt
* /hadoop/common/trunk/common/src/test/core/org/apache/hadoop/io/file/tfile/TestTFileJClassComparatorByteArrays.java
* /hadoop/common/trunk/common/src/test/core/org/apache/hadoop/io/file/tfile/TestTFileByteArrays.java
, These seem to be failing again in some patch builds. I filed HADOOP-8537.]