[This patch moves the datanode registration into the offerService method, so that if an exception is thrown it will retry again in 5 seconds., Ok, this patch fixes the problem without the bad side effects that the old patch had. It passes the regressions and I'm currently installing this on my 200 node cluster. I'll post a message when I can tell how it goes., I just committed this.  Thanks!]