[Incremental fixes on top of HADOOP-9527 turned out to be quite trivial so I am dup'ing this bug.]