[Check whether parent directory is {{null}} in {{CopyCommitter#cleanupTempFiles}}. , {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12705156/HADOOP-11724.000.patch
  against trunk revision 32b4330.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-tools/hadoop-distcp.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/5960//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/5960//console

This message is automatically generated., The patch is trivial, so no test is included. Also:

{code}
try {
      ...
      Path parent = targetWorkPath.getParent();
      if (parent != null) {
        deleteAttemptTempFiles(parent, targetFS, jobId);
      }
    } catch (Throwable t) {
      LOG.warn("Unable to cleanup temp files", t);
    }
{code}

The {{NPE}} is swallowed by the {{catch (Throwable)}}, so that it is hard to observe in tests, other than log message. , Hi [~eddyxu],

Thanks for reporting the issue and the patch. I reviewed it, it seems that a more appropriate fix is to handle null parent correctly in {{ CopyCommitter#deleteTempFiles}}, rather than skipping the call to it when parent is null? Thanks.



, Thanks a lot [~yzhangal]. It is a great suggestion. I updated the patch for your comments. Would you mind take another look? , {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12707138/HADOOP-11724.001.patch
  against trunk revision 53a28af.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-tools/hadoop-distcp.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/5992//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/5992//console

This message is automatically generated., No test is included, because the change is trivial., HI [~eddyxu],

Thanks for the new rev. +1 after one nit: can we change:
{code}
LOG.debug("Attempted to delete a null directory.");
{code}
to:
{code}
LOG.debug("Ignore attempt to delete temp files for distcp job " + jobId);
{code}
OR we can remove this debug logging, which doesn't provide much info anyways since the first call to {{deleteAttemptTempFiles}} does {{LOG.info("Cleaning up " + file.getPath());}}




, Hi, [~yzhangal]

Thanks for reviewing it. I removed the logs from the patch. The two alternative logs are similar, I think it would be better to defer writing logs in the future. 

Would it be good to you?, Thanks Eddy. +1. Will commit a bit later today.
, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12707274/HADOOP-11724.002.patch
  against trunk revision 97e2aa2.

    {color:red}-1 patch{color}.  Trunk compilation may be broken.

Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/5999//console

This message is automatically generated., Re-upload the patch to trigger jenkin job, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12707331/HADOOP-11724.002.patch
  against trunk revision fc1031a.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no new tests are needed for this patch.
                        Also please list what manual steps were performed to verify this patch.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-tools/hadoop-distcp.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/6000//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/6000//console

This message is automatically generated., FAILURE: Integrated in Hadoop-trunk-Commit #7436 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/7436/])
HADOOP-11724. DistCp throws NPE when the target directory is root. (Lei Eddy Xu via Yongjun Zhang) (yzhang: rev 44809b80814d5520a73d5609d0f73a13eb2360ac)
* hadoop-tools/hadoop-distcp/src/main/java/org/apache/hadoop/tools/mapred/CopyCommitter.java
* hadoop-common-project/hadoop-common/CHANGES.txt
, Thanks Eddy for the contribution, I committed to trunk and branch-2.
, Thanks much for the reviews and committing this, Yongjun., FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #144 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/144/])
HADOOP-11724. DistCp throws NPE when the target directory is root. (Lei Eddy Xu via Yongjun Zhang) (yzhang: rev 44809b80814d5520a73d5609d0f73a13eb2360ac)
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-tools/hadoop-distcp/src/main/java/org/apache/hadoop/tools/mapred/CopyCommitter.java
, FAILURE: Integrated in Hadoop-Yarn-trunk #878 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/878/])
HADOOP-11724. DistCp throws NPE when the target directory is root. (Lei Eddy Xu via Yongjun Zhang) (yzhang: rev 44809b80814d5520a73d5609d0f73a13eb2360ac)
* hadoop-tools/hadoop-distcp/src/main/java/org/apache/hadoop/tools/mapred/CopyCommitter.java
* hadoop-common-project/hadoop-common/CHANGES.txt
, FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #144 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/144/])
HADOOP-11724. DistCp throws NPE when the target directory is root. (Lei Eddy Xu via Yongjun Zhang) (yzhang: rev 44809b80814d5520a73d5609d0f73a13eb2360ac)
* hadoop-tools/hadoop-distcp/src/main/java/org/apache/hadoop/tools/mapred/CopyCommitter.java
* hadoop-common-project/hadoop-common/CHANGES.txt
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #2094 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2094/])
HADOOP-11724. DistCp throws NPE when the target directory is root. (Lei Eddy Xu via Yongjun Zhang) (yzhang: rev 44809b80814d5520a73d5609d0f73a13eb2360ac)
* hadoop-tools/hadoop-distcp/src/main/java/org/apache/hadoop/tools/mapred/CopyCommitter.java
* hadoop-common-project/hadoop-common/CHANGES.txt
, FAILURE: Integrated in Hadoop-Hdfs-trunk #2076 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2076/])
HADOOP-11724. DistCp throws NPE when the target directory is root. (Lei Eddy Xu via Yongjun Zhang) (yzhang: rev 44809b80814d5520a73d5609d0f73a13eb2360ac)
* hadoop-tools/hadoop-distcp/src/main/java/org/apache/hadoop/tools/mapred/CopyCommitter.java
* hadoop-common-project/hadoop-common/CHANGES.txt
, FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #135 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/135/])
HADOOP-11724. DistCp throws NPE when the target directory is root. (Lei Eddy Xu via Yongjun Zhang) (yzhang: rev 44809b80814d5520a73d5609d0f73a13eb2360ac)
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-tools/hadoop-distcp/src/main/java/org/apache/hadoop/tools/mapred/CopyCommitter.java
]