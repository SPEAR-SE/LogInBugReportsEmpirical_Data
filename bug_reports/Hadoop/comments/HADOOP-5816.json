[Talked with Min about this bug two weeks ago. This is an obvious bug.  However, in most situations when used in MapReduce jobs like TestKeyFieldBasedComparator does, this bug will not trigger IndexOutofBoundException but will misbehave, that is because the byte array in MapOutBuffer is large enough. So i inclued in TestKeyFieldBasedComparator a test without running mapreduce job. , I just committed this. Thanks, He!]