[Here is patch doing the following:
1. Adds CleanupAttempt to JobHistory. The cleanup tasks are logged in history as CleanupAttempts. And the TASK_TYPE is CLEANUP.  This change also fixes ArrayOutOfBoundException in analyzeJob link.
2. Updates JobTasksParseListener about CleanupAttempt
3. JobInProgress is modified to log the cleanup task as CleanupAttempt. Also removes an extra JobFailed log from history.
4. Updates jobhistory.jsp and HistoryViewer.java to show cleanup task.

, Few comments

_JobHistory  :_ 
1) The comment for {{CleanupAttempt}} class needs to be changed.
2) {{logFailed()}} and {{logKilled()}} differ in one string. I assume you have done just to keep the code consistent. Someday we should collapse both the api's into something like {{logComplete()}}. There is a lot of duplicate/redundant code.

_JobInProgress :_ 
1) Why is job-failed log removed? Redundancy?
2) I think there are some diffs because of formatting changes

Note that I have just checked {{JobHistory.java}} and {{JobInProgress.java}}., Thanks for the review.

bq. logFailed() and logKilled() differ in one string. I assume you have done just to keep the code consistent. Someday we should collapse both the api's into something like logComplete(). There is a lot of duplicate/redundant code.
Yes. I raised HADOOP-4122 for the same.

bq. Why is job-failed log removed? Redundancy?
Yes. It is a redundant log. Moreover, JobInfo.logFailed log closes the log file. Then the cleanupAttempt logs will be missed, because killJob launches a cleanup task and after the completion of cleanup, job is marked Failed.

Patch incorporates other comments, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12389725/patch-4112.txt
  against trunk revision 693360.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3214/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3214/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3214/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3214/console

This message is automatically generated., Changes made to {{JobHistory}} and {{JobInProgress}} look fine to me., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12389729/patch-4112.txt
  against trunk revision 693404.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3216/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3216/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3216/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3216/console

This message is automatically generated., We need not have CleanupAttempt as separate TaskAttempt, making TASK_TYPE as CLEANUP will solve the problem, Here is patch removing CleanupAttempt introduced in earlier patch. The cleanup tasks are logged with CLEANUP as TASK_TYPE. The patch adds the following methods to TaskAttempt
{noformat}
    public static void logStarted(TaskAttemptID taskAttemptId, long startTime,  String hostName, boolean isMap, boolean isCleanup) 
    public static void logFinished(TaskAttemptID taskAttemptId, long finishTime,  String hostName, boolean isMap, boolean isCleanup) 
    public static void logKilled(TaskAttemptID taskAttemptId, long timestamp, String hostName, String error, boolean isFailure, boolean isMap, boolean isCleanup) 
{noformat}
The methods in MapAttempt and ReduceAttempt are modified to use the new methods. And JobInProgress's updating history is modified to use the new methods.
There is no change for the JobTasksParseListener now. And there are no changes in jobhistory.jsp and HistoryViewer from the earlier patch., test-patch result on the trunk:
{noformat}
     [exec] -1 overall.
     [exec]
     [exec]     +1 @author.  The patch does not contain any @author tags.
     [exec]
     [exec]     -1 tests included.  The patch doesn't appear to include any new or modified tests.
     [exec]                         Please justify why no tests are needed for this patch.
     [exec]
     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.
     [exec]
     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.
     [exec]
     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.
     [exec]
     [exec]
{noformat}

All unit tests except TestHighRAMJobs passed on my machine.  TestHighRAMJobs failure is due to HADOOP-4129, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12389804/patch-4112.txt
  against trunk revision 693705.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 core tests.  The patch passed core unit tests.

    +1 contrib tests.  The patch passed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3229/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3229/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3229/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3229/console

This message is automatically generated., I think the refactoring of JobHistory apis should be done as a part of HADOOP-4122., The patch removes refactoring done in earlier patch. A boolean parameter, isCleanup, is added to the methods in MapAttempt and ReduceAttempt and old methods are deprecated.

, test-patch result on trunk :
{noformat}
     [exec] -1 overall.
     [exec]
     [exec]     +1 @author.  The patch does not contain any @author tags.
     [exec]
     [exec]     -1 tests included.  The patch doesn't appear to include any new or modified tests.
     [exec]                         Please justify why no tests are needed for this patch.
     [exec]
     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.
     [exec]
     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.
     [exec]
     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.
     [exec]
{noformat}

All core tests and contrib tests passed on my mahcine except TestHighRAMJobs.
, I just committed this. Thanks, Amareshwari!, > All core tests and contrib tests passed on my mahcine except TestHighRAMJobs.

Is there any reason that TestHighRAMJobs fails?  It also failed in my machine., bq. Is there any reason that TestHighRAMJobs fails? It also failed in my machine.
Due to HADOOP-4129, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12389987/patch-4112.txt
  against trunk revision 695604.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3262/console

This message is automatically generated.]