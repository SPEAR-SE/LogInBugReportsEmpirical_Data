[Should have worked.

Have you set HADOOP_HOME and HIVE_HOME environment variables.

Also a dump of your environment would be great including classpaths., I already setted HADOOP_HOME ,HIVE_HOME and added hadoop_site.xml to CLASSPATH

But "bin/hive" doesn't work ,either.

The error message is the same.

\-_\-::, I have noticed that I have to start hive from the contrib directory pwd /opt/hadoop/contrib
hive/bin/hive give that a try., This seems to be some issue with your environment. I tried this on mine. The following is the output and bin/hive seems to work fine for me... I am not sure what is going on with your environment. Can you check or send is your classpath settings?

[~]$ cd fb_mirror/
[~/fb_mirror]$ curl http://mirror.facebook.com/facebook/hive/hadoop-0.17/dist.tar.gz > dist.tar.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 8025k  100 8025k    0     0  5355k      0  0:00:01  0:00:01 --:--:-- 6078k
[~/fb_mirror]$ ls
dist.tar.gz
[~/fb_mirror]$ gunzip dist.tar.gz 
[~/fb_mirror]$ ls
dist.tar
[~/fb_mirror]$ tar xvf dist.tar 
dist/
dist/lib/
dist/lib/py/
dist/lib/py/hive_metastore/
dist/lib/py/hive_metastore/ttypes.py
dist/lib/py/hive_metastore/ThriftMetaStore-remote
dist/lib/py/hive_metastore/ThriftHiveMetastore-remote
dist/lib/py/hive_metastore/ThriftHiveMetastore.py
dist/lib/py/hive_metastore/ThriftMetaStore.py
dist/lib/py/hive_metastore/constants.py
dist/lib/py/hive_metastore/__init__.py
dist/lib/py/__init__.py
dist/lib/py/org_apache_hadoop_hive_serde/
dist/lib/py/org_apache_hadoop_hive_serde/__init__.py
dist/lib/py/org_apache_hadoop_hive_serde/ttypes.py
dist/lib/py/org_apache_hadoop_hive_serde/constants.py
dist/lib/php/
dist/lib/php/serde_types.php
dist/lib/php/ThriftMetaStore.php
dist/lib/php/serde_constants.php
dist/lib/php/hive_metastore_types.php
dist/lib/php/hive_metastore_constants.php
dist/lib/php/ThriftHiveMetastore.php
dist/lib/hive_metastore.jar
dist/lib/jpox-rdbms-1.2.2.jar
dist/lib/hive_common.jar
dist/lib/jpox-core-1.2.2.jar
dist/lib/stringtemplate-3.1b1.jar
dist/lib/libfb303.jar
dist/lib/velocity-1.5.jar
dist/lib/jpox-enhancer-1.2.2.jar
dist/lib/derby.jar
dist/lib/antlr-runtime-3.0.1.jar
dist/lib/commons-collections-3.2.1.jar
dist/lib/jline-0.9.94.jar
dist/lib/libthrift.jar
dist/lib/hive_cli.jar
dist/lib/asm-3.1.jar
dist/lib/hive_exec.jar
dist/lib/TestSerDe.jar
dist/lib/commons-jexl-1.1.jar
dist/lib/jdo2-api-2.1.jar
dist/lib/commons-lang-2.4.jar
dist/conf/
dist/conf/hive-default.xml
dist/conf/hive-log4j.properties
dist/conf/jpox.properties
dist/bin/
dist/bin/hive
dist/bin/hive-config.sh
dist/examples/
dist/examples/files/
dist/examples/files/kv2.txt
dist/examples/files/kv1.txt
dist/examples/files/kv1.string-sorted.txt
dist/examples/files/kv1.val.sorted.txt
dist/examples/files/lt100.sorted.txt
dist/examples/files/lt100.txt
dist/examples/files/kv1_cc.txt
dist/examples/files/kv1kv2.cogroup.txt
dist/examples/files/kv1_cb.txt
dist/examples/files/kv1.seq
dist/examples/files/kv4.txt
dist/examples/files/complex.seq
dist/examples/files/TestSerDe.jar
dist/examples/files/kv3.txt
dist/examples/queries/
dist/examples/queries/sample1.q
dist/examples/queries/input9.q
dist/examples/queries/groupby6.q
dist/examples/queries/join3.q
dist/examples/queries/input8.q
dist/examples/queries/groupby5.q
dist/examples/queries/union.q
dist/examples/queries/join2.q
dist/examples/queries/input7.q
dist/examples/queries/groupby4.q
dist/examples/queries/sample7.q
dist/examples/queries/join1.q
dist/examples/queries/input6.q
dist/examples/queries/groupby3.q
dist/examples/queries/sample6.q
dist/examples/queries/input_testxpath.q
dist/examples/queries/input5.q
dist/examples/queries/groupby2.q
dist/examples/queries/udf1.q
dist/examples/queries/join8.q
dist/examples/queries/input_part1.q
dist/examples/queries/sample5.q
dist/examples/queries/input_testsequencefile.q
dist/examples/queries/input4.q
dist/examples/queries/groupby1.q
dist/examples/queries/join7.q
dist/examples/queries/sample4.q
dist/examples/queries/input_testxpath2.q
dist/examples/queries/input3.q
dist/examples/queries/join6.q
dist/examples/queries/subq.q
dist/examples/queries/sample3.q
dist/examples/queries/cast1.q
dist/examples/queries/input2.q
dist/examples/queries/join5.q
dist/examples/queries/sample2.q
dist/examples/queries/input1.q
dist/examples/queries/case_sensitivity.q
dist/examples/queries/join4.q
dist/README
[~/fb_mirror]$ ls
dist  dist.tar
[~/fb_mirror]$ cd dist
[~/fb_mirror/dist]$ ls
bin  conf  examples  lib  README
[~/fb_mirror/dist]$ ls
bin  conf  examples  lib  README
[athusoo@dev053.snc1 ~/fb_mirror/dist]$ bin/hive   
Cannot find hadoop installation: $HADOOP_HOME must be set or hadoop must be in the path
[~/fb_mirror/dist]$ ls /mnt/vol/hadoop/bin
1                hadoop                   index.html       slaves.sh                 start-dfs.sh                 stop-all.sh       stop-mapred.sh
check_nodes.sh   hadoop2~                 index.html.1     start-all.sh              start-dfs.sh~                stop-balancer.sh  timed_command
check_nodes.sh~  hadoop-config.sh         index.html.2     start-balancer.sh         start-mapred.nojob.sh~       stop-cluster.sh
decommission.sh  hadoop-daemon.sh         index.html.3     start-cluster-mapred.sh~  start-mapred.sh              stop-cluster.sh~
fsck.sh          hadoop-daemons.sh        rcc              start-cluster.sh          start-single-datanode.sh     stop-dfs.sh
fsck.sh~         hadoop-single-daemon.sh  single-slave.sh  start-cluster.sh~         start-single-tasktracker.sh  stop-dfs.sh~
[~/fb_mirror/dist]$ ls /mnt/vol/hadoop/bin/hadoop
/mnt/vol/hive/stable/cluster/bin/hadoop
[~/fb_mirror/dist]$ export HADOOP_HOME=/mnt/vol/hadoop
[~/fb_mirror/dist]$ bin/hive 
hive> , Downgrading to critical as this seems to be specific to the users environment and has not been reported by a number of other users., Hi I tried to install again,but the answer is the same.
So I show the step and my environment . And thank you for your help

[ Install Step]
[root@araca1 hive]# cd /hadoop-0.17.2.1/contrib/hive

[root@araca1 hive]# tar -zxvf ./dist.tar.gz
dist/
dist/lib/
dist/lib/py/
dist/lib/py/hive_metastore/
dist/lib/py/hive_metastore/ttypes.py
dist/lib/py/hive_metastore/ThriftMetaStore-remote
dist/lib/py/hive_metastore/ThriftHiveMetastore-remote
dist/lib/py/hive_metastore/ThriftHiveMetastore.py
dist/lib/py/hive_metastore/ThriftMetaStore.py
dist/lib/py/hive_metastore/constants.py
dist/lib/py/hive_metastore/__init__.py
dist/lib/py/__init__.py
dist/lib/py/org_apache_hadoop_hive_serde/
dist/lib/py/org_apache_hadoop_hive_serde/__init__.py
dist/lib/py/org_apache_hadoop_hive_serde/ttypes.py
dist/lib/py/org_apache_hadoop_hive_serde/constants.py
dist/lib/php/
dist/lib/php/serde_types.php
dist/lib/php/ThriftMetaStore.php
dist/lib/php/serde_constants.php
dist/lib/php/hive_metastore_types.php
dist/lib/php/hive_metastore_constants.php
dist/lib/php/ThriftHiveMetastore.php
dist/lib/hive_metastore.jar
dist/lib/jpox-rdbms-1.2.2.jar
dist/lib/hive_common.jar
dist/lib/jpox-core-1.2.2.jar
dist/lib/stringtemplate-3.1b1.jar
dist/lib/libfb303.jar
dist/lib/velocity-1.5.jar
dist/lib/jpox-enhancer-1.2.2.jar
dist/lib/derby.jar
dist/lib/antlr-runtime-3.0.1.jar
dist/lib/commons-collections-3.2.1.jar
dist/lib/jline-0.9.94.jar
dist/lib/libthrift.jar
dist/lib/hive_cli.jar
dist/lib/asm-3.1.jar
dist/lib/hive_exec.jar
dist/lib/TestSerDe.jar
dist/lib/commons-jexl-1.1.jar
dist/lib/jdo2-api-2.1.jar
dist/lib/commons-lang-2.4.jar
dist/conf/
dist/conf/hive-default.xml
dist/conf/hive-log4j.properties
dist/conf/jpox.properties
dist/bin/
dist/bin/hive
dist/bin/hive-config.sh
dist/examples/
dist/examples/files/
dist/examples/files/kv2.txt
dist/examples/files/kv1.txt
dist/examples/files/kv1.string-sorted.txt
dist/examples/files/kv1.val.sorted.txt
dist/examples/files/lt100.sorted.txt
dist/examples/files/lt100.txt
dist/examples/files/kv1_cc.txt
dist/examples/files/kv1kv2.cogroup.txt
dist/examples/files/kv1_cb.txt
dist/examples/files/kv1.seq
dist/examples/files/kv4.txt
dist/examples/files/complex.seq
dist/examples/files/TestSerDe.jar
dist/examples/files/kv3.txt
dist/examples/queries/
dist/examples/queries/sample1.q
dist/examples/queries/input9.q
dist/examples/queries/groupby6.q
dist/examples/queries/join3.q
dist/examples/queries/input8.q
dist/examples/queries/groupby5.q
dist/examples/queries/udf4.q
dist/examples/queries/union.q
dist/examples/queries/join2.q
dist/examples/queries/input7.q
dist/examples/queries/groupby4.q
dist/examples/queries/sample7.q
dist/examples/queries/join1.q
dist/examples/queries/input6.q
dist/examples/queries/groupby3.q
dist/examples/queries/sample6.q
dist/examples/queries/input_testxpath.q
dist/examples/queries/input5.q
dist/examples/queries/groupby2.q
dist/examples/queries/udf1.q
dist/examples/queries/join8.q
dist/examples/queries/input_part1.q
dist/examples/queries/sample5.q
dist/examples/queries/input_testsequencefile.q
dist/examples/queries/input4.q
dist/examples/queries/groupby1.q
dist/examples/queries/join7.q
dist/examples/queries/sample4.q
dist/examples/queries/input_testxpath2.q
dist/examples/queries/input3.q
dist/examples/queries/join6.q
dist/examples/queries/subq.q
dist/examples/queries/sample3.q
dist/examples/queries/cast1.q
dist/examples/queries/input2.q
dist/examples/queries/join5.q
dist/examples/queries/sample2.q
dist/examples/queries/input1.q
dist/examples/queries/case_sensitivity.q
dist/examples/queries/join4.q
dist/README


[My environment ]
[root@araca1 ~]# echo $HADOOP_HOME
/hadoop-0.17.2.1
[root@araca1 ~]# echo $HIVE_HOME
/hadoop-0.17.2.1/contrib/hive/dist
[root@araca1 ~]# echo $CLASSPATH
.:/jdk1.6.0_07/lib:/jdk1.6.0_07/lib/ojdbc14.jar:/hadoop-0.17.2.1/lib/:/hadoop-0.17.2.1/:/hadoop-0.17.2.1/hadoop-0.17.2.1-core.jar:/hadoop-0.17.2.1/conf/:/hadoop-0.17.2.1/lib/log4j-1.2.13.jar:/hadoop-0.17.2.1/example.jar:/hadoop-0.17.2.1/contrib/hbase-0.2.1/lib/:/hadoop-0.17.2.1/contrib/hbase-0.2.1/hbase-0.2.1.jar:/hadoop-0.17.2.1/contrib/hbase-0.2.1/lib/:/hadoop-0.17.2.1/contrib/hbase-0.2.1/lib/junit-3.8.1.jar:/hadoop-0.17.2.1/contrib/hbase-0.2.1/lib/log4j-1.2.13.jar:/hadoop-0.17.2.1/contrib/hbase-0.2.1/lib/commons-logging-1.0.4.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/:/hadoop-0.17.2.1/contrib/hive/dist/lib/antlr-runtime-3.0.1.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/asm-3.1.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/commons-collections-3.2.1.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/commons-jexl-1.1.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/commons-lang-2.4.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/derby.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/hive_cli.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/hive_common.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/hive_exec.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/hive_metastore.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/jdo2-api-2.1.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/jline-0.9.94.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/jpox-core-1.2.2.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/jpox-enhancer-1.2.2.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/jpox-rdbms-1.2.2.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/libfb303.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/libthrift.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/stringtemplate-3.1b1.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/TestSerDe.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/velocity-1.5.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/derbyclient.jar:/hadoop-0.17.2.1/contrib/hive/dist/lib/derbytools.jar

[Run hive]

[root@araca1 ~]# cd $HIVE_HOME
[root@araca1 dist]# pwd
/hadoop-0.17.2.1/contrib/hive/dist
[root@araca1 dist]# ./bin/hive
java.lang.NoClassDefFoundError: org/apache/hadoop/hive/ql/session/SessionState
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Class.java:247)
        at org.apache.hadoop.util.RunJar.main(RunJar.java:148)
        at org.apache.hadoop.mapred.JobShell.run(JobShell.java:194)
        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:65)
        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:79)
        at org.apache.hadoop.mapred.JobShell.main(JobShell.java:220)
Caused by: java.lang.ClassNotFoundException: org.apache.hadoop.hive.ql.session.SessionState
        at java.net.URLClassLoader$1.run(URLClassLoader.java:200)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:188)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:306)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:251)
        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319)
        ... 7 more

[root@araca1 dist]# jps
15464 NameNode
15587 DataNode
15735 SecondaryNameNode
15833 JobTracker
29244 Jps
15973 TaskTracker
, Hi YihueyChyi,

Can you uncomment the last 4 "echo" lines from bin/hive (as following) and run again?

echo "CLASSPATH="$CLASSPATH
echo "AUX_LIB_PATH"=$AUX_PARAM
echo "HADOOP_OPTS="$HADOOP_OPTS
echo $HADOOP jar $AUX_JARS_CMD_LINE ${HIVE_LIB}/hive_cli.jar $CLASS $HIVE_OPTS "$@"

What did it show?

Zheng
, Hi Zheng,
It show

CLASSPATH=/hadoop-0.17.2.1/contrib/hive/dist/bin/../conf:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/antlr-runtime-3.0.1.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/asm-3.1.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/commons-collections-3.2.1.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/commons-jexl-1.1.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/commons-lang-2.4.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/derby.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/hive_cli.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/hive_common.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/hive_exec.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/hive_metastore.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/jdo2-api-2.1.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/jline-0.9.94.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/jpox-core-1.2.2.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/jpox-enhancer-1.2.2.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/jpox-rdbms-1.2.2.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/libfb303.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/libthrift.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/stringtemplate-3.1b1.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/TestSerDe.jar:/hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/velocity-1.5.jar:
AUX_LIB_PATH=
HADOOP_OPTS=
/hadoop-0.17.2.1/bin/hadoop jar /hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/hive_cli.jar org.apache.hadoop.hive.cli.CliDriver -hiveconf hadoop.bin.path=/hadoop-0.17.2.1/bin/hadoop
java.lang.NoClassDefFoundError: org/apache/hadoop/hive/ql/session/SessionState
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Class.java:247)
        at org.apache.hadoop.util.RunJar.main(RunJar.java:148)
        at org.apache.hadoop.mapred.JobShell.run(JobShell.java:194)
        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:65)
        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:79)
        at org.apache.hadoop.mapred.JobShell.main(JobShell.java:220)
Caused by: java.lang.ClassNotFoundException: org.apache.hadoop.hive.ql.session.SessionState
        at java.net.URLClassLoader$1.run(URLClassLoader.java:200)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:188)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:306)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:251)
        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319)
        ... 7 more
, The class org.apache.hadoop.hive.ql.session.SessionState is in /hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/hive_exec.jar
That jar file is in the classpath as printed by bin/hive.

Can you open /hadoop-0.17.2.1/bin/hadoop and add one line before the last line (The echo line):
...
# run it
echo "$JAVA" $JAVA_HEAP_MAX $HADOOP_OPTS -classpath "$CLASSPATH" $CLASS "$@"
exec "$JAVA" $JAVA_HEAP_MAX $HADOOP_OPTS -classpath "$CLASSPATH" $CLASS "$@"

Let's see what is actually passed to Java.
, Add the line 

The result:
/jdk1.6.0_07/bin/java -Xmx1000m -Dhadoop.log.dir=/hadoop-0.17.2.1/logs -Dhadoop.log.file=hadoop.log -Dhadoop.home.dir=/hadoop-0.17.2.1 -Dhadoop.id.str= -Dhadoop.root.logger=INFO,console -Djava.library.path=/hadoop-0.17.2.1/lib/native/Linux-i386-32 -classpath /hadoop-0.17.2.1/bin/../conf:/jdk1.6.0_07/lib/tools.jar:/hadoop-0.17.2.1:/hadoop-0.17.2.1/hadoop-0.17.2.1-core.jar:/hadoop-0.17.2.1/lib/commons-cli-2.0-SNAPSHOT.jar:/hadoop-0.17.2.1/lib/commons-codec-1.3.jar:/hadoop-0.17.2.1/lib/commons-httpclient-3.0.1.jar:/hadoop-0.17.2.1/lib/commons-logging-1.0.4.jar:/hadoop-0.17.2.1/lib/commons-logging-api-1.0.4.jar:/hadoop-0.17.2.1/lib/jets3t-0.5.0.jar:/hadoop-0.17.2.1/lib/jetty-5.1.4.jar:/hadoop-0.17.2.1/lib/junit-3.8.1.jar:/hadoop-0.17.2.1/lib/kfs-0.1.jar:/hadoop-0.17.2.1/lib/log4j-1.2.13.jar:/hadoop-0.17.2.1/lib/servlet-api.jar:/hadoop-0.17.2.1/lib/xmlenc-0.52.jar:/hadoop-0.17.2.1/lib/jetty-ext/commons-el.jar:/hadoop-0.17.2.1/lib/jetty-ext/jasper-compiler.jar:/hadoop-0.17.2.1/lib/jetty-ext/jasper-runtime.jar:/hadoop-0.17.2.1/lib/jetty-ext/jsp-api.jar:.:/jdk1.6.0_07/lib:/hadoop-0.17.2.1/conf://hadoop-0.17.2.1/lib:/hadoop-0.17.2.1/contrib/hbase-0.2.1/build/test:/hadoop-0.17.2.1/contrib/hbase-0.2.1/build/hadoop-0.16.0-hbase.jar:/hadoop-0.17.2.1/contrib/hbase-0.2.1/conf:/hadoop-0.17.2.1/contrib/hbase-0.2.1/hbase-0.2.1.jar:/hadoop-0.17.2.1/hadoop-0.17.2.1-core.jar org.apache.hadoop.mapred.JobShell /hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/hive_cli.jar org.apache.hadoop.hive.cli.CliDriver -hiveconf hadoop.bin.path=/hadoop-0.17.2.1/bin/hadoop
java.lang.NoClassDefFoundError: org/apache/hadoop/hive/ql/session/SessionState
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Class.java:247)
        at org.apache.hadoop.util.RunJar.main(RunJar.java:148)
        at org.apache.hadoop.mapred.JobShell.run(JobShell.java:194)
        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:65)
        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:79)
        at org.apache.hadoop.mapred.JobShell.main(JobShell.java:220)
Caused by: java.lang.ClassNotFoundException: org.apache.hadoop.hive.ql.session.SessionState
        at java.net.URLClassLoader$1.run(URLClassLoader.java:200)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:188)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:306)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:251)
        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319)
        ... 7 more

Even I copy hive_exec.jar to $HADOOP_HOME/lib/
The situation is the same. 

[root@araca1 dist]# ./bin/hive
/jdk1.6.0_07/bin/java -Xmx1000m -Dhadoop.log.dir=/hadoop-0.17.1/logs -Dhadoop.log.file=hadoop.log -Dhadoop.home.dir=/hadoop-0.17.1 -Dhadoop.id.str= -Dhadoop.root.logger=INFO,console -Djava.library.path=/hadoop-0.17.1/lib/native/Linux-i386-32 -classpath /hadoop-0.17.2.1/bin/../conf:/jdk1.6.0_07/lib/tools.jar:/hadoop-0.17.1:/hadoop-0.17.1/hadoop-0.17.1-core.jar:/hadoop-0.17.1/lib/commons-cli-2.0-SNAPSHOT.jar:/hadoop-0.17.1/lib/commons-codec-1.3.jar:/hadoop-0.17.1/lib/commons-httpclient-3.0.1.jar:/hadoop-0.17.1/lib/commons-logging-1.0.4.jar:/hadoop-0.17.1/lib/commons-logging-api-1.0.4.jar:/hadoop-0.17.1/lib/jets3t-0.5.0.jar:/hadoop-0.17.1/lib/jetty-5.1.4.jar:/hadoop-0.17.1/lib/junit-3.8.1.jar:/hadoop-0.17.1/lib/kfs-0.1.jar:/hadoop-0.17.1/lib/log4j-1.2.13.jar:/hadoop-0.17.1/lib/servlet-api.jar:/hadoop-0.17.1/lib/xmlenc-0.52.jar:/hadoop-0.17.1/lib/jetty-ext/commons-el.jar:/hadoop-0.17.1/lib/jetty-ext/jasper-compiler.jar:/hadoop-0.17.1/lib/jetty-ext/jasper-runtime.jar:/hadoop-0.17.1/lib/jetty-ext/jsp-api.jar:.:/jdk1.6.0_07/lib:/hadoop-0.17.1/conf:/hadoop-0.17.1/lib:/hadoop-0.17.1/contrib/hbase-0.2.1/build/test:/hadoop-0.17.1/contrib/hbase-0.2.1/build/hadoop-0.16.0-hbase.jar:/hadoop-0.17.1/contrib/hbase-0.2.1/conf:/hadoop-0.17.1/contrib/hbase-0.2.1/hbase-0.2.1.jar:/hadoop-0.17.1/hadoop-0.17.1-core.jar org.apache.hadoop.mapred.JobShell /hadoop-0.17.2.1/contrib/hive/dist/bin/../lib/hive_cli.jar org.apache.hadoop.hive.cli.CliDriver -hiveconf hadoop.bin.path=/hadoop-0.17.2.1/bin/hadoop
java.lang.NoClassDefFoundError: org/apache/hadoop/hive/ql/session/SessionState
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Class.java:247)
        at org.apache.hadoop.util.RunJar.main(RunJar.java:148)
        at org.apache.hadoop.mapred.JobShell.run(JobShell.java:194)
        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:65)
        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:79)
        at org.apache.hadoop.mapred.JobShell.main(JobShell.java:220)
Caused by: java.lang.ClassNotFoundException: org.apache.hadoop.hive.ql.session.SessionState
        at java.net.URLClassLoader$1.run(URLClassLoader.java:200)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:188)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:306)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:251)
        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319)
        ... 7 more


, Hi YihueyChyi,

It seems the problem is clear now. The java command does not contains hive_exec.jar in the classpath.

What bin/hive does is to put all necessary jars in an environment variable HADOOP_CLASSPATH, and then call bin/hadoop.
bin/hadoop is supposed to pick HADOOP_CLASSPATH up.

My guess is that you modified bin/hadoop or bin/hadoop-env.sh and have a line like:

export HADOOP_CLASSPATH="xxx"

Is that correct? If so, please do:
export HADOOP_CLASSPATH="xxx:$HADOOP_CLASSPATH"
, Hi Zheng ,

Oh !! It's working.
I add a line " export HADOOP_CLASSPATH=$CLASSPATH:$HADOOP_CLASSPATH " to  bin/hadoop-env.sh.


The old version 
 export HADOOP_CLASSPATH=.:$JAVA_HOME/lib:$HADOOP_HOME/conf:/$HADOOP_HOME/lib:$HBASE_HOME/build/test:$HBASE_HOME/build/hadoop-0.16.0-hbase.jar:$HBASE_HOME/conf:$HBASE_HOME/hbase-0.2.1.jar:$HADOOP_HOME/hadoop-0.17.2.1-core.jar

The new version
 export HADOOP_CLASSPATH=.:$JAVA_HOME/lib:$HADOOP_HOME/conf:/$HADOOP_HOME/lib:$HBASE_HOME/build/test:$HBASE_HOME/build/hadoop-0.16.0-hbase.jar:$HBASE_HOME/conf:$HBASE_HOME/hbase-0.2.1.jar:$HADOOP_HOME/hadoop-0.17.2.1-core.jar
 export HADOOP_CLASSPATH=$CLASSPATH:$HADOOP_CLASSPATH


Thank you very much.
The problems are many days.
, We found the problem in the customized hadoop code.
, Glad it helps. To tell you the truth, I made exactly the same mistake before., Thank you a lot.
I traced the hive_exec.jar code and check hadoop ,hadoop-env.sh and environment variables ,but I didn't think about $HADOOP_CLASSPATH.

So thank you again.

\^o\^
]