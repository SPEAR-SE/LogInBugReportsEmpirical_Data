[This depends on https://issues.apache.org/jira/browse/HADOOP-6693 for which there is no trunk patch, therefore this jira only has 0.20 patch at the moment.]