[In {{JvmPauseMonitor}} {{monitorThread}} gets initialized only in RMActiveServices#serviceStart but in testcases we are not starting the same. 

One fix could be JvmPauseMonitor#stop

{code}
  public void stop() {
    shouldRun = false;
    if (null != monitorThread) {
      monitorThread.interrupt();
      try {
        monitorThread.join();
      } catch (InterruptedException e) {
        Thread.currentThread().interrupt();
      }
    }
  }
{code}

Thoughts?, \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  16m 42s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:red}-1{color} | tests included |   0m  0s | The patch doesn't appear to include any new or modified tests.  Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. |
| {color:green}+1{color} | javac |   7m 42s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |   9m 37s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 23s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m  5s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 21s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 34s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   1m 53s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:red}-1{color} | common tests |  22m 18s | Tests failed in hadoop-common. |
| | |  61m 38s | |
\\
\\
|| Reason || Tests ||
| Failed unit tests | hadoop.ha.TestZKFailoverController |
|   | hadoop.net.TestNetUtils |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12749428/YARN-4035.1.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 8f73bdd |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-YARN-Build/8800/artifact/patchprocess/testrun_hadoop-common.txt |
| Test Results | https://builds.apache.org/job/PreCommit-YARN-Build/8800/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf906.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-YARN-Build/8800/console |


This message was automatically generated., thanks of the patch!!
One comment, the below code modification is not required right
{code}
+    if (shouldRun) {
+      monitorThread.start();
+    }
{code}, Thanks [~gliptak] for working out a patch and [~rohithsharma] for the comments!
Instead of adding "if (shouldRun)" to start monitorThread in start(), I think the right thing to do is set "shouldRun = true" in start(), so JvmPauseMonitor could be restarted after stop (or it cannot be restart again).
In addition, given the patch all happens in hadoop-common-project, I think we should move the JIRA from YARN to HADOOP., [~rohithsharma] That is my attempt to make this "state-friendly" ... If stop() happens before start completed, you would leave a thread behind.

[~djp] The "proper way" would be to synchronize both start()/stop() (in particular if restart is an expectation). Would you like an updated patch implementing?
, bq. given the patch all happens in hadoop-common-project, I think we should move the JIRA from YARN to HADOOP.
make sense, this fix is in Hadoop common, moving to HADOOP common project., Assigned to me by mistake, assigned back to [~gliptak], bq. The "proper way" would be to synchronize both start()/stop() (in particular if restart is an expectation). Would you like an updated patch implementing?
I am not sure if restart is an expectation at the beginning. But theoretically, any services should be restartable. However, just double checked with other services, like: NodeManager, ResourceManager, etc., it seems like all these services are implemented as one time only service. So I am fine with keeping things like this to conform the same pattern with other services. I will file another separated JIRA to discuss restartable issue unless someone tells me a solid reason on this.
Based on above comments, we don't need to handle start() after stop() case, so "if (shouldRun) { monitorThread.start(); }" is not necessary or not sufficient (at least we should log some warn messages). Either way should be fine to me.
, [~djp] I suggest keeping the if (shouldRun), as it helps in the edge case corrected here (when stop() comes before start() completes during unit tests)., bq.  I suggest keeping the if (shouldRun), as it helps in the edge case corrected here (when stop() comes before start() completes during unit tests)
If so, please add a warn message or user have not hints if it get started or not., Added warn message., Latest patch LGTM. +1 pending on Jenkins result., \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12750008/HADOOP-12313.2.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 1c12adb |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7450/console |


This message was automatically generated., \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12750008/HADOOP-12313.2.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 1c12adb |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7451/console |


This message was automatically generated., There are seems to be problem with Jenkins test against Hadoop Common Project. Filed INFRA-10111 to track that., [~gliptak], this patch got conflicted with YARN-3999 which just got committed. would you mind rebasing on that. , Uploaded rebased patch., \\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | pre-patch |  16m 46s | Pre-patch trunk compilation is healthy. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:red}-1{color} | tests included |   0m  0s | The patch doesn't appear to include any new or modified tests.  Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. |
| {color:green}+1{color} | javac |   7m 45s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |   9m 45s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 24s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   1m  8s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m  0s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 22s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 34s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |   1m 51s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:red}-1{color} | common tests |  22m 37s | Tests failed in hadoop-common. |
| | |  62m 15s | |
\\
\\
|| Reason || Tests ||
| Failed unit tests | hadoop.net.TestNetUtils |
|   | hadoop.security.token.delegation.web.TestWebDelegationToken |
|   | hadoop.ha.TestZKFailoverController |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12750170/HADOOP-12313.3.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 820f864 |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7455/artifact/patchprocess/testrun_hadoop-common.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/7455/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf900.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7455/console |


This message was automatically generated., why not make JvmPauseMonitor a subclass of ActiveService, so getting the lifecycle and non-reentrant serviceStop calls? It'd also make it trivial to deploy under any instance of CompositeService, so avoid needing any specific hooks in any service class planning to use it., I believe I created a JIRA long time ago to allow for pause/resume or stop/start semantics for services. Any takers? , I created HADOOP-12320 yesterday (which might be a duplicate as per [~kasha]

[~stevel@apache.org] Would you see this being worked under this Jira or the new "improvement" one?
, Let's fix the NPE in this JIRA, use HADOOP-12321 to make {{JvmPauseMonitor}} a Service, and use HADOOP-12320 to discuss making Services restartable in general., +1. Committing., I've committed the patch to trunk and branch-2. Thanks [~gliptak] for the contribution., FAILURE: Integrated in Hadoop-trunk-Commit #8858 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/8858/])
HADOOP-12313. NPE in JvmPauseMonitor when calling stop() before start(). (wheat9: rev 817ae221ac1ca8552748f6310d29ea1b26b5a21b)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/JvmPauseMonitor.java
* hadoop-common-project/hadoop-common/CHANGES.txt
, FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #701 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/701/])
HADOOP-12313. NPE in JvmPauseMonitor when calling stop() before start(). (wheat9: rev 817ae221ac1ca8552748f6310d29ea1b26b5a21b)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/JvmPauseMonitor.java
* hadoop-common-project/hadoop-common/CHANGES.txt
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #2642 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2642/])
HADOOP-12313. NPE in JvmPauseMonitor when calling stop() before start(). (wheat9: rev 817ae221ac1ca8552748f6310d29ea1b26b5a21b)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/JvmPauseMonitor.java
* hadoop-common-project/hadoop-common/CHANGES.txt
, | (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 0m 0s {color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green} 0m 0s {color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:red}-1{color} | {color:red} test4tests {color} | {color:red} 0m 0s {color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 8m 55s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 9m 41s {color} | {color:green} trunk passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 6s {color} | {color:green} trunk passed with JDK v1.7.0_85 {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 19s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green} 1m 10s {color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 15s {color} | {color:green} trunk passed {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red} 2m 6s {color} | {color:red} hadoop-common-project/hadoop-common in trunk has 1 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 2s {color} | {color:green} trunk passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 16s {color} | {color:green} trunk passed with JDK v1.7.0_85 {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 1m 45s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 9m 59s {color} | {color:green} the patch passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 9m 59s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 23s {color} | {color:green} the patch passed with JDK v1.7.0_85 {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 10m 23s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 19s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green} 1m 13s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 16s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green} 0m 0s {color} | {color:green} Patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 2m 20s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 5s {color} | {color:green} the patch passed with JDK v1.8.0_66 {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 9s {color} | {color:green} the patch passed with JDK v1.7.0_85 {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red} 7m 59s {color} | {color:red} hadoop-common in the patch failed with JDK v1.8.0_66. {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red} 8m 12s {color} | {color:red} hadoop-common in the patch failed with JDK v1.7.0_85. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green} 0m 23s {color} | {color:green} Patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 81m 8s {color} | {color:black} {color} |
\\
\\
|| Reason || Tests ||
| JDK v1.8.0_66 Failed junit tests | hadoop.ipc.TestDecayRpcScheduler |
|   | hadoop.fs.permission.TestFsPermission |
|   | hadoop.fs.shell.TestCopyPreserveFlag |
|   | hadoop.io.compress.TestCompressorDecompressor |
| JDK v1.8.0_66 Timed out junit tests | org.apache.hadoop.io.compress.lz4.TestLz4CompressorDecompressor |
| JDK v1.7.0_85 Failed junit tests | hadoop.fs.permission.TestFsPermission |
|   | hadoop.io.compress.TestCompressorDecompressor |
| JDK v1.7.0_85 Timed out junit tests | org.apache.hadoop.io.compress.lz4.TestLz4CompressorDecompressor |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:0ca8df7 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12750170/HADOOP-12313.3.patch |
| JIRA Issue | HADOOP-12313 |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |
| uname | Linux 609eb72c5639 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / 8228697 |
| findbugs | v3.0.0 |
| findbugs | https://builds.apache.org/job/PreCommit-HADOOP-Build/8134/artifact/patchprocess/branch-findbugs-hadoop-common-project_hadoop-common-warnings.html |
| unit | https://builds.apache.org/job/PreCommit-HADOOP-Build/8134/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common-jdk1.8.0_66.txt |
| unit | https://builds.apache.org/job/PreCommit-HADOOP-Build/8134/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common-jdk1.7.0_85.txt |
| unit test logs |  https://builds.apache.org/job/PreCommit-HADOOP-Build/8134/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common-jdk1.8.0_66.txt https://builds.apache.org/job/PreCommit-HADOOP-Build/8134/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common-jdk1.7.0_85.txt |
| JDK v1.7.0_85  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/8134/testReport/ |
| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |
| Max memory used | 75MB |
| Powered by | Apache Yetus   http://yetus.apache.org |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/8134/console |


This message was automatically generated.

, FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #712 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/712/])
HADOOP-12313. NPE in JvmPauseMonitor when calling stop() before start(). (wheat9: rev 817ae221ac1ca8552748f6310d29ea1b26b5a21b)
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/JvmPauseMonitor.java
, FAILURE: Integrated in Hadoop-Yarn-trunk #1436 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/1436/])
HADOOP-12313. NPE in JvmPauseMonitor when calling stop() before start(). (wheat9: rev 817ae221ac1ca8552748f6310d29ea1b26b5a21b)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/JvmPauseMonitor.java
* hadoop-common-project/hadoop-common/CHANGES.txt
, although its nice to have a fix, I'm testing HADOOP-12321 for a broader one ... it relies on the yarn service model for a strict state machine & won't won't do things like permit calls to start twice spawning off a thread again, etc., ABORTED: Integrated in Hadoop-Hdfs-trunk-Java8 #630 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/630/])
HADOOP-12313. NPE in JvmPauseMonitor when calling stop() before start(). (wheat9: rev 817ae221ac1ca8552748f6310d29ea1b26b5a21b)
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/JvmPauseMonitor.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk #2569 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/2569/])
HADOOP-12313. NPE in JvmPauseMonitor when calling stop() before start(). (wheat9: rev 817ae221ac1ca8552748f6310d29ea1b26b5a21b)
* hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/JvmPauseMonitor.java
* hadoop-common-project/hadoop-common/CHANGES.txt
]