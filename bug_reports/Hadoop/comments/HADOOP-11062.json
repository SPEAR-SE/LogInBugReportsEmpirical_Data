[# and {{Pnative-win}}, of course
# Or downgrade them to skip if openssl isn't on the path, if that is the problem.

FWIW SLIDER-394 covers failing fast if something is missing (winutils.exe, python, openssl); the probe is straightforward...run the relevant version command (openssl version, python --version) then inspect the status code & grep for expected strings back

[[https://github.com/apache/incubator-slider/blob/develop/slider-core/src/main/java/org/apache/slider/common/tools/SliderUtils.java#L1770]]


, Uploading initial patch.., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12666611/HADOOP-11062.1.patch
  against trunk revision f7df24b.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.server.balancer.TestBalancerWithEncryptedTransfer
                  org.apache.hadoop.hdfs.web.TestWebHdfsFileSystemContract
                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover

                                      The test build failed in hadoop-common-project/hadoop-common 

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4654//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4654//console

This message is automatically generated., Re-uploading, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12666660/HADOOP-11062.1.patch
  against trunk revision 6104520.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The test build failed in hadoop-hdfs-project/hadoop-hdfs 

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4656//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4656//console

This message is automatically generated., Hi [~asuresh],

I was under the impression from [~tucu00] that if -Pnative is not specified, then some sort of helpful warning should be written to the log. I applied your patch and ran TestCryptoCodec without the native profile using

{quote}
mvn test -Dtest=TestCryptoCodec
{quote}

The surefire report only shows that the tests in TCC were skipped and there's no corresponding output.

{quote}
-------------------------------------------------------------------------------
Test set: org.apache.hadoop.crypto.TestCryptoCodec
-------------------------------------------------------------------------------
Tests run: 2, Failures: 0, Errors: 0, Skipped: 2, Time elapsed: 0.268 sec - in org.apache.hadoop.crypto.TestCryptoCodec
{quote}

Actually, I may be doing something wrong, but running with the native profile

{quote}
mvn -Pnative test -Dtest=TestCryptoCodec
{quote}

produces the same surefire output (i.e. it skips both tests).

If the only requirement is that we skip the tests cleanly, then this patch is fine.

Other tests like TestCryptoStreamsWithOpensslAesCtrCryptoCodec, TestOpensslSecureRandom, and TestCryptoStreamsForLocalFS generate this warning

{quote}
2014-09-05 08:11:56,484 WARN  util.NativeCodeLoader (NativeCodeLoader.java:<clinit>(62)) - Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
{quote}

I don't know if that's a sufficient warning or not.
, [~clamb], So the test is skipping for 2 different reasons.
In the first case, when {{-Pnative}} is not specified, it skips because it doesnt find the {{runningWithNative}} System variable.
In the second case, when {{-Pnative}} IS specified, it skips because It can't load the OpenSSL library.

I'll probably modify it give a reason for skipping.. will also add the check to the other tests (I didn't earlier since I they running fine on my mac), Thanks for looking at this, Arun.  I agree with Charles that we should log something when we skip.  I tested with the second patch you uploaded (you might want to consider giving each patch a different name, btw), and it didn't output anything when skipping.  (It does log output when it ran the test via Pnative.)  Looks pretty good aside from that, though., Uploading latest Patch.

[~cmccabe], [~clamb] , In the first patch, I had used Junit's {{Assume.assumeTrue()}} function to which you can pass a boolean (in our case the check if {{-Pnative}} is enabled) and a Message... and it should skip the test after logging the message if the boolean is false .. Unfortunately, the maven surefire plugin does not seem to be logging the message anywhere..

I have modified the patch to actually throw a {{LOG.warn()}}. The message will be captured in the {{target/surefire-reports/org.apache.hadoop.crypto....-output.txt}} file, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12667317/HADOOP-11062.2.patch
  against trunk revision 7498dd7.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.web.TestWebHdfsFileSystemContract
                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4678//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4678//console

This message is automatically generated., Hi [~asuresh],

I wonder if you should use equalsIgnoreCase instead in order to idiot-proof against "true" getting changed to "True".

I ran with and without -Pnative and it def'ly log.warns if there's no -Pnative. It is silent if -Pnative is specified but there's no openssl present.
, Updated patch with [~clamb]'s suggestions.
Also, put in log message for when skipping is due to no openSSL., I forgot to ask why there's a surefire version change.

non-binding +1 from me.
, [~clamb], thanks for the review..
I upped the surefire version to see if newer versions are able to handle JUnit's {{Assume.assumeTrue()}} properly.. looks like they don't..

Attaching patch reverting the version change.., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12667425/HADOOP-11062.3.patch
  against trunk revision 90c8ece.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.web.TestWebHdfsFileSystemContract
                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover
                  org.apache.hadoop.hdfs.server.namenode.TestCacheDirectives

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4680//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4680//console

This message is automatically generated., I think in the long-term, we should have a little bit of a cleaner solution here.  It would be nice if the tests would start with {{PerformanceAdvisory}} logging turned up to maximum... then we wouldn't need to manually add logs to individual tests to note that the native library hadn't been loaded here.

But for the short-term, this fixes a problem we have and keeps the test coverage, so +1., I filed HADOOP-11079 to discuss turning on PerformanceAdvisory logging by default in tests, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12667444/HADOOP-11062.4.patch
  against trunk revision 90c8ece.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.ha.TestZKFailoverControllerStress
                  org.apache.hadoop.hdfs.web.TestWebHdfsFileSystemContract
                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4681//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4681//console

This message is automatically generated., indentation in the pom changes is wrong, are you using tab?, Corrected indentation in the pom files.., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12667929/HADOOP-11062.5.patch
  against trunk revision 4be9517.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.web.TestWebHdfsFileSystemContract
                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover

                                      The following test timeouts occurred in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:

org.apache.hadoop.http.TestHttpServerLifecycle

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4696//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4696//console

This message is automatically generated., +1, [~asuresh], would you please rebase the patch? it fails to apply., Rebasing patch.., Thanks Arun. Committed to trunk and branch-2., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12669339/HADOOP-11062.6.patch
  against trunk revision 0e7d1db.

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:

                  org.apache.hadoop.hdfs.TestEncryptionZonesWithKMS
                  org.apache.hadoop.hdfs.web.TestWebHdfsFileSystemContract
                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover

                                      The test build failed in hadoop-common-project/hadoop-common 

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/4745//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/4745//console

This message is automatically generated., SUCCESS: Integrated in Hadoop-Yarn-trunk #683 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/683/])
HADOOP-11062. CryptoCodec testcases requiring OpenSSL should be run only if -Pnative is used. (asuresh via tucu) (tucu: rev c0c7e6fabd573df85791d7ec4c536fd48280883f)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/crypto/TestCryptoCodec.java
* hadoop-common-project/hadoop-common/CHANGES.txt
* hadoop-hdfs-project/hadoop-hdfs/pom.xml
* hadoop-common-project/hadoop-common/pom.xml
, FAILURE: Integrated in Hadoop-Mapreduce-trunk #1899 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1899/])
HADOOP-11062. CryptoCodec testcases requiring OpenSSL should be run only if -Pnative is used. (asuresh via tucu) (tucu: rev c0c7e6fabd573df85791d7ec4c536fd48280883f)
* hadoop-common-project/hadoop-common/pom.xml
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/crypto/TestCryptoCodec.java
* hadoop-hdfs-project/hadoop-hdfs/pom.xml
* hadoop-common-project/hadoop-common/CHANGES.txt
, FAILURE: Integrated in Hadoop-Hdfs-trunk #1874 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1874/])
HADOOP-11062. CryptoCodec testcases requiring OpenSSL should be run only if -Pnative is used. (asuresh via tucu) (tucu: rev c0c7e6fabd573df85791d7ec4c536fd48280883f)
* hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/crypto/TestCryptoCodec.java
* hadoop-common-project/hadoop-common/pom.xml
* hadoop-hdfs-project/hadoop-hdfs/pom.xml
* hadoop-common-project/hadoop-common/CHANGES.txt
]