[Proposed fix, which uses different methods depending on whether we are in map or reduce task., +1, because http://issues.apache.org/jira/secure/attachment/12349457/key-value-class.patch applied and successfully tested against trunk revision r498829., OutputFormats are only used when reducing, to generate the final output.  They're not used when creating intermediate output.  So the bug here is that MapFileOutputFormat calls job.getMapOutput{Key,Value}Class()--those methods should only be called by the MapReduce kernel when generating intermediate output and should not be called by an OutputFormat implementation.  This bug was introduced by HADOOP-115.

http://svn.apache.org/viewvc/lucene/hadoop/trunk/src/java/org/apache/hadoop/mapred/MapFileOutputFormat.java?p2=%2Flucene%2Fhadoop%2Ftrunk%2Fsrc%2Fjava%2Forg%2Fapache%2Fhadoop%2Fmapred%2FMapFileOutputFormat.java&p1=%2Flucene%2Fhadoop%2Ftrunk%2Fsrc%2Fjava%2Forg%2Fapache%2Fhadoop%2Fmapred%2FMapFileOutputFormat.java&r1=407355&r2=407354&view=diff&pathrev=407355

The proper fix I think is to undo that change to this file., Fixed by reverting an accidental change introduced by HADOOP-115.]