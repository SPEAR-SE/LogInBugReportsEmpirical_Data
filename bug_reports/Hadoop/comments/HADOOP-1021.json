[Attached patch fixes the unit tests.  They now pass on Windows and Linux.  The way I fixed them removed dependence on fixing HADOOP-1020., +1, because http://issues.apache.org/jira/secure/attachment/12351189/HADOOP-1021.patch applied and successfully tested against trunk revision r507276., I just committed this.  Thanks, Nigel!]