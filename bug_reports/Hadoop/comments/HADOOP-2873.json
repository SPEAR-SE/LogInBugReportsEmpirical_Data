[This is mostly related HADOOP-2345.
, FSNameSystem.saveFilesUnderConstruction() and FSImage.loadFilesUnderConstruction() don't seem to match.

FSImage.loadFilesUnderConstruction() assumes there is only one file per lease., Andre,

as a temporary hack, you can just comment out the FSImage.java:749 and your restart should work, since these are last entries read from the image file.
, Store the number of files under construction rather than the number of leases., Must fix for 0.17. This was a regression introduced by HADOOP-2345., Do we need to increase the layout version? And to protect the users that upgraded to current trunk, we chould change FSImage.java:914 to {{   if (version >= -12) ... }} , The layout version was increased by HADOOP-2345. 
I think it should be promoted to 0.16.1. People will complain all the time., Sorry, it is was committed in 0.17, so the bug does not exist in 0.16.
I guess I wanted to say it should be fixed asap., Unit test. Bump layout version., There is a tmp log left in the patch. other than that,

+1. It fixes the above problem.
, Removed debug log message., I am going to commit this patch because it fixes a very serious problem with the Namenode transaction log. I have waited for 3 days for the HadoopQA tests to run, but is has not run yet. I think it is better to check in this fix sooner rather than wait for Hadoop QA to run., merged with latest trunk, I just committed this., Integrated in Hadoop-trunk #412 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-trunk/412/]), Noted as incompatible in changes.txt]