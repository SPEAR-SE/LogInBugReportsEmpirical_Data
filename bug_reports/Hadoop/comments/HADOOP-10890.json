[submit a patch for debugging purpose.

, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12657035/HDFS-6719.001.dbg.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common:

                  org.apache.hadoop.fs.shell.TestCopyPreserveFlag
                  org.apache.hadoop.ha.TestZKFailoverControllerStress
                  org.apache.hadoop.fs.shell.TestTextCommand
                  org.apache.hadoop.ipc.TestIPC
                  org.apache.hadoop.fs.shell.TestPathData
                  org.apache.hadoop.fs.TestDFVariations

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/7416//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/7416//console

This message is automatically generated., Another dbg version.
, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12657071/HDFS-6719.002.dbg.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common:

                  org.apache.hadoop.ipc.TestIPC

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/7421//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/7421//console

This message is automatically generated., {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12657108/HDFS-6719.002.dbg.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common:

                  org.apache.hadoop.fs.shell.TestCopyPreserveFlag
                  org.apache.hadoop.fs.shell.TestTextCommand
                  org.apache.hadoop.ipc.TestIPC
                  org.apache.hadoop.fs.shell.TestPathData
                  org.apache.hadoop.fs.TestDFVariations

                                      The following test timeouts occurred in hadoop-common-project/hadoop-common:

org.apache.hadoop.http.TestHttpServerLifecycle

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/7423//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/7423//console

This message is automatically generated., Another debug version (003).
, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12657174/HDFS-6719.003.dbg.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common:

                  org.apache.hadoop.ipc.TestIPC

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/7426//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/7426//console

This message is automatically generated., Latest run was successful. Upload 003 again to see if there is still intermittent failure.
, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12657202/HDFS-6719.003.dbg.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common:

                  org.apache.hadoop.fs.TestDFVariations
                  org.apache.hadoop.ipc.TestIPC

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/7429//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/7429//console

This message is automatically generated., dbg version 004
, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12657274/HDFS-6719.004.dbg.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 2 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common:

                  org.apache.hadoop.ipc.TestIPC

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/7432//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/7432//console

This message is automatically generated., I think I found the root cause of this "intermittent" failure: the test root dir set with system property "test.build.data" is not created by this test, as it is supposed to do. And the reason that it can succeed often is because all tests are run together, the test root dir used by this test is actually created by other test.  It fails sometimes because the test root dir can be removed by some tests (depending on the order that the tests are run). 

So the solution is to create the test root. Posted patch 004.



, BTW, this should be changed to hadoop common jira, and thanks for reviewing.
, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12657287/HDFS-6719.005.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common:

                  org.apache.hadoop.ipc.TestIPC

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/7437//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/7437//console

This message is automatically generated., Nitpick, test_root need not be static. Also if you post another patch you could consider just using the full test name for the directory instead of testdfv.

+1 with that fixed.

Separately we can check other tests for misuse of test.build.data. Quick grep gave the following:
{code}
FSTestWrapper.java
FileContextMainOperationsBaseTest.java
FileContextTestHelper.java
FileContextURIBase.java
FileSystemTestHelper.java
MiniDFSCluster.java
TestBlocksWithNotEnoughRacks.java
TestChecksumFileSystem.java
TestCopyPreserveFlag.java
TestCreateEditsLog.java
TestDFSUpgradeFromImage.java
TestDecommissioningStatus.java
TestEnhancedByteBufferAccess.java
TestFSImageWithSnapshot.java
TestFileUtil.java
TestFsShellReturnCode.java
TestHadoopArchives.java
TestHarFileSystemBasics.java
TestHardLink.java
TestHdfsTextCommand.java
TestHostsFiles.java
TestJHLA.java
TestListFiles.java
TestLocalFileSystem.java
TestNameNodeRecovery.java
TestNativeIO.java
TestPathData.java
TestPread.java
TestRenameWithSnapshots.java
TestSeekBug.java
TestSlive.java
TestSnapshot.java
TestStartup.java
TestTextCommand.java
{code}, HI [~arpitagarwal], thanks a lot for the review! 
Uploaded a new patch (006) here to change the dir name to full test name. I can't change the test_root to non-static, because it's referenced in static inner class XXDF. 
Filed HADOOP-10889 for the good suggestions you made to fix misuse of test.build.data.


, Sorry I missed that, +1 for the patch. Will commit it shortly.

Thanks Yongjun!, Committed to trunk, branch-2 and branch-2.5., Many thanks Arpit!
, FAILURE: Integrated in Hadoop-trunk-Commit #5952 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/5952/])
HADOOP-10890. TestDFVariations.testMount fails intermittently. (Contributed by Yongjun Zhang) (arp: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1612916)
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestDFVariations.java
, {color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12657410/HDFS-6719.006.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-common-project/hadoop-common:

                  org.apache.hadoop.ipc.TestIPC

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HDFS-Build/7444//testReport/
Console output: https://builds.apache.org/job/PreCommit-HDFS-Build/7444//console

This message is automatically generated., FAILURE: Integrated in Hadoop-Yarn-trunk #622 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/622/])
HADOOP-10890. TestDFVariations.testMount fails intermittently. (Contributed by Yongjun Zhang) (arp: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1612916)
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestDFVariations.java
, FAILURE: Integrated in Hadoop-Hdfs-trunk #1814 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1814/])
HADOOP-10890. TestDFVariations.testMount fails intermittently. (Contributed by Yongjun Zhang) (arp: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1612916)
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestDFVariations.java
, SUCCESS: Integrated in Hadoop-Mapreduce-trunk #1841 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1841/])
HADOOP-10890. TestDFVariations.testMount fails intermittently. (Contributed by Yongjun Zhang) (arp: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1612916)
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestDFVariations.java
]