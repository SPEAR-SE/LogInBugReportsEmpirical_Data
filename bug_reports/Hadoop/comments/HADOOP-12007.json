[What version of Hadoop are you using Yejun?, 2.7.0.
My code use CompressionCodecFactory getCodecByClassName to get the codec object. Then create with the CompressorStream with createOutputStream(out).

If I use CodecPool directly with createOutputStream(out, compressor) and returning comporessor to pool afterward, everything works correctly., If I understand HADOOP-10591 correctly, the code to return comprossor to codecpool was never called. Because the close() method in CompressionOutputStream.java is overrrided by CompressorStream.java., I have the same problem. Yarn kills my yarn container because my streaming app use GzipCodec and create a new off-heap buffer each time a new Hdfs file is created.
]