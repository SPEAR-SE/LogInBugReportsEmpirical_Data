[Thread 1640 and 1577 show the deadlock., The deadlock seems to be the same issue with HDFS-1542 and HADOOP-7082. Thus we need to backport these two jiras to branch-1. Upload the backport patch first., The backport patch passed all the unit tests and the test-patch result is:
{noformat}
-1 overall.  
    +1 @author.  The patch does not contain any @author tags.
    +1 tests included.  The patch appears to include 3 new or modified tests.
    +1 javadoc.  The javadoc tool did not generate any warning messages.
    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.
    -1 findbugs.  The patch appears to introduce 225 new Findbugs (version 2.0.1) warnings.
{noformat}, Built the jar using the patch attached and the hive query ran through without any issues., Comparing the patch with trunk:
- The line "Properties properties = getProps();" is in asXmlDocument() for the patch but it is in writeXml(Writer out) in trunk.  Is it intended?
-  In trunk, writeXml(Writer out) is declared before asXmlDocument() but the patch put them the other way.  Could you move the code to make it the same as trunk?

, Thanks for the comments Nicholas. The line "Properties properties = getProps();" is moved there to make sure properties is not null (otherwise if we directly call writeXml after creating a configuration the properties can be null). The new patch addressed the function sequence comment., +1 patch looks good., I have committed this.  Thanks, Jing!, Closed upon successful release of 1.1.2.]