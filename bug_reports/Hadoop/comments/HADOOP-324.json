[Perhaps the datanode should behave as if any assigned incomplete (IE write locked) block is expect to become full size and only allow new blocks if it has enough space considering all currently locked blocks?

As part of its heart beat it and block creation ack it could report if it is ready to take another block.

We should be able to configure an amount of working space to be left on each device with a home directory too...  Is this currently handled?, The amount of working space to be left on each device is addressed by HADOOP-296
I think that if the disk is full we should just try again. In my experience it was the taskTracker
who filled the disk to the capacity. There night be other programs that write temporary data
into disk and then remove it.
The data node should not shutdown itself anyway, it might be useful for something anyways., I'm fixing this issue by creating a new exception (DiskOutOfSpaceException) that extends IOException.  In DataNode:writeBlock, a DiskOutOFSpaceException is thrown if while opening local disk out, data.writeToBlock fails due to insufficient space and if while processing the incoming data, the amount we want to write (bytesRead) is greater than the remaining space in the data set.

This comment serves to claim this bug as mine and as an invitation for comments on this approach.   

, This patch fixes the problem by checking the message of the IOException to see if it is "No space left on device".   If so, then it throws a new DiskOutOfSpaceException and does not shutdown.  If not, then it does what it originally did, shutdown.  

If there are objections to this way, please let me know., I just committed this.  Thanks!]