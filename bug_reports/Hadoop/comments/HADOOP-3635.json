[DataBlockScanner object reads log files "dncp_block_verification.log.curr" and "dncp_block_verification.log.prev". These log files contain lines like
{noformat}
date="2008-06-18 11:44:38,984" time="1213814678984" genstamp="1001" id="-969938011182314584"
{noformat}
From the error message in the description, it seems to me that the log file was corrupted. ("121195228080date=": the number looks like a timestamp but it is somehow followed by another line.) Could you check your log files? They can be found in your datanode directory .../hadoop-SYSTEM/dfs/data/current, {noformat}
$ grep 121195228080 dncp_block_verification.log.curr
date="2008-05-28 05:24:40,808"   time="121195228080date="2008-05-28 06:01:58,818"        time="1211954518818"    id="4027181978358848026"
{noformat}

Nicholas, you're right. It is corrupted.
Out of 2000 datanodes, 54 datanodes are in this state after 3 days of uptime.
, > Out of 2000 datanodes, 54 datanodes are in this state after 3 days of uptime.

Do you mean that there is no datanode restart during this 3-day uptime?  If it is the case, we should mark this a 0.18 blocker., The log files are used for updating BlockScanInfo, so that the same block checksum won't be verified to frequently.  If some lines of a log file are corrupted, these lines should be ignored., There are race conditions in DataBlockScanner.LogFileHandler.out.  Some accesses of it are not synchronized., 3635_20080627.patch: synchronized all access of out and ignore lines in the log file with parsing errors., promote this to 0.18 blocker., Passed tests locally.  Submitting., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12384872/3635_20080627.patch
  against trunk revision 672376.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    -1 patch.  The patch command could not apply the patch.

Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2763/console

This message is automatically generated., -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12384872/3635_20080627.patch
  against trunk revision 672376.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    -1 contrib tests.  The patch failed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2768/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2768/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2768/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2768/console

This message is automatically generated., I think flush is not needed after writing each line in the log. Otherwise the patch looks good., 3635_20080630.patch: removed flush().
, -1 overall.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12384973/3635_20080630.patch
  against trunk revision 672848.

    +1 @author.  The patch does not contain any @author tags.

    -1 tests included.  The patch doesn't appear to include any new or modified tests.
                        Please justify why no tests are needed for this patch.

    +1 javadoc.  The javadoc tool did not generate any warning messages.

    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.

    +1 findbugs.  The patch does not introduce any new Findbugs warnings.

    +1 release audit.  The applied patch does not increase the total number of release audit warnings.

    +1 core tests.  The patch passed core unit tests.

    -1 contrib tests.  The patch failed contrib unit tests.

Test results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2773/testReport/
Findbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2773/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html
Checkstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2773/artifact/trunk/build/test/checkstyle-errors.html
Console output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/2773/console

This message is automatically generated., I've just committed this. Thanks, Nicholas!, Integrated in Hadoop-trunk #535 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-trunk/535/])]