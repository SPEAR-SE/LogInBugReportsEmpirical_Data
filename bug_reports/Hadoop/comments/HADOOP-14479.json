[Thanks for the report [~Ayappan]. I tried this locally too and ran into the same problem.

We're supposed to be running the ISA-L tests as part of precommit, so I'm not sure what happened here. Seems like there's a test gap for ISA-L vs. the Java coder (time to revisit HDFS-11066?)

[~Sammi] / [~drankye] could you assist with debugging this?, Sure,  [~andrew.wang],  I will look into it. , Per offline [~Sammi] will take this.

Sammi, hope you're doing great. Is this caused by different environment like Ubuntu or by the upgrade of Intel ISA-L? Did you get some chance to verify this first? It would be great if you could update on this when any progress. Thanks!, Hi [~andrew.wang],

bq. We're supposed to be running the ISA-L tests as part of precommit, so I'm not sure what happened here. Seems like there's a test gap for ISA-L vs. the Java coder (time to revisit HDFS-11066?)
I agree, it would be good to fill the test gap. Let's revisit HDFS-11066. Thanks!, Hmm, I thought the test gap was majorly caused by the precommit missing ISA-L building. Quite some time ago it was done in HADOOP-12626 but removed in HADOOP-13342. I thought we should bring it back and re-enable the ISA-L building & tests in precommit. Andrew, do you think so? If sounds good, we can fire a new issue to do it. Thanks!, SGTM, thanks Kai! The concern on HADOOP-13342 was getting a stable reference to a single version, which is something we should address when bringing this back., HADOOP-14593 is created to handle "TestCodecRawCoderMapping" and "TestRSErasureCoder" failure. "TestHHXORErasureCoder" failure is under investigation.  It's pretty likely has nothing to do with ISA-L version change. , patch to solve three failed unit tests, First of all, these three failed unit tests are not related with ISA-L version change. There are actually hidden issues.
1.TestHHXORErasureCoder
The implementation of native XOR encoder/decoder has array out of index issue which cause the JVM crash.
2.TestRSErasureCoder
One failed unit test is to test underlying encoder reuse by execution testCoding twice, while the underlying encoder is released explicitly by ErasureEncodingStep.finish. By review the context, I think ErasureEncodingStep.finish is not the right place to release the encoder.
3. TestCodecRawCoderMapping
One failed unit test is because it doesn't consider the native RS coder situation.

I have tried the patch locally.
[~Ayappan], thanks for reporting this. You can have a try with the new patch. 

Besides, I will close HADOOP-14593 later since I have merged fixes for 3 unit cases into one patch. , | (/) *{color:green}+1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 14s{color} | {color:blue} Docker mode activated. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 1 new or modified test files. {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 13m 35s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 13m 58s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 36s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  8s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 30s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 50s{color} | {color:green} trunk passed {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 47s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 32s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} cc {color} | {color:green} 10m 32s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 10m 32s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 36s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  3s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 39s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 50s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green}  8m  8s{color} | {color:green} hadoop-common in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 33s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 57m 51s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Docker |  Image:yetus/hadoop:14b5c93 |
| JIRA Issue | HADOOP-14479 |
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12874966/HADOOP-14479.001.patch |
| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  cc  |
| uname | Linux 5242dc1a7ae3 3.13.0-116-generic #163-Ubuntu SMP Fri Mar 31 14:13:22 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |
| git revision | trunk / 990aa34 |
| Default Java | 1.8.0_131 |
| findbugs | v3.1.0-RC1 |
|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/12654/testReport/ |
| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/12654/console |
| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |


This message was automatically generated.

, Thanks [~Sammi] a lot for digging into these failure cases and providing the patch! This clarified these failures have nothing to do with ISA-L version update.

The patch LGTM and +1. Will commit it shortly., Committed to trunk. Thanks [~Sammi] for the contribution!, SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #11949 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/11949/])
HADOOP-14479. Erasurecode testcase failures with native enabled. (kai.zheng: rev ea1da39b1908de7739eaecded64074355f0fd5d0)
* (edit) hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/erasurecode/coder/ErasureEncodingStep.java
* (edit) hadoop-common-project/hadoop-common/src/main/native/src/org/apache/hadoop/io/erasurecode/jni_xor_decoder.c
* (edit) hadoop-common-project/hadoop-common/src/main/native/src/org/apache/hadoop/io/erasurecode/jni_xor_encoder.c
* (edit) hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/io/erasurecode/TestCodecRawCoderMapping.java
, bq. We're supposed to be running the ISA-L tests as part of precommit, so I'm not sure what happened here. 

The problem was that Intel didn't have anything that wasn't locked behind an email wall to get to the source tree.  It was pretty much impossible for us to get anything that was reliable. 

FWIW, this isn't the only native component that isn't getting tested due to missing dependencies or just plain brokenness in the CMakefiles.  I'll likely upgrade the Dockerfile bits to handle multiple OSes and architectures at some point. When I do that, dependencies will almost certainly get revisited. (I don't think anyone else is really paying attention to this stuff.    Looking forward to the Jenkins upgrade, cuz a lot of non-Yetus stuff is just going to flat out break.), [~drankye] did we ever file that JIRA to get ISA-L re-enabled? ISA-L is required for production usage of EC, so having testing is really important., Thanks [~andrew.wang] for the reminder. Yes it's scheduled and we'll do it. If it can't be made in BETA1, we'll give some thorough runs against latest ISA-L manually.  , Thanks Kai. Do you mind filing a JIRA for this? Or, are we planning to use HDFS-11066?, Ah, HDFS-11066 looks good enough. Thanks Andrew!]