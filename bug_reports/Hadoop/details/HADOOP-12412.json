{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12864030","self":"https://issues.apache.org/jira/rest/api/2/issue/12864030","key":"HADOOP-12412","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-09-15T21:17:25.311+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 30 07:03:39 UTC 2016","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-12412/watchers","watchCount":11,"isWatching":false},"created":"2015-09-14T21:05:20.791+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327583","id":"12327583","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mharris","name":"mharris","key":"mharris","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Harris","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-03-30T07:03:40.002+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310689","id":"12310689","name":"fs","description":"Generic FileSystem code"}],"timeoriginalestimate":null,"description":"The FileSystem cache uses a mild amount of concurrency to protect the cache itself, but does nothing to prevent multiple of the same filesystem from being constructed and initialized simultaneously.  At best, this leads to potentially expensive wasted work.  At worst, as is the case for Spark, it can lead to deadlocks/livelocks, especially when the same configuration object is passed into both calls.  This should be refactored to use a results cache approach (reference Java Concurrency in Practice chapter 5 section 6 for an example of how to do this correctly), which will be both higher-performance and safer.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12756112","id":"12756112","filename":"HADOOP-12412.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mharris","name":"mharris","key":"mharris","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Harris","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-15T22:50:01.094+0000","size":8330,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12756112/HADOOP-12412.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12756078","id":"12756078","filename":"HADOOP-12412.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mharris","name":"mharris","key":"mharris","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Harris","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-15T20:50:34.665+0000","size":8330,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12756078/HADOOP-12412.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Concurrency in FileSystem$Cache is very broken","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mharris","name":"mharris","key":"mharris","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Harris","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mharris","name":"mharris","key":"mharris","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Harris","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":"https://issues.apache.org/jira/browse/SPARK-2546","duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12864030/comment/14746156","id":"14746156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mharris","name":"mharris","key":"mharris","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Harris","active":true,"timeZone":"America/Los_Angeles"},"body":"So I'm OOTO on a crappy windows laptop right now and am having a lot of trouble running tests.  I also am not really sure what the patch submission process is (first submission for me).  Can someone help me through this or alternatively just pick up for me at this point?  This patch definitely needs review and may need a couple tweaks, but it's moving the codebase in the right direction.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mharris","name":"mharris","key":"mharris","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Harris","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-15T20:50:34.669+0000","updated":"2015-09-15T20:50:34.669+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12864030/comment/14746228","id":"14746228","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviprak","name":"raviprak","key":"raviprak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=raviprak&avatarId=10113","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=raviprak&avatarId=10113","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=raviprak&avatarId=10113","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=raviprak&avatarId=10113"},"displayName":"Ravi Prakash","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Michael! Thanks a lot for your contribution. Please read through https://wiki.apache.org/hadoop/HowToContribute . Would you please be able to write unit tests to demonstrate problems in the existing code, and to prove that your patch fixes them?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=raviprak","name":"raviprak","key":"raviprak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=raviprak&avatarId=10113","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=raviprak&avatarId=10113","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=raviprak&avatarId=10113","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=raviprak&avatarId=10113"},"displayName":"Ravi Prakash","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-15T21:17:25.311+0000","updated":"2015-09-15T21:17:25.311+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12864030/comment/14746297","id":"14746297","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mharris","name":"mharris","key":"mharris","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Harris","active":true,"timeZone":"America/Los_Angeles"},"body":"Yeah I'd love to.  I'm not convinced I can write anything that's 100% foolproof though because the bug is occasional livelock in an area of the code with weak concurrency semantics.  Do you have any experience with unit testing for livelock?  If not, that's fine, I'll put something together that at least demonstrates the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mharris","name":"mharris","key":"mharris","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Harris","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-15T21:42:39.735+0000","updated":"2015-09-15T21:42:39.735+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12864030/comment/14746426","id":"14746426","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mharris","name":"mharris","key":"mharris","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Harris","active":true,"timeZone":"America/Los_Angeles"},"body":"Wrote a test for it, but as I mentioned I'm OOTO and on a windows laptop right now, so basically nothing works (can't even run tests because nothing works on windows).  I could table this for the week until I'm back to a linux machine or someone else could try applying this and seeing if it works properly.  It's a pretty serious bug IMO (though it's been around forever basically), so I feel like it should get prioritized relatively high for getting into the next release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mharris","name":"mharris","key":"mharris","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Harris","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-15T22:50:01.100+0000","updated":"2015-09-15T22:50:01.100+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12864030/comment/14983647","id":"14983647","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. At best, this leads to potentially expensive wasted work. At worst, as is the case for Spark, it can lead to deadlocks/livelocks, especially when the same configuration object is passed into both calls.\nCan you describe this more and how the current code causes this?\n\nIAC, the patch doesn't apply anymore, needs to fix code-formatting, and more testing etc.\n\nGiven this is still in progress, I'd move this out into 2.7.3 as I am considering a 2.7.2 RC this weekend. Let me know if you have comments/concerns etc. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-31T00:06:49.415+0000","updated":"2015-10-31T00:06:49.415+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12864030/comment/14986061","id":"14986061","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"[~mharris], please see my comment above.\n\nMoving it out of 2.7.2 per my comment above.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-02T21:10:26.230+0000","updated":"2015-11-02T21:10:26.230+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12864030/comment/14986464","id":"14986464","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mharris","name":"mharris","key":"mharris","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Harris","active":true,"timeZone":"America/Los_Angeles"},"body":"[~vinodkv] yep no problems here.  This has shifted off of me on my side of the world and has also reduced in priority as we've bandaided over it by using coarser grained synchronization at a higher level of our stack.  Still should get fixed here, but it's not critical for us anymore.  Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mharris","name":"mharris","key":"mharris","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Harris","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-03T01:31:44.793+0000","updated":"2015-11-03T01:31:44.793+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12864030/comment/15217533","id":"15217533","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajisakaa","name":"ajisakaa","key":"ajisakaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ajisakaa&avatarId=17238","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ajisakaa&avatarId=17238","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ajisakaa&avatarId=17238","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ajisakaa&avatarId=17238"},"displayName":"Akira Ajisaka","active":true,"timeZone":"Asia/Tokyo"},"body":"As Michael mentioned, reduced the priority and removed the target version.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajisakaa","name":"ajisakaa","key":"ajisakaa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ajisakaa&avatarId=17238","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ajisakaa&avatarId=17238","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ajisakaa&avatarId=17238","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ajisakaa&avatarId=17238"},"displayName":"Akira Ajisaka","active":true,"timeZone":"Asia/Tokyo"},"created":"2016-03-30T07:03:39.883+0000","updated":"2016-03-30T07:03:39.883+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-12412/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2k5vr:"}}