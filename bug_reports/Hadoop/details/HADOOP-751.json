{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12357078","self":"https://issues.apache.org/jira/rest/api/2/issue/12357078","key":"HADOOP-751","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2006-12-08T05:09:59.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jan 23 21:15:53 UTC 2007","customfield_12310420":"72434","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_4913042569_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_886266128","customfield_12312321":null,"resolutiondate":"2007-01-23T21:15:53.569+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-751/watchers","watchCount":1,"isWatching":false},"created":"2006-11-28T00:31:51.000+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312098","id":"12312098","description":"","name":"0.8.0","archived":false,"released":true,"releaseDate":"2006-11-03"}],"issuelinks":[{"id":"12314323","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12314323","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12357090","key":"HADOOP-752","self":"https://issues.apache.org/jira/rest/api/2/issue/12357090","fields":{"summary":"Possible locking issues in HDFS Namenode","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sameerp","name":"sameerp","key":"sameerp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34061","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34061","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34061","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34061"},"displayName":"Sameer Paranjpye","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-07-08T16:42:12.042+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Trying to figure out the exact cause, but CPU load of the namenode is constantly 100% without any file exchanges.\n\n.log file of the namenode showing the following exception about every 20 seconds.\n\n2006-11-27 16:02:07,199 INFO org.apache.hadoop.ipc.Server: IPC Server handler 5 on 8020 call error: java.io.IOException: java.util.NoSuchElementException\njava.io.IOException: java.util.NoSuchElementException\n  at java.util.TreeMap$PrivateEntryIterator.nextEntry(TreeMap.java:1029)\n  at java.util.TreeMap$KeyIterator.next(TreeMap.java:1058)\n  at java.util.AbstractCollection.toArray(AbstractCollection.java:176)\n  at org.apache.hadoop.dfs.DatanodeDescriptor.getBlocks(DatanodeDescriptor.java:96)\n  at org.apache.hadoop.dfs.FSNamesystem.processReport(FSNamesystem.java:1446)\n  at org.apache.hadoop.dfs.NameNode.blockReport(NameNode.java:506)\n  at sun.reflect.GeneratedMethodAccessor11.invoke(Unknown Source)\n  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n  at java.lang.reflect.Method.invoke(Method.java:585)\n  at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:387)\n  at org.apache.hadoop.ipc.Server$Handler.run(Server.java:518)\n\n\n\nOn some of the datanodes, .log file is showing\n\n2006-11-27 16:03:57,542 WARN org.apache.hadoop.dfs.DataNode: org.apache.hadoop.ipc.RemoteException: java.io.IOException: java.util.NoSuchElementException\n  at java.util.TreeMap$PrivateEntryIterator.nextEntry(TreeMap.java:1029)\n  at java.util.TreeMap$KeyIterator.next(TreeMap.java:1058)\n  at java.util.AbstractCollection.toArray(AbstractCollection.java:176)\n  at org.apache.hadoop.dfs.DatanodeDescriptor.getBlocks(DatanodeDescriptor.java:96)\n  at org.apache.hadoop.dfs.FSNamesystem.processReport(FSNamesystem.java:1446)\n  at org.apache.hadoop.dfs.NameNode.blockReport(NameNode.java:506)\n  at sun.reflect.GeneratedMethodAccessor11.invoke(Unknown Source)\n  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n  at java.lang.reflect.Method.invoke(Method.java:585)\n  at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:387)\n  at org.apache.hadoop.ipc.Server$Handler.run(Server.java:518)\n\n  at org.apache.hadoop.ipc.Client$Connection.run(Client.java:248)\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"106800","customfield_12312823":null,"summary":"Namenode constantly using up 100% CPU","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knoguchi","name":"knoguchi","key":"knoguchi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Koji Noguchi","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knoguchi","name":"knoguchi","key":"knoguchi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Koji Noguchi","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357078/comment/12454518","id":"12454518","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knoguchi","name":"knoguchi","key":"knoguchi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Koji Noguchi","active":true,"timeZone":"America/New_York"},"body":"This high CPU load was caused by not enough heap size for the jvm.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knoguchi","name":"knoguchi","key":"knoguchi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Koji Noguchi","active":true,"timeZone":"America/New_York"},"created":"2006-11-30T02:36:51.000+0000","updated":"2006-11-30T02:36:51.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357078/comment/12454521","id":"12454521","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knoguchi","name":"knoguchi","key":"knoguchi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Koji Noguchi","active":true,"timeZone":"America/New_York"},"body":"The error messages I initially copy&pasted are probably not directly related to this problem.\nOnce I increased the HADOOP_HEAPSIZE, this high CPU load problem went away.\n\nRaghu pointed out \n\"If increase of 500mb fixed the issue, wouldn't the main suspect be Java  GC?\"\n\n\"attaching gdb to the pid shows jvm is handling \"failed allocation\" most of the time. I don't know if it is possible to check java stack for a given pid. I tried attaching multiple times and stack looks pretty much the same each time: \"\n\n#0  0xf771bea8 in instanceKlass::oop_adjust_pointers ()\n   from libjvm.so\n#1  0xf7937999 in PSMarkSweepDecorator::adjust_pointers ()\n   from libjvm.so\n#2  0xf79383af in PSOldGen::adjust_pointers () from libjvm.so\n#3  0xf79370d6 in PSMarkSweep::mark_sweep_phase3 ()\n   from libjvm.so\n#4  0xf7936184 in PSMarkSweep::invoke_no_policy ()\n   from libjvm.so\n#5  0xf7940e7d in PSScavenge::invoke () from libjvm.so\n#6  0xf790b40f in ParallelScavengeHeap::failed_mem_allocate ()\n   from libjvm.so\n#7  0xf79dfa6f in VM_ParallelGCFailedAllocation::doit ()\n   from libjvm.so\n#8  0xf79df466 in VM_Operation::evaluate () from libjvm.so\n#9  0xf79dea77 in VMThread::evaluate_operation ()\n   from libjvm.so\n#10 0xf79dece5 in VMThread::loop () from libjvm.so\n#11 0xf79de850 in VMThread::run () fromlibjvm.so\n#12 0xf78fe338 in _start () from libjvm.so\n#13 0xf7fd4341 in start_thread () from /lib/tls/libpthread.so.0\n#14 0xf7f686fe in clone () from /lib/tls/libc.so.6 \n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knoguchi","name":"knoguchi","key":"knoguchi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Koji Noguchi","active":true,"timeZone":"America/New_York"},"created":"2006-11-30T02:58:32.000+0000","updated":"2006-11-30T02:58:32.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357078/comment/12456697","id":"12456697","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"body":"For the records, the namenode been stable after applying Raghu's directio-memory leak fix.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dhruba","name":"dhruba","key":"dhruba","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dhruba&avatarId=30636","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dhruba&avatarId=30636","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dhruba&avatarId=30636","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dhruba&avatarId=30636"},"displayName":"dhruba borthakur","active":true,"timeZone":"America/Tijuana"},"created":"2006-12-08T05:09:59.000+0000","updated":"2006-12-08T05:09:59.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357078/comment/12466831","id":"12466831","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sameerp","name":"sameerp","key":"sameerp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34061","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34061","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34061","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34061"},"displayName":"Sameer Paranjpye","active":true,"timeZone":"America/Los_Angeles"},"body":"Investigation revealed that the Namenode CPU usage was caused by lack of heap space. Reducing memory consumption in the Namenode is partially addressed by HADOOP-803. More improvements will follow.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sameerp","name":"sameerp","key":"sameerp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34061","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34061","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34061","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34061"},"displayName":"Sameer Paranjpye","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-01-23T21:15:53.560+0000","updated":"2007-01-23T21:15:53.560+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-751/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0imvj:"}}