{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13093084","self":"https://issues.apache.org/jira/rest/api/2/issue/13093084","key":"HADOOP-14745","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2017-08-08T10:35:22.333+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Aug 08 13:09:48 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_19926597_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2017-08-08T13:10:00.447+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-14745/watchers","watchCount":2,"isWatching":false},"created":"2017-08-08T07:37:53.915+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329058","id":"12329058","description":"2.8.0 release","name":"2.8.0","archived":false,"released":true,"releaseDate":"2017-03-22"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iyonger","name":"iyonger","key":"iyonger","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonger","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-08-08T13:10:00.507+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311814","id":"12311814","name":"fs/s3","description":"S3A filesystem client and other S3 connectivity issues"}],"timeoriginalestimate":null,"description":"{code}\n[**** hadoop-aws]# /root/hadoop/s3cmd/s3cmd ls s3://test-aws-s3a/user/root/\n                       DIR   s3://test-aws-s3a/user/root/ccc/\n2017-08-08 07:04         0   s3://test-aws-s3a/user/root/ccc\n{code}\nif we expect to ccc is a directory by code :\n{code}\n    Path test=new Path(\"ccc\");\n    fs.getFileStatus(test);\n{code}\nactually, it will tell us it is a file:\n{code}\n2017-08-08 15:08:40,566 [JUnit-case1] DEBUG s3a.S3AFileSystem (S3AFileSystem.java:getFileStatus(1576)) - Getting path status for s3a://test-aws-s3a/user/root/ccc  (user/root/ccc)\n2017-08-08 15:08:40,566 [JUnit-case1] DEBUG s3a.S3AFileSystem (S3AStorageStatistics.java:incrementCounter(60)) - object_metadata_requests += 1  ->  3\n2017-08-08 15:08:40,580 [JUnit-case1] DEBUG s3a.S3AFileSystem (S3AFileSystem.java:getFileStatus(1585)) - Found exact file: normal file\n{code}\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"s3a getFileStatus can't return expect result when existing a file and directory with the same name","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iyonger","name":"iyonger","key":"iyonger","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonger","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iyonger","name":"iyonger","key":"iyonger","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonger","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13093084/comment/16118009","id":"16118009","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iyonger","name":"iyonger","key":"iyonger","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonger","active":true,"timeZone":"Etc/UTC"},"body":"So i think we should call getFileStatus with explicitly expect,  e.g.\ngetFileStatus(path,true)\ntrue means we think the path we input is a directory\n\nIn internal of getFileStatus, i think the call like above will skip the first two getObjectMetadata call, and only list the object under this given path, which also benefit the performance of this network consuming function. \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iyonger","name":"iyonger","key":"iyonger","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonger","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-08T07:53:48.086+0000","updated":"2017-08-08T07:53:48.086+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13093084/comment/16118026","id":"16118026","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iyonger","name":"iyonger","key":"iyonger","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonger","active":true,"timeZone":"Etc/UTC"},"body":"On the other hand, I saw hdfs implementation not allow existing any file with the same name of directory under it's parent path.\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iyonger","name":"iyonger","key":"iyonger","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonger","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-08T08:19:29.120+0000","updated":"2017-08-08T08:19:29.120+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13093084/comment/16118156","id":"16118156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"You shouldn't have a file and path with the same name: we don't like it & our attempt to make S3 look like a filesystem depends on this.\n\nI don't believe you could have created this path structure through S3A itself. Try it to see: create a dir then create a file with the name and the / prefix removed. The getFileStatus() call inside open() should pick up the dir and reject the call.\n\nif that doesn't happen: bug in S3A. If it does happen, closing this as a WONTFIX. Sorry","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2017-08-08T10:35:22.333+0000","updated":"2017-08-08T10:35:22.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13093084/comment/16118177","id":"16118177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iyonger","name":"iyonger","key":"iyonger","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonger","active":true,"timeZone":"Etc/UTC"},"body":"I create that path structure through s3cmd, and yes , we can't do this by s3a itself. \nBut, s3 or s3-compatible storage allow them existed within the same folder, and the common workload running on Hadoop on Ceph is data analysis, which means the data in these storage should be store by other way instead of s3a, and read data from storage through s3a, which can't stop this issue happen again.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iyonger","name":"iyonger","key":"iyonger","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonger","active":true,"timeZone":"Etc/UTC"},"created":"2017-08-08T10:51:27.915+0000","updated":"2017-08-08T10:51:27.915+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13093084/comment/16118315","id":"16118315","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"Sorry, no. it is possible to create s3 data through other tooling with names s3a can't handle\n\n* data in path/\n* data in path////path2\n* +probably some characters in path elements we don't allow\n\nNot only that, s3a can and will delete what it thinks are mock directories, e.g /path/, without even checking to see if they contain data. \n\nYou're going to have to set up a process which doesn't create paths which confuse S3a. Hadoop s3a makes sure it does this itself. For other tools, you are going to have to be aware of the limitations and avoid them.\n\nSorry. Closing as a WONTFIX, for reasons discussed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2017-08-08T13:09:48.684+0000","updated":"2017-08-08T13:09:48.684+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-14745/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3iiyf:"}}