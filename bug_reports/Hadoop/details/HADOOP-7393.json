{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12510370","self":"https://issues.apache.org/jira/rest/api/2/issue/12510370","key":"HADOOP-7393","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2011-06-14T23:21:09.591+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jun 15 19:08:53 UTC 2011","customfield_12310420":"71161","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-7393/watchers","watchCount":2,"isWatching":false},"created":"2011-06-14T21:47:28.734+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315569","id":"12315569","description":"","name":"0.23.0","archived":false,"released":true,"releaseDate":"2011-11-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-06-15T19:08:53.647+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310689","id":"12310689","name":"fs","description":"Generic FileSystem code"}],"timeoriginalestimate":null,"description":"PathData#string stores the pathstring originally used to construct the Path, and returns it from various methods, apparently in an attempt to improve the user experience for the shell.\n\nHowever, the current working directory may change, and if so this string value becomes meaningless and/or incorrect in context.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"102554","customfield_12312823":null,"summary":"PathData saves original string value, inviting failure when CWD changes","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mattf","name":"mattf","key":"mattf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Foley","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mattf","name":"mattf","key":"mattf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Foley","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510370/comment/13049452","id":"13049452","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mattf","name":"mattf","key":"mattf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Foley","active":true,"timeZone":"America/Los_Angeles"},"body":"Three solutions might be valid:\n# Like Path, convert the pathstring to an absolute pathstring.  If it is desired to give the user an fs pathstring instead of URI as used by Path, then convert the relative fs pathstring into an absolute fs pathstring, and store that.\n# Store the absolute path (or Path) of the CWD at instantiation time.  When #string is referenced, compare the current WD to the stored WD, and if they differ, convert #string to an absolute stringpath wrt the stored WD.\n# Don't store #string.  Like Path, discard the pathstring after instantiation.  If needed later, return Path#uri.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mattf","name":"mattf","key":"mattf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Foley","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-14T21:48:04.238+0000","updated":"2011-06-14T21:48:04.238+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510370/comment/13049509","id":"13049509","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"body":"As currently designed/implemented, I feel the premise of this jira is invalid, however I do understand the sentiment.  The PathData object is only intended for internal use in FsShell.  The cwd does not change during the execution of any of the commands, so the relative path is not invalidated.\n\nbq. Like Path, convert the pathstring to an absolute pathstring. [...]\nbq. Don't store #string. [...]\n\nThis would unravel the benefit.  The intent of storing the string is that what you give it is +exactly+ what you get back, just like a unix shell, not a path that has been mangled.  If you were to take the old FsShell and feed it an arbitrary path, you would have a hard time reliably matching the path in the output.\n\nbq.  Store the absolute path (or Path) of the CWD at instantiation time. When #string is referenced, compare the current WD to the stored WD, and if they differ, convert #string to an absolute stringpath wrt the stored WD.\n\nI would put forth the opinion that PathData is currently doing the \"right thing\":  relative paths are invalidated when pwd changes.  At a normal shell, if you were to type {{x=foo.txt}}, {{cat $x}}, {{cd somewhere-else}}, and again {{cat $x}}, you certainly wouldn't expect the original {{foo.txt}} to be displayed.  If the desire is to use PathData outside of FsShell, I could probably be swayed from this position.\n\nMy goal has been for FsShell to act and feel just like a real shell.  That said, I do welcome a response.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=daryn","name":"daryn","key":"daryn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daryn Sharp","active":true,"timeZone":"America/Chicago"},"created":"2011-06-14T23:21:09.591+0000","updated":"2011-06-14T23:21:09.591+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510370/comment/13049966","id":"13049966","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mattf","name":"mattf","key":"mattf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Foley","active":true,"timeZone":"America/Los_Angeles"},"body":"Option 2 seems like the only viable approach, then.\n\nI'll agree that getDirectoryContents() works correctly in that regards.\ngetPathDataForChild() doesn't seem to.  Nor do I see general logic that invalidates relative paths when the cwd does change, except maybe in the relativize() method.\n\nI also have to point out that (a) all the PathData i/f methods are public, not package-private; (b) code always gets re-used for purposes not expected by the author, and (c) the fact that set/getWorkingDirectory methods exist mean that you can't reasonably expect them to never be called between two calls to PathData references.\n\nSo will you humor me to the following extent?  Save 'cwd' at instantiation time, either as a Path or an absolute pathstring.  Provide a method 'String getOrigPathString()' which checks getWorkingDirectory against cwd, and returns 'string' if same, or something derived from 'cwd' + 'string' otherwise.  Then comment out the wazoo that 'string' must never be accessed directly, but always via the getOrigPathString() method.  And do it that way internally in all PathData methods too.\n\nWould that be acceptable?  getWorkingDirectory() should only access in-memory data structures, so it shouldn't be a big cost.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mattf","name":"mattf","key":"mattf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Foley","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-06-15T19:08:53.629+0000","updated":"2011-06-15T19:08:53.629+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-7393/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0hwnz:"}}