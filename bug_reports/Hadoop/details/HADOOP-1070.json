{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12364270","self":"https://issues.apache.org/jira/rest/api/2/issue/12364270","key":"HADOOP-1070","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312347","id":"12312347","description":"","name":"0.12.1","archived":false,"released":true,"releaseDate":"2007-03-17"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2007-03-07T20:00:32.999+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Mar 13 21:05:16 UTC 2007","customfield_12310420":"80801","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_11676859_*|*_1_*:*_1_*:*_517052780_*|*_6_*:*_1_*:*_0_*|*_5_*:*_2_*:*_544145367_*|*_4_*:*_1_*:*_59112624","customfield_12312321":null,"resolutiondate":"2007-03-13T21:05:16.453+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-1070/watchers","watchCount":0,"isWatching":false},"created":"2007-03-06T18:40:13.417+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312308","id":"12312308","description":"","name":"0.11.2","archived":false,"released":true,"releaseDate":"2007-02-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-07-08T16:41:53.730+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"When upgrading from Hadoop 0.10.1 to 0.11.2, I see the number of racks and datanode double after the 2nd startup of the Namenode.  After the 3rd startup, they correct themselves:\n\nNamenode Log After 1st Startup:\n2007-03-06 18:27:27,045 INFO org.apache.hadoop.dfs.StateChange: STATE* Network topology has 1 racks and 4 datanodes\n\nNamenode Log After 2nd Startup:\n2007-03-06 18:27:43,201 INFO org.apache.hadoop.dfs.StateChange: STATE* Network topology has 2 racks and 8 datanodes\n\nNamenode Log After 3rd Startup:\n2007-03-06 18:28:09,730 INFO org.apache.hadoop.dfs.StateChange: STATE* Network topology has 1 racks and 4 datanodes\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12353209","id":"12353209","filename":"AddToTopology.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-03-13T17:02:55.063+0000","size":1704,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12353209/AddToTopology.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"102735","customfield_12312823":null,"summary":"Number of racks and datanode double temporarily when upgrading from 0.10.1 to 0.11.2","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nidaley","name":"nidaley","key":"nidaley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Daley","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nidaley","name":"nidaley","key":"nidaley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Daley","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12364270/comment/12478510","id":"12478510","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nidaley","name":"nidaley","key":"nidaley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Daley","active":true,"timeZone":"Etc/UTC"},"body":"More from the logs:\n\nNamenode Log After 1st Startup:\n-------------------------------\n2007-03-06 18:27:23,217 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/foo4193.bar.com:50010\n2007-03-06 18:27:23,219 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/foo4194.bar.com:50010\n2007-03-06 18:27:23,219 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/foo4191.bar.com:50010\n2007-03-06 18:27:23,220 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/foo4190.bar.com:50010\n2007-03-06 18:27:23,345 INFO org.apache.hadoop.dfs.StateChange: STATE* SafeModeInfo.enter: Safe mode is ON.\nSafe mode will be turned off automatically.\n2007-03-06 18:27:23,462 INFO org.mortbay.util.Credential: Checking Resource aliases\n2007-03-06 18:27:23,527 INFO org.mortbay.http.HttpServer: Version Jetty/5.1.4\n2007-03-06 18:27:24,375 INFO org.mortbay.util.Container: Started org.mortbay.jetty.servlet.WebApplicationHandler@4fc156\n2007-03-06 18:27:24,442 INFO org.mortbay.util.Container: Started WebApplicationContext[/,/]\n2007-03-06 18:27:24,442 INFO org.mortbay.util.Container: Started HttpContext[/logs,/logs]\n2007-03-06 18:27:24,442 INFO org.mortbay.util.Container: Started HttpContext[/static,/static]\n2007-03-06 18:27:24,448 INFO org.mortbay.http.SocketListener: Started SocketListener on 0.0.0.0:50070\n2007-03-06 18:27:24,448 INFO org.mortbay.util.Container: Started org.mortbay.jetty.Server@bb7759\n2007-03-06 18:27:24,468 INFO org.apache.hadoop.ipc.Server: IPC Server listener on 8020: starting\n2007-03-06 18:27:24,470 INFO org.apache.hadoop.ipc.Server: IPC Server handler 0 on 8020: starting\n2007-03-06 18:27:24,470 INFO org.apache.hadoop.ipc.Server: IPC Server handler 1 on 8020: starting\n2007-03-06 18:27:24,470 INFO org.apache.hadoop.ipc.Server: IPC Server handler 2 on 8020: starting\n2007-03-06 18:27:24,471 INFO org.apache.hadoop.ipc.Server: IPC Server handler 3 on 8020: starting\n2007-03-06 18:27:24,471 INFO org.apache.hadoop.ipc.Server: IPC Server handler 4 on 8020: starting\n2007-03-06 18:27:24,471 INFO org.apache.hadoop.ipc.Server: IPC Server handler 5 on 8020: starting\n2007-03-06 18:27:24,471 INFO org.apache.hadoop.ipc.Server: IPC Server handler 6 on 8020: starting\n2007-03-06 18:27:24,472 INFO org.apache.hadoop.ipc.Server: IPC Server handler 7 on 8020: starting\n2007-03-06 18:27:24,472 INFO org.apache.hadoop.ipc.Server: IPC Server handler 8 on 8020: starting\n2007-03-06 18:27:24,472 INFO org.apache.hadoop.ipc.Server: IPC Server handler 9 on 8020: starting\n2007-03-06 18:27:25,567 INFO org.apache.hadoop.dfs.StateChange: BLOCK* NameSystem.registerDatanode: node registration from 75.75.60.125:50010 storage DS-998622396\n2007-03-06 18:27:25,571 INFO org.apache.hadoop.net.NetworkTopology: Removing a node: /default-rack/foo4193.bar.com:50010\n2007-03-06 18:27:25,571 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /162.254.0.0/75.75.60.125:50010\n2007-03-06 18:27:25,790 INFO org.apache.hadoop.dfs.StateChange: BLOCK* NameSystem.registerDatanode: node registration from 75.75.60.70:50010 storage DS1861818967\n2007-03-06 18:27:25,793 INFO org.apache.hadoop.net.NetworkTopology: Removing a node: /default-rack/foo4191.bar.com:50010\n2007-03-06 18:27:25,794 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /162.254.0.0/75.75.60.70:50010\n2007-03-06 18:27:25,830 INFO org.apache.hadoop.dfs.StateChange: BLOCK* NameSystem.registerDatanode: node registration from 75.75.60.124:50010 storage DS-251661422\n2007-03-06 18:27:25,838 INFO org.apache.hadoop.net.NetworkTopology: Removing a node: /default-rack/foo4194.bar.com:50010\n2007-03-06 18:27:25,838 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /162.254.0.0/75.75.60.124:50010\n2007-03-06 18:27:26,744 INFO org.apache.hadoop.dfs.StateChange: BLOCK* NameSystem.registerDatanode: node registration from 75.75.60.71:50010 storage DS-559823463\n2007-03-06 18:27:26,747 INFO org.apache.hadoop.net.NetworkTopology: Removing a node: /default-rack/foo4190.bar.com:50010\n2007-03-06 18:27:26,747 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /162.254.0.0/75.75.60.71:50010\n2007-03-06 18:27:27,045 INFO org.apache.hadoop.dfs.StateChange: STATE* SafeModeInfo.leave: Safe mode is OFF.\n\t\nNamenode Log After 2nd Startup:\n-------------------------------\n2007-03-06 18:27:39,587 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/foo4194.bar.com:50010\n2007-03-06 18:27:39,589 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/foo4190.bar.com:50010\n2007-03-06 18:27:39,590 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/foo4193.bar.com:50010\n2007-03-06 18:27:39,590 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/foo4191.bar.com:50010\n2007-03-06 18:27:39,592 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/75.75.60.125:50010\n2007-03-06 18:27:39,592 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/75.75.60.70:50010\n2007-03-06 18:27:39,593 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/75.75.60.124:50010\n2007-03-06 18:27:39,594 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/75.75.60.71:50010\n2007-03-06 18:27:39,613 INFO org.apache.hadoop.dfs.StateChange: STATE* SafeModeInfo.enter: Safe mode is ON.\nSafe mode will be turned off automatically.\n2007-03-06 18:27:39,726 INFO org.mortbay.util.Credential: Checking Resource aliases\n2007-03-06 18:27:39,793 INFO org.mortbay.http.HttpServer: Version Jetty/5.1.4\n2007-03-06 18:27:40,457 INFO org.mortbay.util.Container: Started org.mortbay.jetty.servlet.WebApplicationHandler@12a55aa\n2007-03-06 18:27:40,528 INFO org.mortbay.util.Container: Started WebApplicationContext[/,/]\n2007-03-06 18:27:40,528 INFO org.mortbay.util.Container: Started HttpContext[/logs,/logs]\n2007-03-06 18:27:40,528 INFO org.mortbay.util.Container: Started HttpContext[/static,/static]\n2007-03-06 18:27:40,535 INFO org.mortbay.http.SocketListener: Started SocketListener on 0.0.0.0:50070\n2007-03-06 18:27:40,535 INFO org.mortbay.util.Container: Started org.mortbay.jetty.Server@d1fa5\n2007-03-06 18:27:40,556 INFO org.apache.hadoop.ipc.Server: IPC Server listener on 8020: starting\n2007-03-06 18:27:40,558 INFO org.apache.hadoop.ipc.Server: IPC Server handler 0 on 8020: starting\n2007-03-06 18:27:40,559 INFO org.apache.hadoop.ipc.Server: IPC Server handler 1 on 8020: starting\n2007-03-06 18:27:40,559 INFO org.apache.hadoop.ipc.Server: IPC Server handler 2 on 8020: starting\n2007-03-06 18:27:40,559 INFO org.apache.hadoop.ipc.Server: IPC Server handler 3 on 8020: starting\n2007-03-06 18:27:40,559 INFO org.apache.hadoop.ipc.Server: IPC Server handler 4 on 8020: starting\n2007-03-06 18:27:40,560 INFO org.apache.hadoop.ipc.Server: IPC Server handler 5 on 8020: starting\n2007-03-06 18:27:40,560 INFO org.apache.hadoop.ipc.Server: IPC Server handler 6 on 8020: starting\n2007-03-06 18:27:40,560 INFO org.apache.hadoop.ipc.Server: IPC Server handler 7 on 8020: starting\n2007-03-06 18:27:40,561 INFO org.apache.hadoop.ipc.Server: IPC Server handler 8 on 8020: starting\n2007-03-06 18:27:40,561 INFO org.apache.hadoop.ipc.Server: IPC Server handler 9 on 8020: starting\n2007-03-06 18:27:41,850 INFO org.apache.hadoop.dfs.StateChange: BLOCK* NameSystem.registerDatanode: node registration from 75.75.60.70:50010 storage DS1861818967\n2007-03-06 18:27:41,854 INFO org.apache.hadoop.net.NetworkTopology: Removing a node: /default-rack/75.75.60.70:50010\n2007-03-06 18:27:41,854 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /162.254.0.0/75.75.60.70:50010\n2007-03-06 18:27:41,932 INFO org.apache.hadoop.dfs.StateChange: BLOCK* NameSystem.registerDatanode: node registration from 75.75.60.124:50010 storage DS-251661422\n2007-03-06 18:27:41,950 INFO org.apache.hadoop.net.NetworkTopology: Removing a node: /default-rack/75.75.60.124:50010\n2007-03-06 18:27:41,950 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /162.254.0.0/75.75.60.124:50010\n2007-03-06 18:27:41,953 INFO org.apache.hadoop.dfs.StateChange: BLOCK* NameSystem.registerDatanode: node registration from 75.75.60.71:50010 storage DS-559823463\n2007-03-06 18:27:41,996 INFO org.apache.hadoop.net.NetworkTopology: Removing a node: /default-rack/75.75.60.71:50010\n2007-03-06 18:27:41,996 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /162.254.0.0/75.75.60.71:50010\n2007-03-06 18:27:42,012 INFO org.apache.hadoop.dfs.StateChange: BLOCK* NameSystem.registerDatanode: node registration from 75.75.60.125:50010 storage DS-998622396\n2007-03-06 18:27:42,015 INFO org.apache.hadoop.net.NetworkTopology: Removing a node: /default-rack/75.75.60.125:50010\n2007-03-06 18:27:42,015 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /162.254.0.0/75.75.60.125:50010\n2007-03-06 18:27:43,201 INFO org.apache.hadoop.dfs.StateChange: STATE* SafeModeInfo.leave: Safe mode is OFF.\n2007-03-06 18:27:43,201 INFO org.apache.hadoop.dfs.StateChange: STATE* Network topology has 2 racks and 8 datanodes\n\nNamenode Log After 3rd Startup:\n-------------------------------\n2007-03-06 18:28:06,129 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/75.75.60.124:50010\n2007-03-06 18:28:06,130 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/75.75.60.71:50010\n2007-03-06 18:28:06,131 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/75.75.60.125:50010\n2007-03-06 18:28:06,131 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/75.75.60.70:50010\n2007-03-06 18:28:06,132 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/75.75.60.70:50010\n2007-03-06 18:28:06,132 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/75.75.60.124:50010\n2007-03-06 18:28:06,133 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/75.75.60.71:50010\n2007-03-06 18:28:06,133 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/75.75.60.125:50010\n2007-03-06 18:28:06,146 INFO org.apache.hadoop.dfs.StateChange: STATE* SafeModeInfo.enter: Safe mode is ON.\nSafe mode will be turned off automatically.\n2007-03-06 18:28:06,258 INFO org.mortbay.util.Credential: Checking Resource aliases\n2007-03-06 18:28:06,325 INFO org.mortbay.http.HttpServer: Version Jetty/5.1.4\n2007-03-06 18:28:06,985 INFO org.mortbay.util.Container: Started org.mortbay.jetty.servlet.WebApplicationHandler@5dd582\n2007-03-06 18:28:07,049 INFO org.mortbay.util.Container: Started WebApplicationContext[/,/]\n2007-03-06 18:28:07,050 INFO org.mortbay.util.Container: Started HttpContext[/logs,/logs]\n2007-03-06 18:28:07,050 INFO org.mortbay.util.Container: Started HttpContext[/static,/static]\n2007-03-06 18:28:07,056 INFO org.mortbay.http.SocketListener: Started SocketListener on 0.0.0.0:50070\n2007-03-06 18:28:07,056 INFO org.mortbay.util.Container: Started org.mortbay.jetty.Server@ca0115\n2007-03-06 18:28:07,074 INFO org.apache.hadoop.ipc.Server: IPC Server listener on 8020: starting\n2007-03-06 18:28:07,076 INFO org.apache.hadoop.ipc.Server: IPC Server handler 0 on 8020: starting\n2007-03-06 18:28:07,077 INFO org.apache.hadoop.ipc.Server: IPC Server handler 2 on 8020: starting\n2007-03-06 18:28:07,077 INFO org.apache.hadoop.ipc.Server: IPC Server handler 3 on 8020: starting\n2007-03-06 18:28:07,077 INFO org.apache.hadoop.ipc.Server: IPC Server handler 1 on 8020: starting\n2007-03-06 18:28:07,077 INFO org.apache.hadoop.ipc.Server: IPC Server handler 4 on 8020: starting\n2007-03-06 18:28:07,077 INFO org.apache.hadoop.ipc.Server: IPC Server handler 5 on 8020: starting\n2007-03-06 18:28:07,078 INFO org.apache.hadoop.ipc.Server: IPC Server handler 6 on 8020: starting\n2007-03-06 18:28:07,078 INFO org.apache.hadoop.ipc.Server: IPC Server handler 7 on 8020: starting\n2007-03-06 18:28:07,078 INFO org.apache.hadoop.ipc.Server: IPC Server handler 8 on 8020: starting\n2007-03-06 18:28:07,078 INFO org.apache.hadoop.ipc.Server: IPC Server handler 9 on 8020: starting\n2007-03-06 18:28:08,459 INFO org.apache.hadoop.dfs.StateChange: BLOCK* NameSystem.registerDatanode: node registration from 75.75.60.70:50010 storage DS1861818967\n2007-03-06 18:28:08,462 INFO org.apache.hadoop.net.NetworkTopology: Removing a node: /default-rack/75.75.60.70:50010\n2007-03-06 18:28:08,463 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /162.254.0.0/75.75.60.70:50010\n2007-03-06 18:28:08,550 INFO org.apache.hadoop.dfs.StateChange: BLOCK* NameSystem.registerDatanode: node registration from 75.75.60.124:50010 storage DS-251661422\n2007-03-06 18:28:08,552 INFO org.apache.hadoop.net.NetworkTopology: Removing a node: /default-rack/75.75.60.124:50010\n2007-03-06 18:28:08,552 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /162.254.0.0/75.75.60.124:50010\n2007-03-06 18:28:08,676 INFO org.apache.hadoop.dfs.StateChange: BLOCK* NameSystem.registerDatanode: node registration from 75.75.60.71:50010 storage DS-559823463\n2007-03-06 18:28:08,678 INFO org.apache.hadoop.net.NetworkTopology: Removing a node: /default-rack/75.75.60.71:50010\n2007-03-06 18:28:08,679 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /162.254.0.0/75.75.60.71:50010\n2007-03-06 18:28:08,858 INFO org.apache.hadoop.dfs.StateChange: BLOCK* NameSystem.registerDatanode: node registration from 75.75.60.125:50010 storage DS-998622396\n2007-03-06 18:28:08,862 INFO org.apache.hadoop.net.NetworkTopology: Removing a node: /default-rack/75.75.60.125:50010\n2007-03-06 18:28:08,862 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /162.254.0.0/75.75.60.125:50010\n2007-03-06 18:28:09,730 INFO org.apache.hadoop.dfs.StateChange: STATE* SafeModeInfo.leave: Safe mode is OFF.\n2007-03-06 18:28:09,730 INFO org.apache.hadoop.dfs.StateChange: STATE* Network topology has 1 racks and 4 datanodes\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nidaley","name":"nidaley","key":"nidaley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Daley","active":true,"timeZone":"Etc/UTC"},"created":"2007-03-06T18:42:12.469+0000","updated":"2007-03-06T18:42:12.469+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12364270/comment/12478512","id":"12478512","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nidaley","name":"nidaley","key":"nidaley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Daley","active":true,"timeZone":"Etc/UTC"},"body":"My guess this is caused by some interaction between the rack aware patch, the Datanode IP address patch and hostnames being stored in the fsimage file.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nidaley","name":"nidaley","key":"nidaley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Daley","active":true,"timeZone":"Etc/UTC"},"created":"2007-03-06T18:43:19.318+0000","updated":"2007-03-06T18:43:19.318+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12364270/comment/12478873","id":"12478873","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"body":"\nThis confusion might be between 11.2 and 12.0.\n\n>2007-03-06 18:28:06,131 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/75.75.60.70:50010\n>2007-03-06 18:28:06,132 INFO org.apache.hadoop.net.NetworkTopology: Adding a new node: /default-rack/75.75.60.70:50010 \n\nI will look into why there are double entries in fsimage. will update with what should happen in this case.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-03-07T20:00:32.999+0000","updated":"2007-03-07T20:00:32.999+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12364270/comment/12478972","id":"12478972","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nidaley","name":"nidaley","key":"nidaley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Daley","active":true,"timeZone":"Etc/UTC"},"body":"Looks like this is fairly harmless so defering to 0.13.0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nidaley","name":"nidaley","key":"nidaley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Daley","active":true,"timeZone":"Etc/UTC"},"created":"2007-03-07T23:44:32.294+0000","updated":"2007-03-07T23:44:32.294+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12364270/comment/12478984","id":"12478984","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"body":">When upgrading from Hadoop 0.10.1 to 0.11.2, I see the number of racks and datanode double after the 2nd startup of the Namenode. \n> After the 3rd startup, they correct themselves:\nThis is between 0.11.2 and 0.12.x\n\n> Namenode Log After 1st Startup:\n> 2007-03-06 18:27:27,045 INFO org.apache.hadoop.dfs.StateChange: STATE* Network topology has 1 racks and 4 datanodes\n\n> Namenode Log After 2nd Startup:\n> 2007-03-06 18:27:43,201 INFO org.apache.hadoop.dfs.StateChange: STATE* Network topology has 2 racks and 8 datanodes\n\nBecause namenode was restarted before check point in the prev run, both hostName and ip are added to n/w topology. When a datanode is removed in the image or edits log, we dont delete its entry from n/w topo, I am not sure why. Now only ip entries get updated with the new topo info. This explains extra nodes. Now new image is written to disk (equivalent to a checkpoint in the first start up).\n\n>Namenode Log After 3rd Startup:\n>2007-03-06 18:28:09,730 INFO org.apache.hadoop.dfs.StateChange: STATE* Network topology has 1 racks and 4 datanodes\n\nBecause there at least one checkpoint, we dont see multiple entries.\n\nI am not entirely sure how LOG_DATANODE_REMOVE operation is handled.\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-03-08T00:04:14.869+0000","updated":"2007-03-08T00:04:14.869+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12364270/comment/12480160","id":"12480160","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"body":"This is made obsolete by HADOOP-993 which is scheduled to be implemented.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-03-12T18:17:46.107+0000","updated":"2007-03-12T18:17:46.107+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12364270/comment/12480237","id":"12480237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"body":"\n> Because namenode was restarted before check point in the prev run, both hostName and ip are added to n/w topology. \n> When a datanode is removed in the image or edits log, we dont delete its entry from n/w topo, I am not sure why. Now only ip \n> entries get updated with the new topo info. This explains extra nodes. Now new image is written to disk (equivalent to a\n> checkpoint in the first start up). \n\nLooks like this could lead to a situation where a datanode is marked dead but Namenode tries to schedule blocks to it since it exists in NetworkTopology clusterMap.\n\nOne suggested fix ( by Konstantin ) is not to add any nodes to clusterMap while loading fsimage. So the clusterMap is updated only when nodes register and when they are marked dead. Will submit a patch for this. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-03-13T01:25:26.960+0000","updated":"2007-03-13T01:25:26.960+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12364270/comment/12480479","id":"12480479","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"The main problem turns out to be that old nodes were considered alive, and \nthe name-node was trying to place block replicas on them.\nThe solution is to add the nodes to the topology map only when they register.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-03-13T17:02:55.381+0000","updated":"2007-03-13T17:02:55.381+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12364270/comment/12480504","id":"12480504","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nidaley","name":"nidaley","key":"nidaley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Daley","active":true,"timeZone":"Etc/UTC"},"body":"+1.  This passes all unit tests when applied against revision 517769.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nidaley","name":"nidaley","key":"nidaley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nigel Daley","active":true,"timeZone":"Etc/UTC"},"created":"2007-03-13T17:50:39.587+0000","updated":"2007-03-13T17:50:39.587+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12364270/comment/12480525","id":"12480525","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"body":"Hairong,\n\nThis also shows implicit assumption that existence of a node in clusterNode implies node is healthy. I think we should either make it explicit or work around it. Does node decommision work well with clusterMap? My understanding is the 'being decommissioned' is kind of an in-between state.. there is special handling of decommissioned nodes else where in the code.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-03-13T19:38:30.396+0000","updated":"2007-03-13T19:38:30.396+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12364270/comment/12480547","id":"12480547","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tomwhite","name":"tomwhite","key":"tomwhite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom White","active":true,"timeZone":"Europe/London"},"body":"I've just committed this. Thanks Konstantin!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tomwhite","name":"tomwhite","key":"tomwhite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom White","active":true,"timeZone":"Europe/London"},"created":"2007-03-13T21:05:16.446+0000","updated":"2007-03-13T21:05:16.446+0000"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-1070/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0hxs7:"}}