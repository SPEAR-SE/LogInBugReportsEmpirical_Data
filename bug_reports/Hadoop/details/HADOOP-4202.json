{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12404659","self":"https://issues.apache.org/jira/rest/api/2/issue/12404659","key":"HADOOP-4202","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/7","id":"7","description":"Later","name":"Later"},"customfield_12312322":null,"customfield_12310220":"2008-09-19T11:48:48.858+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Nov 08 01:34:01 UTC 2008","customfield_12310420":"126380","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_4183942887_*|*_1_*:*_2_*:*_152570879_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_1134212429","customfield_12312321":null,"resolutiondate":"2008-11-07T20:16:49.733+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-4202/watchers","watchCount":3,"isWatching":false},"created":"2008-09-18T15:41:35.967+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313357","id":"12313357","description":"","name":"0.18.1","archived":false,"released":true,"releaseDate":"2008-09-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2008-11-20T23:20:22.161+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311440","id":"12311440","name":"test","description":"Testing support software"}],"timeoriginalestimate":null,"description":"If many unit tests start/stop unique MiniMRCluster instances, over time the number of threads in the test vm grow to large causing tests to hang and/or slow down.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12390510","id":"12390510","filename":"hadoop-4202.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-09-19T14:11:55.835+0000","size":4382,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12390510/hadoop-4202.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"104492","customfield_12312823":null,"summary":"TaskTracker never stops cleanup threads, MiniMRCluster becomes unstable","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404659/comment/12632255","id":"12632255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"body":"I think HADOOP-3546 is responsible for the change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-09-18T15:42:22.437+0000","updated":"2008-09-18T15:42:22.437+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404659/comment/12632646","id":"12632646","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"In the latest patch for HADOOP-3628 there's a stopCleanupThreads() method that does this; it gets invoked when the TaskTracker gets terminated.\n\nAll the services lack tests to ensure that they shut down reliably in-process; the assumption in production is that the hosting JVM is killed. If we really want to have them fully cleaned up when terminated, we need tests to verify that threads are gone, and that http daemons aren't listening on the designated ports. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-09-19T11:48:48.858+0000","updated":"2008-09-19T11:48:48.858+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404659/comment/12632664","id":"12632664","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"looking at the code in HADOOP-3628 to shut down the threads in more detail, there is a fair amount of work at the end of TaskTracker to do this\n\n- a TaskCleanupThread class is defined that can be terminated by calling its terminate() method; this flips a volatile flag and interrupts the loop.\n\n- the CleanupQueue has a special EndQueue class that can be pushed into the cleanup queue; when this is hit the task ends. TestCleanupQueue verifies that is all works.\n\nI'd advocate not worrying about this for versions <0.20 as it only arises in testing when you are running lots of test cases in the same VM, perhaps under an IDE. It should not surface in production where the process gets terminated. When the 3628 lifecycle work does get merged in, this is included as part of the feature set. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-09-19T12:55:18.244+0000","updated":"2008-09-19T12:55:18.244+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404659/comment/12632690","id":"12632690","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"body":"Have updated the daemon threads to check the 'running' state, and if not running, will silently exit. to do this, a couple threads are now calling poll() instead of take(), with a timeout of 10 seconds. this value is arbitrary. \n\nI haven't added a test case to guaranteed the threads are gone as this patch is so MiniMRCluster behaves a little better. and it looks like lifecycle interfaces will be added in a future patch. please advise otherwise.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-09-19T14:11:55.880+0000","updated":"2008-09-19T14:11:55.880+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404659/comment/12632728","id":"12632728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm still seeing some MiniXXXCluster goofyness. I'll try HADOOP-3628 and see how it fares. Thanks for the comments Steve.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-09-19T15:31:53.906+0000","updated":"2008-09-19T15:31:53.906+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404659/comment/12632812","id":"12632812","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"body":"Changed to minor.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-09-19T20:47:41.935+0000","updated":"2008-09-19T20:47:41.935+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404659/comment/12645633","id":"12645633","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.douglas","name":"chris.douglas","key":"chris.douglas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Douglas","active":true,"timeZone":"America/Los_Angeles"},"body":"This seems like the wrong fix for two reasons.\n\n# Changing the worker threads to poll at an arbitrary duration solely to accommodate the unit tests is the wrong tradeoff.\n# The default junit policy (also explicitly specified in build.xml) spawns a new JVM for each TestCase, so it's unclear to me why this should even be an issue. If a TestCase is creating a new MiniMRCluster for each test, then- in almost all cases- it is using it incorrectly and the TestCase should be rewritten.\n\nHave I misunderstood the problem? Is this a regression? Is it still an issue? Hudson doesn't seem to be running any slower...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.douglas","name":"chris.douglas","key":"chris.douglas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Douglas","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-11-07T00:25:38.782+0000","updated":"2008-11-07T00:25:38.782+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404659/comment/12645707","id":"12645707","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"body":"Patch right or wrong, threads should clean up. Looks like this is being addressed elsewhere (see above). Happy to see this issue closed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-11-07T07:29:36.181+0000","updated":"2008-11-07T07:29:36.181+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404659/comment/12645874","id":"12645874","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.douglas","name":"chris.douglas","key":"chris.douglas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Douglas","active":true,"timeZone":"America/Los_Angeles"},"body":"I'll close this for now. If it continues to be a problem and can't wait for HADOOP-3628, it can be reopened.\n\nIn what environment is this causing problems? Per (2), I'm having trouble imagining how a correctly written TestCase would run into this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.douglas","name":"chris.douglas","key":"chris.douglas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Douglas","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-11-07T20:16:49.719+0000","updated":"2008-11-07T20:16:49.719+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404659/comment/12645922","id":"12645922","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"body":"The slow down is within ant, not an IDE. \n\nAnd yes to compensate, I have reorganized my tests so too many daemon threads don't get stuck in a particular jvm. \n\nAnd yes, for now, I want a pristine cluster for every relevant test method, not just for every TestCase, and I don't want an explosion of TestCase classes just to provide a test on a variation of a particular theme.\n\nsince Cascading allows for very short/concise expression of  a data processing usecase, and is easily parameterized, having lots of tests with minor variations does not render a huge unwieldy TestCase class. (though one in particular did recently cross that line, and has been recently beaten back)\n\nAnd yes, I am accepting patches that clean up my crufty tests. But I would be happy with threads that listen and die when told to.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-11-08T00:27:48.722+0000","updated":"2008-11-08T00:27:48.722+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404659/comment/12645925","id":"12645925","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.douglas","name":"chris.douglas","key":"chris.douglas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Douglas","active":true,"timeZone":"America/Los_Angeles"},"body":"Oh, I see. Would the following idiom work for your tests? It's used in a few TestCase implementations (TestReduceFetch, TestDatamerge, etc.) that require a cluster and run several variations:\n\n{code}\n  private static MiniMRCluster mrCluster = null;\n  private static MiniDFSCluster dfsCluster = null;\n  public static Test suite() {\n    TestSetup setup = new TestSetup(new TestSuite(TestReduceFetch.class)) {\n      protected void setUp() throws Exception {\n        Configuration conf = new Configuration();\n        dfsCluster = new MiniDFSCluster(conf, 2, true, null);\n        mrCluster = new MiniMRCluster(2,\n            dfsCluster.getFileSystem().getUri().toString(), 1);\n      }\n      protected void tearDown() throws Exception {\n        if (dfsCluster != null) { dfsCluster.shutdown(); }\n        if (mrCluster != null) { mrCluster.shutdown(); }\n      }\n    };\n    return setup;\n  }   \n{code}\n\nThe {{test\\*}} methods all use the same, static cluster. Unless you're testing sets of parameters required during the TT init, it should be sufficient.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.douglas","name":"chris.douglas","key":"chris.douglas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Douglas","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-11-08T00:42:05.171+0000","updated":"2008-11-08T00:42:05.171+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404659/comment/12645927","id":"12645927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks for the code snippet. \n\nI'm unsure how this changes things unless its some fu to get around ant/junit spawn semantics. Things are bearable now, time permitting I'll give this a deeper look. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cwensel","name":"cwensel","key":"cwensel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris K Wensel","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-11-08T00:55:08.822+0000","updated":"2008-11-08T00:55:08.822+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404659/comment/12645932","id":"12645932","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.douglas","name":"chris.douglas","key":"chris.douglas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Douglas","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. I'm unsure how this changes things unless its some fu to get around ant/junit spawn semantics.\n\nThis starts a MiniMRCluster and a MiniDFSCluster for the TestCase, not for each test\\* run. It's sped up several of our tests. Depending on how literally you mean \"pristine\", TestCase::setUp and TestCase::tearDown might help you clean up any state left from previous tests, too.\n\nSorry, I thought these were Hadoop tests that were taking longer. My comments about \"correctness\" were scoped to our project and its requirements, only.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris.douglas","name":"chris.douglas","key":"chris.douglas","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Douglas","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-11-08T01:34:01.052+0000","updated":"2008-11-08T01:34:01.052+0000"}],"maxResults":13,"total":13,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-4202/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0i8mn:"}}