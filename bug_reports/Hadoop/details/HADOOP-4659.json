{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12408504","self":"https://issues.apache.org/jira/rest/api/2/issue/12408504","key":"HADOOP-4659","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313494","id":"12313494","description":"","name":"0.18.3","archived":false,"released":true,"releaseDate":"2009-01-29"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-11-14T14:50:53.240+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Dec 09 23:52:44 UTC 2008","customfield_12310420":"126654","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_374944701_*|*_1_*:*_2_*:*_600386610_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_5696984253","customfield_12312321":null,"resolutiondate":"2008-11-25T21:45:01.311+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-4659/watchers","watchCount":2,"isWatching":false},"created":"2008-11-14T14:49:30.299+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10342","value":"Incompatible change","id":"10342"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313494","id":"12313494","description":"","name":"0.18.3","archived":false,"released":true,"releaseDate":"2009-01-29"}],"issuelinks":[{"id":"12322412","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322412","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"inwardIssue":{"id":"12408964","key":"HADOOP-4703","self":"https://issues.apache.org/jira/rest/api/2/issue/12408964","fields":{"summary":"DataNode.createInterDataNodeProtocolProxy should not wait for proxy forever while recovering lease","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12322448","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322448","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"inwardIssue":{"id":"12409215","key":"HADOOP-4724","self":"https://issues.apache.org/jira/rest/api/2/issue/12409215","fields":{"summary":"TaskTracker, DataNode, and SecondaryNameNode should timeout on waiting for its server to be up","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-02T02:29:18.642+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310688","id":"12310688","name":"ipc","description":""}],"timeoriginalestimate":null,"description":"ipc.Client the root cause of a connection failure is being lost as the exception is wrapped, hence the outside code, the one that looks for that root cause, isn't working as expected. The results is you can't bring up a task tracker before job tracker, and probably the same for a datanode before a  namenode. The change that triggered this is not yet located, I had thought it was HADOOP-3844 but I no longer believe this is the case.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12394093","id":"12394093","filename":"connectRetry.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-17T19:32:27.393+0000","size":708,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12394093/connectRetry.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12394257","id":"12394257","filename":"hadoop-4659.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-19T17:21:31.966+0000","size":6387,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12394257/hadoop-4659.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12393945","id":"12393945","filename":"hadoop-4659.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-14T16:14:38.047+0000","size":1285,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12393945/hadoop-4659.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12394208","id":"12394208","filename":"rpcConn.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-19T01:07:57.804+0000","size":3571,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12394208/rpcConn.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12394590","id":"12394590","filename":"rpcConn1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-24T19:43:47.909+0000","size":6306,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12394590/rpcConn1.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"104196","customfield_12312823":null,"summary":"Root cause of connection failure is being lost to code that uses it for delaying startup","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12647621","id":"12647621","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"full stack trace. \n\nTermination Record: HOST morzine.hpl.hp.com:rootProcess:testOrphanTracker:action:taskTracker, type: abnormal, description: Service has halted (this termination was not expected)\njava.io.IOException: Call to localhost/127.0.0.1:8012 failed on local exception: java.net.ConnectException: Connection refused\nat org.apache.hadoop.ipc.Client.call(Client.java:699)\nat org.apache.hadoop.ipc.RPC$Invoker.invoke(RPC.java:216)\nat org.apache.hadoop.mapred.$Proxy7.getProtocolVersion(Unknown Source)\nat org.apache.hadoop.ipc.RPC.getProxy(RPC.java:319)\nat org.apache.hadoop.ipc.RPC.getProxy(RPC.java:306)\nat org.apache.hadoop.ipc.RPC.getProxy(RPC.java:343)\nat org.apache.hadoop.ipc.RPC.waitForProxy(RPC.java:288)\nat org.apache.hadoop.mapred.TaskTracker.initialize(TaskTracker.java:453)\nat org.apache.hadoop.mapred.TaskTracker.innerStart(TaskTracker.java:831)\nat org.apache.hadoop.util.Service.start(Service.java:186)\nat org.smartfrog.services.hadoop.components.cluster.HadoopServiceImpl.innerDeploy(HadoopServiceImpl.java:480)\nat org.smartfrog.services.hadoop.components.cluster.HadoopServiceImpl.access$000(HadoopServiceImpl.java:47)\nat org.smartfrog.services.hadoop.components.cluster.HadoopServiceImpl$ServiceDeployerThread.execute(HadoopServiceImpl.java:630)\nat org.smartfrog.sfcore.utils.SmartFrogThread.run(SmartFrogThread.java:279)\nat org.smartfrog.sfcore.utils.WorkflowThread.run(WorkflowThread.java:117)\n\n//and the nested exception\n\nCaused by: java.net.ConnectException: Connection refused\nat sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)\nat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:574)\nat org.apache.hadoop.net.SocketIOWithTimeout.connect(SocketIOWithTimeout.java:206)\nat org.apache.hadoop.net.NetUtils.connect(NetUtils.java:404)\nat org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:299)\nat org.apache.hadoop.ipc.Client$Connection.access$1700(Client.java:176)\nat org.apache.hadoop.ipc.Client.getConnection(Client.java:771)\nat org.apache.hadoop.ipc.Client.call(Client.java:685)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-14T14:50:53.240+0000","updated":"2008-11-14T14:50:53.240+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12647627","id":"12647627","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"The problem could be - I repeat could be- from HADOOP-2188, though I'm not sure. There have been too many changes to roll back, and its easier to go forwards. \n\nI have a patch that (correctly) puts the task tracker back to retrying\n[sf-startdaemon-debug] 08/11/14 15:06:43 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 5 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:43 [Thread-41] INFO datanode.DataNode : BlockReport of 0 blocks got processed in 1 msecs\n[sf-startdaemon-debug] 08/11/14 15:06:44 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 6 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:45 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 7 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:46 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 8 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:47 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 9 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:47 [TaskTracker] INFO ipc.RPC : Server at localhost/127.0.0.1:8012 not available yet, Zzzzz...\n[sf-startdaemon-debug] 08/11/14 15:06:49 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 0 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:50 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 1 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:51 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 2 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:52 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 3 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:53 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 4 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:53 [Thread-41] INFO datanode.DataNode : BlockReport of 0 blocks got processed in 1 msecs\n[sf-startdaemon-debug] 08/11/14 15:06:54 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 5 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:55 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 6 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:56 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 7 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:57 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 8 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:58 [TaskTracker] INFO ipc.Client : Retrying connect to server: localhost/127.0.0.1:8012. Already tried 9 time(s).\n[sf-startdaemon-debug] 08/11/14 15:06:58 [TaskTracker] INFO ipc.RPC : Server at localhost/127.0.0.1:8012 not available yet, Zzzzz...\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-14T15:19:32.579+0000","updated":"2008-11-14T15:19:32.579+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12647647","id":"12647647","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"This patch recognises ConnectException and extends them into ConnectExceptions that include (host,port) info; all other IOExceptions are relayed unchanged. I havent included any tests but it does work for the tests we have that bring up both datanodes and task trackers without the expected namenode and datatracker. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-14T16:14:38.080+0000","updated":"2008-11-14T16:14:38.080+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12647778","id":"12647778","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"This is indeed a regression caused by HADOOP-2188. Relaying the error is not a good idea since the stack trace is confusing to the caller of RPC. Is it a better idea that RPC.waitForProxy checks the root cause of the LocalException and retries if the cause is ConnectionException?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-15T01:03:09.528+0000","updated":"2008-11-15T01:03:09.528+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12647790","id":"12647790","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"body":"Basic question: why does Client wrap one IOException in another? \n\nSteve, is this a vanilla 0.18? I am wondering how this actually happened. NetUtils.connect() is only in trunk. Also , \"org.apache.hadoop.ipc.Client.call\" does not actually catch exception from getConnection() ...\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-11-15T01:55:50.889+0000","updated":"2008-11-15T01:55:50.889+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12648138","id":"12648138","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"Raghu, \n\n> why does Client wrap one IOException in another?\n\nI dont know the original reason; HADOOP-3844 retained this feature and included the hostname/port at fault which is handy for identifying configuration problems. The patch only adds this diagnostics to ConnectExceptions and passes the rest up\n\n>is this a vanilla 0.18?\n\nI'm only work with SVN_HEAD; it's present there. If Hairong thinks it came in with HADOOP-2188, then it also exists in 0.18, but that will need a different patch. \n\n> Also , \"org.apache.hadoop.ipc.Client.call\" does not actually catch exception from getConnection() ...\n\nClient.call doesnt catch the exception. The problem is that RPC.waitForProxy does, and it handles ConnectException and SocketTimeoutException by logging, sleeping, and trying again. This was not happening when the ConnectException was being downgraded, so the task tracker was failing if it came up before the job tracker, rather than waiting quietly for the tracker to come back up. As a result there is a race condition in cluster startup and the cluster is more brittle\n\nHere's where the exceptions get picked up in RPC.java\n\n  public static VersionedProtocol waitForProxy(Class protocol,\n                                               long clientVersion,\n                                               InetSocketAddress addr,\n                                               Configuration conf\n                                               ) throws IOException {\n    while (true) {\n      try {\n        return getProxy(protocol, clientVersion, addr, conf);\n      } catch(ConnectException se) {  // namenode has not been started\n        LOG.info(\"Server at \" + addr + \" not available yet, Zzzzz...\");\n      } catch(SocketTimeoutException te) {  // namenode is busy\n        LOG.info(\"Problem connecting to server: \" + addr);\n      }\n      try {\n        Thread.sleep(1000);\n      } catch (InterruptedException ie) {\n        // IGNORE\n      }\n    }\n  }\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-17T11:19:13.464+0000","updated":"2008-11-17T11:19:13.464+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12648193","id":"12648193","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"body":"> Client.call doesnt catch the exception. ...\n\nright. call() and waitForProxy() didn't change w.r.t. this. Now I see : the main difference is that setupIOstreams() used to throw the exception it got before HADOOP-2188. I think it should still throw. The local exception was supposed to be rare (some other connection error after writing the initial RPC request). Throwing the exception in setupIOStreams() will get this behavior to match pre-HADOOP-2188.\n\nI think this should be a blocker for 0.18.3.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-11-17T17:14:50.747+0000","updated":"2008-11-17T17:14:50.747+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12648276","id":"12648276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"Yes, looks that throwing IOException from setupIOstreams is the easiest fix. Here comes the patch! I have tested it on my local machine and it worked.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-17T19:30:12.659+0000","updated":"2008-11-17T19:30:12.659+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12648386","id":"12648386","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 on the patch. \n\nsemi-related : I think adding hostip and port to \"local exception\" message as suggested by Steve in HADOOP-3844  will be nice to have in this jira.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-11-17T22:29:05.205+0000","updated":"2008-11-17T22:29:05.205+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12648431","id":"12648431","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"I do not think HADOOP-3844 is related to this jira. HADOOP-3844 does not add hostname:port to the message. HADOOP-3844 tried to add root cause of the exception to its message. With this patch, ConnectException does not ge wrapped. So this patch does not degrade HADOOP-3844.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-18T00:29:48.208+0000","updated":"2008-11-18T00:29:48.208+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12648600","id":"12648600","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"The two patches in here do slightly different things, and need to be merged. \n\n-my one left the class of an exception alone (and, for ConnectExceptions, inserted the host and port into the text, as with HADOOP-3844.\n-Hairong's stopped some exceptions getting swallowed during setupIOstreams\n\nI think both are needed, so will apply Hairong's to my code and generate a combined patch. \n\nI can test this by deploying an orphan task tracker, but in that situation, once the code is fixed, the TaskTracker will spin forever. If a timeout on the retries could be provided, we could add a test that verified the tracker ran for 20-30s before timing out and relaying the exception. In production you'd set the timeout to a number of hours or forever, obviously.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-18T14:03:28.063+0000","updated":"2008-11-18T14:03:28.063+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12648677","id":"12648677","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12394093/connectRetry.patch\n  against trunk revision 718232.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no tests are needed for this patch.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs warnings.\n\n    +1 Eclipse classpath. The patch retains Eclipse classpath integrity.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3603/testReport/\nFindbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3603/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nCheckstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3603/artifact/trunk/build/test/checkstyle-errors.html\nConsole output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3603/console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-18T18:01:03.048+0000","updated":"2008-11-18T18:01:03.048+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12648734","id":"12648734","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"On the second thought, throwing IOException from setupIOstreams is not a complete solution. While one RPC is in the middle of setupIOstreams, there might be a different call that uses the same connection and is about to setupIOstreams. If the first setup gets a ConnectException, the second call will end up seeing a closed connection and ConnectException gets delivered to call in call.error. This means that ConnectException will be wrapped.\n\nI am thinking to solve the problem using my initial solution: check root cause in waitForProxy.\n\nAs for testing, I like Steve's idea. How about adding an API wait for proxy with a timeout to RPC. The current API waitForProxy could use a timeout with the max long value.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-18T20:09:05.048+0000","updated":"2008-11-18T20:09:05.048+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12648754","id":"12648754","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"body":"> [...] second call will end up seeing a closed connection and ConnectException gets delivered to call in call.error. [...]\n\nFrom the code it does not seem to be the case (addCall() in getConnection() will be false). I might be mistaken...\n\nBut if what you say is correct, then it is a bug that new call tries to use a closed connection rather than creating a new one as it should. \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-11-18T21:08:41.131+0000","updated":"2008-11-18T21:08:41.131+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12648799","id":"12648799","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"I meant that for the second call, the call gets added to the connection before the first call marks the connection as closed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-18T23:11:08.765+0000","updated":"2008-11-18T23:11:08.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12648853","id":"12648853","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"This patch checks the cause of the failure when setting up a RPC client tries to connect to a RPC server. It retries if it is caused by an unavailable or busy server.\n\nIt adds a new static method waitForProxy with a timeout mainly for the purpose of testing. A unit test is added to TestRPC to makes sure that client retries. A manual test is also conducted that starting a DataNode without starting NameNode causes DataNode to retry.\n\nSteve, could you please review and test the patch in your setup? I appreciate any of your feedback.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-19T01:07:57.833+0000","updated":"2008-11-19T01:07:57.833+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12649038","id":"12649038","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"I'll look at this today. Last night's test run hung on TestFileCreationClient which may indicate some problems there; more research needed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-19T13:58:05.151+0000","updated":"2008-11-19T13:58:05.151+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12649087","id":"12649087","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"I'm going to put a merged patch up, but although the RPC test is passing, the spinning appears to be creating deadlock in TestFileCreationClient; relevant bits of the thread dump to follow.\n\n1. We're sleeping here holding Connection@0x2e4f3e0\n\n    [junit] \"DataStreamer for file /wrwelkj/file9 block blk_-4298389317957709021_1010\" id=133 idx=0x210 tid=25976 prio=5 alive, in native, sleeping, native_waiting, daemon\n    [junit]     at java/lang/Thread.sleep(J)V(Native Method)\n    [junit]     at org/apache/hadoop/ipc/Client$Connection.handleConnectionFailure(Client.java:373)\n    [junit]     at org/apache/hadoop/ipc/Client$Connection.setupIOstreams(Client.java:310)\n    [junit]     ^-- Holding lock: org/apache/hadoop/ipc/Client$Connection@0x2e4f3e0[thin lock]\n    [junit]     at org/apache/hadoop/ipc/Client$Connection.access$1700(Client.java:177)\n    [junit]     at org/apache/hadoop/ipc/Client.getConnection(Client.java:791)\n    [junit]     at org/apache/hadoop/ipc/Client.call(Client.java:697)\n    [junit]     at org/apache/hadoop/ipc/RPC$Invoker.invoke(RPC.java:216)\n    [junit]     at $Proxy7.getProtocolVersion(Ljava/lang/String;J)J(Unknown Source)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:340)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:327)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:364)\n    [junit]     at org/apache/hadoop/ipc/RPC.waitForProxy(RPC.java:299)\n    [junit]     at org/apache/hadoop/ipc/RPC.waitForProxy(RPC.java:286)\n\n2. Which is blocking this\n    [junit]     -- Blocked trying to get lock: org/apache/hadoop/ipc/Client$Connection@0x2e4f3e0[thin lock]\n    [junit]     at jrockit/vm/Threads.sleep(I)V(Native Method)\n    [junit]     at jrockit/vm/Locks.waitForThinRelease(Locks.java:1233)[optimized]\n    [junit]     at jrockit/vm/Locks.monitorEnterSecondStage(Locks.java:1307)[optimized]\n    [junit]     at jrockit/vm/Locks.monitorEnter(Locks.java:2389)[optimized]\n    [junit]     at org/apache/hadoop/ipc/Client$Connection.addCall(Client.java:219)\n    [junit]     at org/apache/hadoop/ipc/Client$Connection.access$1600(Client.java:177)\n    [junit]     at org/apache/hadoop/ipc/Client.getConnection(Client.java:785)\n    [junit]     at org/apache/hadoop/ipc/Client.call(Client.java:697)\n    [junit]     at org/apache/hadoop/ipc/RPC$Invoker.invoke(RPC.java:216)\n    [junit]     at $Proxy7.getProtocolVersion(Ljava/lang/String;J)J(Unknown Source)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:340)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:327)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:364)\n    [junit]     at org/apache/hadoop/ipc/RPC.waitForProxy(RPC.java:299)\n    [junit]     at org/apache/hadoop/ipc/RPC.waitForProxy(RPC.java:286)\n    [junit]     at org/apache/hadoop/hdfs/DFSClient.createClientDatanodeProtocolProxy(DFSClient.java:141)\n    [junit]     at org/apache/hadoop/hdfs/DFSClient$DFSOutputStream.processDatanodeError(DFSClient.java:2469)\n    [junit]     at org/apache/hadoop/hdfs/DFSClient$DFSOutputStream.access$1700(DFSClient.java:1997)\n    [junit]     at org/apache/hadoop/hdfs/DFSClient$DFSOutputStream$DataStreamer.run(DFSClient.java:2160)\n\nand this\n\n    [junit]     -- Blocked trying to get lock: org/apache/hadoop/ipc/Client$Connection@0x2e4f3e0[thin lock]\n    [junit]     at jrockit/vm/Threads.sleep(I)V(Native Method)\n    [junit]     at jrockit/vm/Locks.waitForThinRelease(Locks.java:1233)[optimized]\n    [junit]     at jrockit/vm/Locks.monitorEnterSecondStage(Locks.java:1307)[optimized]\n    [junit]     at jrockit/vm/Locks.monitorEnter(Locks.java:2389)[optimized]\n    [junit]     at org/apache/hadoop/ipc/Client$Connection.addCall(Client.java:219)\n    [junit]     at org/apache/hadoop/ipc/Client$Connection.access$1600(Client.java:177)\n    [junit]     at org/apache/hadoop/ipc/Client.getConnection(Client.java:785)\n    [junit]     at org/apache/hadoop/ipc/Client.call(Client.java:697)\n    [junit]     at org/apache/hadoop/ipc/RPC$Invoker.invoke(RPC.java:216)\n    [junit]     at $Proxy7.getProtocolVersion(Ljava/lang/String;J)J(Unknown Source)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:340)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:327)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:364)\n    [junit]     at org/apache/hadoop/ipc/RPC.waitForProxy(RPC.java:299)\n    [junit]     at org/apache/hadoop/ipc/RPC.waitForProxy(RPC.java:286)\n    [junit]     at org/apache/hadoop/hdfs/DFSClient.createClientDatanodeProtocolProxy(DFSClient.java:141)\n    [junit]     at org/apache/hadoop/hdfs/DFSClient$DFSOutputStream.processDatanodeError(DFSClient.java:2469)\n    [junit]     at org/apache/hadoop/hdfs/DFSClient$DFSOutputStream.access$1700(DFSClient.java:1997)\n    [junit]     at org/apache/hadoop/hdfs/DFSClient$DFSOutputStream$DataStreamer.run(DFSClient.java:2160)\n    [junit]     ^-- Holding lock: java/util/LinkedList@0x1eb5e20[fat lock]\n    [junit]     at jrockit/vm/RNI.c2java(JJJJJ)V(Native Method)\n    [junit]     -- end of trace\n    [junit] \"DataStreamer for file /wrwelkj/file5 block blk_7479178383257153500_1010\" id=127\n\nand this\nidx=0x200 tid=25971 prio=5 alive, in native, blocked, daemon\n    [junit]     -- Blocked trying to get lock: org/apache/hadoop/ipc/Client$Connection@0x2e4f3e0[thin lock]\n    [junit]     at jrockit/vm/Threads.sleep(I)V(Native Method)\n    [junit]     at jrockit/vm/Locks.waitForThinRelease(Locks.java:1233)[optimized]\n    [junit]     at jrockit/vm/Locks.monitorEnterSecondStage(Locks.java:1307)[optimized]\n    [junit]     at jrockit/vm/Locks.monitorEnter(Locks.java:2389)[optimized]\n    [junit]     at org/apache/hadoop/ipc/Client$Connection.addCall(Client.java:219)\n    [junit]     at org/apache/hadoop/ipc/Client$Connection.access$1600(Client.java:177)\n    [junit]     at org/apache/hadoop/ipc/Client.getConnection(Client.java:785)\n    [junit]     at org/apache/hadoop/ipc/Client.call(Client.java:697)\n    [junit]     at org/apache/hadoop/ipc/RPC$Invoker.invoke(RPC.java:216)\n    [junit]     at $Proxy7.getProtocolVersion(Ljava/lang/String;J)J(Unknown Source)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:340)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:327)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:364)\n    [junit]     at org/apache/hadoop/ipc/RPC.waitForProxy(RPC.java:299)\n    [junit]     at org/apache/hadoop/ipc/RPC.waitForProxy(RPC.java:286)\n    [junit]     at org/apache/hadoop/hdfs/DFSClient.createClientDatanodeProtocolProxy(DFSClient.java:141)\n    [junit]     at org/apache/hadoop/hdfs/DFSClient$DFSOutputStream.processDatanodeError(DFSClient.java:2469)\n    [junit]     at org/apache/hadoop/hdfs/DFSClient$DFSOutputStream.access$1700(DFSClient.java:1997)\n    [junit]     at org/apache/hadoop/hdfs/DFSClient$DFSOutputStream$DataStreamer.run(DFSClient.java:2160)\n    [junit]     ^-- Holding lock: java/util/LinkedList@0x1ea6858[fat lock]\n    [junit]     at jrockit/vm/RNI.c2java(JJJJJ)V(Native Method)\n\nSo: the sleep in setupIOStreams appears to be blocking the other operations. for some reason, <junit> isn't timing out or killing the process, which implies this is fairly serious. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-19T16:42:26.089+0000","updated":"2008-11-19T16:42:26.089+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12649104","id":"12649104","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"Here's a merged patch that retains the same exception types as before (so the calling code does not need to look inside nested exceptions), and which contains the test. The new TestRPC test is correctly detecting failure to connect. \n\nWhere we do have a problem is that on my machine (64-bit JRockit JVM on Ubuntu), I'm seeing TestFileCreationClient hang and it appears to be in these methods. Accordingly I'm not setting the patch available flag as it may cause trouble for Hudson. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-19T17:21:32.009+0000","updated":"2008-11-19T17:21:32.009+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12649123","id":"12649123","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"Hi Steve, I have a few comments on your new patch:\n1. I do not think it is right to throw IOException in setupIOstreams as I commented yesterday; If setIOstreams do throw, then most of the time, ConnectionException will get thrown at getConnection in call() and will not deliver to call.error; So it is of no use to wrap the exception there.\n2. We wrap local exception on purpose in HADOOP-2811. The reason we did that is to give the RPC caller a right strack trace. A RPC may fail at the time of setting up a connection, sending the request, receiving a response, or a failure caused by another RPC call. Those errors may occur in different threads. The stack trace will be confusing to the caller if we do not wrap them.\n\nI want to get waitForProxy work in 0.18.3. Can we agree on a minimum change to make it work? RPC is so fundamental in Hadoop that any minor change may cause unexpected problem. So I am thinking that the smaller the change the better. If you do not like the idea of checking the cause of failure in waitForProxy, I am OK with your idea of Client.call() wrapping ConnectException as ConnectException, SocketTimeoutException as SockettimeoutException, and other exceptions as IOException.\n\nAs for the junit test failure, I can not reproduce it on my local machine. Can you check why the RPC server is not up so the first thread stuck in waitForProxy? Could you please tell me on which line of the test that the test hang?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-19T18:52:14.434+0000","updated":"2008-11-19T18:52:14.434+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12649561","id":"12649561","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"Looks that the hanging junit test TestFileCreationClient is caused by HADOOP-4703.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-21T01:22:40.765+0000","updated":"2008-11-21T01:22:40.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12650067","id":"12650067","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"OK, I'll update my code and rerun it, though my timetable for monday/tuesday is a bit patchy. I also have to handle the jetty6 migration, which, while welcome. may complicate my life for a day or so","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-23T22:39:54.874+0000","updated":"2008-11-23T22:39:54.874+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12650295","id":"12650295","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"Hi Steve, I already have a patch which uses most of the code in your previous patch. You have a very clean programming style. :-) The change that you may not like is that all exceptions are still wrapped. Please let me know what you think. Since you are busy, I will be happy to do the testing etc.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-24T19:43:47.968+0000","updated":"2008-11-24T19:43:47.968+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12650567","id":"12650567","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"I'm going to push out my updated lifecycle patches shortly. One test I have there brings up a tasktracker without the rest of the infrastructure (DFS, jobtracker); it is now hanging until the test times out, spinning while things get set up, waiting for a job tracker that never arrives.\n\n\n    [junit] Tue Nov 25 13:50:13 2008\n    [junit] BEA JRockit(R) R27.4.0-90-89592-1.6.0_02-20070928-1715-linux-x86_64\n    [junit] \"Main Thread\" id=1 idx=0x4 tid=4074 prio=5 alive, in native, sleeping, native_waiting\n    [junit]     at java/lang/Thread.sleep(J)V(Native Method)\n    [junit]     at org/apache/hadoop/ipc/Client$Connection.handleConnectionFailure(Client.java:364)\n    [junit]     at org/apache/hadoop/ipc/Client$Connection.setupIOstreams(Client.java:310)\n    [junit]     ^-- Holding lock: org/apache/hadoop/ipc/Client$Connection@0x1184b18[thin lock]\n    [junit]     at org/apache/hadoop/ipc/Client$Connection.access$1800(Client.java:177)\n    [junit]     at org/apache/hadoop/ipc/Client.getConnection(Client.java:792)\n    [junit]     at org/apache/hadoop/ipc/Client.call(Client.java:688)\n    [junit]     at org/apache/hadoop/ipc/RPC$Invoker.invoke(RPC.java:215)\n    [junit]     at org/apache/hadoop/mapred/$Proxy0.getProtocolVersion(Ljava/lang/String;J)J(Unknown Source)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:347)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:334)\n    [junit]     at org/apache/hadoop/ipc/RPC.getProxy(RPC.java:371)\n    [junit]     at org/apache/hadoop/ipc/RPC.waitForProxy(RPC.java:308)\n    [junit]     at org/apache/hadoop/ipc/RPC.waitForProxy(RPC.java:285)\n    [junit]     at org/apache/hadoop/mapred/TaskTracker.initialize(TaskTracker.java:454)\n    [junit]     ^-- Holding lock: org/apache/hadoop/mapred/TaskTracker@0x34c4748[recursive]\n    [junit]     at org/apache/hadoop/mapred/TaskTracker.innerStart(TaskTracker.java:830)\n    [junit]     ^-- Holding lock: org/apache/hadoop/mapred/TaskTracker@0x34c4748[thin lock]\n    [junit]     at org/apache/hadoop/util/Service.start(Service.java:186)\n    [junit]     at org/apache/hadoop/util/Service.deploy(Service.java:654)\n    [junit]     at org/apache/hadoop/mapred/TaskTracker.<init>(TaskTracker.java:965)\n    [junit]     at org/apache/hadoop/mapred/TaskTracker.<init>(TaskTracker.java:948)\n\nWhat I propose here is to move TaskTracker to have a timeout on its waitForProxy() operation, so that if the TT comes up before the JT, there's a bit of leeway, but eventually the TT will conclude that it is an orphan and that it cannot start up","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-25T13:55:40.387+0000","updated":"2008-11-25T13:55:40.387+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12650603","id":"12650603","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"Adding a timeout on TaskTracker's call for waitForProxy()  lets us have a TaskTracker that eventually gives up when the JobTracker isnt there. The other places that waitForProxy()  are called with no timeouts are in the connection routines of Datanode and SecondaryNameNode(). I think all of these should be designed to take a configuration parameter that tells them when to give up, and a default value of many minutes or more to deal with basic choreography issues in a cluster. Test clusters can be set up to fail sooner rather than later. \n\nThoughts?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-25T16:00:28.757+0000","updated":"2008-11-25T16:00:28.757+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12650657","id":"12650657","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"Yes, I really like the idea of having timeout in waitForProxy when TaskTracker, DataNode, and SecondaryNameNode connect to a server. I would propose to do this in the trunk in a separate jira since it is not a regression. How do you think?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-25T18:09:11.002+0000","updated":"2008-11-25T18:09:11.002+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12650689","id":"12650689","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"Steve, thanks for testing this patch and putting a lot thoughts on this issue. I created HADOOP-4724 to handle TT, DN, and SN timeout problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-25T19:13:02.358+0000","updated":"2008-11-25T19:13:02.358+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12650692","id":"12650692","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"Ant test-core passed:\nBUILD SUCCESSFUL\nTotal time: 122 minutes 21 seconds\n\nAnt test-patch passed too:\n     [exec] +1 overall.\n\n     [exec]     +1 @author.  The patch does not contain any @author tags.\n\n     [exec]     +1 tests included.  The patch appears to include 3 new or modified tests.\n\n     [exec]     +1 javadoc.  The javadoc tool did not generate any warningmessages.\n\n     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.\n\n     [exec]     +1 Eclipse classpath. The patch retains Eclipse classpath integrity.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-25T19:15:18.648+0000","updated":"2008-11-25T19:15:18.648+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12650699","id":"12650699","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 patch looks good.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=szetszwo","name":"szetszwo","key":"szetszwo","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=szetszwo&avatarId=23156","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=szetszwo&avatarId=23156","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=szetszwo&avatarId=23156","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=szetszwo&avatarId=23156"},"displayName":"Tsz Wo Nicholas Sze","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-11-25T19:34:45.386+0000","updated":"2008-11-25T19:34:45.386+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12650752","id":"12650752","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"I just committed this. Thank you Steve!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2008-11-25T21:45:01.299+0000","updated":"2008-11-25T21:45:01.299+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12650759","id":"12650759","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"body":"A timeout of '0' conventionally means it should not timeout. Here it returns immediately.  I think we should have JavaDoc for waitForProxy() so that this is explicit. Hopefully these get fixed in HADOOP-4724.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-11-25T21:51:29.843+0000","updated":"2008-11-25T21:51:29.843+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12654933","id":"12654933","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"body":"I am adding incompatible change flag, because e.g. secondary name-node used to fail after 10 attempts. Now it is trying forever.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shv","name":"shv","key":"shv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Konstantin Shvachko","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-12-09T20:06:58.417+0000","updated":"2008-12-09T20:06:58.417+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12408504/comment/12655019","id":"12655019","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"body":"It is not incompatible w.r.t 0.17.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rangadi","name":"rangadi","key":"rangadi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Raghu Angadi","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-12-09T23:52:44.272+0000","updated":"2008-12-09T23:52:44.272+0000"}],"maxResults":33,"total":33,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-4659/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0i6sv:"}}