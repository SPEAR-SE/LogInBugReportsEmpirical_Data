{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13181280","self":"https://issues.apache.org/jira/rest/api/2/issue/13181280","key":"HADOOP-15698","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12342324","id":"12342324","description":"3.2 release","name":"3.2.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12343400","id":"12343400","name":"3.0.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12343796","id":"12343796","name":"3.1.2","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2018-08-27T17:53:11.771+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Aug 31 02:43:49 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_79904884_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_161986089","customfield_12312321":null,"resolutiondate":"2018-08-30T05:10:39.747+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-15698/watchers","watchCount":8,"isWatching":false},"created":"2018-08-27T09:59:08.837+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341432","id":"12341432","description":"3.1.0 release","name":"3.1.0","archived":false,"released":true,"releaseDate":"2018-04-06"}],"issuelinks":[{"id":"12542089","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12542089","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"inwardIssue":{"id":"13004500","key":"HADOOP-13597","self":"https://issues.apache.org/jira/rest/api/2/issue/13004500","fields":{"summary":"Switch KMS from Tomcat to Jetty","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":21141}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knanasi","name":"knanasi","key":"knanasi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=knanasi&avatarId=35301","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=knanasi&avatarId=35301","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=knanasi&avatarId=35301","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=knanasi&avatarId=35301"},"displayName":"Kitti Nanasi","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-08-31T02:43:49.917+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12324364","id":"12324364","name":"kms"}],"timeoriginalestimate":null,"description":"During KMs startup, log4j logs don't show up resulting in important logs getting omitted. This happens because log4 initialisation only happens in KMSWebApp#contextInitialized and logs written before that don't show up.\r\n\r\nFor example the following log never shows up:\r\n\r\n[https://github.com/apache/hadoop/blob/a55d6bba71c81c1c4e9d8cd11f55c78f10a548b0/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/util/ZKSignerSecretProvider.java#L197-L199]\r\n\r\nAnother example is that the KMS startup message never shows up in the kms logs.\r\n\r\nNote that this works in the unit tests, because MiniKMS sets the log4j system property.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12342324","id":"12342324","description":"3.2 release","name":"3.2.0","archived":false,"released":false}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12937249","id":"12937249","filename":"HADOOP-15698.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knanasi","name":"knanasi","key":"knanasi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=knanasi&avatarId=35301","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=knanasi&avatarId=35301","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=knanasi&avatarId=35301","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=knanasi&avatarId=35301"},"displayName":"Kitti Nanasi","active":true,"timeZone":"Etc/UTC"},"created":"2018-08-27T10:21:07.407+0000","size":6997,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12937249/HADOOP-15698.001.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"KMS log4j is not initialized properly at startup","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knanasi","name":"knanasi","key":"knanasi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=knanasi&avatarId=35301","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=knanasi&avatarId=35301","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=knanasi&avatarId=35301","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=knanasi&avatarId=35301"},"displayName":"Kitti Nanasi","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knanasi","name":"knanasi","key":"knanasi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=knanasi&avatarId=35301","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=knanasi&avatarId=35301","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=knanasi&avatarId=35301","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=knanasi&avatarId=35301"},"displayName":"Kitti Nanasi","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13181280/comment/16593456","id":"16593456","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knanasi","name":"knanasi","key":"knanasi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=knanasi&avatarId=35301","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=knanasi&avatarId=35301","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=knanasi&avatarId=35301","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=knanasi&avatarId=35301"},"displayName":"Kitti Nanasi","active":true,"timeZone":"Etc/UTC"},"body":"I tried my patch on a cluster and the logs mentioned in the description do show up in the kms.log file.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knanasi","name":"knanasi","key":"knanasi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=knanasi&avatarId=35301","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=knanasi&avatarId=35301","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=knanasi&avatarId=35301","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=knanasi&avatarId=35301"},"displayName":"Kitti Nanasi","active":true,"timeZone":"Etc/UTC"},"created":"2018-08-27T10:29:21.310+0000","updated":"2018-08-27T10:29:21.310+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13181280/comment/16594031","id":"16594031","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajayydv","name":"ajayydv","key":"ajayydv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ajay Kumar","active":true,"timeZone":"America/Los_Angeles"},"body":"[~knanasi] thanks for submitting the patch. Any plans to add a unit test ? Seems adding unit test is not straight forward but we can test logging in KMSWebServer.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajayydv","name":"ajayydv","key":"ajayydv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ajay Kumar","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-08-27T17:53:11.771+0000","updated":"2018-08-27T17:53:11.771+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13181280/comment/16594751","id":"16594751","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knanasi","name":"knanasi","key":"knanasi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=knanasi&avatarId=35301","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=knanasi&avatarId=35301","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=knanasi&avatarId=35301","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=knanasi&avatarId=35301"},"displayName":"Kitti Nanasi","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~ajayydv] for reviewing!\r\n\r\nTo start KMSWebServer with logging, it needs the configuration to be set up in advance, so it needs similar config setup as it is done in the MiniKMS#start. it is possible to do that, but maybe it does not really make sense to create a MiniKMS like test just for testing the logging. I think a better solution would be to modify MiniKMS, so it uses the same log4j configuration and initialisation as the production code, but I think that would be a way bigger refactor, because it would also require to start KMSWebServer differently to include the startup logging as well. What do you think?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knanasi","name":"knanasi","key":"knanasi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=knanasi&avatarId=35301","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=knanasi&avatarId=35301","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=knanasi&avatarId=35301","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=knanasi&avatarId=35301"},"displayName":"Kitti Nanasi","active":true,"timeZone":"Etc/UTC"},"created":"2018-08-28T09:27:56.386+0000","updated":"2018-08-28T09:27:56.386+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13181280/comment/16594790","id":"16594790","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genericqa","name":"genericqa","key":"genericqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=genericqa&avatarId=33630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=genericqa&avatarId=33630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=genericqa&avatarId=33630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=genericqa&avatarId=33630"},"displayName":"genericqa","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\r\n\\\\\r\n\\\\\r\n|| Vote || Subsystem || Runtime || Comment ||\r\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 30s{color} | {color:blue} Docker mode activated. {color} |\r\n|| || || || {color:brown} Prechecks {color} ||\r\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\r\n| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |\r\n|| || || || {color:brown} trunk Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 22m 51s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 14m 49s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 27s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 36s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 11m 38s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m 39s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 27s{color} | {color:green} trunk passed {color} |\r\n|| || || || {color:brown} Patch Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 23s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 15m 22s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 15m 22s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 25s{color} | {color:green} hadoop-common-project/hadoop-kms: The patch generated 0 new + 4 unchanged - 1 fixed = 4 total (was 5) {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 35s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 10m 29s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m 46s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 29s{color} | {color:green} the patch passed {color} |\r\n|| || || || {color:brown} Other Tests {color} ||\r\n| {color:green}+1{color} | {color:green} unit {color} | {color:green}  4m  8s{color} | {color:green} hadoop-kms in the patch passed. {color} |\r\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 35s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\r\n| {color:black}{color} | {color:black} {color} | {color:black} 85m 56s{color} | {color:black} {color} |\r\n\\\\\r\n\\\\\r\n|| Subsystem || Report/Notes ||\r\n| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:ba1ab08 |\r\n| JIRA Issue | HADOOP-15698 |\r\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12937249/HADOOP-15698.001.patch |\r\n| Optional Tests |  dupname  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  findbugs  checkstyle  |\r\n| uname | Linux c10b99cc5e46 4.4.0-133-generic #159-Ubuntu SMP Fri Aug 10 07:31:43 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux |\r\n| Build tool | maven |\r\n| Personality | /testptch/patchprocess/precommit/personality/provided.sh |\r\n| git revision | trunk / 75691ad |\r\n| maven | version: Apache Maven 3.3.9 |\r\n| Default Java | 1.8.0_181 |\r\n| findbugs | v3.1.0-RC1 |\r\n|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/15100/testReport/ |\r\n| Max. process+thread count | 457 (vs. ulimit of 10000) |\r\n| modules | C: hadoop-common-project/hadoop-kms U: hadoop-common-project/hadoop-kms |\r\n| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/15100/console |\r\n| Powered by | Apache Yetus 0.9.0-SNAPSHOT   http://yetus.apache.org |\r\n\r\n\r\nThis message was automatically generated.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genericqa","name":"genericqa","key":"genericqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=genericqa&avatarId=33630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=genericqa&avatarId=33630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=genericqa&avatarId=33630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=genericqa&avatarId=33630"},"displayName":"genericqa","active":true,"timeZone":"Etc/UTC"},"created":"2018-08-28T10:14:08.127+0000","updated":"2018-08-28T10:14:08.127+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13181280/comment/16595579","id":"16595579","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaochen","name":"xiaochen","key":"xiaochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xiaochen&avatarId=24893","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xiaochen&avatarId=24893","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xiaochen&avatarId=24893","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xiaochen&avatarId=24893"},"displayName":"Xiao Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Kitti for working on this, good find! Also thanks Ajay for the comment.\r\n\r\n+1 on patch 1. Thanks Ajay for bringing up the testing idea, and I agree we want tests with a fix in general. Giving the static initialization of things, IMO this fix can go with just the manual testing. I tried locally and can see the logs after a kms startup. Also good to know that Kitti tested this in a cluster where the issue was occurring before and fixed after.\r\n\r\n \r\n\r\nIf no more concerns I plan to commit this by end of Wednesday.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaochen","name":"xiaochen","key":"xiaochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xiaochen&avatarId=24893","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xiaochen&avatarId=24893","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xiaochen&avatarId=24893","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xiaochen&avatarId=24893"},"displayName":"Xiao Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-08-28T20:48:25.185+0000","updated":"2018-08-28T20:48:25.185+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13181280/comment/16595662","id":"16595662","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 from me as well.  We don't generally worry about testing logging, because it's seldom straight-forward.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-08-28T22:14:11.935+0000","updated":"2018-08-28T22:14:11.935+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13181280/comment/16595774","id":"16595774","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajayydv","name":"ajayydv","key":"ajayydv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ajay Kumar","active":true,"timeZone":"America/Los_Angeles"},"body":"[~xiaochen] agree, +1\r\n[~templedf] \" We don't generally worry about testing logging\" yes but this patch itself is about logging, hence the question.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajayydv","name":"ajayydv","key":"ajayydv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ajay Kumar","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-08-29T00:13:43.046+0000","updated":"2018-08-29T00:13:43.046+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13181280/comment/16597067","id":"16597067","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaochen","name":"xiaochen","key":"xiaochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xiaochen&avatarId=24893","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xiaochen&avatarId=24893","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xiaochen&avatarId=24893","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xiaochen&avatarId=24893"},"displayName":"Xiao Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"Committed to trunk as well as branch-3.[0-1] (since I believe this is a regression from HADOOP-13597).\r\nThanks Kitti for the nice fix, and Ajay / Daniel for the review comments!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaochen","name":"xiaochen","key":"xiaochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xiaochen&avatarId=24893","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xiaochen&avatarId=24893","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xiaochen&avatarId=24893","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xiaochen&avatarId=24893"},"displayName":"Xiao Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-08-30T05:10:39.789+0000","updated":"2018-08-30T05:11:12.619+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13181280/comment/16598145","id":"16598145","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #14855 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/14855/])\nHADOOP-15698. KMS log4j is not initialized properly at startup. (xiao: rev 781437c219dc3422797a32dc7ba72cd4f5ee38e2)\n* (edit) hadoop-common-project/hadoop-kms/src/main/java/org/apache/hadoop/crypto/key/kms/server/KMSWebApp.java\n* (edit) hadoop-common-project/hadoop-kms/src/main/java/org/apache/hadoop/crypto/key/kms/server/KMSConfiguration.java\n* (edit) hadoop-common-project/hadoop-kms/src/main/java/org/apache/hadoop/crypto/key/kms/server/KMSWebServer.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2018-08-31T02:43:49.917+0000","updated":"2018-08-31T02:43:49.917+0000"}],"maxResults":9,"total":9,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-15698/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3xg1j:"}}