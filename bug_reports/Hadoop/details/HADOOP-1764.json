{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12376648","self":"https://issues.apache.org/jira/rest/api/2/issue/12376648","key":"HADOOP-1764","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2007-08-25T07:48:38.766+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Aug 30 12:35:54 UTC 2007","customfield_12310420":"125391","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_651547612_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_551052256","customfield_12312321":null,"resolutiondate":"2007-08-30T12:35:54.561+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-1764/watchers","watchCount":0,"isWatching":false},"created":"2007-08-22T23:36:46.949+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-07-08T16:51:38.367+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Refer to HADOOP-1763\n\nThis occurs in that scenario once many job trackers are lost, reducers do not know where the map outputs are present. They keep retrying the wrong node causing the reducers to run forever without failures.\n\nRelevant logs:\nReducer output:\n2007-08-21 09:47:47,046 INFO org.apache.hadoop.mapred.ReduceTask: task_200708210155_0003_r_000006_2 Copying task_200708210155_0003_m_002598_0 output from node50\n2007-08-21 09:47:53,643 WARN org.apache.hadoop.mapred.ReduceTask: task_200708210155_0003_r_000006_2 copy failed: task_200708210155_0003_m_002598_0 from node50\n2007-08-21 09:47:53,643 WARN org.apache.hadoop.mapred.ReduceTask: java.io.FileNotFoundException: http://wm511750.inktomisearch.com:50060/mapOutput?map=task_200708210155_0003_m_002598_0&reduce=6\n\tat sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1243)\n\tat org.apache.hadoop.mapred.MapOutputLocation.getFile(MapOutputLocation.java:207)\n\tat org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.copyOutput(ReduceTask.java:673)\n\tat org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.run(ReduceTask.java:631)\n2007-08-21 09:53:02,327 INFO org.apache.hadoop.mapred.ReduceTask: task_200708210155_0003_r_000006_2 Copying task_200708210155_0003_m_002598_0 output from node50\n2007-08-21 09:53:02,333 WARN org.apache.hadoop.mapred.ReduceTask: task_200708210155_0003_r_000006_2 copy failed: task_200708210155_0003_m_002598_0 from node50\n2007-08-21 09:53:02,333 WARN org.apache.hadoop.mapred.ReduceTask: java.io.FileNotFoundException: http://node50:50060/mapOutput?map=task_200708210155_0003_m_002598_0&reduce=6\n\tat sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1243)\n\tat org.apache.hadoop.mapred.MapOutputLocation.getFile(MapOutputLocation.java:207)\n\tat org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.copyOutput(ReduceTask.java:673)\n\tat org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.run(ReduceTask.java:631)\n2007-08-21 09:57:33,899 INFO org.apache.hadoop.mapred.ReduceTask: task_200708210155_0003_r_000006_2 Copying task_200708210155_0003_m_002598_0 output from node50.inktomisearch.com.\n2007-08-21 09:57:33,908 WARN org.apache.hadoop.mapred.ReduceTask: task_200708210155_0003_r_000006_2 copy failed: task_200708210155_0003_m_002598_0 from node50.inktomisearch.com\n2007-08-21 09:57:33,908 WARN org.apache.hadoop.mapred.ReduceTask: java.io.FileNotFoundException: http://node50:50060/mapOutput?map=task_200708210155_0003_m_002598_0&reduce=6\n\tat sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1243)\n\tat org.apache.hadoop.mapred.MapOutputLocation.getFile(MapOutputLocation.java:207)\n\tat org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.copyOutput(ReduceTask.java:673)\n\tat org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.run(ReduceTask.java:631)\n2007-08-21 10:00:56,337 INFO org.apache.hadoop.mapred.ReduceTask: task_200708210155_0003_r_000006_2 Copying task_200708210155_0003_m_002598_1 output from node75.inktomisearch.com.\n2007-08-21 10:00:56,342 INFO org.apache.hadoop.mapred.ReduceTask: task_200708210155_0003_r_000006_2 done copying task_200708210155_0003_m_002598_1 output from node75\n2007-08-21 10:02:17,486 INFO org.apache.hadoop.mapred.ReduceTask: task_200708210155_0003_r_000006_2 Ignoring obsolete copy result for Map Task: task_200708210155_0003_m_002598_0 from host: node50\n\nLooking at TIP task_200708210155_0003_m_002598:\n\ntask_200708210155_0003_m_002598_0\tnode50\tKILLED\t0.00%\t\t21-Aug-2007 09:38:49 \tLost task tracker\ntask_200708210155_0003_m_002598_1\tnode75\tKILLED\t0.00%\t\t21-Aug-2007 11:22:42 \tLost task tracker\ntask_200708210155_0003_m_002598_2\tnode55\tSUCCEEDED\t100.00%\t21-Aug-2007 11:22:46\t21-Aug-2007 11:27:19 (4mins, 33sec) \t\ntask_200708210155_0003_m_002598_3\tnode49\tKILLED\t100.00%\t21-Aug-2007 11:22:48\t21-Aug-2007 11:27:48 (4mins, 59sec) \tAlready completed TIP\n\n\nNotes:\n1. Even finally the reducer seems to fetch data from the incorrect TaskTracker, it is not checking with the job tracker for the final/correct map output\n2. It seems to retry more times and sleeps for longer time (looking at the interval of log messages)\n3. An obvious solution may be to go to the job tracker and directly get the correct map output (I was able to get the correct map output from node55 using http, without any errors)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"106041","customfield_12312823":null,"summary":"Inconsistancy between Mapper/Reducer book keeping","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikantk","name":"srikantk","key":"srikantk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Srikanth Kakani","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srikantk","name":"srikantk","key":"srikantk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Srikanth Kakani","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Related: HADOOP-1763 (Same environment)\nVersion: 0.15.0-dev, r565628\nCompiled: Tue Aug 14 20:55:37 UTC 2007 by hadoopqa\n1400 Nodes","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12376648/comment/12522731","id":"12522731","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"body":"Srikanth, thanks for the detailed logs, appreciate it.\n\nLooking at them, here is my version of events: \n\na) task_200708210155_0003_m_002598_0 succeeds on node50 some time before 09:38:49 (actually before 09:28:49 since it takes 10mins to detect a lost tasktracker).\nb) task_200708210155_0003_r_000006_2 is told that task_200708210155_0003_m_002598_0 is complete and it schedules map-output fetch.\nc) At 09:38:49 the JobTracker detects that the TaskTracker on node50 is *lost*.\nd) task_200708210155_0003_r_000006_2 tried (unsuccessfully) to fetch map-outputs from node50 (with backoffs i.e. at 09:47 and 09:57). *\ne) task_200708210155_0003_m_002598_1 succeeded on node75 somewhere before 10:00:56.\nf) task_200708210155_0003_r_000006_2 is told by JobTracker that task_200708210155_0003_m_002598_1 is complete, schedules the copy and successfully copies at 10:00:56.\ng) At 10:02:17 task_200708210155_0003_r_000006_2 discarded the scheduled fetch from task_200708210155_0003_m_002598_0 since it had already copied the output from task_200708210155_0003_m_002598_1.\nh) At 11:22:46 the JobTracker detects that the TaskTracker on node75 is *lost*, fails the completed map task task_200708210155_0003_m_002598_1, and re-executes the tip (task_200708210155_0003_m_002598_2) on node55.\ni) The reduce task task_200708210155_0003_r_000006_2 doesn't copy output of task_200708210155_0003_m_002598_2, this could be due to:\n   * task_200708210155_0003_r_000006_2 has already completed (success or failure).\n   * Even if task_200708210155_0003_r_000006_2 is still running, it sees that task_200708210155_0003_m_002598_2 has completed but ignores that event since it already has the output of task_200708210155_0003_m_002598_1 which ran successfully. Clearly this is safe since the output of task_200708210155_0003_m_002598_1 & task_200708210155_0003_m_002598_2 are identical.\n\n\nRebuttals:\n\nbq. 1. Even finally the reducer seems to fetch data from the incorrect TaskTracker, it is not checking with the job tracker for the final/correct map output\nbq. 3. An obvious solution may be to go to the job tracker and directly get the correct map output (I was able to get the correct map output from node55 using http, without any errors)\n\nThis, as noted above, is due to the fact that the task_200708210155_0003_r_000006_2 doesn't reschedule a copy of output of task_200708210155_0003_m_002598_2 since it already successfully copied it from task_200708210155_0003_m_002598_1 (before that failed due to lost TaskTracker on node75).\n\n\nbq. 2. It seems to retry more times and sleeps for longer time (looking at the interval of log messages)\n\nThe reduce task, on a failed output-fetch doesn't immediately schedule another fetch but backs-off for a period greater than 5mins.\n\nThe one minor issue here is that reduces do not process 'task failed' events, i.e. ignore them and continue to schedule copies from the failed map tasks, with backoffs (which is why you see the exceptions while trying to fetch from the failed task_200708210155_0003_m_002598_0). Devaraj can chime in on this, my take is that this is 'ok' since we back-off for a reasonably long period (5mins) and meanwhile we'd schedule the fetch from the other successful task-attempt and then proceed to ignore the failed one.\n\nOverall, my take after looking at the logs is that there isn't anything that hits me as a *correctness issue* and follows what we've designed for and expect in such scenarios.\n\nGiven that I'm inclined to close this bug... thoughts?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-08-25T07:48:38.766+0000","updated":"2007-08-25T07:48:38.766+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12376648/comment/12522843","id":"12522843","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"bq.  Given that I'm inclined to close this bug... thoughts?\n\n+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2007-08-26T15:55:24.434+0000","updated":"2007-08-26T15:55:24.434+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12376648/comment/12523843","id":"12523843","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"body":"Srikanth - I'm closing this one, please feel free to open another issue if you see fit. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-08-30T12:35:54.513+0000","updated":"2007-08-30T12:35:54.513+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-1764/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0ii6v:"}}