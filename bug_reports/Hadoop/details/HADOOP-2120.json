{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12381403","self":"https://issues.apache.org/jira/rest/api/2/issue/12381403","key":"HADOOP-2120","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2007-10-31T20:04:10.368+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Dec 13 18:09:12 UTC 2011","customfield_12310420":"14519","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_122767414406_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-09-19T20:04:30.099+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-2120/watchers","watchCount":4,"isWatching":false},"created":"2007-10-29T22:00:55.771+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["newbie"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312830","id":"12312830","description":"","name":"0.14.3","archived":false,"released":true,"releaseDate":"2007-10-19"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-12-13T18:09:12.192+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311160","id":"12311160","name":"documentation"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12310689","id":"12310689","name":"fs","description":"Generic FileSystem code"}],"timeoriginalestimate":null,"description":"dfs -getMerge, which calls FileUtil.CopyMerge, contains this javadoc:\n\n{code}\nGet all the files in the directories that match the source file pattern\n   * and merge and sort them to only one file on local fs \n   * srcf is kept.\n{code}\n\nHowever, it only concatenates the set of input files, rather than merging them in sorted order.\n\nIdeally, the copyMerge should be equivalent to a map-reduce job with IdentityMapper and IdentityReducer with numReducers = 1. However, not having to run this as a map-reduce job has some advantages, since it increases cluster utilization during reduce phase.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"105839","customfield_12312823":null,"summary":"dfs -getMerge does not do what it says it does","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=milindb","name":"milindb","key":"milindb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Milind Bhandarkar","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=milindb","name":"milindb","key":"milindb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Milind Bhandarkar","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"All","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381403/comment/12539170","id":"12539170","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lohit","name":"lohit","key":"lohit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lohit Vijayarenu","active":true,"timeZone":"America/Los_Angeles"},"body":"Visualizing this as a map-reduce job which actually merge/sort into a single file, shouldn't it be available as  a separate package (like distcp, may be)?\n This feature of merging files would be very useful for users who would like to have only one output file. For now they would want to stick to a single reducer and do not want to submit a job with multiple reducers (even thought that is better machine utilization). A generic merge utility with understands the format and merges would be useful? Something motivated from https://issues.apache.org/jira/browse/HADOOP-2113","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lohit","name":"lohit","key":"lohit","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lohit Vijayarenu","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-10-31T20:04:10.368+0000","updated":"2007-10-31T20:04:10.368+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381403/comment/13108097","id":"13108097","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Milind,\n\n It looks to me that, Doc is updated in current code base.\n\n{code}\n /** Copy all files in a directory to one output file (merge). */\n  public static boolean copyMerge(FileSystem srcFS, Path srcDir, \n                                  FileSystem dstFS, Path dstFile, \n                                  boolean deleteSource,\n                                  Configuration conf, String addString) throws IOException {\n    dstFile = checkDest(srcDir.getName(), dstFS, dstFile, false);\n\n{code}\n\n\nI am closing it as Not A Problem. If you have any concern with it, please reopen.\n\nThanks\nUma","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=umamaheswararao","name":"umamaheswararao","key":"umamaheswararao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uma Maheswara Rao G","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-19T20:03:53.751+0000","updated":"2011-09-19T20:03:53.751+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381403/comment/13108408","id":"13108408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"body":"I believe the sorting earlier referred to the file list sorting?\n\nIn that case, although FSNamesystem gives consistent sorting for HDFS's listStatus and such, note that Java's File APIs do not provide the same consistency while using getmerge over any LocalFileSystem. I've opened HADOOP-7659 for this, btw.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=qwertymaniac","name":"qwertymaniac","key":"qwertymaniac","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=qwertymaniac&avatarId=16780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=qwertymaniac&avatarId=16780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=qwertymaniac&avatarId=16780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=qwertymaniac&avatarId=16780"},"displayName":"Harsh J","active":true,"timeZone":"Asia/Kolkata"},"created":"2011-09-20T07:07:32.363+0000","updated":"2011-09-20T07:07:32.363+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381403/comment/13108901","id":"13108901","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=milindb","name":"milindb","key":"milindb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Milind Bhandarkar","active":true,"timeZone":"America/Los_Angeles"},"body":"This is not a merge in commonly used sense (well, squinting a little bit, it is a merge if the comparator always returns -1 :-)\n\n{code}\nhadoop fs -get dir/* - > out\n{code}\n\nhas the same behavior, no ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=milindb","name":"milindb","key":"milindb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Milind Bhandarkar","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-09-20T18:23:55.361+0000","updated":"2011-09-20T18:23:55.361+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381403/comment/13109001","id":"13109001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ranadip","name":"ranadip","key":"ranadip","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranadip","active":true,"timeZone":"Etc/UTC"},"body":"> hadoop fs -get dir/* - > out\n\n> has the same behavior, no ?\n\nNot exactly same I think. In this case, out is a file on the local filesystem while -getmerge is supposed to create the merged file on the hdfs.\nOf course we can still achieve that doing something like\n\nhadoop fs -get dir/* - | hadoop fs -put - dir/dest","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ranadip","name":"ranadip","key":"ranadip","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ranadip","active":true,"timeZone":"Etc/UTC"},"created":"2011-09-20T21:13:33.904+0000","updated":"2011-09-20T21:13:33.904+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381403/comment/13168554","id":"13168554","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aripollak","name":"aripollak","key":"aripollak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ari Pollak","active":true,"timeZone":"Etc/UTC"},"body":"Even if the copyMerge comment is somewhat correct, the documentation for fs -getMerge is still confusing, so I think that this bug should be reopened; from copyCommands.java:\n    public static final String DESCRIPTION =\n      \"Get all the files in the directories that\\n\" +\n      \"match the source file pattern and merge and sort them to only\\n\" +\n      \"one file on local fs. <src> is kept.\";\n\nThe command neither sorts nor merges the actual source files according to the traditional definition (e.g. sort and sort -m commands), it merely concatenates them, in order of the filenames. It should look more like this:\n\nConcatenate all the files in the directories that match the pattern in <src> and output to only one file on local fs. <src> is kept.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aripollak","name":"aripollak","key":"aripollak","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ari Pollak","active":true,"timeZone":"Etc/UTC"},"created":"2011-12-13T18:09:12.095+0000","updated":"2011-12-13T18:09:12.095+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-2120/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0igxz:"}}