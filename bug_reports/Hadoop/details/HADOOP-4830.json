{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12410437","self":"https://issues.apache.org/jira/rest/api/2/issue/12410437","key":"HADOOP-4830","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313438","id":"12313438","description":"","name":"0.20.0","archived":false,"released":true,"releaseDate":"2009-04-22"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-12-24T11:25:32.950+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jan 07 05:59:32 UTC 2009","customfield_12310420":"126758","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_1356906916_*|*_1_*:*_1_*:*_977810827_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-01-07T05:59:32.743+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-4830/watchers","watchCount":3,"isWatching":false},"created":"2008-12-11T05:27:35.644+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12322834","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322834","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"outwardIssue":{"id":"12410439","key":"MAPREDUCE-524","self":"https://issues.apache.org/jira/rest/api/2/issue/12410439","fields":{"summary":"Have end to end tests based on MiniMRCluster to verify the correct behaviour of job initialization.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12322654","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322654","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"inwardIssue":{"id":"12410065","key":"MAPREDUCE-293","self":"https://issues.apache.org/jira/rest/api/2/issue/12410065","fields":{"summary":"Need value for Running, Completed and Failed maps and reduces for a job.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}},{"id":"12322653","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322653","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12410443","key":"MAPREDUCE-518","self":"https://issues.apache.org/jira/rest/api/2/issue/12410443","fields":{"summary":"Have end to end tests based on MiniMRCluster to verify correct behaviour of slot reclamation by queues.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12322650","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322650","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12410439","key":"MAPREDUCE-524","self":"https://issues.apache.org/jira/rest/api/2/issue/12410439","fields":{"summary":"Have end to end tests based on MiniMRCluster to verify the correct behaviour of job initialization.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12322651","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322651","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12410440","key":"MAPREDUCE-525","self":"https://issues.apache.org/jira/rest/api/2/issue/12410440","fields":{"summary":"Have end to end tests based on MiniMRCluster to verify the correct behaviour of job priorities.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12322652","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322652","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12410442","key":"MAPREDUCE-531","self":"https://issues.apache.org/jira/rest/api/2/issue/12410442","fields":{"summary":"Have end to end tests based on MiniMRCluster to verify the correct behaviour of user limits","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-07-08T16:40:30.186+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"At present, we only have unit tests that make use of FakeTaskManager and that only test the proper functionality of capacity scheduler in isolation. Many issues unearthed recently proved that this is not enough and that it is required to have end-to-end tests so that real JT is brought into the picture and with that the interaction of the scheduler with JT. This issue along with few other related jiras should automate and replace the end-to-end tests that are now manually done by QA, using MiniMRCluster.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12396592","id":"12396592","filename":"HADOOP-4830-20081222-svn.2","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-12-22T13:02:08.264+0000","size":48604,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12396592/HADOOP-4830-20081222-svn.2"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12396822","id":"12396822","filename":"HADOOP-4830-20081229-svn.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-12-29T05:36:44.426+0000","size":51397,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12396822/HADOOP-4830-20081229-svn.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12397190","id":"12397190","filename":"HADOOP-4830-20090106-2-svn.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-01-06T10:52:36.470+0000","size":52631,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12397190/HADOOP-4830-20090106-2-svn.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"104082","customfield_12312823":null,"summary":"Have end to end tests based on MiniMRCluster to verify that queue capacities are honoured.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410437/comment/12655521","id":"12655521","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"This particular JIRA should address the following:\n - Write/improve utilities that will help the test-cases. This includes\n      -- enhancing org.apache.hadoop.mapred.UtilsForTests.Waiting{Mapper|Reducer} so that the tasks that can finish by signalling is controlled and is a subset of all the tasks.\n      -- having a utility that makes a test to block and wait for a particular number of tasks to be running and occupying a cluster's slots.\n      -- setting up a way to configure the capacity scheduler for the tests.\n - Automate the tests related to queue capacities: submit jobs to different queues simultaneously and see that capacities are honored","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-12-11T05:35:38.548+0000","updated":"2008-12-11T05:35:38.548+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410437/comment/12658528","id":"12658528","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"Attaching patch. This includes\n - o.a.h.mapred.ControlledMapReduceJob to run a job whose tasks' execution can be precisely controlled by a user.\n - o.a.h.mapred.ClusterWithCapacityScheduler to start a MiniMRCluster with CapacityScheduler configured as the scheduler. It provides api for configuring both the cluster as well as the scheduler. Any test to verify behaviour of CapacityTaskScheduler should extend this class.\n - Tests o.a.h.m.TestControlledMapReduceJob and o.a.h.m.TestClusterWithCapacityScheduler to test both the above utility classes. Later is very minimal and can be improved as we go.\n - o.a.h.m.TestQueueCapacities to automate the tests related to queue capacities and to serve as a demonstration of how to use the above utilities for testing CapacityTaskScheduler. This includes basic queue capacity tests. Many other tests are possible but some of them involve testing reclamation of slots and hence will be done in a separate Jira (HADOOP-4834).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-12-22T13:02:08.639+0000","updated":"2008-12-22T13:02:08.639+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410437/comment/12658529","id":"12658529","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"Amar, can you please review this patch?\n\nThanks,\n-Vinod","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-12-22T13:04:05.261+0000","updated":"2008-12-22T13:04:05.261+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410437/comment/12659087","id":"12659087","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"body":"Some comments:\n\nControlledMapReduceJob:\n- All paths should be created relative to the build directory. Something like new Path(System.getProperty(\"test.build.data\",\"/tmp\"), \"signalFileDir-...\")\n- Do we really need to create the temp file ? Is it only for creating a unique random number. Can we use Random for the same ?\n- Rather than split and get the task id, we can use the TaskID classes to get the same. The hierarchy extends to ID, which will give you the number. Also, rather than call it TaskID which has a specific meaning, can we call it taskNumber or something.\n- getTasksCounts: can't we directly use finishedMaps or finishedReduces \n- assertNTasksRunningAtSteadyState: The 5 seconds time limit brings in timing dependencies that should be avoided if we can. Ideally if we can check that two consecutive heartbeat cycles don't change the running counts, that should be enough. Can we check the state of the JT or the scheduler to get this information ?\n\nClusterWithCapacityScheduler:\n- Write the capacity scheduler configuration in a path relative to test.build.data\n- The default values for the job initialization related properties are fixed. So this can be removed now.\n- Please review the Log level of the log statements. I think some of them will be too verbose for an INFO level. For e.g. what keys we're writing to the scheduler conf.\n- Please have a more clear comment on why fs.getRawFileSystem().setConf(config); is required after setting it on the local file system object.\n\nTestClusterWithCapacityScheduler doesn't seem specifically needed. A lot of the tests will exercise this and it will be very obvious if it doesn't work. Unlike the TestControlledMapReduceJob which is a simple test that can be easily verified for correctness with the default scheduler.\n\n\nTestQueueCapacities:\n- Since we're trying to use MiniMR, can we by default have more than 1 tasktracker - like 4 or something, and suitably scale all the task counts. Likewise, I also think number of reduces should be non-zero for most cases. I think this would make it closer to reality. And since we're using controlled execution, it would really not make a difference to the test logic, right ?\n- I think we fixed reclaimcapacity time limit to be in seconds, rather than milliseconds.\n- Related to multiple queue tests, can we also have a test where jobs are submitted to different queues - all below the queue's capacity, and make sure they are all running. This will exercise some specific code paths related to job initialization, considering multiple queues for scheduling jobs etc.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"created":"2008-12-24T11:25:32.950+0000","updated":"2008-12-24T11:25:32.950+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410437/comment/12659499","id":"12659499","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"Attaching a new patch incorporating the review comments. Notes on some particular points follow.\n\nbq. assertNTasksRunningAtSteadyState: The 5 seconds time limit brings in timing dependencies that should be avoided if we can. Ideally if we can check that two consecutive heartbeat cycles don't change the running counts, that should be enough. Can we check the state of the JT or the scheduler to get this information ?\nThis is replaced with a ClusterWithCapacityScheduler.WaitTillAllTasksAreOccupied to test that all the slots of a particular type are occupied in the cluster. And this is done by looking at the ClusterStatus and waiting till the total number of tasks runing becomes equal to the maximum number of slots in the cluster.\n\nbq. TestClusterWithCapacityScheduler doesn't seem specifically needed. A lot of the tests will exercise this and it will be very obvious if it doesn't work. Unlike the TestControlledMapReduceJob which is a simple test that can be easily verified for correctness with the default scheduler.\nThe original intention was to test invalid configuration. Moved this out, it may be done later. Or if possible, we should move the invalid configuration related checks into CapacitySchedulerConf itself instead of having them in CapacityTaskScheduler.start()\n\nOthers:\n - Added ClusterWithCapacityScheduler.cleanUpSchedulerConfigFile.\n - Test time:\nTestQueueCapacities is taking an average of slightly more than 6 1/2 minutes for each run, excluding the build time. This is after a bit of refactoring is done to reuse clusters across multiple tests instead of starting a new cluster for every single test. I've tried to minimize this time as far as possible, but an independent effort should be taken up to reduce this test time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-12-29T05:36:44.461+0000","updated":"2008-12-29T05:36:44.461+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410437/comment/12660681","id":"12660681","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"body":"Looking good. A few comments:\n\n- We are iterating over the task list to get the number of running tasks in ControlledMapReduceJob.getRunningTasksCount(). We check if the task is running using TaskInProgress.isRunning(). This method of computation seems like it would not be different from JobInProgress.runningMaps() or JobInProgress.runningReduces(). Can you please check if there is a difference ?\n- There are a few TODOs in the comments in ControlledMapReduceJob. These should be removed, or alternatively we should add a more descriptive comment about a possible improvement.\n- In writeFile, some lines related to replication are commented. These can be removed.\n- The RunningJob variable, rJob, can be private and not package private\n\nWhen I ran the test on my system, it failed because of missing some classes related to Jetty:\n{code}\norg/mortbay/jetty/servlet/Context\njava.lang.NoClassDefFoundError: org/mortbay/jetty/servlet/Context\n    at org.apache.hadoop.hdfs.server.namenode.NameNode.startHttpServer(NameNode.java:220)\n    at org.apache.hadoop.hdfs.server.namenode.NameNode.initialize(NameNode.java:202)\n    at org.apache.hadoop.hdfs.server.namenode.NameNode.<init>(NameNode.java:279)\n    at org.apache.hadoop.hdfs.server.namenode.NameNode.createNameNode(NameNode.java:955)\n    at org.apache.hadoop.hdfs.MiniDFSCluster.<init>(MiniDFSCluster.java:275)\n    at org.apache.hadoop.hdfs.MiniDFSCluster.<init>(MiniDFSCluster.java:119)\n    at org.apache.hadoop.mapred.ClusterWithCapacityScheduler.startCluster(ClusterWithCapacityScheduler.java:101)\n    at org.apache.hadoop.mapred.TestQueueCapacities.testSingleQueue(TestQueueCapacities.java:54)\n{code}\n\nThis may be that we need to fix something in ivy.xml of the capacity scheduler. Copying the ivy.xml from streaming ran the test successfully.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-01-05T08:35:42.136+0000","updated":"2009-01-05T08:35:42.136+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410437/comment/12660683","id":"12660683","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"body":"Also, in the next version, can you please update test-patch results, so I can commit the patch ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-01-05T08:36:22.345+0000","updated":"2009-01-05T08:36:22.345+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410437/comment/12661101","id":"12661101","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"Attaching a new patch. Incorporated the above review comments. Notes about particular points follow:\n\nbq. We are iterating over the task list to get the number of running tasks in ControlledMapReduceJob.getRunningTasksCount(). We check if the task is running using TaskInProgress.isRunning(). This method of computation seems like it would not be different from JobInProgress.runningMaps() or JobInProgress.runningReduces(). Can you please check if there is a difference ?\nAs pointed out, there is no real difference. The original intention was to ensure that so and so number of tasks are really running on TaskTrackers. But on retrospection, I came to conclude that the number of tasks scheduled(JIP.runningTasks()) should suffice. This is because the number of tasks scheduled is same as the number of tasks running in the test environment(no lost trackers). Made changes to use JIP.runningTasks() regarding the same.\n\nbq. This may be that we need to fix something in ivy.xml of the capacity scheduler. Copying the ivy.xml from streaming ran the test successfully.\nMade changes to ivy.xml in capacity scheduler src to include the needed jars. But, as Hemanth also concurs during a discussion, it may become cumbersome in future to add every new jar that capacity scheduler might not need directly but still needed to be included because of the dependency on underlying projects/modules say mapred/hdfs. Will file a new issue to see if this can be addressed generally.\n\nWhile running tests, found that some tests were timing out. The actual reason turned out to be HADOOP-4977. The test TestQueueCapacities might fail sometimes because of that and till that gets fixed.\n\nant test-patch results:\n{code}\n     [exec] +1 overall.  \n     [exec] \n     [exec]     +1 @author.  The patch does not contain any @author tags.\n     [exec] \n     [exec]     +1 tests included.  The patch appears to include 15 new or modified tests.\n     [exec] \n     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.\n     [exec] \n     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n     [exec] \n     [exec]     +1 findbugs.  The patch does not introduce any new Findbugs warnings.\n     [exec] \n     [exec]     +1 Eclipse classpath. The patch retains Eclipse classpath integrity.\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-01-06T10:52:36.521+0000","updated":"2009-01-06T10:52:36.521+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410437/comment/12661455","id":"12661455","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"body":"I just committed this to trunk and branch 0.20, as they are test cases and no change to functionality. Thanks, Vinod !","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-01-07T05:59:32.689+0000","updated":"2009-01-07T05:59:32.689+0000"}],"maxResults":9,"total":9,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-4830/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0i63j:"}}