{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13188004","self":"https://issues.apache.org/jira/rest/api/2/issue/13188004","key":"HADOOP-15797","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2018-09-28T09:23:42.993+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Sep 29 03:04:12 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_116823202_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2018-09-29T03:01:17.194+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-15797/watchers","watchCount":3,"isWatching":false},"created":"2018-09-27T18:34:14.022+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12342324","id":"12342324","description":"3.2 release","name":"3.2.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12342984","id":"12342984","description":"3.1.1 release","name":"3.1.1","archived":false,"released":true,"releaseDate":"2018-08-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-09-29T03:04:12.161+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12331123","id":"12331123","name":"fs/adl"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12328416","id":"12328416","name":"fs/azure","description":"Azure WASB filesystem client"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12311814","id":"12311814","name":"fs/s3","description":"S3A filesystem client and other S3 connectivity issues"}],"timeoriginalestimate":null,"description":"Throwing this in your .hadooprc results in hadoop-aws being in the classpath but not hadoop-azure*:\r\n\r\n{quote}\r\nhadoop_add_to_classpath_tools hadoop-aws\r\nhadoop_add_to_classpath_tools hadoop-azure\r\nhadoop_add_to_classpath_tools hadoop-azure-datalake\r\n{quote}\r\n\r\nIt would seem that the core issue is that that requires the module to have listed it's dependencies in MODULE_NAME.tools-builtin.txt, whereas the Azure connectors only have them listed in MODULE_NAME.tools-optional.txt. S3 does both, and there's a comment in it's POM about how it needs to do this because of the \"hadoop s3guard\" CLI.\r\n\r\nMaybe there's some history that I'm missing here, but I think what's wrong here is that hadoop_add_to_classpath should get what it needs from optional modules. builtin modules shouldn't even need hadoop_add_to_classpath to be added anyway.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"optional / builtin modules confused for cloud storage","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mackrorysd","name":"mackrorysd","key":"mackrorysd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mackrorysd&avatarId=18559","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mackrorysd&avatarId=18559","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mackrorysd&avatarId=18559","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mackrorysd&avatarId=18559"},"displayName":"Sean Mackrory","active":true,"timeZone":"America/Denver"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mackrorysd","name":"mackrorysd","key":"mackrorysd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mackrorysd&avatarId=18559","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mackrorysd&avatarId=18559","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mackrorysd&avatarId=18559","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mackrorysd&avatarId=18559"},"displayName":"Sean Mackrory","active":true,"timeZone":"America/Denver"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13188004/comment/16631598","id":"16631598","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"Let's see what [~aw] says about -builtin vs -optional.\r\n\r\n# we need to document all this stuff a bit better\r\n# if hadoop_add_to_classpath picks up the -optional files, then everything will be consistent. I'd be happy with that.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2018-09-28T09:23:42.993+0000","updated":"2018-09-28T09:23:42.993+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13188004/comment/16631774","id":"16631774","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"body":"First, let's put the side the issue of s3guard. It breaks things, as we'll see in a bit.\r\n\r\nSecond, let's also remember that the whole point of this code is to pull things OUT of the default classpath.  \r\n\r\nNow, what does 'builtin' and 'optional' mean?\r\n\r\nbuiltin = required by a command.  For example, hadoop distcp requires it's jar at runtime.  It is not needed any other time, so it doesn't make sense to put it AND ANY DEPENDENCIES on the classpath all the time.\r\n\r\noptional = optional features the USER wants to enable.  All of these features need to always be available at runtime. Prior to s3guard, this was ALL of the non-core file systems: S3, Azure, etc, etc.  Users enable these features using the HADOOP_OPTIONAL_TOOLS environment variable. Again, if I don't access S3 from my cluster, I don't want the AWS jars AND ANY DEPENDENCIES on the classpath.  \r\n\r\nIt's also worthwhile pointing out that removing all of these jars from the default classpath, in addition to allowing more user freedom, greatly speeds the system up when measured across all java launches.\r\n\r\nThat said, it is now easy to see the problem that s3guard presents and how it is an outlier.  s3guard is a built-in command that depends upon components are also optional. IMO: using s3guard to determine any sort of functionality for the rest of the system is completely and totally wrong.\r\n\r\nThat said, what makes anyone think that \"hadoop_add_to_classpath_tools hadoop-azure\" should work?  optional bits come as shellprofiles, not as hooks for built-ins.  I mean the documentation here literally says:\r\n\r\n{code}\r\n## @description  Run libexec/tools/module.sh to add to the classpath\r\n## @description  environment\r\n{code}\r\n\r\nIf you want per-user settings for this (which is also weird, but whatever), then modifying .hadoop-env is the way to go.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"created":"2018-09-28T12:30:32.214+0000","updated":"2018-09-28T12:30:32.214+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13188004/comment/16631848","id":"16631848","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"Allen, thank you for your explanations. \r\n\r\nbq. if I don't access S3 from my cluster, I don't want the AWS jars AND ANY DEPENDENCIES on the classpath.\r\n\r\n+1. It's only a source of pain, and, with a 50MB shaded JAR, startup hit even though you do at least get to avoid jackson version conflict.\r\n\r\n\r\nFWIW, I quite like the {{hadoop_add_to_classpath_tools}}  command, because it makes it easier to add multiple tools to the CP in separate scripts. working with the classpaath env var seems like a step backwards.\r\n\r\nAnyway, the use case the object store ops are trying to address is \"add support for a non-HDFS filesystem\" to the CP. That may be optional (s3a), or, as in the case of wasb/adl/abfs with Hadoop running in Azure, absolutely mandatory for anything to work.\r\n\r\nThe metric for CP setup is always the same:\r\n\r\nDoes {{hadoop fs -ls <my store URL>}} work? If it does, distcp and everything else should also kick in, maybe even HBase.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2018-09-28T13:39:51.290+0000","updated":"2018-09-28T13:39:51.290+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13188004/comment/16632714","id":"16632714","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"body":"\r\nbq. working with the classpaath env var seems like a step backwards.\r\n\r\nJust to be explicit about it, enabling Azure, etc, is not about users modifying the classpath directly.  That's always dangerous.  But it is about modifying the HADOOP_OPTIONAL_TOOLS var as documented in hadoop-env.sh (as well as a few other places):\r\n\r\n{code}\r\n# Enable optional, bundled Hadoop features\r\n# This is a comma delimited list.  It may NOT be overridden via .hadooprc\r\n# Entries may be added/removed as needed.\r\n# export HADOOP_OPTIONAL_TOOLS=\"hadoop-aliyun,hadoop-aws,hadoop-azure,hadoop-azure-datalake,hadoop-kafka,hadoop-openstack\"\r\n{code}\r\n\r\nbq. The metric for CP setup is always the same:\r\nbq. Does hadoop fs -ls <my store URL> work? If it does, distcp and everything else should also kick in, maybe even HBase.\r\n\r\nUsing .hadooprc, hadoop fs -ls can work but the others may not since distcp, HBase, etc require the entire cluster to be configured.  This is why these settings are hadoop-env.sh config and not a hadooprc config.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aw","name":"aw","key":"aw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=aw&avatarId=23681","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=aw&avatarId=23681","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=aw&avatarId=23681","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=aw&avatarId=23681"},"displayName":"Allen Wittenauer","active":true,"timeZone":"America/Tijuana"},"created":"2018-09-29T01:49:24.939+0000","updated":"2018-09-29T01:49:24.939+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13188004/comment/16632749","id":"16632749","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mackrorysd","name":"mackrorysd","key":"mackrorysd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mackrorysd&avatarId=18559","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mackrorysd&avatarId=18559","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mackrorysd&avatarId=18559","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mackrorysd&avatarId=18559"},"displayName":"Sean Mackrory","active":true,"timeZone":"America/Denver"},"body":"Makes sense to me. I'll close this and file a separate one to see if there's a good way to have the \"hadoop s3guard\" CLI command exist without hadoop-aws being marked as a required module. If the command exists but fails with a nice error message if someone tries to use it without adding hadoop-aws to HADOOP_OPTIONAL_TOOLS, that would be good enough for me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mackrorysd","name":"mackrorysd","key":"mackrorysd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mackrorysd&avatarId=18559","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mackrorysd&avatarId=18559","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mackrorysd&avatarId=18559","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mackrorysd&avatarId=18559"},"displayName":"Sean Mackrory","active":true,"timeZone":"America/Denver"},"created":"2018-09-29T03:01:01.276+0000","updated":"2018-09-29T03:01:01.276+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13188004/comment/16632752","id":"16632752","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mackrorysd","name":"mackrorysd","key":"mackrorysd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mackrorysd&avatarId=18559","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mackrorysd&avatarId=18559","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mackrorysd&avatarId=18559","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mackrorysd&avatarId=18559"},"displayName":"Sean Mackrory","active":true,"timeZone":"America/Denver"},"body":"See HADOOP-15803.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mackrorysd","name":"mackrorysd","key":"mackrorysd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mackrorysd&avatarId=18559","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mackrorysd&avatarId=18559","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mackrorysd&avatarId=18559","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mackrorysd&avatarId=18559"},"displayName":"Sean Mackrory","active":true,"timeZone":"America/Denver"},"created":"2018-09-29T03:04:12.161+0000","updated":"2018-09-29T03:04:12.161+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-15797/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3yl6n:"}}