{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12780672","self":"https://issues.apache.org/jira/rest/api/2/issue/12780672","key":"HADOOP-11699","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-03-10T20:13:53.692+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 18 18:31:30 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-11699/watchers","watchCount":6,"isWatching":false},"created":"2015-03-10T00:26:16.531+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327179","id":"12327179","description":"2.6.0 release","name":"2.6.0","archived":false,"released":true,"releaseDate":"2014-11-18"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-03-18T18:31:38.516+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/3","description":"This issue is being actively worked on at the moment by the assignee.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/inprogress.png","name":"In Progress","id":"3","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312526","id":"12312526","name":"security"}],"timeoriginalestimate":null,"description":"The _HOST marker used for Kerberos principals in various configuration files does not always return lowercase fully qualified hostnames.  For example this setting in hdfs-site.xml\n{code}\n<property>\n  <name>dfs.namenode.kerberos.principal</name>\n  <value>hdfs/_HOST@YOURREALM.COM</value>\n</property>\n{code}\n\nIn particular, this is impeding our work to have Hadoop work with equivalent security on Windows as on Linux.\n\nIn the windows env in which I'm having the issue, I was able to get a fully qualified host name using this version of method getLocalHostName() in .  \nhadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/SecurityUtil.java\n\n{code:java}\n  public static String getLocalHostName() throws UnknownHostException {\n    String hostname = InetAddress.getLocalHost().getCanonicalHostName();\n    if ( !hostname.contains( \".\" ) ) {\n      final String os = System.getProperties().getProperty( \"os.name\", \"?\" ).toLowerCase();\n      if ( os.startsWith( \"windows\" ) ) {\n        String domain = System.getenv( \"USERDNSDOMAIN\" );\n        if ( domain != null ) {\n          hostname += \".\" + domain.trim();\n        }\n      }\n    }\n    return hostname == null ? \"localhost\" : hostname.toLowerCase();\n  }\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"_HOST not consistently resolving to lowercase fully qualified hostname on Windows","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kminder","name":"kminder","key":"kminder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kminder&avatarId=21642","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kminder&avatarId=21642","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kminder&avatarId=21642","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kminder&avatarId=21642"},"displayName":"Kevin Minder","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kminder","name":"kminder","key":"kminder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kminder&avatarId=21642","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kminder&avatarId=21642","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kminder&avatarId=21642","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kminder&avatarId=21642"},"displayName":"Kevin Minder","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12780672/comment/14355603","id":"14355603","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi [~kminder].  Thanks for filing this issue.\n\nJust to confirm, is DNS otherwise working correctly in your environment?  For example, does {{nslookup}} return the expected result?  I expect {{InetAddress.getLocalHost().getCanonicalHostName()}} to be basically equivalent to a reverse DNS lookup.  If DNS works fine in this environment, then I suppose we're dealing with some quirk of Java on Windows.\n\nI think {{USERDNSDOMAIN}} is only defined if the logged in user is a domain user.  It won't be defined if logged in as a local account or a built-in account like administrator.  That's probably fine though.\n\nIs the {{toLowerCase}} necessary?  I have seen environments where using all caps for Windows host names was considered a standard practice.  Kerberos is case-sensitive.  DNS is case-insensitive, but case-preserving on outputs.  Because of that, I'd expect upper case to work fine as long as both DNS and Kerberos records are consistent in their use of upper case, so that everything matches.\n\nThe last line has a {{null}} check.  Did you actually see a {{null}} value in your testing?  I didn't think {{InetAddress.getLocalHost().getCanonicalHostName()}} could ever return {{null}}.\n\nJust a minor nit-pick: you can use {{org.apache.hadoop.util.Shell#WINDOWS}} as a helper to check if the runtime environment is Windows.  I recommend completely special-casing all unique handling on Windows, so that non-Windows continues to use the straight-up {{return InetAddress.getLocalHost().getCanonicalHostName()}}.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-10T20:13:53.692+0000","updated":"2015-03-10T20:13:53.692+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12780672/comment/14355760","id":"14355760","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jnp","name":"jnp","key":"jnp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jitendra Nath Pandey","active":true,"timeZone":"Etc/UTC"},"body":"bq. Is the toLowerCase necessary?\nI think toLowerCase is in line with the current convention in hadoop to use lowercase for service principals. We have seen kerberos having trouble with upper case characters in the hortnames. KerberosUtil.java#getServicePrincipal has a comment that states this problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jnp","name":"jnp","key":"jnp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jitendra Nath Pandey","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-10T21:30:14.943+0000","updated":"2015-03-10T21:30:14.943+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12780672/comment/14355772","id":"14355772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"[~jnp], thanks for pointing that out.  In that case, it seems like {{SecurityUtil#getLocalHostName}} ought to return lower case in all environments, not just Windows, for agreement with {{KerberosUtil#getServicePrincipal}}.  Also, we should use {{StringUtils#toLowerCase}} for the correct locale handling.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-10T21:38:54.991+0000","updated":"2015-03-10T21:38:54.991+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12780672/comment/14355806","id":"14355806","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jnp","name":"jnp","key":"jnp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jitendra Nath Pandey","active":true,"timeZone":"Etc/UTC"},"body":"I just noticed that {{SecurityUtil#replacePattern}} already has {{StringUtils.toLowerCase}} to convert to lower case, which is inline with {{KerberosUtil#getServicePrincipal}}. Therefore, you were right that {{toLowerCase}} in {{SecurityUtil#getLocalHostName}} is not necessary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jnp","name":"jnp","key":"jnp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jitendra Nath Pandey","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-10T22:00:08.305+0000","updated":"2015-03-10T22:00:08.305+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12780672/comment/14355868","id":"14355868","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"The difference is likely that any Linux deployment would have been using lower-case host names.  A Windows deployment might use upper-case host names.  (This is something I've seen Windows admins use as a standard practice.)  Since Kerberos is case-sensitive, I think the case used in any principals must match the case used in the host name.  Therefore, I'd expect the 2 code paths in {{KerberosUtil}} and {{SecurityUtil}} need to be symmetric with regards to case conversion.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-10T22:41:09.941+0000","updated":"2015-03-10T22:41:09.941+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12780672/comment/14356891","id":"14356891","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"{code} \nString hostname = InetAddress.getLocalHost().getCanonicalHostName();\n+    if ( !hostname.contains( \".\" ) ) {\n+      if ( Shell.WINDOWS ) {\n+        String domain = System.getenv( \"USERDNSDOMAIN\" );\n+        if ( domain != null ) {\n+          hostname += \".\" + domain.trim();\n+        }\n+      }\n+    }\n+    return hostname ;\n   }\n{code}\n\nThought of give patch like above, But this will not change to lowercase , incase of windows machine..So I fell,{{toLowerCase}} is required...Please correct me, If I am wrong..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-03-11T14:05:52.681+0000","updated":"2015-03-11T14:05:52.681+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12780672/comment/14367622","id":"14367622","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"body":"Any comments on this..?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brahmareddy","name":"brahmareddy","key":"brahmareddy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brahmareddy&avatarId=24624","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brahmareddy&avatarId=24624","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brahmareddy&avatarId=24624","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brahmareddy&avatarId=24624"},"displayName":"Brahma Reddy Battula","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-03-18T18:31:30.933+0000","updated":"2015-03-18T18:31:30.933+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-11699/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i26jrr:"}}