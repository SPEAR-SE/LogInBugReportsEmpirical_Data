{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12439234","self":"https://issues.apache.org/jira/rest/api/2/issue/12439234","key":"HADOOP-6339","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2009-10-28T00:29:20.343+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Oct 30 06:35:16 UTC 2009","customfield_12310420":"19145","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-6339/watchers","watchCount":5,"isWatching":false},"created":"2009-10-28T00:23:15.098+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313866","id":"12313866","description":"","name":"0.20.1","archived":false,"released":true,"releaseDate":"2009-09-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-10-30T06:35:16.661+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/4","description":"This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/reopened.png","name":"Reopened","id":"4","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310687","id":"12310687","name":"io","description":""}],"timeoriginalestimate":null,"description":"When using the SequenceFile.createWriter(..,FSDataOutputStream, ...) method to create a Writer, data is not flushed when the encapsulating SequenceFile is closed.\n\nExample test case skeleton:\n{code}\npublic void testWhyFail() throws IOException {\n\n    // There a was a failure case using :\n    Configuration conf = ... ;\n    Path path = new Path(\"file:///tmp/testfile\");\n    FileSystem hdfs = path.getFileSystem(conf);\n\n    // writing\n    FSDataOutputStream dos = hdfs.create(path);\n    hdfs.deleteOnExit(path);\n\n    // it is specifically with this writer.\n    Writer writer = SequenceFile.createWriter(conf, dos,\n        WriteableEventKey.class, WriteableEvent.class,\n        SequenceFile.CompressionType.NONE, new DefaultCodec());\n\n    Writable value = ...;\n    Writable key = ...;\n\n    writer.append(key, value);\n    writer.sync();\n    writer.close();\n\n    // Test fails unless I close the underlying FSDataOutputStream handle with the line below.\n    //    dos.close(); \n    \n    // WTF: nothing written by this writer!\n    FileStatus stats = hdfs.getFileStatus(path);\n    assertTrue(stats.getLen() > 0);\n    // it should have written something but it failed.\n  }\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"102498","customfield_12312823":null,"summary":"SequenceFile writer does not properly flush stream with external DataOutputStream","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmhsieh","name":"jmhsieh","key":"jmhsieh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jmhsieh&avatarId=10412","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jmhsieh&avatarId=10412","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jmhsieh&avatarId=10412","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jmhsieh&avatarId=10412"},"displayName":"Jonathan Hsieh","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmhsieh","name":"jmhsieh","key":"jmhsieh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jmhsieh&avatarId=10412","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jmhsieh&avatarId=10412","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jmhsieh&avatarId=10412","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jmhsieh&avatarId=10412"},"displayName":"Jonathan Hsieh","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12439234/comment/12770723","id":"12770723","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"Hey Jonathan, this is supposed to work that way. The outputstream is supposed to be closed by the app since it was created by the app. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-10-28T00:29:20.343+0000","updated":"2009-10-28T00:29:20.343+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12439234/comment/12770732","id":"12770732","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmhsieh","name":"jmhsieh","key":"jmhsieh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jmhsieh&avatarId=10412","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jmhsieh&avatarId=10412","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jmhsieh&avatarId=10412","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jmhsieh&avatarId=10412"},"displayName":"Jonathan Hsieh","active":true,"timeZone":"America/Los_Angeles"},"body":"Devaraj:   If that is the case, I think the javadoc documentation should be updated explaining these semantics because they are different from close semantics when creating the writer via SequenceFile.createWriter(...,Path,...).  \n\nInside SequenceFile.close(),  it eventually calls flush on the FSDataOutputStream.  Note that this test case is actually writing to the local file system (file:///tmp/testfile).  Is that flush call supposed to do nothing to maintain consistency with the semantics when writing to hdfs?\n\nThanks,\nJon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmhsieh","name":"jmhsieh","key":"jmhsieh","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jmhsieh&avatarId=10412","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jmhsieh&avatarId=10412","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jmhsieh&avatarId=10412","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jmhsieh&avatarId=10412"},"displayName":"Jonathan Hsieh","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-10-28T00:44:26.317+0000","updated":"2009-10-28T00:44:26.317+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12439234/comment/12771083","id":"12771083","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kimballa","name":"kimballa","key":"kimballa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Kimball","active":true,"timeZone":"America/Los_Angeles"},"body":"I agree that the app should close the underlying OutputStream. But after the SequenceFile.Writer is closed, its data should be available in the file. SequenceFile.Writer.close() in fact calls flush() on the underlying DataOutputStream. It is bizarre that this data is not available to other readers. I still consider this a bug.\n\nat SequenceFile.java, line 985:\n{code}\n        // Close the underlying stream iff we own it...\n        if (ownOutputStream) {\n          out.close();\n        } else {\n          out.flush(); // <-- This does not seem to work right.\n        }\n        out = null;\n{code}\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kimballa","name":"kimballa","key":"kimballa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Kimball","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-10-28T19:55:03.167+0000","updated":"2009-10-28T19:55:03.167+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12439234/comment/12771841","id":"12771841","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"Actually, the flush call is somewhat misleading. If I am reading things right, it seems like LocalFilesystem's flush actually ends up being a no-op. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-10-30T06:35:16.608+0000","updated":"2009-10-30T06:35:16.608+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-6339/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0hwbj:"}}