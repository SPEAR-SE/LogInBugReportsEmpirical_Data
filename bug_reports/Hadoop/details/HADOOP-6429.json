{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12442999","self":"https://issues.apache.org/jira/rest/api/2/issue/12442999","key":"HADOOP-6429","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2016-03-11T21:11:49.357+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Mar 11 21:11:49 UTC 2016","customfield_12310420":"77721","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-6429/watchers","watchCount":5,"isWatching":false},"created":"2009-12-10T16:08:41.453+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314296","id":"12314296","description":"","name":"0.22.0","archived":false,"released":true,"releaseDate":"2011-12-10"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-03-11T21:11:49.357+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310688","id":"12310688","name":"ipc","description":""}],"timeoriginalestimate":null,"description":"High-level: \nIn my configuration files, I specifiy:\n{code:xml} \n<property>\n    <name>fs.default.name</name>\n    <value>hdfs://{{internal-dns}}:8020</value>\n </property>\n{code}\n\nThe name node server binds to address {{external-ip}}:8020, while all the data nodes try to connect to {{internal-ip}}:8020, and nothing works.\n\nLow-level: I've traced this down as far as {{org.apache.hadoop.ipc.Server}}, private class {{Listener}}.  \n{code:java}\n  /** Listens on the socket. Creates jobs for the handler threads*/\n  private class Listener extends Thread {\n    \n    private ServerSocketChannel acceptChannel = null; //the accept channel\n    private Selector selector = null; //the selector that we use for the server\n    private InetSocketAddress address; //the address we bind at\n    private Random rand = new Random();\n    private long lastCleanupRunTime = 0; //the last time when a cleanup connec-\n                                         //-tion (for idle connections) ran\n    private long cleanupInterval = 10000; //the minimum interval between \n                                          //two cleanup runs\n    private int backlogLength = conf.getInt(\"ipc.server.listen.queue.size\", 128);\n    \n    public Listener() throws IOException {\n      address = new InetSocketAddress(bindAddress, port);\n      LOG.info(\"in Server/Listener. bindAddress=\" + bindAddress + \", address=\"+address);    //Added by EA for testing\n      // Create a new server socket and set to non blocking mode\n      acceptChannel = ServerSocketChannel.open();\n      acceptChannel.configureBlocking(false);\n\n      // Bind the server socket to the local host and port\n      bind(acceptChannel.socket(), address, backlogLength);\n      port = acceptChannel.socket().getLocalPort(); //Could be an ephemeral port\n{code}\n\nThe problem  seems to be in the line {code}address = new InetSocketAddress(bindAddress, port);{code}.  bindAddress  contains the DNS name of the *internal* interface, but address comes out with the IP address of the *external* interface.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"103182","customfield_12312823":null,"summary":"Server listener binds to wrong IP address for domain name given","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eanderso","name":"eanderso","key":"eanderso","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Anderson","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eanderso","name":"eanderso","key":"eanderso","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Anderson","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Ubuntu Linux,  kernel 2.6.24-25-server, x86_64 architecture.  Java 1.6.0., OpenJDK.  Server has 4 physical Ethernet cards,  configured as follows: {{eth0}} is assigned an IP address {{external-ip}}.  {{eth1}}-{{eth3}} are bonded as {{bond0}}, which is assigned an IP address {{internal-ip}}.  This server has two dns entries: {{external-dns}} which resolves to {{external-ip}} and {{internal-dns}} which resolves to {{internal-ip}}.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442999/comment/12788768","id":"12788768","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eanderso","name":"eanderso","key":"eanderso","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Anderson","active":true,"timeZone":"Etc/UTC"},"body":"Here's more configuration information.  The internal DNS name and ip address are {{sdr.esl}} and {{10.138.207.6}}, respectively.  The external counterparts are {{sdr.cs.colorado.edu}} and {{128.138.207.6}}.\n\n{noformat}\nandersoe@sdr: ~ $ java -version\njava version \"1.6.0_0\"\nOpenJDK  Runtime Environment (build 1.6.0_0-b11)\nOpenJDK 64-Bit Server VM (build 1.6.0_0-b11, mixed mode)\nandersoe@sdr: ~ $ ip addr show\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast qlen 1000\n    link/ether 00:1e:68:0f:25:d8 brd ff:ff:ff:ff:ff:ff\n    inet 128.138.207.6/26 brd 128.138.207.63 scope global eth0\n    inet6 fe80::21e:68ff:fe0f:25d8/64 scope link \n       valid_lft forever preferred_lft forever\n3: eth1: <BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master bond0 qlen 1000\n    link/ether 00:1e:68:0f:25:dc brd ff:ff:ff:ff:ff:ff\n4: eth2: <BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master bond0 qlen 1000\n    link/ether 00:1e:68:0f:25:da brd ff:ff:ff:ff:ff:ff\n5: eth3: <BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master bond0 qlen 1000\n    link/ether 00:1e:68:0f:25:db brd ff:ff:ff:ff:ff:ff\n    inet 169.254.5.247/16 brd 169.254.255.255 scope link eth3:avahi\n6: bond0: <BROADCAST,MULTICAST,MASTER,UP,LOWER_UP> mtu 1500 qdisc noqueue \n    link/ether 00:1e:68:0f:25:dc brd ff:ff:ff:ff:ff:ff\n    inet 10.138.207.6/16 brd 10.138.255.255 scope global bond0\n    inet6 fe80::21e:68ff:fe0f:25dc/64 scope link \n       valid_lft forever preferred_lft forever\n7: vnet0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue \n    link/ether 92:f2:d3:0a:89:1e brd ff:ff:ff:ff:ff:ff\n    inet 192.168.122.1/24 brd 192.168.122.255 scope global vnet0\n    inet6 fe80::90f2:d3ff:fe0a:891e/64 scope link \n       valid_lft forever preferred_lft forever\nandersoe@sdr: ~ $ dig sdr.esl\n\n; <<>> DiG 9.4.2-P2.1 <<>> sdr.esl\n;; global options:  printcmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 64307\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0\n\n;; QUESTION SECTION:\n;sdr.esl.\t\t\tIN\tA\n\n;; ANSWER SECTION:\nsdr.esl.\t\t0\tIN\tA\t10.138.207.6\n\n;; Query time: 0 msec\n;; SERVER: 10.138.207.2#53(10.138.207.2)\n;; WHEN: Thu Dec 10 09:12:05 2009\n;; MSG SIZE  rcvd: 41\n\nandersoe@sdr: ~ $ dig sdr.cs.colorado.edu\n\n; <<>> DiG 9.4.2-P2.1 <<>> sdr.cs.colorado.edu\n;; global options:  printcmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 209\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0\n\n;; QUESTION SECTION:\n;sdr.cs.colorado.edu.\t\tIN\tA\n\n;; ANSWER SECTION:\nsdr.cs.colorado.edu.\t0\tIN\tA\t128.138.207.6\n\n;; Query time: 0 msec\n;; SERVER: 10.138.207.2#53(10.138.207.2)\n;; WHEN: Thu Dec 10 09:12:10 2009\n;; MSG SIZE  rcvd: 53\n\nandersoe@sdr: ~ $ uname -a\nLinux sdr 2.6.24-25-server #1 SMP Tue Oct 20 07:20:02 UTC 2009 x86_64 GNU/Linux\nandersoe@sdr: ~ $ \n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eanderso","name":"eanderso","key":"eanderso","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Anderson","active":true,"timeZone":"Etc/UTC"},"created":"2009-12-10T16:16:57.789+0000","updated":"2009-12-10T16:16:57.789+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442999/comment/15191505","id":"15191505","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ctubbsii","name":"ctubbsii","key":"ctubbsii","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ctubbsii&avatarId=15840","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ctubbsii&avatarId=15840","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ctubbsii&avatarId=15840","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ctubbsii&avatarId=15840"},"displayName":"Christopher Tubbs","active":true,"timeZone":"America/New_York"},"body":"I wonder if this is related to HADOOP-12918?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ctubbsii","name":"ctubbsii","key":"ctubbsii","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ctubbsii&avatarId=15840","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ctubbsii&avatarId=15840","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ctubbsii&avatarId=15840","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ctubbsii&avatarId=15840"},"displayName":"Christopher Tubbs","active":true,"timeZone":"America/New_York"},"created":"2016-03-11T21:11:49.357+0000","updated":"2016-03-11T21:11:49.357+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-6429/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0i0jj:"}}