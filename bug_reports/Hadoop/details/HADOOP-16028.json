{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13206902","self":"https://issues.apache.org/jira/rest/api/2/issue/13206902","key":"HADOOP-16028","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12343764","id":"12343764","description":"Hadoop 3.3.0","name":"3.3.0","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2018-12-29T17:32:42.857+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jan 04 18:12:14 UTC 2019","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_75066399_*|*_5_*:*_1_*:*_0_*|*_10002_*:*_1_*:*_482582676","customfield_12312321":null,"resolutiondate":"2019-01-04T17:59:01.719+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-16028/watchers","watchCount":7,"isWatching":false},"created":"2018-12-29T07:04:52.665+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"12.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12343006","id":"12343006","description":"2.9.2 release","name":"2.9.2","archived":false,"released":true,"releaseDate":"2018-11-19"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2019-01-04T18:12:14.132+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"During reading the hadoop NetworkTopology.java, I suspect there is a bug in function \r\n\r\nchooseRandom (line 498, hadoop version 2.9.2-RC0), \r\n\r\n I think there is a bug in{color:#f79232} code, ~excludedScope doesn't mean availableNodes under Scope node, and I also add unit test for this and get an exception.{color}\r\n\r\nbug code in the else.\r\n{code:java}\r\n// code placeholder\r\n\r\n if (excludedScope == null) {\r\n    availableNodes = countNumOfAvailableNodes(scope, excludedNodes);\r\n  } else {\r\n    availableNodes =\r\n        countNumOfAvailableNodes(\"~\" + excludedScope, excludedNodes);\r\n  }{code}\r\nSource code:\r\n{code:java}\r\n// code placeholder\r\nprotected Node chooseRandom(final String scope, String excludedScope,\r\n    final Collection<Node> excludedNodes) {\r\n  if (excludedScope != null) {\r\n    if (scope.startsWith(excludedScope)) {\r\n      return null;\r\n    }\r\n    if (!excludedScope.startsWith(scope)) {\r\n      excludedScope = null;\r\n    }\r\n  }\r\n  Node node = getNode(scope);\r\n  if (!(node instanceof InnerNode)) {\r\n    return excludedNodes != null && excludedNodes.contains(node) ?\r\n        null : node;\r\n  }\r\n  InnerNode innerNode = (InnerNode)node;\r\n  int numOfDatanodes = innerNode.getNumOfLeaves();\r\n  if (excludedScope == null) {\r\n    node = null;\r\n  } else {\r\n    node = getNode(excludedScope);\r\n    if (!(node instanceof InnerNode)) {\r\n      numOfDatanodes -= 1;\r\n    } else {\r\n      numOfDatanodes -= ((InnerNode)node).getNumOfLeaves();\r\n    }\r\n  }\r\n  if (numOfDatanodes <= 0) {\r\n    LOG.debug(\"Failed to find datanode (scope=\\\"{}\\\" excludedScope=\\\"{}\\\").\"\r\n            + \" numOfDatanodes={}\",\r\n        scope, excludedScope, numOfDatanodes);\r\n    return null;\r\n  }\r\n  final int availableNodes;\r\n  if (excludedScope == null) {\r\n    availableNodes = countNumOfAvailableNodes(scope, excludedNodes);\r\n  } else {\r\n    availableNodes =\r\n        countNumOfAvailableNodes(\"~\" + excludedScope, excludedNodes);\r\n  }\r\n  LOG.debug(\"Choosing random from {} available nodes on node {},\"\r\n      + \" scope={}, excludedScope={}, excludeNodes={}. numOfDatanodes={}.\",\r\n      availableNodes, innerNode, scope, excludedScope, excludedNodes,\r\n      numOfDatanodes);\r\n  Node ret = null;\r\n  if (availableNodes > 0) {\r\n    ret = chooseRandom(innerNode, node, excludedNodes, numOfDatanodes,\r\n        availableNodes);\r\n  }\r\n  LOG.debug(\"chooseRandom returning {}\", ret);\r\n  return ret;\r\n}\r\n{code}\r\n \r\n\r\n \r\n\r\nAdd Unit Test in TestClusterTopology.java, but get exception.\r\n\r\n \r\n{code:java}\r\n// code placeholder\r\n\r\n@Test\r\npublic void testChooseRandom1() {\r\n  // create the topology\r\n  NetworkTopology cluster = NetworkTopology.getInstance(new Configuration());\r\n  NodeElement node1 = getNewNode(\"node1\", \"/a1/b1/c1\");\r\n  cluster.add(node1);\r\n  NodeElement node2 = getNewNode(\"node2\", \"/a1/b1/c1\");\r\n  cluster.add(node2);\r\n  NodeElement node3 = getNewNode(\"node3\", \"/a1/b1/c2\");\r\n  cluster.add(node3);\r\n  NodeElement node4 = getNewNode(\"node4\", \"/a1/b2/c3\");\r\n  cluster.add(node4);\r\n\r\n  Node node = cluster.chooseRandom(\"/a1/b1\", \"/a1/b1/c1\", null);\r\n  assertSame(node.getName(), \"node3\");\r\n}\r\n{code}\r\n \r\n\r\nException:\r\n{code:java}\r\n// code placeholder\r\n\r\njava.lang.IllegalArgumentException: 1 should >= 2, and both should be positive. \r\nat com.google.common.base.Preconditions.checkArgument(Preconditions.java:88) \r\nat org.apache.hadoop.net.NetworkTopology.chooseRandom(NetworkTopology.java:567) \r\nat org.apache.hadoop.net.NetworkTopology.chooseRandom(NetworkTopology.java:544) \r\natorg.apache.hadoop.net.TestClusterTopology.testChooseRandom1(TestClusterTopology.java:198)\r\n{code}\r\n \r\n\r\n{color:#f79232}!image-2018-12-29-15-02-19-415.png!{color}\r\n\r\n \r\n\r\n \r\n\r\n[~vagarychen] this change is imported in PR HDFS-11577, could you help to check whether this is a bug ?\r\n\r\n ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12953324","id":"12953324","filename":"0001-add-UT-for-NetworkTopology.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-30T03:55:01.045+0000","size":1639,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12953324/0001-add-UT-for-NetworkTopology.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12953420","id":"12953420","filename":"0001-fix-NetworkTopology.java-chooseRandom-bug.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-01T08:04:49.818+0000","size":1494,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12953420/0001-fix-NetworkTopology.java-chooseRandom-bug.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12953431","id":"12953431","filename":"HDFS-14181.01.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-01T11:18:21.556+0000","size":1632,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12953431/HDFS-14181.01.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12953432","id":"12953432","filename":"HDFS-14181.02.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-01T11:18:21.618+0000","size":1498,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12953432/HDFS-14181.02.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12953461","id":"12953461","filename":"HDFS-14181.03.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-02T02:31:30.264+0000","size":2881,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12953461/HDFS-14181.03.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12953468","id":"12953468","filename":"HDFS-14181.04.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-02T04:47:51.268+0000","size":4161,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12953468/HDFS-14181.04.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12953474","id":"12953474","filename":"HDFS-14181.05.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-02T06:12:12.055+0000","size":2892,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12953474/HDFS-14181.05.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12953572","id":"12953572","filename":"HDFS-14181.06.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-03T05:05:14.566+0000","size":3385,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12953572/HDFS-14181.06.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12953613","id":"12953613","filename":"HDFS-14181.07.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-03T11:21:07.842+0000","size":3385,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12953613/HDFS-14181.07.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12953641","id":"12953641","filename":"HDFS-14181.08.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-03T14:21:55.918+0000","size":3381,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12953641/HDFS-14181.08.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12953698","id":"12953698","filename":"HDFS-14181.09.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-04T03:33:00.644+0000","size":3347,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12953698/HDFS-14181.09.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12953296","id":"12953296","filename":"image-2018-12-29-15-02-19-415.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-29T07:02:21.225+0000","size":20223,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12953296/image-2018-12-29-15-02-19-415.png"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Fix NetworkTopology chooseRandom function to support excluded nodes","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16730774","id":"16730774","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~sihai] for reporting.\r\nCan you upload a patch with the unit test? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-29T17:32:42.857+0000","updated":"2018-12-29T17:32:42.857+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16730875","id":"16730875","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"body":"[~elgoiri]  I have uploaded the patch, and the network topoloty picture is also attached, and the UT will throw exception, could you help to have a look?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-30T04:00:36.209+0000","updated":"2018-12-30T04:00:36.209+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16730889","id":"16730889","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\r\n\\\\\r\n\\\\\r\n|| Vote || Subsystem || Runtime || Comment ||\r\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 16s{color} | {color:blue} Docker mode activated. {color} |\r\n|| || || || {color:brown} Prechecks {color} ||\r\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\r\n| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 1 new or modified test files. {color} |\r\n|| || || || {color:brown} trunk Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 19m 57s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 15m 51s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 52s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 13s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 14m 18s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 35s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 59s{color} | {color:green} trunk passed {color} |\r\n|| || || || {color:brown} Patch Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 47s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 15m  8s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 15m  8s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 51s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 10s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 12m  4s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 42s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 58s{color} | {color:green} the patch passed {color} |\r\n|| || || || {color:brown} Other Tests {color} ||\r\n| {color:red}-1{color} | {color:red} unit {color} | {color:red}  8m 31s{color} | {color:red} hadoop-common in the patch failed. {color} |\r\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 40s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\r\n| {color:black}{color} | {color:black} {color} | {color:black} 96m 37s{color} | {color:black} {color} |\r\n\\\\\r\n\\\\\r\n|| Reason || Tests ||\r\n| Failed junit tests | hadoop.security.ssl.TestSSLFactory |\r\n|   | hadoop.net.TestClusterTopology |\r\n\\\\\r\n\\\\\r\n|| Subsystem || Report/Notes ||\r\n| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:8f97d6f |\r\n| JIRA Issue | HDFS-14181 |\r\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12953324/0001-add-UT-for-NetworkTopology.patch |\r\n| Optional Tests |  dupname  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  findbugs  checkstyle  |\r\n| uname | Linux 7755e7eaeff4 3.13.0-153-generic #203-Ubuntu SMP Thu Jun 14 08:52:28 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux |\r\n| Build tool | maven |\r\n| Personality | /testptch/patchprocess/precommit/personality/provided.sh |\r\n| git revision | trunk / e9a005d |\r\n| maven | version: Apache Maven 3.3.9 |\r\n| Default Java | 1.8.0_191 |\r\n| findbugs | v3.1.0-RC1 |\r\n| unit | https://builds.apache.org/job/PreCommit-HDFS-Build/25878/artifact/out/patch-unit-hadoop-common-project_hadoop-common.txt |\r\n|  Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/25878/testReport/ |\r\n| Max. process+thread count | 1346 (vs. ulimit of 10000) |\r\n| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\r\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/25878/console |\r\n| Powered by | Apache Yetus 0.8.0   http://yetus.apache.org |\r\n\r\n\r\nThis message was automatically generated.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-30T05:37:16.790+0000","updated":"2018-12-30T05:37:16.790+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16730958","id":"16730958","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hexiaoqiao","name":"hexiaoqiao","key":"hexiaoqiao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hexiaoqiao&avatarId=26980","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hexiaoqiao&avatarId=26980","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hexiaoqiao&avatarId=26980","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hexiaoqiao&avatarId=26980"},"displayName":"He Xiaoqiao","active":true,"timeZone":"Asia/Shanghai"},"body":"[~sihai] Thanks for your reporting, I think it may be not bug, since {{NetworkTopology#chooseRandom(final String scope, String excludedScope, final Collection<Node> excludedNodes)}} is protect method, and invoke by {{NetworkTopology#chooseRandom(final String scope, final Collection<Node> excludedNodes)}} only, which code as following, and the unit test you attached could not appear.\r\n{code:java}\r\n  public Node chooseRandom(final String scope,\r\n      final Collection<Node> excludedNodes) {\r\n    netlock.readLock().lock();\r\n    try {\r\n      if (scope.startsWith(\"~\")) {\r\n        return chooseRandom(NodeBase.ROOT, scope.substring(1), excludedNodes);\r\n      } else {\r\n        return chooseRandom(scope, null, excludedNodes);\r\n      }\r\n    } finally {\r\n      netlock.readLock().unlock();\r\n    }\r\n  }\r\n{code}\r\nI think it may be a fix type to change the method {{NetworkTopology#chooseRandom(final String scope, String excludedScope, final Collection<Node> excludedNodes)}} access scope from {{protected}} to {{private}}.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hexiaoqiao","name":"hexiaoqiao","key":"hexiaoqiao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hexiaoqiao&avatarId=26980","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hexiaoqiao&avatarId=26980","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hexiaoqiao&avatarId=26980","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hexiaoqiao&avatarId=26980"},"displayName":"He Xiaoqiao","active":true,"timeZone":"Asia/Shanghai"},"created":"2018-12-30T11:52:54.934+0000","updated":"2018-12-30T11:52:54.934+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731011","id":"16731011","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"body":"hi [~hexiaoqiao], thanks for your comments, I think why this bug is not triggered is as you said, this method is called only be the method mentioned by you && the scope is *NodeBase.ROOT*, and it doesn't have prod affection, but does that mean it is not a bug ? let's clarify the logic:\r\n # variable *availableNodes* is calculated by below code (focus on else situation), and will be used in fucntion *chooseRandom*\r\n\r\n{code:java}\r\n  final int availableNodes;\r\n  if (excludedScope == null) {\r\n    availableNodes = countNumOfAvailableNodes(scope, excludedNodes);\r\n  } else {\r\n    availableNodes =\r\n        countNumOfAvailableNodes(\"~\" + excludedScope, excludedNodes);\r\n  }\r\n  LOG.debug(\"Choosing random from {} available nodes on node {},\"\r\n      + \" scope={}, excludedScope={}, excludeNodes={}. numOfDatanodes={}.\",\r\n      availableNodes, innerNode, scope, excludedScope, excludedNodes,\r\n      numOfDatanodes);\r\n  Node ret = null;\r\n  if (availableNodes > 0) {\r\n    ret = chooseRandom(innerNode, node, excludedNodes, numOfDatanodes,\r\n        availableNodes);\r\n  }\r\n  LOG.debug(\"chooseRandom returning {}\", ret);\r\n  return ret;\r\n}\r\n{code}\r\n \r\n\r\n    2. In function chooseRandom,  *availableNodes stands for the nodes under parentNode that could be choosen,  i think there is a logic gap between these two function, ,*\r\n\r\n       *a.  Scope is substring of excludedScope.*\r\n\r\n       *b.* ~excludedScope *equals to* nodes under Scope and not in excludedScope *??? (I think here is the bug.)*\r\n\r\n       *c.* #b is true when scope is root.\r\n\r\nand the UT is one case will trigger this bug. and one thing important is it will throw exception, and means failed to choose node for data.\r\n{code:java}\r\n/**\r\n * Randomly choose one node under <i>parentNode</i>, considering the exclude\r\n * nodes and scope. Should be called with {@link #netlock}'s readlock held.\r\n *\r\n * @param parentNode        the parent node\r\n * @param excludedScopeNode the node corresponding to the exclude scope.\r\n * @param excludedNodes     a collection of nodes to be excluded from\r\n * @param totalInScopeNodes total number of nodes under parentNode, excluding\r\n *                          the excludedScopeNode\r\n * @param availableNodes    number of available nodes under parentNode that\r\n *                          could be chosen, excluding excludedNodes\r\n * @return the chosen node, or null if none can be chosen\r\n */\r\nprivate Node chooseRandom(final InnerNode parentNode,\r\n    final Node excludedScopeNode, final Collection<Node> excludedNodes,\r\n    final int totalInScopeNodes, final int availableNodes) {\r\n  Preconditions.checkArgument(\r\n      totalInScopeNodes >= availableNodes && availableNodes > 0, String\r\n          .format(\"%d should >= %d, and both should be positive.\",\r\n              totalInScopeNodes, availableNodes));\r\n  if (excludedNodes == null || excludedNodes.isEmpty()) {\r\n    // if there are no excludedNodes, randomly choose a node\r\n    final int index = r.nextInt(totalInScopeNodes);\r\n    return parentNode.getLeaf(index, excludedScopeNode);\r\n  }\r\n{code}\r\n \r\n\r\n3. For changing the method from protect to private, could we refine the logic, my thought is this method is general, so when other class who extend this class could reuse the logic.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-30T16:22:22.198+0000","updated":"2018-12-30T16:25:05.978+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731433","id":"16731433","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"body":"I see value on having a proper use of this method instead of just hiding it behind a restricted use.\r\n[~sihai] can you post a patch with your proposal for the fix and we start from there?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"created":"2018-12-31T19:28:21.441+0000","updated":"2018-12-31T19:28:21.441+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731528","id":"16731528","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"body":"[~elgoiri] I have added another patch _0001-fix-NetworkTopology.java-chooseRandom-bug.patch_, could you help to have a look ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-01T06:20:54.250+0000","updated":"2019-01-01T06:20:54.250+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731538","id":"16731538","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\r\n\\\\\r\n\\\\\r\n|| Vote || Subsystem || Runtime || Comment ||\r\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 13s{color} | {color:blue} Docker mode activated. {color} |\r\n|| || || || {color:brown} Prechecks {color} ||\r\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\r\n| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |\r\n|| || || || {color:brown} trunk Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 18m 36s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 14m 36s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 50s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 11s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 13m 29s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 40s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 58s{color} | {color:green} trunk passed {color} |\r\n|| || || || {color:brown} Patch Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 45s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 14m  2s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 14m  2s{color} | {color:green} the patch passed {color} |\r\n| {color:orange}-0{color} | {color:orange} checkstyle {color} | {color:orange}  0m 50s{color} | {color:orange} hadoop-common-project/hadoop-common: The patch generated 1 new + 40 unchanged - 0 fixed = 41 total (was 40) {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  9s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 11m 16s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 47s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 59s{color} | {color:green} the patch passed {color} |\r\n|| || || || {color:brown} Other Tests {color} ||\r\n| {color:red}-1{color} | {color:red} unit {color} | {color:red}  7m 24s{color} | {color:red} hadoop-common in the patch failed. {color} |\r\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 39s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\r\n| {color:black}{color} | {color:black} {color} | {color:black} 90m 14s{color} | {color:black} {color} |\r\n\\\\\r\n\\\\\r\n|| Reason || Tests ||\r\n| Failed junit tests | hadoop.security.ssl.TestSSLFactory |\r\n\\\\\r\n\\\\\r\n|| Subsystem || Report/Notes ||\r\n| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:8f97d6f |\r\n| JIRA Issue | HDFS-14181 |\r\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12953411/0001-fix-NetworkTopology.java-chooseRandom-bug.patch |\r\n| Optional Tests |  dupname  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  findbugs  checkstyle  |\r\n| uname | Linux 5b3d6deb2032 4.4.0-139-generic #165-Ubuntu SMP Wed Oct 24 10:58:50 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux |\r\n| Build tool | maven |\r\n| Personality | /testptch/patchprocess/precommit/personality/provided.sh |\r\n| git revision | trunk / eee29ed |\r\n| maven | version: Apache Maven 3.3.9 |\r\n| Default Java | 1.8.0_191 |\r\n| findbugs | v3.1.0-RC1 |\r\n| checkstyle | https://builds.apache.org/job/PreCommit-HDFS-Build/25880/artifact/out/diff-checkstyle-hadoop-common-project_hadoop-common.txt |\r\n| unit | https://builds.apache.org/job/PreCommit-HDFS-Build/25880/artifact/out/patch-unit-hadoop-common-project_hadoop-common.txt |\r\n|  Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/25880/testReport/ |\r\n| Max. process+thread count | 1464 (vs. ulimit of 10000) |\r\n| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\r\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/25880/console |\r\n| Powered by | Apache Yetus 0.8.0   http://yetus.apache.org |\r\n\r\n\r\nThis message was automatically generated.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-01T07:40:58.737+0000","updated":"2019-01-01T07:40:58.737+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731563","id":"16731563","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"body":"[~elgoiri] I updated the patch because code stype (code length is longer than 80), but didn't trigger a new build, how could I trigger a new build ? and there is a failed unit test but looks not caused by my change, could you help to have a look ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-01T10:25:51.736+0000","updated":"2019-01-01T10:25:51.736+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731570","id":"16731570","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ayushtkn","name":"ayushtkn","key":"ayushtkn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ayush Saxena","active":true,"timeZone":"Asia/Kolkata"},"body":"[~sihai] The build got triggered check https://builds.apache.org/job/PreCommit-HDFS-Build/25881/\r\n\r\nTestSSLFactory is not related already being tracked HADOOP-16016\r\n\r\nPls try to upload the patch with the patch num like HDFS-14181.01.patch and so on and no need to delete the older ones. :) ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ayushtkn","name":"ayushtkn","key":"ayushtkn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ayush Saxena","active":true,"timeZone":"Asia/Kolkata"},"created":"2019-01-01T10:55:57.636+0000","updated":"2019-01-01T10:55:57.636+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731573","id":"16731573","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"body":"[~ayushtkn] Sorry for the incorrect patch name format, I upload two patch HDFS-14181.01.patch && HDFS-14181.02.patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-01T11:22:47.143+0000","updated":"2019-01-01T11:22:47.143+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731580","id":"16731580","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\r\n\\\\\r\n\\\\\r\n|| Vote || Subsystem || Runtime || Comment ||\r\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 14s{color} | {color:blue} Docker mode activated. {color} |\r\n|| || || || {color:brown} Prechecks {color} ||\r\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\r\n| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |\r\n|| || || || {color:brown} trunk Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 18m 39s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 14m 52s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 52s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  5s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 12m 50s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 36s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 58s{color} | {color:green} trunk passed {color} |\r\n|| || || || {color:brown} Patch Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 46s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 15m 29s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 15m 29s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 40s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  1s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 10m 51s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 42s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m  2s{color} | {color:green} the patch passed {color} |\r\n|| || || || {color:brown} Other Tests {color} ||\r\n| {color:red}-1{color} | {color:red} unit {color} | {color:red}  8m  1s{color} | {color:red} hadoop-common in the patch failed. {color} |\r\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 30s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\r\n| {color:black}{color} | {color:black} {color} | {color:black} 90m 55s{color} | {color:black} {color} |\r\n\\\\\r\n\\\\\r\n|| Reason || Tests ||\r\n| Failed junit tests | hadoop.security.ssl.TestSSLFactory |\r\n\\\\\r\n\\\\\r\n|| Subsystem || Report/Notes ||\r\n| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:8f97d6f |\r\n| JIRA Issue | HDFS-14181 |\r\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12953420/0001-fix-NetworkTopology.java-chooseRandom-bug.patch |\r\n| Optional Tests |  dupname  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  findbugs  checkstyle  |\r\n| uname | Linux b0f3b497fe03 4.4.0-138-generic #164-Ubuntu SMP Tue Oct 2 17:16:02 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux |\r\n| Build tool | maven |\r\n| Personality | /testptch/patchprocess/precommit/personality/provided.sh |\r\n| git revision | trunk / eee29ed |\r\n| maven | version: Apache Maven 3.3.9 |\r\n| Default Java | 1.8.0_191 |\r\n| findbugs | v3.1.0-RC1 |\r\n| unit | https://builds.apache.org/job/PreCommit-HDFS-Build/25881/artifact/out/patch-unit-hadoop-common-project_hadoop-common.txt |\r\n|  Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/25881/testReport/ |\r\n| Max. process+thread count | 1374 (vs. ulimit of 10000) |\r\n| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\r\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/25881/console |\r\n| Powered by | Apache Yetus 0.8.0   http://yetus.apache.org |\r\n\r\n\r\nThis message was automatically generated.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-01T12:03:39.093+0000","updated":"2019-01-01T12:03:39.093+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731583","id":"16731583","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ayushtkn","name":"ayushtkn","key":"ayushtkn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ayush Saxena","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanx [~sihai] for the patch.\r\n\r\nI too agree with [~elgoiri] that we should implement the correct way.\r\n\r\nI tried digging into the problem.\r\n\r\nThats something what I understood of the scenario.Let me Know If I get it wrong somewhere.\r\n\r\nLet the setup be like ::\r\n\r\n(Cluster Map)\r\n 1 2 3 4 5 6 7 8 9 10\r\n\r\n1-8 is scope\r\n\r\n1-4 is excluded scope\r\n\r\n2 and 7 is excluded node\r\n * *Present Scenario ::*\r\n\r\nAvlbl node (Present)--> 5,6,8,9,10 (5)\r\n\r\n_{Cluster Map - Excluded Scope and Excluded nodes out of Excluded Scope} \\{ 10 - 4 - 1 = 5}_\r\n\r\n \r\n\r\nAvlbl node (Expected) ---> 5,6,8 (*3*)\r\n\r\n_{Scope - Exclude Scope - Excluded nodes out of Excluded Scope but in scope }_\r\n\r\n \r\n\r\n{ 8 - 4 - 1 = 3}\r\n * *Proposed Solution ::*\r\n\r\nPart1 --> 1,3,4,5,6,8 (6)\r\n\r\n_{Scope - Excluded Nodes in scope}_\r\n\r\nPart2 --> 1,3,4 (3)\r\n\r\n_{Excluded Scope - Excluded Nodes in Excluded Scope }_\r\n\r\n*Solution Received* =\r\n\r\n{ Part1 - Part2 }\r\n\r\n6-3 = *3* (*Correct*)\r\n\r\nBy my understanding the solution seems correct.  :)\r\n Just I guess If we are expecting this method to be called from somewhere else too.We can add a NULL check for scope too in the else part for safety as before scope wasn't being used in the block. Secondly Am not very sure regarding taking the read Lock.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ayushtkn","name":"ayushtkn","key":"ayushtkn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ayush Saxena","active":true,"timeZone":"Asia/Kolkata"},"created":"2019-01-01T12:22:40.375+0000","updated":"2019-01-01T12:22:40.375+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731595","id":"16731595","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\r\n\\\\\r\n\\\\\r\n|| Vote || Subsystem || Runtime || Comment ||\r\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 13s{color} | {color:blue} Docker mode activated. {color} |\r\n|| || || || {color:brown} Prechecks {color} ||\r\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\r\n| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |\r\n|| || || || {color:brown} trunk Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 18m 21s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 14m 34s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 40s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  7s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 12m 21s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 32s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 53s{color} | {color:green} trunk passed {color} |\r\n|| || || || {color:brown} Patch Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 44s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 14m 19s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 14m 19s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 46s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  1s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 11m 10s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 42s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 59s{color} | {color:green} the patch passed {color} |\r\n|| || || || {color:brown} Other Tests {color} ||\r\n| {color:red}-1{color} | {color:red} unit {color} | {color:red}  7m 58s{color} | {color:red} hadoop-common in the patch failed. {color} |\r\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 29s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\r\n| {color:black}{color} | {color:black} {color} | {color:black} 88m 46s{color} | {color:black} {color} |\r\n\\\\\r\n\\\\\r\n|| Reason || Tests ||\r\n| Failed junit tests | hadoop.security.ssl.TestSSLFactory |\r\n\\\\\r\n\\\\\r\n|| Subsystem || Report/Notes ||\r\n| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:8f97d6f |\r\n| JIRA Issue | HDFS-14181 |\r\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12953432/HDFS-14181.02.patch |\r\n| Optional Tests |  dupname  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  findbugs  checkstyle  |\r\n| uname | Linux bec43a5e4ee2 4.4.0-138-generic #164-Ubuntu SMP Tue Oct 2 17:16:02 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux |\r\n| Build tool | maven |\r\n| Personality | /testptch/patchprocess/precommit/personality/provided.sh |\r\n| git revision | trunk / eee29ed |\r\n| maven | version: Apache Maven 3.3.9 |\r\n| Default Java | 1.8.0_191 |\r\n| findbugs | v3.1.0-RC1 |\r\n| unit | https://builds.apache.org/job/PreCommit-HDFS-Build/25882/artifact/out/patch-unit-hadoop-common-project_hadoop-common.txt |\r\n|  Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/25882/testReport/ |\r\n| Max. process+thread count | 1372 (vs. ulimit of 10000) |\r\n| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\r\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/25882/console |\r\n| Powered by | Apache Yetus 0.8.0   http://yetus.apache.org |\r\n\r\n\r\nThis message was automatically generated.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-01T13:43:46.223+0000","updated":"2019-01-01T13:43:46.223+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731667","id":"16731667","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~sihai] can you post the patch with both the fix and the unit test?\r\n BTW, in  [^HDFS-14181.02.patch], I'm not sure there's a need to lock as the function already does it. I guess the point is to the subtraction all together without anybody writing in between.\r\nMaybe we should to a finally?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-01T18:48:13.891+0000","updated":"2019-01-01T18:52:55.461+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731737","id":"16731737","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"body":"[~elgoiri] I have uploaded a patch HDFS-14181.03.patch which contain both the fix and the unit test, could you help to have a look ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-02T02:34:55.825+0000","updated":"2019-01-02T02:36:08.347+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731749","id":"16731749","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hexiaoqiao","name":"hexiaoqiao","key":"hexiaoqiao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hexiaoqiao&avatarId=26980","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hexiaoqiao&avatarId=26980","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hexiaoqiao&avatarId=26980","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hexiaoqiao&avatarId=26980"},"displayName":"He Xiaoqiao","active":true,"timeZone":"Asia/Shanghai"},"body":"[~elgoiri][~sihai] Thanks for your corrected comments.\r\n[^HDFS-14181.03.patch] almost looks good to me. some minor comments from me:\r\n1. it may be not necessary to add lock since already does it. +1\r\n2. to [~sihai], could you submit patch rebase trunk branch, trunk flawed as above.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hexiaoqiao","name":"hexiaoqiao","key":"hexiaoqiao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hexiaoqiao&avatarId=26980","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hexiaoqiao&avatarId=26980","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hexiaoqiao&avatarId=26980","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hexiaoqiao&avatarId=26980"},"displayName":"He Xiaoqiao","active":true,"timeZone":"Asia/Shanghai"},"created":"2019-01-02T03:26:12.976+0000","updated":"2019-01-02T03:26:12.976+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731763","id":"16731763","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"body":"[~hexiaoqiao]  [~elgoiri] [~ayushtkn] thanks for comments, I think the read lock is needed, below is my thought.\r\n # we want to count node number under in scope, but not in excludeScope. assume the excludedNodes is null. then we call  \r\n availableNodes = countNumOfAvailableNodes(scope, excludedNodes) - countNumOfAvailableNodes(excludedScope, excludedNodes);\r\n we could split it to two steps:\r\n step 1: countNumOfAvailableNodes(scope, excludedNodes);              // num under scope\r\n step 2: countNumOfAvailableNodes(excludedScope, excludedNodes); // num under excludedScope.\r\n # if we don't add lock for step1 and step2, after step1, if more nodes are added to excludeScope, we will find step2 result is larger than step1, which shouldn't happen.\r\n # In order to trigger the bug that caused of no read lock, I upload a patch HDFS-14181.04.patch. which will be discarded in the futhre.\r\n\r\ncurrently: HDFS-14181.03.patch is the solution that I proposed, and HDFS-14181.04.patch is the code change that approve lock is needed. and will be discarded in the future.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-02T04:48:07.669+0000","updated":"2019-01-02T04:50:11.937+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731784","id":"16731784","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"body":"[~hexiaoqiao]  [~elgoiri] [~ayushtkn] I add another patch HDFS-14181.05.patch it contain the fix and unit test and is from trunck branch, is there any other concern ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-02T06:14:58.906+0000","updated":"2019-01-02T06:14:58.906+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731810","id":"16731810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\r\n\\\\\r\n\\\\\r\n|| Vote || Subsystem || Runtime || Comment ||\r\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 11s{color} | {color:blue} Docker mode activated. {color} |\r\n|| || || || {color:brown} Prechecks {color} ||\r\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\r\n| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 1 new or modified test files. {color} |\r\n|| || || || {color:brown} trunk Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 18m 30s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 14m 51s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 47s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  7s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 13m  4s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 36s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 53s{color} | {color:green} trunk passed {color} |\r\n|| || || || {color:brown} Patch Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 44s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 14m 14s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 14m 14s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 47s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  3s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 10m 38s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 42s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 59s{color} | {color:green} the patch passed {color} |\r\n|| || || || {color:brown} Other Tests {color} ||\r\n| {color:red}-1{color} | {color:red} unit {color} | {color:red}  7m 23s{color} | {color:red} hadoop-common in the patch failed. {color} |\r\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 38s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\r\n| {color:black}{color} | {color:black} {color} | {color:black} 89m  1s{color} | {color:black} {color} |\r\n\\\\\r\n\\\\\r\n|| Reason || Tests ||\r\n| Failed junit tests | hadoop.security.ssl.TestSSLFactory |\r\n\\\\\r\n\\\\\r\n|| Subsystem || Report/Notes ||\r\n| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:8f97d6f |\r\n| JIRA Issue | HDFS-14181 |\r\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12953474/HDFS-14181.05.patch |\r\n| Optional Tests |  dupname  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  findbugs  checkstyle  |\r\n| uname | Linux 932047a91861 4.4.0-139-generic #165-Ubuntu SMP Wed Oct 24 10:58:50 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux |\r\n| Build tool | maven |\r\n| Personality | /testptch/patchprocess/precommit/personality/provided.sh |\r\n| git revision | trunk / eee29ed |\r\n| maven | version: Apache Maven 3.3.9 |\r\n| Default Java | 1.8.0_191 |\r\n| findbugs | v3.1.0-RC1 |\r\n| unit | https://builds.apache.org/job/PreCommit-HDFS-Build/25887/artifact/out/patch-unit-hadoop-common-project_hadoop-common.txt |\r\n|  Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/25887/testReport/ |\r\n| Max. process+thread count | 1472 (vs. ulimit of 10000) |\r\n| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\r\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/25887/console |\r\n| Powered by | Apache Yetus 0.8.0   http://yetus.apache.org |\r\n\r\n\r\nThis message was automatically generated.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-02T07:49:39.886+0000","updated":"2019-01-02T07:49:39.886+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16731828","id":"16731828","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hexiaoqiao","name":"hexiaoqiao","key":"hexiaoqiao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hexiaoqiao&avatarId=26980","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hexiaoqiao&avatarId=26980","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hexiaoqiao&avatarId=26980","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hexiaoqiao&avatarId=26980"},"displayName":"He Xiaoqiao","active":true,"timeZone":"Asia/Shanghai"},"body":"[~sihai], Thanks for your work, as you mentioned before, read lock is necessary, It can protect both {{clusterMap}} and {{excludedNodes}} changed between double {{countNumOfAvailableNodes}} calc, another, {{netlock}} is reentrant lock, so it is ok for me. ping [~elgoiri],[~ayushtkn] please double check.\r\nTo [~sihai], rename new unit test method (#testChooseRandom1) to more comprehensible may be better. FYI.\r\n+1 LGTM after update on [^HDFS-14181.05.patch].","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hexiaoqiao","name":"hexiaoqiao","key":"hexiaoqiao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hexiaoqiao&avatarId=26980","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hexiaoqiao&avatarId=26980","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hexiaoqiao&avatarId=26980","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hexiaoqiao&avatarId=26980"},"displayName":"He Xiaoqiao","active":true,"timeZone":"Asia/Shanghai"},"created":"2019-01-02T08:19:22.061+0000","updated":"2019-01-02T08:19:22.061+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16732230","id":"16732230","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ayushtkn","name":"ayushtkn","key":"ayushtkn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ayush Saxena","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~sihai] for the great work here.\r\n\r\nAs [~hexiaoqiao] mentioned {{netlock}} is reentrant lock so I too think there shouldn't be any problem.\r\n\r\n\r\n Just one minor suggestion ::  \r\n{code:java}\r\n+    Node node = cluster.chooseRandom(\"/a1/b1\", \"/a1/b1/c1\", null);\r\n{code}\r\nCan we have a node in the excludedNodes too instead of passing null?\r\n\r\nOther than this the v5 Looks Good :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ayushtkn","name":"ayushtkn","key":"ayushtkn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ayush Saxena","active":true,"timeZone":"Asia/Kolkata"},"created":"2019-01-02T17:03:17.671+0000","updated":"2019-01-02T17:03:17.671+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16732232","id":"16732232","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"body":"* The reentrant lock should be fine; both places have finally so a exception would release both.\r\n* I also prefer calling the method something different, maybe {{testChooseRandomExcluded()}}?\r\n* As [~ayushtkn] mentioned, we should add a test without the null (I would also leave the one with null and test both).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-02T17:16:23.632+0000","updated":"2019-01-02T17:16:23.632+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16732304","id":"16732304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"body":"Sorry for the late response, just got back from vacation. The fix seems correct, v005 patch LGTM. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vagarychen","name":"vagarychen","key":"vagarychen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=34058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"},"displayName":"Chen Liang","active":true,"timeZone":"America/Los_Angeles"},"created":"2019-01-02T18:41:37.286+0000","updated":"2019-01-02T18:41:37.286+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16732672","id":"16732672","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"body":"[~elgoiri] [~hexiaoqiao]  [~ayushtkn]  thanks for comments, I upload a new patch HDFS-14181.06.patch with below changes for trunk branch, any other suggesstions ?\r\n # rename test function to testChooseRandomExcluded().\r\n # add more test case, such as excludedNodes is not null, excludedNodes is under scope and so on.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-03T05:10:05.445+0000","updated":"2019-01-03T05:12:21.399+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16732734","id":"16732734","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ayushtkn","name":"ayushtkn","key":"ayushtkn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ayush Saxena","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~sihai] for the patch!!!\r\n\r\nI guess the build failed in the precommit \r\n\r\n[https://builds.apache.org/job/PreCommit-HDFS-Build/25899/console]\r\n\r\nI have reported it at HADOOP-16003.\r\n\r\nIt is not related to the patch.\r\n\r\nCan you re-upload the same patch to trigger the Jenkins.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ayushtkn","name":"ayushtkn","key":"ayushtkn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ayush Saxena","active":true,"timeZone":"Asia/Kolkata"},"created":"2019-01-03T07:48:37.579+0000","updated":"2019-01-03T07:48:37.579+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16732940","id":"16732940","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"body":"[~ayushtkn] I upload a patch HDFS-14181.07.patch which is same as HDFS-14181.06.patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-03T11:23:10.033+0000","updated":"2019-01-03T11:23:10.033+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16733011","id":"16733011","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\r\n\\\\\r\n\\\\\r\n|| Vote || Subsystem || Runtime || Comment ||\r\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 16s{color} | {color:blue} Docker mode activated. {color} |\r\n|| || || || {color:brown} Prechecks {color} ||\r\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\r\n| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 1 new or modified test files. {color} |\r\n|| || || || {color:brown} trunk Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 19m 58s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 15m 51s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 52s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 12s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 14m 13s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 35s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 59s{color} | {color:green} trunk passed {color} |\r\n|| || || || {color:brown} Patch Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 48s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 15m 14s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 15m 14s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 51s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 10s{color} | {color:green} the patch passed {color} |\r\n| {color:red}-1{color} | {color:red} whitespace {color} | {color:red}  0m  0s{color} | {color:red} The patch has 1 line(s) that end in whitespace. Use git apply --whitespace=fix <<patch_file>>. Refer https://git-scm.com/docs/git-apply {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 12m  5s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 46s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 59s{color} | {color:green} the patch passed {color} |\r\n|| || || || {color:brown} Other Tests {color} ||\r\n| {color:red}-1{color} | {color:red} unit {color} | {color:red}  9m  4s{color} | {color:red} hadoop-common in the patch failed. {color} |\r\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 44s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\r\n| {color:black}{color} | {color:black} {color} | {color:black} 97m 24s{color} | {color:black} {color} |\r\n\\\\\r\n\\\\\r\n|| Reason || Tests ||\r\n| Failed junit tests | hadoop.security.ssl.TestSSLFactory |\r\n\\\\\r\n\\\\\r\n|| Subsystem || Report/Notes ||\r\n| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:8f97d6f |\r\n| JIRA Issue | HDFS-14181 |\r\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12953613/HDFS-14181.07.patch |\r\n| Optional Tests |  dupname  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  findbugs  checkstyle  |\r\n| uname | Linux 4dfa4aeb7adb 3.13.0-153-generic #203-Ubuntu SMP Thu Jun 14 08:52:28 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux |\r\n| Build tool | maven |\r\n| Personality | /testptch/patchprocess/precommit/personality/provided.sh |\r\n| git revision | trunk / cb26f15 |\r\n| maven | version: Apache Maven 3.3.9 |\r\n| Default Java | 1.8.0_191 |\r\n| findbugs | v3.1.0-RC1 |\r\n| whitespace | https://builds.apache.org/job/PreCommit-HDFS-Build/25902/artifact/out/whitespace-eol.txt |\r\n| unit | https://builds.apache.org/job/PreCommit-HDFS-Build/25902/artifact/out/patch-unit-hadoop-common-project_hadoop-common.txt |\r\n|  Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/25902/testReport/ |\r\n| Max. process+thread count | 1349 (vs. ulimit of 10000) |\r\n| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\r\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/25902/console |\r\n| Powered by | Apache Yetus 0.8.0   http://yetus.apache.org |\r\n\r\n\r\nThis message was automatically generated.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-03T13:08:09.017+0000","updated":"2019-01-03T13:08:09.017+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16733134","id":"16733134","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"body":"Sorry for there is a white space line, I upload a new patch HDFS-14181.08.patch, and will find a way to check the patch before I upload a patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-03T15:07:43.169+0000","updated":"2019-01-03T15:07:43.169+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16733184","id":"16733184","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\r\n\\\\\r\n\\\\\r\n|| Vote || Subsystem || Runtime || Comment ||\r\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 19s{color} | {color:blue} Docker mode activated. {color} |\r\n|| || || || {color:brown} Prechecks {color} ||\r\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\r\n| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 1 new or modified test files. {color} |\r\n|| || || || {color:brown} trunk Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 23m 13s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 16m 50s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 53s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 17s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 14m 29s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 49s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  1m  7s{color} | {color:green} trunk passed {color} |\r\n|| || || || {color:brown} Patch Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 55s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 16m 28s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 16m 28s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 55s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 15s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 12m 18s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 41s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 59s{color} | {color:green} the patch passed {color} |\r\n|| || || || {color:brown} Other Tests {color} ||\r\n| {color:red}-1{color} | {color:red} unit {color} | {color:red}  8m 36s{color} | {color:red} hadoop-common in the patch failed. {color} |\r\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 40s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\r\n| {color:black}{color} | {color:black} {color} | {color:black}103m 24s{color} | {color:black} {color} |\r\n\\\\\r\n\\\\\r\n|| Reason || Tests ||\r\n| Failed junit tests | hadoop.security.ssl.TestSSLFactory |\r\n\\\\\r\n\\\\\r\n|| Subsystem || Report/Notes ||\r\n| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:8f97d6f |\r\n| JIRA Issue | HDFS-14181 |\r\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12953641/HDFS-14181.08.patch |\r\n| Optional Tests |  dupname  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  findbugs  checkstyle  |\r\n| uname | Linux 2c326f5cb117 3.13.0-153-generic #203-Ubuntu SMP Thu Jun 14 08:52:28 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux |\r\n| Build tool | maven |\r\n| Personality | /testptch/patchprocess/precommit/personality/provided.sh |\r\n| git revision | trunk / 040a202 |\r\n| maven | version: Apache Maven 3.3.9 |\r\n| Default Java | 1.8.0_191 |\r\n| findbugs | v3.1.0-RC1 |\r\n| unit | https://builds.apache.org/job/PreCommit-HDFS-Build/25904/artifact/out/patch-unit-hadoop-common-project_hadoop-common.txt |\r\n|  Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/25904/testReport/ |\r\n| Max. process+thread count | 1346 (vs. ulimit of 10000) |\r\n| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\r\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/25904/console |\r\n| Powered by | Apache Yetus 0.8.0   http://yetus.apache.org |\r\n\r\n\r\nThis message was automatically generated.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-03T16:14:05.714+0000","updated":"2019-01-03T16:14:05.714+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16733581","id":"16733581","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"body":"[^HDFS-14181.08.patch] looks pretty much it.\r\nCan you avoid the import change in TestClusterTopology?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-03T22:22:13.724+0000","updated":"2019-01-03T22:22:13.724+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16733801","id":"16733801","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"body":"[~elgoiri] sorry for the import change, I upload a new patch [HDFS-14181.09.patch|https://issues.apache.org/jira/secure/attachment/12953698/HDFS-14181.09.patch], I only add one import: import java.util.Arrays, which will be used in the code","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sihai","name":"sihai","key":"sihai","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sihai Ke","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-04T03:37:04.827+0000","updated":"2019-01-04T05:10:49.102+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16733833","id":"16733833","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\r\n\\\\\r\n\\\\\r\n|| Vote || Subsystem || Runtime || Comment ||\r\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 18s{color} | {color:blue} Docker mode activated. {color} |\r\n|| || || || {color:brown} Prechecks {color} ||\r\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\r\n| {color:green}+1{color} | {color:green} test4tests {color} | {color:green}  0m  0s{color} | {color:green} The patch appears to include 1 new or modified test files. {color} |\r\n|| || || || {color:brown} trunk Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 22m 54s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 17m 57s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 50s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 18s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 13m 54s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 44s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 59s{color} | {color:green} trunk passed {color} |\r\n|| || || || {color:brown} Patch Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 55s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 17m 20s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 17m 20s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 47s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 13s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 11m 43s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 58s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 59s{color} | {color:green} the patch passed {color} |\r\n|| || || || {color:brown} Other Tests {color} ||\r\n| {color:red}-1{color} | {color:red} unit {color} | {color:red}  9m 26s{color} | {color:red} hadoop-common in the patch failed. {color} |\r\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 36s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\r\n| {color:black}{color} | {color:black} {color} | {color:black}104m 22s{color} | {color:black} {color} |\r\n\\\\\r\n\\\\\r\n|| Reason || Tests ||\r\n| Failed junit tests | hadoop.security.ssl.TestSSLFactory |\r\n\\\\\r\n\\\\\r\n|| Subsystem || Report/Notes ||\r\n| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:8f97d6f |\r\n| JIRA Issue | HDFS-14181 |\r\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12953698/HDFS-14181.09.patch |\r\n| Optional Tests |  dupname  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  findbugs  checkstyle  |\r\n| uname | Linux fe9eced9b2cd 3.13.0-153-generic #203-Ubuntu SMP Thu Jun 14 08:52:28 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux |\r\n| Build tool | maven |\r\n| Personality | /testptch/patchprocess/precommit/personality/provided.sh |\r\n| git revision | trunk / dfceffa |\r\n| maven | version: Apache Maven 3.3.9 |\r\n| Default Java | 1.8.0_191 |\r\n| findbugs | v3.1.0-RC1 |\r\n| unit | https://builds.apache.org/job/PreCommit-HDFS-Build/25915/artifact/out/patch-unit-hadoop-common-project_hadoop-common.txt |\r\n|  Test Results | https://builds.apache.org/job/PreCommit-HDFS-Build/25915/testReport/ |\r\n| Max. process+thread count | 1348 (vs. ulimit of 10000) |\r\n| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\r\n| Console output | https://builds.apache.org/job/PreCommit-HDFS-Build/25915/console |\r\n| Powered by | Apache Yetus 0.8.0   http://yetus.apache.org |\r\n\r\n\r\nThis message was automatically generated.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-04T05:24:56.260+0000","updated":"2019-01-04T05:24:56.260+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16734367","id":"16734367","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~sihai] for  [^HDFS-14181.09.patch].\r\nIt looks good to me.\r\nThe failed unit test is unrelated and already tracked in another JIRA.\r\n+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-04T17:30:22.544+0000","updated":"2019-01-04T17:30:22.544+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16734413","id":"16734413","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"body":"Thanks [~sihai] for the fix.\r\nCommitted it to trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elgoiri","name":"elgoiri","key":"elgoiri","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Íñigo Goiri","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-04T17:58:45.161+0000","updated":"2019-01-04T17:58:45.161+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13206902/comment/16734429","id":"16734429","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #15705 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/15705/])\nHADOOP-16028. Fix NetworkTopology chooseRandom function to support (inigoiri: rev f4e18242bd8117a5c506ec6d3f25c85011fa82d0)\n* (edit) hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/net/TestClusterTopology.java\n* (edit) hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/net/NetworkTopology.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2019-01-04T18:12:14.132+0000","updated":"2019-01-04T18:12:14.132+0000"}],"maxResults":36,"total":36,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-16028/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|u00dwo:"}}