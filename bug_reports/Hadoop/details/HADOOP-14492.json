{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13077533","self":"https://issues.apache.org/jira/rest/api/2/issue/13077533","key":"HADOOP-14492","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2017-06-06T22:39:02.501+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jun 07 18:24:22 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_143838527_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2017-06-07T18:24:55.010+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-14492/watchers","watchCount":4,"isWatching":false},"created":"2017-06-06T02:27:36.514+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329058","id":"12329058","description":"2.8.0 release","name":"2.8.0","archived":false,"released":true,"releaseDate":"2017-03-22"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335546","id":"12335546","description":"2.7.4 release","name":"2.7.4","archived":false,"released":true,"releaseDate":"2017-08-04"}],"issuelinks":[{"id":"12505944","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12505944","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13078072","key":"HADOOP-14502","self":"https://issues.apache.org/jira/rest/api/2/issue/13078072","fields":{"summary":"Confusion/name conflict between NameNodeActivity#BlockReportNumOps and RpcDetailedActivity#BlockReportNumOps","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xkrogen","name":"xkrogen","key":"xkrogen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xkrogen&avatarId=34526","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xkrogen&avatarId=34526","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xkrogen&avatarId=34526","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xkrogen&avatarId=34526"},"displayName":"Erik Krogen","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-06-07T18:25:11.621+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310971","id":"12310971","name":"metrics","description":""}],"timeoriginalestimate":null,"description":"For performance purpose, [HADOOP-13782|https://issues.apache.org/jira/browse/HADOOP-13782] change the metrics behaviour in {{RpcDetailedMetrics}}.\nIn 2.7.4:\n{code}\npublic class RpcDetailedMetrics {\n\n  @Metric MutableRatesWithAggregation rates;\n{code}\nIn old version:\n{code}\npublic class RpcDetailedMetrics {\n\n  @Metric MutableRates rates;\n{code}\n\nBut {{NameNodeMetrics}} still use {{MutableRate}} whatever in the new or old version:\n{code}\npublic class NameNodeMetrics {\n  @Metric(\"Block report\") MutableRate blockReport;\n{code}\n\nIt causes the metrics in JMX very different between them.\n{quote}\nname: \"Hadoop:service=NameNode,name=RpcDetailedActivityForPort8030\",\nmodelerType: \"RpcDetailedActivityForPort8030\",\ntag.port: \"8030\",\ntag.Context: \"rpcdetailed\",\n...\nBlockReportNumOps: 237634,\nBlockReportAvgTime: 1382,\n...\n\n\nname: \"Hadoop:service=NameNode,name=NameNodeActivity\",\nmodelerType: \"NameNodeActivity\",\ntag.ProcessName: \"NameNode\",\n...\nBlockReportNumOps: 2592932,\nBlockReportAvgTime: 19.258064516129032,\n...\n\n{quote}\nIn the old version. They are correct.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"RpcDetailedMetrics and NameNodeMetrics use different rate metrics abstraction cause the Xavgtime confused","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cltlfcjin","name":"cltlfcjin","key":"cltlfcjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cltlfcjin&avatarId=26058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cltlfcjin&avatarId=26058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cltlfcjin&avatarId=26058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cltlfcjin&avatarId=26058"},"displayName":"Lantao Jin","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cltlfcjin","name":"cltlfcjin","key":"cltlfcjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cltlfcjin&avatarId=26058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cltlfcjin&avatarId=26058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cltlfcjin&avatarId=26058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cltlfcjin&avatarId=26058"},"displayName":"Lantao Jin","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13077533/comment/16038202","id":"16038202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cltlfcjin","name":"cltlfcjin","key":"cltlfcjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cltlfcjin&avatarId=26058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cltlfcjin&avatarId=26058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cltlfcjin&avatarId=26058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cltlfcjin&avatarId=26058"},"displayName":"Lantao Jin","active":true,"timeZone":"Asia/Shanghai"},"body":"How about changing the {{NameNodeMetrics}} to use {{MutableRatesWithAggregation}} instead of {{MutableRates}}? \nAny idea? [~steve_l] [~zhz]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cltlfcjin","name":"cltlfcjin","key":"cltlfcjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cltlfcjin&avatarId=26058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cltlfcjin&avatarId=26058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cltlfcjin&avatarId=26058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cltlfcjin&avatarId=26058"},"displayName":"Lantao Jin","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-06T05:23:55.476+0000","updated":"2017-06-06T05:25:45.546+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13077533/comment/16039792","id":"16039792","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xkrogen","name":"xkrogen","key":"xkrogen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xkrogen&avatarId=34526","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xkrogen&avatarId=34526","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xkrogen&avatarId=34526","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xkrogen&avatarId=34526"},"displayName":"Erik Krogen","active":true,"timeZone":"America/Los_Angeles"},"body":"Hey [~cltlfcjin] - these metrics can be different since the RpcDetailed metric is the time to complete a DN's entire block report, which may include multiple storages (more than one value for {{dfs.datanode.data.dir}}), each of which contributes to the NameNodeActivity metric. In the cluster this was recorded from, do your datanodes run with multiple storages? Even without multiple storages, the AvgTime may be different because the RpcDetailed time is measured from different points in the code (e.g. it includes the time to acquire the FSNamesystem lock which the NameNodeActivity metric does not).\n\nAssigning to myself in case there is in fact a bug since HADOOP-13782 was my patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xkrogen","name":"xkrogen","key":"xkrogen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xkrogen&avatarId=34526","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xkrogen&avatarId=34526","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xkrogen&avatarId=34526","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xkrogen&avatarId=34526"},"displayName":"Erik Krogen","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-06T22:39:02.501+0000","updated":"2017-06-06T22:45:41.623+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13077533/comment/16040978","id":"16040978","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cltlfcjin","name":"cltlfcjin","key":"cltlfcjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cltlfcjin&avatarId=26058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cltlfcjin&avatarId=26058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cltlfcjin&avatarId=26058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cltlfcjin&avatarId=26058"},"displayName":"Lantao Jin","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks [~xkrogen] to explain. Yes, our DataNode run with multiple storages. Assigning to you is good. I think it better to use a different metrics name like {{WholeDNBlockReportAvgTime}}.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cltlfcjin","name":"cltlfcjin","key":"cltlfcjin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cltlfcjin&avatarId=26058","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cltlfcjin&avatarId=26058","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cltlfcjin&avatarId=26058","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cltlfcjin&avatarId=26058"},"displayName":"Lantao Jin","active":true,"timeZone":"Asia/Shanghai"},"created":"2017-06-07T14:37:19.461+0000","updated":"2017-06-07T14:37:19.461+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13077533/comment/16041372","id":"16041372","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xkrogen","name":"xkrogen","key":"xkrogen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xkrogen&avatarId=34526","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xkrogen&avatarId=34526","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xkrogen&avatarId=34526","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xkrogen&avatarId=34526"},"displayName":"Erik Krogen","active":true,"timeZone":"America/Los_Angeles"},"body":"[~cltlfcjin] I actually think that it is the {{NameNodeActivity}} metric which is named in a misleading way. The RpcDetailedMetric is named after the RPC call, which is in fact {{BlockReport}}. {{NameNodeActivity}} already has the metric {{StorageBlockReportOps}} which has a more clear naming (though it is a duplicate of {{BlockReportNumOps}}). It seems that we should deprecate {{NameNodeActivity#BlockReportNumOps}} and change {{StorageBlockReportOps}} to be a {{MutableRate}} to get both the count and the time, but this would be an incompatible change. Perhaps with the 3.0 release would be a good time. I filed a follow-on JIRA to discuss: HADOOP-14502. I will close this as JIRA as the original purpose (addressing {{MutableRate}} vs {{MutableRatesWithAggregation}}) is not an issue. Feel free to reopen if you disagree.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xkrogen","name":"xkrogen","key":"xkrogen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xkrogen&avatarId=34526","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xkrogen&avatarId=34526","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xkrogen&avatarId=34526","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xkrogen&avatarId=34526"},"displayName":"Erik Krogen","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-06-07T18:24:22.332+0000","updated":"2017-06-07T18:24:22.332+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-14492/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3fwjz:"}}