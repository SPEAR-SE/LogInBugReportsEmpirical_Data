{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12410981","self":"https://issues.apache.org/jira/rest/api/2/issue/12410981","key":"HADOOP-4913","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2009-05-19T16:31:11.533+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue May 19 16:31:11 UTC 2009","customfield_12310420":"126811","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_13132414707_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-05-19T16:31:11.547+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-4913/watchers","watchCount":2,"isWatching":false},"created":"2008-12-18T16:37:36.840+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313424","id":"12313424","description":"","name":"0.18.2","archived":false,"released":true,"releaseDate":"2008-11-03"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-07-08T17:05:23.985+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"I would like the output of my streaming job to only be the value, omitting the key and key/value separator.  However, when only printing the value I am noticing that each line is ending with a tab character.  I believe I have tracked down the issue (described below) but I'm not 100% sure.  The fix is working for me though so I figured maybe it should be incorporated into the code base.\n\nThe tab gets printed out because of a bad check in the TextOutputFormat code.  It checks if the \"key\" and \"value\" objects are null.  If they are both not null, then that means that the line should be printed as <key><separator><value>, otherwise it should only print the key or value, depending on what is defined.  The bug is that the key and value are always defined.  I traced up further to see if the error was that these objects were defined when they shouldn't be, but it looks like that's how it should work.  I changed the Hadoop code to look for a null object and also an empty string length.\n\n*** Patch code begin ***\n\nif( ! nullKey ) {\n  nullKey = ( key.toString().length() == 0 );\n}\nif( ! nullValue ) {\n  nullValue = ( value.toString().length() == 0 );\n}\n\n*** Patch code end ***\n\nThe OutputCollector calls the TextOutputFormat,write() method with whatever objects are passed into it (see ReduceTask.java, line 300) so that is fine.\n\nBut above that if you look at PipeMapRed.java, in the run() method you will see that the code creates a new key and value object and then starts reading lines and feeding them to the OutputCollector.  This is why the key and value are always defined by the time they hit the TextOutputFormat,write() and why we always see the tab.\n\nThanks,\nJohn","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"104024","customfield_12312823":null,"summary":"When using the Hadoop streaming jar if the reduce job outputs only a value (no key) the code incorrectly outputs the value along with the tab character (key/value) separator.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfisher365","name":"jfisher365","key":"jfisher365","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Fisher","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfisher365","name":"jfisher365","key":"jfisher365","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Fisher","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Red Hat Linux 5.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410981/comment/12710784","id":"12710784","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johanoskarsson","name":"johanoskarsson","key":"johanoskarsson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johan Oskarsson","active":true,"timeZone":"America/Los_Angeles"},"body":"You can do this in user code by implementing an output format that ignores the key and only saves the value. Have a look at TextOutputFormat for guidance.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johanoskarsson","name":"johanoskarsson","key":"johanoskarsson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Johan Oskarsson","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-05-19T16:31:11.533+0000","updated":"2009-05-19T16:31:11.533+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-4913/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0i5qn:"}}