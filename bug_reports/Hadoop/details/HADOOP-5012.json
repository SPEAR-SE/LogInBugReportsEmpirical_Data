{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12412121","self":"https://issues.apache.org/jira/rest/api/2/issue/12412121","key":"HADOOP-5012","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2009-01-12T19:39:19.611+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Jan 14 04:30:14 UTC 2009","customfield_12310420":"126878","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_297932612_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-01-14T04:30:14.612+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-5012/watchers","watchCount":3,"isWatching":false},"created":"2009-01-10T17:44:42.172+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-04-23T19:25:02.714+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"I found another source of corruption on our cluster.\n\n0) Three replicas of a block exist\n1) One is recognized as corrupt (3 reps total)\n2) Namenode decides to create a new replica.  Replication done and addStoredBlock is called (4 reps total)\n3) There are too many replicas, so processOverReplicatedBlock is called by addStoredBlock.\n4) processOverReplicatedBlock is called, and it decides do invalidate the newly created replica.  [Oddly enough, it decides to invalidate the newly created one instead of the one in the corrupted replicas map!]\n5) We are in the same state as (1) -- 3 replicas total, 1 of which is still bad.\n\nI believe we can fix this easily -- change numCurrentReplica variable to take into account the number of corrupt replicas.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12397626","id":"12397626","filename":"hadoop-5012.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bockelman","name":"bockelman","key":"bockelman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Bockelman","active":true,"timeZone":"America/Chicago"},"created":"2009-01-11T00:44:03.326+0000","size":785,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12397626/hadoop-5012.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"103958","customfield_12312823":null,"summary":"addStoredBlock should take into account corrupted blocks when determining excesses","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bockelman","name":"bockelman","key":"bockelman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Bockelman","active":true,"timeZone":"America/Chicago"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bockelman","name":"bockelman","key":"bockelman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Bockelman","active":true,"timeZone":"America/Chicago"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412121/comment/12662709","id":"12662709","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bockelman","name":"bockelman","key":"bockelman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Bockelman","active":true,"timeZone":"America/Chicago"},"body":"Patch for problem as described.\n\nI do have an example of this problem happening in a logfile if someone's interested.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bockelman","name":"bockelman","key":"bockelman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Bockelman","active":true,"timeZone":"America/Chicago"},"created":"2009-01-11T00:44:03.379+0000","updated":"2009-01-11T00:44:03.379+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412121/comment/12663062","id":"12663062","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"body":"Which version of Hadoop you are using? NumCurrentReplica does exclude corrupt replicas. Is it possible that your problem is caused by HADOOP-4742?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hairong","name":"hairong","key":"hairong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hairong Kuang","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-12T19:39:19.611+0000","updated":"2009-01-12T19:39:19.611+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412121/comment/12663621","id":"12663621","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bockelman","name":"bockelman","key":"bockelman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Bockelman","active":true,"timeZone":"America/Chicago"},"body":"Hey Hairong,\n\nThis is 0.19 + a few unrelated patches.\n\nI have attached the relevant logs below.  I guess this patch is another way of solving HADOOP-4742, as you point out.  It effectively does the same thing, but 4742 correctly identifies the source of the problem better.\n\nI'll close as a duplicate.\n\nBrian\n\nhadoop-root-namenode-hadoop-name.log.2009-01-05:2009-01-05\n18:38:58,399 WARN org.apache.hadoop.hdfs.server.namenode.FSNamesystem:\nInconsistent size for block blk_-1361380929156165877_44096 reported\nfrom 172.16.1.164:50010 current size is 67108864 reported size is 0\n\n18:38:58,399 WARN org.apache.hadoop.hdfs.server.namenode.FSNamesystem:\nMark new replica blk_-1361380929156165877_44096 from\n172.16.1.164:50010as corrupt because its length is shorter than\nexisting ones\n\nhadoop-root-namenode-hadoop-name.log.2009-01-05:2009-01-05\n18:38:58,399 INFO org.apache.hadoop.hdfs.StateChange: BLOCK\nNameSystem.addToCorruptReplicasMap: blk_-1361380929156165877 added as\ncorrupt on 172.16.1.164:50010 by /172.16.1.164\n\nhadoop-root-namenode-hadoop-name.log.2009-01-05:2009-01-05\n18:39:28,820 INFO org.apache.hadoop.hdfs.StateChange: BLOCK* ask\n172.16.1.184:50010 to replicate blk_-1361380929156165877_44096 to\ndatanode(s) 172.16.1.90:50010\n\nhadoop-root-namenode-hadoop-name.log.2009-01-05:2009-01-05\n18:39:40,465 INFO org.apache.hadoop.hdfs.StateChange: BLOCK*\nNameSystem.addStoredBlock: blockMap updated: 172.16.1.90:50010 is\nadded to blk_-1361380929156165877_44096 size 67108864\n\nhadoop-root-namenode-hadoop-name.log.2009-01-05:2009-01-05\n18:40:47,088 INFO org.apache.hadoop.hdfs.StateChange: BLOCK* ask\n172.16.1.90:50010 to replicate blk_-1361380929156165877_44096 to\ndatanode(s) 172.16.1.158:50010\n\nhadoop-root-namenode-hadoop-name.log.2009-01-05:2009-01-05\n18:40:53,107 INFO org.apache.hadoop.hdfs.StateChange: BLOCK*\nNameSystem.addStoredBlock: blockMap updated: 172.16.1.158:50010 is\nadded to blk_-1361380929156165877_44096 size 67108864\n\nhadoop-root-namenode-hadoop-name.log.2009-01-05:2009-01-05\n18:40:53,107 INFO org.apache.hadoop.hdfs.StateChange: BLOCK*\nNameSystem.chooseExcessReplicates: (172.16.1.90:50010,\nblk_-1361380929156165877_44096) is added to recentInvalidateSets\n\nhadoop-root-namenode-hadoop-name.log.2009-01-05:2009-01-05\n18:40:53,107 INFO org.apache.hadoop.hdfs.StateChange: BLOCK*\nNameSystem.chooseExcessReplicates: (172.16.1.184:50010,\nblk_-1361380929156165877_44096) is added to recentInvalidateSets\n\nhadoop-root-namenode-hadoop-name.log.2009-01-05:2009-01-05\n18:40:53,107 INFO org.apache.hadoop.hdfs.StateChange: DIR*\nNameSystem.invalidateBlock: blk_-1361380929156165877_44096 on\n172.16.1.164:50010\n\nhadoop-root-namenode-hadoop-name.log.2009-01-05:2009-01-05\n18:40:53,107 INFO org.apache.hadoop.hdfs.StateChange: BLOCK*\nNameSystem.invalidateBlocks: blk_-1361380929156165877_44096 on\n172.16.1.164:50010 is the only copy and was not deleted.\n\nhadoop-root-namenode-hadoop-name.log.2009-01-05:2009-01-05\n18:40:53,107 INFO org.apache.hadoop.hdfs.StateChange: DIR*\nNameSystem.invalidateBlock: blk_-1361380929156165877_44096 on\n172.16.1.165:50010\n\nhadoop-root-namenode-hadoop-name.log.2009-01-05:2009-01-05\n18:40:53,107 INFO org.apache.hadoop.hdfs.StateChange: BLOCK*\nNameSystem.invalidateBlocks: blk_-1361380929156165877_44096 on\n172.16.1.165:50010 is the only copy and was not deleted.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bockelman","name":"bockelman","key":"bockelman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Bockelman","active":true,"timeZone":"America/Chicago"},"created":"2009-01-14T04:29:48.667+0000","updated":"2009-01-14T04:29:48.667+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412121/comment/12663622","id":"12663622","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bockelman","name":"bockelman","key":"bockelman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Bockelman","active":true,"timeZone":"America/Chicago"},"body":"Duplicate of HADOOP-4742","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bockelman","name":"bockelman","key":"bockelman","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brian Bockelman","active":true,"timeZone":"America/Chicago"},"created":"2009-01-14T04:30:14.600+0000","updated":"2009-01-14T04:30:14.600+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-5012/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0i5bz:"}}