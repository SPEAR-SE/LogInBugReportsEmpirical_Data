{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12825768","self":"https://issues.apache.org/jira/rest/api/2/issue/12825768","key":"HADOOP-11886","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2017-06-12T09:49:18.317+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jun 12 09:49:18 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-11886/watchers","watchCount":5,"isWatching":false},"created":"2015-04-29T02:10:49.480+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sam+liu","name":"sam liu","key":"sam liu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam liu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-06-12T09:49:18.317+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319644","id":"12319644","name":"tools/distcp","description":"Distcp"}],"timeoriginalestimate":null,"description":"Could run distcp against ftp server installed on Linux, but could NOT run distcp against ftp server installed on Windows(such as IIS ftp service). However, distcp works well for FileZilla ftp server installed on Windows ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Failed to run distcp against ftp server installed on Windows","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sam+liu","name":"sam liu","key":"sam liu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam liu","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sam+liu","name":"sam liu","key":"sam liu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam liu","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12825768/comment/14518597","id":"14518597","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sam+liu","name":"sam liu","key":"sam liu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam liu","active":true,"timeZone":"Asia/Shanghai"},"body":"[Scenario 1]\nI installed a BI cluster using trunk build on HadoopNode1, and then could copy file from a ftp installed on Linux to hdfs using command:\nhadoop distcp ftp://user1:user1@9.185.68.201/home/user1/ftp.txt hdfs://HadoopNode1:9000/tmp/\n\n[Scenario 2]\n[Success on FileZilla ftp server on Windows7]:\n[hdfs@hostname2.com ~]$ hadoop distcp ftp://ftp:ftp@hostname1.com:121/ftp_test.txt /tmp/\n15/04/26 22:56:20 INFO tools.DistCp: Input Options: DistCpOptions{atomicCommit=false, syncFolder=false, deleteMissing=false, ignoreFailures=false, maxMaps=20, sslConfigurationFile='null', copyStrategy='uniformsize', sourceFileListing=null, sourcePaths=[ftp://ftp:ftp@hostname1.com:121/ftp_test.txt], targetPath=/tmp, targetPathExists=true, preserveRawXattrs=false}\n15/04/26 22:56:21 INFO impl.TimelineClientImpl: Timeline service address: http://hostname2.com:8188/ws/v1/timeline/\n15/04/26 22:56:21 INFO client.RMProxy: Connecting to ResourceManager at hostname2.com/9.32.249.181:8050\n15/04/26 22:56:43 INFO impl.TimelineClientImpl: Timeline service address: http://hostname2.com:8188/ws/v1/timeline/\n15/04/26 22:56:43 INFO client.RMProxy: Connecting to ResourceManager at hostname2.com/9.32.249.181:8050\n15/04/26 22:56:43 INFO mapreduce.JobSubmitter: number of splits:1\n15/04/26 22:56:44 INFO mapreduce.JobSubmitter: Submitting tokens for job: job_1429858372957_0002\n15/04/26 22:56:44 INFO impl.YarnClientImpl: Submitted application application_1429858372957_0002\n15/04/26 22:56:44 INFO mapreduce.Job: The url to track the job: http://hostname2.com:8088/proxy/application_1429858372957_0002/\n15/04/26 22:56:44 INFO tools.DistCp: DistCp job-id: job_1429858372957_0002\n15/04/26 22:56:44 INFO mapreduce.Job: Running job: job_1429858372957_0002\n15/04/26 22:56:51 INFO mapreduce.Job: Job job_1429858372957_0002 running in uber mode : false\n15/04/26 22:56:51 INFO mapreduce.Job:  map 0% reduce 0%\n\n[Scenario 3]\nOn the same hadoop node, I can copy file from a remote ftp server installed on Windows7 using command:\nwget ftp://Viewer:password1@9.126.148.79/ftp-win.txt.\n\nBut I failed to copy file from a ftp installed on Windows7 to hdfs using command:\n[user1@HadoopNode1 ~]$ hadoop distcp ftp://Viewer:password1@9.126.148.79/ftp-win.txt /tmp/\n15/02/01 23:03:37 INFO tools.DistCp: Input Options: DistCpOptions{atomicCommit=false, syncFolder=false, deleteMissing=false, ignoreFailures=false, maxMaps=20, sslConfigurationFile='null', copyStrategy='uniformsize', sourceFileListing=null, sourcePaths=[ftp://Viewer:password1@9.126.148.79/ftp-win.txt], targetPath=/tmp, targetPathExists=true}\n15/02/01 23:03:38 INFO client.RMProxy: Connecting to ResourceManager at HadoopNode1/9.30.239.166:8032\n15/02/01 23:05:50 ERROR tools.DistCp: Exception encountered\norg.apache.commons.net.ftp.FTPConnectionClosedException: Connection closed without indication.\n        at org.apache.commons.net.ftp.FTP.__getReply(FTP.java:313)\n        at org.apache.commons.net.ftp.FTP.__getReply(FTP.java:290)\n        at org.apache.commons.net.ftp.FTP.sendCommand(FTP.java:479)\n        at org.apache.commons.net.ftp.FTP.sendCommand(FTP.java:552)\n        at org.apache.commons.net.ftp.FTP.sendCommand(FTP.java:601)\n        at org.apache.commons.net.ftp.FTP.quit(FTP.java:809)\n        at org.apache.commons.net.ftp.FTPClient.logout(FTPClient.java:979)\n        at org.apache.hadoop.fs.ftp.FTPFileSystem.disconnect(FTPFileSystem.java:151)\n        at org.apache.hadoop.fs.ftp.FTPFileSystem.getFileStatus(FTPFileSystem.java:395)\n        at org.apache.hadoop.fs.Globber.getFileStatus(Globber.java:57)\n        at org.apache.hadoop.fs.Globber.glob(Globber.java:248)\n        at org.apache.hadoop.fs.FileSystem.globStatus(FileSystem.java:1632)\n        at org.apache.hadoop.tools.GlobbedCopyListing.doBuildListing(GlobbedCopyListing.java:77)\n        at org.apache.hadoop.tools.CopyListing.buildListing(CopyListing.java:80)\n        at org.apache.hadoop.tools.DistCp.createInputFileListing(DistCp.java:342)\n        at org.apache.hadoop.tools.DistCp.execute(DistCp.java:154)\n        at org.apache.hadoop.tools.DistCp.run(DistCp.java:121)\n        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:70)\n        at org.apache.hadoop.tools.DistCp.main(DistCp.java:390)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sam+liu","name":"sam liu","key":"sam liu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-04-29T02:18:48.052+0000","updated":"2015-04-29T02:18:48.052+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12825768/comment/14518604","id":"14518604","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sam+liu","name":"sam liu","key":"sam liu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam liu","active":true,"timeZone":"Asia/Shanghai"},"body":"I found the FTPClient code will hang on the line 'client.setFileTransferMode(FTP.BLOCK_TRANSFER_MODE)' against IIS ftp server on Windows, and then it will failed with some FTP connection exception. \n\nSo I removed the line 'client.setFileTransferMode(FTP.BLOCK_TRANSFER_MODE)' from hadoop/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/ftp/FTPFileSystem.java#connect(), and then found some things improved: now the distcp tool could launch the MR job(it could not before changing the code) agsint IIS ftp server on Windows, but still always failed on the step 'map 100% reduce 0%':\n\nhadoop distcp ftp://Viewer:passw0rd@hostname1.com:1121/ftp_file1.txt /tmp/\n15/04/28 01:28:48 INFO tools.DistCp: Input Options: DistCpOptions{atomicCommit=false, syncFolder=false, deleteMissing=false, ignoreFailures=false, maxMaps=20, sslConfigurationFile='null', copyStrategy='uniformsize', sourceFileListing=null, sourcePaths=[ftp://Viewer:passw0rd@hostname1.com:1121/ftp_file1.txt], targetPath=/tmp, targetPathExists=true, preserveRawXattrs=false}\n15/04/28 01:28:49 INFO impl.TimelineClientImpl: Timeline service address: http://hostname2.com:8188/ws/v1/timeline/\n15/04/28 01:28:50 INFO client.RMProxy: Connecting to ResourceManager at hostname2.com/9.30.249.187:8050\n15/04/28 01:29:12 INFO impl.TimelineClientImpl: Timeline service address: http://hostname2.com:8188/ws/v1/timeline/\n15/04/28 01:29:12 INFO client.RMProxy: Connecting to ResourceManager at hostname2.com/9.30.249.187:8050\n15/04/28 01:29:13 INFO mapreduce.JobSubmitter: number of splits:1\n15/04/28 01:29:13 INFO mapreduce.JobSubmitter: Submitting tokens for job: job_1430212928460_0002\n15/04/28 01:29:13 INFO impl.YarnClientImpl: Submitted application application_1430212928460_0002\n15/04/28 01:29:13 INFO mapreduce.Job: The url to track the job: http://hostname2.com:8088/proxy/application_1430212928460_0002/\n15/04/28 01:29:13 INFO tools.DistCp: DistCp job-id: job_1430212928460_0002\n15/04/28 01:29:13 INFO mapreduce.Job: Running job: job_1430212928460_0002\n15/04/28 01:29:20 INFO mapreduce.Job: Job job_1430212928460_0002 running in uber mode : false\n15/04/28 01:29:20 INFO mapreduce.Job:  map 0% reduce 0%\n15/04/28 01:29:31 INFO mapreduce.Job:  map 100% reduce 0%\n15/04/28 01:31:38 INFO mapreduce.Job: Task Id : attempt_1430212928460_0002_m_000000_0, Status : FAILED\nError: java.net.SocketException: Connection reset\n        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:118)\n        at java.net.SocketOutputStream.write(SocketOutputStream.java:159)\n        at sun.nio.cs.StreamEncoder.writeBytes(StreamEncoder.java:221)\n        at sun.nio.cs.StreamEncoder.implFlushBuffer(StreamEncoder.java:291)\n        at sun.nio.cs.StreamEncoder.implFlush(StreamEncoder.java:295)\n        at sun.nio.cs.StreamEncoder.flush(StreamEncoder.java:141)\n        at java.io.OutputStreamWriter.flush(OutputStreamWriter.java:229)\n        at java.io.BufferedWriter.flush(BufferedWriter.java:254)\n        at org.apache.commons.net.ftp.FTP.__send(FTP.java:501)\n        at org.apache.commons.net.ftp.FTP.sendCommand(FTP.java:475)\n        at org.apache.commons.net.ftp.FTP.sendCommand(FTP.java:552)\n        at org.apache.commons.net.ftp.FTP.sendCommand(FTP.java:601)\n        at org.apache.commons.net.ftp.FTP.quit(FTP.java:809)\n        at org.apache.commons.net.ftp.FTPClient.logout(FTPClient.java:979)\n        at org.apache.hadoop.fs.ftp.FTPFileSystem.disconnect(FTPFileSystem.java:162)\n        at org.apache.hadoop.fs.ftp.FTPFileSystem.getFileStatus(FTPFileSystem.java:410)\n        at org.apache.hadoop.tools.mapred.CopyMapper.map(CopyMapper.java:218)\n        at org.apache.hadoop.tools.mapred.CopyMapper.map(CopyMapper.java:50)\n        at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)\n        at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:784)\n        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:341)\n        at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:163)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:415)\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1628)\n        at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sam+liu","name":"sam liu","key":"sam liu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"sam liu","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-04-29T02:27:33.867+0000","updated":"2015-04-29T02:27:33.867+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12825768/comment/16046394","id":"16046394","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Hongyuan+Li","name":"Hongyuan Li","key":"hongyuan li","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongyuan Li","active":true,"timeZone":"Etc/UTC"},"body":"On windows os ,you could set fs.ftp.transfer.mode to FTP.STREAM_TRANSFER_MODE which is equal to  10.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Hongyuan+Li","name":"Hongyuan Li","key":"hongyuan li","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hongyuan Li","active":true,"timeZone":"Etc/UTC"},"created":"2017-06-12T09:49:18.317+0000","updated":"2017-06-12T09:49:18.317+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-11886/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2e1sv:"}}