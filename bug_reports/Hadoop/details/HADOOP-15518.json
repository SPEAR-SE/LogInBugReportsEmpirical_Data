{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13164718","self":"https://issues.apache.org/jira/rest/api/2/issue/13164718","key":"HADOOP-15518","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-06-07T16:21:30.892+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jun 26 22:11:01 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-15518/watchers","watchCount":8,"isWatching":false},"created":"2018-06-07T15:36:03.727+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12331977","id":"12331977","description":"2.7.1 release","name":"2.7.1","archived":false,"released":true,"releaseDate":"2015-07-06"}],"issuelinks":[{"id":"12536018","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12536018","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"outwardIssue":{"id":"13157875","key":"YARN-8258","self":"https://issues.apache.org/jira/rest/api/2/issue/13157875","fields":{"summary":"YARN webappcontext for UI2 should inherit all filters from default context","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12536009","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12536009","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13149605","key":"YARN-8108","self":"https://issues.apache.org/jira/rest/api/2/issue/13149605","fields":{"summary":"RM metrics rest API throws GSSException in kerberized environment","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kminder","name":"kminder","key":"kminder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kminder&avatarId=21642","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kminder&avatarId=21642","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kminder&avatarId=21642","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kminder&avatarId=21642"},"displayName":"Kevin Minder","active":true,"timeZone":"America/New_York"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-06-26T22:11:01.098+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312526","id":"12312526","name":"security"}],"timeoriginalestimate":null,"description":"The hadoop-auth AuthenticationFilter will invoke its handler even if a prior successful authentication has occurred in the current request.  This primarily affects situations where multiple authentication mechanism has been configured.  For example when core-site.xml's has hadoop.http.authentication.type=kerberos and yarn-site.xml has yarn.timeline-service.http-authentication.type=kerberos the result is an attempt to perform two Kerberos authentications for the same request.  This in turn results in Kerberos triggering a replay attack detection.  The javadocs for AuthenticationHandler ([https://github.com/apache/hadoop/blob/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/server/AuthenticationHandler.java)] indicate for the authenticate method that\r\n{quote}This method is invoked by the AuthenticationFilter only if the HTTP client request is not yet authenticated.\r\n{quote}\r\nThis does not appear to be the case in practice.\r\n\r\nI've create a patch and tested on a limited number of functional use cases (e.g. the timeline-service issue noted above).  If there is general agreement that the change is valid I'll add unit tests to the patch.\r\n\r\n ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12926920","id":"12926920","filename":"HADOOP-15518-001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kminder","name":"kminder","key":"kminder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kminder&avatarId=21642","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kminder&avatarId=21642","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kminder&avatarId=21642","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kminder&avatarId=21642"},"displayName":"Kevin Minder","active":true,"timeZone":"America/New_York"},"created":"2018-06-07T15:51:46.900+0000","size":1624,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12926920/HADOOP-15518-001.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Authentication filter calling handler after request already authenticated","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kminder","name":"kminder","key":"kminder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kminder&avatarId=21642","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kminder&avatarId=21642","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kminder&avatarId=21642","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kminder&avatarId=21642"},"displayName":"Kevin Minder","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kminder","name":"kminder","key":"kminder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kminder&avatarId=21642","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kminder&avatarId=21642","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kminder&avatarId=21642","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kminder&avatarId=21642"},"displayName":"Kevin Minder","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16504877","id":"16504877","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"body":"This is a race condition if multiple instances of AuthenticationFilters are chained together by accident, and the token has already been checked once by first instance of AuthenticationFilter, and the token has not been committed to HttpResponse.  \"authenticate\" method will get called twice.  The javadoc is not wrong, except how to go about validating the current request is already authenticated is not trivial when token has not been received by browser yet.  It might be possible to add checks for either HttpRequest.getRemoteUser() or HttpResponse header committing state to see if Authentication had already occurred to prevent the race condition.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-06-07T16:21:30.892+0000","updated":"2018-06-07T16:21:30.892+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16504881","id":"16504881","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"body":"+1 The patch looks good to me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-06-07T16:23:54.290+0000","updated":"2018-06-07T16:23:54.290+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16504893","id":"16504893","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"body":"[~eyang] - it is unclear to me where the race condition is. My assumption is that the filters are invoked linearly so a second filter shouldn't be invoked until the request state is set properly.\r\n\r\n[~kminder] - this seems an appropriate change to me and worth adding tests for.\r\n\r\n[~owen.omalley] - are we missing anything in this implementation and assumptions about the HTTP client only being authenticated once by AuthenticationFilter?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"created":"2018-06-07T16:38:16.237+0000","updated":"2018-06-07T16:38:16.237+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16504999","id":"16504999","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lmccay] {quote}it is unclear to me where the race condition is. My assumption is that the filters are invoked linearly so a second filter shouldn't be invoked until the request state is set properly.{quote}\r\n\r\nYour assumption is correct, and the diagram might help to explain the race conditions.\r\n\r\nHIgh level of the sequence of events of a normal setup:\r\n\r\n| Time | Browser | HttpRequest | HttpResponse |\r\n| 1 | Send WWW-Authenticate 1 | | |\r\n| 2 | | AuthenticationFilter checks WWW-Authenticate 1 |  |\r\n| 3 | | Call authenticate to verify WWW-Authenticate 1 ticket with KDC | |\r\n| 4 | | Set User principal and remote user via Java security callbacks | |\r\n| 5 | | | AuthenticationFilter writes WWW-Authenticate 2 |\r\n| 6 | | | Business logic |\r\n| 7 | Received WWW-Authenticate 2 | | |\r\n\r\nEvents of duplicated AuthenticationFilters are:\r\n\r\n| Time | Browser | HttpRequest | HttpResponse |\r\n| 1 | WWW-Authenticate 1 | | |\r\n| 2 | | AuthenticationFilter Instance 1 Check WWW-Authenticate 1 |  |\r\n| 3 | | Call authenticate to verify WWW-Authenticate 1 ticket with KDC | |\r\n| 4 | | Set User principal and remote user via Java security callbacks | |\r\n| 5 | | | AuthenticationFilter Instance 1 writes WWW-Authenticate 2 |\r\n| 6 | | AuthenticationFilter Instance 2 Check WWW-Autnenticate 1 | AuthenticationFilter Instance 2 rewrites HTTP status with 403 |\r\n\r\nBrowser has never retrieved WWW-Authenticate 2 header from server because HttpResponse is still buffered on server side.  The race condition is between HttpRequest at time 6 is still using existing ticket 1 without using the new ticket 2 that is issued at time 5.  Second Filter is invoked at time 6 using out dated data.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-06-07T17:41:48.594+0000","updated":"2018-06-07T17:41:48.594+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16505025","id":"16505025","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kminder","name":"kminder","key":"kminder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kminder&avatarId=21642","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kminder&avatarId=21642","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kminder&avatarId=21642","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kminder&avatarId=21642"},"displayName":"Kevin Minder","active":true,"timeZone":"America/New_York"},"body":"[~eyang] < Can you please clarify if your comment about a race condition is a criticism of the patch?  I'm having trouble rationalizing your +1 with your other comments.  Are you really trying to say that the patch solves the race condition?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kminder","name":"kminder","key":"kminder","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kminder&avatarId=21642","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kminder&avatarId=21642","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kminder&avatarId=21642","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kminder&avatarId=21642"},"displayName":"Kevin Minder","active":true,"timeZone":"America/New_York"},"created":"2018-06-07T18:07:07.631+0000","updated":"2018-06-07T18:07:07.631+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16505081","id":"16505081","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~kminder] Race condition is not a criticism of this patch.  It is byproduct of having multiple instances of AuthenticationFilter that authenticate method is called more than once due to lack of checking that the current request is already authenticated.  My above comment is showing the states prior to this patch.  Thank you for the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-06-07T18:50:04.471+0000","updated":"2018-06-07T18:50:04.471+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16505924","id":"16505924","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunilg","name":"sunilg","key":"sunilg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunil Govindan","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~kminder]\r\n\r\nI checked this change in below cases.\r\n # Accessed RM old UI and new YARN UI from kerberized browser when AuthenticationFilter is configured and Http Auth Type was kerberos.\r\n # Both UI were accessible when Http Auth Type was configured as JWTRedirectAuthenticationHandler.\r\n\r\nBefore this patch, we were getting replay attack for Ui2 as multiple auth handlers were present. For ui2, I have found that initial /ui2 will get 401 from Auth handler and then later it ll accept request as proper cookie were present in new request. But jetty will do a next redirect (not from client side) to access /ui2/index.html which will not have this cookie. Hence was getting GSS exception.\r\n\r\nSince this patch checks for principal as well, I think it looks fine. cc [~vinodkv] [~eyang]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunilg","name":"sunilg","key":"sunilg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunil Govindan","active":true,"timeZone":"Asia/Kolkata"},"created":"2018-06-08T11:11:06.001+0000","updated":"2018-06-08T11:11:06.001+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16506425","id":"16506425","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=owen.omalley","name":"owen.omalley","key":"owen.omalley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=owen.omalley&avatarId=29697","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=owen.omalley&avatarId=29697","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=owen.omalley&avatarId=29697","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=owen.omalley&avatarId=29697"},"displayName":"Owen O'Malley","active":true,"timeZone":"America/Los_Angeles"},"body":"This looks good, [~kminder]. +1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=owen.omalley","name":"owen.omalley","key":"owen.omalley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=owen.omalley&avatarId=29697","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=owen.omalley&avatarId=29697","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=owen.omalley&avatarId=29697","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=owen.omalley&avatarId=29697"},"displayName":"Owen O'Malley","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-06-08T18:29:17.688+0000","updated":"2018-06-08T18:29:17.688+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16506506","id":"16506506","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"body":"One foot note about this change.  If multiple AuthenticationFilters are configured, and service principal names are different.  TGS granted to remote client is the principal name of the first AuthenticationFilter that gets triggered.  This may look unexpected when auditing where user has been through klist.  The ability to configure different HTTP principals on the same server port configuration shouldn't exist, but developer should be aware of the API imperfection to avoid getting to this hole.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-06-08T19:59:56.450+0000","updated":"2018-06-08T19:59:56.450+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16506539","id":"16506539","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genericqa","name":"genericqa","key":"genericqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=genericqa&avatarId=33630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=genericqa&avatarId=33630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=genericqa&avatarId=33630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=genericqa&avatarId=33630"},"displayName":"genericqa","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\r\n\\\\\r\n\\\\\r\n|| Vote || Subsystem || Runtime || Comment ||\r\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 23s{color} | {color:blue} Docker mode activated. {color} |\r\n|| || || || {color:brown} Prechecks {color} ||\r\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\r\n| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |\r\n|| || || || {color:brown} trunk Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 26m 24s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 30m 24s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 18s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 31s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 12m  0s{color} | {color:green} branch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m 36s{color} | {color:green} trunk passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 25s{color} | {color:green} trunk passed {color} |\r\n|| || || || {color:brown} Patch Compile Tests {color} ||\r\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 21s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 36m  0s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 36m  0s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 23s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 35s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\r\n| {color:green}+1{color} | {color:green} shadedclient {color} | {color:green} 12m 10s{color} | {color:green} patch has no errors when building and testing our client artifacts. {color} |\r\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  0m 52s{color} | {color:green} the patch passed {color} |\r\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 29s{color} | {color:green} the patch passed {color} |\r\n|| || || || {color:brown} Other Tests {color} ||\r\n| {color:green}+1{color} | {color:green} unit {color} | {color:green}  4m  2s{color} | {color:green} hadoop-auth in the patch passed. {color} |\r\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 37s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\r\n| {color:black}{color} | {color:black} {color} | {color:black}127m 34s{color} | {color:black} {color} |\r\n\\\\\r\n\\\\\r\n|| Subsystem || Report/Notes ||\r\n| Docker | Client=17.05.0-ce Server=17.05.0-ce Image:yetus/hadoop:abb62dd |\r\n| JIRA Issue | HADOOP-15518 |\r\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12926920/HADOOP-15518-001.patch |\r\n| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  shadedclient  findbugs  checkstyle  |\r\n| uname | Linux 61010ea62644 3.13.0-137-generic #186-Ubuntu SMP Mon Dec 4 19:09:19 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux |\r\n| Build tool | maven |\r\n| Personality | /testptch/patchprocess/precommit/personality/provided.sh |\r\n| git revision | trunk / a127244 |\r\n| maven | version: Apache Maven 3.3.9 |\r\n| Default Java | 1.8.0_171 |\r\n| findbugs | v3.1.0-RC1 |\r\n|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/14748/testReport/ |\r\n| Max. process+thread count | 291 (vs. ulimit of 10000) |\r\n| modules | C: hadoop-common-project/hadoop-auth U: hadoop-common-project/hadoop-auth |\r\n| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/14748/console |\r\n| Powered by | Apache Yetus 0.8.0-SNAPSHOT   http://yetus.apache.org |\r\n\r\n\r\nThis message was automatically generated.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=genericqa","name":"genericqa","key":"genericqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=genericqa&avatarId=33630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=genericqa&avatarId=33630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=genericqa&avatarId=33630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=genericqa&avatarId=33630"},"displayName":"genericqa","active":true,"timeZone":"Etc/UTC"},"created":"2018-06-08T20:38:21.577+0000","updated":"2018-06-08T20:38:21.577+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16506669","id":"16506669","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"body":"There seems to be a problem if multiple filters extended from AuthenticationFilter, the token casting are incompatible.\r\n\r\nBrowser shows this error message:\r\n{code}\r\nHTTP ERROR 500\r\n\r\nProblem accessing /proxy/application_1528498597648_0001/. Reason:\r\n\r\n    Server Error\r\nCaused by:\r\n\r\njava.lang.ClassCastException: org.apache.hadoop.security.token.delegation.web.DelegationTokenAuthenticationFilter$1$1 cannot be cast to org.apache.hadoop.security.authentication.server.AuthenticationToken\r\n\tat org.apache.hadoop.security.token.delegation.web.DelegationTokenAuthenticationFilter.doFilter(DelegationTokenAuthenticationFilter.java:250)\r\n\tat org.apache.hadoop.security.authentication.server.AuthenticationFilter.doFilter(AuthenticationFilter.java:597)\r\n\tat org.apache.hadoop.yarn.server.security.http.RMAuthenticationFilter.doFilter(RMAuthenticationFilter.java:82)\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1759)\r\n\tat org.apache.hadoop.security.authentication.server.AuthenticationFilter.doFilter(AuthenticationFilter.java:649)\r\n\tat org.apache.hadoop.security.token.delegation.web.DelegationTokenAuthenticationFilter.doFilter(DelegationTokenAuthenticationFilter.java:304)\r\n\tat org.apache.hadoop.security.authentication.server.AuthenticationFilter.doFilter(AuthenticationFilter.java:597)\r\n\tat org.apache.hadoop.yarn.server.security.http.RMAuthenticationFilter.doFilter(RMAuthenticationFilter.java:82)\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1759)\r\n\tat org.apache.hadoop.security.http.CrossOriginFilter.doFilter(CrossOriginFilter.java:98)\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1759)\r\n\tat org.apache.hadoop.http.HttpServer2$QuotingInputFilter.doFilter(HttpServer2.java:1608)\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1759)\r\n\tat org.apache.hadoop.http.NoCacheFilter.doFilter(NoCacheFilter.java:45)\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1759)\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:582)\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226)\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:512)\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119)\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:534)\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:320)\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251)\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:283)\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:108)\r\n\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)\r\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:671)\r\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:589)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-06-08T23:02:48.139+0000","updated":"2018-06-08T23:02:48.139+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16507946","id":"16507946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunilg","name":"sunilg","key":"sunilg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunil Govindan","active":true,"timeZone":"Asia/Kolkata"},"body":"[~eyang] This latest issue (Problem accessing /proxy/application_1528498597648_0001/) is a different problem, correct?\r\n\r\nbq.If multiple AuthenticationFilters are configured, and service principal names are different\r\n\r\nAre you mentioning a case where AuthenticationFilter is added multiple time (like Spnego Filter and authentication) but will use different keytab? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunilg","name":"sunilg","key":"sunilg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunil Govindan","active":true,"timeZone":"Asia/Kolkata"},"created":"2018-06-11T12:06:59.444+0000","updated":"2018-06-11T12:06:59.444+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16508318","id":"16508318","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~sunilg] Multiple AuthenticationFilters configured with different service principal names is a corner case that shouldn't exist but the code is allowing this to happen.  Comments in this JIRA and YARN-8108 should explain why this is unsupported use case.\r\n\r\nThe casting problem is using the same HTTP principal and YARN code is activating multiple filters that based on AuthenticationFilter.  Token casting issue didn't exist prior to this patch.  This patch is making assumption that filters based on AuthenticationFilter would make compatible tokens, which RMAuthenticationFilter and AuthenticationFilter don't make the same type of token.  Thus, the casting problem occurs.  This problem can be eliminated by applying same type of AuthenticationFilter on a server port.  YARN-8108 can fix YARN resource manager.  There might be other places in Hadoop that might have similar problems, like KMSAuthenticationFilter and DelegationTokenAuthenticationFilter that need to be reviewed to understand the impact of this change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-06-11T16:32:11.074+0000","updated":"2018-06-11T16:32:11.074+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16511492","id":"16511492","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunilg","name":"sunilg","key":"sunilg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunil Govindan","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~eyang] for the pointer as per offline discussion. I have changed *getUserPrincipal* to *getRemoteUser* and this change seems working fine. GSS exception could be avoided like the patch attached here. Moreover since we check for getRemoteUser, class cast exception also wont happen as in the case Eric pointed above. So i think this patch could be improved by checking for getRemoteUser. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sunilg","name":"sunilg","key":"sunilg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunil Govindan","active":true,"timeZone":"Asia/Kolkata"},"created":"2018-06-13T18:12:27.340+0000","updated":"2018-06-13T18:12:27.340+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13164718/comment/16524265","id":"16524265","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"bq. I have changed getUserPrincipal to getRemoteUser and this change seems working fine. \r\nThat was my first solution too. [~kminder], would that work?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-06-26T22:11:01.098+0000","updated":"2018-06-26T22:11:01.098+0000"}],"maxResults":15,"total":15,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-15518/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3umi7:"}}