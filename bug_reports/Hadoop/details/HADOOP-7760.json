{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12527898","self":"https://issues.apache.org/jira/rest/api/2/issue/12527898","key":"HADOOP-7760","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/8","id":"8","description":"The described issue is not actually a problem - it is as designed.","name":"Not A Problem"},"customfield_12312322":null,"customfield_12310220":"2011-10-20T16:19:14.850+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Oct 21 23:40:20 UTC 2011","customfield_12310420":"92301","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_137174423_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2011-10-21T23:40:20.607+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-7760/watchers","watchCount":2,"isWatching":false},"created":"2011-10-20T09:34:06.237+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":"sequencefile byteswritable linefeed newline","customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":7200,"aggregatetimeoriginalestimate":7200,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314203","id":"12314203","description":"","name":"0.20.2","archived":false,"released":true,"releaseDate":"2010-02-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-10-21T23:40:20.656+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310970","id":"12310970","name":"record","description":""}],"timeoriginalestimate":7200,"description":"I create SequenceFiles which have BytesWritable as values.\nI notice that if I store content which contains no linefeeds (\"\\n\") or one linefeed, in the value, the value can also be read out of the sequencefile properly.\nHowever, as soon as I store input which contains two or more linefeeds (which is actually pretty much always the case), during the process of writing to the sequencefile and reading my data back, one *extra* linefeed is yielded at the end of the value, a linefeed which did not exist in the input.\nSo this effectively corrupts my data, although i could write a hacky workaround for it.\nI have written a program that demonstrates the behavior, by showing what happens when writing 2 sequencefiles:\none that has a record which value contains one linefeeds.\nanother that has a record which value contains two linefeeds.\nUpon reading, the latter value will contain 3 linefeeds.\n\nTest file is : http://pastie.org/2728797","customfield_10010":null,"timetracking":{"originalEstimate":"2h","remainingEstimate":"2h","originalEstimateSeconds":7200,"remainingEstimateSeconds":7200},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":7200,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"102379","customfield_12312823":null,"summary":"BytesWritable / SequenceFile yields dummy linefeed at end as soon as content has one or more linefeeds.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dieter_be","name":"dieter_be","key":"dieter_be","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dieter Plaetinck","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dieter_be","name":"dieter_be","key":"dieter_be","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dieter Plaetinck","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":7200,"percent":0},"customfield_12311024":null,"environment":"Easily reproducable on Debian Linux cluster but also on my Arch Linux desktop.\n\nI am aware there are some newer releases in the 0.20 series, but all changelogs and release note links for those @ http://hadoop.apache.org/common/releases.html are broken, so I can't check if this has been fixed and/or whether it's safe to upgrade.","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":7200,"percent":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527898/comment/13131489","id":"13131489","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dieter_be","name":"dieter_be","key":"dieter_be","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dieter Plaetinck","active":true,"timeZone":"Etc/UTC"},"body":"Almost forgot, here is the output of a run of the test program:\n\n$ java SequenceFileTest\n== testing entry with one newline char ==\n-> writing sequencefile with 1 record, which is a value with 1 newlines\n11/10/20 11:13:07 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\n11/10/20 11:13:07 INFO compress.CodecPool: Got brand-new compressor\n-> reading all sequencefile entries..\n11/10/20 11:13:07 INFO compress.CodecPool: Got brand-new decompressor\n--> reading a record\n--> key: 1\n--> value read line: \n== testing entry with two newline chars ==\n-> writing sequencefile with 1 record, which is a value with 2 newlines\n-> reading all sequencefile entries..\n--> reading a record\n--> key: 1\n--> value read line: \n--> value read line: \n--> value read line: \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dieter_be","name":"dieter_be","key":"dieter_be","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dieter Plaetinck","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-20T09:43:24.920+0000","updated":"2011-10-20T09:43:24.920+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527898/comment/13131725","id":"13131725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=owen.omalley","name":"owen.omalley","key":"owen.omalley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=owen.omalley&avatarId=29697","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=owen.omalley&avatarId=29697","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=owen.omalley&avatarId=29697","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=owen.omalley&avatarId=29697"},"displayName":"Owen O'Malley","active":true,"timeZone":"America/Los_Angeles"},"body":"You've fallen into a classic mistake with BytesWritable. Note the comment on the API:\n\n[http://hadoop.apache.org/common/docs/current/api/org/apache/hadoop/io/BytesWritable.html#getBytes()]\n\nYou needed to write:\n\n{code}\nnew ByteArrayInputStream(value.getBytes(), 0, value.getLength())\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=owen.omalley","name":"owen.omalley","key":"owen.omalley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=owen.omalley&avatarId=29697","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=owen.omalley&avatarId=29697","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=owen.omalley&avatarId=29697","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=owen.omalley&avatarId=29697"},"displayName":"Owen O'Malley","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-10-20T16:19:14.850+0000","updated":"2011-10-20T16:19:14.850+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527898/comment/13132547","id":"13132547","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dieter_be","name":"dieter_be","key":"dieter_be","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dieter Plaetinck","active":true,"timeZone":"Etc/UTC"},"body":"Whoops.  You're right. My mistake.  Not a bug.  This can be closed.\nThat said, I find it counter intuitive that ByteArrayInputStream needs to be told explicitly to stop at the last element in the array, and by default goes one element too far?  Any thoughts on that?\nThanks,\nDieter\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dieter_be","name":"dieter_be","key":"dieter_be","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dieter Plaetinck","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-21T09:30:35.216+0000","updated":"2011-10-21T09:30:35.216+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527898/comment/13133194","id":"13133194","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=owen.omalley","name":"owen.omalley","key":"owen.omalley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=owen.omalley&avatarId=29697","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=owen.omalley&avatarId=29697","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=owen.omalley&avatarId=29697","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=owen.omalley&avatarId=29697"},"displayName":"Owen O'Malley","active":true,"timeZone":"America/Los_Angeles"},"body":"The \"problem\" is that BytesWritable and Text reuse the same byte array, for shorter data. That prevents reallocation at the cost of needing to check the length of the data.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=owen.omalley","name":"owen.omalley","key":"owen.omalley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=owen.omalley&avatarId=29697","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=owen.omalley&avatarId=29697","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=owen.omalley&avatarId=29697","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=owen.omalley&avatarId=29697"},"displayName":"Owen O'Malley","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-10-21T23:40:20.631+0000","updated":"2011-10-21T23:40:20.631+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-7760/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0hvl3:"}}