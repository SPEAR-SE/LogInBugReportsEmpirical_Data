{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13193369","self":"https://issues.apache.org/jira/rest/api/2/issue/13193369","key":"HADOOP-15871","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-10-23T12:39:58.550+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Oct 23 12:39:58 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-15871/watchers","watchCount":4,"isWatching":false},"created":"2018-10-22T21:28:17.769+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12546393","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12546393","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"13193364","key":"HADOOP-15870","self":"https://issues.apache.org/jira/rest/api/2/issue/13193364","fields":{"summary":"S3AInputStream.remainingInFile should use nextReadPos","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-11-12T10:25:06.598+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310689","id":"12310689","name":"fs","description":"Generic FileSystem code"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12311814","id":"12311814","name":"fs/s3","description":"S3A filesystem client and other S3 connectivity issues"}],"timeoriginalestimate":null,"description":"E.g,  DFSInputStream  and S3AInputStream return the size of the remaining available bytes, but the javadoc of \"available\" says it should \"Returns an estimate of the number of bytes that can be read (or skipped over) from this input stream *without blocking* by the next invocation of a method for this input stream.\"\r\n\r\nI understand that some applications may rely on the current behavior. It would be great that there is an interface to document how \"available\" should be implemented.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Some input streams does not obey \"java.io.InputStream.available\" contract ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zsxwing","name":"zsxwing","key":"zsxwing","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zsxwing&avatarId=19570","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zsxwing&avatarId=19570","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zsxwing&avatarId=19570","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zsxwing&avatarId=19570"},"displayName":"Shixiong Zhu","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zsxwing","name":"zsxwing","key":"zsxwing","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zsxwing&avatarId=19570","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zsxwing&avatarId=19570","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zsxwing&avatarId=19570","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zsxwing&avatarId=19570"},"displayName":"Shixiong Zhu","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13193369/comment/16660580","id":"16660580","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"Extensions to {{hadoop-common-project/hadoop-common/src/site/markdown/filesystem/fsdatainputstream.md}} welcome; with contract tests...could be bundled with any HADOOP-15870 changes.\r\n\r\nworkflow\r\n# work out what is meant to happen @ java APIs\r\n# look at HDFS to see what it thinks should happen\r\n# spec\r\n# contract tests\r\n# test object stores & patch individually\r\n\r\nlooking at java.io, available() says \"which won't block\". For S3A it'd actually be the remaining amount of data in the current read, so just forward to {{wrappedStream.available()}} if wrappedStream != null, else 0. But {{com.amazonaws.services.s3.model.S3ObjectInputStream}}} calls out always returning 1 here so as not to break {{GZIPInputStream}} (see [https://bugs.java.com/bugdatabase/view_bug.do?bug_id=7036144].\r\n\r\n'was this gzip related? If so, something to consider including in a test too.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2018-10-23T12:39:58.550+0000","updated":"2018-10-23T12:39:58.550+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-15871/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3zi3b:"}}