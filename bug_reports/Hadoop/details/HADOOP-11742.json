{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12785074","self":"https://issues.apache.org/jira/rest/api/2/issue/12785074","key":"HADOOP-11742","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2015-03-25T11:27:48.589+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Sep 14 21:37:15 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_110445377_*|*_4_*:*_2_*:*_14326038919_*|*_5_*:*_3_*:*_251065395_*|*_10002_*:*_1_*:*_406627515","customfield_12312321":null,"resolutiondate":"2015-09-14T21:37:15.277+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-11742/watchers","watchCount":7,"isWatching":false},"created":"2015-03-24T04:47:38.155+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327583","id":"12327583","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"}],"issuelinks":[{"id":"12424092","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12424092","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12827077","key":"HADOOP-11918","self":"https://issues.apache.org/jira/rest/api/2/issue/12827077","fields":{"summary":"Listing an empty s3a root directory throws FileNotFound.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-09-14T21:37:15.359+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311814","id":"12311814","name":"fs/s3","description":"S3A filesystem client and other S3 connectivity issues"}],"timeoriginalestimate":null,"description":"I have built the latest 2.7, and tried S3AFileSystem.\n\nThen found that _mkdir_ fails on an empty bucket, named *s3a* here, as follows:\n\n{code}\n# hadoop-2.7.0-SNAPSHOT/bin/hdfs dfs -mkdir s3a://s3a/foo\n15/03/24 03:49:35 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3a/foo (foo)\n15/03/24 03:49:36 DEBUG s3a.S3AFileSystem: Not Found: s3a://s3a/foo\n15/03/24 03:49:36 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3a/ ()\n15/03/24 03:49:36 DEBUG s3a.S3AFileSystem: Not Found: s3a://s3a/\nmkdir: `s3a://s3a/foo': No such file or directory\n{code}\n\nSo does _ls_.\n\n{code}\n# hadoop-2.7.0-SNAPSHOT/bin/hdfs dfs -ls s3a://s3a/\n15/03/24 03:47:48 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3a/ ()\n15/03/24 03:47:48 DEBUG s3a.S3AFileSystem: Not Found: s3a://s3a/\nls: `s3a://s3a/': No such file or directory\n{code}\n\nThis is how it works via s3n.\n\n{code}\n# hadoop-2.7.0-SNAPSHOT/bin/hdfs dfs -ls s3n://s3n/\n# hadoop-2.7.0-SNAPSHOT/bin/hdfs dfs -mkdir s3n://s3n/foo\n# hadoop-2.7.0-SNAPSHOT/bin/hdfs dfs -ls s3n://s3n/\nFound 1 items\ndrwxrwxrwx   -          0 1970-01-01 00:00 s3n://s3n/foo\n{code}\n\nThe snapshot is the following:\n\n{quote}\n\\# git branch\n\\* branch-2.7\n  trunk\n\\# git log\ncommit 929b04ce3a4fe419dece49ed68d4f6228be214c1\nAuthor: Harsh J <harsh@cloudera.com>\nDate:   Sun Mar 22 10:18:32 2015 +0530\n{quote}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12707152","id":"12707152","filename":"HADOOP-11742-branch-2.7.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-03-25T06:34:39.006+0000","size":1100,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12707152/HADOOP-11742-branch-2.7.001.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12707452","id":"12707452","filename":"HADOOP-11742-branch-2.7.002.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-03-26T07:25:06.820+0000","size":2415,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12707452/HADOOP-11742-branch-2.7.002.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12708918","id":"12708918","filename":"HADOOP-11742-branch-2.7.003-1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-04-02T06:10:29.411+0000","size":1520,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12708918/HADOOP-11742-branch-2.7.003-1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12708920","id":"12708920","filename":"HADOOP-11742-branch-2.7.003-2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-04-02T06:14:36.679+0000","size":1529,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12708920/HADOOP-11742-branch-2.7.003-2.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"mkdir by file system shell fails on an empty bucket","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"CentOS 7","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14379374","id":"14379374","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"body":"An empty key means a root directory instead of \"Not Found\". This is the same behavior as _NativeS3FileSystem#getFileStatus_.\n\n{code}\n# hadoop-2.7.0-SNAPSHOT/bin/hdfs dfs -ls s3a://s3a/\n15/03/25 06:28:05 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3a/ ()\n15/03/25 06:28:05 DEBUG s3a.S3AFileSystem: List status for path: s3a://s3a/\n15/03/25 06:28:05 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3a/ ()\n15/03/25 06:28:05 DEBUG s3a.S3AFileSystem: listStatus: doing listObjects for directory \n# hadoop-2.7.0-SNAPSHOT/bin/hdfs dfs -mkdir s3a://s3a/foo\n15/03/25 06:28:22 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3a/foo (foo)\n15/03/25 06:28:23 DEBUG s3a.S3AFileSystem: Not Found: s3a://s3a/foo\n15/03/25 06:28:23 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3a/ ()\n15/03/25 06:28:23 DEBUG s3a.S3AFileSystem: Making directory: s3a://s3a/foo\n15/03/25 06:28:23 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3a/foo (foo)\n15/03/25 06:28:23 DEBUG s3a.S3AFileSystem: Not Found: s3a://s3a/foo\n15/03/25 06:28:23 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3a/foo (foo)\n15/03/25 06:28:24 DEBUG s3a.S3AFileSystem: Not Found: s3a://s3a/foo\n15/03/25 06:28:24 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3a/ ()\n# hadoop-2.7.0-SNAPSHOT/bin/hdfs dfs -ls s3a://s3a/\n15/03/25 06:28:31 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3a/ ()\n15/03/25 06:28:31 DEBUG s3a.S3AFileSystem: List status for path: s3a://s3a/\n15/03/25 06:28:31 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3a/ ()\n15/03/25 06:28:31 DEBUG s3a.S3AFileSystem: listStatus: doing listObjects for directory \n15/03/25 06:28:31 DEBUG s3a.S3AFileSystem: Adding: rd: s3a://s3a/foo\nFound 1 items\ndrwxrwxrwx   -          0 1970-01-01 00:00 s3a://s3a/foo\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-03-25T06:34:39.013+0000","updated":"2015-03-25T06:34:39.013+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14379380","id":"14379380","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"body":"I checked how this is covered in test cases. _NativeS3FileSystemContractBaseTest#testListStatusForRoot_ looks like a relevant test for s3n. But something similar is not found for s3a.\n\nBut _TestS3AContractRootDir_ is supposed to test this scenario, correct?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-03-25T06:39:42.453+0000","updated":"2015-03-25T06:39:42.453+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14379711","id":"14379711","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"sounds like there's a new test needed in {{AbstractContractRootDirectoryTest}}. Can you include that in the patch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2015-03-25T11:27:48.589+0000","updated":"2015-03-25T11:27:48.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14379712","id":"14379712","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"submitting patch for jenkins -though that does not run the AWS test suite; needs someone to run it themselves","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2015-03-25T11:28:23.519+0000","updated":"2015-03-25T11:28:23.519+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14379768","id":"14379768","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12707152/HADOOP-11742-branch-2.7.001.patch\n  against trunk revision c770df4.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-tools/hadoop-aws.\n\nTest results: https://builds.apache.org/job/PreCommit-HADOOP-Build/5996//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HADOOP-Build/5996//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-25T12:03:45.756+0000","updated":"2015-03-25T12:03:45.756+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14381351","id":"14381351","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"body":"OK, will do. But found the current s3a related unit tests won't finish successfully. Filed as HADOOP-11753. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-03-26T04:33:28.795+0000","updated":"2015-03-26T04:33:28.795+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14381502","id":"14381502","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"body":"I found _AbstractFSContractTestBase#setup_ always creates a test directory, which is removed at _teardown_. Thus, an empty directory was not tested in concrete test cases.\n\nThe problem here is not calling mkdir on an empty bucket. But when you call _S3AFileSystem#getFileStatus(\"/\")_ on an empty bucket, it throws an exception.\n\nTo setup such a condition, I rather chose to remove the test directory at setup, then no-op at teardown.\n\nThen, without this fix, TestS3AContractRootDir failed as follows.\n\n{code}\n-------------------------------------------------------\n T E S T S\n-------------------------------------------------------\nRunning org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir\nTests run: 5, Failures: 0, Errors: 4, Skipped: 0, Time elapsed: 8.027 sec <<< FAILURE! - in org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir\ntestRmEmptyRootDirNonRecursive(org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir)  Time elapsed: 2.82 sec  <<< ERROR!\njava.io.FileNotFoundException: No such file or directory: /\n\tat org.apache.hadoop.fs.s3a.S3AFileSystem.getFileStatus(S3AFileSystem.java:995)\n\tat org.apache.hadoop.fs.s3a.S3AFileSystem.getFileStatus(S3AFileSystem.java:77)\n\tat org.apache.hadoop.fs.contract.ContractTestUtils.assertIsDirectory(ContractTestUtils.java:464)\n\tat org.apache.hadoop.fs.contract.AbstractContractRootDirectoryTest.testRmEmptyRootDirNonRecursive(AbstractContractRootDirectoryTest.java:63)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\n\tat org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:74)\n\ntestRmRootRecursive(org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir)  Time elapsed: 0.475 sec  <<< ERROR!\njava.io.FileNotFoundException: No such file or directory: /\n\tat org.apache.hadoop.fs.s3a.S3AFileSystem.getFileStatus(S3AFileSystem.java:995)\n\tat org.apache.hadoop.fs.s3a.S3AFileSystem.getFileStatus(S3AFileSystem.java:77)\n\tat org.apache.hadoop.fs.contract.ContractTestUtils.assertIsDirectory(ContractTestUtils.java:464)\n\tat org.apache.hadoop.fs.contract.AbstractContractRootDirectoryTest.testRmRootRecursive(AbstractContractRootDirectoryTest.java:96)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\n\tat org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:74)\n\ntestCreateFileOverRoot(org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir)  Time elapsed: 2.922 sec  <<< ERROR!\ncom.amazonaws.services.s3.model.AmazonS3Exception: Status Code: 400, AWS Service: Amazon S3, AWS Request ID: 368CF290D38711E4, AWS Error Code: MalformedXML, AWS Error Message: The XML you provided was not well-formed or did not validate against our published schema.\n\tat com.amazonaws.http.AmazonHttpClient.handleErrorResponse(AmazonHttpClient.java:798)\n\tat com.amazonaws.http.AmazonHttpClient.executeHelper(AmazonHttpClient.java:421)\n\tat com.amazonaws.http.AmazonHttpClient.execute(AmazonHttpClient.java:232)\n\tat com.amazonaws.services.s3.AmazonS3Client.invoke(AmazonS3Client.java:3528)\n\tat com.amazonaws.services.s3.AmazonS3Client.putObject(AmazonS3Client.java:1393)\n\tat com.amazonaws.services.s3.transfer.internal.UploadCallable.uploadInOneChunk(UploadCallable.java:108)\n\tat com.amazonaws.services.s3.transfer.internal.UploadCallable.call(UploadCallable.java:100)\n\tat com.amazonaws.services.s3.transfer.internal.UploadMonitor.upload(UploadMonitor.java:192)\n\tat com.amazonaws.services.s3.transfer.internal.UploadMonitor.call(UploadMonitor.java:150)\n\tat com.amazonaws.services.s3.transfer.internal.UploadMonitor.call(UploadMonitor.java:50)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:744)\n\ntestRmNonEmptyRootDirNonRecursive(org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir)  Time elapsed: 0.533 sec  <<< ERROR!\njava.io.FileNotFoundException: No such file or directory: /\n\tat org.apache.hadoop.fs.s3a.S3AFileSystem.getFileStatus(S3AFileSystem.java:995)\n\tat org.apache.hadoop.fs.s3a.S3AFileSystem.getFileStatus(S3AFileSystem.java:77)\n\tat org.apache.hadoop.fs.contract.ContractTestUtils.assertIsDirectory(ContractTestUtils.java:464)\n\tat org.apache.hadoop.fs.contract.AbstractContractRootDirectoryTest.testRmNonEmptyRootDirNonRecursive(AbstractContractRootDirectoryTest.java:88)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\n\tat org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:74)\n\n\nResults :\n\nTests in error: \n  TestS3AContractRootDir>AbstractContractRootDirectoryTest.testRmEmptyRootDirNonRecursive:63 » FileNotFound\n  TestS3AContractRootDir>AbstractContractRootDirectoryTest.testRmRootRecursive:96 » FileNotFound\n  TestS3AContractRootDir.testCreateFileOverRoot » AmazonS3 Status Code: 400, AWS...\n  TestS3AContractRootDir>AbstractContractRootDirectoryTest.testRmNonEmptyRootDirNonRecursive:88 » FileNotFound\n\nTests run: 5, Failures: 0, Errors: 4, Skipped: 0\n\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n{code}\n\n\nAlso, I modified the fix so that it can tell if the root directory is empty or not.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-03-26T07:25:06.828+0000","updated":"2015-03-26T07:25:06.828+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14381532","id":"14381532","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:green}+1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12707452/HADOOP-11742-branch-2.7.002.patch\n  against trunk revision b4b4fe9.\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:green}+1 tests included{color}.  The patch appears to include 1 new or modified test files.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-tools/hadoop-aws.\n\nTest results: https://builds.apache.org/job/PreCommit-HADOOP-Build/6003//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HADOOP-Build/6003//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-26T08:04:50.626+0000","updated":"2015-03-26T08:04:50.626+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14383747","id":"14383747","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thodemoor","name":"thodemoor","key":"thodemoor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Demoor","active":true,"timeZone":"Europe/Berlin"},"body":"{quote} Then, without this fix, TestS3AContractRootDir failed as follows.{quote}\nAt my end, without the fix, the test passes vs AWS. \n\nWith the fix the test passes as well so what are you fixing? Can you elaborate? Will have a closer look then.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thodemoor","name":"thodemoor","key":"thodemoor","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Demoor","active":true,"timeZone":"Europe/Berlin"},"created":"2015-03-27T12:17:36.290+0000","updated":"2015-03-27T12:17:36.290+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14383779","id":"14383779","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"[~tsato] : whose endpoints are you playing with there? Are these AWS or something of your own. As if its the latter, what's being shown up here is a difference between your impl & AWS. While we'll try and do our best to help, you do have to consider any variation in behaviour a variation between S3 API and your impl —which is really a bug on your end. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2015-03-27T12:45:42.324+0000","updated":"2015-03-27T12:45:42.324+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14386172","id":"14386172","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"body":"Thomas, Steve, yes, again this is against our own. I will check the difference. Let me close.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-03-30T04:25:07.205+0000","updated":"2015-03-30T04:25:07.205+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14386175","id":"14386175","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"body":"Reopen to mark this as invalid.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-03-30T04:27:15.182+0000","updated":"2015-03-30T04:27:15.182+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14391978","id":"14391978","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"body":"I confirmed mkdir fails on an empty bucket for AWS as follows:\n\n1. make sure the bucket is empty, but get an exception\n\n{code}\n# hadoop-2.7.0-SNAPSHOT/bin/hdfs dfs -Dfs.s3a.access.key=ACCESS_KEY -Dfs.s3a.secret.key=SECRET_KEY -ls s3a://s3atest/\n15/04/02 01:49:09 DEBUG http.wire: >> \"HEAD / HTTP/1.1[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: >> \"Host: s3atest.s3.amazonaws.com[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: >> \"Authorization: AWS XXX=[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: >> \"Date: Thu, 02 Apr 2015 01:49:08 GMT[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: >> \"User-Agent: aws-sdk-java/1.7.4 Linux/3.10.0-123.8.1.el7.centos.plus.x86_64 Java_HotSpot(TM)_64-Bit_Server_VM/24.75-b04/1.7.0_75[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: >> \"Content-Type: application/x-www-form-urlencoded; charset=utf-8[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: >> \"Connection: Keep-Alive[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: >> \"[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"HTTP/1.1 200 OK[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"x-amz-id-2: XXX[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"x-amz-request-id: XXX[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"Date: Thu, 02 Apr 2015 01:49:10 GMT[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"Content-Type: application/xml[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"Transfer-Encoding: chunked[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"Server: AmazonS3[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3atest/ ()\n15/04/02 01:49:09 DEBUG http.wire: >> \"GET /?delimiter=%2F&max-keys=1&prefix= HTTP/1.1[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: >> \"Host: s3atest.s3.amazonaws.com[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: >> \"Authorization: AWS XXX=[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: >> \"Date: Thu, 02 Apr 2015 01:49:09 GMT[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: >> \"User-Agent: aws-sdk-java/1.7.4 Linux/3.10.0-123.8.1.el7.centos.plus.x86_64 Java_HotSpot(TM)_64-Bit_Server_VM/24.75-b04/1.7.0_75[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: >> \"Content-Type: application/x-www-form-urlencoded; charset=utf-8[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: >> \"Connection: Keep-Alive[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: >> \"[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"HTTP/1.1 200 OK[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"x-amz-id-2: XXX[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"x-amz-request-id: XXX[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"Date: Thu, 02 Apr 2015 01:49:10 GMT[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"Content-Type: application/xml[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"Transfer-Encoding: chunked[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"Server: AmazonS3[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"fe[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"<?xml version=\"1.0\" encoding=\"UTF-8\"?>[\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"<ListBucketResult xmlns=\"http://s3.amazonaws.com/doc/2006-03-01/\"><Name>s3atest</Name><Prefix></Prefix><Marker></Marker><MaxKeys>1</MaxKeys><Delimiter>/</Delimiter><IsTruncated>false</IsTruncated></ListBucketResult>\"\n15/04/02 01:49:09 DEBUG http.wire: << \"[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"0[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG http.wire: << \"[\\r][\\n]\"\n15/04/02 01:49:09 DEBUG s3a.S3AFileSystem: Not Found: s3a://s3atest/\nls: `s3a://s3atest/': No such file or directory\n{code}\n\n2. create a directory, but get an exception\n\n{code}\n# hadoop-2.7.0-SNAPSHOT/bin/hdfs dfs -Dfs.s3a.access.key=ACCESS_KEY -Dfs.s3a.secret.key=SECRET_KEY -mkdir s3a://s3atest/root\n15/04/02 01:49:41 DEBUG http.wire: >> \"HEAD / HTTP/1.1[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Host: s3atest.s3.amazonaws.com[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Authorization: AWS XXX=[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Date: Thu, 02 Apr 2015 01:49:41 GMT[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"User-Agent: aws-sdk-java/1.7.4 Linux/3.10.0-123.8.1.el7.centos.plus.x86_64 Java_HotSpot(TM)_64-Bit_Server_VM/24.75-b04/1.7.0_75[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Content-Type: application/x-www-form-urlencoded; charset=utf-8[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Connection: Keep-Alive[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"HTTP/1.1 200 OK[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"x-amz-id-2: XXX[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"x-amz-request-id: XXX[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Date: Thu, 02 Apr 2015 01:49:42 GMT[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Content-Type: application/xml[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Transfer-Encoding: chunked[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Server: AmazonS3[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3atest/root (root)\n15/04/02 01:49:41 DEBUG http.wire: >> \"HEAD /root HTTP/1.1[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Host: s3atest.s3.amazonaws.com[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Authorization: AWS XXX=[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Date: Thu, 02 Apr 2015 01:49:41 GMT[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"User-Agent: aws-sdk-java/1.7.4 Linux/3.10.0-123.8.1.el7.centos.plus.x86_64 Java_HotSpot(TM)_64-Bit_Server_VM/24.75-b04/1.7.0_75[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Content-Type: application/x-www-form-urlencoded; charset=utf-8[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Connection: Keep-Alive[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"HTTP/1.1 404 Not Found[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"x-amz-request-id: XXX[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"x-amz-id-2: XXX[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Content-Type: application/xml[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Transfer-Encoding: chunked[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Date: Thu, 02 Apr 2015 01:49:41 GMT[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Server: AmazonS3[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"HEAD /root/ HTTP/1.1[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Host: s3atest.s3.amazonaws.com[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Authorization: AWS XXX=[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Date: Thu, 02 Apr 2015 01:49:41 GMT[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"User-Agent: aws-sdk-java/1.7.4 Linux/3.10.0-123.8.1.el7.centos.plus.x86_64 Java_HotSpot(TM)_64-Bit_Server_VM/24.75-b04/1.7.0_75[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Content-Type: application/x-www-form-urlencoded; charset=utf-8[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Connection: Keep-Alive[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"HTTP/1.1 404 Not Found[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"x-amz-request-id: XXX[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"x-amz-id-2: XXX[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Content-Type: application/xml[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Transfer-Encoding: chunked[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Date: Thu, 02 Apr 2015 01:49:41 GMT[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Server: AmazonS3[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"GET /?delimiter=%2F&max-keys=1&prefix=root%2F HTTP/1.1[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Host: s3atest.s3.amazonaws.com[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Authorization: AWS XXX=[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Date: Thu, 02 Apr 2015 01:49:41 GMT[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"User-Agent: aws-sdk-java/1.7.4 Linux/3.10.0-123.8.1.el7.centos.plus.x86_64 Java_HotSpot(TM)_64-Bit_Server_VM/24.75-b04/1.7.0_75[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Content-Type: application/x-www-form-urlencoded; charset=utf-8[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Connection: Keep-Alive[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"HTTP/1.1 200 OK[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"x-amz-id-2: XXX[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"x-amz-request-id: XXX[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Date: Thu, 02 Apr 2015 01:49:42 GMT[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Content-Type: application/xml[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Transfer-Encoding: chunked[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Server: AmazonS3[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"103[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"<?xml version=\"1.0\" encoding=\"UTF-8\"?>[\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"<ListBucketResult xmlns=\"http://s3.amazonaws.com/doc/2006-03-01/\"><Name>s3atest</Name><Prefix>root/</Prefix><Marker></Marker><MaxKeys>1</MaxKeys><Delimiter>/</Delimiter><IsTruncated>false</IsTruncated></ListBucketResult>\"\n15/04/02 01:49:41 DEBUG http.wire: << \"[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"0[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG s3a.S3AFileSystem: Not Found: s3a://s3atest/root\n15/04/02 01:49:41 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3atest/ ()\n15/04/02 01:49:41 DEBUG http.wire: >> \"GET /?delimiter=%2F&max-keys=1&prefix= HTTP/1.1[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Host: s3atest.s3.amazonaws.com[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Authorization: AWS XXX=[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Date: Thu, 02 Apr 2015 01:49:41 GMT[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"User-Agent: aws-sdk-java/1.7.4 Linux/3.10.0-123.8.1.el7.centos.plus.x86_64 Java_HotSpot(TM)_64-Bit_Server_VM/24.75-b04/1.7.0_75[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Content-Type: application/x-www-form-urlencoded; charset=utf-8[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"Connection: Keep-Alive[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: >> \"[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"HTTP/1.1 200 OK[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"x-amz-id-2: XXX[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"x-amz-request-id: XXX[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Date: Thu, 02 Apr 2015 01:49:42 GMT[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Content-Type: application/xml[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Transfer-Encoding: chunked[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"Server: AmazonS3[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"fe[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"<?xml version=\"1.0\" encoding=\"UTF-8\"?>[\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"<ListBucketResult xmlns=\"http://s3.amazonaws.com/doc/2006-03-01/\"><Name>s3atest</Name><Prefix></Prefix><Marker></Marker><MaxKeys>1</MaxKeys><Delimiter>/</Delimiter><IsTruncated>false</IsTruncated></ListBucketResult>\"\n15/04/02 01:49:41 DEBUG http.wire: << \"[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"0[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG http.wire: << \"[\\r][\\n]\"\n15/04/02 01:49:41 DEBUG s3a.S3AFileSystem: Not Found: s3a://s3atest/\nmkdir: `s3a://s3atest/root': No such file or directory\n{code}\n\nThe fix for the unit test was wrong, but the fix for this problem in _S3AFileSystem#getFileStatus_ is still valid.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-04-02T02:10:13.953+0000","updated":"2015-04-02T02:10:13.953+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14392206","id":"14392206","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"body":"This is the patch to fix _S3AFileSystem#getFileStatus_. The dedicated part to process a root directory was added, which is entered only when key.isEmpty() == true.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-04-02T06:10:29.421+0000","updated":"2015-04-02T06:10:29.421+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14392210","id":"14392210","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"body":"This is the patch to fix the unit test, _AbstractContractRootDirectoryTest_.\n\nChanges are:\n# setup() prepares an empty directory\n# assertion was added to make sure the root dir is empty in testRmEmptyRootDirNonRecursive()\n# teardown() does nothing","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-04-02T06:14:36.684+0000","updated":"2015-04-02T06:14:36.684+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14392231","id":"14392231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"body":"Patches are verified as follows.\n\n1. run TestS3AContractRootDir to see it succeeds\n\n{code}\n-------------------------------------------------------\n T E S T S\n-------------------------------------------------------\nRunning org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir\nTests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 4.855 sec - in org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir\n\nResults :\n\nTests run: 5, Failures: 0, Errors: 0, Skipped: 0\n\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 10.341 s\n[INFO] Finished at: 2015-04-02T05:41:48+00:00\n[INFO] Final Memory: 28M/407M\n[INFO] ------------------------------------------------------------------------\n{code}\n\n2. apply the test patch(003-2), and run TestS3AContractRootDir\n\n{code}\n-------------------------------------------------------\n T E S T S\n-------------------------------------------------------\nRunning org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir\nTests run: 5, Failures: 0, Errors: 4, Skipped: 0, Time elapsed: 21.296 sec <<< FAILURE! - in org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir\ntestRmEmptyRootDirNonRecursive(org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir)  Time elapsed: 4.608 sec  <<< ERROR!\njava.io.FileNotFoundException: No such file or directory: /\n\tat org.apache.hadoop.fs.s3a.S3AFileSystem.getFileStatus(S3AFileSystem.java:996)\n\tat org.apache.hadoop.fs.s3a.S3AFileSystem.getFileStatus(S3AFileSystem.java:77)\n\tat org.apache.hadoop.fs.contract.ContractTestUtils.assertIsDirectory(ContractTestUtils.java:464)\n\tat org.apache.hadoop.fs.contract.AbstractContractRootDirectoryTest.testRmEmptyRootDirNonRecursive(AbstractContractRootDirectoryTest.java:70)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\n\tat org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:74)\n\ntestRmRootRecursive(org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir)  Time elapsed: 2.509 sec  <<< ERROR!\njava.io.FileNotFoundException: No such file or directory: /\n\tat org.apache.hadoop.fs.s3a.S3AFileSystem.getFileStatus(S3AFileSystem.java:996)\n\tat org.apache.hadoop.fs.s3a.S3AFileSystem.getFileStatus(S3AFileSystem.java:77)\n\tat org.apache.hadoop.fs.contract.ContractTestUtils.assertIsDirectory(ContractTestUtils.java:464)\n\tat org.apache.hadoop.fs.contract.AbstractContractRootDirectoryTest.testRmRootRecursive(AbstractContractRootDirectoryTest.java:104)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\n\tat org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:74)\n\ntestCreateFileOverRoot(org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir)  Time elapsed: 3.006 sec  <<< ERROR!\ncom.amazonaws.services.s3.model.AmazonS3Exception: Status Code: 400, AWS Service: Amazon S3, AWS Request ID: 2B352694A5577C62, AWS Error Code: MalformedXML, AWS Error Message: The XML you provided was not well-formed or did not validate against our published schema\n\tat com.amazonaws.http.AmazonHttpClient.handleErrorResponse(AmazonHttpClient.java:798)\n\tat com.amazonaws.http.AmazonHttpClient.executeHelper(AmazonHttpClient.java:421)\n\tat com.amazonaws.http.AmazonHttpClient.execute(AmazonHttpClient.java:232)\n\tat com.amazonaws.services.s3.AmazonS3Client.invoke(AmazonS3Client.java:3528)\n\tat com.amazonaws.services.s3.AmazonS3Client.putObject(AmazonS3Client.java:1393)\n\tat com.amazonaws.services.s3.transfer.internal.UploadCallable.uploadInOneChunk(UploadCallable.java:108)\n\tat com.amazonaws.services.s3.transfer.internal.UploadCallable.call(UploadCallable.java:100)\n\tat com.amazonaws.services.s3.transfer.internal.UploadMonitor.upload(UploadMonitor.java:192)\n\tat com.amazonaws.services.s3.transfer.internal.UploadMonitor.call(UploadMonitor.java:150)\n\tat com.amazonaws.services.s3.transfer.internal.UploadMonitor.call(UploadMonitor.java:50)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:745)\n\ntestRmNonEmptyRootDirNonRecursive(org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir)  Time elapsed: 3.786 sec  <<< ERROR!\njava.io.FileNotFoundException: No such file or directory: /\n\tat org.apache.hadoop.fs.s3a.S3AFileSystem.getFileStatus(S3AFileSystem.java:996)\n\tat org.apache.hadoop.fs.s3a.S3AFileSystem.getFileStatus(S3AFileSystem.java:77)\n\tat org.apache.hadoop.fs.contract.ContractTestUtils.assertIsDirectory(ContractTestUtils.java:464)\n\tat org.apache.hadoop.fs.contract.AbstractContractRootDirectoryTest.testRmNonEmptyRootDirNonRecursive(AbstractContractRootDirectoryTest.java:96)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\n\tat org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:74)\n\n\nResults :\n\nTests in error: \n  TestS3AContractRootDir>AbstractContractRootDirectoryTest.testRmEmptyRootDirNonRecursive:70 » FileNotFound\n  TestS3AContractRootDir>AbstractContractRootDirectoryTest.testRmRootRecursive:104 » FileNotFound\n  TestS3AContractRootDir.testCreateFileOverRoot » AmazonS3 Status Code: 400, AWS...\n  TestS3AContractRootDir>AbstractContractRootDirectoryTest.testRmNonEmptyRootDirNonRecursive:96 » FileNotFound\n\nTests run: 5, Failures: 0, Errors: 4, Skipped: 0\n[INFO] Total time: 26.583 s\n[INFO] Finished at: 2015-04-02T05:57:03+00:00\n[INFO] Final Memory: 28M/407M\n[INFO] ------------------------------------------------------------------------\n{code}\n\n*Note:* you may see a different error(??java.lang.AssertionError: root directory is not empty expected:<0> but was:<1>??) if you run this in US Standard region\n\n3. apply the patch(003-1), and run TestS3AContractRootDir\n\n{code}\n-------------------------------------------------------\n T E S T S\n-------------------------------------------------------\nRunning org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir\nTests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 22.857 sec - in org.apache.hadoop.fs.contract.s3a.TestS3AContractRootDir\n\nResults :\n\nTests run: 5, Failures: 0, Errors: 0, Skipped: 0\n\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 27.970 s\n[INFO] Finished at: 2015-04-02T06:01:00+00:00\n[INFO] Final Memory: 29M/407M\n[INFO] ------------------------------------------------------------------------\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-04-02T06:35:45.074+0000","updated":"2015-04-02T06:35:45.074+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14392251","id":"14392251","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"body":"_mkdir_ and _ls_ worked as expected with the fix.\n\n{code}\n# hadoop-2.7.0-SNAPSHOT/bin/hdfs dfs -Dfs.s3a.access.key=ACCESS_KEY -Dfs.s3a.secret.key=SECRET_KEY -ls s3a://s3atest/\n15/04/02 06:52:55 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3atest/ ()\n15/04/02 06:52:55 DEBUG s3a.S3AFileSystem: s3a://s3atest/ is empty? true\n15/04/02 06:52:55 DEBUG s3a.S3AFileSystem: List status for path: s3a://s3atest/\n15/04/02 06:52:55 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3atest/ ()\n15/04/02 06:52:55 DEBUG s3a.S3AFileSystem: s3a://s3atest/ is empty? true\n15/04/02 06:52:55 DEBUG s3a.S3AFileSystem: listStatus: doing listObjects for directory \n# hadoop-2.7.0-SNAPSHOT/bin/hdfs dfs -Dfs.s3a.access.key=ACCESS_KEY -Dfs.s3a.secret.key=SECRET_KEY -mkdir s3a://s3atest/root\n15/04/02 06:53:20 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3atest/root (root)\n15/04/02 06:53:20 DEBUG s3a.S3AFileSystem: Not Found: s3a://s3atest/root\n15/04/02 06:53:20 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3atest/ ()\n15/04/02 06:53:20 DEBUG s3a.S3AFileSystem: s3a://s3atest/ is empty? true\n15/04/02 06:53:20 DEBUG s3a.S3AFileSystem: Making directory: s3a://s3atest/root\n15/04/02 06:53:20 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3atest/root (root)\n15/04/02 06:53:20 DEBUG s3a.S3AFileSystem: Not Found: s3a://s3atest/root\n15/04/02 06:53:20 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3atest/root (root)\n15/04/02 06:53:20 DEBUG s3a.S3AFileSystem: Not Found: s3a://s3atest/root\n15/04/02 06:53:20 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3atest/ ()\n15/04/02 06:53:20 DEBUG s3a.S3AFileSystem: s3a://s3atest/ is empty? true\n# hadoop-2.7.0-SNAPSHOT/bin/hdfs dfs -Dfs.s3a.access.key=ACCESS_KEY -Dfs.s3a.secret.key=SECRET_KEY -ls s3a://s3atest/\n15/04/02 06:53:26 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3atest/ ()\n15/04/02 06:53:26 DEBUG s3a.S3AFileSystem: s3a://s3atest/ is empty? false\n15/04/02 06:53:26 DEBUG s3a.S3AFileSystem: List status for path: s3a://s3atest/\n15/04/02 06:53:26 DEBUG s3a.S3AFileSystem: Getting path status for s3a://s3atest/ ()\n15/04/02 06:53:26 DEBUG s3a.S3AFileSystem: s3a://s3atest/ is empty? false\n15/04/02 06:53:26 DEBUG s3a.S3AFileSystem: listStatus: doing listObjects for directory \n15/04/02 06:53:26 DEBUG s3a.S3AFileSystem: Adding: rd: s3a://s3atest/root\nFound 1 items\ndrwxrwxrwx   -          0 1970-01-01 00:00 s3a://s3atest/root \n{code}\n\nThe created directory didn't become visible immediately. But the successive _ls_ showed it was successful.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsato","name":"tsato","key":"tsato","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Takenori Sato","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-04-02T07:00:09.655+0000","updated":"2015-04-02T07:00:09.655+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12785074/comment/14744323","id":"14744323","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm resolving this as a duplicate of HADOOP-11918.  Reading through the history on both issues, it appears that there is more recent activity on HADOOP-11918, and the patch there is closer to acceptance.  (If I'm mistaken, then please feel free to reopen this.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-09-14T21:37:15.341+0000","updated":"2015-09-14T21:37:15.341+0000"}],"maxResults":18,"total":18,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-11742/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i279gn:"}}