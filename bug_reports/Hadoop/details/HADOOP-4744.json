{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12409539","self":"https://issues.apache.org/jira/rest/api/2/issue/12409539","key":"HADOOP-4744","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313438","id":"12313438","description":"","name":"0.20.0","archived":false,"released":true,"releaseDate":"2009-04-22"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-12-01T10:46:11.674+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri May 08 19:55:59 UTC 2009","customfield_12310420":"126707","customfield_12312320":null,"customfield_12310222":"10002_*:*_2_*:*_1001097017_*|*_1_*:*_2_*:*_6861835104_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2009-03-02T10:37:50.121+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-4744/watchers","watchCount":6,"isWatching":false},"created":"2008-12-01T10:28:58.974+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313438","id":"12313438","description":"","name":"0.20.0","archived":false,"released":true,"releaseDate":"2009-04-22"}],"issuelinks":[{"id":"12327820","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12327820","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12440625","key":"HADOOP-6386","self":"https://issues.apache.org/jira/rest/api/2/issue/12440625","fields":{"summary":"NameNode's HttpServer can't instantiate InetSocketAddress: IllegalArgumentException is thrown","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jothipn","name":"jothipn","key":"jothipn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jothi Padmanabhan","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-11-14T02:12:50.762+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"I noticed the following for one of the hosts in a cluster:\n\n1. machines.jsp page resolves the http address as just \"http://hostname\" (which doesn't work). It doesnt put the port number for the host. Even if I add the port number manually in the URI, the  task tracker page does not come up. \n2. All the tasks(both maps and reduces) which ran on the machine ran successfully. But tasklogs cannot be viewed, because port-number is not resolved. ( same problem as in (1)).\n3. The reducers waiting for maps ran on that machine fail with connection failed errors saying the hostname is 'null'.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12400767","id":"12400767","filename":"4744.exception.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-02-23T16:35:14.202+0000","size":849,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12400767/4744.exception.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12400434","id":"12400434","filename":"4744.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-02-18T18:31:13.510+0000","size":1024,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12400434/4744.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12407456","id":"12407456","filename":"4744.reopened.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-05-07T12:30:41.159+0000","size":2490,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12407456/4744.reopened.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12407374","id":"12407374","filename":"4744.reopened.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-05-06T16:21:26.288+0000","size":1897,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12407374/4744.reopened.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12401100","id":"12401100","filename":"hadoop-4744-new.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jothipn","name":"jothipn","key":"jothipn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jothi Padmanabhan","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-27T11:05:39.799+0000","size":3966,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12401100/hadoop-4744-new.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"104139","customfield_12312823":null,"summary":"Wrong resolution of hostname and port ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12651960","id":"12651960","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"body":"The log for the reducer waiting for map on the machine:\n2008-12-01 10:00:19,501 INFO org.apache.hadoop.mapred.ReduceTask: Task attempt_200812010806_0337_r_000000_1: Failed fetch #3 from attempt_200812010806_0337_m_002787_0\n2008-12-01 10:00:19,501 WARN org.apache.hadoop.mapred.ReduceTask: attempt_200812010806_0337_r_000000_1 adding host null to penalty box, next contact in 16 seconds\n2008-12-01 10:00:20,503 INFO org.apache.hadoop.mapred.ReduceTask: attempt_200812010806_0337_r_000000_1: Got 1 map-outputs from previous failures\n2008-12-01 10:00:35,510 INFO org.apache.hadoop.mapred.ReduceTask: attempt_200812010806_0337_r_000000_1 Need another 2 map output(s) where 0 is already in progress\n2008-12-01 10:00:35,511 INFO org.apache.hadoop.mapred.ReduceTask: attempt_200812010806_0337_r_000000_1: Got 0 new map-outputs\n2008-12-01 10:00:35,511 INFO org.apache.hadoop.mapred.ReduceTask: attempt_200812010806_0337_r_000000_1 Scheduled 1 outputs (0 slow hosts and0 dup hosts)\n2008-12-01 10:00:35,516 WARN org.apache.hadoop.mapred.ReduceTask: attempt_200812010806_0337_r_000000_1 copy failed: attempt_200812010806_0337_m_002787_0 from null\n2008-12-01 10:00:35,518 WARN org.apache.hadoop.mapred.ReduceTask: java.net.ConnectException: Connection refused\n\tat java.net.PlainSocketImpl.socketConnect(Native Method)\n\tat java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)\n\tat java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)\n\tat java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)\n\tat java.net.Socket.connect(Socket.java:519)\n\tat sun.net.NetworkClient.doConnect(NetworkClient.java:152)\n\tat sun.net.www.http.HttpClient.openServer(HttpClient.java:394)\n\tat sun.net.www.http.HttpClient.openServer(HttpClient.java:529)\n\tat sun.net.www.http.HttpClient.<init>(HttpClient.java:233)\n\tat sun.net.www.http.HttpClient.New(HttpClient.java:306)\n\tat sun.net.www.http.HttpClient.New(HttpClient.java:323)\n\tat sun.net.www.protocol.http.HttpURLConnection.getNewHttpClient(HttpURLConnection.java:788)\n\tat sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:729)\n\tat sun.net.www.protocol.http.HttpURLConnection.connect(HttpURLConnection.java:654)\n\tat org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.getInputStream(ReduceTask.java:1312)\n\tat org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.getMapOutput(ReduceTask.java:1250)\n\tat org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.copyOutput(ReduceTask.java:1163)\n\tat org.apache.hadoop.mapred.ReduceTask$ReduceCopier$MapOutputCopier.run(ReduceTask.java:1100)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amareshwari","name":"amareshwari","key":"amareshwari","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amareshwari Sriramadasu","active":true,"timeZone":"Asia/Kolkata"},"created":"2008-12-01T10:33:20.134+0000","updated":"2008-12-01T10:33:20.134+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12651963","id":"12651963","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jothipn","name":"jothipn","key":"jothipn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jothi Padmanabhan","active":true,"timeZone":"Etc/UTC"},"body":"I observed this behavior too, so this is not a one-off issue.\n\nThe  code to obtain host from the MapCompletionEvent is\n{code}\n          URI u = URI.create(event.getTaskTrackerHttp());\n            String host = u.getHost();\n{code}\n\nFor some reason, host is returned as null. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jothipn","name":"jothipn","key":"jothipn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jothi Padmanabhan","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-01T10:46:11.674+0000","updated":"2008-12-01T10:46:11.674+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12652441","id":"12652441","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"Marking this issue a blocker for 0.20.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2008-12-02T18:06:07.760+0000","updated":"2008-12-02T18:06:07.760+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12655719","id":"12655719","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"Observed that this happens whenever the HttpServer.getPort() (that internally calls webServer.getConnectors()[0].getLocalPort()) returns a -1. In the TaskTracker logs for this particular node, it seems jetty could successfully bind to a valid port. The question is why would jetty return a -1 when it is queried. Could it be a race condition in jetty to do with storing the port number in a particular field. Or, does jetty bind to the port asynchronously (putting it in another way, is webServer.start a blocking call) ? Note that we are passing 0 as the port# to bind to, which means it should bind to an OS assigned port...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2008-12-11T18:00:47.844+0000","updated":"2008-12-11T18:00:47.844+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12655933","id":"12655933","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyu","name":"dyu","key":"dyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Yu","active":true,"timeZone":"Asia/Shanghai"},"body":"It means that the ServerSocketChannel has not yet been opened. (assuming that you're using jetty's nio connector)\nThe call should be done after Connector.open() or perhaps Connector.start() has been called.\n\nCheers,\ndyu","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyu","name":"dyu","key":"dyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Yu","active":true,"timeZone":"Asia/Shanghai"},"created":"2008-12-12T08:56:29.828+0000","updated":"2008-12-12T08:56:29.828+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12655934","id":"12655934","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyu","name":"dyu","key":"dyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Yu","active":true,"timeZone":"Asia/Shanghai"},"body":"It seems you're calling the wrong method if you wanted the port to which the connector listens.\nUse connector.getPort() instead of connector.getLocalPort()\n\nCheers","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyu","name":"dyu","key":"dyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Yu","active":true,"timeZone":"Asia/Shanghai"},"created":"2008-12-12T08:59:30.464+0000","updated":"2008-12-12T08:59:30.464+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12655937","id":"12655937","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gregw","name":"gregw","key":"gregw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Wilkins","active":true,"timeZone":"Etc/UTC"},"body":"Just to clarify the dfference between getPort() and getLocalPort().\ngetPort() returns the configured port, which may be 0 if there is no proference.\ngetLocalPort get's the actual bound port, which may be randomly allocated.\n\nconnector.open() should do the binding and allocate the port, which getLocalPort() can\nreturn.\n\nThe socket is not put into async mode until after the bind, so there should be no race.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gregw","name":"gregw","key":"gregw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Wilkins","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-12T09:25:56.207+0000","updated":"2008-12-12T09:25:56.207+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12656125","id":"12656125","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"Just to clarify things. The sequeunce of calls that are made are (details in src/core/org/apache/hadoop/http/HttpServer.java) listed below. Please see if something is missing or is incorrect in the sequence below.\n\n{code}\n\n    Server webServer = new org.mortbay.jetty.Server();\n\n    Connector listener = new SelectChannelConnector();\n\n    listener.setLowResourceMaxIdleTime(10000);\n    listener.setAcceptQueueSize(128);\n    listener.setResolveNames(false);\n    listener.setUseDirectBuffers(false);\n    listener.setHost(bindAddress);\n    listener.setPort(port); //THE PORT PASSED IS 0\n\n    webServer.addConnector(listener);\n   //other webServer initialization follows...\n   //...\n\n   webServer.start();\n\n   port = webServer.getConnectors()[0].getLocalPort(); //CAN THIS RETURN -1\n\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2008-12-12T19:38:37.905+0000","updated":"2008-12-12T19:38:37.905+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12660266","id":"12660266","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jothipn","name":"jothipn","key":"jothipn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jothi Padmanabhan","active":true,"timeZone":"Etc/UTC"},"body":"I printed the port number returned by getPort (which internally calls getLocalPort) in TaskTracker.java after we do the server.start. It did print -1.  A brief perusal of  org.mortbay.jetty.Server.java shows that connectors.start is called from inside server.start. David/Greg, could you confirm if  this  is correct?  Is there some timing issue involved somewhere where the port is still not set before the Server.start is returned? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jothipn","name":"jothipn","key":"jothipn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jothi Padmanabhan","active":true,"timeZone":"Etc/UTC"},"created":"2009-01-02T04:59:27.132+0000","updated":"2009-01-02T04:59:27.132+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12660273","id":"12660273","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyu","name":"dyu","key":"dyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Yu","active":true,"timeZone":"Asia/Shanghai"},"body":"I've tried the snippet that Devaraj Das posted ..did not ever get -1.\nJothi, right before the println on the port, can you do:\nSystem.err.println(\"open: \" + ((ServerSocketChannel)webServer.getConnectors()[0].getConnection()).isOpen());\n\nMore like ... was the socket channel open when it returned -1?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyu","name":"dyu","key":"dyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Yu","active":true,"timeZone":"Asia/Shanghai"},"created":"2009-01-02T08:35:15.608+0000","updated":"2009-01-02T08:35:15.608+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12660275","id":"12660275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"David, I forgot to mention that this happens on only a few machines on our big clusters. It is not easily reproducible.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-01-02T08:45:49.025+0000","updated":"2009-01-02T08:45:49.025+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12674686","id":"12674686","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"I have a workaround patch that just invokes System.exit at the TT when it discovers that the port returned is -1. Since we see the problem on only a very few trackers on startup (like 1 in 500), I propose that we live with this workaround until jetty provides the actual fix. This problem is tracked in http://jira.codehaus.org/browse/JETTY-748 as well. I will submit the workaround soon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-02-18T16:36:18.190+0000","updated":"2009-02-18T16:36:18.190+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12674724","id":"12674724","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"Attaching the workaround patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-02-18T18:31:13.552+0000","updated":"2009-02-18T18:31:13.552+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12674840","id":"12674840","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12400434/4744.patch\n  against trunk revision 745268.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no tests are needed for this patch.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    -1 findbugs.  The patch appears to introduce 1 new Findbugs warnings.\n\n    +1 Eclipse classpath. The patch retains Eclipse classpath integrity.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3878/testReport/\nFindbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3878/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nCheckstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3878/artifact/trunk/build/test/checkstyle-errors.html\nConsole output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3878/console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-19T00:50:21.103+0000","updated":"2009-02-19T00:50:21.103+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12675763","id":"12675763","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acmurthy","name":"acmurthy","key":"acmurthy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun C Murthy","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-02-23T04:29:58.494+0000","updated":"2009-02-23T04:29:58.494+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12675844","id":"12675844","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"\n`ant test` passed locally. `ant test-patch` passed everything but findBugs. Here's the warning:\n{code}\n  Dm                       org.apache.hadoop.http.HttpServer.getPort() invokes System.exit(...), which shuts down the entire virtual machine\n                                              In class org.apache.hadoop.http.HttpServer\n                                              In method org.apache.hadoop.http.HttpServer.getPort()\n                                              At HttpServer.java:[line 350]\n{code}\nAnd the reason stated is : \n{code}\nDM_EXIT: Method invokes System.exit(...)\nInvoking System.exit shuts down the entire Java virtual machine. This\n   should only been done when it is appropriate. Such calls make it\n   hard or impossible for your code to be invoked by other code.\n   Consider throwing a RuntimeException instead\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-02-23T10:35:50.201+0000","updated":"2009-02-23T10:35:50.201+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12675859","id":"12675859","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"I just committed the workaround patch to the 0.20 and 0.21 branches but I am leaving the issue open for now (with the hope that we will get a fix from the jetty folks). I am ignoring the warning to do with invoking System.exit. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-02-23T11:55:45.768+0000","updated":"2009-02-23T11:55:45.768+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12675866","id":"12675866","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyu","name":"dyu","key":"dyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Yu","active":true,"timeZone":"Asia/Shanghai"},"body":"Its pretty hard to fix a bug (not even 100% sure this is a jetty bug) that cannot be replicated.\nIf you could provide a small sample webapp that could possibly produce the same error, then than would speed things up.\n\nCheers","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyu","name":"dyu","key":"dyu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Yu","active":true,"timeZone":"Asia/Shanghai"},"created":"2009-02-23T12:07:22.962+0000","updated":"2009-02-23T12:07:22.962+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12675876","id":"12675876","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"It would be better to throw an exception than exit. Those of us who trap all System.exit calls from inside Hadoop will only intercept and discard the call from the security manager. The calling code could recognise this event and do the shutdown itself.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-23T12:33:34.115+0000","updated":"2009-02-23T12:33:34.115+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12675924","id":"12675924","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-trunk #763 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-trunk/763/])\n    . Workaround for jetty6 returning -1 when getLocalPort is invoked on the connector. The workaround patch takes the most conservative approach of killing the server process whenever this is true. Contributed by Devaraj Das.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-23T15:17:22.950+0000","updated":"2009-02-23T15:17:22.950+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12675965","id":"12675965","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"Ok, here is a patch that throws an exception when there is a problem in the start of jetty server. The earlier patch can be reverted and this patch can be committed instead.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-02-23T16:35:14.246+0000","updated":"2009-02-23T16:35:14.246+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12675967","id":"12675967","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"David, we see this problem on one or two machines in a 2000 node cluster. So I guess if you run the code snippet i had commented with earlier in a tight loop, you might hit the problem..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-02-23T16:37:44.503+0000","updated":"2009-02-23T16:37:44.503+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12676915","id":"12676915","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gregw","name":"gregw","key":"gregw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Wilkins","active":true,"timeZone":"Etc/UTC"},"body":"\nA couple of comments on the patches I've seen for this.\n\nFirstly, I still don't understand how this is happening, unless there is a race inside the JVM socket layer.  Jetty's code here is \nsynchronous, so it is not a memory caching issue and in your code it is the one thread that does the bind and then the \ngetLocalPort.\n\nBut I'll believe you that it is happening.  So a couple of comments about the patch.\n\nIt is possible to call open on a connector(listener) before start, so that it does the bind early.  So rather than \nstarting the whole server, detecting failure and then trying again, I would make your init code call open directly\non the listener.\n\nYou appear to be trying to search for a free port with:\n        listener.setPort(listener.getLocalPort() + 1);\nbut  getLocalPort() is returning -1, so will always set 0.\n\nBut setting 0 as the port is probably want to want to do in the first place.  The semantics of setting 0 is that\nthe operating system will pick a free port for you, so you probably want to start with that.\n\nIf you still get -1 as the return, then I would suspect a race in the JVM library.  So rather than stopping and relooping,\nit might be worthwhile to sleep for a little bit and try getLocalPort again.  Only if it then returns -1 should you \ncall close on the connector.\n\nSo in psuedo code I would write your start method like:\n\n<pre>\nstart()\n{\n      listener.open();\n      int port = listener.getLocalPort();\n      if (port<0)\n      {\n           Thread.sleep(100);\n           while (port<0)\n           {\n               if (retries++>limit)\n                   throw new NastyException()\n               listener.close();\n               listener.open();\n               Thread.sleep(100);\n               port = listener.getLocalPort();\n          }\n      }\n\n     server.start();\n</pre>\n\nIe, you are just cycling the connector/listener until you get a port, rather than cycling the\nwhole server.\n\n\n\n\n\n\n\n\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gregw","name":"gregw","key":"gregw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Wilkins","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-26T08:31:01.692+0000","updated":"2009-02-26T08:31:01.692+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12677253","id":"12677253","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"I am assigning this to Jothi since I am going to be out for the next couple of days...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-02-27T05:48:30.101+0000","updated":"2009-02-27T05:48:30.101+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12677318","id":"12677318","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jothipn","name":"jothipn","key":"jothipn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jothi Padmanabhan","active":true,"timeZone":"Etc/UTC"},"body":"Attaching a patch with changes suggested","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jothipn","name":"jothipn","key":"jothipn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jothi Padmanabhan","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-27T11:05:39.836+0000","updated":"2009-02-27T11:05:39.836+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12677322","id":"12677322","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gregw","name":"gregw","key":"gregw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Wilkins","active":true,"timeZone":"Etc/UTC"},"body":"Jothi,\n\nlatest patch looks about right.\n\nHowever, it would be really interesting to include some logging in it to gather a bit more information about the -1 return.\n\nSpecifically, I'm interested if the pause after an initial -1 return is sufficient to get a non -1 port.  If so, then there is \ndefinitely a race or memory barrier problem within the JVM.    If you you have to close and reopen to be \nsuccessful, then something else is going on.\n\nSo I'd be hopeful this code will work around the issue, but as it is a kind of ugly thing to do, it would be good to\nfind out more.\n\ncheers\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gregw","name":"gregw","key":"gregw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Wilkins","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-27T11:17:27.454+0000","updated":"2009-02-27T11:17:27.454+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12677758","id":"12677758","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"-1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12401100/hadoop-4744-new.patch\n  against trunk revision 748861.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    -1 tests included.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no tests are needed for this patch.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs warnings.\n\n    +1 Eclipse classpath. The patch retains Eclipse classpath integrity.\n\n    +1 release audit.  The applied patch does not increase the total number of release audit warnings.\n\n    -1 core tests.  The patch failed core unit tests.\n\n    -1 contrib tests.  The patch failed contrib unit tests.\n\nTest results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/22/testReport/\nFindbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/22/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nCheckstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/22/artifact/trunk/build/test/checkstyle-errors.html\nConsole output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-vesta.apache.org/22/console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-01T02:06:28.257+0000","updated":"2009-03-01T02:06:28.257+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12677893","id":"12677893","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jothipn","name":"jothipn","key":"jothipn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jothi Padmanabhan","active":true,"timeZone":"Etc/UTC"},"body":"Test failures org.apache.hadoop.http.TestServletFilter.testServletFilter and org.apache.hadoop.chukwa.datacollection.adaptor.filetailer.TestStartAtOffset.testStartAtOffset are unrelated to this patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jothipn","name":"jothipn","key":"jothipn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jothi Padmanabhan","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-02T05:36:53.270+0000","updated":"2009-03-02T05:36:53.270+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12677924","id":"12677924","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jothipn","name":"jothipn","key":"jothipn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jothi Padmanabhan","active":true,"timeZone":"Etc/UTC"},"body":"Had on an offline discussion with Greg --  we can get  information on which call returned non -1 port from the number of debug messages already present in the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jothipn","name":"jothipn","key":"jothipn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jothi Padmanabhan","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-02T08:33:26.244+0000","updated":"2009-03-02T08:33:26.244+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12677950","id":"12677950","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"body":"I committed the latest patch to trunk and the 0.20 branch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"created":"2009-03-02T10:37:50.081+0000","updated":"2009-03-02T10:37:50.081+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12681790","id":"12681790","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-trunk #778 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-trunk/778/])\n    ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2009-03-13T15:05:20.473+0000","updated":"2009-03-13T15:05:20.473+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12706487","id":"12706487","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"Looks like the jetty bounce code is not working as expected. Specifically, this is what is observed:\n1) In HttpServer.java::start(), after the call to listener.open(), the listener.getLocalPort() returns a seemingly right port number\n2) After the above, in TaskTracker.java, the call to HttpServer.getPort() returns a -1. (HttpServer.getPort() invokes listener.getLocalPort() indirectly)\n\nWhen this happens, we manually checked whether jetty actually bound to the port that it claimed in (1), and we saw that jetty didn't bind to any port at all! So it is a complete mystery how the call getLocalPort could return two different values at two different times. \n\nThis patch tries to work around the problem by shutting down the TaskTracker process if and when (2) happens. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-05-06T16:21:26.328+0000","updated":"2009-05-06T16:21:26.328+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12706788","id":"12706788","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"Could the new patch throw an exception instead? As the hadoop-4744-new.patch did? That means that however the TT is executed -and that included under junit- the failure is caught at the right layer of code, instead of having methods acrosss the codebase deciding when to exit the JVM. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2009-05-07T10:20:18.862+0000","updated":"2009-05-07T10:20:18.862+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12706820","id":"12706820","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"This addresses Steve's concern. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-05-07T12:30:41.586+0000","updated":"2009-05-07T12:30:41.586+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12706876","id":"12706876","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"body":"looks good to me, +1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_l","name":"steve_l","key":"steve_l","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Loughran","active":true,"timeZone":"Etc/UTC"},"created":"2009-05-07T13:19:11.801+0000","updated":"2009-05-07T13:19:11.801+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12707241","id":"12707241","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"body":"I just committed this patch (on the 0.20 branch also).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=devaraj","name":"devaraj","key":"devaraj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Devaraj Das","active":true,"timeZone":"Pacific/Pitcairn"},"created":"2009-05-08T05:32:10.108+0000","updated":"2009-05-08T05:32:10.108+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12409539/comment/12707497","id":"12707497","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in Hadoop-trunk #830 (See [http://hudson.zones.apache.org/hudson/job/Hadoop-trunk/830/])\n    . Attaching another fix to the jetty port issue. The TaskTracker kills itself if it ever discovers that the port to which jetty is actuallybound is invalid (-1). Contributed by Devaraj Das.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2009-05-08T19:55:59.202+0000","updated":"2009-05-08T19:55:59.202+0000"}],"maxResults":37,"total":37,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-4744/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0i6g7:"}}