{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13065433","self":"https://issues.apache.org/jira/rest/api/2/issue/13065433","key":"HADOOP-14331","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":null,"customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Apr 20 08:18:58 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-14331/watchers","watchCount":6,"isWatching":false},"created":"2017-04-20T08:13:32.481+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329058","id":"12329058","description":"2.8.0 release","name":"2.8.0","archived":false,"released":true,"releaseDate":"2017-03-22"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12335733","id":"12335733","description":"3.0.0-alpha1 release","name":"3.0.0-alpha1","archived":false,"released":true,"releaseDate":"2016-09-03"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabriel.reid","name":"gabriel.reid","key":"gabriel.reid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gabriel.reid&avatarId=15044","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gabriel.reid&avatarId=15044","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gabriel.reid&avatarId=15044","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gabriel.reid&avatarId=15044"},"displayName":"Gabriel Reid","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-09-11T05:24:33.841+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12330961","id":"12330961","name":"common"}],"timeoriginalestimate":null,"description":"The HadoopScheduledThreadPoolExecutor (introduced in HADOOP-12749) is broken for the scheduling of periodic tasks (i.e. for tasks submitted with {{scheduleAtFixedRate}} and {{scheduleAfterFixedDelay}}).\n\nThe behavior of the executor with these methods is that the underlying task is executed once, and then blocks the running thread indefinitely in {{ExecutorHelper::logThrowableFromAfterExecute}}, meaning further executions of the task won't run, and will also block the running thread from running any other tasks.\n\nA quick scan of the source has shown me that these methods are used on HadoopScheduledThreadPoolExecutor instances in several places in the code base, at least in {{JobHistory}} and {{CleanerService}}, which appears to mean that these classes also no longer function correctly.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341091","id":"12341091","name":"2.8.3","archived":false,"released":true,"releaseDate":"2017-12-12"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12864215","id":"12864215","filename":"HADOOP-14331_demonstrate_bug.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabriel.reid","name":"gabriel.reid","key":"gabriel.reid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gabriel.reid&avatarId=15044","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gabriel.reid&avatarId=15044","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gabriel.reid&avatarId=15044","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gabriel.reid&avatarId=15044"},"displayName":"Gabriel Reid","active":true,"timeZone":"Europe/Berlin"},"created":"2017-04-20T08:16:28.870+0000","size":3269,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12864215/HADOOP-14331_demonstrate_bug.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"HadoopScheduledThreadPoolExecutor broken for periodic task running","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabriel.reid","name":"gabriel.reid","key":"gabriel.reid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gabriel.reid&avatarId=15044","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gabriel.reid&avatarId=15044","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gabriel.reid&avatarId=15044","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gabriel.reid&avatarId=15044"},"displayName":"Gabriel Reid","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabriel.reid","name":"gabriel.reid","key":"gabriel.reid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gabriel.reid&avatarId=15044","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gabriel.reid&avatarId=15044","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gabriel.reid&avatarId=15044","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gabriel.reid&avatarId=15044"},"displayName":"Gabriel Reid","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13065433/comment/15976285","id":"15976285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabriel.reid","name":"gabriel.reid","key":"gabriel.reid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gabriel.reid&avatarId=15044","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gabriel.reid&avatarId=15044","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gabriel.reid&avatarId=15044","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gabriel.reid&avatarId=15044"},"displayName":"Gabriel Reid","active":true,"timeZone":"Europe/Berlin"},"body":"Patch that includes unit tests which demonstrate the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabriel.reid","name":"gabriel.reid","key":"gabriel.reid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gabriel.reid&avatarId=15044","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gabriel.reid&avatarId=15044","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gabriel.reid&avatarId=15044","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gabriel.reid&avatarId=15044"},"displayName":"Gabriel Reid","active":true,"timeZone":"Europe/Berlin"},"created":"2017-04-20T08:16:28.876+0000","updated":"2017-04-20T08:16:28.876+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13065433/comment/15976291","id":"15976291","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabriel.reid","name":"gabriel.reid","key":"gabriel.reid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gabriel.reid&avatarId=15044","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gabriel.reid&avatarId=15044","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gabriel.reid&avatarId=15044","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gabriel.reid&avatarId=15044"},"displayName":"Gabriel Reid","active":true,"timeZone":"Europe/Berlin"},"body":"FWIW, I discovered this issue when I started leveraging the code in HadoopScheduledThreadPoolExecutor for an external project. I made a few unsuccessful attempts to fix the issue in the code as it's currently implemented, but in the end found that it was a lot easier to just re-implement HadoopScheduledThreadPoolExecutor and HadoopThreadPoolExecutor to just wrap all submitted Runnables and Callables with a wrapper which catches and logs any exception thrown from the underlying Runnable/Callable. \n\nThis is the approach that I would suggest here -- if that sounds good, let me know and I'll add a patch to do this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gabriel.reid","name":"gabriel.reid","key":"gabriel.reid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gabriel.reid&avatarId=15044","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gabriel.reid&avatarId=15044","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gabriel.reid&avatarId=15044","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gabriel.reid&avatarId=15044"},"displayName":"Gabriel Reid","active":true,"timeZone":"Europe/Berlin"},"created":"2017-04-20T08:18:58.947+0000","updated":"2017-04-20T08:18:58.947+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-14331/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3duqn:"}}