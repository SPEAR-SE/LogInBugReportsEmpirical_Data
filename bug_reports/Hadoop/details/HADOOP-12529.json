{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12909099","self":"https://issues.apache.org/jira/rest/api/2/issue/12909099","key":"HADOOP-12529","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-10-30T09:27:11.572+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Nov 02 20:39:29 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-12529/watchers","watchCount":9,"isWatching":false},"created":"2015-10-30T02:37:11.199+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12331977","id":"12331977","description":"2.7.1 release","name":"2.7.1","archived":false,"released":true,"releaseDate":"2015-07-06"}],"issuelinks":[{"id":"12447486","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12447486","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12460872","key":"HADOOP-6670","self":"https://issues.apache.org/jira/rest/api/2/issue/12460872","fields":{"summary":"UserGroupInformation doesn't support use in hash tables","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-11-02T20:39:29.660+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312526","id":"12312526","name":"security"}],"timeoriginalestimate":null,"description":"\n my question is    why UserGroupInformation equals method depend on the subject object?\n\n\n       try below code which is extract from HiveMetaStore:\n{code:title=TestUgi.java|borderStyle=solid}\nUserGroupInformation clientUgi = null;\nUserGroupInformation clientUgi2 = null;\ntry {\nclientUgi = UserGroupInformation.createProxyUser(\"user2\", UserGroupInformation.getLoginUser());\nclientUgi2 = UserGroupInformation.createProxyUser(\"user2\", UserGroupInformation.getLoginUser());\nif (clientUgi.equals(clientUgi2)) {\nSystem.out.println(\"==\");\n} else {\nSystem.out.println(\"!=\");           //  strangely  this will be hit\n}\n} catch (IOException e1) {\ne1.printStackTrace();\n}\n{code}\n      i found that it is because the equal method from UserGroupInformation is compare on subject object ref : subject == ((UserGroupInformation) o).subject;  .    \n\n     as you know,   ipc.Client connect to namenode,   connections.get(ConnectionId)    this code will try to reuse the same socket to namenode, but because of ConnectionId's equal depend on ugi equal, which will cause connections.get(ConnectionId) cann't get the same socket,   suppose many connect to HiveMetaStore, then many connection to Namenode will established.\n\n      so my doubts is why UserGroupInformation is compare on subject object ref : subject == ((UserGroupInformation) o).subject,   it should compare on subject's principal,  am i right?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"UserGroupInformation equals method depend on the subject object address","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wenli","name":"wenli","key":"wenli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangwenli","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wenli","name":"wenli","key":"wenli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangwenli","active":true,"timeZone":"Asia/Shanghai"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12909099/comment/14981759","id":"14981759","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wenli","name":"wenli","key":"wenli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangwenli","active":true,"timeZone":"Asia/Shanghai"},"body":"thanks [~benoyantony][~cnauroth]replied on the mail list:\nhttp://mail-archives.apache.org/mod_mbox/hive-user/201510.mbox/%3C737D5E42ADDB2C4E96DAF6A8900D75FE720EAB4D@szxema508-mbs.china.huawei.com%3E","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wenli","name":"wenli","key":"wenli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"wangwenli","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-10-30T02:39:45.837+0000","updated":"2015-10-30T02:39:45.837+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12909099/comment/14982219","id":"14982219","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhangyongxyz","name":"zhangyongxyz","key":"zhangyongxyz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Yong Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"Is UserGroupInformation.user OK for comparing?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhangyongxyz","name":"zhangyongxyz","key":"zhangyongxyz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Yong Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-10-30T09:27:11.572+0000","updated":"2015-10-30T09:27:11.572+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12909099/comment/14982805","id":"14982805","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Repeating my comment on the mailing list thread:\n\nThis sounds like potentially a dangerous change in the general case.  If there are 2 different\nSubjects/UGIs with the same principal, but different credentials attached, then an equality\ncheck on principal alone could cause a get from the FileSystem cache or IPC client connection\ncache to return an instance with incorrect credentials.\n\nThis might be just a theoretical concern on my part.  For the case of proxy users, perhaps\nan optimization is appropriate, since the proxied user's credentials are not in play anyway.\n\nbq. Is UserGroupInformation.user OK for comparing?\n\nMy concerns above would apply to this proposal too.  I think of the Hadoop {{UserGroupInformation}} class as an abstraction over the JDK {{Subject}} and the Hadoop {{User}} class as an abstraction over the JDK {{Principal}}.  For 2 different instances of {{UserGroupInformation}}/{{Subject}}, even if they have the same {{User}}/{{Principal}}, they are not necessarily equal if there are different credentials attached to the 2 instances of {{UserGroupInformation}}/{{Subject}}.  That means there would be at least a theoretical possibility of introducing bugs related to pulling a {{FileSystem}} or RPC {{Connection}} out of the cache with the wrong credentials.  I don't know if any code paths really do this, but we need to be wary of it.  The effect of such a bug would be either an incorrect access denied, or worse, privilege escalation.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-30T16:27:25.428+0000","updated":"2015-10-30T16:27:25.428+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12909099/comment/14982863","id":"14982863","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"body":"Why cant we just use as below \n{code}  /**\n   * Compare the subjects to see if they are equal to each other.\n   */\n  @Override\n  public boolean equals(Object o) {\n    if (o == this) {\n      return true;\n    } else if (o == null || getClass() != o.getClass()) {\n      return false;\n    } else {\n      return subject.equals(((UserGroupInformation) o).subject);\n    }\n  }{code}\n\n\nAs per {{Subject.equals()}} javadoc it takes care of comparing both principals and credentials.\n{code}  /**\n     * Compares the specified Object with this {@code Subject}\n     * for equality.  Returns true if the given object is also a Subject\n     * and the two {@code Subject} instances are equivalent.\n     * More formally, two {@code Subject} instances are\n     * equal if their {@code Principal} and {@code Credential}\n     * Sets are equal.{code}\n\n\nbq. If there are 2 different Subjects/UGIs with the same principal, but different credentials attached, then an equality check on principal alone could cause a get from the FileSystem cache or IPC client connection cache to return an instance with incorrect credentials.\n\nI think this problem also will be solved as well along with the one mentioned in description, i.e. creating two proxy users with same name. If the principals are same but credentials are different then subject.equals() will return false, so not re-using the connection of different credentials.\n\n[~cnauroth], does that sounds fine?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-10-30T16:52:40.048+0000","updated":"2015-10-30T16:52:40.048+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12909099/comment/14982884","id":"14982884","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"[~vinayrpet], unfortunately, we cannot switch UGI to use value equality instead of reference equality.  The current behavior is by design as per HADOOP-6670.  Since UGI is mutable, use of value equality on the {{Subject}} had been causing other problems for the caches that use UGI as a part of the key.\n\nLooking more closely at HADOOP-6670, I also see that tests were written as part of that patch, and those tests assert the current behavior.  I expect the changes proposed here would cause those tests to fail.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-30T17:03:53.764+0000","updated":"2015-10-30T17:03:53.764+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12909099/comment/14983778","id":"14983778","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~cnauroth] for details. I agree, we cannot directly use equals, because UGI is mutable.\n\nJust for the specific case of proxy users, How about using principal of the proxy User, and RealUser's subject ref comparison? \nJust like below\n{code}public boolean equals(Object o) {\n    if (o == this) {\n      return true;\n    } else if (o == null || getClass() != o.getClass()) {\n      return false;\n    }\n    UserGroupInformation other = ((UserGroupInformation) o);\n    if (getAuthenticationMethod() == other.getAuthenticationMethod()\n        && getAuthenticationMethod() == AuthenticationMethod.PROXY) {\n      User user = subject.getPrincipals(User.class).iterator().next();\n      RealUser realUser =\n          subject.getPrincipals(RealUser.class).iterator().next();\n      User otherUser =\n          other.subject.getPrincipals(User.class).iterator().next();\n      RealUser otherRealUser =\n          other.subject.getPrincipals(RealUser.class).iterator().next();\n      return user.equals(otherUser) && realUser\n          .getRealUser().subject == otherRealUser.getRealUser().subject;\n    } else {\n      return subject == other.subject;\n    }\n  }{code}\n\nAnd for the hascode() can be like below \n{code}  @Override\n  public int hashCode() {\n    if (getAuthenticationMethod() == AuthenticationMethod.PROXY) {\n      User user = subject.getPrincipals(User.class).iterator().next();\n      RealUser realUser =\n          subject.getPrincipals(RealUser.class).iterator().next();\n      return user.hashCode()\n          & System.identityHashCode(realUser.getRealUser().subject);\n    }\n    return System.identityHashCode(subject);\n  }\n{code}\n\nWill this address concerns mentioned in above comments?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-10-31T03:19:37.495+0000","updated":"2015-10-31T03:19:37.495+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12909099/comment/14984176","id":"14984176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"[~vinayrpet], I think in order to proceed with an optimization like that, we'd need to do an exhaustive review of both Hadoop and downstream ecosystem projects to check if they use any mutable operations on an instance returned from {{UserGroupInformation#createProxyUser}}.  Existing calls to {{addToken}} or {{addCredentials}} on a proxy user would make it difficult to proceed safely.\n\nInterestingly, while browsing around, I noticed that Oozie maintains a cache of proxy user instances, perhaps for this very reason.  The class is {{org.apache.oozie.service.UserGroupInformationService}}.  This might imply that caching of proxy users is better handled as an application-specific concern, where that application knows the full lifecycle and usage of those instances, instead of at the core where we don't have that knowledge.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-31T21:58:48.204+0000","updated":"2015-10-31T21:58:48.204+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12909099/comment/14984628","id":"14984628","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"body":"I understand it.\n\nbq. This might imply that caching of proxy users is better handled as an application-specific concern, where that application knows the full lifecycle and usage of those instances, instead of at the core where we don't have that knowledge.\nSo you mean to say, We leave the current behavior as is, in UGI, let the application cache the instance of proxy user if they want to re-use, based on their usecase. Right.?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinayrpet","name":"vinayrpet","key":"vinayrpet","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinayakumar B","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-11-02T01:33:53.676+0000","updated":"2015-11-02T01:33:53.676+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12909099/comment/14985986","id":"14985986","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"body":"Clarifying my earlier comment, I didn't mean to suggest that we should immediately close this as Won't Fix.  If there is an opportunity to optimize for proxy users at our layer and prevent the need for downstream applications to build a cache, then that's helpful for the whole ecosystem.\n\nHowever, this is such a sensitive piece of logic that I'd want to see a diligent review across the ecosystem to check for mutable usage of proxy user UGI instances.  I'd also want to see a thorough code review from multiple committers.  I would not advocate committing a patch for this unless people are willing to put in that effort.\n\nTo summarize, I see the proposal as potentially helpful, but also highly risky.  Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cnauroth","name":"cnauroth","key":"cnauroth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cnauroth&avatarId=11432","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cnauroth&avatarId=11432","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cnauroth&avatarId=11432","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cnauroth&avatarId=11432"},"displayName":"Chris Nauroth","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-02T20:39:29.660+0000","updated":"2015-11-02T20:39:29.660+0000"}],"maxResults":9,"total":9,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-12529/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2nq33:"}}