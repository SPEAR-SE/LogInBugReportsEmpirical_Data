{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12626400","self":"https://issues.apache.org/jira/rest/api/2/issue/12626400","key":"HADOOP-9184","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2013-01-07T21:48:14.503+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat May 02 04:30:50 UTC 2015","customfield_12310420":"302993","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-9184/watchers","watchCount":10,"isWatching":false},"created":"2013-01-07T19:50:35.535+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["BB2015-05-TBR"],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314203","id":"12314203","description":"","name":"0.20.2","archived":false,"released":true,"releaseDate":"2010-02-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-05-06T03:31:45.851+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[],"timeoriginalestimate":null,"description":"We had a Hadoop job that was running 100 reducers with most of the reducers expected to write out an empty file. When the final output was to an S3 bucket we were finding that sometimes we were missing a final part file.  This was happening approximately 1 job in 3 (so approximately 1 reducer out of 300 was failing to output the data properly). I've attached the pig script we were using to reproduce the bug.\n\nAfter an in depth look and instrumenting the code we traced the problem to moveTaskOutputs in FileOutputCommitter.  \n\nThe code there looked like:\n\n{code}\n    if (fs.isFile(taskOutput)) {\n\t… do stuff …       \n    } else if(fs.getFileStatus(taskOutput).isDir()) {\n\t… do stuff … \n    }\n{code}\n\nAnd what we saw happening is that for the problem jobs neither path was being exercised.  I've attached the task log of our instrumented code.  In this version we added an else statement and printed out the line \"THIS SEEMS LIKE WE SHOULD NEVER GET HERE …\".\n\nThe root cause of this seems to be an eventual consistency issue with S3.  You can see in the log that the first time moveTaskOutputs is called it finds that the taskOutput is a directory.  It goes into the isDir() branch and successfully retrieves the list of files in that directory from S3 (in this case just one file).  This triggers a recursive call to moveTaskOutputs for the file found in the directory.  But in this pass through moveTaskOutput the temporary output file can't be found resulting in both branches of the above if statement being skipped and the temporary file never being moved to the final output location.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12563616","id":"12563616","filename":"example.pig","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremykarn","name":"jeremykarn","key":"jeremykarn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Karn","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-07T19:55:43.044+0000","size":397,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12563616/example.pig"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12563633","id":"12563633","filename":"hadoop-9184.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremykarn","name":"jeremykarn","key":"jeremykarn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Karn","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-07T22:02:29.912+0000","size":5485,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12563633/hadoop-9184.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12563745","id":"12563745","filename":"HADOOP-9184-branch-0.20.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremykarn","name":"jeremykarn","key":"jeremykarn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Karn","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-08T12:55:00.887+0000","size":3956,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12563745/HADOOP-9184-branch-0.20.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12563612","id":"12563612","filename":"task_log.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremykarn","name":"jeremykarn","key":"jeremykarn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Karn","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-07T19:51:25.589+0000","size":100663,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12563612/task_log.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"250106","customfield_12312823":null,"summary":"Some reducers failing to write final output file to s3.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremykarn","name":"jeremykarn","key":"jeremykarn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Karn","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremykarn","name":"jeremykarn","key":"jeremykarn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Karn","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13546308","id":"13546308","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12563616/example.pig\n  against trunk revision .\n\n    {color:red}-1 patch{color}.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-HADOOP-Build/1998//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-07T21:48:14.503+0000","updated":"2013-01-07T21:48:14.503+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13546333","id":"13546333","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12563633/hadoop-9184.patch\n  against trunk revision .\n\n    {color:red}-1 patch{color}.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-HADOOP-Build/1999//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-07T22:17:23.514+0000","updated":"2013-01-07T22:17:23.514+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13546345","id":"13546345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12563633/hadoop-9184.patch\n  against trunk revision .\n\n    {color:red}-1 patch{color}.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-HADOOP-Build/2001//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-07T22:28:22.815+0000","updated":"2013-01-07T22:28:22.815+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13546574","id":"13546574","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12563633/hadoop-9184.patch\n  against trunk revision .\n\n    {color:red}-1 patch{color}.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-HADOOP-Build/2004//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-08T03:43:00.306+0000","updated":"2013-01-08T03:43:00.306+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13546849","id":"13546849","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12563745/HADOOP-9184-branch-0.20.patch\n  against trunk revision .\n\n    {color:red}-1 patch{color}.  The patch command could not apply the patch.\n\nConsole output: https://builds.apache.org/job/PreCommit-HADOOP-Build/2012//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-08T13:02:43.401+0000","updated":"2013-01-08T13:02:43.401+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13546890","id":"13546890","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremykarn","name":"jeremykarn","key":"jeremykarn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Karn","active":true,"timeZone":"Etc/UTC"},"body":"I'm not sure what's wrong with the patch.  It seems to apply fine when I do it locally.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremykarn","name":"jeremykarn","key":"jeremykarn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Karn","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-08T13:48:17.456+0000","updated":"2013-01-08T13:48:17.456+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13549805","id":"13549805","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"body":"The PreCommit builds run only against trunk. Target your patch for branch-1 and run it through the test-patch process (ant test-patch or run the script manually). If everything passes, you can post the result to this jira.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kihwal","name":"kihwal","key":"kihwal","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kihwal&avatarId=34594","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kihwal&avatarId=34594","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kihwal&avatarId=34594","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kihwal&avatarId=34594"},"displayName":"Kihwal Lee","active":true,"timeZone":"America/Chicago"},"created":"2013-01-10T17:19:57.139+0000","updated":"2013-01-10T17:19:57.139+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13559988","id":"13559988","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremykarn","name":"jeremykarn","key":"jeremykarn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Karn","active":true,"timeZone":"Etc/UTC"},"body":"When I run:\n\nant test-patch -Dpatch.file=../HADOOP-9184-branch-0.20.patch -Dforrest.home=$FORREST_HOME -Dfindbugs.home=$FINDBUGS_HOME -Djava5.home=$JAVA_5_HOME\n\nIt fails with:\n\n     [exec] ======================================================================\n     [exec]     Pre-building trunk to determine trunk number\n     [exec]     of release audit, javac, and Findbugs warnings.\n     [exec] ======================================================================\n     [exec] ======================================================================\n     [exec] \n     [exec] \n     [exec] /bin/ant -Dversion=PATCH-HADOOP-9184-branch-0.20.patch -Djavac.args=-Xlint -Xmaxwarns 1000  -Djava5.home=/home/ubuntu/jdk1.5.0_22 -Dforrest.home=/home/ubuntu/apache-forrest-0.8 -DHadoopPatchProcess= clean tar > /home/ubuntu/tmp/trunkJavacWarnings.txt 2>&1\n     [exec] Trunk compilation is broken?\n\nBut I can successfully run: \n\nant clean tar -Djavac.args=\"-Xlint -Xmaxwarns 1000\" -Dforrest.home=$FORREST_HOME -Dfindbugs.home=$FINDBUGS_HOME -Djava5.home=$JAVA_5_HOME -DHadoopPatchProcess= clean tar\n\nAny ideas?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremykarn","name":"jeremykarn","key":"jeremykarn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Karn","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-22T20:41:03.823+0000","updated":"2013-01-22T20:41:03.823+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13568510","id":"13568510","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sorenmacbeth","name":"sorenmacbeth","key":"sorenmacbeth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sorenmacbeth&avatarId=11033","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sorenmacbeth&avatarId=11033","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sorenmacbeth&avatarId=11033","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sorenmacbeth&avatarId=11033"},"displayName":"Soren Macbeth","active":true,"timeZone":"America/Los_Angeles"},"body":"This has bitten me many times. Happy to see the source of the bug has been found and looking forward to the fix making it in.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sorenmacbeth","name":"sorenmacbeth","key":"sorenmacbeth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=sorenmacbeth&avatarId=11033","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=sorenmacbeth&avatarId=11033","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=sorenmacbeth&avatarId=11033","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=sorenmacbeth&avatarId=11033"},"displayName":"Soren Macbeth","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-02-01T05:57:25.350+0000","updated":"2013-02-01T05:57:25.350+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13568935","id":"13568935","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"The patch won't apply as it's in the branch 1 layout and build, trunk is split up and Mavenized. If you could do it for there and try and reduce the odd spurious change, that would be good.\n\nI see three possible causes\n# you've hit eventual consistency at play in S3. \n * Which S3 location are you working with? US-default?\n * Have a go on US-west and see if replicates there.\n# There's just a race condition between {{isFile()}} (which calls {{getFileStatus()}} and the {{getFileStatus()}} in the  following condition. I'd switch to a single {{getFileStatus()}} up front to eliminate that race, and eliminate the cost of another round trip (which is more expensive to remote filesystems)\n# Atomicity: {{mv}} and {{rm -rf}} aren't atomic on blobstores. We know about this and do need to come up with a better solution at the end of MR jobs for filesystems that declare they are blobstores.\n\nSteve","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2013-02-01T18:23:38.712+0000","updated":"2013-02-01T18:23:38.712+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13571302","id":"13571302","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremykarn","name":"jeremykarn","key":"jeremykarn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Karn","active":true,"timeZone":"Etc/UTC"},"body":"I don't think the bug actually applies to trunk since it looks like the latest FileOutputCommitter successfully handles the else condition in moveTaskOutputs.  \n\nThe problem I'm having is that its not clear to me how to submit a patch for the old branch 1 layout.  Any documentation I'm finding references maven and the test-patch script which don't seem to work with the older branches.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremykarn","name":"jeremykarn","key":"jeremykarn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Karn","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-05T13:49:58.671+0000","updated":"2013-02-05T13:49:58.671+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13571497","id":"13571497","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"body":"you are right, it's not in trunk.\n\njust do that patch and those of us who worry about blobstore support will have a look -though I need to get a lot of filesystem changes out the way first, including some unrelated fixes to S3n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org","name":"stevel@apache.org","key":"stevel@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"},"displayName":"Steve Loughran","active":true,"timeZone":"Europe/London"},"created":"2013-02-05T17:40:41.607+0000","updated":"2013-02-05T17:40:41.607+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13571632","id":"13571632","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremykarn","name":"jeremykarn","key":"jeremykarn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Karn","active":true,"timeZone":"Etc/UTC"},"body":"Ok, Then I think HADOOP-9184-branch-0.20.patch is ready for review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeremykarn","name":"jeremykarn","key":"jeremykarn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Karn","active":true,"timeZone":"Etc/UTC"},"created":"2013-02-05T19:27:48.521+0000","updated":"2013-02-05T19:27:48.521+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13721655","id":"13721655","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsensarma","name":"jsensarma","key":"jsensarma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joydeep Sen Sarma","active":true,"timeZone":"Asia/Kolkata"},"body":"One question - what the patch seems to do is assert that if a path was listed initially (in the parent moveTaskOutputs() call) - then it must be listable in the child call (if it's neither a Dir nor a File - then basically it's not listable). One thing I don't understand is what is the guarantee that the FileSystem will accurately list the child paths in the parent function call? (assuming this happens because of eventual consistency issues with S3)\n\nOn a different note - changing the moveTaskOutputs signature to carry a FileStatus (of the output path) instead of the Path argument removes the need to throw an exception (since the parent call just passes the status down to the child - there can never be any disagreement between the two)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsensarma","name":"jsensarma","key":"jsensarma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joydeep Sen Sarma","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-07-27T15:12:01.536+0000","updated":"2013-07-27T15:12:01.536+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/13722150","id":"13722150","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsensarma","name":"jsensarma","key":"jsensarma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joydeep Sen Sarma","active":true,"timeZone":"Asia/Kolkata"},"body":"unfortunately the patch doesn't fix this issue completely. as mentioned above - the initial listing of the task output directory may lie - and we are seeing this in testing. \n\nwe suspect this line of attack is ultimately futile. It's hard for FileOutputCommitter to know exactly how many files have been produced by the recordwriter. Most likely - writing directly to final output location in S3 (and exploiting the atomicity of the S3 'put' operation) and just avoiding the rename operation is the only long term fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsensarma","name":"jsensarma","key":"jsensarma","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joydeep Sen Sarma","active":true,"timeZone":"Asia/Kolkata"},"created":"2013-07-29T04:41:54.860+0000","updated":"2013-07-29T04:41:54.860+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/14524644","id":"14524644","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"\\\\\n\\\\\n| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Patch URL | http://issues.apache.org/jira/secure/attachment/12563745/HADOOP-9184-branch-0.20.patch |\n| Optional Tests | javadoc javac unit findbugs checkstyle |\n| git revision | trunk / f1a152c |\n| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/6281/console |\n\n\nThis message was automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-02T04:28:44.514+0000","updated":"2015-05-02T04:28:44.514+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626400/comment/14524668","id":"14524668","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"\\\\\n\\\\\n| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Patch URL | http://issues.apache.org/jira/secure/attachment/12563745/HADOOP-9184-branch-0.20.patch |\n| Optional Tests | javadoc javac unit findbugs checkstyle |\n| git revision | trunk / f1a152c |\n| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/6295/console |\n\n\nThis message was automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-05-02T04:30:50.328+0000","updated":"2015-05-02T04:30:50.328+0000"}],"maxResults":17,"total":17,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-9184/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1770v:"}}