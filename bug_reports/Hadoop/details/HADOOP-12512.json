{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12907834","self":"https://issues.apache.org/jira/rest/api/2/issue/12907834","key":"HADOOP-12512","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2015-10-26T17:34:26.333+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Oct 29 13:11:33 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-12512/watchers","watchCount":3,"isWatching":false},"created":"2015-10-26T06:11:41.384+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12327583","id":"12327583","description":"2.7.0 release","name":"2.7.0","archived":false,"released":true,"releaseDate":"2015-04-20"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-10-29T13:11:33.375+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310689","id":"12310689","name":"fs","description":"Generic FileSystem code"}],"timeoriginalestimate":null,"description":"hadoop fs -ls / fails with below error when we use Custom -Dhadoop.root.logger that creates Configuration object and adds defaultResource custom-conf.xml with quiet = false.\ncustom-conf.xml is optional configuration.\n\nException in thread \"main\" java.lang.RuntimeException: custom-conf.xml not found\n        at\norg.apache.hadoop.conf.Configuration.loadResource(Configuration.java:2612)\n        at\norg.apache.hadoop.conf.Configuration.loadResources(Configuration.java:2531)\n        at\norg.apache.hadoop.conf.Configuration.getProps(Configuration.java:2444)\n        at org.apache.hadoop.conf.Configuration.set(Configuration.java:1156)\n        at org.apache.hadoop.conf.Configuration.set(Configuration.java:1128)\n        at\norg.apache.hadoop.conf.Configuration.setBoolean(Configuration.java:1464)\n        at\norg.apache.hadoop.util.GenericOptionsParser.processGeneralOptions(GenericOptionsParser.java:321)\n        at\norg.apache.hadoop.util.GenericOptionsParser.parseGeneralOptions(GenericOptionsParser.java:487)\n        at\norg.apache.hadoop.util.GenericOptionsParser.<init>(GenericOptionsParser.java:170)\n        at\norg.apache.hadoop.util.GenericOptionsParser.<init>(GenericOptionsParser.java:153)\n        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:64)\n        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:84)\n        at org.apache.hadoop.fs.FsShell.main(FsShell.java:340)\n\t\t\n\t\t\n\nISSUE:\n######\n\nThere is a Logic issue in Configuration class and defaultResources list.\n\nConfiguration is shared by classes. Configuration has a shared list of default resources added by the classes.\n\nIf class A wants x,y,z resources and says all are optional using quiet = false, Configuration loads if they are present else skips and adds them to list.\n\nNow shared list i.e defaultResources has x,y,z\n\nNow if class B wants x resource and says it as mandatory , loadResources scans the entire list and treats them mandatory. So during scan of y, it will fail.\n\nwhere A is Custom Class\nand B is FsShell\n\nFsShell checks for custom-conf.xml and treats it mandatory and fails.\n\n1. The mandatory/optional has to be resource wise. [OR]\n2. defaultResources should not be shared. \n\nBoth of them looks complex. And simple fix is the below.\n\n1. when loadResource skips initially if resource not found, it has to remove the entry from defaultResource list as well. There is no use in having a resource \nwhich is not at classpath in the list.\n\n\nCODE CHANGE:  class org.apache.hadoop.conf.Configuration\n############\n\nprivate Resource loadResource(Properties properties, Resource wrapper, boolean\nquiet) {}\n ......\n\n if (root == null) {\n        if (doc == null) {\n                  if (quiet) {\n        defaultResources.remove(resource);  // FIX: During skip, remove\nResource from shared list \n                    return null;\n                  }\n        throw new RuntimeException(resource + \" not found\");\n        }\n     root = doc.getDocumentElement();\n }\n\n ........\n\n\nTested after code fix, runs successfully.\n\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12768930","id":"12768930","filename":"HADOOP-12512.001.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-27T08:24:35.807+0000","size":759,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12768930/HADOOP-12512.001.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"hadoop fs -ls / fails when we use Custom -Dhadoop.root.logger ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907834/comment/14974609","id":"14974609","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"body":"[~Prabhu Joseph], since you've already done the work, could you post a patch?\n\nCheckout a clean version of trunk, make your change, then run:\n\n{noformat}\ngit diff trunk > HADOOP-12512.001.patch\n{format}\n\nAdd the patch as a file to the JIRA (under the More pull-down) and then click the Patch Submitted button.\n\nIt might not be a bad idea to first run:\n\n{noformat}\ngit diff trunk --check\n{noformat}\n\njust to make sure Jenkins won't complain about whitespace.  Let me know if you need any help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-26T17:34:26.333+0000","updated":"2015-10-26T17:34:26.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907834/comment/14975980","id":"14975980","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"body":"Patch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-27T08:24:35.813+0000","updated":"2015-10-27T08:24:35.813+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907834/comment/14976227","id":"14976227","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 0m 6s {color} | {color:blue} docker + precommit patch detected. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green} 0m 0s {color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:red}-1{color} | {color:red} test4tests {color} | {color:red} 0m 0s {color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 3m 2s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 4m 19s {color} | {color:green} trunk passed with JDK v1.8.0_60 {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 4m 6s {color} | {color:green} trunk passed with JDK v1.7.0_79 {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 0m 15s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 13s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 1m 35s {color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 53s {color} | {color:green} trunk passed with JDK v1.8.0_60 {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 1m 2s {color} | {color:green} trunk passed with JDK v1.7.0_79 {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 1m 26s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 4m 16s {color} | {color:green} the patch passed with JDK v1.8.0_60 {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 4m 16s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 4m 9s {color} | {color:green} the patch passed with JDK v1.7.0_79 {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 4m 9s {color} | {color:green} the patch passed {color} |\n| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red} 0m 14s {color} | {color:red} Patch generated 3 new checkstyle issues in hadoop-common-project/hadoop-common (total was 176, now 177). {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 0m 13s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green} 0m 0s {color} | {color:green} Patch has no whitespace issues. {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 1m 45s {color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 51s {color} | {color:green} the patch passed with JDK v1.8.0_60 {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 0m 59s {color} | {color:green} the patch passed with JDK v1.7.0_79 {color} |\n| {color:red}-1{color} | {color:red} unit {color} | {color:red} 6m 1s {color} | {color:red} hadoop-common in the patch failed with JDK v1.8.0_60. {color} |\n| {color:red}-1{color} | {color:red} unit {color} | {color:red} 6m 23s {color} | {color:red} hadoop-common in the patch failed with JDK v1.7.0_79. {color} |\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green} 0m 23s {color} | {color:green} Patch does not generate ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 43m 13s {color} | {color:black} {color} |\n\\\\\n\\\\\n|| Reason || Tests ||\n| JDK v1.7.0_79 Failed junit tests | hadoop.ipc.TestIPC |\n|   | hadoop.metrics2.sink.TestFileSink |\n|   | hadoop.metrics2.sink.TestFileSink |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker | Client=1.7.1 Server=1.7.1 Image:test-patch-base-hadoop-date2015-10-27 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12768930/HADOOP-12512.001.patch |\n| JIRA Issue | HADOOP-12512 |\n| Optional Tests |  asflicense  javac  javadoc  mvninstall  unit  findbugs  checkstyle  compile  |\n| uname | Linux 4a7655589616 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /home/jenkins/jenkins-slave/workspace/PreCommit-HADOOP-Build/patchprocess/apache-yetus-b9c369f/dev-support/personality/hadoop.sh |\n| git revision | trunk / 96677be |\n| Default Java | 1.7.0_79 |\n| Multi-JDK versions |  /usr/lib/jvm/java-8-oracle:1.8.0_60 /usr/lib/jvm/java-7-openjdk-amd64:1.7.0_79 |\n| findbugs | v3.0.0 |\n| checkstyle | https://builds.apache.org/job/PreCommit-HADOOP-Build/7949/artifact/patchprocess/diff-checkstyle-hadoop-common-project_hadoop-common.txt |\n| unit | https://builds.apache.org/job/PreCommit-HADOOP-Build/7949/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common-jdk1.8.0_60.txt |\n| unit | https://builds.apache.org/job/PreCommit-HADOOP-Build/7949/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common-jdk1.7.0_79.txt |\n| unit test logs |  https://builds.apache.org/job/PreCommit-HADOOP-Build/7949/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common-jdk1.8.0_60.txt https://builds.apache.org/job/PreCommit-HADOOP-Build/7949/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common-jdk1.7.0_79.txt |\n| JDK v1.7.0_79  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/7949/testReport/ |\n| Max memory used | 225MB |\n| Powered by | Apache Yetus   http://yetus.apache.org |\n| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7949/console |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-27T11:10:44.126+0000","updated":"2015-10-27T11:10:44.126+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907834/comment/14976388","id":"14976388","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"body":"Let me make sure I understand the issue.  You have a custom root logger that uses an optional config file.  When Log4j instantiates your logger, you add the optional config file to the list of default resources on the Configuration.  Then, when the FsShell starts, it tries to load your config file, fails, and throws an exception.  Is that correct?\n\nWhy are you adding your file as a default resource and not a regular resource (addResource()) ?  That's not the source of the issue, but I'm curious.\n\nLooking at the code, it looks to me like the first thing FsShell does is load all resources with quiet=false, meaning at that time there shouldn't be anything optional in the resource list.  All subsequent resource loading is done with quiet=true, allowing optional resources.  It seems to me the issue is that you're adding the resource too early.  Is it possible to do the initialization of your class lazily so that it doesn't go hunting for resource files until it's past the FsShell startup?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-27T13:39:54.713+0000","updated":"2015-10-27T13:39:54.713+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907834/comment/14978514","id":"14978514","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"body":"Yes [~templedf], You are correct. I am using custom Appender and since Logger is a static class and so it will be the first one gets loaded. \n\nThe configuration values are default, so we use adddefaultResources. We don't want to override the values.\n\nWhen the FsShell loads all resources initially with quiet=false, the custom configuration file is already been put into defaultResources list by the custom Appender and it does not fail as we had quiet=true, but FsShell fails.\n\nWhen Configuration is quiet during loading of resources, it has to remove the entry as well. Else FsShell is looking for that eventhough it does not need that right.\n\nThere is some logic bug in Configuration class in the way it handles the defaultResources list and quiet mode.\n\n1. Either mandatory / optional field has to be resource wise. [OR}\n2. defaultResources list should not be shared among classes [OR]\n\n3. Simple one is to remove from list if config is not on classpath and quiet=true.\n\n\n\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-28T14:33:28.663+0000","updated":"2015-10-28T14:33:28.663+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907834/comment/14978772","id":"14978772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"body":"The risk with removing the config from the list is that if one of the core config files is missing, you'll remove it during your appender's initialization.  The FsShell therefore won't fail os init, leaving the failure to be discovered from some odd side-effect later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-10-28T17:05:47.475+0000","updated":"2015-10-28T17:05:47.475+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12907834/comment/14980394","id":"14980394","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"body":"Yes that solution is risk. Maybe how about the below ones:\n\n1. Either mandatory / optional field has to be resource wise. [OR]\n2. defaultResources list should not be shared among classes \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Prabhu+Joseph","name":"Prabhu Joseph","key":"prabhu joseph","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prabhu Joseph","active":true,"timeZone":"Etc/UTC"},"created":"2015-10-29T13:11:33.375+0000","updated":"2015-10-29T13:11:33.375+0000"}],"maxResults":7,"total":7,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-12512/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i2nibz:"}}