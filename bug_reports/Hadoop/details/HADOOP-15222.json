{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13137998","self":"https://issues.apache.org/jira/rest/api/2/issue/13137998","key":"HADOOP-15222","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2018-02-12T23:39:05.697+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Feb 28 00:34:46 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-15222/watchers","watchCount":12,"isWatching":false},"created":"2018-02-12T22:37:22.284+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12341431","id":"12341431","description":"3.0.0 GA release","name":"3.0.0","archived":false,"released":true,"releaseDate":"2017-12-13"}],"issuelinks":[{"id":"12526893","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12526893","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"13137987","key":"YARN-7923","self":"https://issues.apache.org/jira/rest/api/2/issue/13137987","fields":{"summary":"Refine proxy user authorization to support multiple ACL list","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12527001","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12527001","type":{"id":"12310051","name":"Supercedes","inward":"is superceded by","outward":"supercedes","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310051"},"outwardIssue":{"id":"13042459","key":"HADOOP-14077","self":"https://issues.apache.org/jira/rest/api/2/issue/13042459","fields":{"summary":"Improve the patch of HADOOP-13119","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-02-28T01:12:00.854+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312526","id":"12312526","name":"security"}],"timeoriginalestimate":null,"description":"This Jira is responding to follow up work for HADOOP-14077.  The original goal of HADOOP-14077 is to have ability to support multiple ACL lists.  The original problem is a separation of duty use case where the Hadoop cluster hosting company monitors Hadoop cluster through jmx.  Application logs and hdfs contents should not be visible to hosting company system administrators.  When checking for proxy user authorization in AuthenticationFilter to ensure there is a way to authorize normal users and admin users using separate proxy users ACL lists.  This was suggested in HADOOP-14060 to configure AuthenticationFilterWithProxyUser this way:\r\n\r\nAuthenticationFilterWithProxyUser->StaticUserWebFilter->AuthenticationFIlterWithProxyUser\r\n\r\nThis enables the second AuthenticationFilterWithProxyUser validates both credentials claim by proxy user, and end user.\r\n\r\nHowever, there is a side effect that unauthorized users are not properly rejected with 403 FORBIDDEN message if there is no other web filter configured to handle the required authorization work.\r\n\r\nThis JIRA is intend to discuss the work of HADOOP-14077 by either combine StaticUserWebFilter + second AuthenticationFilterWithProxyUser into a AuthorizationFilterWithProxyUser as a final filter to evict unauthorized user, or revert both HADOOP-14077 and HADOOP-13119 to eliminate the false positive in user authorization and impersonation.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12342131","id":"12342131","name":"3.0.1","archived":false,"released":true,"releaseDate":"2018-03-25"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"Refine proxy user authorization to support multiple ACL list","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137998/comment/16361602","id":"16361602","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"body":"[~eyang] - IMO, we need to revert both HADOOP-14077 and HADOOP-13119 and then determine whether to address the original issue.\r\n\r\nLet's please be clear on what that problem is - can you verify whether the following summarizes it properly?\r\n # There are deployments that only allow access through a single proxy entry point\r\n # Some resources that are accessible through proxies should only be accessible for admins\r\n # Proxyuser enforcement is generally used to restrict proxies from impersonating admins and super users for obvious reasons\r\n\r\nDue to the paradox created by the facts in 2 and 3 above we have the following situation, we need to decide whether we should either:\r\n # Disable certain paths for proxy users as they are intended only for direct access by authenticated users and deployments described in #1 above are out of luck\r\n # Open the proxyuser enforcement rules to allow admin access for specific paths\r\n\r\nPersonally, I don't believe that the fact that certain resources can't be accessed in deployments that only allow impersonation means that we should redefine the proxyuser enforcement strength.\r\n\r\nI think that it is valid to consider strengthening the proxyuser enforcement to deny access to specific sensitive resources.\r\n\r\nWhether or not certain resources are too sensitive for impersonation can be left up to the deployment.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"created":"2018-02-12T23:39:05.697+0000","updated":"2018-02-12T23:39:05.697+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137998/comment/16361731","id":"16361731","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lmccay] Thank you for the summary.  This is aligned with the original problem statement.  Role based ACL in standard J2EE web application would be the right approach to solve the authorization problem.  User can describe in web.xml which url resource are allowed by roles.  Roles are mapped to groups of users.  It would be nice to do the same in Hadoop.  Hadoop web applications don't quite follow J2EE design pattern.  This made the problem hard to solve for Hadoop.  We can start by turning Hadoop jetty Java code back to configuration, and maps to roles.  In doing so, we might finish in 2-3 years of hard labour.  There might be better ways to resolve this issue that we need to explore.\r\n\r\nHADOOP-13119 is back ported to Hadoop 2.8.x as a new feature in Hadoop 2.8.  Do we revert HADOOP-13119 from 2.8.x or we keep HADOOP-13119 as the temp solution until the new work is completed?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-13T02:27:52.267+0000","updated":"2018-02-13T02:27:52.267+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137998/comment/16361756","id":"16361756","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"body":"Revert it from all branches and put it back to proper proxyuser rules enforcement.\r\n\r\nAlso, we should add the block of a configurable set of resources so that they can't be accessed via impersonation since impersonation isn't intended for admin users and some resources may be considered sensitive enough to limit to admins.\r\n\r\nWe can then have a discussion on whether we want to extend impersonated to admins or not.\r\n\r\nI personally don't think we should but perhaps it can be controlled enough with proper config.\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"created":"2018-02-13T03:07:13.082+0000","updated":"2018-02-13T03:07:13.082+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137998/comment/16361799","id":"16361799","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lmccay] Sorry, until a better proposal is feasible to secure /log and /jmx, there is no good enough reason to justify the revert of HADOOP-13119.  [~arpitagarwal]'s report was not valid on HADOOP-13119, and HADOOP-13119 does provide better security for authorized users than anonymous to access /log.  I can not agree on the revert on HADOOP-13119 at this time.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-13T04:15:05.452+0000","updated":"2018-02-13T04:15:05.452+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13137998/comment/16379563","id":"16379563","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"body":"Today, hadoop offers two roles, cluster admin, and normal users.  New system monitor role might be required for separation of duty for service hosting companies.  The following table shows a rough sketch of roles required to map to Hadoop web applications:\r\n\r\nHDFS\r\n| /logs | cluster admin |\r\n| /jmx | system monitor |\r\n| /conf | cluster admin |\r\n| /stacks | system monitor |\r\n\r\nYARN\r\n| /logs | cluster admin |\r\n| /jmx | system monitor |\r\n| /conf | cluster admin |\r\n\r\nThis separation will prevent leaks of customer information.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eyang","name":"eyang","key":"eyang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eric Yang","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-02-28T00:34:46.010+0000","updated":"2018-02-28T01:12:00.848+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-15222/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i3q3f3:"}}