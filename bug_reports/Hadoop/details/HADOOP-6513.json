{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12446764","self":"https://issues.apache.org/jira/rest/api/2/issue/12446764","key":"HADOOP-6513","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2010-01-27T03:27:07.821+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jan 28 21:17:45 UTC 2010","customfield_12310420":"19160","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-6513/watchers","watchCount":2,"isWatching":false},"created":"2010-01-27T03:22:39.631+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313866","id":"12313866","description":"","name":"0.20.1","archived":false,"released":true,"releaseDate":"2009-09-01"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-01-28T21:17:45.229+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310687","id":"12310687","name":"io","description":""}],"timeoriginalestimate":null,"description":"SequenceFile.Writer takes key/value classes as creation arguments and checks for validity on every append.\nReader does not take class arguments on creation because they are derived from the input file.\nSorter takes key/value classes as creation arguments??  no point.  should be derived from input.\n\nIn any case, SortPass does not compare Sorter key/value classes with input file classes.\nNo error is given for the following:\n\n\t  private static void writeTest4(FileSystem fs, int count, int seed, Path file, \n\t\t\t  SequenceFile.CompressionType compressionType, CompressionCodec codec, Configuration conf)\n\t    throws IOException {\n\t    fs.delete(file, true);\n\t    LOG.info(\"creating \" + count + \" records with \" + compressionType +\n\t             \" compression\");\n\t    SequenceFile.Writer writer = \n\t      SequenceFile.createWriter(fs, conf, file, \n\t    \t\t  StringWritable.class, FloatWritable.class, compressionType, codec);\n\t    FloatWritable x=new FloatWritable();\n\t    StringWritable y=new StringWritable();\n\t    for (int i = count-1; i >= 0; i--) {\n\t      x.set(i);  y.set(\"\"+i);\n\t      writer.append(y, x);\n\t    }\n\t    writer.close();\n\t  }\n\n\t  private static void sortTest(FileSystem fs, int count, int megabytes, \n\t\t\t  int factor, boolean fast, Path file, Configuration conf)\n\t  throws IOException {\n\t\t  fs.delete(new Path(file+\".sorted\"), true);\n\t\t  SequenceFile.Sorter sorter = newSorter(fs, fast, megabytes, factor, conf);\n\t\t  LOG.debug(\"sorting \" + count + \" records\");\n\t\t  sorter.sort(file, file.suffix(\".sorted\"));\n\t\t  LOG.info(\"done sorting \" + count + \" debug\");\n\t  }\n\t  \n\t  private static SequenceFile.Sorter newSorter(FileSystem fs, \n\t\t\t  boolean fast,\n\t\t\t  int megabytes, int factor, Configuration conf) {\n\t\t  SequenceFile.Sorter sorter = \n\t\t\t  fast\n\t\t\t  ? new SequenceFile.Sorter(fs, new IntWritable.Comparator(),\n\t\t\t\t\t  FloatWritable.class, IntWritable.class, conf)\n\t\t  : new SequenceFile.Sorter(fs, FloatWritable.class, IntWritable.class, conf);\n\t\t\t  sorter.setMemory(megabytes * 1024*1024);\n\t\t\t  sorter.setFactor(factor);\n\t\t\t  return sorter;\n\t  }\n---------------------Note String/Float  does not match Float/Int\nMacintosh-2:datanode bobcook$ od -c file          \n0000000    S   E   Q 006 016   S   t   r   i   n   g   W   r   i   t   a\n0000020    b   l   e  \\r   F   l   o   a   t   W   r   i   t   a   b   l\n0000040    e  \\0  \\0  \\0  \\0  \\0  \\0 203   `   n   E   J   z 272   d 352\n0000060    w 177 373  \\n 364   M 276  \\0  \\0  \\0  \\n  \\0  \\0  \\0 006  \\0\n0000100   \\0  \\0 001  \\0   4   @ 200  \\0  \\0  \\0  \\0  \\0  \\n  \\0  \\0  \\0\n0000120  006  \\0  \\0  \\0 001  \\0   3   @   @  \\0  \\0  \\0  \\0  \\0  \\n  \\0\n0000140   \\0  \\0 006  \\0  \\0  \\0 001  \\0   2   @  \\0  \\0  \\0  \\0  \\0  \\0\n0000160   \\n  \\0  \\0  \\0 006  \\0  \\0  \\0 001  \\0   1   ? 200  \\0  \\0  \\0\n0000200   \\0  \\0  \\n  \\0  \\0  \\0 006  \\0  \\0  \\0 001  \\0   0  \\0  \\0  \\0\n*\n0000220\nMacintosh-2:datanode bobcook$ od -c file.sorted\n0000000    S   E   Q 006  \\r   F   l   o   a   t   W   r   i   t   a   b\n0000020    l   e  \\v   I   n   t   W   r   i   t   a   b   l   e  \\0  \\0\n0000040   \\0  \\0  \\0  \\0   6 364 343  \\r 256   h   U 222 365   T   7   l\n0000060  357   i   ~   }  \\0  \\0  \\0  \\n  \\0  \\0  \\0 006  \\0  \\0  \\0 001\n0000100   \\0   4   @ 200  \\0  \\0  \\0  \\0  \\0  \\n  \\0  \\0  \\0 006  \\0  \\0\n0000120   \\0 001  \\0   3   @   @  \\0  \\0  \\0  \\0  \\0  \\n  \\0  \\0  \\0 006\n0000140   \\0  \\0  \\0 001  \\0   2   @  \\0  \\0  \\0  \\0  \\0  \\0  \\n  \\0  \\0\n0000160   \\0 006  \\0  \\0  \\0 001  \\0   1   ? 200  \\0  \\0  \\0  \\0  \\0  \\n\n0000200   \\0  \\0  \\0 006  \\0  \\0  \\0 001  \\0   0  \\0  \\0  \\0  \\0        \n0000216\nNOTE OUTPUT FILE IS TOTALLY TOASTED, but no error was generated!\nPS: Your evaluation of my previous bug reports was enlightening.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12431700","id":"12431700","filename":"TestSequenceFile.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bobcgausa","name":"bobcgausa","key":"bobcgausa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"robert Cook","active":true,"timeZone":"Etc/UTC"},"created":"2010-01-28T21:12:47.454+0000","size":23078,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12431700/TestSequenceFile.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"103127","customfield_12312823":null,"summary":"SequenceFile.Sorter  design issue and class-check bug","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bobcgausa","name":"bobcgausa","key":"bobcgausa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"robert Cook","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bobcgausa","name":"bobcgausa","key":"bobcgausa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"robert Cook","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"hadoop 20.1, java 1.6.0_17,fedora","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12446764/comment/12805338","id":"12805338","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"Hi Robert. Would you mind posting your test program as an attachment, rather than the JIRA description? It's difficult to read code in this context. Best would be a failing unit test case that shows the problem as you understand it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-01-27T03:27:07.821+0000","updated":"2010-01-27T03:27:07.821+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12446764/comment/12806093","id":"12806093","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bobcgausa","name":"bobcgausa","key":"bobcgausa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"robert Cook","active":true,"timeZone":"Etc/UTC"},"body":"Here's an update to TestSequenceFile with a new Unit test as you requested.\nthe test suceeds; it should fail.\n\nPS Re 6512\nBy your argument, there should be no synchronized prefixes in the SequenceFile user I/O methods,\nbut there are.\nI respectfully disagree with your conclusion.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bobcgausa","name":"bobcgausa","key":"bobcgausa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"robert Cook","active":true,"timeZone":"Etc/UTC"},"created":"2010-01-28T21:12:47.495+0000","updated":"2010-01-28T21:12:47.495+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12446764/comment/12806095","id":"12806095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"body":"Rob: can you please post this test as a patch that just adds the new test case and doesn't comment out or modify other parts of TestSequenceFile? You can generate a patch using \"svn diff\".  It's difficult to review what the test is doing when you've uploaded the entire modified file. See http://wiki.apache.org/hadoop/HowToContribute\n\nAs for the other JIRA, please keep discussion on each issue within the comments for that issue. One of the central foundations of the Apache process is open discussion and the ability to see how decisions were made. If you put comments in this JIRA that pertain to another, people may not see them, and down the road they certainly won't find them.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","key":"tlipcon","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tlipcon&avatarId=26804","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tlipcon&avatarId=26804","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tlipcon&avatarId=26804","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tlipcon&avatarId=26804"},"displayName":"Todd Lipcon","active":true,"timeZone":"America/Tijuana"},"created":"2010-01-28T21:17:45.226+0000","updated":"2010-01-28T21:17:45.226+0000"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-6513/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0i07b:"}}