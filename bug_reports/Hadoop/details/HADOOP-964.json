{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12361700","self":"https://issues.apache.org/jira/rest/api/2/issue/12361700","key":"HADOOP-964","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312257","id":"12312257","description":"","name":"0.11.0","archived":false,"released":true,"releaseDate":"2007-02-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2007-02-01T00:10:29.667+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Feb 02 19:23:00 UTC 2007","customfield_12310420":"125070","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_156830916_*|*_1_*:*_1_*:*_54342_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_28828871","customfield_12312321":null,"resolutiondate":"2007-02-02T19:23:00.637+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-964/watchers","watchCount":0,"isWatching":false},"created":"2007-01-31T23:48:15.379+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12315073","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12315073","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12361217","key":"HADOOP-927","self":"https://issues.apache.org/jira/rest/api/2/issue/12361217","fields":{"summary":"MapReduce is Broken for User-Defined Classes","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12314907","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12314907","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12361778","key":"HADOOP-968","self":"https://issues.apache.org/jira/rest/api/2/issue/12361778","fields":{"summary":"Reduce shuffle and merge should be done a child JVM","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-07-08T16:52:08.105+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"In the ReduceTaskRunner constructor lin 339 a sorter is created that attempts to get the map output key and value classes from the configuration object.  This is before the TaskTracker$Child process is spawned off into into own separate JVM so here the classpath for the configuration is the classpath that started the TaskTracker.  The current hadoop script includes the hadoop jars, meaning that any hadoop writable type will be found, but it doesn't include nutch jars  so any nutch writable type or any other writable type will not be found and will throw a ClassNotFoundException.\n\nI don't think it is a good idea to have a dependecy on specific Nutch jars in the Hadoop script but it is a good idea to allow jars to be included if they are in specific locations, such as the HADOOP_HOME where the nutch jar resides.  I have attached a patch that adds any jars in the HADOOP_HOME directory to the hadoop classpath.  This fixes the issues with getting ClassNotFoundExceptions inside of Nutch processes.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12350088","id":"12350088","filename":"classpath.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"created":"2007-01-31T23:49:53.640+0000","size":462,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12350088/classpath.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12350191","id":"12350191","filename":"classpath2_unittest.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"created":"2007-02-02T04:18:42.727+0000","size":7315,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12350191/classpath2_unittest.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12350101","id":"12350101","filename":"classpath2.path","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"created":"2007-02-01T03:45:06.382+0000","size":1978,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12350101/classpath2.path"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12350239","id":"12350239","filename":"classpath3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"created":"2007-02-02T18:40:04.165+0000","size":9290,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12350239/classpath3.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"106630","customfield_12312823":null,"summary":"ClassNotFoundException in ReduceTaskRunner","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"windows xp and fedora core 6 linux, java 1.5.10...should affect all systems","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361700/comment/12469262","id":"12469262","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"body":"This patch adds any jars in the HADOOP_HOME directory to the hadoop classpath that starts the Tasktracker.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"created":"2007-01-31T23:49:09.705+0000","updated":"2007-01-31T23:49:09.705+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361700/comment/12469263","id":"12469263","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"body":"Patch added","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"created":"2007-01-31T23:49:53.767+0000","updated":"2007-01-31T23:49:53.767+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361700/comment/12469275","id":"12469275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1, because http://issues.apache.org/jira/secure/attachment/12350088/classpath.patch applied and successfully tested against trunk revision r502030.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2007-02-01T00:10:29.667+0000","updated":"2007-02-01T00:10:29.667+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361700/comment/12469324","id":"12469324","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"body":"Fixes the classpath in the ReduceTaskRunner instead of the shell scripts","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"created":"2007-02-01T03:45:06.502+0000","updated":"2007-02-01T03:45:06.502+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361700/comment/12469327","id":"12469327","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"body":"The second patch classpath2.path (sorry should be patch) attacks the problem from the ReduceTaskRunner instead of the hadoop shell script.  The problem is that Writable classes are not being found by the ReduceTaskRunner upon initialization.  It needs these Writable classes to perform sorting, etc in the prepare stage.  The first solution was to change the hadoop script to load any jars in the HADOOP_HOME.  The hadoop script sets the classpath for the TaskTracker which is then passed to the ReduceTaskRunner and therefore by loading any jars in the home directory the necessary jars would be in the classpath and accessible.  There are a few issues with that fix.  First this reverses HADOOP-700 which we don't want to do.  Second is we went down this path of setting classpath through the script for Writable classes then anytime new classes were added we would have to restart the TaskTracker nodes.  Again not a good solution.\n\nSo instead what I did with this patch is to change the ReduceTaskRunner to dynamically configure it classpath from the local unjarred work directory.  It does this through creating a new URLClassLoader and adding in the same elements that are added to classpath of the TaskTracker$Child spawns while keeping the old context class loader as its parent.  The new URLClassLoader is then set into the current JobConf as its classloader and it is used for the sorting, etc.  This allows us to not have to change the hadoop script and two allows new writable classes to by dynamically added to the system without restarting TaskTracker nodes.\n\nI have run this patch on a development system using the Nutch injector as well as ran the TestMapRed unit tests.  Both completed sucessfully.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"created":"2007-02-01T03:58:56.181+0000","updated":"2007-02-01T03:58:56.181+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361700/comment/12469329","id":"12469329","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"body":"This is really more of a ReduceTaskRunner than a shell script issue so changing title.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"created":"2007-02-01T04:00:10.560+0000","updated":"2007-02-01T04:00:10.560+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361700/comment/12469523","id":"12469523","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cutting","name":"cutting","key":"cutting","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Cutting","active":true,"timeZone":"America/Los_Angeles"},"body":"This is a serious bug, introduced by the new merge code.  Previously, comparators were only used in the child process: ReduceTaskRunner.prepare() only copied binary data before, but not it does some sorting too.  Hence, this logic should move into the child process.  (Architecturally, the goal is to keep user code out of long-running daemon processes.)\n\nI think we should proceed as follows:\n\n1. Add a unit test where the comparator is in the jar file.\n2. Make a short-term fix that loads these classes into the TaskTracker.\n3. Add another bug to move all comparator access into the child process.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cutting","name":"cutting","key":"cutting","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Cutting","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-02-01T17:48:47.814+0000","updated":"2007-02-01T17:48:47.814+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361700/comment/12469560","id":"12469560","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"body":"Are we going to be able to move all comparator access int the child process.  This is occurring during the sorting and merging.  Would that process have to be moved to the child?\n\nThe short term fix for loading the classes into the ReduceTaskRunner is classpath2.path, should I change this to occur in TaskTracker?  It would essentially just be moving the method over to the TaskTracker and changing where it gets called.\n\nI will create a unit test for the comparator in the jar file now , the new bug has already been created as HADOOP-968.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"created":"2007-02-01T19:42:18.088+0000","updated":"2007-02-01T19:42:18.088+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361700/comment/12469568","id":"12469568","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cutting","name":"cutting","key":"cutting","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Cutting","active":true,"timeZone":"America/Los_Angeles"},"body":"> Are we going to be able to move all comparator access int the child process.\n\nYes, I think so.  That's the subject of HADOOP-968.\n\n> should I change this to occur in TaskTracker?\n\nNo.  I was referring to the TaskTracker process, which is wherre ReduceTaskRunner runs.  I have not yet looked closely at your patch, but it is certainly a candidate for (2), the short-term fix.  HADOOP-968 is  the long-term fix.\n\n> I will create a unit test for the comparator in the jar file now\n\nGreat!  That would be most welcome.  There are already some unit tests that use a job jar file, so this can probably be bundled into one of those.\n\nI think Owen's planning to review your patch more closely.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cutting","name":"cutting","key":"cutting","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Cutting","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-02-01T20:09:57.096+0000","updated":"2007-02-01T20:09:57.096+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361700/comment/12469654","id":"12469654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"body":"The unit tests that verify the classpath2.path, dynamically loading external writable from job.jar.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"created":"2007-02-02T04:18:42.859+0000","updated":"2007-02-02T04:18:42.859+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361700/comment/12469798","id":"12469798","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=owen.omalley","name":"owen.omalley","key":"owen.omalley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=owen.omalley&avatarId=29697","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=owen.omalley&avatarId=29697","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=owen.omalley&avatarId=29697","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=owen.omalley&avatarId=29697"},"displayName":"Owen O'Malley","active":true,"timeZone":"America/Los_Angeles"},"body":"I think the classpath2.patch looks like the right approach for the short term fix. Thanks for the unit test.\n\n+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=owen.omalley","name":"owen.omalley","key":"owen.omalley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=owen.omalley&avatarId=29697","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=owen.omalley&avatarId=29697","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=owen.omalley&avatarId=29697","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=owen.omalley&avatarId=29697"},"displayName":"Owen O'Malley","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-02-02T16:51:01.159+0000","updated":"2007-02-02T16:51:01.159+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361700/comment/12469800","id":"12469800","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=owen.omalley","name":"owen.omalley","key":"owen.omalley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=owen.omalley&avatarId=29697","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=owen.omalley&avatarId=29697","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=owen.omalley&avatarId=29697","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=owen.omalley&avatarId=29697"},"displayName":"Owen O'Malley","active":true,"timeZone":"America/Los_Angeles"},"body":"(Although the preferred style is to make a new patch that includes all of the proposed changes in a single patch.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=owen.omalley","name":"owen.omalley","key":"owen.omalley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=owen.omalley&avatarId=29697","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=owen.omalley&avatarId=29697","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=owen.omalley&avatarId=29697","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=owen.omalley&avatarId=29697"},"displayName":"Owen O'Malley","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-02-02T16:53:06.472+0000","updated":"2007-02-02T16:53:06.472+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361700/comment/12469831","id":"12469831","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"body":"This patch contains both the classloader (classpath2.path) and the unit test (classpath2_unittest.patch) in a single file.   Thanks for the heads up Owen!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=musepwizard","name":"musepwizard","key":"musepwizard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dennis Kubes","active":true,"timeZone":"Etc/UTC"},"created":"2007-02-02T18:40:04.356+0000","updated":"2007-02-02T18:40:04.356+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361700/comment/12469838","id":"12469838","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cutting","name":"cutting","key":"cutting","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Cutting","active":true,"timeZone":"America/Los_Angeles"},"body":"I just fixed this.  Thanks, Dennis!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cutting","name":"cutting","key":"cutting","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Doug Cutting","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-02-02T19:23:00.629+0000","updated":"2007-02-02T19:23:00.629+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-964/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0iltr:"}}